(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();function KO(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var u4={exports:{}},O_={},h4={exports:{}},oi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b0=Symbol.for("react.element"),YO=Symbol.for("react.portal"),QO=Symbol.for("react.fragment"),t8=Symbol.for("react.strict_mode"),e8=Symbol.for("react.profiler"),r8=Symbol.for("react.provider"),i8=Symbol.for("react.context"),n8=Symbol.for("react.forward_ref"),s8=Symbol.for("react.suspense"),o8=Symbol.for("react.memo"),a8=Symbol.for("react.lazy"),U3=Symbol.iterator;function l8(e){return e===null||typeof e!="object"?null:(e=U3&&e[U3]||e["@@iterator"],typeof e=="function"?e:null)}var d4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f4=Object.assign,p4={};function yg(e,t,r){this.props=e,this.context=t,this.refs=p4,this.updater=r||d4}yg.prototype.isReactComponent={};yg.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};yg.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function g4(){}g4.prototype=yg.prototype;function t5(e,t,r){this.props=e,this.context=t,this.refs=p4,this.updater=r||d4}var e5=t5.prototype=new g4;e5.constructor=t5;f4(e5,yg.prototype);e5.isPureReactComponent=!0;var G3=Array.isArray,m4=Object.prototype.hasOwnProperty,r5={current:null},y4={key:!0,ref:!0,__self:!0,__source:!0};function _4(e,t,r){var i,n={},s=null,a=null;if(t!=null)for(i in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(s=""+t.key),t)m4.call(t,i)&&!y4.hasOwnProperty(i)&&(n[i]=t[i]);var o=arguments.length-2;if(o===1)n.children=r;else if(1<o){for(var f=Array(o),m=0;m<o;m++)f[m]=arguments[m+2];n.children=f}if(e&&e.defaultProps)for(i in o=e.defaultProps,o)n[i]===void 0&&(n[i]=o[i]);return{$$typeof:b0,type:e,key:s,ref:a,props:n,_owner:r5.current}}function c8(e,t){return{$$typeof:b0,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function i5(e){return typeof e=="object"&&e!==null&&e.$$typeof===b0}function u8(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var V3=/\/+/g;function sb(e,t){return typeof e=="object"&&e!==null&&e.key!=null?u8(""+e.key):t.toString(36)}function ay(e,t,r,i,n){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case b0:case YO:a=!0}}if(a)return a=e,n=n(a),e=i===""?"."+sb(a,0):i,G3(n)?(r="",e!=null&&(r=e.replace(V3,"$&/")+"/"),ay(n,t,r,"",function(m){return m})):n!=null&&(i5(n)&&(n=c8(n,r+(!n.key||a&&a.key===n.key?"":(""+n.key).replace(V3,"$&/")+"/")+e)),t.push(n)),1;if(a=0,i=i===""?".":i+":",G3(e))for(var o=0;o<e.length;o++){s=e[o];var f=i+sb(s,o);a+=ay(s,t,r,f,n)}else if(f=l8(e),typeof f=="function")for(e=f.call(e),o=0;!(s=e.next()).done;)s=s.value,f=i+sb(s,o++),a+=ay(s,t,r,f,n);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function h1(e,t,r){if(e==null)return e;var i=[],n=0;return ay(e,i,"","",function(s){return t.call(r,s,n++)}),i}function h8(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Yo={current:null},ly={transition:null},d8={ReactCurrentDispatcher:Yo,ReactCurrentBatchConfig:ly,ReactCurrentOwner:r5};function v4(){throw Error("act(...) is not supported in production builds of React.")}oi.Children={map:h1,forEach:function(e,t,r){h1(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return h1(e,function(){t++}),t},toArray:function(e){return h1(e,function(t){return t})||[]},only:function(e){if(!i5(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};oi.Component=yg;oi.Fragment=QO;oi.Profiler=e8;oi.PureComponent=t5;oi.StrictMode=t8;oi.Suspense=s8;oi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=d8;oi.act=v4;oi.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=f4({},e.props),n=e.key,s=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,a=r5.current),t.key!==void 0&&(n=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(f in t)m4.call(t,f)&&!y4.hasOwnProperty(f)&&(i[f]=t[f]===void 0&&o!==void 0?o[f]:t[f])}var f=arguments.length-2;if(f===1)i.children=r;else if(1<f){o=Array(f);for(var m=0;m<f;m++)o[m]=arguments[m+2];i.children=o}return{$$typeof:b0,type:e.type,key:n,ref:s,props:i,_owner:a}};oi.createContext=function(e){return e={$$typeof:i8,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:r8,_context:e},e.Consumer=e};oi.createElement=_4;oi.createFactory=function(e){var t=_4.bind(null,e);return t.type=e,t};oi.createRef=function(){return{current:null}};oi.forwardRef=function(e){return{$$typeof:n8,render:e}};oi.isValidElement=i5;oi.lazy=function(e){return{$$typeof:a8,_payload:{_status:-1,_result:e},_init:h8}};oi.memo=function(e,t){return{$$typeof:o8,type:e,compare:t===void 0?null:t}};oi.startTransition=function(e){var t=ly.transition;ly.transition={};try{e()}finally{ly.transition=t}};oi.unstable_act=v4;oi.useCallback=function(e,t){return Yo.current.useCallback(e,t)};oi.useContext=function(e){return Yo.current.useContext(e)};oi.useDebugValue=function(){};oi.useDeferredValue=function(e){return Yo.current.useDeferredValue(e)};oi.useEffect=function(e,t){return Yo.current.useEffect(e,t)};oi.useId=function(){return Yo.current.useId()};oi.useImperativeHandle=function(e,t,r){return Yo.current.useImperativeHandle(e,t,r)};oi.useInsertionEffect=function(e,t){return Yo.current.useInsertionEffect(e,t)};oi.useLayoutEffect=function(e,t){return Yo.current.useLayoutEffect(e,t)};oi.useMemo=function(e,t){return Yo.current.useMemo(e,t)};oi.useReducer=function(e,t,r){return Yo.current.useReducer(e,t,r)};oi.useRef=function(e){return Yo.current.useRef(e)};oi.useState=function(e){return Yo.current.useState(e)};oi.useSyncExternalStore=function(e,t,r){return Yo.current.useSyncExternalStore(e,t,r)};oi.useTransition=function(){return Yo.current.useTransition()};oi.version="18.3.1";h4.exports=oi;var af=h4.exports;const f8=KO(af);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p8=af,g8=Symbol.for("react.element"),m8=Symbol.for("react.fragment"),y8=Object.prototype.hasOwnProperty,_8=p8.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,v8={key:!0,ref:!0,__self:!0,__source:!0};function b4(e,t,r){var i,n={},s=null,a=null;r!==void 0&&(s=""+r),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(a=t.ref);for(i in t)y8.call(t,i)&&!v8.hasOwnProperty(i)&&(n[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps,t)n[i]===void 0&&(n[i]=t[i]);return{$$typeof:g8,type:e,key:s,ref:a,props:n,_owner:_8.current}}O_.Fragment=m8;O_.jsx=b4;O_.jsxs=b4;u4.exports=O_;var Kp=u4.exports,J2={},w4={exports:{}},Ka={},x4={exports:{}},A4={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(Dt,Qt){var ee=Dt.length;Dt.push(Qt);t:for(;0<ee;){var xe=ee-1>>>1,it=Dt[xe];if(0<n(it,Qt))Dt[xe]=Qt,Dt[ee]=it,ee=xe;else break t}}function r(Dt){return Dt.length===0?null:Dt[0]}function i(Dt){if(Dt.length===0)return null;var Qt=Dt[0],ee=Dt.pop();if(ee!==Qt){Dt[0]=ee;t:for(var xe=0,it=Dt.length,Tt=it>>>1;xe<Tt;){var Lt=2*(xe+1)-1,Ut=Dt[Lt],Zt=Lt+1,Kt=Dt[Zt];if(0>n(Ut,ee))Zt<it&&0>n(Kt,Ut)?(Dt[xe]=Kt,Dt[Zt]=ee,xe=Zt):(Dt[xe]=Ut,Dt[Lt]=ee,xe=Lt);else if(Zt<it&&0>n(Kt,ee))Dt[xe]=Kt,Dt[Zt]=ee,xe=Zt;else break t}}return Qt}function n(Dt,Qt){var ee=Dt.sortIndex-Qt.sortIndex;return ee!==0?ee:Dt.id-Qt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var f=[],m=[],w=1,A=null,P=3,I=!1,N=!1,F=!1,Z=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,z=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function J(Dt){for(var Qt=r(m);Qt!==null;){if(Qt.callback===null)i(m);else if(Qt.startTime<=Dt)i(m),Qt.sortIndex=Qt.expirationTime,t(f,Qt);else break;Qt=r(m)}}function nt(Dt){if(F=!1,J(Dt),!N)if(r(f)!==null)N=!0,oe(mt);else{var Qt=r(m);Qt!==null&&he(nt,Qt.startTime-Dt)}}function mt(Dt,Qt){N=!1,F&&(F=!1,U(pt),pt=-1),I=!0;var ee=P;try{for(J(Qt),A=r(f);A!==null&&(!(A.expirationTime>Qt)||Dt&&!at());){var xe=A.callback;if(typeof xe=="function"){A.callback=null,P=A.priorityLevel;var it=xe(A.expirationTime<=Qt);Qt=e.unstable_now(),typeof it=="function"?A.callback=it:A===r(f)&&i(f),J(Qt)}else i(f);A=r(f)}if(A!==null)var Tt=!0;else{var Lt=r(m);Lt!==null&&he(nt,Lt.startTime-Qt),Tt=!1}return Tt}finally{A=null,P=ee,I=!1}}var Et=!1,bt=null,pt=-1,zt=5,Rt=-1;function at(){return!(e.unstable_now()-Rt<zt)}function dt(){if(bt!==null){var Dt=e.unstable_now();Rt=Dt;var Qt=!0;try{Qt=bt(!0,Dt)}finally{Qt?kt():(Et=!1,bt=null)}}else Et=!1}var kt;if(typeof z=="function")kt=function(){z(dt)};else if(typeof MessageChannel<"u"){var xt=new MessageChannel,ue=xt.port2;xt.port1.onmessage=dt,kt=function(){ue.postMessage(null)}}else kt=function(){Z(dt,0)};function oe(Dt){bt=Dt,Et||(Et=!0,kt())}function he(Dt,Qt){pt=Z(function(){Dt(e.unstable_now())},Qt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Dt){Dt.callback=null},e.unstable_continueExecution=function(){N||I||(N=!0,oe(mt))},e.unstable_forceFrameRate=function(Dt){0>Dt||125<Dt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):zt=0<Dt?Math.floor(1e3/Dt):5},e.unstable_getCurrentPriorityLevel=function(){return P},e.unstable_getFirstCallbackNode=function(){return r(f)},e.unstable_next=function(Dt){switch(P){case 1:case 2:case 3:var Qt=3;break;default:Qt=P}var ee=P;P=Qt;try{return Dt()}finally{P=ee}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Dt,Qt){switch(Dt){case 1:case 2:case 3:case 4:case 5:break;default:Dt=3}var ee=P;P=Dt;try{return Qt()}finally{P=ee}},e.unstable_scheduleCallback=function(Dt,Qt,ee){var xe=e.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?xe+ee:xe):ee=xe,Dt){case 1:var it=-1;break;case 2:it=250;break;case 5:it=1073741823;break;case 4:it=1e4;break;default:it=5e3}return it=ee+it,Dt={id:w++,callback:Qt,priorityLevel:Dt,startTime:ee,expirationTime:it,sortIndex:-1},ee>xe?(Dt.sortIndex=ee,t(m,Dt),r(f)===null&&Dt===r(m)&&(F?(U(pt),pt=-1):F=!0,he(nt,ee-xe))):(Dt.sortIndex=it,t(f,Dt),N||I||(N=!0,oe(mt))),Dt},e.unstable_shouldYield=at,e.unstable_wrapCallback=function(Dt){var Qt=P;return function(){var ee=P;P=Qt;try{return Dt.apply(this,arguments)}finally{P=ee}}}})(A4);x4.exports=A4;var b8=x4.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var w8=af,Ja=b8;function Oe(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var S4=new Set,Vm={};function If(e,t){Yp(e,t),Yp(e+"Capture",t)}function Yp(e,t){for(Vm[e]=t,e=0;e<t.length;e++)S4.add(t[e])}var ah=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),X2=Object.prototype.hasOwnProperty,x8=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,q3={},H3={};function A8(e){return X2.call(H3,e)?!0:X2.call(q3,e)?!1:x8.test(e)?H3[e]=!0:(q3[e]=!0,!1)}function S8(e,t,r,i){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function E8(e,t,r,i){if(t===null||typeof t>"u"||S8(e,t,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Qo(e,t,r,i,n,s,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=i,this.attributeNamespace=n,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var to={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){to[e]=new Qo(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];to[t]=new Qo(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){to[e]=new Qo(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){to[e]=new Qo(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){to[e]=new Qo(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){to[e]=new Qo(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){to[e]=new Qo(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){to[e]=new Qo(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){to[e]=new Qo(e,5,!1,e.toLowerCase(),null,!1,!1)});var n5=/[\-:]([a-z])/g;function s5(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(n5,s5);to[t]=new Qo(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(n5,s5);to[t]=new Qo(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(n5,s5);to[t]=new Qo(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){to[e]=new Qo(e,1,!1,e.toLowerCase(),null,!1,!1)});to.xlinkHref=new Qo("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){to[e]=new Qo(e,1,!1,e.toLowerCase(),null,!0,!0)});function o5(e,t,r,i){var n=to.hasOwnProperty(t)?to[t]:null;(n!==null?n.type!==0:i||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(E8(t,r,n,i)&&(r=null),i||n===null?A8(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):n.mustUseProperty?e[n.propertyName]=r===null?n.type===3?!1:"":r:(t=n.attributeName,i=n.attributeNamespace,r===null?e.removeAttribute(t):(n=n.type,r=n===3||n===4&&r===!0?"":""+r,i?e.setAttributeNS(i,t,r):e.setAttribute(t,r))))}var gh=w8.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,d1=Symbol.for("react.element"),yp=Symbol.for("react.portal"),_p=Symbol.for("react.fragment"),a5=Symbol.for("react.strict_mode"),K2=Symbol.for("react.profiler"),E4=Symbol.for("react.provider"),C4=Symbol.for("react.context"),l5=Symbol.for("react.forward_ref"),Y2=Symbol.for("react.suspense"),Q2=Symbol.for("react.suspense_list"),c5=Symbol.for("react.memo"),Yh=Symbol.for("react.lazy"),T4=Symbol.for("react.offscreen"),W3=Symbol.iterator;function Hg(e){return e===null||typeof e!="object"?null:(e=W3&&e[W3]||e["@@iterator"],typeof e=="function"?e:null)}var Rn=Object.assign,ob;function ym(e){if(ob===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);ob=t&&t[1]||""}return`
`+ob+e}var ab=!1;function lb(e,t){if(!e||ab)return"";ab=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(m){var i=m}Reflect.construct(e,[],t)}else{try{t.call()}catch(m){i=m}e.call(t.prototype)}else{try{throw Error()}catch(m){i=m}e()}}catch(m){if(m&&i&&typeof m.stack=="string"){for(var n=m.stack.split(`
`),s=i.stack.split(`
`),a=n.length-1,o=s.length-1;1<=a&&0<=o&&n[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(n[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||n[a]!==s[o]){var f=`
`+n[a].replace(" at new "," at ");return e.displayName&&f.includes("<anonymous>")&&(f=f.replace("<anonymous>",e.displayName)),f}while(1<=a&&0<=o);break}}}finally{ab=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?ym(e):""}function C8(e){switch(e.tag){case 5:return ym(e.type);case 16:return ym("Lazy");case 13:return ym("Suspense");case 19:return ym("SuspenseList");case 0:case 2:case 15:return e=lb(e.type,!1),e;case 11:return e=lb(e.type.render,!1),e;case 1:return e=lb(e.type,!0),e;default:return""}}function tw(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case _p:return"Fragment";case yp:return"Portal";case K2:return"Profiler";case a5:return"StrictMode";case Y2:return"Suspense";case Q2:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case C4:return(e.displayName||"Context")+".Consumer";case E4:return(e._context.displayName||"Context")+".Provider";case l5:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case c5:return t=e.displayName||null,t!==null?t:tw(e.type)||"Memo";case Yh:t=e._payload,e=e._init;try{return tw(e(t))}catch{}}return null}function T8(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return tw(t);case 8:return t===a5?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function _d(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function P4(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function P8(e){var t=P4(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var n=r.get,s=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(a){i=""+a,s.call(this,a)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(a){i=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function f1(e){e._valueTracker||(e._valueTracker=P8(e))}function I4(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),i="";return e&&(i=P4(e)?e.checked?"true":"false":e.value),e=i,e!==r?(t.setValue(e),!0):!1}function zy(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function ew(e,t){var r=t.checked;return Rn({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function $3(e,t){var r=t.defaultValue==null?"":t.defaultValue,i=t.checked!=null?t.checked:t.defaultChecked;r=_d(t.value!=null?t.value:r),e._wrapperState={initialChecked:i,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function M4(e,t){t=t.checked,t!=null&&o5(e,"checked",t,!1)}function rw(e,t){M4(e,t);var r=_d(t.value),i=t.type;if(r!=null)i==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(i==="submit"||i==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?iw(e,t.type,r):t.hasOwnProperty("defaultValue")&&iw(e,t.type,_d(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Z3(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!(i!=="submit"&&i!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function iw(e,t,r){(t!=="number"||zy(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var _m=Array.isArray;function Op(e,t,r,i){if(e=e.options,t){t={};for(var n=0;n<r.length;n++)t["$"+r[n]]=!0;for(r=0;r<e.length;r++)n=t.hasOwnProperty("$"+e[r].value),e[r].selected!==n&&(e[r].selected=n),n&&i&&(e[r].defaultSelected=!0)}else{for(r=""+_d(r),t=null,n=0;n<e.length;n++){if(e[n].value===r){e[n].selected=!0,i&&(e[n].defaultSelected=!0);return}t!==null||e[n].disabled||(t=e[n])}t!==null&&(t.selected=!0)}}function nw(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Oe(91));return Rn({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function J3(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Oe(92));if(_m(r)){if(1<r.length)throw Error(Oe(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:_d(r)}}function L4(e,t){var r=_d(t.value),i=_d(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),i!=null&&(e.defaultValue=""+i)}function X3(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function B4(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function sw(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?B4(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var p1,k4=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,i,n){MSApp.execUnsafeLocalFunction(function(){return e(t,r,i,n)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(p1=p1||document.createElement("div"),p1.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=p1.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function qm(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Em={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},I8=["Webkit","ms","Moz","O"];Object.keys(Em).forEach(function(e){I8.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Em[t]=Em[e]})});function R4(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Em.hasOwnProperty(e)&&Em[e]?(""+t).trim():t+"px"}function O4(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var i=r.indexOf("--")===0,n=R4(r,t[r],i);r==="float"&&(r="cssFloat"),i?e.setProperty(r,n):e[r]=n}}var M8=Rn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ow(e,t){if(t){if(M8[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Oe(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Oe(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Oe(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Oe(62))}}function aw(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lw=null;function u5(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var cw=null,Dp=null,Np=null;function K3(e){if(e=A0(e)){if(typeof cw!="function")throw Error(Oe(280));var t=e.stateNode;t&&(t=j_(t),cw(e.stateNode,e.type,t))}}function D4(e){Dp?Np?Np.push(e):Np=[e]:Dp=e}function N4(){if(Dp){var e=Dp,t=Np;if(Np=Dp=null,K3(e),t)for(e=0;e<t.length;e++)K3(t[e])}}function F4(e,t){return e(t)}function z4(){}var cb=!1;function j4(e,t,r){if(cb)return e(t,r);cb=!0;try{return F4(e,t,r)}finally{cb=!1,(Dp!==null||Np!==null)&&(z4(),N4())}}function Hm(e,t){var r=e.stateNode;if(r===null)return null;var i=j_(r);if(i===null)return null;r=i[t];t:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break t;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Oe(231,t,typeof r));return r}var uw=!1;if(ah)try{var Wg={};Object.defineProperty(Wg,"passive",{get:function(){uw=!0}}),window.addEventListener("test",Wg,Wg),window.removeEventListener("test",Wg,Wg)}catch{uw=!1}function L8(e,t,r,i,n,s,a,o,f){var m=Array.prototype.slice.call(arguments,3);try{t.apply(r,m)}catch(w){this.onError(w)}}var Cm=!1,jy=null,Uy=!1,hw=null,B8={onError:function(e){Cm=!0,jy=e}};function k8(e,t,r,i,n,s,a,o,f){Cm=!1,jy=null,L8.apply(B8,arguments)}function R8(e,t,r,i,n,s,a,o,f){if(k8.apply(this,arguments),Cm){if(Cm){var m=jy;Cm=!1,jy=null}else throw Error(Oe(198));Uy||(Uy=!0,hw=m)}}function Mf(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function U4(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Y3(e){if(Mf(e)!==e)throw Error(Oe(188))}function O8(e){var t=e.alternate;if(!t){if(t=Mf(e),t===null)throw Error(Oe(188));return t!==e?null:e}for(var r=e,i=t;;){var n=r.return;if(n===null)break;var s=n.alternate;if(s===null){if(i=n.return,i!==null){r=i;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===r)return Y3(n),e;if(s===i)return Y3(n),t;s=s.sibling}throw Error(Oe(188))}if(r.return!==i.return)r=n,i=s;else{for(var a=!1,o=n.child;o;){if(o===r){a=!0,r=n,i=s;break}if(o===i){a=!0,i=n,r=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===r){a=!0,r=s,i=n;break}if(o===i){a=!0,i=s,r=n;break}o=o.sibling}if(!a)throw Error(Oe(189))}}if(r.alternate!==i)throw Error(Oe(190))}if(r.tag!==3)throw Error(Oe(188));return r.stateNode.current===r?e:t}function G4(e){return e=O8(e),e!==null?V4(e):null}function V4(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=V4(e);if(t!==null)return t;e=e.sibling}return null}var q4=Ja.unstable_scheduleCallback,Q3=Ja.unstable_cancelCallback,D8=Ja.unstable_shouldYield,N8=Ja.unstable_requestPaint,ns=Ja.unstable_now,F8=Ja.unstable_getCurrentPriorityLevel,h5=Ja.unstable_ImmediatePriority,H4=Ja.unstable_UserBlockingPriority,Gy=Ja.unstable_NormalPriority,z8=Ja.unstable_LowPriority,W4=Ja.unstable_IdlePriority,D_=null,pu=null;function j8(e){if(pu&&typeof pu.onCommitFiberRoot=="function")try{pu.onCommitFiberRoot(D_,e,void 0,(e.current.flags&128)===128)}catch{}}var Ec=Math.clz32?Math.clz32:V8,U8=Math.log,G8=Math.LN2;function V8(e){return e>>>=0,e===0?32:31-(U8(e)/G8|0)|0}var g1=64,m1=4194304;function vm(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Vy(e,t){var r=e.pendingLanes;if(r===0)return 0;var i=0,n=e.suspendedLanes,s=e.pingedLanes,a=r&268435455;if(a!==0){var o=a&~n;o!==0?i=vm(o):(s&=a,s!==0&&(i=vm(s)))}else a=r&~n,a!==0?i=vm(a):s!==0&&(i=vm(s));if(i===0)return 0;if(t!==0&&t!==i&&!(t&n)&&(n=i&-i,s=t&-t,n>=s||n===16&&(s&4194240)!==0))return t;if(i&4&&(i|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=i;0<t;)r=31-Ec(t),n=1<<r,i|=e[r],t&=~n;return i}function q8(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function H8(e,t){for(var r=e.suspendedLanes,i=e.pingedLanes,n=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-Ec(s),o=1<<a,f=n[a];f===-1?(!(o&r)||o&i)&&(n[a]=q8(o,t)):f<=t&&(e.expiredLanes|=o),s&=~o}}function dw(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function $4(){var e=g1;return g1<<=1,!(g1&4194240)&&(g1=64),e}function ub(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function w0(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Ec(t),e[t]=r}function W8(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<r;){var n=31-Ec(r),s=1<<n;t[n]=0,i[n]=-1,e[n]=-1,r&=~s}}function d5(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var i=31-Ec(r),n=1<<i;n&t|e[i]&t&&(e[i]|=t),r&=~n}}var Vi=0;function Z4(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var J4,f5,X4,K4,Y4,fw=!1,y1=[],ld=null,cd=null,ud=null,Wm=new Map,$m=new Map,ed=[],$8="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function tE(e,t){switch(e){case"focusin":case"focusout":ld=null;break;case"dragenter":case"dragleave":cd=null;break;case"mouseover":case"mouseout":ud=null;break;case"pointerover":case"pointerout":Wm.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":$m.delete(t.pointerId)}}function $g(e,t,r,i,n,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:r,eventSystemFlags:i,nativeEvent:s,targetContainers:[n]},t!==null&&(t=A0(t),t!==null&&f5(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,n!==null&&t.indexOf(n)===-1&&t.push(n),e)}function Z8(e,t,r,i,n){switch(t){case"focusin":return ld=$g(ld,e,t,r,i,n),!0;case"dragenter":return cd=$g(cd,e,t,r,i,n),!0;case"mouseover":return ud=$g(ud,e,t,r,i,n),!0;case"pointerover":var s=n.pointerId;return Wm.set(s,$g(Wm.get(s)||null,e,t,r,i,n)),!0;case"gotpointercapture":return s=n.pointerId,$m.set(s,$g($m.get(s)||null,e,t,r,i,n)),!0}return!1}function Q4(e){var t=lf(e.target);if(t!==null){var r=Mf(t);if(r!==null){if(t=r.tag,t===13){if(t=U4(r),t!==null){e.blockedOn=t,Y4(e.priority,function(){X4(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function cy(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=pw(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var i=new r.constructor(r.type,r);lw=i,r.target.dispatchEvent(i),lw=null}else return t=A0(r),t!==null&&f5(t),e.blockedOn=r,!1;t.shift()}return!0}function eE(e,t,r){cy(e)&&r.delete(t)}function J8(){fw=!1,ld!==null&&cy(ld)&&(ld=null),cd!==null&&cy(cd)&&(cd=null),ud!==null&&cy(ud)&&(ud=null),Wm.forEach(eE),$m.forEach(eE)}function Zg(e,t){e.blockedOn===t&&(e.blockedOn=null,fw||(fw=!0,Ja.unstable_scheduleCallback(Ja.unstable_NormalPriority,J8)))}function Zm(e){function t(n){return Zg(n,e)}if(0<y1.length){Zg(y1[0],e);for(var r=1;r<y1.length;r++){var i=y1[r];i.blockedOn===e&&(i.blockedOn=null)}}for(ld!==null&&Zg(ld,e),cd!==null&&Zg(cd,e),ud!==null&&Zg(ud,e),Wm.forEach(t),$m.forEach(t),r=0;r<ed.length;r++)i=ed[r],i.blockedOn===e&&(i.blockedOn=null);for(;0<ed.length&&(r=ed[0],r.blockedOn===null);)Q4(r),r.blockedOn===null&&ed.shift()}var Fp=gh.ReactCurrentBatchConfig,qy=!0;function X8(e,t,r,i){var n=Vi,s=Fp.transition;Fp.transition=null;try{Vi=1,p5(e,t,r,i)}finally{Vi=n,Fp.transition=s}}function K8(e,t,r,i){var n=Vi,s=Fp.transition;Fp.transition=null;try{Vi=4,p5(e,t,r,i)}finally{Vi=n,Fp.transition=s}}function p5(e,t,r,i){if(qy){var n=pw(e,t,r,i);if(n===null)bb(e,t,i,Hy,r),tE(e,i);else if(Z8(n,e,t,r,i))i.stopPropagation();else if(tE(e,i),t&4&&-1<$8.indexOf(e)){for(;n!==null;){var s=A0(n);if(s!==null&&J4(s),s=pw(e,t,r,i),s===null&&bb(e,t,i,Hy,r),s===n)break;n=s}n!==null&&i.stopPropagation()}else bb(e,t,i,null,r)}}var Hy=null;function pw(e,t,r,i){if(Hy=null,e=u5(i),e=lf(e),e!==null)if(t=Mf(e),t===null)e=null;else if(r=t.tag,r===13){if(e=U4(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Hy=e,null}function tM(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(F8()){case h5:return 1;case H4:return 4;case Gy:case z8:return 16;case W4:return 536870912;default:return 16}default:return 16}}var id=null,g5=null,uy=null;function eM(){if(uy)return uy;var e,t=g5,r=t.length,i,n="value"in id?id.value:id.textContent,s=n.length;for(e=0;e<r&&t[e]===n[e];e++);var a=r-e;for(i=1;i<=a&&t[r-i]===n[s-i];i++);return uy=n.slice(e,1<i?1-i:void 0)}function hy(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function _1(){return!0}function rE(){return!1}function Ya(e){function t(r,i,n,s,a){this._reactName=r,this._targetInst=n,this.type=i,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(r=e[o],this[o]=r?r(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?_1:rE,this.isPropagationStopped=rE,this}return Rn(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=_1)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=_1)},persist:function(){},isPersistent:_1}),t}var _g={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},m5=Ya(_g),x0=Rn({},_g,{view:0,detail:0}),Y8=Ya(x0),hb,db,Jg,N_=Rn({},x0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:y5,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Jg&&(Jg&&e.type==="mousemove"?(hb=e.screenX-Jg.screenX,db=e.screenY-Jg.screenY):db=hb=0,Jg=e),hb)},movementY:function(e){return"movementY"in e?e.movementY:db}}),iE=Ya(N_),Q8=Rn({},N_,{dataTransfer:0}),tD=Ya(Q8),eD=Rn({},x0,{relatedTarget:0}),fb=Ya(eD),rD=Rn({},_g,{animationName:0,elapsedTime:0,pseudoElement:0}),iD=Ya(rD),nD=Rn({},_g,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),sD=Ya(nD),oD=Rn({},_g,{data:0}),nE=Ya(oD),aD={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lD={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cD={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function uD(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=cD[e])?!!t[e]:!1}function y5(){return uD}var hD=Rn({},x0,{key:function(e){if(e.key){var t=aD[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=hy(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?lD[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:y5,charCode:function(e){return e.type==="keypress"?hy(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?hy(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),dD=Ya(hD),fD=Rn({},N_,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sE=Ya(fD),pD=Rn({},x0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:y5}),gD=Ya(pD),mD=Rn({},_g,{propertyName:0,elapsedTime:0,pseudoElement:0}),yD=Ya(mD),_D=Rn({},N_,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),vD=Ya(_D),bD=[9,13,27,32],_5=ah&&"CompositionEvent"in window,Tm=null;ah&&"documentMode"in document&&(Tm=document.documentMode);var wD=ah&&"TextEvent"in window&&!Tm,rM=ah&&(!_5||Tm&&8<Tm&&11>=Tm),oE=String.fromCharCode(32),aE=!1;function iM(e,t){switch(e){case"keyup":return bD.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function nM(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var vp=!1;function xD(e,t){switch(e){case"compositionend":return nM(t);case"keypress":return t.which!==32?null:(aE=!0,oE);case"textInput":return e=t.data,e===oE&&aE?null:e;default:return null}}function AD(e,t){if(vp)return e==="compositionend"||!_5&&iM(e,t)?(e=eM(),uy=g5=id=null,vp=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return rM&&t.locale!=="ko"?null:t.data;default:return null}}var SD={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function lE(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!SD[e.type]:t==="textarea"}function sM(e,t,r,i){D4(i),t=Wy(t,"onChange"),0<t.length&&(r=new m5("onChange","change",null,r,i),e.push({event:r,listeners:t}))}var Pm=null,Jm=null;function ED(e){mM(e,0)}function F_(e){var t=xp(e);if(I4(t))return e}function CD(e,t){if(e==="change")return t}var oM=!1;if(ah){var pb;if(ah){var gb="oninput"in document;if(!gb){var cE=document.createElement("div");cE.setAttribute("oninput","return;"),gb=typeof cE.oninput=="function"}pb=gb}else pb=!1;oM=pb&&(!document.documentMode||9<document.documentMode)}function uE(){Pm&&(Pm.detachEvent("onpropertychange",aM),Jm=Pm=null)}function aM(e){if(e.propertyName==="value"&&F_(Jm)){var t=[];sM(t,Jm,e,u5(e)),j4(ED,t)}}function TD(e,t,r){e==="focusin"?(uE(),Pm=t,Jm=r,Pm.attachEvent("onpropertychange",aM)):e==="focusout"&&uE()}function PD(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return F_(Jm)}function ID(e,t){if(e==="click")return F_(t)}function MD(e,t){if(e==="input"||e==="change")return F_(t)}function LD(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Ic=typeof Object.is=="function"?Object.is:LD;function Xm(e,t){if(Ic(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var n=r[i];if(!X2.call(t,n)||!Ic(e[n],t[n]))return!1}return!0}function hE(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dE(e,t){var r=hE(e);e=0;for(var i;r;){if(r.nodeType===3){if(i=e+r.textContent.length,e<=t&&i>=t)return{node:r,offset:t-e};e=i}t:{for(;r;){if(r.nextSibling){r=r.nextSibling;break t}r=r.parentNode}r=void 0}r=hE(r)}}function lM(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?lM(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function cM(){for(var e=window,t=zy();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=zy(e.document)}return t}function v5(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function BD(e){var t=cM(),r=e.focusedElem,i=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&lM(r.ownerDocument.documentElement,r)){if(i!==null&&v5(r)){if(t=i.start,e=i.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var n=r.textContent.length,s=Math.min(i.start,n);i=i.end===void 0?s:Math.min(i.end,n),!e.extend&&s>i&&(n=i,i=s,s=n),n=dE(r,s);var a=dE(r,i);n&&a&&(e.rangeCount!==1||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(n.node,n.offset),e.removeAllRanges(),s>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var kD=ah&&"documentMode"in document&&11>=document.documentMode,bp=null,gw=null,Im=null,mw=!1;function fE(e,t,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;mw||bp==null||bp!==zy(i)||(i=bp,"selectionStart"in i&&v5(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Im&&Xm(Im,i)||(Im=i,i=Wy(gw,"onSelect"),0<i.length&&(t=new m5("onSelect","select",null,t,r),e.push({event:t,listeners:i}),t.target=bp)))}function v1(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var wp={animationend:v1("Animation","AnimationEnd"),animationiteration:v1("Animation","AnimationIteration"),animationstart:v1("Animation","AnimationStart"),transitionend:v1("Transition","TransitionEnd")},mb={},uM={};ah&&(uM=document.createElement("div").style,"AnimationEvent"in window||(delete wp.animationend.animation,delete wp.animationiteration.animation,delete wp.animationstart.animation),"TransitionEvent"in window||delete wp.transitionend.transition);function z_(e){if(mb[e])return mb[e];if(!wp[e])return e;var t=wp[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in uM)return mb[e]=t[r];return e}var hM=z_("animationend"),dM=z_("animationiteration"),fM=z_("animationstart"),pM=z_("transitionend"),gM=new Map,pE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ed(e,t){gM.set(e,t),If(t,[e])}for(var yb=0;yb<pE.length;yb++){var _b=pE[yb],RD=_b.toLowerCase(),OD=_b[0].toUpperCase()+_b.slice(1);Ed(RD,"on"+OD)}Ed(hM,"onAnimationEnd");Ed(dM,"onAnimationIteration");Ed(fM,"onAnimationStart");Ed("dblclick","onDoubleClick");Ed("focusin","onFocus");Ed("focusout","onBlur");Ed(pM,"onTransitionEnd");Yp("onMouseEnter",["mouseout","mouseover"]);Yp("onMouseLeave",["mouseout","mouseover"]);Yp("onPointerEnter",["pointerout","pointerover"]);Yp("onPointerLeave",["pointerout","pointerover"]);If("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));If("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));If("onBeforeInput",["compositionend","keypress","textInput","paste"]);If("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));If("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));If("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var bm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),DD=new Set("cancel close invalid load scroll toggle".split(" ").concat(bm));function gE(e,t,r){var i=e.type||"unknown-event";e.currentTarget=r,R8(i,t,void 0,e),e.currentTarget=null}function mM(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var i=e[r],n=i.event;i=i.listeners;t:{var s=void 0;if(t)for(var a=i.length-1;0<=a;a--){var o=i[a],f=o.instance,m=o.currentTarget;if(o=o.listener,f!==s&&n.isPropagationStopped())break t;gE(n,o,m),s=f}else for(a=0;a<i.length;a++){if(o=i[a],f=o.instance,m=o.currentTarget,o=o.listener,f!==s&&n.isPropagationStopped())break t;gE(n,o,m),s=f}}}if(Uy)throw e=hw,Uy=!1,hw=null,e}function mn(e,t){var r=t[ww];r===void 0&&(r=t[ww]=new Set);var i=e+"__bubble";r.has(i)||(yM(t,e,2,!1),r.add(i))}function vb(e,t,r){var i=0;t&&(i|=4),yM(r,e,i,t)}var b1="_reactListening"+Math.random().toString(36).slice(2);function Km(e){if(!e[b1]){e[b1]=!0,S4.forEach(function(r){r!=="selectionchange"&&(DD.has(r)||vb(r,!1,e),vb(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[b1]||(t[b1]=!0,vb("selectionchange",!1,t))}}function yM(e,t,r,i){switch(tM(t)){case 1:var n=X8;break;case 4:n=K8;break;default:n=p5}r=n.bind(null,t,r,e),n=void 0,!uw||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(n=!0),i?n!==void 0?e.addEventListener(t,r,{capture:!0,passive:n}):e.addEventListener(t,r,!0):n!==void 0?e.addEventListener(t,r,{passive:n}):e.addEventListener(t,r,!1)}function bb(e,t,r,i,n){var s=i;if(!(t&1)&&!(t&2)&&i!==null)t:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var o=i.stateNode.containerInfo;if(o===n||o.nodeType===8&&o.parentNode===n)break;if(a===4)for(a=i.return;a!==null;){var f=a.tag;if((f===3||f===4)&&(f=a.stateNode.containerInfo,f===n||f.nodeType===8&&f.parentNode===n))return;a=a.return}for(;o!==null;){if(a=lf(o),a===null)return;if(f=a.tag,f===5||f===6){i=s=a;continue t}o=o.parentNode}}i=i.return}j4(function(){var m=s,w=u5(r),A=[];t:{var P=gM.get(e);if(P!==void 0){var I=m5,N=e;switch(e){case"keypress":if(hy(r)===0)break t;case"keydown":case"keyup":I=dD;break;case"focusin":N="focus",I=fb;break;case"focusout":N="blur",I=fb;break;case"beforeblur":case"afterblur":I=fb;break;case"click":if(r.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":I=iE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":I=tD;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":I=gD;break;case hM:case dM:case fM:I=iD;break;case pM:I=yD;break;case"scroll":I=Y8;break;case"wheel":I=vD;break;case"copy":case"cut":case"paste":I=sD;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":I=sE}var F=(t&4)!==0,Z=!F&&e==="scroll",U=F?P!==null?P+"Capture":null:P;F=[];for(var z=m,J;z!==null;){J=z;var nt=J.stateNode;if(J.tag===5&&nt!==null&&(J=nt,U!==null&&(nt=Hm(z,U),nt!=null&&F.push(Ym(z,nt,J)))),Z)break;z=z.return}0<F.length&&(P=new I(P,N,null,r,w),A.push({event:P,listeners:F}))}}if(!(t&7)){t:{if(P=e==="mouseover"||e==="pointerover",I=e==="mouseout"||e==="pointerout",P&&r!==lw&&(N=r.relatedTarget||r.fromElement)&&(lf(N)||N[lh]))break t;if((I||P)&&(P=w.window===w?w:(P=w.ownerDocument)?P.defaultView||P.parentWindow:window,I?(N=r.relatedTarget||r.toElement,I=m,N=N?lf(N):null,N!==null&&(Z=Mf(N),N!==Z||N.tag!==5&&N.tag!==6)&&(N=null)):(I=null,N=m),I!==N)){if(F=iE,nt="onMouseLeave",U="onMouseEnter",z="mouse",(e==="pointerout"||e==="pointerover")&&(F=sE,nt="onPointerLeave",U="onPointerEnter",z="pointer"),Z=I==null?P:xp(I),J=N==null?P:xp(N),P=new F(nt,z+"leave",I,r,w),P.target=Z,P.relatedTarget=J,nt=null,lf(w)===m&&(F=new F(U,z+"enter",N,r,w),F.target=J,F.relatedTarget=Z,nt=F),Z=nt,I&&N)e:{for(F=I,U=N,z=0,J=F;J;J=Qf(J))z++;for(J=0,nt=U;nt;nt=Qf(nt))J++;for(;0<z-J;)F=Qf(F),z--;for(;0<J-z;)U=Qf(U),J--;for(;z--;){if(F===U||U!==null&&F===U.alternate)break e;F=Qf(F),U=Qf(U)}F=null}else F=null;I!==null&&mE(A,P,I,F,!1),N!==null&&Z!==null&&mE(A,Z,N,F,!0)}}t:{if(P=m?xp(m):window,I=P.nodeName&&P.nodeName.toLowerCase(),I==="select"||I==="input"&&P.type==="file")var mt=CD;else if(lE(P))if(oM)mt=MD;else{mt=PD;var Et=TD}else(I=P.nodeName)&&I.toLowerCase()==="input"&&(P.type==="checkbox"||P.type==="radio")&&(mt=ID);if(mt&&(mt=mt(e,m))){sM(A,mt,r,w);break t}Et&&Et(e,P,m),e==="focusout"&&(Et=P._wrapperState)&&Et.controlled&&P.type==="number"&&iw(P,"number",P.value)}switch(Et=m?xp(m):window,e){case"focusin":(lE(Et)||Et.contentEditable==="true")&&(bp=Et,gw=m,Im=null);break;case"focusout":Im=gw=bp=null;break;case"mousedown":mw=!0;break;case"contextmenu":case"mouseup":case"dragend":mw=!1,fE(A,r,w);break;case"selectionchange":if(kD)break;case"keydown":case"keyup":fE(A,r,w)}var bt;if(_5)t:{switch(e){case"compositionstart":var pt="onCompositionStart";break t;case"compositionend":pt="onCompositionEnd";break t;case"compositionupdate":pt="onCompositionUpdate";break t}pt=void 0}else vp?iM(e,r)&&(pt="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(pt="onCompositionStart");pt&&(rM&&r.locale!=="ko"&&(vp||pt!=="onCompositionStart"?pt==="onCompositionEnd"&&vp&&(bt=eM()):(id=w,g5="value"in id?id.value:id.textContent,vp=!0)),Et=Wy(m,pt),0<Et.length&&(pt=new nE(pt,e,null,r,w),A.push({event:pt,listeners:Et}),bt?pt.data=bt:(bt=nM(r),bt!==null&&(pt.data=bt)))),(bt=wD?xD(e,r):AD(e,r))&&(m=Wy(m,"onBeforeInput"),0<m.length&&(w=new nE("onBeforeInput","beforeinput",null,r,w),A.push({event:w,listeners:m}),w.data=bt))}mM(A,t)})}function Ym(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Wy(e,t){for(var r=t+"Capture",i=[];e!==null;){var n=e,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=Hm(e,r),s!=null&&i.unshift(Ym(e,s,n)),s=Hm(e,t),s!=null&&i.push(Ym(e,s,n))),e=e.return}return i}function Qf(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function mE(e,t,r,i,n){for(var s=t._reactName,a=[];r!==null&&r!==i;){var o=r,f=o.alternate,m=o.stateNode;if(f!==null&&f===i)break;o.tag===5&&m!==null&&(o=m,n?(f=Hm(r,s),f!=null&&a.unshift(Ym(r,f,o))):n||(f=Hm(r,s),f!=null&&a.push(Ym(r,f,o)))),r=r.return}a.length!==0&&e.push({event:t,listeners:a})}var ND=/\r\n?/g,FD=/\u0000|\uFFFD/g;function yE(e){return(typeof e=="string"?e:""+e).replace(ND,`
`).replace(FD,"")}function w1(e,t,r){if(t=yE(t),yE(e)!==t&&r)throw Error(Oe(425))}function $y(){}var yw=null,_w=null;function vw(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var bw=typeof setTimeout=="function"?setTimeout:void 0,zD=typeof clearTimeout=="function"?clearTimeout:void 0,_E=typeof Promise=="function"?Promise:void 0,jD=typeof queueMicrotask=="function"?queueMicrotask:typeof _E<"u"?function(e){return _E.resolve(null).then(e).catch(UD)}:bw;function UD(e){setTimeout(function(){throw e})}function wb(e,t){var r=t,i=0;do{var n=r.nextSibling;if(e.removeChild(r),n&&n.nodeType===8)if(r=n.data,r==="/$"){if(i===0){e.removeChild(n),Zm(t);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=n}while(r);Zm(t)}function hd(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function vE(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var vg=Math.random().toString(36).slice(2),ou="__reactFiber$"+vg,Qm="__reactProps$"+vg,lh="__reactContainer$"+vg,ww="__reactEvents$"+vg,GD="__reactListeners$"+vg,VD="__reactHandles$"+vg;function lf(e){var t=e[ou];if(t)return t;for(var r=e.parentNode;r;){if(t=r[lh]||r[ou]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=vE(e);e!==null;){if(r=e[ou])return r;e=vE(e)}return t}e=r,r=e.parentNode}return null}function A0(e){return e=e[ou]||e[lh],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function xp(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Oe(33))}function j_(e){return e[Qm]||null}var xw=[],Ap=-1;function Cd(e){return{current:e}}function _n(e){0>Ap||(e.current=xw[Ap],xw[Ap]=null,Ap--)}function cn(e,t){Ap++,xw[Ap]=e.current,e.current=t}var vd={},So=Cd(vd),_a=Cd(!1),bf=vd;function Qp(e,t){var r=e.type.contextTypes;if(!r)return vd;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in r)n[s]=t[s];return i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=n),n}function va(e){return e=e.childContextTypes,e!=null}function Zy(){_n(_a),_n(So)}function bE(e,t,r){if(So.current!==vd)throw Error(Oe(168));cn(So,t),cn(_a,r)}function _M(e,t,r){var i=e.stateNode;if(t=t.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var n in i)if(!(n in t))throw Error(Oe(108,T8(e)||"Unknown",n));return Rn({},r,i)}function Jy(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||vd,bf=So.current,cn(So,e),cn(_a,_a.current),!0}function wE(e,t,r){var i=e.stateNode;if(!i)throw Error(Oe(169));r?(e=_M(e,t,bf),i.__reactInternalMemoizedMergedChildContext=e,_n(_a),_n(So),cn(So,e)):_n(_a),cn(_a,r)}var Zu=null,U_=!1,xb=!1;function vM(e){Zu===null?Zu=[e]:Zu.push(e)}function qD(e){U_=!0,vM(e)}function Td(){if(!xb&&Zu!==null){xb=!0;var e=0,t=Vi;try{var r=Zu;for(Vi=1;e<r.length;e++){var i=r[e];do i=i(!0);while(i!==null)}Zu=null,U_=!1}catch(n){throw Zu!==null&&(Zu=Zu.slice(e+1)),q4(h5,Td),n}finally{Vi=t,xb=!1}}return null}var Sp=[],Ep=0,Xy=null,Ky=0,Cl=[],Tl=0,wf=null,Ku=1,Yu="";function Qd(e,t){Sp[Ep++]=Ky,Sp[Ep++]=Xy,Xy=e,Ky=t}function bM(e,t,r){Cl[Tl++]=Ku,Cl[Tl++]=Yu,Cl[Tl++]=wf,wf=e;var i=Ku;e=Yu;var n=32-Ec(i)-1;i&=~(1<<n),r+=1;var s=32-Ec(t)+n;if(30<s){var a=n-n%5;s=(i&(1<<a)-1).toString(32),i>>=a,n-=a,Ku=1<<32-Ec(t)+n|r<<n|i,Yu=s+e}else Ku=1<<s|r<<n|i,Yu=e}function b5(e){e.return!==null&&(Qd(e,1),bM(e,1,0))}function w5(e){for(;e===Xy;)Xy=Sp[--Ep],Sp[Ep]=null,Ky=Sp[--Ep],Sp[Ep]=null;for(;e===wf;)wf=Cl[--Tl],Cl[Tl]=null,Yu=Cl[--Tl],Cl[Tl]=null,Ku=Cl[--Tl],Cl[Tl]=null}var $a=null,Ha=null,wn=!1,bc=null;function wM(e,t){var r=Pl(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function xE(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,$a=e,Ha=hd(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,$a=e,Ha=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=wf!==null?{id:Ku,overflow:Yu}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Pl(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,$a=e,Ha=null,!0):!1;default:return!1}}function Aw(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Sw(e){if(wn){var t=Ha;if(t){var r=t;if(!xE(e,t)){if(Aw(e))throw Error(Oe(418));t=hd(r.nextSibling);var i=$a;t&&xE(e,t)?wM(i,r):(e.flags=e.flags&-4097|2,wn=!1,$a=e)}}else{if(Aw(e))throw Error(Oe(418));e.flags=e.flags&-4097|2,wn=!1,$a=e}}}function AE(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;$a=e}function x1(e){if(e!==$a)return!1;if(!wn)return AE(e),wn=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!vw(e.type,e.memoizedProps)),t&&(t=Ha)){if(Aw(e))throw xM(),Error(Oe(418));for(;t;)wM(e,t),t=hd(t.nextSibling)}if(AE(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Oe(317));t:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Ha=hd(e.nextSibling);break t}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Ha=null}}else Ha=$a?hd(e.stateNode.nextSibling):null;return!0}function xM(){for(var e=Ha;e;)e=hd(e.nextSibling)}function tg(){Ha=$a=null,wn=!1}function x5(e){bc===null?bc=[e]:bc.push(e)}var HD=gh.ReactCurrentBatchConfig;function Xg(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Oe(309));var i=r.stateNode}if(!i)throw Error(Oe(147,e));var n=i,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(a){var o=n.refs;a===null?delete o[s]:o[s]=a},t._stringRef=s,t)}if(typeof e!="string")throw Error(Oe(284));if(!r._owner)throw Error(Oe(290,e))}return e}function A1(e,t){throw e=Object.prototype.toString.call(t),Error(Oe(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function SE(e){var t=e._init;return t(e._payload)}function AM(e){function t(U,z){if(e){var J=U.deletions;J===null?(U.deletions=[z],U.flags|=16):J.push(z)}}function r(U,z){if(!e)return null;for(;z!==null;)t(U,z),z=z.sibling;return null}function i(U,z){for(U=new Map;z!==null;)z.key!==null?U.set(z.key,z):U.set(z.index,z),z=z.sibling;return U}function n(U,z){return U=gd(U,z),U.index=0,U.sibling=null,U}function s(U,z,J){return U.index=J,e?(J=U.alternate,J!==null?(J=J.index,J<z?(U.flags|=2,z):J):(U.flags|=2,z)):(U.flags|=1048576,z)}function a(U){return e&&U.alternate===null&&(U.flags|=2),U}function o(U,z,J,nt){return z===null||z.tag!==6?(z=Ib(J,U.mode,nt),z.return=U,z):(z=n(z,J),z.return=U,z)}function f(U,z,J,nt){var mt=J.type;return mt===_p?w(U,z,J.props.children,nt,J.key):z!==null&&(z.elementType===mt||typeof mt=="object"&&mt!==null&&mt.$$typeof===Yh&&SE(mt)===z.type)?(nt=n(z,J.props),nt.ref=Xg(U,z,J),nt.return=U,nt):(nt=_y(J.type,J.key,J.props,null,U.mode,nt),nt.ref=Xg(U,z,J),nt.return=U,nt)}function m(U,z,J,nt){return z===null||z.tag!==4||z.stateNode.containerInfo!==J.containerInfo||z.stateNode.implementation!==J.implementation?(z=Mb(J,U.mode,nt),z.return=U,z):(z=n(z,J.children||[]),z.return=U,z)}function w(U,z,J,nt,mt){return z===null||z.tag!==7?(z=mf(J,U.mode,nt,mt),z.return=U,z):(z=n(z,J),z.return=U,z)}function A(U,z,J){if(typeof z=="string"&&z!==""||typeof z=="number")return z=Ib(""+z,U.mode,J),z.return=U,z;if(typeof z=="object"&&z!==null){switch(z.$$typeof){case d1:return J=_y(z.type,z.key,z.props,null,U.mode,J),J.ref=Xg(U,null,z),J.return=U,J;case yp:return z=Mb(z,U.mode,J),z.return=U,z;case Yh:var nt=z._init;return A(U,nt(z._payload),J)}if(_m(z)||Hg(z))return z=mf(z,U.mode,J,null),z.return=U,z;A1(U,z)}return null}function P(U,z,J,nt){var mt=z!==null?z.key:null;if(typeof J=="string"&&J!==""||typeof J=="number")return mt!==null?null:o(U,z,""+J,nt);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case d1:return J.key===mt?f(U,z,J,nt):null;case yp:return J.key===mt?m(U,z,J,nt):null;case Yh:return mt=J._init,P(U,z,mt(J._payload),nt)}if(_m(J)||Hg(J))return mt!==null?null:w(U,z,J,nt,null);A1(U,J)}return null}function I(U,z,J,nt,mt){if(typeof nt=="string"&&nt!==""||typeof nt=="number")return U=U.get(J)||null,o(z,U,""+nt,mt);if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case d1:return U=U.get(nt.key===null?J:nt.key)||null,f(z,U,nt,mt);case yp:return U=U.get(nt.key===null?J:nt.key)||null,m(z,U,nt,mt);case Yh:var Et=nt._init;return I(U,z,J,Et(nt._payload),mt)}if(_m(nt)||Hg(nt))return U=U.get(J)||null,w(z,U,nt,mt,null);A1(z,nt)}return null}function N(U,z,J,nt){for(var mt=null,Et=null,bt=z,pt=z=0,zt=null;bt!==null&&pt<J.length;pt++){bt.index>pt?(zt=bt,bt=null):zt=bt.sibling;var Rt=P(U,bt,J[pt],nt);if(Rt===null){bt===null&&(bt=zt);break}e&&bt&&Rt.alternate===null&&t(U,bt),z=s(Rt,z,pt),Et===null?mt=Rt:Et.sibling=Rt,Et=Rt,bt=zt}if(pt===J.length)return r(U,bt),wn&&Qd(U,pt),mt;if(bt===null){for(;pt<J.length;pt++)bt=A(U,J[pt],nt),bt!==null&&(z=s(bt,z,pt),Et===null?mt=bt:Et.sibling=bt,Et=bt);return wn&&Qd(U,pt),mt}for(bt=i(U,bt);pt<J.length;pt++)zt=I(bt,U,pt,J[pt],nt),zt!==null&&(e&&zt.alternate!==null&&bt.delete(zt.key===null?pt:zt.key),z=s(zt,z,pt),Et===null?mt=zt:Et.sibling=zt,Et=zt);return e&&bt.forEach(function(at){return t(U,at)}),wn&&Qd(U,pt),mt}function F(U,z,J,nt){var mt=Hg(J);if(typeof mt!="function")throw Error(Oe(150));if(J=mt.call(J),J==null)throw Error(Oe(151));for(var Et=mt=null,bt=z,pt=z=0,zt=null,Rt=J.next();bt!==null&&!Rt.done;pt++,Rt=J.next()){bt.index>pt?(zt=bt,bt=null):zt=bt.sibling;var at=P(U,bt,Rt.value,nt);if(at===null){bt===null&&(bt=zt);break}e&&bt&&at.alternate===null&&t(U,bt),z=s(at,z,pt),Et===null?mt=at:Et.sibling=at,Et=at,bt=zt}if(Rt.done)return r(U,bt),wn&&Qd(U,pt),mt;if(bt===null){for(;!Rt.done;pt++,Rt=J.next())Rt=A(U,Rt.value,nt),Rt!==null&&(z=s(Rt,z,pt),Et===null?mt=Rt:Et.sibling=Rt,Et=Rt);return wn&&Qd(U,pt),mt}for(bt=i(U,bt);!Rt.done;pt++,Rt=J.next())Rt=I(bt,U,pt,Rt.value,nt),Rt!==null&&(e&&Rt.alternate!==null&&bt.delete(Rt.key===null?pt:Rt.key),z=s(Rt,z,pt),Et===null?mt=Rt:Et.sibling=Rt,Et=Rt);return e&&bt.forEach(function(dt){return t(U,dt)}),wn&&Qd(U,pt),mt}function Z(U,z,J,nt){if(typeof J=="object"&&J!==null&&J.type===_p&&J.key===null&&(J=J.props.children),typeof J=="object"&&J!==null){switch(J.$$typeof){case d1:t:{for(var mt=J.key,Et=z;Et!==null;){if(Et.key===mt){if(mt=J.type,mt===_p){if(Et.tag===7){r(U,Et.sibling),z=n(Et,J.props.children),z.return=U,U=z;break t}}else if(Et.elementType===mt||typeof mt=="object"&&mt!==null&&mt.$$typeof===Yh&&SE(mt)===Et.type){r(U,Et.sibling),z=n(Et,J.props),z.ref=Xg(U,Et,J),z.return=U,U=z;break t}r(U,Et);break}else t(U,Et);Et=Et.sibling}J.type===_p?(z=mf(J.props.children,U.mode,nt,J.key),z.return=U,U=z):(nt=_y(J.type,J.key,J.props,null,U.mode,nt),nt.ref=Xg(U,z,J),nt.return=U,U=nt)}return a(U);case yp:t:{for(Et=J.key;z!==null;){if(z.key===Et)if(z.tag===4&&z.stateNode.containerInfo===J.containerInfo&&z.stateNode.implementation===J.implementation){r(U,z.sibling),z=n(z,J.children||[]),z.return=U,U=z;break t}else{r(U,z);break}else t(U,z);z=z.sibling}z=Mb(J,U.mode,nt),z.return=U,U=z}return a(U);case Yh:return Et=J._init,Z(U,z,Et(J._payload),nt)}if(_m(J))return N(U,z,J,nt);if(Hg(J))return F(U,z,J,nt);A1(U,J)}return typeof J=="string"&&J!==""||typeof J=="number"?(J=""+J,z!==null&&z.tag===6?(r(U,z.sibling),z=n(z,J),z.return=U,U=z):(r(U,z),z=Ib(J,U.mode,nt),z.return=U,U=z),a(U)):r(U,z)}return Z}var eg=AM(!0),SM=AM(!1),Yy=Cd(null),Qy=null,Cp=null,A5=null;function S5(){A5=Cp=Qy=null}function E5(e){var t=Yy.current;_n(Yy),e._currentValue=t}function Ew(e,t,r){for(;e!==null;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===r)break;e=e.return}}function zp(e,t){Qy=e,A5=Cp=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(ma=!0),e.firstContext=null)}function Ol(e){var t=e._currentValue;if(A5!==e)if(e={context:e,memoizedValue:t,next:null},Cp===null){if(Qy===null)throw Error(Oe(308));Cp=e,Qy.dependencies={lanes:0,firstContext:e}}else Cp=Cp.next=e;return t}var cf=null;function C5(e){cf===null?cf=[e]:cf.push(e)}function EM(e,t,r,i){var n=t.interleaved;return n===null?(r.next=r,C5(t)):(r.next=n.next,n.next=r),t.interleaved=r,ch(e,i)}function ch(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Qh=!1;function T5(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function CM(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ih(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function dd(e,t,r){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,Ci&2){var n=i.pending;return n===null?t.next=t:(t.next=n.next,n.next=t),i.pending=t,ch(e,r)}return n=i.interleaved,n===null?(t.next=t,C5(i)):(t.next=n.next,n.next=t),i.interleaved=t,ch(e,r)}function dy(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,d5(e,r)}}function EE(e,t){var r=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var n=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?n=s=a:s=s.next=a,r=r.next}while(r!==null);s===null?n=s=t:s=s.next=t}else n=s=t;r={baseState:i.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:i.shared,effects:i.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function t_(e,t,r,i){var n=e.updateQueue;Qh=!1;var s=n.firstBaseUpdate,a=n.lastBaseUpdate,o=n.shared.pending;if(o!==null){n.shared.pending=null;var f=o,m=f.next;f.next=null,a===null?s=m:a.next=m,a=f;var w=e.alternate;w!==null&&(w=w.updateQueue,o=w.lastBaseUpdate,o!==a&&(o===null?w.firstBaseUpdate=m:o.next=m,w.lastBaseUpdate=f))}if(s!==null){var A=n.baseState;a=0,w=m=f=null,o=s;do{var P=o.lane,I=o.eventTime;if((i&P)===P){w!==null&&(w=w.next={eventTime:I,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});t:{var N=e,F=o;switch(P=t,I=r,F.tag){case 1:if(N=F.payload,typeof N=="function"){A=N.call(I,A,P);break t}A=N;break t;case 3:N.flags=N.flags&-65537|128;case 0:if(N=F.payload,P=typeof N=="function"?N.call(I,A,P):N,P==null)break t;A=Rn({},A,P);break t;case 2:Qh=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,P=n.effects,P===null?n.effects=[o]:P.push(o))}else I={eventTime:I,lane:P,tag:o.tag,payload:o.payload,callback:o.callback,next:null},w===null?(m=w=I,f=A):w=w.next=I,a|=P;if(o=o.next,o===null){if(o=n.shared.pending,o===null)break;P=o,o=P.next,P.next=null,n.lastBaseUpdate=P,n.shared.pending=null}}while(1);if(w===null&&(f=A),n.baseState=f,n.firstBaseUpdate=m,n.lastBaseUpdate=w,t=n.shared.interleaved,t!==null){n=t;do a|=n.lane,n=n.next;while(n!==t)}else s===null&&(n.shared.lanes=0);Af|=a,e.lanes=a,e.memoizedState=A}}function CE(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var i=e[t],n=i.callback;if(n!==null){if(i.callback=null,i=r,typeof n!="function")throw Error(Oe(191,n));n.call(i)}}}var S0={},gu=Cd(S0),t0=Cd(S0),e0=Cd(S0);function uf(e){if(e===S0)throw Error(Oe(174));return e}function P5(e,t){switch(cn(e0,t),cn(t0,e),cn(gu,S0),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:sw(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=sw(t,e)}_n(gu),cn(gu,t)}function rg(){_n(gu),_n(t0),_n(e0)}function TM(e){uf(e0.current);var t=uf(gu.current),r=sw(t,e.type);t!==r&&(cn(t0,e),cn(gu,r))}function I5(e){t0.current===e&&(_n(gu),_n(t0))}var Ln=Cd(0);function e_(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ab=[];function M5(){for(var e=0;e<Ab.length;e++)Ab[e]._workInProgressVersionPrimary=null;Ab.length=0}var fy=gh.ReactCurrentDispatcher,Sb=gh.ReactCurrentBatchConfig,xf=0,kn=null,_s=null,Os=null,r_=!1,Mm=!1,r0=0,WD=0;function po(){throw Error(Oe(321))}function L5(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Ic(e[r],t[r]))return!1;return!0}function B5(e,t,r,i,n,s){if(xf=s,kn=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,fy.current=e===null||e.memoizedState===null?XD:KD,e=r(i,n),Mm){s=0;do{if(Mm=!1,r0=0,25<=s)throw Error(Oe(301));s+=1,Os=_s=null,t.updateQueue=null,fy.current=YD,e=r(i,n)}while(Mm)}if(fy.current=i_,t=_s!==null&&_s.next!==null,xf=0,Os=_s=kn=null,r_=!1,t)throw Error(Oe(300));return e}function k5(){var e=r0!==0;return r0=0,e}function su(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Os===null?kn.memoizedState=Os=e:Os=Os.next=e,Os}function Dl(){if(_s===null){var e=kn.alternate;e=e!==null?e.memoizedState:null}else e=_s.next;var t=Os===null?kn.memoizedState:Os.next;if(t!==null)Os=t,_s=e;else{if(e===null)throw Error(Oe(310));_s=e,e={memoizedState:_s.memoizedState,baseState:_s.baseState,baseQueue:_s.baseQueue,queue:_s.queue,next:null},Os===null?kn.memoizedState=Os=e:Os=Os.next=e}return Os}function i0(e,t){return typeof t=="function"?t(e):t}function Eb(e){var t=Dl(),r=t.queue;if(r===null)throw Error(Oe(311));r.lastRenderedReducer=e;var i=_s,n=i.baseQueue,s=r.pending;if(s!==null){if(n!==null){var a=n.next;n.next=s.next,s.next=a}i.baseQueue=n=s,r.pending=null}if(n!==null){s=n.next,i=i.baseState;var o=a=null,f=null,m=s;do{var w=m.lane;if((xf&w)===w)f!==null&&(f=f.next={lane:0,action:m.action,hasEagerState:m.hasEagerState,eagerState:m.eagerState,next:null}),i=m.hasEagerState?m.eagerState:e(i,m.action);else{var A={lane:w,action:m.action,hasEagerState:m.hasEagerState,eagerState:m.eagerState,next:null};f===null?(o=f=A,a=i):f=f.next=A,kn.lanes|=w,Af|=w}m=m.next}while(m!==null&&m!==s);f===null?a=i:f.next=o,Ic(i,t.memoizedState)||(ma=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=f,r.lastRenderedState=i}if(e=r.interleaved,e!==null){n=e;do s=n.lane,kn.lanes|=s,Af|=s,n=n.next;while(n!==e)}else n===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function Cb(e){var t=Dl(),r=t.queue;if(r===null)throw Error(Oe(311));r.lastRenderedReducer=e;var i=r.dispatch,n=r.pending,s=t.memoizedState;if(n!==null){r.pending=null;var a=n=n.next;do s=e(s,a.action),a=a.next;while(a!==n);Ic(s,t.memoizedState)||(ma=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),r.lastRenderedState=s}return[s,i]}function PM(){}function IM(e,t){var r=kn,i=Dl(),n=t(),s=!Ic(i.memoizedState,n);if(s&&(i.memoizedState=n,ma=!0),i=i.queue,R5(BM.bind(null,r,i,e),[e]),i.getSnapshot!==t||s||Os!==null&&Os.memoizedState.tag&1){if(r.flags|=2048,n0(9,LM.bind(null,r,i,n,t),void 0,null),zs===null)throw Error(Oe(349));xf&30||MM(r,t,n)}return n}function MM(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=kn.updateQueue,t===null?(t={lastEffect:null,stores:null},kn.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function LM(e,t,r,i){t.value=r,t.getSnapshot=i,kM(t)&&RM(e)}function BM(e,t,r){return r(function(){kM(t)&&RM(e)})}function kM(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Ic(e,r)}catch{return!0}}function RM(e){var t=ch(e,1);t!==null&&Cc(t,e,1,-1)}function TE(e){var t=su();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i0,lastRenderedState:e},t.queue=e,e=e.dispatch=JD.bind(null,kn,e),[t.memoizedState,e]}function n0(e,t,r,i){return e={tag:e,create:t,destroy:r,deps:i,next:null},t=kn.updateQueue,t===null?(t={lastEffect:null,stores:null},kn.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(i=r.next,r.next=e,e.next=i,t.lastEffect=e)),e}function OM(){return Dl().memoizedState}function py(e,t,r,i){var n=su();kn.flags|=e,n.memoizedState=n0(1|t,r,void 0,i===void 0?null:i)}function G_(e,t,r,i){var n=Dl();i=i===void 0?null:i;var s=void 0;if(_s!==null){var a=_s.memoizedState;if(s=a.destroy,i!==null&&L5(i,a.deps)){n.memoizedState=n0(t,r,s,i);return}}kn.flags|=e,n.memoizedState=n0(1|t,r,s,i)}function PE(e,t){return py(8390656,8,e,t)}function R5(e,t){return G_(2048,8,e,t)}function DM(e,t){return G_(4,2,e,t)}function NM(e,t){return G_(4,4,e,t)}function FM(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function zM(e,t,r){return r=r!=null?r.concat([e]):null,G_(4,4,FM.bind(null,t,e),r)}function O5(){}function jM(e,t){var r=Dl();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&L5(t,i[1])?i[0]:(r.memoizedState=[e,t],e)}function UM(e,t){var r=Dl();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&L5(t,i[1])?i[0]:(e=e(),r.memoizedState=[e,t],e)}function GM(e,t,r){return xf&21?(Ic(r,t)||(r=$4(),kn.lanes|=r,Af|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,ma=!0),e.memoizedState=r)}function $D(e,t){var r=Vi;Vi=r!==0&&4>r?r:4,e(!0);var i=Sb.transition;Sb.transition={};try{e(!1),t()}finally{Vi=r,Sb.transition=i}}function VM(){return Dl().memoizedState}function ZD(e,t,r){var i=pd(e);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},qM(e))HM(t,r);else if(r=EM(e,t,r,i),r!==null){var n=Ko();Cc(r,e,i,n),WM(r,t,i)}}function JD(e,t,r){var i=pd(e),n={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(qM(e))HM(t,n);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var a=t.lastRenderedState,o=s(a,r);if(n.hasEagerState=!0,n.eagerState=o,Ic(o,a)){var f=t.interleaved;f===null?(n.next=n,C5(t)):(n.next=f.next,f.next=n),t.interleaved=n;return}}catch{}finally{}r=EM(e,t,n,i),r!==null&&(n=Ko(),Cc(r,e,i,n),WM(r,t,i))}}function qM(e){var t=e.alternate;return e===kn||t!==null&&t===kn}function HM(e,t){Mm=r_=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function WM(e,t,r){if(r&4194240){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,d5(e,r)}}var i_={readContext:Ol,useCallback:po,useContext:po,useEffect:po,useImperativeHandle:po,useInsertionEffect:po,useLayoutEffect:po,useMemo:po,useReducer:po,useRef:po,useState:po,useDebugValue:po,useDeferredValue:po,useTransition:po,useMutableSource:po,useSyncExternalStore:po,useId:po,unstable_isNewReconciler:!1},XD={readContext:Ol,useCallback:function(e,t){return su().memoizedState=[e,t===void 0?null:t],e},useContext:Ol,useEffect:PE,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,py(4194308,4,FM.bind(null,t,e),r)},useLayoutEffect:function(e,t){return py(4194308,4,e,t)},useInsertionEffect:function(e,t){return py(4,2,e,t)},useMemo:function(e,t){var r=su();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var i=su();return t=r!==void 0?r(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=ZD.bind(null,kn,e),[i.memoizedState,e]},useRef:function(e){var t=su();return e={current:e},t.memoizedState=e},useState:TE,useDebugValue:O5,useDeferredValue:function(e){return su().memoizedState=e},useTransition:function(){var e=TE(!1),t=e[0];return e=$D.bind(null,e[1]),su().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var i=kn,n=su();if(wn){if(r===void 0)throw Error(Oe(407));r=r()}else{if(r=t(),zs===null)throw Error(Oe(349));xf&30||MM(i,t,r)}n.memoizedState=r;var s={value:r,getSnapshot:t};return n.queue=s,PE(BM.bind(null,i,s,e),[e]),i.flags|=2048,n0(9,LM.bind(null,i,s,r,t),void 0,null),r},useId:function(){var e=su(),t=zs.identifierPrefix;if(wn){var r=Yu,i=Ku;r=(i&~(1<<32-Ec(i)-1)).toString(32)+r,t=":"+t+"R"+r,r=r0++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=WD++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},KD={readContext:Ol,useCallback:jM,useContext:Ol,useEffect:R5,useImperativeHandle:zM,useInsertionEffect:DM,useLayoutEffect:NM,useMemo:UM,useReducer:Eb,useRef:OM,useState:function(){return Eb(i0)},useDebugValue:O5,useDeferredValue:function(e){var t=Dl();return GM(t,_s.memoizedState,e)},useTransition:function(){var e=Eb(i0)[0],t=Dl().memoizedState;return[e,t]},useMutableSource:PM,useSyncExternalStore:IM,useId:VM,unstable_isNewReconciler:!1},YD={readContext:Ol,useCallback:jM,useContext:Ol,useEffect:R5,useImperativeHandle:zM,useInsertionEffect:DM,useLayoutEffect:NM,useMemo:UM,useReducer:Cb,useRef:OM,useState:function(){return Cb(i0)},useDebugValue:O5,useDeferredValue:function(e){var t=Dl();return _s===null?t.memoizedState=e:GM(t,_s.memoizedState,e)},useTransition:function(){var e=Cb(i0)[0],t=Dl().memoizedState;return[e,t]},useMutableSource:PM,useSyncExternalStore:IM,useId:VM,unstable_isNewReconciler:!1};function mc(e,t){if(e&&e.defaultProps){t=Rn({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function Cw(e,t,r,i){t=e.memoizedState,r=r(i,t),r=r==null?t:Rn({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var V_={isMounted:function(e){return(e=e._reactInternals)?Mf(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var i=Ko(),n=pd(e),s=ih(i,n);s.payload=t,r!=null&&(s.callback=r),t=dd(e,s,n),t!==null&&(Cc(t,e,n,i),dy(t,e,n))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var i=Ko(),n=pd(e),s=ih(i,n);s.tag=1,s.payload=t,r!=null&&(s.callback=r),t=dd(e,s,n),t!==null&&(Cc(t,e,n,i),dy(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Ko(),i=pd(e),n=ih(r,i);n.tag=2,t!=null&&(n.callback=t),t=dd(e,n,i),t!==null&&(Cc(t,e,i,r),dy(t,e,i))}};function IE(e,t,r,i,n,s,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,s,a):t.prototype&&t.prototype.isPureReactComponent?!Xm(r,i)||!Xm(n,s):!0}function $M(e,t,r){var i=!1,n=vd,s=t.contextType;return typeof s=="object"&&s!==null?s=Ol(s):(n=va(t)?bf:So.current,i=t.contextTypes,s=(i=i!=null)?Qp(e,n):vd),t=new t(r,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=V_,e.stateNode=t,t._reactInternals=e,i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=s),t}function ME(e,t,r,i){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,i),t.state!==e&&V_.enqueueReplaceState(t,t.state,null)}function Tw(e,t,r,i){var n=e.stateNode;n.props=r,n.state=e.memoizedState,n.refs={},T5(e);var s=t.contextType;typeof s=="object"&&s!==null?n.context=Ol(s):(s=va(t)?bf:So.current,n.context=Qp(e,s)),n.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(Cw(e,t,s,r),n.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(t=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),t!==n.state&&V_.enqueueReplaceState(n,n.state,null),t_(e,r,n,i),n.state=e.memoizedState),typeof n.componentDidMount=="function"&&(e.flags|=4194308)}function ig(e,t){try{var r="",i=t;do r+=C8(i),i=i.return;while(i);var n=r}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:n,digest:null}}function Tb(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function Pw(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var QD=typeof WeakMap=="function"?WeakMap:Map;function ZM(e,t,r){r=ih(-1,r),r.tag=3,r.payload={element:null};var i=t.value;return r.callback=function(){s_||(s_=!0,Fw=i),Pw(e,t)},r}function JM(e,t,r){r=ih(-1,r),r.tag=3;var i=e.type.getDerivedStateFromError;if(typeof i=="function"){var n=t.value;r.payload=function(){return i(n)},r.callback=function(){Pw(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){Pw(e,t),typeof i!="function"&&(fd===null?fd=new Set([this]):fd.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),r}function LE(e,t,r){var i=e.pingCache;if(i===null){i=e.pingCache=new QD;var n=new Set;i.set(t,n)}else n=i.get(t),n===void 0&&(n=new Set,i.set(t,n));n.has(r)||(n.add(r),e=fN.bind(null,e,t,r),t.then(e,e))}function BE(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function kE(e,t,r,i,n){return e.mode&1?(e.flags|=65536,e.lanes=n,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=ih(-1,1),t.tag=2,dd(r,t,1))),r.lanes|=1),e)}var tN=gh.ReactCurrentOwner,ma=!1;function Wo(e,t,r,i){t.child=e===null?SM(t,null,r,i):eg(t,e.child,r,i)}function RE(e,t,r,i,n){r=r.render;var s=t.ref;return zp(t,n),i=B5(e,t,r,i,s,n),r=k5(),e!==null&&!ma?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,uh(e,t,n)):(wn&&r&&b5(t),t.flags|=1,Wo(e,t,i,n),t.child)}function OE(e,t,r,i,n){if(e===null){var s=r.type;return typeof s=="function"&&!V5(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=s,XM(e,t,s,i,n)):(e=_y(r.type,null,i,t,t.mode,n),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&n)){var a=s.memoizedProps;if(r=r.compare,r=r!==null?r:Xm,r(a,i)&&e.ref===t.ref)return uh(e,t,n)}return t.flags|=1,e=gd(s,i),e.ref=t.ref,e.return=t,t.child=e}function XM(e,t,r,i,n){if(e!==null){var s=e.memoizedProps;if(Xm(s,i)&&e.ref===t.ref)if(ma=!1,t.pendingProps=i=s,(e.lanes&n)!==0)e.flags&131072&&(ma=!0);else return t.lanes=e.lanes,uh(e,t,n)}return Iw(e,t,r,i,n)}function KM(e,t,r){var i=t.pendingProps,n=i.children,s=e!==null?e.memoizedState:null;if(i.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},cn(Pp,Va),Va|=r;else{if(!(r&1073741824))return e=s!==null?s.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,cn(Pp,Va),Va|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:r,cn(Pp,Va),Va|=i}else s!==null?(i=s.baseLanes|r,t.memoizedState=null):i=r,cn(Pp,Va),Va|=i;return Wo(e,t,n,r),t.child}function YM(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function Iw(e,t,r,i,n){var s=va(r)?bf:So.current;return s=Qp(t,s),zp(t,n),r=B5(e,t,r,i,s,n),i=k5(),e!==null&&!ma?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,uh(e,t,n)):(wn&&i&&b5(t),t.flags|=1,Wo(e,t,r,n),t.child)}function DE(e,t,r,i,n){if(va(r)){var s=!0;Jy(t)}else s=!1;if(zp(t,n),t.stateNode===null)gy(e,t),$M(t,r,i),Tw(t,r,i,n),i=!0;else if(e===null){var a=t.stateNode,o=t.memoizedProps;a.props=o;var f=a.context,m=r.contextType;typeof m=="object"&&m!==null?m=Ol(m):(m=va(r)?bf:So.current,m=Qp(t,m));var w=r.getDerivedStateFromProps,A=typeof w=="function"||typeof a.getSnapshotBeforeUpdate=="function";A||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==i||f!==m)&&ME(t,a,i,m),Qh=!1;var P=t.memoizedState;a.state=P,t_(t,i,a,n),f=t.memoizedState,o!==i||P!==f||_a.current||Qh?(typeof w=="function"&&(Cw(t,r,w,i),f=t.memoizedState),(o=Qh||IE(t,r,o,i,P,f,m))?(A||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=f),a.props=i,a.state=f,a.context=m,i=o):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,CM(e,t),o=t.memoizedProps,m=t.type===t.elementType?o:mc(t.type,o),a.props=m,A=t.pendingProps,P=a.context,f=r.contextType,typeof f=="object"&&f!==null?f=Ol(f):(f=va(r)?bf:So.current,f=Qp(t,f));var I=r.getDerivedStateFromProps;(w=typeof I=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==A||P!==f)&&ME(t,a,i,f),Qh=!1,P=t.memoizedState,a.state=P,t_(t,i,a,n);var N=t.memoizedState;o!==A||P!==N||_a.current||Qh?(typeof I=="function"&&(Cw(t,r,I,i),N=t.memoizedState),(m=Qh||IE(t,r,m,i,P,N,f)||!1)?(w||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(i,N,f),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(i,N,f)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&P===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&P===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=N),a.props=i,a.state=N,a.context=f,i=m):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&P===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&P===e.memoizedState||(t.flags|=1024),i=!1)}return Mw(e,t,r,i,s,n)}function Mw(e,t,r,i,n,s){YM(e,t);var a=(t.flags&128)!==0;if(!i&&!a)return n&&wE(t,r,!1),uh(e,t,s);i=t.stateNode,tN.current=t;var o=a&&typeof r.getDerivedStateFromError!="function"?null:i.render();return t.flags|=1,e!==null&&a?(t.child=eg(t,e.child,null,s),t.child=eg(t,null,o,s)):Wo(e,t,o,s),t.memoizedState=i.state,n&&wE(t,r,!0),t.child}function QM(e){var t=e.stateNode;t.pendingContext?bE(e,t.pendingContext,t.pendingContext!==t.context):t.context&&bE(e,t.context,!1),P5(e,t.containerInfo)}function NE(e,t,r,i,n){return tg(),x5(n),t.flags|=256,Wo(e,t,r,i),t.child}var Lw={dehydrated:null,treeContext:null,retryLane:0};function Bw(e){return{baseLanes:e,cachePool:null,transitions:null}}function tL(e,t,r){var i=t.pendingProps,n=Ln.current,s=!1,a=(t.flags&128)!==0,o;if((o=a)||(o=e!==null&&e.memoizedState===null?!1:(n&2)!==0),o?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(n|=1),cn(Ln,n&1),e===null)return Sw(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=i.children,e=i.fallback,s?(i=t.mode,s=t.child,a={mode:"hidden",children:a},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=W_(a,i,0,null),e=mf(e,i,r,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Bw(r),t.memoizedState=Lw,e):D5(t,a));if(n=e.memoizedState,n!==null&&(o=n.dehydrated,o!==null))return eN(e,t,a,i,o,n,r);if(s){s=i.fallback,a=t.mode,n=e.child,o=n.sibling;var f={mode:"hidden",children:i.children};return!(a&1)&&t.child!==n?(i=t.child,i.childLanes=0,i.pendingProps=f,t.deletions=null):(i=gd(n,f),i.subtreeFlags=n.subtreeFlags&14680064),o!==null?s=gd(o,s):(s=mf(s,a,r,null),s.flags|=2),s.return=t,i.return=t,i.sibling=s,t.child=i,i=s,s=t.child,a=e.child.memoizedState,a=a===null?Bw(r):{baseLanes:a.baseLanes|r,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=e.childLanes&~r,t.memoizedState=Lw,i}return s=e.child,e=s.sibling,i=gd(s,{mode:"visible",children:i.children}),!(t.mode&1)&&(i.lanes=r),i.return=t,i.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=i,t.memoizedState=null,i}function D5(e,t){return t=W_({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function S1(e,t,r,i){return i!==null&&x5(i),eg(t,e.child,null,r),e=D5(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function eN(e,t,r,i,n,s,a){if(r)return t.flags&256?(t.flags&=-257,i=Tb(Error(Oe(422))),S1(e,t,a,i)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=i.fallback,n=t.mode,i=W_({mode:"visible",children:i.children},n,0,null),s=mf(s,n,a,null),s.flags|=2,i.return=t,s.return=t,i.sibling=s,t.child=i,t.mode&1&&eg(t,e.child,null,a),t.child.memoizedState=Bw(a),t.memoizedState=Lw,s);if(!(t.mode&1))return S1(e,t,a,null);if(n.data==="$!"){if(i=n.nextSibling&&n.nextSibling.dataset,i)var o=i.dgst;return i=o,s=Error(Oe(419)),i=Tb(s,i,void 0),S1(e,t,a,i)}if(o=(a&e.childLanes)!==0,ma||o){if(i=zs,i!==null){switch(a&-a){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(i.suspendedLanes|a)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,ch(e,n),Cc(i,e,n,-1))}return G5(),i=Tb(Error(Oe(421))),S1(e,t,a,i)}return n.data==="$?"?(t.flags|=128,t.child=e.child,t=pN.bind(null,e),n._reactRetry=t,null):(e=s.treeContext,Ha=hd(n.nextSibling),$a=t,wn=!0,bc=null,e!==null&&(Cl[Tl++]=Ku,Cl[Tl++]=Yu,Cl[Tl++]=wf,Ku=e.id,Yu=e.overflow,wf=t),t=D5(t,i.children),t.flags|=4096,t)}function FE(e,t,r){e.lanes|=t;var i=e.alternate;i!==null&&(i.lanes|=t),Ew(e.return,t,r)}function Pb(e,t,r,i,n){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:n}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=r,s.tailMode=n)}function eL(e,t,r){var i=t.pendingProps,n=i.revealOrder,s=i.tail;if(Wo(e,t,i.children,r),i=Ln.current,i&2)i=i&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)t:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&FE(e,r,t);else if(e.tag===19)FE(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break t;for(;e.sibling===null;){if(e.return===null||e.return===t)break t;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(cn(Ln,i),!(t.mode&1))t.memoizedState=null;else switch(n){case"forwards":for(r=t.child,n=null;r!==null;)e=r.alternate,e!==null&&e_(e)===null&&(n=r),r=r.sibling;r=n,r===null?(n=t.child,t.child=null):(n=r.sibling,r.sibling=null),Pb(t,!1,n,r,s);break;case"backwards":for(r=null,n=t.child,t.child=null;n!==null;){if(e=n.alternate,e!==null&&e_(e)===null){t.child=n;break}e=n.sibling,n.sibling=r,r=n,n=e}Pb(t,!0,r,null,s);break;case"together":Pb(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function gy(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function uh(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Af|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Oe(153));if(t.child!==null){for(e=t.child,r=gd(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=gd(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function rN(e,t,r){switch(t.tag){case 3:QM(t),tg();break;case 5:TM(t);break;case 1:va(t.type)&&Jy(t);break;case 4:P5(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,n=t.memoizedProps.value;cn(Yy,i._currentValue),i._currentValue=n;break;case 13:if(i=t.memoizedState,i!==null)return i.dehydrated!==null?(cn(Ln,Ln.current&1),t.flags|=128,null):r&t.child.childLanes?tL(e,t,r):(cn(Ln,Ln.current&1),e=uh(e,t,r),e!==null?e.sibling:null);cn(Ln,Ln.current&1);break;case 19:if(i=(r&t.childLanes)!==0,e.flags&128){if(i)return eL(e,t,r);t.flags|=128}if(n=t.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),cn(Ln,Ln.current),i)break;return null;case 22:case 23:return t.lanes=0,KM(e,t,r)}return uh(e,t,r)}var rL,kw,iL,nL;rL=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};kw=function(){};iL=function(e,t,r,i){var n=e.memoizedProps;if(n!==i){e=t.stateNode,uf(gu.current);var s=null;switch(r){case"input":n=ew(e,n),i=ew(e,i),s=[];break;case"select":n=Rn({},n,{value:void 0}),i=Rn({},i,{value:void 0}),s=[];break;case"textarea":n=nw(e,n),i=nw(e,i),s=[];break;default:typeof n.onClick!="function"&&typeof i.onClick=="function"&&(e.onclick=$y)}ow(r,i);var a;r=null;for(m in n)if(!i.hasOwnProperty(m)&&n.hasOwnProperty(m)&&n[m]!=null)if(m==="style"){var o=n[m];for(a in o)o.hasOwnProperty(a)&&(r||(r={}),r[a]="")}else m!=="dangerouslySetInnerHTML"&&m!=="children"&&m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(Vm.hasOwnProperty(m)?s||(s=[]):(s=s||[]).push(m,null));for(m in i){var f=i[m];if(o=n!=null?n[m]:void 0,i.hasOwnProperty(m)&&f!==o&&(f!=null||o!=null))if(m==="style")if(o){for(a in o)!o.hasOwnProperty(a)||f&&f.hasOwnProperty(a)||(r||(r={}),r[a]="");for(a in f)f.hasOwnProperty(a)&&o[a]!==f[a]&&(r||(r={}),r[a]=f[a])}else r||(s||(s=[]),s.push(m,r)),r=f;else m==="dangerouslySetInnerHTML"?(f=f?f.__html:void 0,o=o?o.__html:void 0,f!=null&&o!==f&&(s=s||[]).push(m,f)):m==="children"?typeof f!="string"&&typeof f!="number"||(s=s||[]).push(m,""+f):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&(Vm.hasOwnProperty(m)?(f!=null&&m==="onScroll"&&mn("scroll",e),s||o===f||(s=[])):(s=s||[]).push(m,f))}r&&(s=s||[]).push("style",r);var m=s;(t.updateQueue=m)&&(t.flags|=4)}};nL=function(e,t,r,i){r!==i&&(t.flags|=4)};function Kg(e,t){if(!wn)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function go(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,i=0;if(t)for(var n=e.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags&14680064,i|=n.flags&14680064,n.return=e,n=n.sibling;else for(n=e.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags,i|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=i,e.childLanes=r,t}function iN(e,t,r){var i=t.pendingProps;switch(w5(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return go(t),null;case 1:return va(t.type)&&Zy(),go(t),null;case 3:return i=t.stateNode,rg(),_n(_a),_n(So),M5(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(x1(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,bc!==null&&(Uw(bc),bc=null))),kw(e,t),go(t),null;case 5:I5(t);var n=uf(e0.current);if(r=t.type,e!==null&&t.stateNode!=null)iL(e,t,r,i,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(t.stateNode===null)throw Error(Oe(166));return go(t),null}if(e=uf(gu.current),x1(t)){i=t.stateNode,r=t.type;var s=t.memoizedProps;switch(i[ou]=t,i[Qm]=s,e=(t.mode&1)!==0,r){case"dialog":mn("cancel",i),mn("close",i);break;case"iframe":case"object":case"embed":mn("load",i);break;case"video":case"audio":for(n=0;n<bm.length;n++)mn(bm[n],i);break;case"source":mn("error",i);break;case"img":case"image":case"link":mn("error",i),mn("load",i);break;case"details":mn("toggle",i);break;case"input":$3(i,s),mn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},mn("invalid",i);break;case"textarea":J3(i,s),mn("invalid",i)}ow(r,s),n=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?i.textContent!==o&&(s.suppressHydrationWarning!==!0&&w1(i.textContent,o,e),n=["children",o]):typeof o=="number"&&i.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&w1(i.textContent,o,e),n=["children",""+o]):Vm.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&mn("scroll",i)}switch(r){case"input":f1(i),Z3(i,s,!0);break;case"textarea":f1(i),X3(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=$y)}i=n,t.updateQueue=i,i!==null&&(t.flags|=4)}else{a=n.nodeType===9?n:n.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=B4(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof i.is=="string"?e=a.createElement(r,{is:i.is}):(e=a.createElement(r),r==="select"&&(a=e,i.multiple?a.multiple=!0:i.size&&(a.size=i.size))):e=a.createElementNS(e,r),e[ou]=t,e[Qm]=i,rL(e,t,!1,!1),t.stateNode=e;t:{switch(a=aw(r,i),r){case"dialog":mn("cancel",e),mn("close",e),n=i;break;case"iframe":case"object":case"embed":mn("load",e),n=i;break;case"video":case"audio":for(n=0;n<bm.length;n++)mn(bm[n],e);n=i;break;case"source":mn("error",e),n=i;break;case"img":case"image":case"link":mn("error",e),mn("load",e),n=i;break;case"details":mn("toggle",e),n=i;break;case"input":$3(e,i),n=ew(e,i),mn("invalid",e);break;case"option":n=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},n=Rn({},i,{value:void 0}),mn("invalid",e);break;case"textarea":J3(e,i),n=nw(e,i),mn("invalid",e);break;default:n=i}ow(r,n),o=n;for(s in o)if(o.hasOwnProperty(s)){var f=o[s];s==="style"?O4(e,f):s==="dangerouslySetInnerHTML"?(f=f?f.__html:void 0,f!=null&&k4(e,f)):s==="children"?typeof f=="string"?(r!=="textarea"||f!=="")&&qm(e,f):typeof f=="number"&&qm(e,""+f):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Vm.hasOwnProperty(s)?f!=null&&s==="onScroll"&&mn("scroll",e):f!=null&&o5(e,s,f,a))}switch(r){case"input":f1(e),Z3(e,i,!1);break;case"textarea":f1(e),X3(e);break;case"option":i.value!=null&&e.setAttribute("value",""+_d(i.value));break;case"select":e.multiple=!!i.multiple,s=i.value,s!=null?Op(e,!!i.multiple,s,!1):i.defaultValue!=null&&Op(e,!!i.multiple,i.defaultValue,!0);break;default:typeof n.onClick=="function"&&(e.onclick=$y)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break t;case"img":i=!0;break t;default:i=!1}}i&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return go(t),null;case 6:if(e&&t.stateNode!=null)nL(e,t,e.memoizedProps,i);else{if(typeof i!="string"&&t.stateNode===null)throw Error(Oe(166));if(r=uf(e0.current),uf(gu.current),x1(t)){if(i=t.stateNode,r=t.memoizedProps,i[ou]=t,(s=i.nodeValue!==r)&&(e=$a,e!==null))switch(e.tag){case 3:w1(i.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&w1(i.nodeValue,r,(e.mode&1)!==0)}s&&(t.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[ou]=t,t.stateNode=i}return go(t),null;case 13:if(_n(Ln),i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(wn&&Ha!==null&&t.mode&1&&!(t.flags&128))xM(),tg(),t.flags|=98560,s=!1;else if(s=x1(t),i!==null&&i.dehydrated!==null){if(e===null){if(!s)throw Error(Oe(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Oe(317));s[ou]=t}else tg(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;go(t),s=!1}else bc!==null&&(Uw(bc),bc=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(i=i!==null,i!==(e!==null&&e.memoizedState!==null)&&i&&(t.child.flags|=8192,t.mode&1&&(e===null||Ln.current&1?vs===0&&(vs=3):G5())),t.updateQueue!==null&&(t.flags|=4),go(t),null);case 4:return rg(),kw(e,t),e===null&&Km(t.stateNode.containerInfo),go(t),null;case 10:return E5(t.type._context),go(t),null;case 17:return va(t.type)&&Zy(),go(t),null;case 19:if(_n(Ln),s=t.memoizedState,s===null)return go(t),null;if(i=(t.flags&128)!==0,a=s.rendering,a===null)if(i)Kg(s,!1);else{if(vs!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=e_(e),a!==null){for(t.flags|=128,Kg(s,!1),i=a.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=r,r=t.child;r!==null;)s=r,e=i,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,e=a.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return cn(Ln,Ln.current&1|2),t.child}e=e.sibling}s.tail!==null&&ns()>ng&&(t.flags|=128,i=!0,Kg(s,!1),t.lanes=4194304)}else{if(!i)if(e=e_(a),e!==null){if(t.flags|=128,i=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Kg(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!wn)return go(t),null}else 2*ns()-s.renderingStartTime>ng&&r!==1073741824&&(t.flags|=128,i=!0,Kg(s,!1),t.lanes=4194304);s.isBackwards?(a.sibling=t.child,t.child=a):(r=s.last,r!==null?r.sibling=a:t.child=a,s.last=a)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=ns(),t.sibling=null,r=Ln.current,cn(Ln,i?r&1|2:r&1),t):(go(t),null);case 22:case 23:return U5(),i=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==i&&(t.flags|=8192),i&&t.mode&1?Va&1073741824&&(go(t),t.subtreeFlags&6&&(t.flags|=8192)):go(t),null;case 24:return null;case 25:return null}throw Error(Oe(156,t.tag))}function nN(e,t){switch(w5(t),t.tag){case 1:return va(t.type)&&Zy(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return rg(),_n(_a),_n(So),M5(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return I5(t),null;case 13:if(_n(Ln),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Oe(340));tg()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return _n(Ln),null;case 4:return rg(),null;case 10:return E5(t.type._context),null;case 22:case 23:return U5(),null;case 24:return null;default:return null}}var E1=!1,Ao=!1,sN=typeof WeakSet=="function"?WeakSet:Set,cr=null;function Tp(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){Wn(e,t,i)}else r.current=null}function Rw(e,t,r){try{r()}catch(i){Wn(e,t,i)}}var zE=!1;function oN(e,t){if(yw=qy,e=cM(),v5(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else t:{r=(r=e.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var n=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break t}var a=0,o=-1,f=-1,m=0,w=0,A=e,P=null;e:for(;;){for(var I;A!==r||n!==0&&A.nodeType!==3||(o=a+n),A!==s||i!==0&&A.nodeType!==3||(f=a+i),A.nodeType===3&&(a+=A.nodeValue.length),(I=A.firstChild)!==null;)P=A,A=I;for(;;){if(A===e)break e;if(P===r&&++m===n&&(o=a),P===s&&++w===i&&(f=a),(I=A.nextSibling)!==null)break;A=P,P=A.parentNode}A=I}r=o===-1||f===-1?null:{start:o,end:f}}else r=null}r=r||{start:0,end:0}}else r=null;for(_w={focusedElem:e,selectionRange:r},qy=!1,cr=t;cr!==null;)if(t=cr,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,cr=e;else for(;cr!==null;){t=cr;try{var N=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(N!==null){var F=N.memoizedProps,Z=N.memoizedState,U=t.stateNode,z=U.getSnapshotBeforeUpdate(t.elementType===t.type?F:mc(t.type,F),Z);U.__reactInternalSnapshotBeforeUpdate=z}break;case 3:var J=t.stateNode.containerInfo;J.nodeType===1?J.textContent="":J.nodeType===9&&J.documentElement&&J.removeChild(J.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Oe(163))}}catch(nt){Wn(t,t.return,nt)}if(e=t.sibling,e!==null){e.return=t.return,cr=e;break}cr=t.return}return N=zE,zE=!1,N}function Lm(e,t,r){var i=t.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var n=i=i.next;do{if((n.tag&e)===e){var s=n.destroy;n.destroy=void 0,s!==void 0&&Rw(t,r,s)}n=n.next}while(n!==i)}}function q_(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var i=r.create;r.destroy=i()}r=r.next}while(r!==t)}}function Ow(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function sL(e){var t=e.alternate;t!==null&&(e.alternate=null,sL(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[ou],delete t[Qm],delete t[ww],delete t[GD],delete t[VD])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function oL(e){return e.tag===5||e.tag===3||e.tag===4}function jE(e){t:for(;;){for(;e.sibling===null;){if(e.return===null||oL(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue t;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Dw(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=$y));else if(i!==4&&(e=e.child,e!==null))for(Dw(e,t,r),e=e.sibling;e!==null;)Dw(e,t,r),e=e.sibling}function Nw(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(i!==4&&(e=e.child,e!==null))for(Nw(e,t,r),e=e.sibling;e!==null;)Nw(e,t,r),e=e.sibling}var Ks=null,_c=!1;function jh(e,t,r){for(r=r.child;r!==null;)aL(e,t,r),r=r.sibling}function aL(e,t,r){if(pu&&typeof pu.onCommitFiberUnmount=="function")try{pu.onCommitFiberUnmount(D_,r)}catch{}switch(r.tag){case 5:Ao||Tp(r,t);case 6:var i=Ks,n=_c;Ks=null,jh(e,t,r),Ks=i,_c=n,Ks!==null&&(_c?(e=Ks,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Ks.removeChild(r.stateNode));break;case 18:Ks!==null&&(_c?(e=Ks,r=r.stateNode,e.nodeType===8?wb(e.parentNode,r):e.nodeType===1&&wb(e,r),Zm(e)):wb(Ks,r.stateNode));break;case 4:i=Ks,n=_c,Ks=r.stateNode.containerInfo,_c=!0,jh(e,t,r),Ks=i,_c=n;break;case 0:case 11:case 14:case 15:if(!Ao&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){n=i=i.next;do{var s=n,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&Rw(r,t,a),n=n.next}while(n!==i)}jh(e,t,r);break;case 1:if(!Ao&&(Tp(r,t),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(o){Wn(r,t,o)}jh(e,t,r);break;case 21:jh(e,t,r);break;case 22:r.mode&1?(Ao=(i=Ao)||r.memoizedState!==null,jh(e,t,r),Ao=i):jh(e,t,r);break;default:jh(e,t,r)}}function UE(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new sN),t.forEach(function(i){var n=gN.bind(null,e,i);r.has(i)||(r.add(i),i.then(n,n))})}}function dc(e,t){var r=t.deletions;if(r!==null)for(var i=0;i<r.length;i++){var n=r[i];try{var s=e,a=t,o=a;t:for(;o!==null;){switch(o.tag){case 5:Ks=o.stateNode,_c=!1;break t;case 3:Ks=o.stateNode.containerInfo,_c=!0;break t;case 4:Ks=o.stateNode.containerInfo,_c=!0;break t}o=o.return}if(Ks===null)throw Error(Oe(160));aL(s,a,n),Ks=null,_c=!1;var f=n.alternate;f!==null&&(f.return=null),n.return=null}catch(m){Wn(n,t,m)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)lL(t,e),t=t.sibling}function lL(e,t){var r=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(dc(t,e),Qc(e),i&4){try{Lm(3,e,e.return),q_(3,e)}catch(F){Wn(e,e.return,F)}try{Lm(5,e,e.return)}catch(F){Wn(e,e.return,F)}}break;case 1:dc(t,e),Qc(e),i&512&&r!==null&&Tp(r,r.return);break;case 5:if(dc(t,e),Qc(e),i&512&&r!==null&&Tp(r,r.return),e.flags&32){var n=e.stateNode;try{qm(n,"")}catch(F){Wn(e,e.return,F)}}if(i&4&&(n=e.stateNode,n!=null)){var s=e.memoizedProps,a=r!==null?r.memoizedProps:s,o=e.type,f=e.updateQueue;if(e.updateQueue=null,f!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&M4(n,s),aw(o,a);var m=aw(o,s);for(a=0;a<f.length;a+=2){var w=f[a],A=f[a+1];w==="style"?O4(n,A):w==="dangerouslySetInnerHTML"?k4(n,A):w==="children"?qm(n,A):o5(n,w,A,m)}switch(o){case"input":rw(n,s);break;case"textarea":L4(n,s);break;case"select":var P=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var I=s.value;I!=null?Op(n,!!s.multiple,I,!1):P!==!!s.multiple&&(s.defaultValue!=null?Op(n,!!s.multiple,s.defaultValue,!0):Op(n,!!s.multiple,s.multiple?[]:"",!1))}n[Qm]=s}catch(F){Wn(e,e.return,F)}}break;case 6:if(dc(t,e),Qc(e),i&4){if(e.stateNode===null)throw Error(Oe(162));n=e.stateNode,s=e.memoizedProps;try{n.nodeValue=s}catch(F){Wn(e,e.return,F)}}break;case 3:if(dc(t,e),Qc(e),i&4&&r!==null&&r.memoizedState.isDehydrated)try{Zm(t.containerInfo)}catch(F){Wn(e,e.return,F)}break;case 4:dc(t,e),Qc(e);break;case 13:dc(t,e),Qc(e),n=e.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(z5=ns())),i&4&&UE(e);break;case 22:if(w=r!==null&&r.memoizedState!==null,e.mode&1?(Ao=(m=Ao)||w,dc(t,e),Ao=m):dc(t,e),Qc(e),i&8192){if(m=e.memoizedState!==null,(e.stateNode.isHidden=m)&&!w&&e.mode&1)for(cr=e,w=e.child;w!==null;){for(A=cr=w;cr!==null;){switch(P=cr,I=P.child,P.tag){case 0:case 11:case 14:case 15:Lm(4,P,P.return);break;case 1:Tp(P,P.return);var N=P.stateNode;if(typeof N.componentWillUnmount=="function"){i=P,r=P.return;try{t=i,N.props=t.memoizedProps,N.state=t.memoizedState,N.componentWillUnmount()}catch(F){Wn(i,r,F)}}break;case 5:Tp(P,P.return);break;case 22:if(P.memoizedState!==null){VE(A);continue}}I!==null?(I.return=P,cr=I):VE(A)}w=w.sibling}t:for(w=null,A=e;;){if(A.tag===5){if(w===null){w=A;try{n=A.stateNode,m?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=A.stateNode,f=A.memoizedProps.style,a=f!=null&&f.hasOwnProperty("display")?f.display:null,o.style.display=R4("display",a))}catch(F){Wn(e,e.return,F)}}}else if(A.tag===6){if(w===null)try{A.stateNode.nodeValue=m?"":A.memoizedProps}catch(F){Wn(e,e.return,F)}}else if((A.tag!==22&&A.tag!==23||A.memoizedState===null||A===e)&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===e)break t;for(;A.sibling===null;){if(A.return===null||A.return===e)break t;w===A&&(w=null),A=A.return}w===A&&(w=null),A.sibling.return=A.return,A=A.sibling}}break;case 19:dc(t,e),Qc(e),i&4&&UE(e);break;case 21:break;default:dc(t,e),Qc(e)}}function Qc(e){var t=e.flags;if(t&2){try{t:{for(var r=e.return;r!==null;){if(oL(r)){var i=r;break t}r=r.return}throw Error(Oe(160))}switch(i.tag){case 5:var n=i.stateNode;i.flags&32&&(qm(n,""),i.flags&=-33);var s=jE(e);Nw(e,s,n);break;case 3:case 4:var a=i.stateNode.containerInfo,o=jE(e);Dw(e,o,a);break;default:throw Error(Oe(161))}}catch(f){Wn(e,e.return,f)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function aN(e,t,r){cr=e,cL(e)}function cL(e,t,r){for(var i=(e.mode&1)!==0;cr!==null;){var n=cr,s=n.child;if(n.tag===22&&i){var a=n.memoizedState!==null||E1;if(!a){var o=n.alternate,f=o!==null&&o.memoizedState!==null||Ao;o=E1;var m=Ao;if(E1=a,(Ao=f)&&!m)for(cr=n;cr!==null;)a=cr,f=a.child,a.tag===22&&a.memoizedState!==null?qE(n):f!==null?(f.return=a,cr=f):qE(n);for(;s!==null;)cr=s,cL(s),s=s.sibling;cr=n,E1=o,Ao=m}GE(e)}else n.subtreeFlags&8772&&s!==null?(s.return=n,cr=s):GE(e)}}function GE(e){for(;cr!==null;){var t=cr;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ao||q_(5,t);break;case 1:var i=t.stateNode;if(t.flags&4&&!Ao)if(r===null)i.componentDidMount();else{var n=t.elementType===t.type?r.memoizedProps:mc(t.type,r.memoizedProps);i.componentDidUpdate(n,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&CE(t,s,i);break;case 3:var a=t.updateQueue;if(a!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}CE(t,a,r)}break;case 5:var o=t.stateNode;if(r===null&&t.flags&4){r=o;var f=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":f.autoFocus&&r.focus();break;case"img":f.src&&(r.src=f.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var m=t.alternate;if(m!==null){var w=m.memoizedState;if(w!==null){var A=w.dehydrated;A!==null&&Zm(A)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Oe(163))}Ao||t.flags&512&&Ow(t)}catch(P){Wn(t,t.return,P)}}if(t===e){cr=null;break}if(r=t.sibling,r!==null){r.return=t.return,cr=r;break}cr=t.return}}function VE(e){for(;cr!==null;){var t=cr;if(t===e){cr=null;break}var r=t.sibling;if(r!==null){r.return=t.return,cr=r;break}cr=t.return}}function qE(e){for(;cr!==null;){var t=cr;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{q_(4,t)}catch(f){Wn(t,r,f)}break;case 1:var i=t.stateNode;if(typeof i.componentDidMount=="function"){var n=t.return;try{i.componentDidMount()}catch(f){Wn(t,n,f)}}var s=t.return;try{Ow(t)}catch(f){Wn(t,s,f)}break;case 5:var a=t.return;try{Ow(t)}catch(f){Wn(t,a,f)}}}catch(f){Wn(t,t.return,f)}if(t===e){cr=null;break}var o=t.sibling;if(o!==null){o.return=t.return,cr=o;break}cr=t.return}}var lN=Math.ceil,n_=gh.ReactCurrentDispatcher,N5=gh.ReactCurrentOwner,Bl=gh.ReactCurrentBatchConfig,Ci=0,zs=null,us=null,Qs=0,Va=0,Pp=Cd(0),vs=0,s0=null,Af=0,H_=0,F5=0,Bm=null,pa=null,z5=0,ng=1/0,$u=null,s_=!1,Fw=null,fd=null,C1=!1,nd=null,o_=0,km=0,zw=null,my=-1,yy=0;function Ko(){return Ci&6?ns():my!==-1?my:my=ns()}function pd(e){return e.mode&1?Ci&2&&Qs!==0?Qs&-Qs:HD.transition!==null?(yy===0&&(yy=$4()),yy):(e=Vi,e!==0||(e=window.event,e=e===void 0?16:tM(e.type)),e):1}function Cc(e,t,r,i){if(50<km)throw km=0,zw=null,Error(Oe(185));w0(e,r,i),(!(Ci&2)||e!==zs)&&(e===zs&&(!(Ci&2)&&(H_|=r),vs===4&&rd(e,Qs)),ba(e,i),r===1&&Ci===0&&!(t.mode&1)&&(ng=ns()+500,U_&&Td()))}function ba(e,t){var r=e.callbackNode;H8(e,t);var i=Vy(e,e===zs?Qs:0);if(i===0)r!==null&&Q3(r),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(r!=null&&Q3(r),t===1)e.tag===0?qD(HE.bind(null,e)):vM(HE.bind(null,e)),jD(function(){!(Ci&6)&&Td()}),r=null;else{switch(Z4(i)){case 1:r=h5;break;case 4:r=H4;break;case 16:r=Gy;break;case 536870912:r=W4;break;default:r=Gy}r=yL(r,uL.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function uL(e,t){if(my=-1,yy=0,Ci&6)throw Error(Oe(327));var r=e.callbackNode;if(jp()&&e.callbackNode!==r)return null;var i=Vy(e,e===zs?Qs:0);if(i===0)return null;if(i&30||i&e.expiredLanes||t)t=a_(e,i);else{t=i;var n=Ci;Ci|=2;var s=dL();(zs!==e||Qs!==t)&&($u=null,ng=ns()+500,gf(e,t));do try{hN();break}catch(o){hL(e,o)}while(1);S5(),n_.current=s,Ci=n,us!==null?t=0:(zs=null,Qs=0,t=vs)}if(t!==0){if(t===2&&(n=dw(e),n!==0&&(i=n,t=jw(e,n))),t===1)throw r=s0,gf(e,0),rd(e,i),ba(e,ns()),r;if(t===6)rd(e,i);else{if(n=e.current.alternate,!(i&30)&&!cN(n)&&(t=a_(e,i),t===2&&(s=dw(e),s!==0&&(i=s,t=jw(e,s))),t===1))throw r=s0,gf(e,0),rd(e,i),ba(e,ns()),r;switch(e.finishedWork=n,e.finishedLanes=i,t){case 0:case 1:throw Error(Oe(345));case 2:tf(e,pa,$u);break;case 3:if(rd(e,i),(i&130023424)===i&&(t=z5+500-ns(),10<t)){if(Vy(e,0)!==0)break;if(n=e.suspendedLanes,(n&i)!==i){Ko(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=bw(tf.bind(null,e,pa,$u),t);break}tf(e,pa,$u);break;case 4:if(rd(e,i),(i&4194240)===i)break;for(t=e.eventTimes,n=-1;0<i;){var a=31-Ec(i);s=1<<a,a=t[a],a>n&&(n=a),i&=~s}if(i=n,i=ns()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*lN(i/1960))-i,10<i){e.timeoutHandle=bw(tf.bind(null,e,pa,$u),i);break}tf(e,pa,$u);break;case 5:tf(e,pa,$u);break;default:throw Error(Oe(329))}}}return ba(e,ns()),e.callbackNode===r?uL.bind(null,e):null}function jw(e,t){var r=Bm;return e.current.memoizedState.isDehydrated&&(gf(e,t).flags|=256),e=a_(e,t),e!==2&&(t=pa,pa=r,t!==null&&Uw(t)),e}function Uw(e){pa===null?pa=e:pa.push.apply(pa,e)}function cN(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var n=r[i],s=n.getSnapshot;n=n.value;try{if(!Ic(s(),n))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function rd(e,t){for(t&=~F5,t&=~H_,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Ec(t),i=1<<r;e[r]=-1,t&=~i}}function HE(e){if(Ci&6)throw Error(Oe(327));jp();var t=Vy(e,0);if(!(t&1))return ba(e,ns()),null;var r=a_(e,t);if(e.tag!==0&&r===2){var i=dw(e);i!==0&&(t=i,r=jw(e,i))}if(r===1)throw r=s0,gf(e,0),rd(e,t),ba(e,ns()),r;if(r===6)throw Error(Oe(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,tf(e,pa,$u),ba(e,ns()),null}function j5(e,t){var r=Ci;Ci|=1;try{return e(t)}finally{Ci=r,Ci===0&&(ng=ns()+500,U_&&Td())}}function Sf(e){nd!==null&&nd.tag===0&&!(Ci&6)&&jp();var t=Ci;Ci|=1;var r=Bl.transition,i=Vi;try{if(Bl.transition=null,Vi=1,e)return e()}finally{Vi=i,Bl.transition=r,Ci=t,!(Ci&6)&&Td()}}function U5(){Va=Pp.current,_n(Pp)}function gf(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,zD(r)),us!==null)for(r=us.return;r!==null;){var i=r;switch(w5(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Zy();break;case 3:rg(),_n(_a),_n(So),M5();break;case 5:I5(i);break;case 4:rg();break;case 13:_n(Ln);break;case 19:_n(Ln);break;case 10:E5(i.type._context);break;case 22:case 23:U5()}r=r.return}if(zs=e,us=e=gd(e.current,null),Qs=Va=t,vs=0,s0=null,F5=H_=Af=0,pa=Bm=null,cf!==null){for(t=0;t<cf.length;t++)if(r=cf[t],i=r.interleaved,i!==null){r.interleaved=null;var n=i.next,s=r.pending;if(s!==null){var a=s.next;s.next=n,i.next=a}r.pending=i}cf=null}return e}function hL(e,t){do{var r=us;try{if(S5(),fy.current=i_,r_){for(var i=kn.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}r_=!1}if(xf=0,Os=_s=kn=null,Mm=!1,r0=0,N5.current=null,r===null||r.return===null){vs=1,s0=t,us=null;break}t:{var s=e,a=r.return,o=r,f=t;if(t=Qs,o.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){var m=f,w=o,A=w.tag;if(!(w.mode&1)&&(A===0||A===11||A===15)){var P=w.alternate;P?(w.updateQueue=P.updateQueue,w.memoizedState=P.memoizedState,w.lanes=P.lanes):(w.updateQueue=null,w.memoizedState=null)}var I=BE(a);if(I!==null){I.flags&=-257,kE(I,a,o,s,t),I.mode&1&&LE(s,m,t),t=I,f=m;var N=t.updateQueue;if(N===null){var F=new Set;F.add(f),t.updateQueue=F}else N.add(f);break t}else{if(!(t&1)){LE(s,m,t),G5();break t}f=Error(Oe(426))}}else if(wn&&o.mode&1){var Z=BE(a);if(Z!==null){!(Z.flags&65536)&&(Z.flags|=256),kE(Z,a,o,s,t),x5(ig(f,o));break t}}s=f=ig(f,o),vs!==4&&(vs=2),Bm===null?Bm=[s]:Bm.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var U=ZM(s,f,t);EE(s,U);break t;case 1:o=f;var z=s.type,J=s.stateNode;if(!(s.flags&128)&&(typeof z.getDerivedStateFromError=="function"||J!==null&&typeof J.componentDidCatch=="function"&&(fd===null||!fd.has(J)))){s.flags|=65536,t&=-t,s.lanes|=t;var nt=JM(s,o,t);EE(s,nt);break t}}s=s.return}while(s!==null)}pL(r)}catch(mt){t=mt,us===r&&r!==null&&(us=r=r.return);continue}break}while(1)}function dL(){var e=n_.current;return n_.current=i_,e===null?i_:e}function G5(){(vs===0||vs===3||vs===2)&&(vs=4),zs===null||!(Af&268435455)&&!(H_&268435455)||rd(zs,Qs)}function a_(e,t){var r=Ci;Ci|=2;var i=dL();(zs!==e||Qs!==t)&&($u=null,gf(e,t));do try{uN();break}catch(n){hL(e,n)}while(1);if(S5(),Ci=r,n_.current=i,us!==null)throw Error(Oe(261));return zs=null,Qs=0,vs}function uN(){for(;us!==null;)fL(us)}function hN(){for(;us!==null&&!D8();)fL(us)}function fL(e){var t=mL(e.alternate,e,Va);e.memoizedProps=e.pendingProps,t===null?pL(e):us=t,N5.current=null}function pL(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=nN(r,t),r!==null){r.flags&=32767,us=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{vs=6,us=null;return}}else if(r=iN(r,t,Va),r!==null){us=r;return}if(t=t.sibling,t!==null){us=t;return}us=t=e}while(t!==null);vs===0&&(vs=5)}function tf(e,t,r){var i=Vi,n=Bl.transition;try{Bl.transition=null,Vi=1,dN(e,t,r,i)}finally{Bl.transition=n,Vi=i}return null}function dN(e,t,r,i){do jp();while(nd!==null);if(Ci&6)throw Error(Oe(327));r=e.finishedWork;var n=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Oe(177));e.callbackNode=null,e.callbackPriority=0;var s=r.lanes|r.childLanes;if(W8(e,s),e===zs&&(us=zs=null,Qs=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||C1||(C1=!0,yL(Gy,function(){return jp(),null})),s=(r.flags&15990)!==0,r.subtreeFlags&15990||s){s=Bl.transition,Bl.transition=null;var a=Vi;Vi=1;var o=Ci;Ci|=4,N5.current=null,oN(e,r),lL(r,e),BD(_w),qy=!!yw,_w=yw=null,e.current=r,aN(r),N8(),Ci=o,Vi=a,Bl.transition=s}else e.current=r;if(C1&&(C1=!1,nd=e,o_=n),s=e.pendingLanes,s===0&&(fd=null),j8(r.stateNode),ba(e,ns()),t!==null)for(i=e.onRecoverableError,r=0;r<t.length;r++)n=t[r],i(n.value,{componentStack:n.stack,digest:n.digest});if(s_)throw s_=!1,e=Fw,Fw=null,e;return o_&1&&e.tag!==0&&jp(),s=e.pendingLanes,s&1?e===zw?km++:(km=0,zw=e):km=0,Td(),null}function jp(){if(nd!==null){var e=Z4(o_),t=Bl.transition,r=Vi;try{if(Bl.transition=null,Vi=16>e?16:e,nd===null)var i=!1;else{if(e=nd,nd=null,o_=0,Ci&6)throw Error(Oe(331));var n=Ci;for(Ci|=4,cr=e.current;cr!==null;){var s=cr,a=s.child;if(cr.flags&16){var o=s.deletions;if(o!==null){for(var f=0;f<o.length;f++){var m=o[f];for(cr=m;cr!==null;){var w=cr;switch(w.tag){case 0:case 11:case 15:Lm(8,w,s)}var A=w.child;if(A!==null)A.return=w,cr=A;else for(;cr!==null;){w=cr;var P=w.sibling,I=w.return;if(sL(w),w===m){cr=null;break}if(P!==null){P.return=I,cr=P;break}cr=I}}}var N=s.alternate;if(N!==null){var F=N.child;if(F!==null){N.child=null;do{var Z=F.sibling;F.sibling=null,F=Z}while(F!==null)}}cr=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,cr=a;else t:for(;cr!==null;){if(s=cr,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Lm(9,s,s.return)}var U=s.sibling;if(U!==null){U.return=s.return,cr=U;break t}cr=s.return}}var z=e.current;for(cr=z;cr!==null;){a=cr;var J=a.child;if(a.subtreeFlags&2064&&J!==null)J.return=a,cr=J;else t:for(a=z;cr!==null;){if(o=cr,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:q_(9,o)}}catch(mt){Wn(o,o.return,mt)}if(o===a){cr=null;break t}var nt=o.sibling;if(nt!==null){nt.return=o.return,cr=nt;break t}cr=o.return}}if(Ci=n,Td(),pu&&typeof pu.onPostCommitFiberRoot=="function")try{pu.onPostCommitFiberRoot(D_,e)}catch{}i=!0}return i}finally{Vi=r,Bl.transition=t}}return!1}function WE(e,t,r){t=ig(r,t),t=ZM(e,t,1),e=dd(e,t,1),t=Ko(),e!==null&&(w0(e,1,t),ba(e,t))}function Wn(e,t,r){if(e.tag===3)WE(e,e,r);else for(;t!==null;){if(t.tag===3){WE(t,e,r);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(fd===null||!fd.has(i))){e=ig(r,e),e=JM(t,e,1),t=dd(t,e,1),e=Ko(),t!==null&&(w0(t,1,e),ba(t,e));break}}t=t.return}}function fN(e,t,r){var i=e.pingCache;i!==null&&i.delete(t),t=Ko(),e.pingedLanes|=e.suspendedLanes&r,zs===e&&(Qs&r)===r&&(vs===4||vs===3&&(Qs&130023424)===Qs&&500>ns()-z5?gf(e,0):F5|=r),ba(e,t)}function gL(e,t){t===0&&(e.mode&1?(t=m1,m1<<=1,!(m1&130023424)&&(m1=4194304)):t=1);var r=Ko();e=ch(e,t),e!==null&&(w0(e,t,r),ba(e,r))}function pN(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),gL(e,r)}function gN(e,t){var r=0;switch(e.tag){case 13:var i=e.stateNode,n=e.memoizedState;n!==null&&(r=n.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(Oe(314))}i!==null&&i.delete(t),gL(e,r)}var mL;mL=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||_a.current)ma=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return ma=!1,rN(e,t,r);ma=!!(e.flags&131072)}else ma=!1,wn&&t.flags&1048576&&bM(t,Ky,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;gy(e,t),e=t.pendingProps;var n=Qp(t,So.current);zp(t,r),n=B5(null,t,i,e,n,r);var s=k5();return t.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,va(i)?(s=!0,Jy(t)):s=!1,t.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,T5(t),n.updater=V_,t.stateNode=n,n._reactInternals=t,Tw(t,i,e,r),t=Mw(null,t,i,!0,s,r)):(t.tag=0,wn&&s&&b5(t),Wo(null,t,n,r),t=t.child),t;case 16:i=t.elementType;t:{switch(gy(e,t),e=t.pendingProps,n=i._init,i=n(i._payload),t.type=i,n=t.tag=yN(i),e=mc(i,e),n){case 0:t=Iw(null,t,i,e,r);break t;case 1:t=DE(null,t,i,e,r);break t;case 11:t=RE(null,t,i,e,r);break t;case 14:t=OE(null,t,i,mc(i.type,e),r);break t}throw Error(Oe(306,i,""))}return t;case 0:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:mc(i,n),Iw(e,t,i,n,r);case 1:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:mc(i,n),DE(e,t,i,n,r);case 3:t:{if(QM(t),e===null)throw Error(Oe(387));i=t.pendingProps,s=t.memoizedState,n=s.element,CM(e,t),t_(t,i,null,r);var a=t.memoizedState;if(i=a.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){n=ig(Error(Oe(423)),t),t=NE(e,t,i,r,n);break t}else if(i!==n){n=ig(Error(Oe(424)),t),t=NE(e,t,i,r,n);break t}else for(Ha=hd(t.stateNode.containerInfo.firstChild),$a=t,wn=!0,bc=null,r=SM(t,null,i,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(tg(),i===n){t=uh(e,t,r);break t}Wo(e,t,i,r)}t=t.child}return t;case 5:return TM(t),e===null&&Sw(t),i=t.type,n=t.pendingProps,s=e!==null?e.memoizedProps:null,a=n.children,vw(i,n)?a=null:s!==null&&vw(i,s)&&(t.flags|=32),YM(e,t),Wo(e,t,a,r),t.child;case 6:return e===null&&Sw(t),null;case 13:return tL(e,t,r);case 4:return P5(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=eg(t,null,i,r):Wo(e,t,i,r),t.child;case 11:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:mc(i,n),RE(e,t,i,n,r);case 7:return Wo(e,t,t.pendingProps,r),t.child;case 8:return Wo(e,t,t.pendingProps.children,r),t.child;case 12:return Wo(e,t,t.pendingProps.children,r),t.child;case 10:t:{if(i=t.type._context,n=t.pendingProps,s=t.memoizedProps,a=n.value,cn(Yy,i._currentValue),i._currentValue=a,s!==null)if(Ic(s.value,a)){if(s.children===n.children&&!_a.current){t=uh(e,t,r);break t}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var f=o.firstContext;f!==null;){if(f.context===i){if(s.tag===1){f=ih(-1,r&-r),f.tag=2;var m=s.updateQueue;if(m!==null){m=m.shared;var w=m.pending;w===null?f.next=f:(f.next=w.next,w.next=f),m.pending=f}}s.lanes|=r,f=s.alternate,f!==null&&(f.lanes|=r),Ew(s.return,r,t),o.lanes|=r;break}f=f.next}}else if(s.tag===10)a=s.type===t.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(Oe(341));a.lanes|=r,o=a.alternate,o!==null&&(o.lanes|=r),Ew(a,r,t),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===t){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}Wo(e,t,n.children,r),t=t.child}return t;case 9:return n=t.type,i=t.pendingProps.children,zp(t,r),n=Ol(n),i=i(n),t.flags|=1,Wo(e,t,i,r),t.child;case 14:return i=t.type,n=mc(i,t.pendingProps),n=mc(i.type,n),OE(e,t,i,n,r);case 15:return XM(e,t,t.type,t.pendingProps,r);case 17:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:mc(i,n),gy(e,t),t.tag=1,va(i)?(e=!0,Jy(t)):e=!1,zp(t,r),$M(t,i,n),Tw(t,i,n,r),Mw(null,t,i,!0,e,r);case 19:return eL(e,t,r);case 22:return KM(e,t,r)}throw Error(Oe(156,t.tag))};function yL(e,t){return q4(e,t)}function mN(e,t,r,i){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pl(e,t,r,i){return new mN(e,t,r,i)}function V5(e){return e=e.prototype,!(!e||!e.isReactComponent)}function yN(e){if(typeof e=="function")return V5(e)?1:0;if(e!=null){if(e=e.$$typeof,e===l5)return 11;if(e===c5)return 14}return 2}function gd(e,t){var r=e.alternate;return r===null?(r=Pl(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function _y(e,t,r,i,n,s){var a=2;if(i=e,typeof e=="function")V5(e)&&(a=1);else if(typeof e=="string")a=5;else t:switch(e){case _p:return mf(r.children,n,s,t);case a5:a=8,n|=8;break;case K2:return e=Pl(12,r,t,n|2),e.elementType=K2,e.lanes=s,e;case Y2:return e=Pl(13,r,t,n),e.elementType=Y2,e.lanes=s,e;case Q2:return e=Pl(19,r,t,n),e.elementType=Q2,e.lanes=s,e;case T4:return W_(r,n,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case E4:a=10;break t;case C4:a=9;break t;case l5:a=11;break t;case c5:a=14;break t;case Yh:a=16,i=null;break t}throw Error(Oe(130,e==null?e:typeof e,""))}return t=Pl(a,r,t,n),t.elementType=e,t.type=i,t.lanes=s,t}function mf(e,t,r,i){return e=Pl(7,e,i,t),e.lanes=r,e}function W_(e,t,r,i){return e=Pl(22,e,i,t),e.elementType=T4,e.lanes=r,e.stateNode={isHidden:!1},e}function Ib(e,t,r){return e=Pl(6,e,null,t),e.lanes=r,e}function Mb(e,t,r){return t=Pl(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function _N(e,t,r,i,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ub(0),this.expirationTimes=ub(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ub(0),this.identifierPrefix=i,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function q5(e,t,r,i,n,s,a,o,f){return e=new _N(e,t,r,o,f),t===1?(t=1,s===!0&&(t|=8)):t=0,s=Pl(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},T5(s),e}function vN(e,t,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yp,key:i==null?null:""+i,children:e,containerInfo:t,implementation:r}}function _L(e){if(!e)return vd;e=e._reactInternals;t:{if(Mf(e)!==e||e.tag!==1)throw Error(Oe(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break t;case 1:if(va(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break t}}t=t.return}while(t!==null);throw Error(Oe(171))}if(e.tag===1){var r=e.type;if(va(r))return _M(e,r,t)}return t}function vL(e,t,r,i,n,s,a,o,f){return e=q5(r,i,!0,e,n,s,a,o,f),e.context=_L(null),r=e.current,i=Ko(),n=pd(r),s=ih(i,n),s.callback=t??null,dd(r,s,n),e.current.lanes=n,w0(e,n,i),ba(e,i),e}function $_(e,t,r,i){var n=t.current,s=Ko(),a=pd(n);return r=_L(r),t.context===null?t.context=r:t.pendingContext=r,t=ih(s,a),t.payload={element:e},i=i===void 0?null:i,i!==null&&(t.callback=i),e=dd(n,t,a),e!==null&&(Cc(e,n,a,s),dy(e,n,a)),a}function l_(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function $E(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function H5(e,t){$E(e,t),(e=e.alternate)&&$E(e,t)}function bN(){return null}var bL=typeof reportError=="function"?reportError:function(e){console.error(e)};function W5(e){this._internalRoot=e}Z_.prototype.render=W5.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Oe(409));$_(e,t,null,null)};Z_.prototype.unmount=W5.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Sf(function(){$_(null,e,null,null)}),t[lh]=null}};function Z_(e){this._internalRoot=e}Z_.prototype.unstable_scheduleHydration=function(e){if(e){var t=K4();e={blockedOn:null,target:e,priority:t};for(var r=0;r<ed.length&&t!==0&&t<ed[r].priority;r++);ed.splice(r,0,e),r===0&&Q4(e)}};function $5(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function J_(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function ZE(){}function wN(e,t,r,i,n){if(n){if(typeof i=="function"){var s=i;i=function(){var m=l_(a);s.call(m)}}var a=vL(t,i,e,0,null,!1,!1,"",ZE);return e._reactRootContainer=a,e[lh]=a.current,Km(e.nodeType===8?e.parentNode:e),Sf(),a}for(;n=e.lastChild;)e.removeChild(n);if(typeof i=="function"){var o=i;i=function(){var m=l_(f);o.call(m)}}var f=q5(e,0,!1,null,null,!1,!1,"",ZE);return e._reactRootContainer=f,e[lh]=f.current,Km(e.nodeType===8?e.parentNode:e),Sf(function(){$_(t,f,r,i)}),f}function X_(e,t,r,i,n){var s=r._reactRootContainer;if(s){var a=s;if(typeof n=="function"){var o=n;n=function(){var f=l_(a);o.call(f)}}$_(t,a,e,n)}else a=wN(r,t,e,n,i);return l_(a)}J4=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=vm(t.pendingLanes);r!==0&&(d5(t,r|1),ba(t,ns()),!(Ci&6)&&(ng=ns()+500,Td()))}break;case 13:Sf(function(){var i=ch(e,1);if(i!==null){var n=Ko();Cc(i,e,1,n)}}),H5(e,1)}};f5=function(e){if(e.tag===13){var t=ch(e,134217728);if(t!==null){var r=Ko();Cc(t,e,134217728,r)}H5(e,134217728)}};X4=function(e){if(e.tag===13){var t=pd(e),r=ch(e,t);if(r!==null){var i=Ko();Cc(r,e,t,i)}H5(e,t)}};K4=function(){return Vi};Y4=function(e,t){var r=Vi;try{return Vi=e,t()}finally{Vi=r}};cw=function(e,t,r){switch(t){case"input":if(rw(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var i=r[t];if(i!==e&&i.form===e.form){var n=j_(i);if(!n)throw Error(Oe(90));I4(i),rw(i,n)}}}break;case"textarea":L4(e,r);break;case"select":t=r.value,t!=null&&Op(e,!!r.multiple,t,!1)}};F4=j5;z4=Sf;var xN={usingClientEntryPoint:!1,Events:[A0,xp,j_,D4,N4,j5]},Yg={findFiberByHostInstance:lf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},AN={bundleType:Yg.bundleType,version:Yg.version,rendererPackageName:Yg.rendererPackageName,rendererConfig:Yg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:gh.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=G4(e),e===null?null:e.stateNode},findFiberByHostInstance:Yg.findFiberByHostInstance||bN,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var T1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!T1.isDisabled&&T1.supportsFiber)try{D_=T1.inject(AN),pu=T1}catch{}}Ka.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=xN;Ka.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!$5(t))throw Error(Oe(200));return vN(e,t,null,r)};Ka.createRoot=function(e,t){if(!$5(e))throw Error(Oe(299));var r=!1,i="",n=bL;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(n=t.onRecoverableError)),t=q5(e,1,!1,null,null,r,!1,i,n),e[lh]=t.current,Km(e.nodeType===8?e.parentNode:e),new W5(t)};Ka.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Oe(188)):(e=Object.keys(e).join(","),Error(Oe(268,e)));return e=G4(t),e=e===null?null:e.stateNode,e};Ka.flushSync=function(e){return Sf(e)};Ka.hydrate=function(e,t,r){if(!J_(t))throw Error(Oe(200));return X_(null,e,t,!0,r)};Ka.hydrateRoot=function(e,t,r){if(!$5(e))throw Error(Oe(405));var i=r!=null&&r.hydratedSources||null,n=!1,s="",a=bL;if(r!=null&&(r.unstable_strictMode===!0&&(n=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(a=r.onRecoverableError)),t=vL(t,null,e,1,r??null,n,!1,s,a),e[lh]=t.current,Km(e),i)for(e=0;e<i.length;e++)r=i[e],n=r._getVersion,n=n(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,n]:t.mutableSourceEagerHydrationData.push(r,n);return new Z_(t)};Ka.render=function(e,t,r){if(!J_(t))throw Error(Oe(200));return X_(null,e,t,!1,r)};Ka.unmountComponentAtNode=function(e){if(!J_(e))throw Error(Oe(40));return e._reactRootContainer?(Sf(function(){X_(null,null,e,!1,function(){e._reactRootContainer=null,e[lh]=null})}),!0):!1};Ka.unstable_batchedUpdates=j5;Ka.unstable_renderSubtreeIntoContainer=function(e,t,r,i){if(!J_(r))throw Error(Oe(200));if(e==null||e._reactInternals===void 0)throw Error(Oe(38));return X_(e,t,r,!1,i)};Ka.version="18.3.1-next-f1338f8080-20240426";function wL(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(wL)}catch(e){console.error(e)}}wL(),w4.exports=Ka;var SN=w4.exports,JE=SN;J2.createRoot=JE.createRoot,J2.hydrateRoot=JE.hydrateRoot;const EN="modulepreload",CN=function(e){return"/basic-mapicgc-gl-js-viewer-react/"+e},XE={},Gw=function(t,r,i){if(!r||r.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(r.map(s=>{if(s=CN(s),s in XE)return;XE[s]=!0;const a=s.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!i)for(let w=n.length-1;w>=0;w--){const A=n[w];if(A.href===s&&(!a||A.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${o}`))return;const m=document.createElement("link");if(m.rel=a?"stylesheet":EN,a||(m.as="script",m.crossOrigin=""),m.href=s,document.head.appendChild(m),a)return new Promise((w,A)=>{m.addEventListener("load",w),m.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})};function TN(e,t){for(var r=0;r<t.length;r++){const i=t[r];if(typeof i!="string"&&!Array.isArray(i)){for(const n in i)if(n!=="default"&&!(n in e)){const s=Object.getOwnPropertyDescriptor(i,n);s&&Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:()=>i[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}var Ip=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function K_(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var xL={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(Ip,function(){var r={},i={};function n(a,o,f){if(i[a]=f,a==="index"){var m="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",w={};return i.shared(w),i.index(r,w),typeof window<"u"&&r.setWorkerUrl(window.URL.createObjectURL(new Blob([m],{type:"text/javascript"}))),r}}n("shared",["exports"],function(a){function o(u,l,h,p){return new(h||(h=Promise))(function(v,E){function T(V){try{R(p.next(V))}catch(W){E(W)}}function L(V){try{R(p.throw(V))}catch(W){E(W)}}function R(V){var W;V.done?v(V.value):(W=V.value,W instanceof h?W:new h(function(K){K(W)})).then(T,L)}R((p=p.apply(u,l||[])).next())})}function f(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}typeof SuppressedError=="function"&&SuppressedError;var m=w;function w(u,l){this.x=u,this.y=l}w.prototype={clone:function(){return new w(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,l){return this.clone()._rotateAround(u,l)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var l=u.x-this.x,h=u.y-this.y;return l*l+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,l){return Math.atan2(this.x*l-this.y*u,this.x*u+this.y*l)},_matMult:function(u){var l=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=l,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var l=Math.cos(u),h=Math.sin(u),p=h*this.x+l*this.y;return this.x=l*this.x-h*this.y,this.y=p,this},_rotateAround:function(u,l){var h=Math.cos(u),p=Math.sin(u),v=l.y+p*(this.x-l.x)+h*(this.y-l.y);return this.x=l.x+h*(this.x-l.x)-p*(this.y-l.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},w.convert=function(u){return u instanceof w?u:Array.isArray(u)?new w(u[0],u[1]):u};var A=f(m),P=I;function I(u,l,h,p){this.cx=3*u,this.bx=3*(h-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(p-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=l,this.p2x=h,this.p2y=p}I.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,l){if(l===void 0&&(l=1e-6),u<0)return 0;if(u>1)return 1;for(var h=u,p=0;p<8;p++){var v=this.sampleCurveX(h)-u;if(Math.abs(v)<l)return h;var E=this.sampleCurveDerivativeX(h);if(Math.abs(E)<1e-6)break;h-=v/E}var T=0,L=1;for(h=u,p=0;p<20&&(v=this.sampleCurveX(h),!(Math.abs(v-u)<l));p++)u>v?T=h:L=h,h=.5*(L-T)+T;return h},solve:function(u,l){return this.sampleCurveY(this.solveCurveX(u,l))}};var N=f(P);let F,Z;function U(){return F==null&&(F=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),F}function z(){if(Z==null&&(Z=!1,U())){const u=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(u){for(let h=0;h<5*5;h++){const p=4*h;u.fillStyle=`rgb(${p},${p+1},${p+2})`,u.fillRect(h%5,Math.floor(h/5),1,1)}const l=u.getImageData(0,0,5,5).data;for(let h=0;h<5*5*4;h++)if(h%4!=3&&l[h]!==h){Z=!0;break}}}return Z||!1}function J(u,l,h,p){const v=new N(u,l,h,p);return function(E){return v.solve(E)}}const nt=J(.25,.1,.25,1);function mt(u,l,h){return Math.min(h,Math.max(l,u))}function Et(u,l,h){const p=h-l,v=((u-l)%p+p)%p+l;return v===l?h:v}function bt(u){for(var l=arguments.length,h=new Array(l>1?l-1:0),p=1;p<l;p++)h[p-1]=arguments[p];for(const v of h)for(const E in v)u[E]=v[E];return u}let pt=1;function zt(u,l,h){const p={};for(const v in u)p[v]=l.call(h||this,u[v],v,u);return p}function Rt(u,l,h){const p={};for(const v in u)l.call(h||this,u[v],v,u)&&(p[v]=u[v]);return p}function at(u){return Array.isArray(u)?u.map(at):typeof u=="object"&&u?zt(u,at):u}const dt={};function kt(u){dt[u]||(typeof console<"u"&&console.warn(u),dt[u]=!0)}function xt(u,l,h){return(h.y-u.y)*(l.x-u.x)>(l.y-u.y)*(h.x-u.x)}function ue(u){let l=0;for(let h,p,v=0,E=u.length,T=E-1;v<E;T=v++)h=u[v],p=u[T],l+=(p.x-h.x)*(h.y+p.y);return l}function oe(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let he=null;function Dt(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const Qt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ee(u,l,h,p,v){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const E=new VideoFrame(u,{timestamp:0});try{const T=E==null?void 0:E.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const L=T.startsWith("BGR"),R=new Uint8ClampedArray(p*v*4);if(yield E.copyTo(R,function(V,W,K,rt,lt){const ut=4*Math.max(-W,0),_t=(Math.max(0,K)-K)*rt*4+ut,Pt=4*rt,Ot=Math.max(0,W),Yt=Math.max(0,K);return{rect:{x:Ot,y:Yt,width:Math.min(V.width,W+rt)-Ot,height:Math.min(V.height,K+lt)-Yt},layout:[{offset:_t,stride:Pt}]}}(u,l,h,p,v)),L)for(let V=0;V<R.length;V+=4){const W=R[V];R[V]=R[V+2],R[V+2]=W}return R}finally{E.close()}})}let xe,it;const Tt="AbortError";function Lt(){return new Error(Tt)}const Ut={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Zt(u){return Ut.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const Kt="global-dispatcher";class ne extends Error{constructor(l,h,p,v){super(`AJAXError: ${h} (${l}): ${p}`),this.status=l,this.statusText=h,this.url=p,this.body=v}}const re=()=>oe(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Se=function(u,l){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const p=Zt(u.url);if(p)return p(u,l);if(oe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:Kt},l)}if(!(/^file:/.test(h=u.url)||/^file:/.test(re())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,v){return o(this,void 0,void 0,function*(){const E=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:re(),signal:v.signal});p.type==="json"&&E.headers.set("Accept","application/json");const T=yield fetch(E);if(!T.ok){const V=yield T.blob();throw new ne(T.status,T.statusText,p.url,V)}let L;L=p.type==="arrayBuffer"||p.type==="image"?T.arrayBuffer():p.type==="json"?T.json():T.text();const R=yield L;if(v.signal.aborted)throw Lt();return{data:R,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}})}(u,l);if(oe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:Kt},l)}var h;return function(p,v){return new Promise((E,T)=>{const L=new XMLHttpRequest;L.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(L.responseType="arraybuffer");for(const R in p.headers)L.setRequestHeader(R,p.headers[R]);p.type==="json"&&(L.responseType="text",L.setRequestHeader("Accept","application/json")),L.withCredentials=p.credentials==="include",L.onerror=()=>{T(new Error(L.statusText))},L.onload=()=>{if(!v.signal.aborted)if((L.status>=200&&L.status<300||L.status===0)&&L.response!==null){let R=L.response;if(p.type==="json")try{R=JSON.parse(L.response)}catch(V){return void T(V)}E({data:R,cacheControl:L.getResponseHeader("Cache-Control"),expires:L.getResponseHeader("Expires")})}else{const R=new Blob([L.response],{type:L.getResponseHeader("Content-Type")});T(new ne(L.status,L.statusText,p.url,R))}},v.signal.addEventListener("abort",()=>{L.abort(),T(Lt())}),L.send(p.body)})}(u,l)};function Be(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const l=new URL(u),h=window.location;return l.protocol===h.protocol&&l.host===h.host}function ze(u,l,h){h[u]&&h[u].indexOf(l)!==-1||(h[u]=h[u]||[],h[u].push(l))}function Ve(u,l,h){if(h&&h[u]){const p=h[u].indexOf(l);p!==-1&&h[u].splice(p,1)}}class Xe{constructor(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};bt(this,h),this.type=l}}class ge extends Xe{constructor(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",bt({error:l},h))}}class Bt{on(l,h){return this._listeners=this._listeners||{},ze(l,h,this._listeners),this}off(l,h){return Ve(l,h,this._listeners),Ve(l,h,this._oneTimeListeners),this}once(l,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},ze(l,h,this._oneTimeListeners),this):new Promise(p=>this.once(l,p))}fire(l,h){typeof l=="string"&&(l=new Xe(l,h||{}));const p=l.type;if(this.listens(p)){l.target=this;const v=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const L of v)L.call(this,l);const E=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const L of E)Ve(p,L,this._oneTimeListeners),L.call(this,l);const T=this._eventedParent;T&&(bt(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(l))}else l instanceof ge&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,h){return this._eventedParent=l,this._eventedParentData=h,this}}var Xt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ir=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ie(u,l){const h={};for(const p in u)p!=="ref"&&(h[p]=u[p]);return ir.forEach(p=>{p in l&&(h[p]=l[p])}),h}function ve(u,l){if(Array.isArray(u)){if(!Array.isArray(l)||u.length!==l.length)return!1;for(let h=0;h<u.length;h++)if(!ve(u[h],l[h]))return!1;return!0}if(typeof u=="object"&&u!==null&&l!==null){if(typeof l!="object"||Object.keys(u).length!==Object.keys(l).length)return!1;for(const h in u)if(!ve(u[h],l[h]))return!1;return!0}return u===l}function Ce(u,l){u.push(l)}function qe(u,l,h){Ce(h,{command:"addSource",args:[u,l[u]]})}function lr(u,l,h){Ce(l,{command:"removeSource",args:[u]}),h[u]=!0}function Er(u,l,h,p){lr(u,h,p),qe(u,l,h)}function Ir(u,l,h){let p;for(p in u[h])if(Object.prototype.hasOwnProperty.call(u[h],p)&&p!=="data"&&!ve(u[h][p],l[h][p]))return!1;for(p in l[h])if(Object.prototype.hasOwnProperty.call(l[h],p)&&p!=="data"&&!ve(u[h][p],l[h][p]))return!1;return!0}function Mr(u,l,h,p,v,E){u=u||{},l=l||{};for(const T in u)Object.prototype.hasOwnProperty.call(u,T)&&(ve(u[T],l[T])||h.push({command:E,args:[p,T,l[T],v]}));for(const T in l)Object.prototype.hasOwnProperty.call(l,T)&&!Object.prototype.hasOwnProperty.call(u,T)&&(ve(u[T],l[T])||h.push({command:E,args:[p,T,l[T],v]}))}function Wr(u){return u.id}function Jr(u,l){return u[l.id]=l,u}class de{constructor(l,h,p,v){this.message=(l?`${l}: `:"")+p,v&&(this.identifier=v),h!=null&&h.__line__&&(this.line=h.__line__)}}function Tr(u){for(var l=arguments.length,h=new Array(l>1?l-1:0),p=1;p<l;p++)h[p-1]=arguments[p];for(const v of h)for(const E in v)u[E]=v[E];return u}class Re extends Error{constructor(l,h){super(h),this.message=h,this.key=l}}class Hi{constructor(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=l,this.bindings={};for(const[p,v]of h)this.bindings[p]=v}concat(l){return new Hi(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}const Pr={kind:"null"},Pe={kind:"number"},Ye={kind:"string"},tr={kind:"boolean"},fi={kind:"color"},Fr={kind:"object"},wr={kind:"value"},bi={kind:"collator"},ai={kind:"formatted"},At={kind:"padding"},Y={kind:"resolvedImage"},Q={kind:"variableAnchorOffsetCollection"};function ot(u,l){return{kind:"array",itemType:u,N:l}}function wt(u){if(u.kind==="array"){const l=wt(u.itemType);return typeof u.N=="number"?`array<${l}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${l}>`}return u.kind}const Nt=[Pr,Pe,Ye,tr,fi,ai,Fr,ot(wr),At,Y,Q];function Gt(u,l){if(l.kind==="error")return null;if(u.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!Gt(u.itemType,l.itemType))&&(typeof u.N!="number"||u.N===l.N))return null}else{if(u.kind===l.kind)return null;if(u.kind==="value"){for(const h of Nt)if(!Gt(h,l))return null}}return`Expected ${wt(u)} but found ${wt(l)} instead.`}function Ht(u,l){return l.some(h=>h.kind===u.kind)}function Ct(u,l){return l.some(h=>h==="null"?u===null:h==="array"?Array.isArray(u):h==="object"?u&&!Array.isArray(u)&&typeof u=="object":h===typeof u)}function Jt(u,l){return u.kind==="array"&&l.kind==="array"?u.itemType.kind===l.itemType.kind&&typeof u.N=="number":u.kind===l.kind}const ye=.96422,fe=.82521,ce=4/29,He=6/29,Ze=3*He*He,xr=He*He*He,sr=Math.PI/180,Cr=180/Math.PI;function zr(u){return(u%=360)<0&&(u+=360),u}function $r(u){let[l,h,p,v]=u,E,T;const L=ur((.2225045*(l=li(l))+.7168786*(h=li(h))+.0606169*(p=li(p)))/1);l===h&&h===p?E=T=L:(E=ur((.4360747*l+.3850649*h+.1430804*p)/ye),T=ur((.0139322*l+.0971045*h+.7141733*p)/fe));const R=116*L-16;return[R<0?0:R,500*(E-L),200*(L-T),v]}function li(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function ur(u){return u>xr?Math.pow(u,1/3):u/Ze+ce}function Gr(u){let[l,h,p,v]=u,E=(l+16)/116,T=isNaN(h)?E:E+h/500,L=isNaN(p)?E:E-p/200;return E=1*Ri(E),T=ye*Ri(T),L=fe*Ri(L),[pi(3.1338561*T-1.6168667*E-.4906146*L),pi(-.9787684*T+1.9161415*E+.033454*L),pi(.0719453*T-.2289914*E+1.4052427*L),v]}function pi(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function Ri(u){return u>He?u*u*u:Ze*(u-ce)}function Wi(u){return parseInt(u.padEnd(2,u),16)/255}function Ii(u,l){return Zn(l?u/100:u,0,1)}function Zn(u,l,h){return Math.min(Math.max(l,u),h)}function Nl(u){return!u.some(Number.isNaN)}const Qa={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Rr{constructor(l,h,p){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=l,this.g=h,this.b=p,this.a=v,E||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[l,h,p,v]))}static parse(l){if(l instanceof Rr)return l;if(typeof l!="string")return;const h=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=Qa[p];if(v){const[T,L,R]=v;return[T/255,L/255,R/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const T=p.length<6?1:2;let L=1;return[Wi(p.slice(L,L+=T)),Wi(p.slice(L,L+=T)),Wi(p.slice(L,L+=T)),Wi(p.slice(L,L+T)||"ff")]}if(p.startsWith("rgb")){const T=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[L,R,V,W,K,rt,lt,ut,_t,Pt,Ot,Yt]=T,Ft=[W||" ",lt||" ",Pt].join("");if(Ft==="  "||Ft==="  /"||Ft===",,"||Ft===",,,"){const Wt=[V,rt,_t].join(""),_e=Wt==="%%%"?100:Wt===""?255:0;if(_e){const be=[Zn(+R/_e,0,1),Zn(+K/_e,0,1),Zn(+ut/_e,0,1),Ot?Ii(+Ot,Yt):1];if(Nl(be))return be}}return}}const E=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[T,L,R,V,W,K,rt,lt,ut]=E,_t=[R||" ",W||" ",rt].join("");if(_t==="  "||_t==="  /"||_t===",,"||_t===",,,"){const Pt=[+L,Zn(+V,0,100),Zn(+K,0,100),lt?Ii(+lt,ut):1];if(Nl(Pt))return function(Ot){let[Yt,Ft,Wt,_e]=Ot;function be(We){const nr=(We+Yt/30)%12,Ge=Ft*Math.min(Wt,1-Wt);return Wt-Ge*Math.max(-1,Math.min(nr-3,9-nr,1))}return Yt=zr(Yt),Ft/=100,Wt/=100,[be(0),be(8),be(4),_e]}(Pt)}}}(l);return h?new Rr(...h,!1):void 0}get rgb(){const{r:l,g:h,b:p,a:v}=this,E=v||1/0;return this.overwriteGetter("rgb",[l/E,h/E,p/E,v])}get hcl(){return this.overwriteGetter("hcl",function(l){const[h,p,v,E]=$r(l),T=Math.sqrt(p*p+v*v);return[Math.round(1e4*T)?zr(Math.atan2(v,p)*Cr):NaN,T,h,E]}(this.rgb))}get lab(){return this.overwriteGetter("lab",$r(this.rgb))}overwriteGetter(l,h){return Object.defineProperty(this,l,{value:h}),h}toString(){const[l,h,p,v]=this.rgb;return`rgba(${[l,h,p].map(E=>Math.round(255*E)).join(",")},${v})`}}Rr.black=new Rr(0,0,0,1),Rr.white=new Rr(1,1,1,1),Rr.transparent=new Rr(0,0,0,0),Rr.red=new Rr(1,0,0,1);class ds{constructor(l,h,p){this.sensitivity=l?h?"variant":"case":h?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,h){return this.collator.compare(l,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class fs{constructor(l,h,p,v,E){this.text=l,this.image=h,this.scale=p,this.fontStack=v,this.textColor=E}}class Ni{constructor(l){this.sections=l}static fromString(l){return new Ni([new fs(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof Ni?l:Ni.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}}class $i{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof $i)return l;if(typeof l=="number")return new $i([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(const h of l)if(typeof h!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new $i(l)}}toString(){return JSON.stringify(this.values)}}const On=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Fi{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Fi)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let h=0;h<l.length;h+=2){const p=l[h],v=l[h+1];if(typeof p!="string"||!On.has(p)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new Fi(l)}}toString(){return JSON.stringify(this.values)}}class Jn{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new Jn({name:l,available:!1}):null}}function xs(u,l,h,p){return typeof u=="number"&&u>=0&&u<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof h=="number"&&h>=0&&h<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[u,l,h,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[u,l,h,p]:[u,l,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function To(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof Rr||u instanceof ds||u instanceof Ni||u instanceof $i||u instanceof Fi||u instanceof Jn)return!0;if(Array.isArray(u)){for(const l of u)if(!To(l))return!1;return!0}if(typeof u=="object"){for(const l in u)if(!To(u[l]))return!1;return!0}return!1}function Sr(u){if(u===null)return Pr;if(typeof u=="string")return Ye;if(typeof u=="boolean")return tr;if(typeof u=="number")return Pe;if(u instanceof Rr)return fi;if(u instanceof ds)return bi;if(u instanceof Ni)return ai;if(u instanceof $i)return At;if(u instanceof Fi)return Q;if(u instanceof Jn)return Y;if(Array.isArray(u)){const l=u.length;let h;for(const p of u){const v=Sr(p);if(h){if(h===v)continue;h=wr;break}h=v}return ot(h||wr,l)}return Fr}function js(u){const l=typeof u;return u===null?"":l==="string"||l==="number"||l==="boolean"?String(u):u instanceof Rr||u instanceof Ni||u instanceof $i||u instanceof Fi||u instanceof Jn?u.toString():JSON.stringify(u)}class ps{constructor(l,h){this.type=l,this.value=h}static parse(l,h){if(l.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!To(l[1]))return h.error("invalid value");const p=l[1];let v=Sr(p);const E=h.expectedType;return v.kind!=="array"||v.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(v=E),new ps(v,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class gi{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}const eo={string:Ye,number:Pe,boolean:tr,object:Fr};class xn{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");let p,v=1;const E=l[0];if(E==="array"){let L,R;if(l.length>2){const V=l[1];if(typeof V!="string"||!(V in eo)||V==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);L=eo[V],v++}else L=wr;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return h.error('The length argument to "array" must be a positive integer literal',2);R=l[2],v++}p=ot(L,R)}else{if(!eo[E])throw new Error(`Types doesn't contain name = ${E}`);p=eo[E]}const T=[];for(;v<l.length;v++){const L=h.parse(l[v],v,wr);if(!L)return null;T.push(L)}return new xn(p,T)}evaluate(l){for(let h=0;h<this.args.length;h++){const p=this.args[h].evaluate(l);if(!Gt(this.type,Sr(p)))return p;if(h===this.args.length-1)throw new gi(`Expected value to be of type ${wt(this.type)}, but found ${wt(Sr(p))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const An={"to-boolean":tr,"to-color":fi,"to-number":Pe,"to-string":Ye};class zi{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");const p=l[0];if(!An[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&l.length!==2)return h.error("Expected one argument.");const v=An[p],E=[];for(let T=1;T<l.length;T++){const L=h.parse(l[T],T,wr);if(!L)return null;E.push(L)}return new zi(v,E)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let h,p;for(const v of this.args){if(h=v.evaluate(l),p=null,h instanceof Rr)return h;if(typeof h=="string"){const E=l.parseColor(h);if(E)return E}else if(Array.isArray(h)&&(p=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:xs(h[0],h[1],h[2],h[3]),!p))return new Rr(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new gi(p||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const p of this.args){h=p.evaluate(l);const v=$i.parse(h);if(v)return v}throw new gi(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const p of this.args){h=p.evaluate(l);const v=Fi.parse(h);if(v)return v}throw new gi(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const p of this.args){if(h=p.evaluate(l),h===null)return 0;const v=Number(h);if(!isNaN(v))return v}throw new gi(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Ni.fromString(js(this.args[0].evaluate(l)));case"resolvedImage":return Jn.fromString(js(this.args[0].evaluate(l)));default:return js(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const vn=["Unknown","Point","LineString","Polygon"];class Xr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?vn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let h=this._parseColorCache[l];return h||(h=this._parseColorCache[l]=Rr.parse(l)),h}}class Po{constructor(l,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],v=arguments.length>3?arguments[3]:void 0,E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Hi,T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=l,this.path=p,this.key=p.map(L=>`[${L}]`).join(""),this.scope=E,this.errors=T,this.expectedType=v,this._isConstant=h}parse(l,h,p,v){let E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return h?this.concat(h,p,v)._parse(l,E):this._parse(l,E)}_parse(l,h){function p(v,E,T){return T==="assert"?new xn(E,[v]):T==="coerce"?new zi(E,[v]):v}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=l[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[v];if(E){let T=E.parse(l,this);if(!T)return null;if(this.expectedType){const L=this.expectedType,R=T.type;if(L.kind!=="string"&&L.kind!=="number"&&L.kind!=="boolean"&&L.kind!=="object"&&L.kind!=="array"||R.kind!=="value")if(L.kind!=="color"&&L.kind!=="formatted"&&L.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string")if(L.kind!=="padding"||R.kind!=="value"&&R.kind!=="number"&&R.kind!=="array")if(L.kind!=="variableAnchorOffsetCollection"||R.kind!=="value"&&R.kind!=="array"){if(this.checkSubtype(L,R))return null}else T=p(T,L,h.typeAnnotation||"coerce");else T=p(T,L,h.typeAnnotation||"coerce");else T=p(T,L,h.typeAnnotation||"coerce");else T=p(T,L,h.typeAnnotation||"assert")}if(!(T instanceof ps)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const L=new Xr;try{T=new ps(T.type,T.evaluate(L))}catch(R){return this.error(R.message),null}}return T}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,h,p){const v=typeof l=="number"?this.path.concat(l):this.path,E=p?this.scope.concat(p):this.scope;return new Po(this.registry,this._isConstant,v,h||null,E,this.errors)}error(l){for(var h=arguments.length,p=new Array(h>1?h-1:0),v=1;v<h;v++)p[v-1]=arguments[v];const E=`${this.key}${p.map(T=>`[${T}]`).join("")}`;this.errors.push(new Re(E,l))}checkSubtype(l,h){const p=Gt(l,h);return p&&this.error(p),p}}class Io{constructor(l,h,p){this.type=bi,this.locale=p,this.caseSensitive=l,this.diacriticSensitive=h}static parse(l,h){if(l.length!==2)return h.error("Expected one argument.");const p=l[1];if(typeof p!="object"||Array.isArray(p))return h.error("Collator options argument must be an object.");const v=h.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,tr);if(!v)return null;const E=h.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,tr);if(!E)return null;let T=null;return p.locale&&(T=h.parse(p.locale,1,Ye),!T)?null:new Io(v,E,T)}evaluate(l){return new ds(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}const Us=8192;function tl(u,l){u[0]=Math.min(u[0],l[0]),u[1]=Math.min(u[1],l[1]),u[2]=Math.max(u[2],l[0]),u[3]=Math.max(u[3],l[1])}function st(u,l){return!(u[0]<=l[0]||u[2]>=l[2]||u[1]<=l[1]||u[3]>=l[3])}function vt(u,l){const h=(180+u[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,v=Math.pow(2,l.z);return[Math.round(h*v*Us),Math.round(p*v*Us)]}function jt(u,l,h){const p=u[0]-l[0],v=u[1]-l[1],E=u[0]-h[0],T=u[1]-h[1];return p*T-E*v==0&&p*E<=0&&v*T<=0}function pe(u,l){let h=!1;for(let T=0,L=l.length;T<L;T++){const R=l[T];for(let V=0,W=R.length;V<W-1;V++){if(jt(u,R[V],R[V+1]))return!1;(v=R[V])[1]>(p=u)[1]!=(E=R[V+1])[1]>p[1]&&p[0]<(E[0]-v[0])*(p[1]-v[1])/(E[1]-v[1])+v[0]&&(h=!h)}}var p,v,E;return h}function Ee(u,l){for(let h=0;h<l.length;h++)if(pe(u,l[h]))return!0;return!1}function yr(u,l,h,p){const v=p[0]-h[0],E=p[1]-h[1],T=(u[0]-h[0])*E-v*(u[1]-h[1]),L=(l[0]-h[0])*E-v*(l[1]-h[1]);return T>0&&L<0||T<0&&L>0}function Br(u,l,h){for(const V of h)for(let W=0;W<V.length-1;++W)if((L=[(T=V[W+1])[0]-(E=V[W])[0],T[1]-E[1]])[0]*(R=[(v=l)[0]-(p=u)[0],v[1]-p[1]])[1]-L[1]*R[0]!=0&&yr(p,v,E,T)&&yr(E,T,p,v))return!0;var p,v,E,T,L,R;return!1}function mi(u,l){for(let h=0;h<u.length;++h)if(!pe(u[h],l))return!1;for(let h=0;h<u.length-1;++h)if(Br(u[h],u[h+1],l))return!1;return!0}function Sn(u,l){for(let h=0;h<l.length;h++)if(mi(u,l[h]))return!0;return!1}function un(u,l,h){const p=[];for(let v=0;v<u.length;v++){const E=[];for(let T=0;T<u[v].length;T++){const L=vt(u[v][T],h);tl(l,L),E.push(L)}p.push(E)}return p}function Ti(u,l,h){const p=[];for(let v=0;v<u.length;v++){const E=un(u[v],l,h);p.push(E)}return p}function _h(u,l,h,p){if(u[0]<h[0]||u[0]>h[2]){const v=.5*p;let E=u[0]-h[0]>v?-p:h[0]-u[0]>v?p:0;E===0&&(E=u[0]-h[2]>v?-p:h[2]-u[0]>v?p:0),u[0]+=E}tl(l,u)}function Fl(u,l,h,p){const v=Math.pow(2,p.z)*Us,E=[p.x*Us,p.y*Us],T=[];for(const L of u)for(const R of L){const V=[R.x+E[0],R.y+E[1]];_h(V,l,h,v),T.push(V)}return T}function kr(u,l,h,p){const v=Math.pow(2,p.z)*Us,E=[p.x*Us,p.y*Us],T=[];for(const R of u){const V=[];for(const W of R){const K=[W.x+E[0],W.y+E[1]];tl(l,K),V.push(K)}T.push(V)}if(l[2]-l[0]<=v/2){(L=l)[0]=L[1]=1/0,L[2]=L[3]=-1/0;for(const R of T)for(const V of R)_h(V,l,h,v)}var L;return T}class Sa{constructor(l,h){this.type=tr,this.geojson=l,this.geometries=h}static parse(l,h){if(l.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(To(l[1])){const p=l[1];if(p.type==="FeatureCollection"){const v=[];for(const E of p.features){const{type:T,coordinates:L}=E.geometry;T==="Polygon"&&v.push(L),T==="MultiPolygon"&&v.push(...L)}if(v.length)return new Sa(p,{type:"MultiPolygon",coordinates:v})}else if(p.type==="Feature"){const v=p.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Sa(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Sa(p,p)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(h,p){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],T=h.canonicalID();if(p.type==="Polygon"){const L=un(p.coordinates,E,T),R=Fl(h.geometry(),v,E,T);if(!st(v,E))return!1;for(const V of R)if(!pe(V,L))return!1}if(p.type==="MultiPolygon"){const L=Ti(p.coordinates,E,T),R=Fl(h.geometry(),v,E,T);if(!st(v,E))return!1;for(const V of R)if(!Ee(V,L))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(h,p){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],T=h.canonicalID();if(p.type==="Polygon"){const L=un(p.coordinates,E,T),R=kr(h.geometry(),v,E,T);if(!st(v,E))return!1;for(const V of R)if(!mi(V,L))return!1}if(p.type==="MultiPolygon"){const L=Ti(p.coordinates,E,T),R=kr(h.geometry(),v,E,T);if(!st(v,E))return!1;for(const V of R)if(!Sn(V,L))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Rc{constructor(l,h){this.type=h.type,this.name=l,this.boundExpression=h}static parse(l,h){if(l.length!==2||typeof l[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const p=l[1];return h.scope.has(p)?new Rc(p,h.scope.get(p)):h.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class on{constructor(l,h,p,v){this.name=l,this.type=h,this._evaluate=p,this.args=v}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,h){const p=l[0],v=on.definitions[p];if(!v)return h.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(v)?v[0]:v.type,T=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,L=T.filter(V=>{let[W]=V;return!Array.isArray(W)||W.length===l.length-1});let R=null;for(const[V,W]of L){R=new Po(h.registry,el,h.path,null,h.scope);const K=[];let rt=!1;for(let lt=1;lt<l.length;lt++){const ut=l[lt],_t=Array.isArray(V)?V[lt-1]:V.type,Pt=R.parse(ut,1+K.length,_t);if(!Pt){rt=!0;break}K.push(Pt)}if(!rt)if(Array.isArray(V)&&V.length!==K.length)R.error(`Expected ${V.length} arguments, but found ${K.length} instead.`);else{for(let lt=0;lt<K.length;lt++){const ut=Array.isArray(V)?V[lt]:V.type,_t=K[lt];R.concat(lt+1).checkSubtype(ut,_t.type)}if(R.errors.length===0)return new on(p,E,W,K)}}if(L.length===1)h.errors.push(...R.errors);else{const V=(L.length?L:T).map(K=>{let[rt]=K;return lt=rt,Array.isArray(lt)?`(${lt.map(wt).join(", ")})`:`(${wt(lt.type)}...)`;var lt}).join(" | "),W=[];for(let K=1;K<l.length;K++){const rt=h.parse(l[K],1+W.length);if(!rt)return null;W.push(wt(rt.type))}h.error(`Expected arguments of type ${V}, but found (${W.join(", ")}) instead.`)}return null}static register(l,h){on.definitions=h;for(const p in h)l[p]=on}}function el(u){if(u instanceof Rc)return el(u.boundExpression);if(u instanceof on&&u.name==="error"||u instanceof Io||u instanceof Sa)return!1;const l=u instanceof zi||u instanceof xn;let h=!0;return u.eachChild(p=>{h=l?h&&el(p):h&&p instanceof ps}),!!h&&zl(u)&&Ea(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function zl(u){if(u instanceof on&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Sa)return!1;let l=!0;return u.eachChild(h=>{l&&!zl(h)&&(l=!1)}),l}function ta(u){if(u instanceof on&&u.name==="feature-state")return!1;let l=!0;return u.eachChild(h=>{l&&!ta(h)&&(l=!1)}),l}function Ea(u,l){if(u instanceof on&&l.indexOf(u.name)>=0)return!1;let h=!0;return u.eachChild(p=>{h&&!Ea(p,l)&&(h=!1)}),h}function jl(u,l){const h=u.length-1;let p,v,E=0,T=h,L=0;for(;E<=T;)if(L=Math.floor((E+T)/2),p=u[L],v=u[L+1],p<=l){if(L===h||l<v)return L;E=L+1}else{if(!(p>l))throw new gi("Input is not a number.");T=L-1}return 0}class Ul{constructor(l,h,p){this.type=l,this.input=h,this.labels=[],this.outputs=[];for(const[v,E]of p)this.labels.push(v),this.outputs.push(E)}static parse(l,h){if(l.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return h.error("Expected an even number of arguments.");const p=h.parse(l[1],1,Pe);if(!p)return null;const v=[];let E=null;h.expectedType&&h.expectedType.kind!=="value"&&(E=h.expectedType);for(let T=1;T<l.length;T+=2){const L=T===1?-1/0:l[T],R=l[T+1],V=T,W=T+1;if(typeof L!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(v.length&&v[v.length-1][0]>=L)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',V);const K=h.parse(R,W,E);if(!K)return null;E=E||K.type,v.push([L,K])}return new Ul(E,p,v)}evaluate(l){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(l);const v=this.input.evaluate(l);if(v<=h[0])return p[0].evaluate(l);const E=h.length;return v>=h[E-1]?p[E-1].evaluate(l):p[jl(h,v)].evaluate(l)}eachChild(l){l(this.input);for(const h of this.outputs)l(h)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function Pd(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var bu=rl;function rl(u,l,h,p){this.cx=3*u,this.bx=3*(h-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(p-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=l,this.p2x=h,this.p2y=p}rl.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,l){if(l===void 0&&(l=1e-6),u<0)return 0;if(u>1)return 1;for(var h=u,p=0;p<8;p++){var v=this.sampleCurveX(h)-u;if(Math.abs(v)<l)return h;var E=this.sampleCurveDerivativeX(h);if(Math.abs(E)<1e-6)break;h-=v/E}var T=0,L=1;for(h=u,p=0;p<20&&(v=this.sampleCurveX(h),!(Math.abs(v-u)<l));p++)u>v?T=h:L=h,h=.5*(L-T)+T;return h},solve:function(u,l){return this.sampleCurveY(this.solveCurveX(u,l))}};var il=Pd(bu);function Ca(u,l,h){return u+h*(l-u)}function ea(u,l,h){return u.map((p,v)=>Ca(p,l[v],h))}const En={number:Ca,color:function(u,l,h){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[p,v,E,T]=ea(u.rgb,l.rgb,h);return new Rr(p,v,E,T,!1)}case"hcl":{const[p,v,E,T]=u.hcl,[L,R,V,W]=l.hcl;let K,rt;if(isNaN(p)||isNaN(L))isNaN(p)?isNaN(L)?K=NaN:(K=L,E!==1&&E!==0||(rt=R)):(K=p,V!==1&&V!==0||(rt=v));else{let Ot=L-p;L>p&&Ot>180?Ot-=360:L<p&&p-L>180&&(Ot+=360),K=p+h*Ot}const[lt,ut,_t,Pt]=function(Ot){let[Yt,Ft,Wt,_e]=Ot;return Yt=isNaN(Yt)?0:Yt*sr,Gr([Wt,Math.cos(Yt)*Ft,Math.sin(Yt)*Ft,_e])}([K,rt??Ca(v,R,h),Ca(E,V,h),Ca(T,W,h)]);return new Rr(lt,ut,_t,Pt,!1)}case"lab":{const[p,v,E,T]=Gr(ea(u.lab,l.lab,h));return new Rr(p,v,E,T,!1)}}},array:ea,padding:function(u,l,h){return new $i(ea(u.values,l.values,h))},variableAnchorOffsetCollection:function(u,l,h){const p=u.values,v=l.values;if(p.length!==v.length)throw new gi(`Cannot interpolate values of different length. from: ${u.toString()}, to: ${l.toString()}`);const E=[];for(let T=0;T<p.length;T+=2){if(p[T]!==v[T])throw new gi(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${p[T]}, to[${T}]: ${v[T]}`);E.push(p[T]);const[L,R]=p[T+1],[V,W]=v[T+1];E.push([Ca(L,V,h),Ca(R,W,h)])}return new Fi(E)}};class hn{constructor(l,h,p,v,E){this.type=l,this.operator=h,this.interpolation=p,this.input=v,this.labels=[],this.outputs=[];for(const[T,L]of E)this.labels.push(T),this.outputs.push(L)}static interpolationFactor(l,h,p,v){let E=0;if(l.name==="exponential")E=Kr(h,l.base,p,v);else if(l.name==="linear")E=Kr(h,1,p,v);else if(l.name==="cubic-bezier"){const T=l.controlPoints;E=new il(T[0],T[1],T[2],T[3]).solve(Kr(h,1,p,v))}return E}static parse(l,h){let[p,v,E,...T]=l;if(!Array.isArray(v)||v.length===0)return h.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const V=v[1];if(typeof V!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:V}}else{if(v[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const V=v.slice(1);if(V.length!==4||V.some(W=>typeof W!="number"||W<0||W>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:V}}}if(l.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(E=h.parse(E,2,Pe),!E)return null;const L=[];let R=null;p==="interpolate-hcl"||p==="interpolate-lab"?R=fi:h.expectedType&&h.expectedType.kind!=="value"&&(R=h.expectedType);for(let V=0;V<T.length;V+=2){const W=T[V],K=T[V+1],rt=V+3,lt=V+4;if(typeof W!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',rt);if(L.length&&L[L.length-1][0]>=W)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',rt);const ut=h.parse(K,lt,R);if(!ut)return null;R=R||ut.type,L.push([W,ut])}return Jt(R,Pe)||Jt(R,fi)||Jt(R,At)||Jt(R,Q)||Jt(R,ot(Pe))?new hn(R,p,v,E,L):h.error(`Type ${wt(R)} is not interpolatable.`)}evaluate(l){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(l);const v=this.input.evaluate(l);if(v<=h[0])return p[0].evaluate(l);const E=h.length;if(v>=h[E-1])return p[E-1].evaluate(l);const T=jl(h,v),L=hn.interpolationFactor(this.interpolation,v,h[T],h[T+1]),R=p[T].evaluate(l),V=p[T+1].evaluate(l);switch(this.operator){case"interpolate":return En[this.type.kind](R,V,L);case"interpolate-hcl":return En.color(R,V,L,"hcl");case"interpolate-lab":return En.color(R,V,L,"lab")}}eachChild(l){l(this.input);for(const h of this.outputs)l(h)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function Kr(u,l,h,p){const v=p-h,E=u-h;return v===0?0:l===1?E/v:(Math.pow(l,E)-1)/(Math.pow(l,v)-1)}class Gl{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expectected at least one argument.");let p=null;const v=h.expectedType;v&&v.kind!=="value"&&(p=v);const E=[];for(const L of l.slice(1)){const R=h.parse(L,1+E.length,p,void 0,{typeAnnotation:"omit"});if(!R)return null;p=p||R.type,E.push(R)}if(!p)throw new Error("No output type");const T=v&&E.some(L=>Gt(v,L.type));return new Gl(T?wr:p,E)}evaluate(l){let h,p=null,v=0;for(const E of this.args)if(v++,p=E.evaluate(l),p&&p instanceof Jn&&!p.available&&(h||(h=p.name),p=null,v===this.args.length&&(p=h)),p!==null)break;return p}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}class Vl{constructor(l,h){this.type=h.type,this.bindings=[].concat(l),this.result=h}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const h of this.bindings)l(h[1]);l(this.result)}static parse(l,h){if(l.length<4)return h.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const p=[];for(let E=1;E<l.length-1;E+=2){const T=l[E];if(typeof T!="string")return h.error(`Expected string, but found ${typeof T} instead.`,E);if(/[^a-zA-Z0-9_]/.test(T))return h.error("Variable names must contain only alphanumeric characters or '_'.",E);const L=h.parse(l[E+1],E+1);if(!L)return null;p.push([T,L])}const v=h.parse(l[l.length-1],l.length-1,h.expectedType,p);return v?new Vl(p,v):null}outputDefined(){return this.result.outputDefined()}}class Oc{constructor(l,h,p){this.type=l,this.index=h,this.input=p}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const p=h.parse(l[1],1,Pe),v=h.parse(l[2],2,ot(h.expectedType||wr));return p&&v?new Oc(v.type.itemType,p,v):null}evaluate(l){const h=this.index.evaluate(l),p=this.input.evaluate(l);if(h<0)throw new gi(`Array index out of bounds: ${h} < 0.`);if(h>=p.length)throw new gi(`Array index out of bounds: ${h} > ${p.length-1}.`);if(h!==Math.floor(h))throw new gi(`Array index must be an integer, but found ${h} instead.`);return p[h]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class Mo{constructor(l,h){this.type=tr,this.needle=l,this.haystack=h}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const p=h.parse(l[1],1,wr),v=h.parse(l[2],2,wr);return p&&v?Ht(p.type,[tr,Ye,Pe,Pr,wr])?new Mo(p,v):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${wt(p.type)} instead`):null}evaluate(l){const h=this.needle.evaluate(l),p=this.haystack.evaluate(l);if(!p)return!1;if(!Ct(h,["boolean","string","number","null"]))throw new gi(`Expected first argument to be of type boolean, string, number or null, but found ${wt(Sr(h))} instead.`);if(!Ct(p,["string","array"]))throw new gi(`Expected second argument to be of type array or string, but found ${wt(Sr(p))} instead.`);return p.indexOf(h)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class Lo{constructor(l,h,p){this.type=Pe,this.needle=l,this.haystack=h,this.fromIndex=p}static parse(l,h){if(l.length<=2||l.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const p=h.parse(l[1],1,wr),v=h.parse(l[2],2,wr);if(!p||!v)return null;if(!Ht(p.type,[tr,Ye,Pe,Pr,wr]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${wt(p.type)} instead`);if(l.length===4){const E=h.parse(l[3],3,Pe);return E?new Lo(p,v,E):null}return new Lo(p,v)}evaluate(l){const h=this.needle.evaluate(l),p=this.haystack.evaluate(l);if(!Ct(h,["boolean","string","number","null"]))throw new gi(`Expected first argument to be of type boolean, string, number or null, but found ${wt(Sr(h))} instead.`);if(!Ct(p,["string","array"]))throw new gi(`Expected second argument to be of type array or string, but found ${wt(Sr(p))} instead.`);if(this.fromIndex){const v=this.fromIndex.evaluate(l);return p.indexOf(h,v)}return p.indexOf(h)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class wu{constructor(l,h,p,v,E,T){this.inputType=l,this.type=h,this.input=p,this.cases=v,this.outputs=E,this.otherwise=T}static parse(l,h){if(l.length<5)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return h.error("Expected an even number of arguments.");let p,v;h.expectedType&&h.expectedType.kind!=="value"&&(v=h.expectedType);const E={},T=[];for(let V=2;V<l.length-1;V+=2){let W=l[V];const K=l[V+1];Array.isArray(W)||(W=[W]);const rt=h.concat(V);if(W.length===0)return rt.error("Expected at least one branch label.");for(const ut of W){if(typeof ut!="number"&&typeof ut!="string")return rt.error("Branch labels must be numbers or strings.");if(typeof ut=="number"&&Math.abs(ut)>Number.MAX_SAFE_INTEGER)return rt.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ut=="number"&&Math.floor(ut)!==ut)return rt.error("Numeric branch labels must be integer values.");if(p){if(rt.checkSubtype(p,Sr(ut)))return null}else p=Sr(ut);if(E[String(ut)]!==void 0)return rt.error("Branch labels must be unique.");E[String(ut)]=T.length}const lt=h.parse(K,V,v);if(!lt)return null;v=v||lt.type,T.push(lt)}const L=h.parse(l[1],1,wr);if(!L)return null;const R=h.parse(l[l.length-1],l.length-1,v);return R?L.type.kind!=="value"&&h.concat(1).checkSubtype(p,L.type)?null:new wu(p,v,L,E,T,R):null}evaluate(l){const h=this.input.evaluate(l);return(Sr(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}}class ra{constructor(l,h,p){this.type=l,this.branches=h,this.otherwise=p}static parse(l,h){if(l.length<4)return h.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return h.error("Expected an odd number of arguments.");let p;h.expectedType&&h.expectedType.kind!=="value"&&(p=h.expectedType);const v=[];for(let T=1;T<l.length-1;T+=2){const L=h.parse(l[T],T,tr);if(!L)return null;const R=h.parse(l[T+1],T+1,p);if(!R)return null;v.push([L,R]),p=p||R.type}const E=h.parse(l[l.length-1],l.length-1,p);if(!E)return null;if(!p)throw new Error("Can't infer output type");return new ra(p,v,E)}evaluate(l){for(const[h,p]of this.branches)if(h.evaluate(l))return p.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[h,p]of this.branches)l(h),l(p);l(this.otherwise)}outputDefined(){return this.branches.every(l=>{let[h,p]=l;return p.outputDefined()})&&this.otherwise.outputDefined()}}class As{constructor(l,h,p,v){this.type=l,this.input=h,this.beginIndex=p,this.endIndex=v}static parse(l,h){if(l.length<=2||l.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const p=h.parse(l[1],1,wr),v=h.parse(l[2],2,Pe);if(!p||!v)return null;if(!Ht(p.type,[ot(wr),Ye,wr]))return h.error(`Expected first argument to be of type array or string, but found ${wt(p.type)} instead`);if(l.length===4){const E=h.parse(l[3],3,Pe);return E?new As(p.type,p,v,E):null}return new As(p.type,p,v)}evaluate(l){const h=this.input.evaluate(l),p=this.beginIndex.evaluate(l);if(!Ct(h,["string","array"]))throw new gi(`Expected first argument to be of type array or string, but found ${wt(Sr(h))} instead.`);if(this.endIndex){const v=this.endIndex.evaluate(l);return h.slice(p,v)}return h.slice(p)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function Dc(u,l){return u==="=="||u==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function nl(u,l,h,p){return p.compare(l,h)===0}function sl(u,l,h){const p=u!=="=="&&u!=="!=";return class AL{constructor(E,T,L){this.type=tr,this.lhs=E,this.rhs=T,this.collator=L,this.hasUntypedArgument=E.type.kind==="value"||T.type.kind==="value"}static parse(E,T){if(E.length!==3&&E.length!==4)return T.error("Expected two or three arguments.");const L=E[0];let R=T.parse(E[1],1,wr);if(!R)return null;if(!Dc(L,R.type))return T.concat(1).error(`"${L}" comparisons are not supported for type '${wt(R.type)}'.`);let V=T.parse(E[2],2,wr);if(!V)return null;if(!Dc(L,V.type))return T.concat(2).error(`"${L}" comparisons are not supported for type '${wt(V.type)}'.`);if(R.type.kind!==V.type.kind&&R.type.kind!=="value"&&V.type.kind!=="value")return T.error(`Cannot compare types '${wt(R.type)}' and '${wt(V.type)}'.`);p&&(R.type.kind==="value"&&V.type.kind!=="value"?R=new xn(V.type,[R]):R.type.kind!=="value"&&V.type.kind==="value"&&(V=new xn(R.type,[V])));let W=null;if(E.length===4){if(R.type.kind!=="string"&&V.type.kind!=="string"&&R.type.kind!=="value"&&V.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(W=T.parse(E[3],3,bi),!W)return null}return new AL(R,V,W)}evaluate(E){const T=this.lhs.evaluate(E),L=this.rhs.evaluate(E);if(p&&this.hasUntypedArgument){const R=Sr(T),V=Sr(L);if(R.kind!==V.kind||R.kind!=="string"&&R.kind!=="number")throw new gi(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${R.kind}, ${V.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const R=Sr(T),V=Sr(L);if(R.kind!=="string"||V.kind!=="string")return l(E,T,L)}return this.collator?h(E,T,L,this.collator.evaluate(E)):l(E,T,L)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}const Nc=sl("==",function(u,l,h){return l===h},nl),Id=sl("!=",function(u,l,h){return l!==h},function(u,l,h,p){return!nl(0,l,h,p)}),xu=sl("<",function(u,l,h){return l<h},function(u,l,h,p){return p.compare(l,h)<0}),Au=sl(">",function(u,l,h){return l>h},function(u,l,h,p){return p.compare(l,h)>0}),vh=sl("<=",function(u,l,h){return l<=h},function(u,l,h,p){return p.compare(l,h)<=0}),Fc=sl(">=",function(u,l,h){return l>=h},function(u,l,h,p){return p.compare(l,h)>=0});class ql{constructor(l,h,p,v,E){this.type=Ye,this.number=l,this.locale=h,this.currency=p,this.minFractionDigits=v,this.maxFractionDigits=E}static parse(l,h){if(l.length!==3)return h.error("Expected two arguments.");const p=h.parse(l[1],1,Pe);if(!p)return null;const v=l[2];if(typeof v!="object"||Array.isArray(v))return h.error("NumberFormat options argument must be an object.");let E=null;if(v.locale&&(E=h.parse(v.locale,1,Ye),!E))return null;let T=null;if(v.currency&&(T=h.parse(v.currency,1,Ye),!T))return null;let L=null;if(v["min-fraction-digits"]&&(L=h.parse(v["min-fraction-digits"],1,Pe),!L))return null;let R=null;return v["max-fraction-digits"]&&(R=h.parse(v["max-fraction-digits"],1,Pe),!R)?null:new ql(p,E,T,L,R)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class ol{constructor(l){this.type=ai,this.sections=l}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");const p=l[1];if(!Array.isArray(p)&&typeof p=="object")return h.error("First argument must be an image or text section.");const v=[];let E=!1;for(let T=1;T<=l.length-1;++T){const L=l[T];if(E&&typeof L=="object"&&!Array.isArray(L)){E=!1;let R=null;if(L["font-scale"]&&(R=h.parse(L["font-scale"],1,Pe),!R))return null;let V=null;if(L["text-font"]&&(V=h.parse(L["text-font"],1,ot(Ye)),!V))return null;let W=null;if(L["text-color"]&&(W=h.parse(L["text-color"],1,fi),!W))return null;const K=v[v.length-1];K.scale=R,K.font=V,K.textColor=W}else{const R=h.parse(l[T],1,wr);if(!R)return null;const V=R.type.kind;if(V!=="string"&&V!=="value"&&V!=="null"&&V!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,v.push({content:R,scale:null,font:null,textColor:null})}}return new ol(v)}evaluate(l){return new Ni(this.sections.map(h=>{const p=h.content.evaluate(l);return Sr(p)===Y?new fs("",p,null,null,null):new fs(js(p),null,h.scale?h.scale.evaluate(l):null,h.font?h.font.evaluate(l).join(","):null,h.textColor?h.textColor.evaluate(l):null)}))}eachChild(l){for(const h of this.sections)l(h.content),h.scale&&l(h.scale),h.font&&l(h.font),h.textColor&&l(h.textColor)}outputDefined(){return!1}}class zc{constructor(l){this.type=Y,this.input=l}static parse(l,h){if(l.length!==2)return h.error("Expected two arguments.");const p=h.parse(l[1],1,Ye);return p?new zc(p):h.error("No image name provided.")}evaluate(l){const h=this.input.evaluate(l),p=Jn.fromString(h);return p&&l.availableImages&&(p.available=l.availableImages.indexOf(h)>-1),p}eachChild(l){l(this.input)}outputDefined(){return!1}}class Su{constructor(l){this.type=Pe,this.input=l}static parse(l,h){if(l.length!==2)return h.error(`Expected 1 argument, but found ${l.length-1} instead.`);const p=h.parse(l[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${wt(p.type)} instead.`):new Su(p):null}evaluate(l){const h=this.input.evaluate(l);if(typeof h=="string"||Array.isArray(h))return h.length;throw new gi(`Expected value to be of type string or array, but found ${wt(Sr(h))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}const Bo={"==":Nc,"!=":Id,">":Au,"<":xu,">=":Fc,"<=":vh,array:xn,at:Oc,boolean:xn,case:ra,coalesce:Gl,collator:Io,format:ol,image:zc,in:Mo,"index-of":Lo,interpolate:hn,"interpolate-hcl":hn,"interpolate-lab":hn,length:Su,let:Vl,literal:ps,match:wu,number:xn,"number-format":ql,object:xn,slice:As,step:Ul,string:xn,"to-boolean":zi,"to-color":zi,"to-number":zi,"to-string":zi,var:Rc,within:Sa};function al(u,l){let[h,p,v,E]=l;h=h.evaluate(u),p=p.evaluate(u),v=v.evaluate(u);const T=E?E.evaluate(u):1,L=xs(h,p,v,T);if(L)throw new gi(L);return new Rr(h/255,p/255,v/255,T,!1)}function jc(u,l){return u in l}function ia(u,l){const h=l[u];return h===void 0?null:h}function ko(u){return{type:u}}function D(u){return{result:"success",value:u}}function tt(u){return{result:"error",value:u}}function It(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function qt(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function te(u){return!!u.expression&&u.expression.interpolated}function ie(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function Me(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function er(u){return u}function Ar(u,l){const h=l.type==="color",p=u.stops&&typeof u.stops[0][0]=="object",v=p||!(p||u.property!==void 0),E=u.type||(te(l)?"exponential":"interval");if(h||l.type==="padding"){const W=h?Rr.parse:$i.parse;(u=Tr({},u)).stops&&(u.stops=u.stops.map(K=>[K[0],W(K[1])])),u.default=W(u.default?u.default:l.default)}if(u.colorSpace&&(T=u.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var T;let L,R,V;if(E==="exponential")L=fr;else if(E==="interval")L=si;else if(E==="categorical"){L=dr,R=Object.create(null);for(const W of u.stops)R[W[0]]=W[1];V=typeof u.stops[0][0]}else{if(E!=="identity")throw new Error(`Unknown function type "${E}"`);L=Qi}if(p){const W={},K=[];for(let ut=0;ut<u.stops.length;ut++){const _t=u.stops[ut],Pt=_t[0].zoom;W[Pt]===void 0&&(W[Pt]={zoom:Pt,type:u.type,property:u.property,default:u.default,stops:[]},K.push(Pt)),W[Pt].stops.push([_t[0].value,_t[1]])}const rt=[];for(const ut of K)rt.push([W[ut].zoom,Ar(W[ut],l)]);const lt={name:"linear"};return{kind:"composite",interpolationType:lt,interpolationFactor:hn.interpolationFactor.bind(void 0,lt),zoomStops:rt.map(ut=>ut[0]),evaluate:(ut,_t)=>{let{zoom:Pt}=ut;return fr({stops:rt,base:u.base},l,Pt).evaluate(Pt,_t)}}}if(v){const W=E==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:W,interpolationFactor:hn.interpolationFactor.bind(void 0,W),zoomStops:u.stops.map(K=>K[0]),evaluate:K=>{let{zoom:rt}=K;return L(u,l,rt,R,V)}}}return{kind:"source",evaluate(W,K){const rt=K&&K.properties?K.properties[u.property]:void 0;return rt===void 0?Lr(u.default,l.default):L(u,l,rt,R,V)}}}function Lr(u,l,h){return u!==void 0?u:l!==void 0?l:h!==void 0?h:void 0}function dr(u,l,h,p,v){return Lr(typeof h===v?p[h]:void 0,u.default,l.default)}function si(u,l,h){if(ie(h)!=="number")return Lr(u.default,l.default);const p=u.stops.length;if(p===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[p-1][0])return u.stops[p-1][1];const v=jl(u.stops.map(E=>E[0]),h);return u.stops[v][1]}function fr(u,l,h){const p=u.base!==void 0?u.base:1;if(ie(h)!=="number")return Lr(u.default,l.default);const v=u.stops.length;if(v===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[v-1][0])return u.stops[v-1][1];const E=jl(u.stops.map(W=>W[0]),h),T=function(W,K,rt,lt){const ut=lt-rt,_t=W-rt;return ut===0?0:K===1?_t/ut:(Math.pow(K,_t)-1)/(Math.pow(K,ut)-1)}(h,p,u.stops[E][0],u.stops[E+1][0]),L=u.stops[E][1],R=u.stops[E+1][1],V=En[l.type]||er;return typeof L.evaluate=="function"?{evaluate(){for(var W=arguments.length,K=new Array(W),rt=0;rt<W;rt++)K[rt]=arguments[rt];const lt=L.evaluate.apply(void 0,K),ut=R.evaluate.apply(void 0,K);if(lt!==void 0&&ut!==void 0)return V(lt,ut,T,u.colorSpace)}}:V(L,R,T,u.colorSpace)}function Qi(u,l,h){switch(l.type){case"color":h=Rr.parse(h);break;case"formatted":h=Ni.fromString(h.toString());break;case"resolvedImage":h=Jn.fromString(h.toString());break;case"padding":h=$i.parse(h);break;default:ie(h)===l.type||l.type==="enum"&&l.values[h]||(h=void 0)}return Lr(h,u.default,l.default)}on.register(Bo,{error:[{kind:"error"},[Ye],(u,l)=>{let[h]=l;throw new gi(h.evaluate(u))}],typeof:[Ye,[wr],(u,l)=>{let[h]=l;return wt(Sr(h.evaluate(u)))}],"to-rgba":[ot(Pe,4),[fi],(u,l)=>{let[h]=l;const[p,v,E,T]=h.evaluate(u).rgb;return[255*p,255*v,255*E,T]}],rgb:[fi,[Pe,Pe,Pe],al],rgba:[fi,[Pe,Pe,Pe,Pe],al],has:{type:tr,overloads:[[[Ye],(u,l)=>{let[h]=l;return jc(h.evaluate(u),u.properties())}],[[Ye,Fr],(u,l)=>{let[h,p]=l;return jc(h.evaluate(u),p.evaluate(u))}]]},get:{type:wr,overloads:[[[Ye],(u,l)=>{let[h]=l;return ia(h.evaluate(u),u.properties())}],[[Ye,Fr],(u,l)=>{let[h,p]=l;return ia(h.evaluate(u),p.evaluate(u))}]]},"feature-state":[wr,[Ye],(u,l)=>{let[h]=l;return ia(h.evaluate(u),u.featureState||{})}],properties:[Fr,[],u=>u.properties()],"geometry-type":[Ye,[],u=>u.geometryType()],id:[wr,[],u=>u.id()],zoom:[Pe,[],u=>u.globals.zoom],"heatmap-density":[Pe,[],u=>u.globals.heatmapDensity||0],"line-progress":[Pe,[],u=>u.globals.lineProgress||0],accumulated:[wr,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[Pe,ko(Pe),(u,l)=>{let h=0;for(const p of l)h+=p.evaluate(u);return h}],"*":[Pe,ko(Pe),(u,l)=>{let h=1;for(const p of l)h*=p.evaluate(u);return h}],"-":{type:Pe,overloads:[[[Pe,Pe],(u,l)=>{let[h,p]=l;return h.evaluate(u)-p.evaluate(u)}],[[Pe],(u,l)=>{let[h]=l;return-h.evaluate(u)}]]},"/":[Pe,[Pe,Pe],(u,l)=>{let[h,p]=l;return h.evaluate(u)/p.evaluate(u)}],"%":[Pe,[Pe,Pe],(u,l)=>{let[h,p]=l;return h.evaluate(u)%p.evaluate(u)}],ln2:[Pe,[],()=>Math.LN2],pi:[Pe,[],()=>Math.PI],e:[Pe,[],()=>Math.E],"^":[Pe,[Pe,Pe],(u,l)=>{let[h,p]=l;return Math.pow(h.evaluate(u),p.evaluate(u))}],sqrt:[Pe,[Pe],(u,l)=>{let[h]=l;return Math.sqrt(h.evaluate(u))}],log10:[Pe,[Pe],(u,l)=>{let[h]=l;return Math.log(h.evaluate(u))/Math.LN10}],ln:[Pe,[Pe],(u,l)=>{let[h]=l;return Math.log(h.evaluate(u))}],log2:[Pe,[Pe],(u,l)=>{let[h]=l;return Math.log(h.evaluate(u))/Math.LN2}],sin:[Pe,[Pe],(u,l)=>{let[h]=l;return Math.sin(h.evaluate(u))}],cos:[Pe,[Pe],(u,l)=>{let[h]=l;return Math.cos(h.evaluate(u))}],tan:[Pe,[Pe],(u,l)=>{let[h]=l;return Math.tan(h.evaluate(u))}],asin:[Pe,[Pe],(u,l)=>{let[h]=l;return Math.asin(h.evaluate(u))}],acos:[Pe,[Pe],(u,l)=>{let[h]=l;return Math.acos(h.evaluate(u))}],atan:[Pe,[Pe],(u,l)=>{let[h]=l;return Math.atan(h.evaluate(u))}],min:[Pe,ko(Pe),(u,l)=>Math.min(...l.map(h=>h.evaluate(u)))],max:[Pe,ko(Pe),(u,l)=>Math.max(...l.map(h=>h.evaluate(u)))],abs:[Pe,[Pe],(u,l)=>{let[h]=l;return Math.abs(h.evaluate(u))}],round:[Pe,[Pe],(u,l)=>{let[h]=l;const p=h.evaluate(u);return p<0?-Math.round(-p):Math.round(p)}],floor:[Pe,[Pe],(u,l)=>{let[h]=l;return Math.floor(h.evaluate(u))}],ceil:[Pe,[Pe],(u,l)=>{let[h]=l;return Math.ceil(h.evaluate(u))}],"filter-==":[tr,[Ye,wr],(u,l)=>{let[h,p]=l;return u.properties()[h.value]===p.value}],"filter-id-==":[tr,[wr],(u,l)=>{let[h]=l;return u.id()===h.value}],"filter-type-==":[tr,[Ye],(u,l)=>{let[h]=l;return u.geometryType()===h.value}],"filter-<":[tr,[Ye,wr],(u,l)=>{let[h,p]=l;const v=u.properties()[h.value],E=p.value;return typeof v==typeof E&&v<E}],"filter-id-<":[tr,[wr],(u,l)=>{let[h]=l;const p=u.id(),v=h.value;return typeof p==typeof v&&p<v}],"filter->":[tr,[Ye,wr],(u,l)=>{let[h,p]=l;const v=u.properties()[h.value],E=p.value;return typeof v==typeof E&&v>E}],"filter-id->":[tr,[wr],(u,l)=>{let[h]=l;const p=u.id(),v=h.value;return typeof p==typeof v&&p>v}],"filter-<=":[tr,[Ye,wr],(u,l)=>{let[h,p]=l;const v=u.properties()[h.value],E=p.value;return typeof v==typeof E&&v<=E}],"filter-id-<=":[tr,[wr],(u,l)=>{let[h]=l;const p=u.id(),v=h.value;return typeof p==typeof v&&p<=v}],"filter->=":[tr,[Ye,wr],(u,l)=>{let[h,p]=l;const v=u.properties()[h.value],E=p.value;return typeof v==typeof E&&v>=E}],"filter-id->=":[tr,[wr],(u,l)=>{let[h]=l;const p=u.id(),v=h.value;return typeof p==typeof v&&p>=v}],"filter-has":[tr,[wr],(u,l)=>{let[h]=l;return h.value in u.properties()}],"filter-has-id":[tr,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[tr,[ot(Ye)],(u,l)=>{let[h]=l;return h.value.indexOf(u.geometryType())>=0}],"filter-id-in":[tr,[ot(wr)],(u,l)=>{let[h]=l;return h.value.indexOf(u.id())>=0}],"filter-in-small":[tr,[Ye,ot(wr)],(u,l)=>{let[h,p]=l;return p.value.indexOf(u.properties()[h.value])>=0}],"filter-in-large":[tr,[Ye,ot(wr)],(u,l)=>{let[h,p]=l;return function(v,E,T,L){for(;T<=L;){const R=T+L>>1;if(E[R]===v)return!0;E[R]>v?L=R-1:T=R+1}return!1}(u.properties()[h.value],p.value,0,p.value.length-1)}],all:{type:tr,overloads:[[[tr,tr],(u,l)=>{let[h,p]=l;return h.evaluate(u)&&p.evaluate(u)}],[ko(tr),(u,l)=>{for(const h of l)if(!h.evaluate(u))return!1;return!0}]]},any:{type:tr,overloads:[[[tr,tr],(u,l)=>{let[h,p]=l;return h.evaluate(u)||p.evaluate(u)}],[ko(tr),(u,l)=>{for(const h of l)if(h.evaluate(u))return!0;return!1}]]},"!":[tr,[tr],(u,l)=>{let[h]=l;return!h.evaluate(u)}],"is-supported-script":[tr,[Ye],(u,l)=>{let[h]=l;const p=u.globals&&u.globals.isSupportedScript;return!p||p(h.evaluate(u))}],upcase:[Ye,[Ye],(u,l)=>{let[h]=l;return h.evaluate(u).toUpperCase()}],downcase:[Ye,[Ye],(u,l)=>{let[h]=l;return h.evaluate(u).toLowerCase()}],concat:[Ye,ko(wr),(u,l)=>l.map(h=>js(h.evaluate(u))).join("")],"resolved-locale":[Ye,[bi],(u,l)=>{let[h]=l;return h.evaluate(u).resolvedLocale()}]});class Or{constructor(l,h){var p;this.expression=l,this._warningHistory={},this._evaluator=new Xr,this._defaultValue=h?(p=h).type==="color"&&Me(p.default)?new Rr(0,0,0,0):p.type==="color"?Rr.parse(p.default)||null:p.type==="padding"?$i.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?Fi.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(l,h,p,v,E,T){return this._evaluator.globals=l,this._evaluator.feature=h,this._evaluator.featureState=p,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(l,h,p,v,E,T){this._evaluator.globals=l,this._evaluator.feature=h||null,this._evaluator.featureState=p||null,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=T||null;try{const L=this.expression.evaluate(this._evaluator);if(L==null||typeof L=="number"&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new gi(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}}}function jr(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in Bo}function Zi(u,l){const h=new Po(Bo,el,[],l?function(v){const E={color:fi,string:Ye,number:Pe,enum:Ye,boolean:tr,formatted:ai,padding:At,resolvedImage:Y,variableAnchorOffsetCollection:Q};return v.type==="array"?ot(E[v.value]||wr,v.length):E[v.type]}(l):void 0),p=h.parse(u,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?D(new Or(p,l)):tt(h.errors)}class Ss{constructor(l,h){this.kind=l,this._styleExpression=h,this.isStateDependent=l!=="constant"&&!ta(h.expression)}evaluateWithoutErrorHandling(l,h,p,v,E,T){return this._styleExpression.evaluateWithoutErrorHandling(l,h,p,v,E,T)}evaluate(l,h,p,v,E,T){return this._styleExpression.evaluate(l,h,p,v,E,T)}}class Es{constructor(l,h,p,v){this.kind=l,this.zoomStops=p,this._styleExpression=h,this.isStateDependent=l!=="camera"&&!ta(h.expression),this.interpolationType=v}evaluateWithoutErrorHandling(l,h,p,v,E,T){return this._styleExpression.evaluateWithoutErrorHandling(l,h,p,v,E,T)}evaluate(l,h,p,v,E,T){return this._styleExpression.evaluate(l,h,p,v,E,T)}interpolationFactor(l,h,p){return this.interpolationType?hn.interpolationFactor(this.interpolationType,l,h,p):0}}function na(u,l){const h=Zi(u,l);if(h.result==="error")return h;const p=h.value.expression,v=zl(p);if(!v&&!It(l))return tt([new Re("","data expressions not supported")]);const E=Ea(p,["zoom"]);if(!E&&!qt(l))return tt([new Re("","zoom expressions not supported")]);const T=ll(p);return T||E?T instanceof Re?tt([T]):T instanceof hn&&!te(l)?tt([new Re("",'"interpolate" expressions cannot be used with this property')]):D(T?new Es(v?"camera":"composite",h.value,T.labels,T instanceof hn?T.interpolation:void 0):new Ss(v?"constant":"source",h.value)):tt([new Re("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Hl{constructor(l,h){this._parameters=l,this._specification=h,Tr(this,Ar(this._parameters,this._specification))}static deserialize(l){return new Hl(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function ll(u){let l=null;if(u instanceof Vl)l=ll(u.result);else if(u instanceof Gl){for(const h of u.args)if(l=ll(h),l)break}else(u instanceof Ul||u instanceof hn)&&u.input instanceof on&&u.input.name==="zoom"&&(l=u);return l instanceof Re||u.eachChild(h=>{const p=ll(h);p instanceof Re?l=p:!l&&p?l=new Re("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&p&&l!==p&&(l=new Re("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}function cl(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const l of u.slice(1))if(!cl(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}const Wl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ul(u){if(u==null)return{filter:()=>!0,needGeometry:!1};cl(u)||(u=Xn(u));const l=Zi(u,Wl);if(l.result==="error")throw new Error(l.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,p,v)=>l.value.evaluate(h,p,{},v),needGeometry:Ta(u)}}function Uc(u,l){return u<l?-1:u>l?1:0}function Ta(u){if(!Array.isArray(u))return!1;if(u[0]==="within")return!0;for(let l=1;l<u.length;l++)if(Ta(u[l]))return!0;return!1}function Xn(u){if(!u)return!0;const l=u[0];return u.length<=1?l!=="any":l==="=="?hl(u[1],u[2],"=="):l==="!="?dl(hl(u[1],u[2],"==")):l==="<"||l===">"||l==="<="||l===">="?hl(u[1],u[2],l):l==="any"?(h=u.slice(1),["any"].concat(h.map(Xn))):l==="all"?["all"].concat(u.slice(1).map(Xn)):l==="none"?["all"].concat(u.slice(1).map(Xn).map(dl)):l==="in"?$l(u[1],u.slice(2)):l==="!in"?dl($l(u[1],u.slice(2))):l==="has"?Zl(u[1]):l==="!has"?dl(Zl(u[1])):l!=="within"||u;var h}function hl(u,l,h){switch(u){case"$type":return[`filter-type-${h}`,l];case"$id":return[`filter-id-${h}`,l];default:return[`filter-${h}`,u,l]}}function $l(u,l){if(l.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(h=>typeof h!=typeof l[0])?["filter-in-large",u,["literal",l.sort(Uc)]]:["filter-in-small",u,["literal",l]]}}function Zl(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function dl(u){return["!",u]}function ls(u){const l=typeof u;if(l==="number"||l==="boolean"||l==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let v="[";for(const E of u)v+=`${ls(E)},`;return`${v}]`}const h=Object.keys(u).sort();let p="{";for(let v=0;v<h.length;v++)p+=`${JSON.stringify(h[v])}:${ls(u[h[v]])},`;return`${p}}`}function Md(u){let l="";for(const h of ir)l+=`/${ls(u[h])}`;return l}function Gc(u){const l=u.value;return l?[new de(u.key,l,"constants have been deprecated as of v8")]:[]}function Oi(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function Dn(u){if(Array.isArray(u))return u.map(Dn);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const l={};for(const h in u)l[h]=Dn(u[h]);return l}return Oi(u)}function Cn(u){const l=u.key,h=u.value,p=u.valueSpec||{},v=u.objectElementValidators||{},E=u.style,T=u.styleSpec,L=u.validateSpec;let R=[];const V=ie(h);if(V!=="object")return[new de(l,h,`object expected, ${V} found`)];for(const W in h){const K=W.split(".")[0],rt=p[K]||p["*"];let lt;if(v[K])lt=v[K];else if(p[K])lt=L;else if(v["*"])lt=v["*"];else{if(!p["*"]){R.push(new de(l,h[W],`unknown property "${W}"`));continue}lt=L}R=R.concat(lt({key:(l&&`${l}.`)+W,value:h[W],valueSpec:rt,style:E,styleSpec:T,object:h,objectKey:W,validateSpec:L},h))}for(const W in p)v[W]||p[W].required&&p[W].default===void 0&&h[W]===void 0&&R.push(new de(l,h,`missing required property "${W}"`));return R}function Eu(u){const l=u.value,h=u.valueSpec,p=u.style,v=u.styleSpec,E=u.key,T=u.arrayElementValidator||u.validateSpec;if(ie(l)!=="array")return[new de(E,l,`array expected, ${ie(l)} found`)];if(h.length&&l.length!==h.length)return[new de(E,l,`array length ${h.length} expected, length ${l.length} found`)];if(h["min-length"]&&l.length<h["min-length"])return[new de(E,l,`array length at least ${h["min-length"]} expected, length ${l.length} found`)];let L={type:h.value,values:h.values};v.$version<7&&(L.function=h.function),ie(h.value)==="object"&&(L=h.value);let R=[];for(let V=0;V<l.length;V++)R=R.concat(T({array:l,arrayIndex:V,value:l[V],valueSpec:L,validateSpec:u.validateSpec,style:p,styleSpec:v,key:`${E}[${V}]`}));return R}function Vc(u){const l=u.key,h=u.value,p=u.valueSpec;let v=ie(h);return v==="number"&&h!=h&&(v="NaN"),v!=="number"?[new de(l,h,`number expected, ${v} found`)]:"minimum"in p&&h<p.minimum?[new de(l,h,`${h} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&h>p.maximum?[new de(l,h,`${h} is greater than the maximum value ${p.maximum}`)]:[]}function Pa(u){const l=u.valueSpec,h=Oi(u.value.type);let p,v,E,T={};const L=h!=="categorical"&&u.value.property===void 0,R=!L,V=ie(u.value.stops)==="array"&&ie(u.value.stops[0])==="array"&&ie(u.value.stops[0][0])==="object",W=Cn({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(lt){if(h==="identity")return[new de(lt.key,lt.value,'identity function may not have a "stops" property')];let ut=[];const _t=lt.value;return ut=ut.concat(Eu({key:lt.key,value:_t,valueSpec:lt.valueSpec,validateSpec:lt.validateSpec,style:lt.style,styleSpec:lt.styleSpec,arrayElementValidator:K})),ie(_t)==="array"&&_t.length===0&&ut.push(new de(lt.key,_t,"array must have at least one stop")),ut},default:function(lt){return lt.validateSpec({key:lt.key,value:lt.value,valueSpec:l,validateSpec:lt.validateSpec,style:lt.style,styleSpec:lt.styleSpec})}}});return h==="identity"&&L&&W.push(new de(u.key,u.value,'missing required property "property"')),h==="identity"||u.value.stops||W.push(new de(u.key,u.value,'missing required property "stops"')),h==="exponential"&&u.valueSpec.expression&&!te(u.valueSpec)&&W.push(new de(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(R&&!It(u.valueSpec)?W.push(new de(u.key,u.value,"property functions not supported")):L&&!qt(u.valueSpec)&&W.push(new de(u.key,u.value,"zoom functions not supported"))),h!=="categorical"&&!V||u.value.property!==void 0||W.push(new de(u.key,u.value,'"property" property is required')),W;function K(lt){let ut=[];const _t=lt.value,Pt=lt.key;if(ie(_t)!=="array")return[new de(Pt,_t,`array expected, ${ie(_t)} found`)];if(_t.length!==2)return[new de(Pt,_t,`array length 2 expected, length ${_t.length} found`)];if(V){if(ie(_t[0])!=="object")return[new de(Pt,_t,`object expected, ${ie(_t[0])} found`)];if(_t[0].zoom===void 0)return[new de(Pt,_t,"object stop key must have zoom")];if(_t[0].value===void 0)return[new de(Pt,_t,"object stop key must have value")];if(E&&E>Oi(_t[0].zoom))return[new de(Pt,_t[0].zoom,"stop zoom values must appear in ascending order")];Oi(_t[0].zoom)!==E&&(E=Oi(_t[0].zoom),v=void 0,T={}),ut=ut.concat(Cn({key:`${Pt}[0]`,value:_t[0],valueSpec:{zoom:{}},validateSpec:lt.validateSpec,style:lt.style,styleSpec:lt.styleSpec,objectElementValidators:{zoom:Vc,value:rt}}))}else ut=ut.concat(rt({key:`${Pt}[0]`,value:_t[0],valueSpec:{},validateSpec:lt.validateSpec,style:lt.style,styleSpec:lt.styleSpec},_t));return jr(Dn(_t[1]))?ut.concat([new de(`${Pt}[1]`,_t[1],"expressions are not allowed in function stops.")]):ut.concat(lt.validateSpec({key:`${Pt}[1]`,value:_t[1],valueSpec:l,validateSpec:lt.validateSpec,style:lt.style,styleSpec:lt.styleSpec}))}function rt(lt,ut){const _t=ie(lt.value),Pt=Oi(lt.value),Ot=lt.value!==null?lt.value:ut;if(p){if(_t!==p)return[new de(lt.key,Ot,`${_t} stop domain type must match previous stop domain type ${p}`)]}else p=_t;if(_t!=="number"&&_t!=="string"&&_t!=="boolean")return[new de(lt.key,Ot,"stop domain value must be a number, string, or boolean")];if(_t!=="number"&&h!=="categorical"){let Yt=`number expected, ${_t} found`;return It(l)&&h===void 0&&(Yt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new de(lt.key,Ot,Yt)]}return h!=="categorical"||_t!=="number"||isFinite(Pt)&&Math.floor(Pt)===Pt?h!=="categorical"&&_t==="number"&&v!==void 0&&Pt<v?[new de(lt.key,Ot,"stop domain values must appear in ascending order")]:(v=Pt,h==="categorical"&&Pt in T?[new de(lt.key,Ot,"stop domain values must be unique")]:(T[Pt]=!0,[])):[new de(lt.key,Ot,`integer expected, found ${Pt}`)]}}function Tn(u){const l=(u.expressionContext==="property"?na:Zi)(Dn(u.value),u.valueSpec);if(l.result==="error")return l.value.map(p=>new de(`${u.key}${p.key}`,u.value,p.message));const h=l.value.expression||l.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!h.outputDefined())return[new de(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!ta(h))return[new de(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!ta(h))return[new de(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!Ea(h,["zoom","feature-state"]))return[new de(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!zl(h))return[new de(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Nn(u){const l=u.key,h=u.value,p=u.valueSpec,v=[];return Array.isArray(p.values)?p.values.indexOf(Oi(h))===-1&&v.push(new de(l,h,`expected one of [${p.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(p.values).indexOf(Oi(h))===-1&&v.push(new de(l,h,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function Gs(u){return cl(Dn(u.value))?Tn(Tr({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ro(u)}function ro(u){const l=u.value,h=u.key;if(ie(l)!=="array")return[new de(h,l,`array expected, ${ie(l)} found`)];const p=u.styleSpec;let v,E=[];if(l.length<1)return[new de(h,l,"filter array must have at least 1 element")];switch(E=E.concat(Nn({key:`${h}[0]`,value:l[0],valueSpec:p.filter_operator,style:u.style,styleSpec:u.styleSpec})),Oi(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&Oi(l[1])==="$type"&&E.push(new de(h,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&E.push(new de(h,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(v=ie(l[1]),v!=="string"&&E.push(new de(`${h}[1]`,l[1],`string expected, ${v} found`)));for(let T=2;T<l.length;T++)v=ie(l[T]),Oi(l[1])==="$type"?E=E.concat(Nn({key:`${h}[${T}]`,value:l[T],valueSpec:p.geometry_type,style:u.style,styleSpec:u.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&E.push(new de(`${h}[${T}]`,l[T],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let T=1;T<l.length;T++)E=E.concat(ro({key:`${h}[${T}]`,value:l[T],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":v=ie(l[1]),l.length!==2?E.push(new de(h,l,`filter array for "${l[0]}" operator must have 2 elements`)):v!=="string"&&E.push(new de(`${h}[1]`,l[1],`string expected, ${v} found`));break;case"within":v=ie(l[1]),l.length!==2?E.push(new de(h,l,`filter array for "${l[0]}" operator must have 2 elements`)):v!=="object"&&E.push(new de(`${h}[1]`,l[1],`object expected, ${v} found`))}return E}function io(u,l){const h=u.key,p=u.validateSpec,v=u.style,E=u.styleSpec,T=u.value,L=u.objectKey,R=E[`${l}_${u.layerType}`];if(!R)return[];const V=L.match(/^(.*)-transition$/);if(l==="paint"&&V&&R[V[1]]&&R[V[1]].transition)return p({key:h,value:T,valueSpec:E.transition,style:v,styleSpec:E});const W=u.valueSpec||R[L];if(!W)return[new de(h,T,`unknown property "${L}"`)];let K;if(ie(T)==="string"&&It(W)&&!W.tokens&&(K=/^{([^}]+)}$/.exec(T)))return[new de(h,T,`"${L}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(K[1])} }\`.`)];const rt=[];return u.layerType==="symbol"&&(L==="text-field"&&v&&!v.glyphs&&rt.push(new de(h,T,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&Me(Dn(T))&&Oi(T.type)==="identity"&&rt.push(new de(h,T,'"text-font" does not support identity functions'))),rt.concat(p({key:u.key,value:T,valueSpec:W,style:v,styleSpec:E,expressionContext:"property",propertyType:l,propertyKey:L}))}function fl(u){return io(u,"paint")}function Vs(u){return io(u,"layout")}function sa(u){let l=[];const h=u.value,p=u.key,v=u.style,E=u.styleSpec;h.type||h.ref||l.push(new de(p,h,'either "type" or "ref" is required'));let T=Oi(h.type);const L=Oi(h.ref);if(h.id){const R=Oi(h.id);for(let V=0;V<u.arrayIndex;V++){const W=v.layers[V];Oi(W.id)===R&&l.push(new de(p,h.id,`duplicate layer id "${h.id}", previously used at line ${W.id.__line__}`))}}if("ref"in h){let R;["type","source","source-layer","filter","layout"].forEach(V=>{V in h&&l.push(new de(p,h[V],`"${V}" is prohibited for ref layers`))}),v.layers.forEach(V=>{Oi(V.id)===L&&(R=V)}),R?R.ref?l.push(new de(p,h.ref,"ref cannot reference another ref layer")):T=Oi(R.type):l.push(new de(p,h.ref,`ref layer "${L}" not found`))}else if(T!=="background")if(h.source){const R=v.sources&&v.sources[h.source],V=R&&Oi(R.type);R?V==="vector"&&T==="raster"?l.push(new de(p,h.source,`layer "${h.id}" requires a raster source`)):V!=="raster-dem"&&T==="hillshade"?l.push(new de(p,h.source,`layer "${h.id}" requires a raster-dem source`)):V==="raster"&&T!=="raster"?l.push(new de(p,h.source,`layer "${h.id}" requires a vector source`)):V!=="vector"||h["source-layer"]?V==="raster-dem"&&T!=="hillshade"?l.push(new de(p,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="line"||!h.paint||!h.paint["line-gradient"]||V==="geojson"&&R.lineMetrics||l.push(new de(p,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new de(p,h,`layer "${h.id}" must specify a "source-layer"`)):l.push(new de(p,h.source,`source "${h.source}" not found`))}else l.push(new de(p,h,'missing required property "source"'));return l=l.concat(Cn({key:p,value:h,valueSpec:E.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${p}.type`,value:h.type,valueSpec:E.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:h,objectKey:"type"}),filter:Gs,layout:R=>Cn({layer:h,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":V=>Vs(Tr({layerType:T},V))}}),paint:R=>Cn({layer:h,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":V=>fl(Tr({layerType:T},V))}})}})),l}function Ro(u){const l=u.value,h=u.key,p=ie(l);return p!=="string"?[new de(h,l,`string expected, ${p} found`)]:[]}const Ia={promoteId:function(u){let{key:l,value:h}=u;if(ie(h)==="string")return Ro({key:l,value:h});{const p=[];for(const v in h)p.push(...Ro({key:`${l}.${v}`,value:h[v]}));return p}}};function no(u){const l=u.value,h=u.key,p=u.styleSpec,v=u.style,E=u.validateSpec;if(!l.type)return[new de(h,l,'"type" is required')];const T=Oi(l.type);let L;switch(T){case"vector":case"raster":return L=Cn({key:h,value:l,valueSpec:p[`source_${T.replace("-","_")}`],style:u.style,styleSpec:p,objectElementValidators:Ia,validateSpec:E}),L;case"raster-dem":return L=function(R){var V;const W=(V=R.sourceName)!==null&&V!==void 0?V:"",K=R.value,rt=R.styleSpec,lt=rt.source_raster_dem,ut=R.style;let _t=[];const Pt=ie(K);if(K===void 0)return _t;if(Pt!=="object")return _t.push(new de("source_raster_dem",K,`object expected, ${Pt} found`)),_t;const Ot=Oi(K.encoding)==="custom",Yt=["redFactor","greenFactor","blueFactor","baseShift"],Ft=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const Wt in K)!Ot&&Yt.includes(Wt)?_t.push(new de(Wt,K[Wt],`In "${W}": "${Wt}" is only valid when "encoding" is set to "custom". ${Ft} encoding found`)):lt[Wt]?_t=_t.concat(R.validateSpec({key:Wt,value:K[Wt],valueSpec:lt[Wt],validateSpec:R.validateSpec,style:ut,styleSpec:rt})):_t.push(new de(Wt,K[Wt],`unknown property "${Wt}"`));return _t}({sourceName:h,value:l,style:u.style,styleSpec:p,validateSpec:E}),L;case"geojson":if(L=Cn({key:h,value:l,valueSpec:p.source_geojson,style:v,styleSpec:p,validateSpec:E,objectElementValidators:Ia}),l.cluster)for(const R in l.clusterProperties){const[V,W]=l.clusterProperties[R],K=typeof V=="string"?[V,["accumulated"],["get",R]]:V;L.push(...Tn({key:`${h}.${R}.map`,value:W,validateSpec:E,expressionContext:"cluster-map"})),L.push(...Tn({key:`${h}.${R}.reduce`,value:K,validateSpec:E,expressionContext:"cluster-reduce"}))}return L;case"video":return Cn({key:h,value:l,valueSpec:p.source_video,style:v,validateSpec:E,styleSpec:p});case"image":return Cn({key:h,value:l,valueSpec:p.source_image,style:v,validateSpec:E,styleSpec:p});case"canvas":return[new de(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Nn({key:`${h}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,validateSpec:E,styleSpec:p})}}function oa(u){const l=u.value,h=u.styleSpec,p=h.light,v=u.style;let E=[];const T=ie(l);if(l===void 0)return E;if(T!=="object")return E=E.concat([new de("light",l,`object expected, ${T} found`)]),E;for(const L in l){const R=L.match(/^(.*)-transition$/);E=E.concat(R&&p[R[1]]&&p[R[1]].transition?u.validateSpec({key:L,value:l[L],valueSpec:h.transition,validateSpec:u.validateSpec,style:v,styleSpec:h}):p[L]?u.validateSpec({key:L,value:l[L],valueSpec:p[L],validateSpec:u.validateSpec,style:v,styleSpec:h}):[new de(L,l[L],`unknown property "${L}"`)])}return E}function pl(u){const l=u.value,h=u.styleSpec,p=h.sky,v=u.style,E=ie(l);if(l===void 0)return[];if(E!=="object")return[new de("sky",l,`object expected, ${E} found`)];let T=[];for(const L in l)T=T.concat(p[L]?Cs({key:L,value:l[L],valueSpec:p[L],style:v,styleSpec:h}):[new de(L,l[L],`unknown property "${L}"`)]);return T}function aa(u){const l=u.value,h=u.styleSpec,p=h.terrain,v=u.style;let E=[];const T=ie(l);if(l===void 0)return E;if(T!=="object")return E=E.concat([new de("terrain",l,`object expected, ${T} found`)]),E;for(const L in l)E=E.concat(p[L]?u.validateSpec({key:L,value:l[L],valueSpec:p[L],validateSpec:u.validateSpec,style:v,styleSpec:h}):[new de(L,l[L],`unknown property "${L}"`)]);return E}function Oo(u){let l=[];const h=u.value,p=u.key;if(Array.isArray(h)){const v=[],E=[];for(const T in h)h[T].id&&v.includes(h[T].id)&&l.push(new de(p,h,`all the sprites' ids must be unique, but ${h[T].id} is duplicated`)),v.push(h[T].id),h[T].url&&E.includes(h[T].url)&&l.push(new de(p,h,`all the sprites' URLs must be unique, but ${h[T].url} is duplicated`)),E.push(h[T].url),l=l.concat(Cn({key:`${p}[${T}]`,value:h[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return l}return Ro({key:p,value:h})}const dn={"*":()=>[],array:Eu,boolean:function(u){const l=u.value,h=u.key,p=ie(l);return p!=="boolean"?[new de(h,l,`boolean expected, ${p} found`)]:[]},number:Vc,color:function(u){const l=u.key,h=u.value,p=ie(h);return p!=="string"?[new de(l,h,`color expected, ${p} found`)]:Rr.parse(String(h))?[]:[new de(l,h,`color expected, "${h}" found`)]},constants:Gc,enum:Nn,filter:Gs,function:Pa,layer:sa,object:Cn,source:no,light:oa,sky:pl,terrain:aa,string:Ro,formatted:function(u){return Ro(u).length===0?[]:Tn(u)},resolvedImage:function(u){return Ro(u).length===0?[]:Tn(u)},padding:function(u){const l=u.key,h=u.value;if(ie(h)==="array"){if(h.length<1||h.length>4)return[new de(l,h,`padding requires 1 to 4 values; ${h.length} values found`)];const p={type:"number"};let v=[];for(let E=0;E<h.length;E++)v=v.concat(u.validateSpec({key:`${l}[${E}]`,value:h[E],validateSpec:u.validateSpec,valueSpec:p}));return v}return Vc({key:l,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(u){const l=u.key,h=u.value,p=ie(h),v=u.styleSpec;if(p!=="array"||h.length<1||h.length%2!=0)return[new de(l,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let T=0;T<h.length;T+=2)E=E.concat(Nn({key:`${l}[${T}]`,value:h[T],valueSpec:v.layout_symbol["text-anchor"]})),E=E.concat(Eu({key:`${l}[${T+1}]`,value:h[T+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:v}));return E},sprite:Oo};function Cs(u){const l=u.value,h=u.valueSpec,p=u.styleSpec;return u.validateSpec=Cs,h.expression&&Me(Oi(l))?Pa(u):h.expression&&jr(Dn(l))?Tn(u):h.type&&dn[h.type]?dn[h.type](u):Cn(Tr({},u,{valueSpec:h.type?p[h.type]:h}))}function Ts(u){const l=u.value,h=u.key,p=Ro(u);return p.length||(l.indexOf("{fontstack}")===-1&&p.push(new de(h,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&p.push(new de(h,l,'"glyphs" url must include a "{range}" token'))),p}function Pn(u){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xt,h=[];return h=h.concat(Cs({key:"",value:u,valueSpec:l.$root,styleSpec:l,style:u,validateSpec:Cs,objectElementValidators:{glyphs:Ts,"*":()=>[]}})),u.constants&&(h=h.concat(Gc({key:"constants",value:u.constants,style:u,styleSpec:l,validateSpec:Cs}))),yi(h)}function ii(u){return function(l){return u({...l,validateSpec:Cs})}}function yi(u){return[].concat(u).sort((l,h)=>l.line-h.line)}function _i(u){return function(){for(var l=arguments.length,h=new Array(l),p=0;p<l;p++)h[p]=arguments[p];return yi(u.apply(this,h))}}Pn.source=_i(ii(no)),Pn.sprite=_i(ii(Oo)),Pn.glyphs=_i(ii(Ts)),Pn.light=_i(ii(oa)),Pn.sky=_i(ii(pl)),Pn.terrain=_i(ii(aa)),Pn.layer=_i(ii(sa)),Pn.filter=_i(ii(Gs)),Pn.paintProperty=_i(ii(fl)),Pn.layoutProperty=_i(ii(Vs));const ji=Pn,Ma=ji.light,la=ji.paintProperty,qc=ji.layoutProperty;function La(u,l){let h=!1;if(l&&l.length)for(const p of l)u.fire(new ge(new Error(p.message))),h=!0;return h}class Hc{constructor(l,h,p){const v=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;const T=new Int32Array(this.arrayBuffer);l=T[0],this.d=(h=T[1])+2*(p=T[2]);for(let R=0;R<this.d*this.d;R++){const V=T[3+R],W=T[3+R+1];v.push(V===W?null:T.subarray(V,W))}const L=T[3+v.length+1];this.keys=T.subarray(T[3+v.length],L),this.bboxes=T.subarray(L),this.insert=this._insertReadonly}else{this.d=h+2*p;for(let T=0;T<this.d*this.d;T++)v.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=l,this.padding=p,this.scale=h/l,this.uid=0;const E=p/h*l;this.min=-E,this.max=l+E}insert(l,h,p,v,E){this._forEachCell(h,p,v,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(v),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,h,p,v,E,T){this.cells[E].push(T)}query(l,h,p,v,E){const T=this.min,L=this.max;if(l<=T&&h<=T&&L<=p&&L<=v&&!E)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(l,h,p,v,this._queryCell,R,{},E),R}}_queryCell(l,h,p,v,E,T,L,R){const V=this.cells[E];if(V!==null){const W=this.keys,K=this.bboxes;for(let rt=0;rt<V.length;rt++){const lt=V[rt];if(L[lt]===void 0){const ut=4*lt;(R?R(K[ut+0],K[ut+1],K[ut+2],K[ut+3]):l<=K[ut+2]&&h<=K[ut+3]&&p>=K[ut+0]&&v>=K[ut+1])?(L[lt]=!0,T.push(W[lt])):L[lt]=!1}}}}_forEachCell(l,h,p,v,E,T,L,R){const V=this._convertToCellCoord(l),W=this._convertToCellCoord(h),K=this._convertToCellCoord(p),rt=this._convertToCellCoord(v);for(let lt=V;lt<=K;lt++)for(let ut=W;ut<=rt;ut++){const _t=this.d*ut+lt;if((!R||R(this._convertFromCellCoord(lt),this._convertFromCellCoord(ut),this._convertFromCellCoord(lt+1),this._convertFromCellCoord(ut+1)))&&E.call(this,l,h,p,v,_t,T,L,R))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const l=this.cells,h=3+this.cells.length+1+1;let p=0;for(let T=0;T<this.cells.length;T++)p+=this.cells[T].length;const v=new Int32Array(h+p+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let E=h;for(let T=0;T<l.length;T++){const L=l[T];v[3+T]=E,v.set(L,E),E+=L.length}return v[3+l.length]=E,v.set(this.keys,E),E+=this.keys.length,v[3+l.length+1]=E,v.set(this.bboxes,E),E+=this.bboxes.length,v.buffer}static serialize(l,h){const p=l.toArrayBuffer();return h&&h.push(p),{buffer:p}}static deserialize(l){return new Hc(l.buffer)}}const Do={};function $e(u,l){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Do[u])throw new Error(`${u} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:u,writeable:!1}),Do[u]={klass:l,omit:h.omit||[],shallow:h.shallow||[]}}$e("Object",Object),$e("TransferableGridIndex",Hc),$e("Color",Rr),$e("Error",Error),$e("AJAXError",ne),$e("ResolvedImage",Jn),$e("StylePropertyFunction",Hl),$e("StyleExpression",Or,{omit:["_evaluator"]}),$e("ZoomDependentExpression",Es),$e("ZoomConstantExpression",Ss),$e("CompoundExpression",on,{omit:["_evaluate"]});for(const u in Bo)Bo[u]._classRegistryKey||$e(`Expression_${u}`,Bo[u]);function Cu(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function Jl(u,l){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error)return u;if(Cu(u)||Dt(u))return l&&l.push(u),u;if(ArrayBuffer.isView(u)){const h=u;return l&&l.push(h.buffer),h}if(u instanceof ImageData)return l&&l.push(u.data.buffer),u;if(Array.isArray(u)){const h=[];for(const p of u)h.push(Jl(p,l));return h}if(typeof u=="object"){const h=u.constructor,p=h._classRegistryKey;if(!p)throw new Error(`can't serialize object of unregistered class ${h.name}`);if(!Do[p])throw new Error(`${p} is not registered.`);const v=h.serialize?h.serialize(u,l):{};if(h.serialize){if(l&&v===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const E in u){if(!u.hasOwnProperty(E)||Do[p].omit.indexOf(E)>=0)continue;const T=u[E];v[E]=Do[p].shallow.indexOf(E)>=0?T:Jl(T,l)}u instanceof Error&&(v.message=u.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(v.$name=p),v}throw new Error("can't serialize object of type "+typeof u)}function Xl(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||Cu(u)||Dt(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(Xl);if(typeof u=="object"){const l=u.$name||"Object";if(!Do[l])throw new Error(`can't deserialize unregistered class ${l}`);const{klass:h}=Do[l];if(!h)throw new Error(`can't deserialize unregistered class ${l}`);if(h.deserialize)return h.deserialize(u);const p=Object.create(h.prototype);for(const v of Object.keys(u)){if(v==="$name")continue;const E=u[v];p[v]=Do[l].shallow.indexOf(v)>=0?E:Xl(E)}return p}throw new Error("can't deserialize object of type "+typeof u)}class bh{constructor(){this.first=!0}update(l,h){const p=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=h),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=p,!0))}}const Fe={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function Fn(u){for(const l of u)if(Kl(l.charCodeAt(0)))return!0;return!1}function qs(u){for(const l of u)if(!Tu(l.charCodeAt(0)))return!1;return!0}function Tu(u){return!(Fe.Arabic(u)||Fe["Arabic Supplement"](u)||Fe["Arabic Extended-A"](u)||Fe["Arabic Presentation Forms-A"](u)||Fe["Arabic Presentation Forms-B"](u))}function Kl(u){return!(u!==746&&u!==747&&(u<4352||!(Fe["Bopomofo Extended"](u)||Fe.Bopomofo(u)||Fe["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Fe["CJK Compatibility Ideographs"](u)||Fe["CJK Compatibility"](u)||Fe["CJK Radicals Supplement"](u)||Fe["CJK Strokes"](u)||!(!Fe["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||Fe["CJK Unified Ideographs Extension A"](u)||Fe["CJK Unified Ideographs"](u)||Fe["Enclosed CJK Letters and Months"](u)||Fe["Hangul Compatibility Jamo"](u)||Fe["Hangul Jamo Extended-A"](u)||Fe["Hangul Jamo Extended-B"](u)||Fe["Hangul Jamo"](u)||Fe["Hangul Syllables"](u)||Fe.Hiragana(u)||Fe["Ideographic Description Characters"](u)||Fe.Kanbun(u)||Fe["Kangxi Radicals"](u)||Fe["Katakana Phonetic Extensions"](u)||Fe.Katakana(u)&&u!==12540||!(!Fe["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!Fe["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Fe["Unified Canadian Aboriginal Syllabics"](u)||Fe["Unified Canadian Aboriginal Syllabics Extended"](u)||Fe["Vertical Forms"](u)||Fe["Yijing Hexagram Symbols"](u)||Fe["Yi Syllables"](u)||Fe["Yi Radicals"](u))))}function wh(u){return!(Kl(u)||function(l){return!!(Fe["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||Fe["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||Fe["Letterlike Symbols"](l)||Fe["Number Forms"](l)||Fe["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||Fe["Control Pictures"](l)&&l!==9251||Fe["Optical Character Recognition"](l)||Fe["Enclosed Alphanumerics"](l)||Fe["Geometric Shapes"](l)||Fe["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||Fe["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Fe["CJK Symbols and Punctuation"](l)||Fe.Katakana(l)||Fe["Private Use Area"](l)||Fe["CJK Compatibility Forms"](l)||Fe["Small Form Variants"](l)||Fe["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(u))}function Yl(u){return u>=1424&&u<=2303||Fe["Arabic Presentation Forms-A"](u)||Fe["Arabic Presentation Forms-B"](u)}function Pu(u,l){return!(!l&&Yl(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Fe.Khmer(u))}function Ld(u){for(const l of u)if(Yl(l.charCodeAt(0)))return!0;return!1}const Ba=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Mi{constructor(l,h){this.zoom=l,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new bh,this.transition={})}isSupportedScript(l){return function(h,p){for(const v of h)if(!Pu(v.charCodeAt(0),p))return!1;return!0}(l,Ba.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const l=this.zoom,h=l-Math.floor(l),p=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*h}}}class Ql{constructor(l,h){this.property=l,this.value=h,this.expression=function(p,v){if(Me(p))return new Hl(p,v);if(jr(p)){const E=na(p,v);if(E.result==="error")throw new Error(E.value.map(T=>`${T.key}: ${T.message}`).join(", "));return E.value}{let E=p;return v.type==="color"&&typeof p=="string"?E=Rr.parse(p):v.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(E=Fi.parse(p)):E=$i.parse(p),{kind:"constant",evaluate:()=>E}}}(h===void 0?l.specification.default:h,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,h,p){return this.property.possiblyEvaluate(this,l,h,p)}}class tc{constructor(l){this.property=l,this.value=new Ql(l,void 0)}transitioned(l,h){return new Df(this.property,this.value,h,bt({},l.transition,this.transition),l.now)}untransitioned(){return new Df(this.property,this.value,null,{},0)}}class Iu{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return at(this._values[l].value.value)}setValue(l,h){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new tc(this._values[l].property)),this._values[l].value=new Ql(this._values[l].property,h===null?void 0:at(h))}getTransition(l){return at(this._values[l].transition)}setTransition(l,h){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new tc(this._values[l].property)),this._values[l].transition=at(h)||void 0}serialize(){const l={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(l[h]=p);const v=this.getTransition(h);v!==void 0&&(l[`${h}-transition`]=v)}return l}transitioned(l,h){const p=new Nf(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].transitioned(l,h._values[v]);return p}untransitioned(){const l=new Nf(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].untransitioned();return l}}class Df{constructor(l,h,p,v,E){this.property=l,this.value=h,this.begin=E+v.delay||0,this.end=this.begin+v.duration||0,l.specification.transition&&(v.delay||v.duration)&&(this.prior=p)}possiblyEvaluate(l,h,p){const v=l.now||0,E=this.value.possiblyEvaluate(l,h,p),T=this.prior;if(T){if(v>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(v<this.begin)return T.possiblyEvaluate(l,h,p);{const L=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(l,h,p),E,function(R){if(R<=0)return 0;if(R>=1)return 1;const V=R*R,W=V*R;return 4*(R<.5?W:3*(R-V)+W-.75)}(L))}}return E}}class Nf{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,h,p){const v=new Mu(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(l,h,p);return v}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class Bd{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}hasValue(l){return this._values[l].value!==void 0}getValue(l){return at(this._values[l].value)}setValue(l,h){this._values[l]=new Ql(this._values[l].property,h===null?void 0:at(h))}serialize(){const l={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(l[h]=p)}return l}possiblyEvaluate(l,h,p){const v=new Mu(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(l,h,p);return v}}class No{constructor(l,h,p){this.property=l,this.value=h,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,h,p,v){return this.property.evaluate(this.value,this.parameters,l,h,p,v)}}class Mu{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class or{constructor(l){this.specification=l}possiblyEvaluate(l,h){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(h)}interpolate(l,h,p){const v=En[this.specification.type];return v?v(l,h,p):l}}class pr{constructor(l,h){this.specification=l,this.overrides=h}possiblyEvaluate(l,h,p,v){return new No(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(h,null,{},p,v)}:l.expression,h)}interpolate(l,h,p){if(l.value.kind!=="constant"||h.value.kind!=="constant")return l;if(l.value.value===void 0||h.value.value===void 0)return new No(this,{kind:"constant",value:void 0},l.parameters);const v=En[this.specification.type];if(v){const E=v(l.value.value,h.value.value,p);return new No(this,{kind:"constant",value:E},l.parameters)}return l}evaluate(l,h,p,v,E,T){return l.kind==="constant"?l.value:l.evaluate(h,p,v,E,T)}}class xh extends pr{possiblyEvaluate(l,h,p,v){if(l.value===void 0)return new No(this,{kind:"constant",value:void 0},h);if(l.expression.kind==="constant"){const E=l.expression.evaluate(h,null,{},p,v),T=l.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,L=this._calculate(T,T,T,h);return new No(this,{kind:"constant",value:L},h)}if(l.expression.kind==="camera"){const E=this._calculate(l.expression.evaluate({zoom:h.zoom-1}),l.expression.evaluate({zoom:h.zoom}),l.expression.evaluate({zoom:h.zoom+1}),h);return new No(this,{kind:"constant",value:E},h)}return new No(this,l.expression,h)}evaluate(l,h,p,v,E,T){if(l.kind==="source"){const L=l.evaluate(h,p,v,E,T);return this._calculate(L,L,L,h)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(h.zoom)-1},p,v),l.evaluate({zoom:Math.floor(h.zoom)},p,v),l.evaluate({zoom:Math.floor(h.zoom)+1},p,v),h):l.value}_calculate(l,h,p,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:l,to:h}:{from:p,to:h}}interpolate(l){return l}}class ec{constructor(l){this.specification=l}possiblyEvaluate(l,h,p,v){if(l.value!==void 0){if(l.expression.kind==="constant"){const E=l.expression.evaluate(h,null,{},p,v);return this._calculate(E,E,E,h)}return this._calculate(l.expression.evaluate(new Mi(Math.floor(h.zoom-1),h)),l.expression.evaluate(new Mi(Math.floor(h.zoom),h)),l.expression.evaluate(new Mi(Math.floor(h.zoom+1),h)),h)}}_calculate(l,h,p,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:l,to:h}:{from:p,to:h}}interpolate(l){return l}}class Lu{constructor(l){this.specification=l}possiblyEvaluate(l,h,p,v){return!!l.expression.evaluate(h,null,{},p,v)}interpolate(){return!1}}class zn{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in l){const p=l[h];p.specification.overridable&&this.overridableProperties.push(h);const v=this.defaultPropertyValues[h]=new Ql(p,void 0),E=this.defaultTransitionablePropertyValues[h]=new tc(p);this.defaultTransitioningPropertyValues[h]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=v.possiblyEvaluate({})}}}$e("DataDrivenProperty",pr),$e("DataConstantProperty",or),$e("CrossFadedDataDrivenProperty",xh),$e("CrossFadedProperty",ec),$e("ColorRampProperty",Lu);const kd="-transition";class Fo extends Bt{constructor(l,h){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),h.layout&&(this._unevaluatedLayout=new Bd(h.layout)),h.paint)){this._transitionablePaint=new Iu(h.paint);for(const p in l.paint)this.setPaintProperty(p,l.paint[p],{validate:!1});for(const p in l.layout)this.setLayoutProperty(p,l.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Mu(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};h!=null&&this._validate(qc,`layers.${this.id}.layout.${l}`,l,h,p)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,h):this.visibility=h)}getPaintProperty(l){return l.endsWith(kd)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(h!=null&&this._validate(la,`layers.${this.id}.paint.${l}`,l,h,p))return!1;if(l.endsWith(kd))return this._transitionablePaint.setTransition(l.slice(0,-11),h||void 0),!1;{const v=this._transitionablePaint._values[l],E=v.property.specification["property-type"]==="cross-faded-data-driven",T=v.value.isDataDriven(),L=v.value;this._transitionablePaint.setValue(l,h),this._handleSpecialPaintPropertyUpdate(l);const R=this._transitionablePaint._values[l].value;return R.isDataDriven()||T||E||this._handleOverridablePaintPropertyUpdate(l,L,R)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,h,p){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,h){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,h)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Rt(l,(h,p)=>!(h===void 0||p==="layout"&&!Object.keys(h).length||p==="paint"&&!Object.keys(h).length))}_validate(l,h,p,v){let E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!E||E.validate!==!1)&&La(this,l.call(ji,{key:h,layerType:this.type,objectKey:p,value:v,styleSpec:Xt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const h=this.paint.get(l);if(h instanceof No&&It(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const Rd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Bu{constructor(l,h){this._structArray=l,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class tn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,h){return l._trim(),h&&(l.isTransferred=!0,h.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const h=Object.create(this.prototype);return h.arrayBuffer=l.arrayBuffer,h.length=l.length,h.capacity=l.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function fn(u){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,h=0,p=0;return{members:u.map(v=>{const E=Rd[v.type].BYTES_PER_ELEMENT,T=h=Ff(h,Math.max(l,E)),L=v.components||1;return p=Math.max(p,E),h+=E*L,{name:v.name,type:v.type,components:L,offset:T}}),size:Ff(h,Math.max(p,l)),alignment:l}}function Ff(u,l){return Math.ceil(u/l)*l}class so extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h){const p=this.length;return this.resize(p+1),this.emplace(p,l,h)}emplace(l,h,p){const v=2*l;return this.int16[v+0]=h,this.int16[v+1]=p,l}}so.prototype.bytesPerElement=4,$e("StructArrayLayout2i4",so);class In extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,p){const v=this.length;return this.resize(v+1),this.emplace(v,l,h,p)}emplace(l,h,p,v){const E=3*l;return this.int16[E+0]=h,this.int16[E+1]=p,this.int16[E+2]=v,l}}In.prototype.bytesPerElement=6,$e("StructArrayLayout3i6",In);class zo extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,p,v){const E=this.length;return this.resize(E+1),this.emplace(E,l,h,p,v)}emplace(l,h,p,v,E){const T=4*l;return this.int16[T+0]=h,this.int16[T+1]=p,this.int16[T+2]=v,this.int16[T+3]=E,l}}zo.prototype.bytesPerElement=8,$e("StructArrayLayout4i8",zo);class Od extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,p,v,E,T){const L=this.length;return this.resize(L+1),this.emplace(L,l,h,p,v,E,T)}emplace(l,h,p,v,E,T,L){const R=6*l;return this.int16[R+0]=h,this.int16[R+1]=p,this.int16[R+2]=v,this.int16[R+3]=E,this.int16[R+4]=T,this.int16[R+5]=L,l}}Od.prototype.bytesPerElement=12,$e("StructArrayLayout2i4i12",Od);class Ah extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,p,v,E,T){const L=this.length;return this.resize(L+1),this.emplace(L,l,h,p,v,E,T)}emplace(l,h,p,v,E,T,L){const R=4*l,V=8*l;return this.int16[R+0]=h,this.int16[R+1]=p,this.uint8[V+4]=v,this.uint8[V+5]=E,this.uint8[V+6]=T,this.uint8[V+7]=L,l}}Ah.prototype.bytesPerElement=8,$e("StructArrayLayout2i4ub8",Ah);class oo extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h){const p=this.length;return this.resize(p+1),this.emplace(p,l,h)}emplace(l,h,p){const v=2*l;return this.float32[v+0]=h,this.float32[v+1]=p,l}}oo.prototype.bytesPerElement=8,$e("StructArrayLayout2f8",oo);class gs extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,p,v,E,T,L,R,V,W){const K=this.length;return this.resize(K+1),this.emplace(K,l,h,p,v,E,T,L,R,V,W)}emplace(l,h,p,v,E,T,L,R,V,W,K){const rt=10*l;return this.uint16[rt+0]=h,this.uint16[rt+1]=p,this.uint16[rt+2]=v,this.uint16[rt+3]=E,this.uint16[rt+4]=T,this.uint16[rt+5]=L,this.uint16[rt+6]=R,this.uint16[rt+7]=V,this.uint16[rt+8]=W,this.uint16[rt+9]=K,l}}gs.prototype.bytesPerElement=20,$e("StructArrayLayout10ui20",gs);class Dd extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,p,v,E,T,L,R,V,W,K,rt){const lt=this.length;return this.resize(lt+1),this.emplace(lt,l,h,p,v,E,T,L,R,V,W,K,rt)}emplace(l,h,p,v,E,T,L,R,V,W,K,rt,lt){const ut=12*l;return this.int16[ut+0]=h,this.int16[ut+1]=p,this.int16[ut+2]=v,this.int16[ut+3]=E,this.uint16[ut+4]=T,this.uint16[ut+5]=L,this.uint16[ut+6]=R,this.uint16[ut+7]=V,this.int16[ut+8]=W,this.int16[ut+9]=K,this.int16[ut+10]=rt,this.int16[ut+11]=lt,l}}Dd.prototype.bytesPerElement=24,$e("StructArrayLayout4i4ui4i24",Dd);class Nd extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,p){const v=this.length;return this.resize(v+1),this.emplace(v,l,h,p)}emplace(l,h,p,v){const E=3*l;return this.float32[E+0]=h,this.float32[E+1]=p,this.float32[E+2]=v,l}}Nd.prototype.bytesPerElement=12,$e("StructArrayLayout3f12",Nd);class ca extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.uint32[1*l+0]=h,l}}ca.prototype.bytesPerElement=4,$e("StructArrayLayout1ul4",ca);class ku extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,p,v,E,T,L,R,V){const W=this.length;return this.resize(W+1),this.emplace(W,l,h,p,v,E,T,L,R,V)}emplace(l,h,p,v,E,T,L,R,V,W){const K=10*l,rt=5*l;return this.int16[K+0]=h,this.int16[K+1]=p,this.int16[K+2]=v,this.int16[K+3]=E,this.int16[K+4]=T,this.int16[K+5]=L,this.uint32[rt+3]=R,this.uint16[K+8]=V,this.uint16[K+9]=W,l}}ku.prototype.bytesPerElement=20,$e("StructArrayLayout6i1ul2ui20",ku);class Wc extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,p,v,E,T){const L=this.length;return this.resize(L+1),this.emplace(L,l,h,p,v,E,T)}emplace(l,h,p,v,E,T,L){const R=6*l;return this.int16[R+0]=h,this.int16[R+1]=p,this.int16[R+2]=v,this.int16[R+3]=E,this.int16[R+4]=T,this.int16[R+5]=L,l}}Wc.prototype.bytesPerElement=12,$e("StructArrayLayout2i2i2i12",Wc);class Ru extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,p,v,E){const T=this.length;return this.resize(T+1),this.emplace(T,l,h,p,v,E)}emplace(l,h,p,v,E,T){const L=4*l,R=8*l;return this.float32[L+0]=h,this.float32[L+1]=p,this.float32[L+2]=v,this.int16[R+6]=E,this.int16[R+7]=T,l}}Ru.prototype.bytesPerElement=16,$e("StructArrayLayout2f1f2i16",Ru);class Ou extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,p,v){const E=this.length;return this.resize(E+1),this.emplace(E,l,h,p,v)}emplace(l,h,p,v,E){const T=12*l,L=3*l;return this.uint8[T+0]=h,this.uint8[T+1]=p,this.float32[L+1]=v,this.float32[L+2]=E,l}}Ou.prototype.bytesPerElement=12,$e("StructArrayLayout2ub2f12",Ou);class rc extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,p){const v=this.length;return this.resize(v+1),this.emplace(v,l,h,p)}emplace(l,h,p,v){const E=3*l;return this.uint16[E+0]=h,this.uint16[E+1]=p,this.uint16[E+2]=v,l}}rc.prototype.bytesPerElement=6,$e("StructArrayLayout3ui6",rc);class ka extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,p,v,E,T,L,R,V,W,K,rt,lt,ut,_t,Pt,Ot){const Yt=this.length;return this.resize(Yt+1),this.emplace(Yt,l,h,p,v,E,T,L,R,V,W,K,rt,lt,ut,_t,Pt,Ot)}emplace(l,h,p,v,E,T,L,R,V,W,K,rt,lt,ut,_t,Pt,Ot,Yt){const Ft=24*l,Wt=12*l,_e=48*l;return this.int16[Ft+0]=h,this.int16[Ft+1]=p,this.uint16[Ft+2]=v,this.uint16[Ft+3]=E,this.uint32[Wt+2]=T,this.uint32[Wt+3]=L,this.uint32[Wt+4]=R,this.uint16[Ft+10]=V,this.uint16[Ft+11]=W,this.uint16[Ft+12]=K,this.float32[Wt+7]=rt,this.float32[Wt+8]=lt,this.uint8[_e+36]=ut,this.uint8[_e+37]=_t,this.uint8[_e+38]=Pt,this.uint32[Wt+10]=Ot,this.int16[Ft+22]=Yt,l}}ka.prototype.bytesPerElement=48,$e("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ka);class jo extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,p,v,E,T,L,R,V,W,K,rt,lt,ut,_t,Pt,Ot,Yt,Ft,Wt,_e,be,We,nr,Ge,je,ke,Qe){const De=this.length;return this.resize(De+1),this.emplace(De,l,h,p,v,E,T,L,R,V,W,K,rt,lt,ut,_t,Pt,Ot,Yt,Ft,Wt,_e,be,We,nr,Ge,je,ke,Qe)}emplace(l,h,p,v,E,T,L,R,V,W,K,rt,lt,ut,_t,Pt,Ot,Yt,Ft,Wt,_e,be,We,nr,Ge,je,ke,Qe,De){const Te=32*l,_r=16*l;return this.int16[Te+0]=h,this.int16[Te+1]=p,this.int16[Te+2]=v,this.int16[Te+3]=E,this.int16[Te+4]=T,this.int16[Te+5]=L,this.int16[Te+6]=R,this.int16[Te+7]=V,this.uint16[Te+8]=W,this.uint16[Te+9]=K,this.uint16[Te+10]=rt,this.uint16[Te+11]=lt,this.uint16[Te+12]=ut,this.uint16[Te+13]=_t,this.uint16[Te+14]=Pt,this.uint16[Te+15]=Ot,this.uint16[Te+16]=Yt,this.uint16[Te+17]=Ft,this.uint16[Te+18]=Wt,this.uint16[Te+19]=_e,this.uint16[Te+20]=be,this.uint16[Te+21]=We,this.uint16[Te+22]=nr,this.uint32[_r+12]=Ge,this.float32[_r+13]=je,this.float32[_r+14]=ke,this.uint16[Te+30]=Qe,this.uint16[Te+31]=De,l}}jo.prototype.bytesPerElement=64,$e("StructArrayLayout8i15ui1ul2f2ui64",jo);class $c extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.float32[1*l+0]=h,l}}$c.prototype.bytesPerElement=4,$e("StructArrayLayout1f4",$c);class Du extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,p){const v=this.length;return this.resize(v+1),this.emplace(v,l,h,p)}emplace(l,h,p,v){const E=3*l;return this.uint16[6*l+0]=h,this.float32[E+1]=p,this.float32[E+2]=v,l}}Du.prototype.bytesPerElement=12,$e("StructArrayLayout1ui2f12",Du);class ic extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,p){const v=this.length;return this.resize(v+1),this.emplace(v,l,h,p)}emplace(l,h,p,v){const E=4*l;return this.uint32[2*l+0]=h,this.uint16[E+2]=p,this.uint16[E+3]=v,l}}ic.prototype.bytesPerElement=8,$e("StructArrayLayout1ul2ui8",ic);class Sh extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h){const p=this.length;return this.resize(p+1),this.emplace(p,l,h)}emplace(l,h,p){const v=2*l;return this.uint16[v+0]=h,this.uint16[v+1]=p,l}}Sh.prototype.bytesPerElement=4,$e("StructArrayLayout2ui4",Sh);class Fd extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.uint16[1*l+0]=h,l}}Fd.prototype.bytesPerElement=2,$e("StructArrayLayout1ui2",Fd);class Eh extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,p,v){const E=this.length;return this.resize(E+1),this.emplace(E,l,h,p,v)}emplace(l,h,p,v,E){const T=4*l;return this.float32[T+0]=h,this.float32[T+1]=p,this.float32[T+2]=v,this.float32[T+3]=E,l}}Eh.prototype.bytesPerElement=16,$e("StructArrayLayout4f16",Eh);class zf extends Bu{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new A(this.anchorPointX,this.anchorPointY)}}zf.prototype.size=20;class x extends ku{get(l){return new zf(this,l)}}$e("CollisionBoxArray",x);class c extends Bu{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}c.prototype.size=48;class d extends ka{get(l){return new c(this,l)}}$e("PlacedSymbolArray",d);class y extends Bu{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}y.prototype.size=64;class _ extends jo{get(l){return new y(this,l)}}$e("SymbolInstanceArray",_);class S extends $c{getoffsetX(l){return this.float32[1*l+0]}}$e("GlyphOffsetArray",S);class B extends In{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}$e("SymbolLineVertexArray",B);class k extends Bu{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}k.prototype.size=12;class g extends Du{get(l){return new k(this,l)}}$e("TextAnchorOffsetArray",g);class b extends Bu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}b.prototype.size=8;class C extends ic{get(l){return new b(this,l)}}$e("FeatureIndexArray",C);class M extends so{}class O extends so{}class j extends so{}class G extends Od{}class H extends Ah{}class q extends oo{}class X extends gs{}class ct extends Dd{}class et extends Nd{}class ht extends ca{}class ft extends Wc{}class Mt extends Ou{}class St extends rc{}class gt extends Sh{}const yt=fn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Vt}=yt;class $t{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=l}prepareSegment(l,h,p,v){let E=this.segments[this.segments.length-1];return l>$t.MAX_VERTEX_ARRAY_LENGTH&&kt(`Max vertices per segment is ${$t.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!E||E.vertexLength+l>$t.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==v)&&(E={vertexOffset:h.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},v!==void 0&&(E.sortKey=v),this.segments.push(E)),E}get(){return this.segments}destroy(){for(const l of this.segments)for(const h in l.vaos)l.vaos[h].destroy()}static simpleSegment(l,h,p,v){return new $t([{vertexOffset:l,primitiveOffset:h,vertexLength:p,primitiveLength:v,vaos:{},sortKey:0}])}}function ae(u,l){return 256*(u=mt(Math.floor(u),0,255))+mt(Math.floor(l),0,255)}$t.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$e("SegmentVector",$t);const le=fn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var me={exports:{}},Le={exports:{}};Le.exports=function(u,l){var h,p,v,E,T,L,R,V;for(p=u.length-(h=3&u.length),v=l,T=3432918353,L=461845907,V=0;V<p;)R=255&u.charCodeAt(V)|(255&u.charCodeAt(++V))<<8|(255&u.charCodeAt(++V))<<16|(255&u.charCodeAt(++V))<<24,++V,v=27492+(65535&(E=5*(65535&(v=(v^=R=(65535&(R=(R=(65535&R)*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*L+(((R>>>16)*L&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(R=0,h){case 3:R^=(255&u.charCodeAt(V+2))<<16;case 2:R^=(255&u.charCodeAt(V+1))<<8;case 1:v^=R=(65535&(R=(R=(65535&(R^=255&u.charCodeAt(V)))*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*L+(((R>>>16)*L&65535)<<16)&4294967295}return v^=u.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0};var we=Le.exports,Ue={exports:{}};Ue.exports=function(u,l){for(var h,p=u.length,v=l^p,E=0;p>=4;)h=1540483477*(65535&(h=255&u.charCodeAt(E)|(255&u.charCodeAt(++E))<<8|(255&u.charCodeAt(++E))<<16|(255&u.charCodeAt(++E))<<24))+((1540483477*(h>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++E;switch(p){case 3:v^=(255&u.charCodeAt(E+2))<<16;case 2:v^=(255&u.charCodeAt(E+1))<<8;case 1:v=1540483477*(65535&(v^=255&u.charCodeAt(E)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0};var Ke=we,Je=Ue.exports;me.exports=Ke,me.exports.murmur3=Ke,me.exports.murmur2=Je;var vr=f(me.exports);class br{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,h,p,v){this.ids.push(Vr(l)),this.positions.push(h,p,v)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=Vr(l);let p=0,v=this.ids.length-1;for(;p<v;){const T=p+v>>1;this.ids[T]>=h?v=T:p=T+1}const E=[];for(;this.ids[p]===h;)E.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return E}static serialize(l,h){const p=new Float64Array(l.ids),v=new Uint32Array(l.positions);return gr(p,v,0,p.length-1),h&&h.push(p.buffer,v.buffer),{ids:p,positions:v}}static deserialize(l){const h=new br;return h.ids=l.ids,h.positions=l.positions,h.indexed=!0,h}}function Vr(u){const l=+u;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:vr(String(u))}function gr(u,l,h,p){for(;h<p;){const v=u[h+p>>1];let E=h-1,T=p+1;for(;;){do E++;while(u[E]<v);do T--;while(u[T]>v);if(E>=T)break;Ur(u,E,T),Ur(l,3*E,3*T),Ur(l,3*E+1,3*T+1),Ur(l,3*E+2,3*T+2)}T-h<p-T?(gr(u,l,h,T),h=T+1):(gr(u,l,T+1,p),p=T)}}function Ur(u,l,h){const p=u[l];u[l]=u[h],u[h]=p}$e("FeaturePositionMap",br);class ci{constructor(l,h){this.gl=l.gl,this.location=h}}class ui extends ci{constructor(l,h){super(l,h),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class en extends ci{constructor(l,h){super(l,h),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class ti extends ci{constructor(l,h){super(l,h),this.current=Rr.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}const Kn=new Float32Array(16);function bn(u){return[ae(255*u.r,255*u.g),ae(255*u.b,255*u.a)]}class Li{constructor(l,h,p){this.value=l,this.uniformNames=h.map(v=>`u_${v}`),this.type=p}setUniform(l,h,p){l.set(p.constantOr(this.value))}getBinding(l,h,p){return this.type==="color"?new ti(l,h):new ui(l,h)}}class ei{constructor(l,h){this.uniformNames=h.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=l.tlbr}setUniform(l,h,p,v){const E=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&l.set(E)}getBinding(l,h,p){return p.substr(0,9)==="u_pattern"?new en(l,h):new ui(l,h)}}class Zr{constructor(l,h,p,v){this.expression=l,this.type=p,this.maxValue=0,this.paintVertexAttributes=h.map(E=>({name:`a_${E}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(l,h,p,v,E){const T=this.paintVertexArray.length,L=this.expression.evaluate(new Mi(0),h,{},v,[],E);this.paintVertexArray.resize(l),this._setPaintValue(T,l,L)}updatePaintArray(l,h,p,v){const E=this.expression.evaluate({zoom:0},p,v);this._setPaintValue(l,h,E)}_setPaintValue(l,h,p){if(this.type==="color"){const v=bn(p);for(let E=l;E<h;E++)this.paintVertexArray.emplace(E,v[0],v[1])}else{for(let v=l;v<h;v++)this.paintVertexArray.emplace(v,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ri{constructor(l,h,p,v,E,T){this.expression=l,this.uniformNames=h.map(L=>`u_${L}_t`),this.type=p,this.useIntegerZoom=v,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=h.map(L=>({name:`a_${L}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(l,h,p,v,E){const T=this.expression.evaluate(new Mi(this.zoom),h,{},v,[],E),L=this.expression.evaluate(new Mi(this.zoom+1),h,{},v,[],E),R=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(R,l,T,L)}updatePaintArray(l,h,p,v){const E=this.expression.evaluate({zoom:this.zoom},p,v),T=this.expression.evaluate({zoom:this.zoom+1},p,v);this._setPaintValue(l,h,E,T)}_setPaintValue(l,h,p,v){if(this.type==="color"){const E=bn(p),T=bn(v);for(let L=l;L<h;L++)this.paintVertexArray.emplace(L,E[0],E[1],T[0],T[1])}else{for(let E=l;E<h;E++)this.paintVertexArray.emplace(E,p,v);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(v))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,h){const p=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,v=mt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);l.set(v)}getBinding(l,h,p){return new ui(l,h)}}class pn{constructor(l,h,p,v,E,T){this.expression=l,this.type=h,this.useIntegerZoom=p,this.zoom=v,this.layerId=T,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(l,h,p){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(v,l,h.patterns&&h.patterns[this.layerId],p)}updatePaintArray(l,h,p,v,E){this._setPaintValues(l,h,p.patterns&&p.patterns[this.layerId],E)}_setPaintValues(l,h,p,v){if(!v||!p)return;const{min:E,mid:T,max:L}=p,R=v[E],V=v[T],W=v[L];if(R&&V&&W)for(let K=l;K<h;K++)this.zoomInPaintVertexArray.emplace(K,V.tl[0],V.tl[1],V.br[0],V.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],V.pixelRatio,R.pixelRatio),this.zoomOutPaintVertexArray.emplace(K,V.tl[0],V.tl[1],V.br[0],V.br[1],W.tl[0],W.tl[1],W.br[0],W.br[1],V.pixelRatio,W.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,le.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,le.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Yr{constructor(l,h,p){this.binders={},this._buffers=[];const v=[];for(const E in l.paint._values){if(!p(E))continue;const T=l.paint.get(E);if(!(T instanceof No&&It(T.property.specification)))continue;const L=jn(E,l.type),R=T.value,V=T.property.specification.type,W=T.property.useIntegerZoom,K=T.property.specification["property-type"],rt=K==="cross-faded"||K==="cross-faded-data-driven";if(R.kind==="constant")this.binders[E]=rt?new ei(R.value,L):new Li(R.value,L,V),v.push(`/u_${E}`);else if(R.kind==="source"||rt){const lt=Ui(E,V,"source");this.binders[E]=rt?new pn(R,V,W,h,lt,l.id):new Zr(R,L,V,lt),v.push(`/a_${E}`)}else{const lt=Ui(E,V,"composite");this.binders[E]=new ri(R,L,V,W,h,lt),v.push(`/z_${E}`)}}this.cacheKey=v.sort().join("")}getMaxValue(l){const h=this.binders[l];return h instanceof Zr||h instanceof ri?h.maxValue:0}populatePaintArrays(l,h,p,v,E){for(const T in this.binders){const L=this.binders[T];(L instanceof Zr||L instanceof ri||L instanceof pn)&&L.populatePaintArray(l,h,p,v,E)}}setConstantPatternPositions(l,h){for(const p in this.binders){const v=this.binders[p];v instanceof ei&&v.setConstantPatternPositions(l,h)}}updatePaintArrays(l,h,p,v,E){let T=!1;for(const L in l){const R=h.getPositions(L);for(const V of R){const W=p.feature(V.index);for(const K in this.binders){const rt=this.binders[K];if((rt instanceof Zr||rt instanceof ri||rt instanceof pn)&&rt.expression.isStateDependent===!0){const lt=v.paint.get(K);rt.expression=lt.value,rt.updatePaintArray(V.start,V.end,W,l[L],E),T=!0}}}}return T}defines(){const l=[];for(const h in this.binders){const p=this.binders[h];(p instanceof Li||p instanceof ei)&&l.push(...p.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return l}getBinderAttributes(){const l=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof Zr||p instanceof ri)for(let v=0;v<p.paintVertexAttributes.length;v++)l.push(p.paintVertexAttributes[v].name);else if(p instanceof pn)for(let v=0;v<le.members.length;v++)l.push(le.members[v].name)}return l}getBinderUniforms(){const l=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof Li||p instanceof ei||p instanceof ri)for(const v of p.uniformNames)l.push(v)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,h){const p=[];for(const v in this.binders){const E=this.binders[v];if(E instanceof Li||E instanceof ei||E instanceof ri){for(const T of E.uniformNames)if(h[T]){const L=E.getBinding(l,h[T],T);p.push({name:T,property:v,binding:L})}}}return p}setUniforms(l,h,p,v){for(const{name:E,property:T,binding:L}of h)this.binders[T].setUniform(L,v,p.get(T),E)}updatePaintBuffers(l){this._buffers=[];for(const h in this.binders){const p=this.binders[h];if(l&&p instanceof pn){const v=l.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(p instanceof Zr||p instanceof ri)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(l){for(const h in this.binders){const p=this.binders[h];(p instanceof Zr||p instanceof ri||p instanceof pn)&&p.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const h=this.binders[l];(h instanceof Zr||h instanceof ri||h instanceof pn)&&h.destroy()}}}class hi{constructor(l,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const v of l)this.programConfigurations[v.id]=new Yr(v,h,p);this.needsUpload=!1,this._featureMap=new br,this._bufferOffset=0}populatePaintArrays(l,h,p,v,E,T){for(const L in this.programConfigurations)this.programConfigurations[L].populatePaintArrays(l,h,v,E,T);h.id!==void 0&&this._featureMap.add(h.id,p,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,h,p,v){for(const E of p)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(l,this._featureMap,h,E,v)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}function jn(u,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${l}-`,"").replace(/-/g,"_")]}function Ui(u,l,h){const p={color:{source:oo,composite:Eh},number:{source:$c,composite:oo}},v=function(E){return{"line-pattern":{source:X,composite:X},"fill-pattern":{source:X,composite:X},"fill-extrusion-pattern":{source:X,composite:X}}[E]}(u);return v&&v[h]||p[l][h]}$e("ConstantBinder",Li),$e("CrossFadedConstantBinder",ei),$e("SourceExpressionBinder",Zr),$e("CrossFadedCompositeBinder",pn),$e("CompositeExpressionBinder",ri),$e("ProgramConfiguration",Yr,{omit:["_buffers"]}),$e("ProgramConfigurationSet",hi);const Ai=8192,Ji=Math.pow(2,14)-1,Ch=-Ji-1;function gl(u){const l=Ai/u.extent,h=u.loadGeometry();for(let p=0;p<h.length;p++){const v=h[p];for(let E=0;E<v.length;E++){const T=v[E],L=Math.round(T.x*l),R=Math.round(T.y*l);T.x=mt(L,Ch,Ji),T.y=mt(R,Ch,Ji),(L<T.x||L>T.x+1||R<T.y||R>T.y+1)&&kt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function ml(u,l){return{type:u.type,id:u.id,properties:u.properties,geometry:l?gl(u):[]}}function nc(u,l,h,p,v){u.emplaceBack(2*l+(p+1)/2,2*h+(v+1)/2)}class ao{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new O,this.indexArray=new St,this.segments=new $t,this.programConfigurations=new hi(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(l,h,p){const v=this.layers[0],E=[];let T=null,L=!1;v.type==="circle"&&(T=v.layout.get("circle-sort-key"),L=!T.isConstant());for(const{feature:R,id:V,index:W,sourceLayerIndex:K}of l){const rt=this.layers[0]._featureFilter.needGeometry,lt=ml(R,rt);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),lt,p))continue;const ut=L?T.evaluate(lt,{},p):void 0,_t={id:V,properties:R.properties,type:R.type,sourceLayerIndex:K,index:W,geometry:rt?lt.geometry:gl(R),patterns:{},sortKey:ut};E.push(_t)}L&&E.sort((R,V)=>R.sortKey-V.sortKey);for(const R of E){const{geometry:V,index:W,sourceLayerIndex:K}=R,rt=l[W].feature;this.addFeature(R,V,W,p),h.featureIndex.insert(rt,V,W,K,this.index)}}update(l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Vt),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,h,p,v){for(const E of h)for(const T of E){const L=T.x,R=T.y;if(L<0||L>=Ai||R<0||R>=Ai)continue;const V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),W=V.vertexLength;nc(this.layoutVertexArray,L,R,-1,-1),nc(this.layoutVertexArray,L,R,1,-1),nc(this.layoutVertexArray,L,R,1,1),nc(this.layoutVertexArray,L,R,-1,1),this.indexArray.emplaceBack(W,W+1,W+2),this.indexArray.emplaceBack(W,W+3,W+2),V.vertexLength+=4,V.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,{},v)}}function Zc(u,l){for(let h=0;h<u.length;h++)if(sc(l,u[h]))return!0;for(let h=0;h<l.length;h++)if(sc(u,l[h]))return!0;return!!Nu(u,l)}function lo(u,l,h){return!!sc(u,l)||!!jf(l,u,h)}function yl(u,l){if(u.length===1)return Uf(l,u[0]);for(let h=0;h<l.length;h++){const p=l[h];for(let v=0;v<p.length;v++)if(sc(u,p[v]))return!0}for(let h=0;h<u.length;h++)if(Uf(l,u[h]))return!0;for(let h=0;h<l.length;h++)if(Nu(u,l[h]))return!0;return!1}function _l(u,l,h){if(u.length>1){if(Nu(u,l))return!0;for(let p=0;p<l.length;p++)if(jf(l[p],u,h))return!0}for(let p=0;p<u.length;p++)if(jf(u[p],l,h))return!0;return!1}function Nu(u,l){if(u.length===0||l.length===0)return!1;for(let h=0;h<u.length-1;h++){const p=u[h],v=u[h+1];for(let E=0;E<l.length-1;E++)if(Jc(p,v,l[E],l[E+1]))return!0}return!1}function Jc(u,l,h,p){return xt(u,h,p)!==xt(l,h,p)&&xt(u,l,h)!==xt(u,l,p)}function jf(u,l,h){const p=h*h;if(l.length===1)return u.distSqr(l[0])<p;for(let v=1;v<l.length;v++)if(zd(u,l[v-1],l[v])<p)return!0;return!1}function zd(u,l,h){const p=l.distSqr(h);if(p===0)return u.distSqr(l);const v=((u.x-l.x)*(h.x-l.x)+(u.y-l.y)*(h.y-l.y))/p;return u.distSqr(v<0?l:v>1?h:h.sub(l)._mult(v)._add(l))}function Uf(u,l){let h,p,v,E=!1;for(let T=0;T<u.length;T++){h=u[T];for(let L=0,R=h.length-1;L<h.length;R=L++)p=h[L],v=h[R],p.y>l.y!=v.y>l.y&&l.x<(v.x-p.x)*(l.y-p.y)/(v.y-p.y)+p.x&&(E=!E)}return E}function sc(u,l){let h=!1;for(let p=0,v=u.length-1;p<u.length;v=p++){const E=u[p],T=u[v];E.y>l.y!=T.y>l.y&&l.x<(T.x-E.x)*(l.y-E.y)/(T.y-E.y)+E.x&&(h=!h)}return h}function jd(u,l,h){const p=h[0],v=h[2];if(u.x<p.x&&l.x<p.x||u.x>v.x&&l.x>v.x||u.y<p.y&&l.y<p.y||u.y>v.y&&l.y>v.y)return!1;const E=xt(u,l,h[0]);return E!==xt(u,l,h[1])||E!==xt(u,l,h[2])||E!==xt(u,l,h[3])}function Ud(u,l,h){const p=l.paint.get(u).value;return p.kind==="constant"?p.value:h.programConfigurations.get(l.id).getMaxValue(u)}function Gf(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Th(u,l,h,p,v){if(!l[0]&&!l[1])return u;const E=A.convert(l)._mult(v);h==="viewport"&&E._rotate(-p);const T=[];for(let L=0;L<u.length;L++)T.push(u[L].sub(E));return T}let oc,G0;$e("CircleBucket",ao,{omit:["layers"]});var bv={get paint(){return G0=G0||new zn({"circle-radius":new pr(Xt.paint_circle["circle-radius"]),"circle-color":new pr(Xt.paint_circle["circle-color"]),"circle-blur":new pr(Xt.paint_circle["circle-blur"]),"circle-opacity":new pr(Xt.paint_circle["circle-opacity"]),"circle-translate":new or(Xt.paint_circle["circle-translate"]),"circle-translate-anchor":new or(Xt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new or(Xt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new or(Xt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pr(Xt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pr(Xt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pr(Xt.paint_circle["circle-stroke-opacity"])})},get layout(){return oc=oc||new zn({"circle-sort-key":new pr(Xt.layout_circle["circle-sort-key"])})}},Ps=1e-6,Fu=typeof Float32Array<"u"?Float32Array:Array;function Ph(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function Cg(u,l,h){var p=l[0],v=l[1],E=l[2],T=l[3],L=l[4],R=l[5],V=l[6],W=l[7],K=l[8],rt=l[9],lt=l[10],ut=l[11],_t=l[12],Pt=l[13],Ot=l[14],Yt=l[15],Ft=h[0],Wt=h[1],_e=h[2],be=h[3];return u[0]=Ft*p+Wt*L+_e*K+be*_t,u[1]=Ft*v+Wt*R+_e*rt+be*Pt,u[2]=Ft*E+Wt*V+_e*lt+be*Ot,u[3]=Ft*T+Wt*W+_e*ut+be*Yt,u[4]=(Ft=h[4])*p+(Wt=h[5])*L+(_e=h[6])*K+(be=h[7])*_t,u[5]=Ft*v+Wt*R+_e*rt+be*Pt,u[6]=Ft*E+Wt*V+_e*lt+be*Ot,u[7]=Ft*T+Wt*W+_e*ut+be*Yt,u[8]=(Ft=h[8])*p+(Wt=h[9])*L+(_e=h[10])*K+(be=h[11])*_t,u[9]=Ft*v+Wt*R+_e*rt+be*Pt,u[10]=Ft*E+Wt*V+_e*lt+be*Ot,u[11]=Ft*T+Wt*W+_e*ut+be*Yt,u[12]=(Ft=h[12])*p+(Wt=h[13])*L+(_e=h[14])*K+(be=h[15])*_t,u[13]=Ft*v+Wt*R+_e*rt+be*Pt,u[14]=Ft*E+Wt*V+_e*lt+be*Ot,u[15]=Ft*T+Wt*W+_e*ut+be*Yt,u}Math.hypot||(Math.hypot=function(){for(var u=0,l=arguments.length;l--;)u+=arguments[l]*arguments[l];return Math.sqrt(u)});var Ih,Vf=Cg;function Mh(u,l,h){var p=l[0],v=l[1],E=l[2],T=l[3];return u[0]=h[0]*p+h[4]*v+h[8]*E+h[12]*T,u[1]=h[1]*p+h[5]*v+h[9]*E+h[13]*T,u[2]=h[2]*p+h[6]*v+h[10]*E+h[14]*T,u[3]=h[3]*p+h[7]*v+h[11]*E+h[15]*T,u}Ih=new Fu(4),Fu!=Float32Array&&(Ih[0]=0,Ih[1]=0,Ih[2]=0,Ih[3]=0);class Gd extends Fo{constructor(l){super(l,bv)}createBucket(l){return new ao(l)}queryRadius(l){const h=l;return Ud("circle-radius",this,h)+Ud("circle-stroke-width",this,h)+Gf(this.paint.get("circle-translate"))}queryIntersectsFeature(l,h,p,v,E,T,L,R){const V=Th(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,L),W=this.paint.get("circle-radius").evaluate(h,p)+this.paint.get("circle-stroke-width").evaluate(h,p),K=this.paint.get("circle-pitch-alignment")==="map",rt=K?V:function(ut,_t){return ut.map(Pt=>Tg(Pt,_t))}(V,R),lt=K?W*L:W;for(const ut of v)for(const _t of ut){const Pt=K?_t:Tg(_t,R);let Ot=lt;const Yt=Mh([],[_t.x,_t.y,0,1],R);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ot*=Yt[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ot*=T.cameraToCenterDistance/Yt[3]),lo(rt,Pt,Ot))return!0}return!1}}function Tg(u,l){const h=Mh([],[u.x,u.y,0,1],l);return new A(h[0]/h[3],h[1]/h[3])}class V0 extends ao{}let Vd;$e("HeatmapBucket",V0,{omit:["layers"]});var q0={get paint(){return Vd=Vd||new zn({"heatmap-radius":new pr(Xt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pr(Xt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new or(Xt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Lu(Xt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new or(Xt.paint_heatmap["heatmap-opacity"])})}};function qd(u,l,h,p){let{width:v,height:E}=l;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==v*E*h)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${v*E*h}`)}else p=new Uint8Array(v*E*h);return u.width=v,u.height=E,u.data=p,u}function ac(u,l,h){let{width:p,height:v}=l;if(p===u.width&&v===u.height)return;const E=qd({},{width:p,height:v},h);qf(u,E,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,p),height:Math.min(u.height,v)},h),u.width=p,u.height=v,u.data=E.data}function qf(u,l,h,p,v,E){if(v.width===0||v.height===0)return l;if(v.width>u.width||v.height>u.height||h.x>u.width-v.width||h.y>u.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>l.width||v.height>l.height||p.x>l.width-v.width||p.y>l.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const T=u.data,L=l.data;if(T===L)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<v.height;R++){const V=((h.y+R)*u.width+h.x)*E,W=((p.y+R)*l.width+p.x)*E;for(let K=0;K<v.width*E;K++)L[W+K]=T[V+K]}return l}class Lh{constructor(l,h){qd(this,l,1,h)}resize(l){ac(this,l,1)}clone(){return new Lh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,h,p,v,E){qf(l,h,p,v,E,1)}}class Uo{constructor(l,h){qd(this,l,4,h)}resize(l){ac(this,l,4)}replace(l,h){h?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new Uo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,h,p,v,E){qf(l,h,p,v,E,4)}}function Pg(u){const l={},h=u.resolution||256,p=u.clips?u.clips.length:1,v=u.image||new Uo({width:h,height:p});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const E=(T,L,R)=>{l[u.evaluationKey]=R;const V=u.expression.evaluate(l);v.data[T+L+0]=Math.floor(255*V.r/V.a),v.data[T+L+1]=Math.floor(255*V.g/V.a),v.data[T+L+2]=Math.floor(255*V.b/V.a),v.data[T+L+3]=Math.floor(255*V.a)};if(u.clips)for(let T=0,L=0;T<p;++T,L+=4*h)for(let R=0,V=0;R<h;R++,V+=4){const W=R/(h-1),{start:K,end:rt}=u.clips[T];E(L,V,K*(1-W)+rt*W)}else for(let T=0,L=0;T<h;T++,L+=4)E(0,L,T/(h-1));return v}$e("AlphaImage",Lh),$e("RGBAImage",Uo);class Bh extends Fo{createBucket(l){return new V0(l)}constructor(l){super(l,q0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Pg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let H0;var W0={get paint(){return H0=H0||new zn({"hillshade-illumination-direction":new or(Xt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new or(Xt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new or(Xt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new or(Xt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new or(Xt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new or(Xt.paint_hillshade["hillshade-accent-color"])})}};class wv extends Fo{constructor(l){super(l,W0)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const $0=fn([{name:"a_pos",components:2,type:"Int16"}],4),{members:xv}=$0;var zu={exports:{}};function kh(u,l,h){h=h||2;var p,v,E,T,L,R,V,W=l&&l.length,K=W?l[0]*h:u.length,rt=Hd(u,0,K,h,!0),lt=[];if(!rt||rt.next===rt.prev)return lt;if(W&&(rt=function(_t,Pt,Ot,Yt){var Ft,Wt,_e,be=[];for(Ft=0,Wt=Pt.length;Ft<Wt;Ft++)(_e=Hd(_t,Pt[Ft]*Yt,Ft<Wt-1?Pt[Ft+1]*Yt:_t.length,Yt,!1))===_e.next&&(_e.steiner=!0),be.push(AR(_e));for(be.sort(Av),Ft=0;Ft<be.length;Ft++)Ot=Mg(be[Ft],Ot);return Ot}(u,l,rt,h)),u.length>80*h){p=E=u[0],v=T=u[1];for(var ut=h;ut<K;ut+=h)(L=u[ut])<p&&(p=L),(R=u[ut+1])<v&&(v=R),L>E&&(E=L),R>T&&(T=R);V=(V=Math.max(E-p,T-v))!==0?32767/V:0}return ua(rt,lt,h,p,v,V,0),lt}function Hd(u,l,h,p,v){var E,T;if(v===Cv(u,l,h,p)>0)for(E=l;E<h;E+=p)T=CS(E,u[E],u[E+1],T);else for(E=h-p;E>=l;E-=p)T=CS(E,u[E],u[E+1],T);return T&&J0(T,T.next)&&(kg(T),T=T.next),T}function Hs(u,l){if(!u)return u;l||(l=u);var h,p=u;do if(h=!1,p.steiner||!J0(p,p.next)&&Mn(p.prev,p,p.next)!==0)p=p.next;else{if(kg(p),(p=l=p.prev)===p.next)break;h=!0}while(h||p!==l);return l}function ua(u,l,h,p,v,E,T){if(u){!T&&E&&function(W,K,rt,lt){var ut=W;do ut.z===0&&(ut.z=Sv(ut.x,ut.y,K,rt,lt)),ut.prevZ=ut.prev,ut.nextZ=ut.next,ut=ut.next;while(ut!==W);ut.prevZ.nextZ=null,ut.prevZ=null,function(_t){var Pt,Ot,Yt,Ft,Wt,_e,be,We,nr=1;do{for(Ot=_t,_t=null,Wt=null,_e=0;Ot;){for(_e++,Yt=Ot,be=0,Pt=0;Pt<nr&&(be++,Yt=Yt.nextZ);Pt++);for(We=nr;be>0||We>0&&Yt;)be!==0&&(We===0||!Yt||Ot.z<=Yt.z)?(Ft=Ot,Ot=Ot.nextZ,be--):(Ft=Yt,Yt=Yt.nextZ,We--),Wt?Wt.nextZ=Ft:_t=Ft,Ft.prevZ=Wt,Wt=Ft;Ot=Yt}Wt.nextZ=null,nr*=2}while(_e>1)}(ut)}(u,p,v,E);for(var L,R,V=u;u.prev!==u.next;)if(L=u.prev,R=u.next,E?Hf(u,p,v,E):Xc(u))l.push(L.i/h|0),l.push(u.i/h|0),l.push(R.i/h|0),kg(u),u=R.next,V=R.next;else if((u=R)===V){T?T===1?ua(u=Ig(Hs(u),l,h),l,h,p,v,E,2):T===2&&Z0(u,l,h,p,v,E):ua(Hs(u),l,h,p,v,E,1);break}}}function Xc(u){var l=u.prev,h=u,p=u.next;if(Mn(l,h,p)>=0)return!1;for(var v=l.x,E=h.x,T=p.x,L=l.y,R=h.y,V=p.y,W=v<E?v<T?v:T:E<T?E:T,K=L<R?L<V?L:V:R<V?R:V,rt=v>E?v>T?v:T:E>T?E:T,lt=L>R?L>V?L:V:R>V?R:V,ut=p.next;ut!==l;){if(ut.x>=W&&ut.x<=rt&&ut.y>=K&&ut.y<=lt&&Wf(v,L,E,R,T,V,ut.x,ut.y)&&Mn(ut.prev,ut,ut.next)>=0)return!1;ut=ut.next}return!0}function Hf(u,l,h,p){var v=u.prev,E=u,T=u.next;if(Mn(v,E,T)>=0)return!1;for(var L=v.x,R=E.x,V=T.x,W=v.y,K=E.y,rt=T.y,lt=L<R?L<V?L:V:R<V?R:V,ut=W<K?W<rt?W:rt:K<rt?K:rt,_t=L>R?L>V?L:V:R>V?R:V,Pt=W>K?W>rt?W:rt:K>rt?K:rt,Ot=Sv(lt,ut,l,h,p),Yt=Sv(_t,Pt,l,h,p),Ft=u.prevZ,Wt=u.nextZ;Ft&&Ft.z>=Ot&&Wt&&Wt.z<=Yt;){if(Ft.x>=lt&&Ft.x<=_t&&Ft.y>=ut&&Ft.y<=Pt&&Ft!==v&&Ft!==T&&Wf(L,W,R,K,V,rt,Ft.x,Ft.y)&&Mn(Ft.prev,Ft,Ft.next)>=0||(Ft=Ft.prevZ,Wt.x>=lt&&Wt.x<=_t&&Wt.y>=ut&&Wt.y<=Pt&&Wt!==v&&Wt!==T&&Wf(L,W,R,K,V,rt,Wt.x,Wt.y)&&Mn(Wt.prev,Wt,Wt.next)>=0))return!1;Wt=Wt.nextZ}for(;Ft&&Ft.z>=Ot;){if(Ft.x>=lt&&Ft.x<=_t&&Ft.y>=ut&&Ft.y<=Pt&&Ft!==v&&Ft!==T&&Wf(L,W,R,K,V,rt,Ft.x,Ft.y)&&Mn(Ft.prev,Ft,Ft.next)>=0)return!1;Ft=Ft.prevZ}for(;Wt&&Wt.z<=Yt;){if(Wt.x>=lt&&Wt.x<=_t&&Wt.y>=ut&&Wt.y<=Pt&&Wt!==v&&Wt!==T&&Wf(L,W,R,K,V,rt,Wt.x,Wt.y)&&Mn(Wt.prev,Wt,Wt.next)>=0)return!1;Wt=Wt.nextZ}return!0}function Ig(u,l,h){var p=u;do{var v=p.prev,E=p.next.next;!J0(v,E)&&SS(v,p,p.next,E)&&Bg(v,E)&&Bg(E,v)&&(l.push(v.i/h|0),l.push(p.i/h|0),l.push(E.i/h|0),kg(p),kg(p.next),p=u=E),p=p.next}while(p!==u);return Hs(p)}function Z0(u,l,h,p,v,E){var T=u;do{for(var L=T.next.next;L!==T.prev;){if(T.i!==L.i&&SR(T,L)){var R=ES(T,L);return T=Hs(T,T.next),R=Hs(R,R.next),ua(T,l,h,p,v,E,0),void ua(R,l,h,p,v,E,0)}L=L.next}T=T.next}while(T!==u)}function Av(u,l){return u.x-l.x}function Mg(u,l){var h=function(v,E){var T,L=E,R=v.x,V=v.y,W=-1/0;do{if(V<=L.y&&V>=L.next.y&&L.next.y!==L.y){var K=L.x+(V-L.y)*(L.next.x-L.x)/(L.next.y-L.y);if(K<=R&&K>W&&(W=K,T=L.x<L.next.x?L:L.next,K===R))return T}L=L.next}while(L!==E);if(!T)return null;var rt,lt=T,ut=T.x,_t=T.y,Pt=1/0;L=T;do R>=L.x&&L.x>=ut&&R!==L.x&&Wf(V<_t?R:W,V,ut,_t,V<_t?W:R,V,L.x,L.y)&&(rt=Math.abs(V-L.y)/(R-L.x),Bg(L,v)&&(rt<Pt||rt===Pt&&(L.x>T.x||L.x===T.x&&Lg(T,L)))&&(T=L,Pt=rt)),L=L.next;while(L!==lt);return T}(u,l);if(!h)return l;var p=ES(h,u);return Hs(p,p.next),Hs(h,h.next)}function Lg(u,l){return Mn(u.prev,u,l.prev)<0&&Mn(l.next,u,u.next)<0}function Sv(u,l,h,p,v){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-h)*v|0)|u<<8))|u<<4))|u<<2))|u<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-p)*v|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function AR(u){var l=u,h=u;do(l.x<h.x||l.x===h.x&&l.y<h.y)&&(h=l),l=l.next;while(l!==u);return h}function Wf(u,l,h,p,v,E,T,L){return(v-T)*(l-L)>=(u-T)*(E-L)&&(u-T)*(p-L)>=(h-T)*(l-L)&&(h-T)*(E-L)>=(v-T)*(p-L)}function SR(u,l){return u.next.i!==l.i&&u.prev.i!==l.i&&!function(h,p){var v=h;do{if(v.i!==h.i&&v.next.i!==h.i&&v.i!==p.i&&v.next.i!==p.i&&SS(v,v.next,h,p))return!0;v=v.next}while(v!==h);return!1}(u,l)&&(Bg(u,l)&&Bg(l,u)&&function(h,p){var v=h,E=!1,T=(h.x+p.x)/2,L=(h.y+p.y)/2;do v.y>L!=v.next.y>L&&v.next.y!==v.y&&T<(v.next.x-v.x)*(L-v.y)/(v.next.y-v.y)+v.x&&(E=!E),v=v.next;while(v!==h);return E}(u,l)&&(Mn(u.prev,u,l.prev)||Mn(u,l.prev,l))||J0(u,l)&&Mn(u.prev,u,u.next)>0&&Mn(l.prev,l,l.next)>0)}function Mn(u,l,h){return(l.y-u.y)*(h.x-l.x)-(l.x-u.x)*(h.y-l.y)}function J0(u,l){return u.x===l.x&&u.y===l.y}function SS(u,l,h,p){var v=K0(Mn(u,l,h)),E=K0(Mn(u,l,p)),T=K0(Mn(h,p,u)),L=K0(Mn(h,p,l));return v!==E&&T!==L||!(v!==0||!X0(u,h,l))||!(E!==0||!X0(u,p,l))||!(T!==0||!X0(h,u,p))||!(L!==0||!X0(h,l,p))}function X0(u,l,h){return l.x<=Math.max(u.x,h.x)&&l.x>=Math.min(u.x,h.x)&&l.y<=Math.max(u.y,h.y)&&l.y>=Math.min(u.y,h.y)}function K0(u){return u>0?1:u<0?-1:0}function Bg(u,l){return Mn(u.prev,u,u.next)<0?Mn(u,l,u.next)>=0&&Mn(u,u.prev,l)>=0:Mn(u,l,u.prev)<0||Mn(u,u.next,l)<0}function ES(u,l){var h=new Ev(u.i,u.x,u.y),p=new Ev(l.i,l.x,l.y),v=u.next,E=l.prev;return u.next=l,l.prev=u,h.next=v,v.prev=h,p.next=h,h.prev=p,E.next=p,p.prev=E,p}function CS(u,l,h,p){var v=new Ev(u,l,h);return p?(v.next=p.next,v.prev=p,p.next.prev=v,p.next=v):(v.prev=v,v.next=v),v}function kg(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function Ev(u,l,h){this.i=u,this.x=l,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Cv(u,l,h,p){for(var v=0,E=l,T=h-p;E<h;E+=p)v+=(u[T]-u[E])*(u[E+1]+u[T+1]),T=E;return v}zu.exports=kh,zu.exports.default=kh,kh.deviation=function(u,l,h,p){var v=l&&l.length,E=Math.abs(Cv(u,0,v?l[0]*h:u.length,h));if(v)for(var T=0,L=l.length;T<L;T++)E-=Math.abs(Cv(u,l[T]*h,T<L-1?l[T+1]*h:u.length,h));var R=0;for(T=0;T<p.length;T+=3){var V=p[T]*h,W=p[T+1]*h,K=p[T+2]*h;R+=Math.abs((u[V]-u[K])*(u[W+1]-u[V+1])-(u[V]-u[W])*(u[K+1]-u[V+1]))}return E===0&&R===0?0:Math.abs((R-E)/E)},kh.flatten=function(u){for(var l=u[0][0].length,h={vertices:[],holes:[],dimensions:l},p=0,v=0;v<u.length;v++){for(var E=0;E<u[v].length;E++)for(var T=0;T<l;T++)h.vertices.push(u[v][E][T]);v>0&&h.holes.push(p+=u[v-1].length)}return h};var TS=f(zu.exports);function ER(u,l,h,p,v){PS(u,l,h||0,p||u.length-1,v||CR)}function PS(u,l,h,p,v){for(;p>h;){if(p-h>600){var E=p-h+1,T=l-h+1,L=Math.log(E),R=.5*Math.exp(2*L/3),V=.5*Math.sqrt(L*R*(E-R)/E)*(T-E/2<0?-1:1);PS(u,l,Math.max(h,Math.floor(l-T*R/E+V)),Math.min(p,Math.floor(l+(E-T)*R/E+V)),v)}var W=u[l],K=h,rt=p;for(Rg(u,h,l),v(u[p],W)>0&&Rg(u,h,p);K<rt;){for(Rg(u,K,rt),K++,rt--;v(u[K],W)<0;)K++;for(;v(u[rt],W)>0;)rt--}v(u[h],W)===0?Rg(u,h,rt):Rg(u,++rt,p),rt<=l&&(h=rt+1),l<=rt&&(p=rt-1)}}function Rg(u,l,h){var p=u[l];u[l]=u[h],u[h]=p}function CR(u,l){return u<l?-1:u>l?1:0}function Tv(u,l){const h=u.length;if(h<=1)return[u];const p=[];let v,E;for(let T=0;T<h;T++){const L=ue(u[T]);L!==0&&(u[T].area=Math.abs(L),E===void 0&&(E=L<0),E===L<0?(v&&p.push(v),v=[u[T]]):v.push(u[T]))}if(v&&p.push(v),l>1)for(let T=0;T<p.length;T++)p[T].length<=l||(ER(p[T],l,1,p[T].length-1,TR),p[T]=p[T].slice(0,l));return p}function TR(u,l){return l.area-u.area}function Pv(u,l,h){const p=h.patternDependencies;let v=!1;for(const E of l){const T=E.paint.get(`${u}-pattern`);T.isConstant()||(v=!0);const L=T.constantOr(null);L&&(v=!0,p[L.to]=!0,p[L.from]=!0)}return v}function Iv(u,l,h,p,v){const E=v.patternDependencies;for(const T of l){const L=T.paint.get(`${u}-pattern`).value;if(L.kind!=="constant"){let R=L.evaluate({zoom:p-1},h,{},v.availableImages),V=L.evaluate({zoom:p},h,{},v.availableImages),W=L.evaluate({zoom:p+1},h,{},v.availableImages);R=R&&R.name?R.name:R,V=V&&V.name?V.name:V,W=W&&W.name?W.name:W,E[R]=!0,E[V]=!0,E[W]=!0,h.patterns[T.id]={min:R,mid:V,max:W}}}return h}class Mv{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new j,this.indexArray=new St,this.indexArray2=new gt,this.programConfigurations=new hi(l.layers,l.zoom),this.segments=new $t,this.segments2=new $t,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(l,h,p){this.hasPattern=Pv("fill",this.layers,h);const v=this.layers[0].layout.get("fill-sort-key"),E=!v.isConstant(),T=[];for(const{feature:L,id:R,index:V,sourceLayerIndex:W}of l){const K=this.layers[0]._featureFilter.needGeometry,rt=ml(L,K);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),rt,p))continue;const lt=E?v.evaluate(rt,{},p,h.availableImages):void 0,ut={id:R,properties:L.properties,type:L.type,sourceLayerIndex:W,index:V,geometry:K?rt.geometry:gl(L),patterns:{},sortKey:lt};T.push(ut)}E&&T.sort((L,R)=>L.sortKey-R.sortKey);for(const L of T){const{geometry:R,index:V,sourceLayerIndex:W}=L;if(this.hasPattern){const K=Iv("fill",this.layers,L,this.zoom,h);this.patternFeatures.push(K)}else this.addFeature(L,R,V,p,{});h.featureIndex.insert(l[V].feature,R,V,W,this.index)}}update(l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,p)}addFeatures(l,h,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,xv),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,h,p,v,E){for(const T of Tv(h,500)){let L=0;for(const lt of T)L+=lt.length;const R=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),V=R.vertexLength,W=[],K=[];for(const lt of T){if(lt.length===0)continue;lt!==T[0]&&K.push(W.length/2);const ut=this.segments2.prepareSegment(lt.length,this.layoutVertexArray,this.indexArray2),_t=ut.vertexLength;this.layoutVertexArray.emplaceBack(lt[0].x,lt[0].y),this.indexArray2.emplaceBack(_t+lt.length-1,_t),W.push(lt[0].x),W.push(lt[0].y);for(let Pt=1;Pt<lt.length;Pt++)this.layoutVertexArray.emplaceBack(lt[Pt].x,lt[Pt].y),this.indexArray2.emplaceBack(_t+Pt-1,_t+Pt),W.push(lt[Pt].x),W.push(lt[Pt].y);ut.vertexLength+=lt.length,ut.primitiveLength+=lt.length}const rt=TS(W,K);for(let lt=0;lt<rt.length;lt+=3)this.indexArray.emplaceBack(V+rt[lt],V+rt[lt+1],V+rt[lt+2]);R.vertexLength+=L,R.primitiveLength+=rt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,E,v)}}let IS,MS;$e("FillBucket",Mv,{omit:["layers","patternFeatures"]});var PR={get paint(){return MS=MS||new zn({"fill-antialias":new or(Xt.paint_fill["fill-antialias"]),"fill-opacity":new pr(Xt.paint_fill["fill-opacity"]),"fill-color":new pr(Xt.paint_fill["fill-color"]),"fill-outline-color":new pr(Xt.paint_fill["fill-outline-color"]),"fill-translate":new or(Xt.paint_fill["fill-translate"]),"fill-translate-anchor":new or(Xt.paint_fill["fill-translate-anchor"]),"fill-pattern":new xh(Xt.paint_fill["fill-pattern"])})},get layout(){return IS=IS||new zn({"fill-sort-key":new pr(Xt.layout_fill["fill-sort-key"])})}};class IR extends Fo{constructor(l){super(l,PR)}recalculate(l,h){super.recalculate(l,h);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new Mv(l)}queryRadius(){return Gf(this.paint.get("fill-translate"))}queryIntersectsFeature(l,h,p,v,E,T,L){return yl(Th(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,L),v)}isTileClipped(){return!0}}const MR=fn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),LR=fn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:BR}=MR;var Rh={},kR=m,LS=$f;function $f(u,l,h,p,v){this.properties={},this.extent=h,this.type=0,this._pbf=u,this._geometry=-1,this._keys=p,this._values=v,u.readFields(RR,this,l)}function RR(u,l,h){u==1?l.id=h.readVarint():u==2?function(p,v){for(var E=p.readVarint()+p.pos;p.pos<E;){var T=v._keys[p.readVarint()],L=v._values[p.readVarint()];v.properties[T]=L}}(h,l):u==3?l.type=h.readVarint():u==4&&(l._geometry=h.pos)}function OR(u){for(var l,h,p=0,v=0,E=u.length,T=E-1;v<E;T=v++)p+=((h=u[T]).x-(l=u[v]).x)*(l.y+h.y);return p}$f.types=["Unknown","Point","LineString","Polygon"],$f.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var l,h=u.readVarint()+u.pos,p=1,v=0,E=0,T=0,L=[];u.pos<h;){if(v<=0){var R=u.readVarint();p=7&R,v=R>>3}if(v--,p===1||p===2)E+=u.readSVarint(),T+=u.readSVarint(),p===1&&(l&&L.push(l),l=[]),l.push(new kR(E,T));else{if(p!==7)throw new Error("unknown command "+p);l&&l.push(l[0].clone())}}return l&&L.push(l),L},$f.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var l=u.readVarint()+u.pos,h=1,p=0,v=0,E=0,T=1/0,L=-1/0,R=1/0,V=-1/0;u.pos<l;){if(p<=0){var W=u.readVarint();h=7&W,p=W>>3}if(p--,h===1||h===2)(v+=u.readSVarint())<T&&(T=v),v>L&&(L=v),(E+=u.readSVarint())<R&&(R=E),E>V&&(V=E);else if(h!==7)throw new Error("unknown command "+h)}return[T,R,L,V]},$f.prototype.toGeoJSON=function(u,l,h){var p,v,E=this.extent*Math.pow(2,h),T=this.extent*u,L=this.extent*l,R=this.loadGeometry(),V=$f.types[this.type];function W(lt){for(var ut=0;ut<lt.length;ut++){var _t=lt[ut];lt[ut]=[360*(_t.x+T)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(_t.y+L)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(p=0;p<R.length;p++)K[p]=R[p][0];W(R=K);break;case 2:for(p=0;p<R.length;p++)W(R[p]);break;case 3:for(R=function(lt){var ut=lt.length;if(ut<=1)return[lt];for(var _t,Pt,Ot=[],Yt=0;Yt<ut;Yt++){var Ft=OR(lt[Yt]);Ft!==0&&(Pt===void 0&&(Pt=Ft<0),Pt===Ft<0?(_t&&Ot.push(_t),_t=[lt[Yt]]):_t.push(lt[Yt]))}return _t&&Ot.push(_t),Ot}(R),p=0;p<R.length;p++)for(v=0;v<R[p].length;v++)W(R[p][v])}R.length===1?R=R[0]:V="Multi"+V;var rt={type:"Feature",geometry:{type:V,coordinates:R},properties:this.properties};return"id"in this&&(rt.id=this.id),rt};var DR=LS,BS=kS;function kS(u,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(NR,this,l),this.length=this._features.length}function NR(u,l,h){u===15?l.version=h.readVarint():u===1?l.name=h.readString():u===5?l.extent=h.readVarint():u===2?l._features.push(h.pos):u===3?l._keys.push(h.readString()):u===4&&l._values.push(function(p){for(var v=null,E=p.readVarint()+p.pos;p.pos<E;){var T=p.readVarint()>>3;v=T===1?p.readString():T===2?p.readFloat():T===3?p.readDouble():T===4?p.readVarint64():T===5?p.readVarint():T===6?p.readSVarint():T===7?p.readBoolean():null}return v}(h))}kS.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var l=this._pbf.readVarint()+this._pbf.pos;return new DR(this._pbf,l,this.extent,this._keys,this._values)};var FR=BS;function zR(u,l,h){if(u===3){var p=new FR(h,h.readVarint()+h.pos);p.length&&(l[p.name]=p)}}Rh.VectorTile=function(u,l){this.layers=u.readFields(zR,{},l)},Rh.VectorTileFeature=LS,Rh.VectorTileLayer=BS;const jR=Rh.VectorTileFeature.types,Lv=Math.pow(2,13);function Og(u,l,h,p,v,E,T,L){u.emplaceBack(l,h,2*Math.floor(p*Lv)+T,v*Lv*2,E*Lv*2,Math.round(L))}class Bv{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new G,this.centroidVertexArray=new M,this.indexArray=new St,this.programConfigurations=new hi(l.layers,l.zoom),this.segments=new $t,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(l,h,p){this.features=[],this.hasPattern=Pv("fill-extrusion",this.layers,h);for(const{feature:v,id:E,index:T,sourceLayerIndex:L}of l){const R=this.layers[0]._featureFilter.needGeometry,V=ml(v,R);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),V,p))continue;const W={id:E,sourceLayerIndex:L,index:T,geometry:R?V.geometry:gl(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(Iv("fill-extrusion",this.layers,W,this.zoom,h)):this.addFeature(W,W.geometry,T,p,{}),h.featureIndex.insert(v,W.geometry,T,L,this.index,!0)}}addFeatures(l,h,p){for(const v of this.features){const{geometry:E}=v;this.addFeature(v,E,v.index,h,p)}}update(l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,BR),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,LR.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,h,p,v,E){const T={x:0,y:0,vertexCount:0};for(const L of Tv(h,500)){let R=0;for(const ut of L)R+=ut.length;let V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ut of L){if(ut.length===0||GR(ut))continue;let _t=0;for(let Pt=0;Pt<ut.length;Pt++){const Ot=ut[Pt];if(Pt>=1){const Yt=ut[Pt-1];if(!UR(Ot,Yt)){V.vertexLength+4>$t.MAX_VERTEX_ARRAY_LENGTH&&(V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ft=Ot.sub(Yt)._perp()._unit(),Wt=Yt.dist(Ot);_t+Wt>32768&&(_t=0),Og(this.layoutVertexArray,Ot.x,Ot.y,Ft.x,Ft.y,0,0,_t),Og(this.layoutVertexArray,Ot.x,Ot.y,Ft.x,Ft.y,0,1,_t),T.x+=2*Ot.x,T.y+=2*Ot.y,T.vertexCount+=2,_t+=Wt,Og(this.layoutVertexArray,Yt.x,Yt.y,Ft.x,Ft.y,0,0,_t),Og(this.layoutVertexArray,Yt.x,Yt.y,Ft.x,Ft.y,0,1,_t),T.x+=2*Yt.x,T.y+=2*Yt.y,T.vertexCount+=2;const _e=V.vertexLength;this.indexArray.emplaceBack(_e,_e+2,_e+1),this.indexArray.emplaceBack(_e+1,_e+2,_e+3),V.vertexLength+=4,V.primitiveLength+=2}}}}if(V.vertexLength+R>$t.MAX_VERTEX_ARRAY_LENGTH&&(V=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray)),jR[l.type]!=="Polygon")continue;const W=[],K=[],rt=V.vertexLength;for(const ut of L)if(ut.length!==0){ut!==L[0]&&K.push(W.length/2);for(let _t=0;_t<ut.length;_t++){const Pt=ut[_t];Og(this.layoutVertexArray,Pt.x,Pt.y,0,0,1,1,0),T.x+=Pt.x,T.y+=Pt.y,T.vertexCount+=1,W.push(Pt.x),W.push(Pt.y)}}const lt=TS(W,K);for(let ut=0;ut<lt.length;ut+=3)this.indexArray.emplaceBack(rt+lt[ut],rt+lt[ut+2],rt+lt[ut+1]);V.primitiveLength+=lt.length/3,V.vertexLength+=R}for(let L=0;L<T.vertexCount;L++)this.centroidVertexArray.emplaceBack(Math.floor(T.x/T.vertexCount),Math.floor(T.y/T.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,E,v)}}function UR(u,l){return u.x===l.x&&(u.x<0||u.x>Ai)||u.y===l.y&&(u.y<0||u.y>Ai)}function GR(u){return u.every(l=>l.x<0)||u.every(l=>l.x>Ai)||u.every(l=>l.y<0)||u.every(l=>l.y>Ai)}let RS;$e("FillExtrusionBucket",Bv,{omit:["layers","features"]});var VR={get paint(){return RS=RS||new zn({"fill-extrusion-opacity":new or(Xt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pr(Xt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new or(Xt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new or(Xt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new xh(Xt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pr(Xt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pr(Xt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new or(Xt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class qR extends Fo{constructor(l){super(l,VR)}createBucket(l){return new Bv(l)}queryRadius(){return Gf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(l,h,p,v,E,T,L,R){const V=Th(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,L),W=this.paint.get("fill-extrusion-height").evaluate(h,p),K=this.paint.get("fill-extrusion-base").evaluate(h,p),rt=function(ut,_t,Pt,Ot){const Yt=[];for(const Ft of ut){const Wt=[Ft.x,Ft.y,0,1];Mh(Wt,Wt,_t),Yt.push(new A(Wt[0]/Wt[3],Wt[1]/Wt[3]))}return Yt}(V,R),lt=function(ut,_t,Pt,Ot){const Yt=[],Ft=[],Wt=Ot[8]*_t,_e=Ot[9]*_t,be=Ot[10]*_t,We=Ot[11]*_t,nr=Ot[8]*Pt,Ge=Ot[9]*Pt,je=Ot[10]*Pt,ke=Ot[11]*Pt;for(const Qe of ut){const De=[],Te=[];for(const _r of Qe){const ar=_r.x,qr=_r.y,Xi=Ot[0]*ar+Ot[4]*qr+Ot[12],rn=Ot[1]*ar+Ot[5]*qr+Ot[13],Qn=Ot[2]*ar+Ot[6]*qr+Ot[14],ha=Ot[3]*ar+Ot[7]*qr+Ot[15],co=Qn+be,Un=ha+We,ms=Xi+nr,Ms=rn+Ge,uo=Qn+je,ho=ha+ke,ts=new A((Xi+Wt)/Un,(rn+_e)/Un);ts.z=co/Un,De.push(ts);const es=new A(ms/ho,Ms/ho);es.z=uo/ho,Te.push(es)}Yt.push(De),Ft.push(Te)}return[Yt,Ft]}(v,K,W,R);return function(ut,_t,Pt){let Ot=1/0;yl(Pt,_t)&&(Ot=OS(Pt,_t[0]));for(let Yt=0;Yt<_t.length;Yt++){const Ft=_t[Yt],Wt=ut[Yt];for(let _e=0;_e<Ft.length-1;_e++){const be=Ft[_e],We=[be,Ft[_e+1],Wt[_e+1],Wt[_e],be];Zc(Pt,We)&&(Ot=Math.min(Ot,OS(Pt,We)))}}return Ot!==1/0&&Ot}(lt[0],lt[1],rt)}}function Dg(u,l){return u.x*l.x+u.y*l.y}function OS(u,l){if(u.length===1){let h=0;const p=l[h++];let v;for(;!v||p.equals(v);)if(v=l[h++],!v)return 1/0;for(;h<l.length;h++){const E=l[h],T=u[0],L=v.sub(p),R=E.sub(p),V=T.sub(p),W=Dg(L,L),K=Dg(L,R),rt=Dg(R,R),lt=Dg(V,L),ut=Dg(V,R),_t=W*rt-K*K,Pt=(rt*lt-K*ut)/_t,Ot=(W*ut-K*lt)/_t,Yt=p.z*(1-Pt-Ot)+v.z*Pt+E.z*Ot;if(isFinite(Yt))return Yt}return 1/0}{let h=1/0;for(const p of l)h=Math.min(h,p.z);return h}}const HR=fn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:WR}=HR,$R=fn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:ZR}=$R,JR=Rh.VectorTileFeature.types,XR=Math.cos(Math.PI/180*37.5),DS=Math.pow(2,14)/.5;class kv{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new H,this.layoutVertexArray2=new q,this.indexArray=new St,this.programConfigurations=new hi(l.layers,l.zoom),this.segments=new $t,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(l,h,p){this.hasPattern=Pv("line",this.layers,h);const v=this.layers[0].layout.get("line-sort-key"),E=!v.isConstant(),T=[];for(const{feature:L,id:R,index:V,sourceLayerIndex:W}of l){const K=this.layers[0]._featureFilter.needGeometry,rt=ml(L,K);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),rt,p))continue;const lt=E?v.evaluate(rt,{},p):void 0,ut={id:R,properties:L.properties,type:L.type,sourceLayerIndex:W,index:V,geometry:K?rt.geometry:gl(L),patterns:{},sortKey:lt};T.push(ut)}E&&T.sort((L,R)=>L.sortKey-R.sortKey);for(const L of T){const{geometry:R,index:V,sourceLayerIndex:W}=L;if(this.hasPattern){const K=Iv("line",this.layers,L,this.zoom,h);this.patternFeatures.push(K)}else this.addFeature(L,R,V,p,{});h.featureIndex.insert(l[V].feature,R,V,W,this.index)}}update(l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,p)}addFeatures(l,h,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,ZR)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,WR),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,h,p,v,E){const T=this.layers[0].layout,L=T.get("line-join").evaluate(l,{}),R=T.get("line-cap"),V=T.get("line-miter-limit"),W=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const K of h)this.addLine(K,l,L,R,V,W);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,E,v)}addLine(l,h,p,v,E,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ot=0;Ot<l.length-1;Ot++)this.totalDistance+=l[Ot].dist(l[Ot+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const L=JR[h.type]==="Polygon";let R=l.length;for(;R>=2&&l[R-1].equals(l[R-2]);)R--;let V=0;for(;V<R-1&&l[V].equals(l[V+1]);)V++;if(R<(L?3:2))return;p==="bevel"&&(E=1.05);const W=this.overscaling<=16?15*Ai/(512*this.overscaling):0,K=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let rt,lt,ut,_t,Pt;this.e1=this.e2=-1,L&&(rt=l[R-2],Pt=l[V].sub(rt)._unit()._perp());for(let Ot=V;Ot<R;Ot++){if(ut=Ot===R-1?L?l[V+1]:void 0:l[Ot+1],ut&&l[Ot].equals(ut))continue;Pt&&(_t=Pt),rt&&(lt=rt),rt=l[Ot],Pt=ut?ut.sub(rt)._unit()._perp():_t,_t=_t||Pt;let Yt=_t.add(Pt);Yt.x===0&&Yt.y===0||Yt._unit();const Ft=_t.x*Pt.x+_t.y*Pt.y,Wt=Yt.x*Pt.x+Yt.y*Pt.y,_e=Wt!==0?1/Wt:1/0,be=2*Math.sqrt(2-2*Wt),We=Wt<XR&&lt&&ut,nr=_t.x*Pt.y-_t.y*Pt.x>0;if(We&&Ot>V){const ke=rt.dist(lt);if(ke>2*W){const Qe=rt.sub(rt.sub(lt)._mult(W/ke)._round());this.updateDistance(lt,Qe),this.addCurrentVertex(Qe,_t,0,0,K),lt=Qe}}const Ge=lt&&ut;let je=Ge?p:L?"butt":v;if(Ge&&je==="round"&&(_e<T?je="miter":_e<=2&&(je="fakeround")),je==="miter"&&_e>E&&(je="bevel"),je==="bevel"&&(_e>2&&(je="flipbevel"),_e<E&&(je="miter")),lt&&this.updateDistance(lt,rt),je==="miter")Yt._mult(_e),this.addCurrentVertex(rt,Yt,0,0,K);else if(je==="flipbevel"){if(_e>100)Yt=Pt.mult(-1);else{const ke=_e*_t.add(Pt).mag()/_t.sub(Pt).mag();Yt._perp()._mult(ke*(nr?-1:1))}this.addCurrentVertex(rt,Yt,0,0,K),this.addCurrentVertex(rt,Yt.mult(-1),0,0,K)}else if(je==="bevel"||je==="fakeround"){const ke=-Math.sqrt(_e*_e-1),Qe=nr?ke:0,De=nr?0:ke;if(lt&&this.addCurrentVertex(rt,_t,Qe,De,K),je==="fakeround"){const Te=Math.round(180*be/Math.PI/20);for(let _r=1;_r<Te;_r++){let ar=_r/Te;if(ar!==.5){const Xi=ar-.5;ar+=ar*Xi*(ar-1)*((1.0904+Ft*(Ft*(3.55645-1.43519*Ft)-3.2452))*Xi*Xi+(.848013+Ft*(.215638*Ft-1.06021)))}const qr=Pt.sub(_t)._mult(ar)._add(_t)._unit()._mult(nr?-1:1);this.addHalfVertex(rt,qr.x,qr.y,!1,nr,0,K)}}ut&&this.addCurrentVertex(rt,Pt,-Qe,-De,K)}else if(je==="butt")this.addCurrentVertex(rt,Yt,0,0,K);else if(je==="square"){const ke=lt?1:-1;this.addCurrentVertex(rt,Yt,ke,ke,K)}else je==="round"&&(lt&&(this.addCurrentVertex(rt,_t,0,0,K),this.addCurrentVertex(rt,_t,1,1,K,!0)),ut&&(this.addCurrentVertex(rt,Pt,-1,-1,K,!0),this.addCurrentVertex(rt,Pt,0,0,K)));if(We&&Ot<R-1){const ke=rt.dist(ut);if(ke>2*W){const Qe=rt.add(ut.sub(rt)._mult(W/ke)._round());this.updateDistance(rt,Qe),this.addCurrentVertex(Qe,Pt,0,0,K),rt=Qe}}}}addCurrentVertex(l,h,p,v,E){let T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const L=h.y*v-h.x,R=-h.y-h.x*v;this.addHalfVertex(l,h.x+h.y*p,h.y-h.x*p,T,!1,p,E),this.addHalfVertex(l,L,R,T,!0,-v,E),this.distance>DS/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,h,p,v,E,T))}addHalfVertex(l,h,p,v,E,T,L){let{x:R,y:V}=l;const W=.5*(this.lineClips?this.scaledDistance*(DS-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((R<<1)+(v?1:0),(V<<1)+(E?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(T===0?0:T<0?-1:1)|(63&W)<<2,W>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const K=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,K),L.primitiveLength++),E?this.e2=K:this.e1=K}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,h){this.distance+=l.dist(h),this.updateScaledDistance()}}let NS,FS;$e("LineBucket",kv,{omit:["layers","patternFeatures"]});var zS={get paint(){return FS=FS||new zn({"line-opacity":new pr(Xt.paint_line["line-opacity"]),"line-color":new pr(Xt.paint_line["line-color"]),"line-translate":new or(Xt.paint_line["line-translate"]),"line-translate-anchor":new or(Xt.paint_line["line-translate-anchor"]),"line-width":new pr(Xt.paint_line["line-width"]),"line-gap-width":new pr(Xt.paint_line["line-gap-width"]),"line-offset":new pr(Xt.paint_line["line-offset"]),"line-blur":new pr(Xt.paint_line["line-blur"]),"line-dasharray":new ec(Xt.paint_line["line-dasharray"]),"line-pattern":new xh(Xt.paint_line["line-pattern"]),"line-gradient":new Lu(Xt.paint_line["line-gradient"])})},get layout(){return NS=NS||new zn({"line-cap":new or(Xt.layout_line["line-cap"]),"line-join":new pr(Xt.layout_line["line-join"]),"line-miter-limit":new or(Xt.layout_line["line-miter-limit"]),"line-round-limit":new or(Xt.layout_line["line-round-limit"]),"line-sort-key":new pr(Xt.layout_line["line-sort-key"])})}};class KR extends pr{possiblyEvaluate(l,h){return h=new Mi(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(l,h)}evaluate(l,h,p,v){return h=bt({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(l,h,p,v)}}let Y0;class YR extends Fo{constructor(l){super(l,zS),this.gradientVersion=0,Y0||(Y0=new KR(zS.paint.properties["line-width"].specification),Y0.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof Ul,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,h){super.recalculate(l,h),this.paint._values["line-floorwidth"]=Y0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new kv(l)}queryRadius(l){const h=l,p=jS(Ud("line-width",this,h),Ud("line-gap-width",this,h)),v=Ud("line-offset",this,h);return p/2+Math.abs(v)+Gf(this.paint.get("line-translate"))}queryIntersectsFeature(l,h,p,v,E,T,L){const R=Th(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,L),V=L/2*jS(this.paint.get("line-width").evaluate(h,p),this.paint.get("line-gap-width").evaluate(h,p)),W=this.paint.get("line-offset").evaluate(h,p);return W&&(v=function(K,rt){const lt=[];for(let ut=0;ut<K.length;ut++){const _t=K[ut],Pt=[];for(let Ot=0;Ot<_t.length;Ot++){const Yt=_t[Ot-1],Ft=_t[Ot],Wt=_t[Ot+1],_e=Ot===0?new A(0,0):Ft.sub(Yt)._unit()._perp(),be=Ot===_t.length-1?new A(0,0):Wt.sub(Ft)._unit()._perp(),We=_e._add(be)._unit(),nr=We.x*be.x+We.y*be.y;nr!==0&&We._mult(1/nr),Pt.push(We._mult(rt)._add(Ft))}lt.push(Pt)}return lt}(v,W*L)),function(K,rt,lt){for(let ut=0;ut<rt.length;ut++){const _t=rt[ut];if(K.length>=3){for(let Pt=0;Pt<_t.length;Pt++)if(sc(K,_t[Pt]))return!0}if(_l(K,_t,lt))return!0}return!1}(R,v,V)}isTileClipped(){return!0}}function jS(u,l){return l>0?l+2*u:u}const QR=fn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),tO=fn([{name:"a_projected_pos",components:3,type:"Float32"}],4);fn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const eO=fn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);fn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const US=fn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rO=fn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function iO(u,l,h){return u.sections.forEach(p=>{p.text=function(v,E,T){const L=E.layout.get("text-transform").evaluate(T,{});return L==="uppercase"?v=v.toLocaleUpperCase():L==="lowercase"&&(v=v.toLocaleLowerCase()),Ba.applyArabicShaping&&(v=Ba.applyArabicShaping(v)),v}(p.text,l,h)}),u}fn([{name:"triangle",components:3,type:"Uint16"}]),fn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),fn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),fn([{type:"Float32",name:"offsetX"}]),fn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),fn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ng={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Yn=24,GS=Bi,VS=function(u,l,h,p,v){var E,T,L=8*v-p-1,R=(1<<L)-1,V=R>>1,W=-7,K=h?v-1:0,rt=h?-1:1,lt=u[l+K];for(K+=rt,E=lt&(1<<-W)-1,lt>>=-W,W+=L;W>0;E=256*E+u[l+K],K+=rt,W-=8);for(T=E&(1<<-W)-1,E>>=-W,W+=p;W>0;T=256*T+u[l+K],K+=rt,W-=8);if(E===0)E=1-V;else{if(E===R)return T?NaN:1/0*(lt?-1:1);T+=Math.pow(2,p),E-=V}return(lt?-1:1)*T*Math.pow(2,E-p)},qS=function(u,l,h,p,v,E){var T,L,R,V=8*E-v-1,W=(1<<V)-1,K=W>>1,rt=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,lt=p?0:E-1,ut=p?1:-1,_t=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(L=isNaN(l)?1:0,T=W):(T=Math.floor(Math.log(l)/Math.LN2),l*(R=Math.pow(2,-T))<1&&(T--,R*=2),(l+=T+K>=1?rt/R:rt*Math.pow(2,1-K))*R>=2&&(T++,R/=2),T+K>=W?(L=0,T=W):T+K>=1?(L=(l*R-1)*Math.pow(2,v),T+=K):(L=l*Math.pow(2,K-1)*Math.pow(2,v),T=0));v>=8;u[h+lt]=255&L,lt+=ut,L/=256,v-=8);for(T=T<<v|L,V+=v;V>0;u[h+lt]=255&T,lt+=ut,T/=256,V-=8);u[h+lt-ut]|=128*_t};function Bi(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}Bi.Varint=0,Bi.Fixed64=1,Bi.Bytes=2,Bi.Fixed32=5;var Rv=4294967296,HS=1/Rv,WS=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ju(u){return u.type===Bi.Bytes?u.readVarint()+u.pos:u.pos+1}function nO(u,l,h){return h?4294967296*l+(u>>>0):4294967296*(l>>>0)+(u>>>0)}function $S(u,l,h){var p=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));h.realloc(p);for(var v=h.pos-1;v>=u;v--)h.buf[v+p]=h.buf[v]}function sO(u,l){for(var h=0;h<u.length;h++)l.writeVarint(u[h])}function oO(u,l){for(var h=0;h<u.length;h++)l.writeSVarint(u[h])}function aO(u,l){for(var h=0;h<u.length;h++)l.writeFloat(u[h])}function lO(u,l){for(var h=0;h<u.length;h++)l.writeDouble(u[h])}function cO(u,l){for(var h=0;h<u.length;h++)l.writeBoolean(u[h])}function uO(u,l){for(var h=0;h<u.length;h++)l.writeFixed32(u[h])}function hO(u,l){for(var h=0;h<u.length;h++)l.writeSFixed32(u[h])}function dO(u,l){for(var h=0;h<u.length;h++)l.writeFixed64(u[h])}function fO(u,l){for(var h=0;h<u.length;h++)l.writeSFixed64(u[h])}function Q0(u,l){return(u[l]|u[l+1]<<8|u[l+2]<<16)+16777216*u[l+3]}function Zf(u,l,h){u[h]=l,u[h+1]=l>>>8,u[h+2]=l>>>16,u[h+3]=l>>>24}function ZS(u,l){return(u[l]|u[l+1]<<8|u[l+2]<<16)+(u[l+3]<<24)}Bi.prototype={destroy:function(){this.buf=null},readFields:function(u,l,h){for(h=h||this.length;this.pos<h;){var p=this.readVarint(),v=p>>3,E=this.pos;this.type=7&p,u(v,l,this),this.pos===E&&this.skip(p)}return l},readMessage:function(u,l){return this.readFields(u,l,this.readVarint()+this.pos)},readFixed32:function(){var u=Q0(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=ZS(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=Q0(this.buf,this.pos)+Q0(this.buf,this.pos+4)*Rv;return this.pos+=8,u},readSFixed64:function(){var u=Q0(this.buf,this.pos)+ZS(this.buf,this.pos+4)*Rv;return this.pos+=8,u},readFloat:function(){var u=VS(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=VS(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var l,h,p=this.buf;return l=127&(h=p[this.pos++]),h<128?l:(l|=(127&(h=p[this.pos++]))<<7,h<128?l:(l|=(127&(h=p[this.pos++]))<<14,h<128?l:(l|=(127&(h=p[this.pos++]))<<21,h<128?l:function(v,E,T){var L,R,V=T.buf;if(L=(112&(R=V[T.pos++]))>>4,R<128||(L|=(127&(R=V[T.pos++]))<<3,R<128)||(L|=(127&(R=V[T.pos++]))<<10,R<128)||(L|=(127&(R=V[T.pos++]))<<17,R<128)||(L|=(127&(R=V[T.pos++]))<<24,R<128)||(L|=(1&(R=V[T.pos++]))<<31,R<128))return nO(v,L,E);throw new Error("Expected varint not more than 10 bytes")}(l|=(15&(h=p[this.pos]))<<28,u,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,l=this.pos;return this.pos=u,u-l>=12&&WS?function(h,p,v){return WS.decode(h.subarray(p,v))}(this.buf,l,u):function(h,p,v){for(var E="",T=p;T<v;){var L,R,V,W=h[T],K=null,rt=W>239?4:W>223?3:W>191?2:1;if(T+rt>v)break;rt===1?W<128&&(K=W):rt===2?(192&(L=h[T+1]))==128&&(K=(31&W)<<6|63&L)<=127&&(K=null):rt===3?(R=h[T+2],(192&(L=h[T+1]))==128&&(192&R)==128&&((K=(15&W)<<12|(63&L)<<6|63&R)<=2047||K>=55296&&K<=57343)&&(K=null)):rt===4&&(R=h[T+2],V=h[T+3],(192&(L=h[T+1]))==128&&(192&R)==128&&(192&V)==128&&((K=(15&W)<<18|(63&L)<<12|(63&R)<<6|63&V)<=65535||K>=1114112)&&(K=null)),K===null?(K=65533,rt=1):K>65535&&(K-=65536,E+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),E+=String.fromCharCode(K),T+=rt}return E}(this.buf,l,u)},readBytes:function(){var u=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,u);return this.pos=u,l},readPackedVarint:function(u,l){if(this.type!==Bi.Bytes)return u.push(this.readVarint(l));var h=ju(this);for(u=u||[];this.pos<h;)u.push(this.readVarint(l));return u},readPackedSVarint:function(u){if(this.type!==Bi.Bytes)return u.push(this.readSVarint());var l=ju(this);for(u=u||[];this.pos<l;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==Bi.Bytes)return u.push(this.readBoolean());var l=ju(this);for(u=u||[];this.pos<l;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==Bi.Bytes)return u.push(this.readFloat());var l=ju(this);for(u=u||[];this.pos<l;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==Bi.Bytes)return u.push(this.readDouble());var l=ju(this);for(u=u||[];this.pos<l;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==Bi.Bytes)return u.push(this.readFixed32());var l=ju(this);for(u=u||[];this.pos<l;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==Bi.Bytes)return u.push(this.readSFixed32());var l=ju(this);for(u=u||[];this.pos<l;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==Bi.Bytes)return u.push(this.readFixed64());var l=ju(this);for(u=u||[];this.pos<l;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==Bi.Bytes)return u.push(this.readSFixed64());var l=ju(this);for(u=u||[];this.pos<l;)u.push(this.readSFixed64());return u},skip:function(u){var l=7&u;if(l===Bi.Varint)for(;this.buf[this.pos++]>127;);else if(l===Bi.Bytes)this.pos=this.readVarint()+this.pos;else if(l===Bi.Fixed32)this.pos+=4;else{if(l!==Bi.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(u,l){this.writeVarint(u<<3|l)},realloc:function(u){for(var l=this.length||16;l<this.pos+u;)l*=2;if(l!==this.length){var h=new Uint8Array(l);h.set(this.buf),this.buf=h,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),Zf(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),Zf(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),Zf(this.buf,-1&u,this.pos),Zf(this.buf,Math.floor(u*HS),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),Zf(this.buf,-1&u,this.pos),Zf(this.buf,Math.floor(u*HS),this.pos+4),this.pos+=8},writeVarint:function(u){(u=+u||0)>268435455||u<0?function(l,h){var p,v;if(l>=0?(p=l%4294967296|0,v=l/4294967296|0):(v=~(-l/4294967296),4294967295^(p=~(-l%4294967296))?p=p+1|0:(p=0,v=v+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(E,T,L){L.buf[L.pos++]=127&E|128,E>>>=7,L.buf[L.pos++]=127&E|128,E>>>=7,L.buf[L.pos++]=127&E|128,E>>>=7,L.buf[L.pos++]=127&E|128,L.buf[L.pos]=127&(E>>>=7)}(p,0,h),function(E,T){var L=(7&E)<<4;T.buf[T.pos++]|=L|((E>>>=3)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E)))))}(v,h)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(u){u=String(u),this.realloc(4*u.length),this.pos++;var l=this.pos;this.pos=function(p,v,E){for(var T,L,R=0;R<v.length;R++){if((T=v.charCodeAt(R))>55295&&T<57344){if(!L){T>56319||R+1===v.length?(p[E++]=239,p[E++]=191,p[E++]=189):L=T;continue}if(T<56320){p[E++]=239,p[E++]=191,p[E++]=189,L=T;continue}T=L-55296<<10|T-56320|65536,L=null}else L&&(p[E++]=239,p[E++]=191,p[E++]=189,L=null);T<128?p[E++]=T:(T<2048?p[E++]=T>>6|192:(T<65536?p[E++]=T>>12|224:(p[E++]=T>>18|240,p[E++]=T>>12&63|128),p[E++]=T>>6&63|128),p[E++]=63&T|128)}return E}(this.buf,u,this.pos);var h=this.pos-l;h>=128&&$S(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeFloat:function(u){this.realloc(4),qS(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),qS(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var l=u.length;this.writeVarint(l),this.realloc(l);for(var h=0;h<l;h++)this.buf[this.pos++]=u[h]},writeRawMessage:function(u,l){this.pos++;var h=this.pos;u(l,this);var p=this.pos-h;p>=128&&$S(h,p,this),this.pos=h-1,this.writeVarint(p),this.pos+=p},writeMessage:function(u,l,h){this.writeTag(u,Bi.Bytes),this.writeRawMessage(l,h)},writePackedVarint:function(u,l){l.length&&this.writeMessage(u,sO,l)},writePackedSVarint:function(u,l){l.length&&this.writeMessage(u,oO,l)},writePackedBoolean:function(u,l){l.length&&this.writeMessage(u,cO,l)},writePackedFloat:function(u,l){l.length&&this.writeMessage(u,aO,l)},writePackedDouble:function(u,l){l.length&&this.writeMessage(u,lO,l)},writePackedFixed32:function(u,l){l.length&&this.writeMessage(u,uO,l)},writePackedSFixed32:function(u,l){l.length&&this.writeMessage(u,hO,l)},writePackedFixed64:function(u,l){l.length&&this.writeMessage(u,dO,l)},writePackedSFixed64:function(u,l){l.length&&this.writeMessage(u,fO,l)},writeBytesField:function(u,l){this.writeTag(u,Bi.Bytes),this.writeBytes(l)},writeFixed32Field:function(u,l){this.writeTag(u,Bi.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(u,l){this.writeTag(u,Bi.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(u,l){this.writeTag(u,Bi.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(u,l){this.writeTag(u,Bi.Fixed64),this.writeSFixed64(l)},writeVarintField:function(u,l){this.writeTag(u,Bi.Varint),this.writeVarint(l)},writeSVarintField:function(u,l){this.writeTag(u,Bi.Varint),this.writeSVarint(l)},writeStringField:function(u,l){this.writeTag(u,Bi.Bytes),this.writeString(l)},writeFloatField:function(u,l){this.writeTag(u,Bi.Fixed32),this.writeFloat(l)},writeDoubleField:function(u,l){this.writeTag(u,Bi.Fixed64),this.writeDouble(l)},writeBooleanField:function(u,l){this.writeVarintField(u,!!l)}};var Ov=f(GS);const Dv=3;function pO(u,l,h){u===1&&h.readMessage(gO,l)}function gO(u,l,h){if(u===3){const{id:p,bitmap:v,width:E,height:T,left:L,top:R,advance:V}=h.readMessage(mO,{});l.push({id:p,bitmap:new Lh({width:E+2*Dv,height:T+2*Dv},v),metrics:{width:E,height:T,left:L,top:R,advance:V}})}}function mO(u,l,h){u===1?l.id=h.readVarint():u===2?l.bitmap=h.readBytes():u===3?l.width=h.readVarint():u===4?l.height=h.readVarint():u===5?l.left=h.readSVarint():u===6?l.top=h.readSVarint():u===7&&(l.advance=h.readVarint())}const JS=Dv;function XS(u){let l=0,h=0;for(const T of u)l+=T.w*T.h,h=Math.max(h,T.w);u.sort((T,L)=>L.h-T.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),h),h:1/0}];let v=0,E=0;for(const T of u)for(let L=p.length-1;L>=0;L--){const R=p[L];if(!(T.w>R.w||T.h>R.h)){if(T.x=R.x,T.y=R.y,E=Math.max(E,T.y+T.h),v=Math.max(v,T.x+T.w),T.w===R.w&&T.h===R.h){const V=p.pop();L<p.length&&(p[L]=V)}else T.h===R.h?(R.x+=T.w,R.w-=T.w):T.w===R.w?(R.y+=T.h,R.h-=T.h):(p.push({x:R.x+T.w,y:R.y,w:R.w-T.w,h:T.h}),R.y+=T.h,R.h-=T.h);break}}return{w:v,h:E,fill:l/(v*E)||0}}const Go=1;class Nv{constructor(l,h){let{pixelRatio:p,version:v,stretchX:E,stretchY:T,content:L}=h;this.paddedRect=l,this.pixelRatio=p,this.stretchX=E,this.stretchY=T,this.content=L,this.version=v}get tl(){return[this.paddedRect.x+Go,this.paddedRect.y+Go]}get br(){return[this.paddedRect.x+this.paddedRect.w-Go,this.paddedRect.y+this.paddedRect.h-Go]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Go)/this.pixelRatio,(this.paddedRect.h-2*Go)/this.pixelRatio]}}class KS{constructor(l,h){const p={},v={};this.haveRenderCallbacks=[];const E=[];this.addImages(l,p,E),this.addImages(h,v,E);const{w:T,h:L}=XS(E),R=new Uo({width:T||1,height:L||1});for(const V in l){const W=l[V],K=p[V].paddedRect;Uo.copy(W.data,R,{x:0,y:0},{x:K.x+Go,y:K.y+Go},W.data)}for(const V in h){const W=h[V],K=v[V].paddedRect,rt=K.x+Go,lt=K.y+Go,ut=W.data.width,_t=W.data.height;Uo.copy(W.data,R,{x:0,y:0},{x:rt,y:lt},W.data),Uo.copy(W.data,R,{x:0,y:_t-1},{x:rt,y:lt-1},{width:ut,height:1}),Uo.copy(W.data,R,{x:0,y:0},{x:rt,y:lt+_t},{width:ut,height:1}),Uo.copy(W.data,R,{x:ut-1,y:0},{x:rt-1,y:lt},{width:1,height:_t}),Uo.copy(W.data,R,{x:0,y:0},{x:rt+ut,y:lt},{width:1,height:_t})}this.image=R,this.iconPositions=p,this.patternPositions=v}addImages(l,h,p){for(const v in l){const E=l[v],T={x:0,y:0,w:E.data.width+2*Go,h:E.data.height+2*Go};p.push(T),h[v]=new Nv(T,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(l,h){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in l.updatedImages)this.patchUpdatedImage(this.iconPositions[p],l.getImage(p),h),this.patchUpdatedImage(this.patternPositions[p],l.getImage(p),h)}patchUpdatedImage(l,h,p){if(!l||!h||l.version===h.version)return;l.version=h.version;const[v,E]=l.tl;p.update(h.data,void 0,{x:v,y:E})}}var Oh;$e("ImagePosition",Nv),$e("ImageAtlas",KS),a.ah=void 0,(Oh=a.ah||(a.ah={}))[Oh.none=0]="none",Oh[Oh.horizontal=1]="horizontal",Oh[Oh.vertical=2]="vertical",Oh[Oh.horizontalOnly=3]="horizontalOnly";const Fg=-17;class zg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(l,h){const p=new zg;return p.scale=l||1,p.fontStack=h,p}static forImage(l){const h=new zg;return h.imageName=l,h}}class Jf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,h){const p=new Jf;for(let v=0;v<l.sections.length;v++){const E=l.sections[v];E.image?p.addImageSection(E):p.addTextSection(E,h)}return p}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=function(l){let h="";for(let p=0;p<l.length;p++){const v=l.charCodeAt(p+1)||null,E=l.charCodeAt(p-1)||null;h+=v&&wh(v)&&!Ng[l[p+1]]||E&&wh(E)&&!Ng[l[p-1]]||!Ng[l[p]]?l[p]:Ng[l[p]]}return h}(this.text)}trim(){let l=0;for(let p=0;p<this.text.length&&e1[this.text.charCodeAt(p)];p++)l++;let h=this.text.length;for(let p=this.text.length-1;p>=0&&p>=l&&e1[this.text.charCodeAt(p)];p--)h--;this.text=this.text.substring(l,h),this.sectionIndex=this.sectionIndex.slice(l,h)}substring(l,h){const p=new Jf;return p.text=this.text.substring(l,h),p.sectionIndex=this.sectionIndex.slice(l,h),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,h)=>Math.max(l,this.sections[h].scale),0)}addTextSection(l,h){this.text+=l.text,this.sections.push(zg.forText(l.scale,l.fontStack||h));const p=this.sections.length-1;for(let v=0;v<l.text.length;++v)this.sectionIndex.push(p)}addImageSection(l){const h=l.image?l.image.name:"";if(h.length===0)return void kt("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(zg.forImage(h)),this.sectionIndex.push(this.sections.length-1)):kt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function t1(u,l,h,p,v,E,T,L,R,V,W,K,rt,lt,ut,_t){const Pt=Jf.fromFeature(u,v);let Ot;K===a.ah.vertical&&Pt.verticalizePunctuation();const{processBidirectionalText:Yt,processStyledBidirectionalText:Ft}=Ba;if(Yt&&Pt.sections.length===1){Ot=[];const be=Yt(Pt.toString(),Fv(Pt,V,E,l,p,lt,ut));for(const We of be){const nr=new Jf;nr.text=We,nr.sections=Pt.sections;for(let Ge=0;Ge<We.length;Ge++)nr.sectionIndex.push(0);Ot.push(nr)}}else if(Ft){Ot=[];const be=Ft(Pt.text,Pt.sectionIndex,Fv(Pt,V,E,l,p,lt,ut));for(const We of be){const nr=new Jf;nr.text=We[0],nr.sectionIndex=We[1],nr.sections=Pt.sections,Ot.push(nr)}}else Ot=function(be,We){const nr=[],Ge=be.text;let je=0;for(const ke of We)nr.push(be.substring(je,ke)),je=ke;return je<Ge.length&&nr.push(be.substring(je,Ge.length)),nr}(Pt,Fv(Pt,V,E,l,p,lt,ut));const Wt=[],_e={positionedLines:Wt,text:Pt.toString(),top:W[1],bottom:W[1],left:W[0],right:W[0],writingMode:K,iconsInText:!1,verticalizable:!1};return function(be,We,nr,Ge,je,ke,Qe,De,Te,_r,ar,qr){let Xi=0,rn=Fg,Qn=0,ha=0;const co=De==="right"?1:De==="left"?0:.5;let Un=0;for(const ts of je){ts.trim();const es=ts.getMaxScale(),Ws=(es-1)*Yn,fo={positionedGlyphs:[],lineOffset:0};be.positionedLines[Un]=fo;const $s=fo.positionedGlyphs;let Vo=0;if(!ts.length()){rn+=ke,++Un;continue}for(let rs=0;rs<ts.length();rs++){const Qr=ts.getSection(rs),Zs=ts.getSectionIndex(rs),Ls=ts.getCharCode(rs);let is=0,vl=null,lc=null,cc=null,Uu=Yn;const bl=!(Te===a.ah.horizontal||!ar&&!Kl(Ls)||ar&&(e1[Ls]||(ms=Ls,Fe.Arabic(ms)||Fe["Arabic Supplement"](ms)||Fe["Arabic Extended-A"](ms)||Fe["Arabic Presentation Forms-A"](ms)||Fe["Arabic Presentation Forms-B"](ms))));if(Qr.imageName){const Oa=Ge[Qr.imageName];if(!Oa)continue;cc=Qr.imageName,be.iconsInText=be.iconsInText||!0,lc=Oa.paddedRect;const Ho=Oa.displaySize;Qr.scale=Qr.scale*Yn/qr,vl={width:Ho[0],height:Ho[1],left:Go,top:-JS,advance:bl?Ho[1]:Ho[0]},is=Ws+(Yn-Ho[1]*Qr.scale),Uu=vl.advance;const Gu=bl?Ho[0]*Qr.scale-Yn*es:Ho[1]*Qr.scale-Yn*es;Gu>0&&Gu>Vo&&(Vo=Gu)}else{const Oa=nr[Qr.fontStack],Ho=Oa&&Oa[Ls];if(Ho&&Ho.rect)lc=Ho.rect,vl=Ho.metrics;else{const Gu=We[Qr.fontStack],qg=Gu&&Gu[Ls];if(!qg)continue;vl=qg.metrics}is=(es-Qr.scale)*Yn}bl?(be.verticalizable=!0,$s.push({glyph:Ls,imageName:cc,x:Xi,y:rn+is,vertical:bl,scale:Qr.scale,fontStack:Qr.fontStack,sectionIndex:Zs,metrics:vl,rect:lc}),Xi+=Uu*Qr.scale+_r):($s.push({glyph:Ls,imageName:cc,x:Xi,y:rn+is,vertical:bl,scale:Qr.scale,fontStack:Qr.fontStack,sectionIndex:Zs,metrics:vl,rect:lc}),Xi+=vl.advance*Qr.scale+_r)}$s.length!==0&&(Qn=Math.max(Xi-_r,Qn),vO($s,0,$s.length-1,co,Vo)),Xi=0;const qo=ke*es+Vo;fo.lineOffset=Math.max(Vo,Ws),rn+=qo,ha=Math.max(qo,ha),++Un}var ms;const Ms=rn-Fg,{horizontalAlign:uo,verticalAlign:ho}=zv(Qe);(function(ts,es,Ws,fo,$s,Vo,qo,rs,Qr){const Zs=(es-Ws)*$s;let Ls=0;Ls=Vo!==qo?-rs*fo-Fg:(-fo*Qr+.5)*qo;for(const is of ts)for(const vl of is.positionedGlyphs)vl.x+=Zs,vl.y+=Ls})(be.positionedLines,co,uo,ho,Qn,ha,ke,Ms,je.length),be.top+=-ho*Ms,be.bottom=be.top+Ms,be.left+=-uo*Qn,be.right=be.left+Qn}(_e,l,h,p,Ot,T,L,R,K,V,rt,_t),!function(be){for(const We of be)if(We.positionedGlyphs.length!==0)return!1;return!0}(Wt)&&_e}const e1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},yO={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function YS(u,l,h,p,v,E){if(l.imageName){const T=p[l.imageName];return T?T.displaySize[0]*l.scale*Yn/E+v:0}{const T=h[l.fontStack],L=T&&T[u];return L?L.metrics.advance*l.scale+v:0}}function QS(u,l,h,p){const v=Math.pow(u-l,2);return p?u<l?v/2:2*v:v+Math.abs(h)*h}function _O(u,l,h){let p=0;return u===10&&(p-=1e4),h&&(p+=150),u!==40&&u!==65288||(p+=50),l!==41&&l!==65289||(p+=50),p}function t3(u,l,h,p,v,E){let T=null,L=QS(l,h,v,E);for(const R of p){const V=QS(l-R.x,h,v,E)+R.badness;V<=L&&(T=R,L=V)}return{index:u,x:l,priorBreak:T,badness:L}}function e3(u){return u?e3(u.priorBreak).concat(u.index):[]}function Fv(u,l,h,p,v,E,T){if(E!=="point")return[];if(!u)return[];const L=[],R=function(rt,lt,ut,_t,Pt,Ot){let Yt=0;for(let Ft=0;Ft<rt.length();Ft++){const Wt=rt.getSection(Ft);Yt+=YS(rt.getCharCode(Ft),Wt,_t,Pt,lt,Ot)}return Yt/Math.max(1,Math.ceil(Yt/ut))}(u,l,h,p,v,T),V=u.text.indexOf("​")>=0;let W=0;for(let rt=0;rt<u.length();rt++){const lt=u.getSection(rt),ut=u.getCharCode(rt);if(e1[ut]||(W+=YS(ut,lt,p,v,l,T)),rt<u.length()-1){const _t=!((K=ut)<11904||!(Fe["Bopomofo Extended"](K)||Fe.Bopomofo(K)||Fe["CJK Compatibility Forms"](K)||Fe["CJK Compatibility Ideographs"](K)||Fe["CJK Compatibility"](K)||Fe["CJK Radicals Supplement"](K)||Fe["CJK Strokes"](K)||Fe["CJK Symbols and Punctuation"](K)||Fe["CJK Unified Ideographs Extension A"](K)||Fe["CJK Unified Ideographs"](K)||Fe["Enclosed CJK Letters and Months"](K)||Fe["Halfwidth and Fullwidth Forms"](K)||Fe.Hiragana(K)||Fe["Ideographic Description Characters"](K)||Fe["Kangxi Radicals"](K)||Fe["Katakana Phonetic Extensions"](K)||Fe.Katakana(K)||Fe["Vertical Forms"](K)||Fe["Yi Radicals"](K)||Fe["Yi Syllables"](K)));(yO[ut]||_t||lt.imageName)&&L.push(t3(rt+1,W,R,L,_O(ut,u.getCharCode(rt+1),_t&&V),!1))}}var K;return e3(t3(u.length(),W,R,L,0,!0))}function zv(u){let l=.5,h=.5;switch(u){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:l,verticalAlign:h}}function vO(u,l,h,p,v){if(!p&&!v)return;const E=u[h],T=(u[h].x+E.metrics.advance*E.scale)*p;for(let L=l;L<=h;L++)u[L].x-=T,u[L].y+=v}function bO(u,l,h){const{horizontalAlign:p,verticalAlign:v}=zv(h),E=l[0]-u.displaySize[0]*p,T=l[1]-u.displaySize[1]*v;return{image:u,top:T,bottom:T+u.displaySize[1],left:E,right:E+u.displaySize[0]}}function r3(u,l,h,p,v,E){const T=u.image;let L;if(T.content){const Pt=T.content,Ot=T.pixelRatio||1;L=[Pt[0]/Ot,Pt[1]/Ot,T.displaySize[0]-Pt[2]/Ot,T.displaySize[1]-Pt[3]/Ot]}const R=l.left*E,V=l.right*E;let W,K,rt,lt;h==="width"||h==="both"?(lt=v[0]+R-p[3],K=v[0]+V+p[1]):(lt=v[0]+(R+V-T.displaySize[0])/2,K=lt+T.displaySize[0]);const ut=l.top*E,_t=l.bottom*E;return h==="height"||h==="both"?(W=v[1]+ut-p[0],rt=v[1]+_t+p[2]):(W=v[1]+(ut+_t-T.displaySize[1])/2,rt=W+T.displaySize[1]),{image:T,top:W,right:K,bottom:rt,left:lt,collisionPadding:L}}const jg=255,Kc=128,Dh=jg*Kc;function i3(u,l){const{expression:h}=l;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Mi(u+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:v}=h;let E=0;for(;E<p.length&&p[E]<=u;)E++;E=Math.max(0,E-1);let T=E;for(;T<p.length&&p[T]<u+1;)T++;T=Math.min(p.length-1,T);const L=p[E],R=p[T];return h.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:R,interpolationType:v}:{kind:"camera",minZoom:L,maxZoom:R,minSize:h.evaluate(new Mi(L)),maxSize:h.evaluate(new Mi(R)),interpolationType:v}}}function jv(u,l,h){let p="never";const v=u.get(l);return v?p=v:u.get(h)&&(p="always"),p}const wO=Rh.VectorTileFeature.types,xO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function r1(u,l,h,p,v,E,T,L,R,V,W,K,rt){const lt=L?Math.min(Dh,Math.round(L[0])):0,ut=L?Math.min(Dh,Math.round(L[1])):0;u.emplaceBack(l,h,Math.round(32*p),Math.round(32*v),E,T,(lt<<1)+(R?1:0),ut,16*V,16*W,256*K,256*rt)}function Uv(u,l,h){u.emplaceBack(l.x,l.y,h),u.emplaceBack(l.x,l.y,h),u.emplaceBack(l.x,l.y,h),u.emplaceBack(l.x,l.y,h)}function AO(u){for(const l of u.sections)if(Ld(l.text))return!0;return!1}class Gv{constructor(l){this.layoutVertexArray=new ct,this.indexArray=new St,this.programConfigurations=l,this.segments=new $t,this.dynamicLayoutVertexArray=new et,this.opacityVertexArray=new ht,this.hasVisibleVertices=!1,this.placedSymbolArray=new d}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,h,p,v){this.isEmpty()||(p&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,QR.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,tO.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,xO,!0),this.opacityVertexBuffer.itemSize=1),(p||v)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}$e("SymbolBuffers",Gv);class Vv{constructor(l,h,p){this.layoutVertexArray=new l,this.layoutAttributes=h,this.indexArray=new p,this.segments=new $t,this.collisionVertexArray=new Mt}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,eO.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}$e("CollisionBuffers",Vv);class Xf{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(T=>T.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ph([]),this.placementViewportMatrix=Ph([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=i3(this.zoom,h["text-size"]),this.iconSizeData=i3(this.zoom,h["icon-size"]);const p=this.layers[0].layout,v=p.get("symbol-sort-key"),E=p.get("symbol-z-order");this.canOverlap=jv(p,"text-overlap","text-allow-overlap")!=="never"||jv(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(T=>a.ah[T])),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=l.sourceID}createArrays(){this.text=new Gv(new hi(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new Gv(new hi(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new S,this.lineVertexArray=new B,this.symbolInstances=new _,this.textAnchorOffsets=new g}calculateGlyphDependencies(l,h,p,v,E){for(let T=0;T<l.length;T++)if(h[l.charCodeAt(T)]=!0,(p||v)&&E){const L=Ng[l.charAt(T)];L&&(h[L.charCodeAt(0)]=!0)}}populate(l,h,p){const v=this.layers[0],E=v.layout,T=E.get("text-font"),L=E.get("text-field"),R=E.get("icon-image"),V=(L.value.kind!=="constant"||L.value.value instanceof Ni&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),W=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,K=E.get("symbol-sort-key");if(this.features=[],!V&&!W)return;const rt=h.iconDependencies,lt=h.glyphDependencies,ut=h.availableImages,_t=new Mi(this.zoom);for(const{feature:Pt,id:Ot,index:Yt,sourceLayerIndex:Ft}of l){const Wt=v._featureFilter.needGeometry,_e=ml(Pt,Wt);if(!v._featureFilter.filter(_t,_e,p))continue;let be,We;if(Wt||(_e.geometry=gl(Pt)),V){const Ge=v.getValueAndResolveTokens("text-field",_e,p,ut),je=Ni.factory(Ge),ke=this.hasRTLText=this.hasRTLText||AO(je);(!ke||Ba.getRTLTextPluginStatus()==="unavailable"||ke&&Ba.isParsed())&&(be=iO(je,v,_e))}if(W){const Ge=v.getValueAndResolveTokens("icon-image",_e,p,ut);We=Ge instanceof Jn?Ge:Jn.fromString(Ge)}if(!be&&!We)continue;const nr=this.sortFeaturesByKey?K.evaluate(_e,{},p):void 0;if(this.features.push({id:Ot,text:be,icon:We,index:Yt,sourceLayerIndex:Ft,geometry:_e.geometry,properties:Pt.properties,type:wO[Pt.type],sortKey:nr}),We&&(rt[We.name]=!0),be){const Ge=T.evaluate(_e,{},p).join(","),je=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.ah.vertical)>=0;for(const ke of be.sections)if(ke.image)rt[ke.image.name]=!0;else{const Qe=Fn(be.toString()),De=ke.fontStack||Ge,Te=lt[De]=lt[De]||{};this.calculateGlyphDependencies(ke.text,Te,je,this.allowVerticalPlacement,Qe)}}}E.get("symbol-placement")==="line"&&(this.features=function(Pt){const Ot={},Yt={},Ft=[];let Wt=0;function _e(Ge){Ft.push(Pt[Ge]),Wt++}function be(Ge,je,ke){const Qe=Yt[Ge];return delete Yt[Ge],Yt[je]=Qe,Ft[Qe].geometry[0].pop(),Ft[Qe].geometry[0]=Ft[Qe].geometry[0].concat(ke[0]),Qe}function We(Ge,je,ke){const Qe=Ot[je];return delete Ot[je],Ot[Ge]=Qe,Ft[Qe].geometry[0].shift(),Ft[Qe].geometry[0]=ke[0].concat(Ft[Qe].geometry[0]),Qe}function nr(Ge,je,ke){const Qe=ke?je[0][je[0].length-1]:je[0][0];return`${Ge}:${Qe.x}:${Qe.y}`}for(let Ge=0;Ge<Pt.length;Ge++){const je=Pt[Ge],ke=je.geometry,Qe=je.text?je.text.toString():null;if(!Qe){_e(Ge);continue}const De=nr(Qe,ke),Te=nr(Qe,ke,!0);if(De in Yt&&Te in Ot&&Yt[De]!==Ot[Te]){const _r=We(De,Te,ke),ar=be(De,Te,Ft[_r].geometry);delete Ot[De],delete Yt[Te],Yt[nr(Qe,Ft[ar].geometry,!0)]=ar,Ft[_r].geometry=null}else De in Yt?be(De,Te,ke):Te in Ot?We(De,Te,ke):(_e(Ge),Ot[De]=Wt-1,Yt[Te]=Wt-1)}return Ft.filter(Ge=>Ge.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Pt,Ot)=>Pt.sortKey-Ot.sortKey)}update(l,h,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,h,this.layers,p),this.icon.programConfigurations.updatePaintArrays(l,h,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,h){const p=this.lineVertexArray.length;if(l.segment!==void 0){let v=l.dist(h[l.segment+1]),E=l.dist(h[l.segment]);const T={};for(let L=l.segment+1;L<h.length;L++)T[L]={x:h[L].x,y:h[L].y,tileUnitDistanceFromAnchor:v},L<h.length-1&&(v+=h[L+1].dist(h[L]));for(let L=l.segment||0;L>=0;L--)T[L]={x:h[L].x,y:h[L].y,tileUnitDistanceFromAnchor:E},L>0&&(E+=h[L-1].dist(h[L]));for(let L=0;L<h.length;L++){const R=T[L];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(l,h,p,v,E,T,L,R,V,W,K,rt){const lt=l.indexArray,ut=l.layoutVertexArray,_t=l.segments.prepareSegment(4*h.length,ut,lt,this.canOverlap?T.sortKey:void 0),Pt=this.glyphOffsetArray.length,Ot=_t.vertexLength,Yt=this.allowVerticalPlacement&&L===a.ah.vertical?Math.PI/2:0,Ft=T.text&&T.text.sections;for(let Wt=0;Wt<h.length;Wt++){const{tl:_e,tr:be,bl:We,br:nr,tex:Ge,pixelOffsetTL:je,pixelOffsetBR:ke,minFontScaleX:Qe,minFontScaleY:De,glyphOffset:Te,isSDF:_r,sectionIndex:ar}=h[Wt],qr=_t.vertexLength,Xi=Te[1];r1(ut,R.x,R.y,_e.x,Xi+_e.y,Ge.x,Ge.y,p,_r,je.x,je.y,Qe,De),r1(ut,R.x,R.y,be.x,Xi+be.y,Ge.x+Ge.w,Ge.y,p,_r,ke.x,je.y,Qe,De),r1(ut,R.x,R.y,We.x,Xi+We.y,Ge.x,Ge.y+Ge.h,p,_r,je.x,ke.y,Qe,De),r1(ut,R.x,R.y,nr.x,Xi+nr.y,Ge.x+Ge.w,Ge.y+Ge.h,p,_r,ke.x,ke.y,Qe,De),Uv(l.dynamicLayoutVertexArray,R,Yt),lt.emplaceBack(qr,qr+1,qr+2),lt.emplaceBack(qr+1,qr+2,qr+3),_t.vertexLength+=4,_t.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Te[0]),Wt!==h.length-1&&ar===h[Wt+1].sectionIndex||l.programConfigurations.populatePaintArrays(ut.length,T,T.index,{},rt,Ft&&Ft[ar])}l.placedSymbolArray.emplaceBack(R.x,R.y,Pt,this.glyphOffsetArray.length-Pt,Ot,V,W,R.segment,p?p[0]:0,p?p[1]:0,v[0],v[1],L,0,!1,0,K)}_addCollisionDebugVertex(l,h,p,v,E,T){return h.emplaceBack(0,0),l.emplaceBack(p.x,p.y,v,E,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(l,h,p,v,E,T,L){const R=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),V=R.vertexLength,W=E.layoutVertexArray,K=E.collisionVertexArray,rt=L.anchorX,lt=L.anchorY;this._addCollisionDebugVertex(W,K,T,rt,lt,new A(l,h)),this._addCollisionDebugVertex(W,K,T,rt,lt,new A(p,h)),this._addCollisionDebugVertex(W,K,T,rt,lt,new A(p,v)),this._addCollisionDebugVertex(W,K,T,rt,lt,new A(l,v)),R.vertexLength+=4;const ut=E.indexArray;ut.emplaceBack(V,V+1),ut.emplaceBack(V+1,V+2),ut.emplaceBack(V+2,V+3),ut.emplaceBack(V+3,V),R.primitiveLength+=4}addDebugCollisionBoxes(l,h,p,v){for(let E=l;E<h;E++){const T=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,v?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vv(ft,US.members,gt),this.iconCollisionBox=new Vv(ft,US.members,gt);for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(l,h,p,v,E,T,L,R,V){const W={};for(let K=h;K<p;K++){const rt=l.get(K);W.textBox={x1:rt.x1,y1:rt.y1,x2:rt.x2,y2:rt.y2,anchorPointX:rt.anchorPointX,anchorPointY:rt.anchorPointY},W.textFeatureIndex=rt.featureIndex;break}for(let K=v;K<E;K++){const rt=l.get(K);W.verticalTextBox={x1:rt.x1,y1:rt.y1,x2:rt.x2,y2:rt.y2,anchorPointX:rt.anchorPointX,anchorPointY:rt.anchorPointY},W.verticalTextFeatureIndex=rt.featureIndex;break}for(let K=T;K<L;K++){const rt=l.get(K);W.iconBox={x1:rt.x1,y1:rt.y1,x2:rt.x2,y2:rt.y2,anchorPointX:rt.anchorPointX,anchorPointY:rt.anchorPointY},W.iconFeatureIndex=rt.featureIndex;break}for(let K=R;K<V;K++){const rt=l.get(K);W.verticalIconBox={x1:rt.x1,y1:rt.y1,x2:rt.x2,y2:rt.y2,anchorPointX:rt.anchorPointX,anchorPointY:rt.anchorPointY},W.verticalIconFeatureIndex=rt.featureIndex;break}return W}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,h){const p=l.placedSymbolArray.get(h),v=p.vertexStartIndex+4*p.numGlyphs;for(let E=p.vertexStartIndex;E<v;E+=4)l.indexArray.emplaceBack(E,E+1,E+2),l.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(l),p=Math.cos(l),v=[],E=[],T=[];for(let L=0;L<this.symbolInstances.length;++L){T.push(L);const R=this.symbolInstances.get(L);v.push(0|Math.round(h*R.anchorX+p*R.anchorY)),E.push(R.featureIndex)}return T.sort((L,R)=>v[L]-v[R]||E[R]-E[L]),T}addToSortKeyRanges(l,h){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===h?p.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const p=this.symbolInstances.get(h);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((v,E,T)=>{v>=0&&T.indexOf(v)===E&&this.addIndicesForPlacedSymbol(this.text,v)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let n3,s3;$e("SymbolBucket",Xf,{omit:["layers","collisionBoxArray","features","compareText"]}),Xf.MAX_GLYPHS=65535,Xf.addDynamicAttributes=Uv;var qv={get paint(){return s3=s3||new zn({"icon-opacity":new pr(Xt.paint_symbol["icon-opacity"]),"icon-color":new pr(Xt.paint_symbol["icon-color"]),"icon-halo-color":new pr(Xt.paint_symbol["icon-halo-color"]),"icon-halo-width":new pr(Xt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pr(Xt.paint_symbol["icon-halo-blur"]),"icon-translate":new or(Xt.paint_symbol["icon-translate"]),"icon-translate-anchor":new or(Xt.paint_symbol["icon-translate-anchor"]),"text-opacity":new pr(Xt.paint_symbol["text-opacity"]),"text-color":new pr(Xt.paint_symbol["text-color"],{runtimeType:fi,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new pr(Xt.paint_symbol["text-halo-color"]),"text-halo-width":new pr(Xt.paint_symbol["text-halo-width"]),"text-halo-blur":new pr(Xt.paint_symbol["text-halo-blur"]),"text-translate":new or(Xt.paint_symbol["text-translate"]),"text-translate-anchor":new or(Xt.paint_symbol["text-translate-anchor"])})},get layout(){return n3=n3||new zn({"symbol-placement":new or(Xt.layout_symbol["symbol-placement"]),"symbol-spacing":new or(Xt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new or(Xt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pr(Xt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new or(Xt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new or(Xt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new or(Xt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new or(Xt.layout_symbol["icon-ignore-placement"]),"icon-optional":new or(Xt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new or(Xt.layout_symbol["icon-rotation-alignment"]),"icon-size":new pr(Xt.layout_symbol["icon-size"]),"icon-text-fit":new or(Xt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new or(Xt.layout_symbol["icon-text-fit-padding"]),"icon-image":new pr(Xt.layout_symbol["icon-image"]),"icon-rotate":new pr(Xt.layout_symbol["icon-rotate"]),"icon-padding":new pr(Xt.layout_symbol["icon-padding"]),"icon-keep-upright":new or(Xt.layout_symbol["icon-keep-upright"]),"icon-offset":new pr(Xt.layout_symbol["icon-offset"]),"icon-anchor":new pr(Xt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new or(Xt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new or(Xt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new or(Xt.layout_symbol["text-rotation-alignment"]),"text-field":new pr(Xt.layout_symbol["text-field"]),"text-font":new pr(Xt.layout_symbol["text-font"]),"text-size":new pr(Xt.layout_symbol["text-size"]),"text-max-width":new pr(Xt.layout_symbol["text-max-width"]),"text-line-height":new or(Xt.layout_symbol["text-line-height"]),"text-letter-spacing":new pr(Xt.layout_symbol["text-letter-spacing"]),"text-justify":new pr(Xt.layout_symbol["text-justify"]),"text-radial-offset":new pr(Xt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new or(Xt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new pr(Xt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new pr(Xt.layout_symbol["text-anchor"]),"text-max-angle":new or(Xt.layout_symbol["text-max-angle"]),"text-writing-mode":new or(Xt.layout_symbol["text-writing-mode"]),"text-rotate":new pr(Xt.layout_symbol["text-rotate"]),"text-padding":new or(Xt.layout_symbol["text-padding"]),"text-keep-upright":new or(Xt.layout_symbol["text-keep-upright"]),"text-transform":new pr(Xt.layout_symbol["text-transform"]),"text-offset":new pr(Xt.layout_symbol["text-offset"]),"text-allow-overlap":new or(Xt.layout_symbol["text-allow-overlap"]),"text-overlap":new or(Xt.layout_symbol["text-overlap"]),"text-ignore-placement":new or(Xt.layout_symbol["text-ignore-placement"]),"text-optional":new or(Xt.layout_symbol["text-optional"])})}};class o3{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:Pr,this.defaultValue=l}evaluate(l){if(l.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(l.formattedSection))return h.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$e("FormatSectionOverride",o3,{omit:["defaultValue"]});class i1 extends Fo{constructor(l){super(l,qv)}recalculate(l,h){if(super.recalculate(l,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const v=[];for(const E of p)v.indexOf(E)<0&&v.push(E);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,h,p,v){const E=this.layout.get(l).evaluate(h,{},p,v),T=this._unevaluatedLayout._values[l];return T.isDataDriven()||jr(T.value)||!E?E:function(L,R){return R.replace(/{([^{}]+)}/g,(V,W)=>L&&W in L?String(L[W]):"")}(h.properties,E)}createBucket(l){return new Xf(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const l of qv.paint.overridableProperties){if(!i1.hasPaintOverride(this.layout,l))continue;const h=this.paint.get(l),p=new o3(h),v=new Or(p,h.property.specification);let E=null;E=h.value.kind==="constant"||h.value.kind==="source"?new Ss("source",v):new Es("composite",v,h.value.zoomStops),this.paint._values[l]=new No(h.property,E,h.parameters)}}_handleOverridablePaintPropertyUpdate(l,h,p){return!(!this.layout||h.isDataDriven()||p.isDataDriven())&&i1.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,h){const p=l.get("text-field"),v=qv.paint.properties[h];let E=!1;const T=L=>{for(const R of L)if(v.overrides&&v.overrides.hasOverride(R))return void(E=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Ni)T(p.value.value.sections);else if(p.value.kind==="source"){const L=V=>{E||(V instanceof ps&&Sr(V.value)===ai?T(V.value.sections):V instanceof ol?T(V.sections):V.eachChild(L))},R=p.value;R._styleExpression&&L(R._styleExpression.expression)}return E}}let a3;var SO={get paint(){return a3=a3||new zn({"background-color":new or(Xt.paint_background["background-color"]),"background-pattern":new ec(Xt.paint_background["background-pattern"]),"background-opacity":new or(Xt.paint_background["background-opacity"])})}};class EO extends Fo{constructor(l){super(l,SO)}}let l3;var CO={get paint(){return l3=l3||new zn({"raster-opacity":new or(Xt.paint_raster["raster-opacity"]),"raster-hue-rotate":new or(Xt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new or(Xt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new or(Xt.paint_raster["raster-brightness-max"]),"raster-saturation":new or(Xt.paint_raster["raster-saturation"]),"raster-contrast":new or(Xt.paint_raster["raster-contrast"]),"raster-resampling":new or(Xt.paint_raster["raster-resampling"]),"raster-fade-duration":new or(Xt.paint_raster["raster-fade-duration"])})}};class TO extends Fo{constructor(l){super(l,CO)}}class PO extends Fo{constructor(l){super(l,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class IO{constructor(l){this._methodToThrottle=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Hv=63710088e-1;class Nh{constructor(l,h){if(isNaN(l)||isNaN(h))throw new Error(`Invalid LngLat object: (${l}, ${h})`);if(this.lng=+l,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Nh(Et(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const h=Math.PI/180,p=this.lat*h,v=l.lat*h,E=Math.sin(p)*Math.sin(v)+Math.cos(p)*Math.cos(v)*Math.cos((l.lng-this.lng)*h);return Hv*Math.acos(Math.min(E,1))}static convert(l){if(l instanceof Nh)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new Nh(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new Nh(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const c3=2*Math.PI*Hv;function u3(u){return c3*Math.cos(u*Math.PI/180)}function h3(u){return(180+u)/360}function d3(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function f3(u,l){return u/u3(l)}function Wv(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}class n1{constructor(l,h){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+l,this.y=+h,this.z=+p}static fromLngLat(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const p=Nh.convert(l);return new n1(h3(p.lng),d3(p.lat),f3(h,p.lat))}toLngLat(){return new Nh(360*this.x-180,Wv(this.y))}toAltitude(){return this.z*u3(Wv(this.y))}meterInMercatorCoordinateUnits(){return 1/c3*(l=Wv(this.y),1/Math.cos(l*Math.PI/180));var l}}function p3(u,l,h){var p=2*Math.PI*6378137/256/Math.pow(2,h);return[u*p-2*Math.PI*6378137/2,l*p-2*Math.PI*6378137/2]}class $v{constructor(l,h,p){if(l<0||l>25||p<0||p>=Math.pow(2,l)||h<0||h>=Math.pow(2,l))throw new Error(`x=${h}, y=${p}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=h,this.y=p,this.key=Ug(0,l,l,h,p)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,h,p){const v=(T=this.y,L=this.z,R=p3(256*(E=this.x),256*(T=Math.pow(2,L)-T-1),L),V=p3(256*(E+1),256*(T+1),L),R[0]+","+R[1]+","+V[0]+","+V[1]);var E,T,L,R,V;const W=function(K,rt,lt){let ut,_t="";for(let Pt=K;Pt>0;Pt--)ut=1<<Pt-1,_t+=(rt&ut?1:0)+(lt&ut?2:0);return _t}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,W).replace(/{bbox-epsg-3857}/g,v)}isChildOf(l){const h=this.z-l.z;return h>0&&l.x===this.x>>h&&l.y===this.y>>h}getTilePoint(l){const h=Math.pow(2,this.z);return new A((l.x*h-this.x)*Ai,(l.y*h-this.y)*Ai)}toString(){return`${this.z}/${this.x}/${this.y}`}}class g3{constructor(l,h){this.wrap=l,this.canonical=h,this.key=Ug(l,h.z,h.z,h.x,h.y)}}class Ra{constructor(l,h,p,v,E){if(l<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${p}`);this.overscaledZ=l,this.wrap=h,this.canonical=new $v(p,+v,+E),this.key=Ug(h,l,p,v,E)}clone(){return new Ra(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-l;return l>this.canonical.z?new Ra(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ra(l,this.wrap,l,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(l,h){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-l;return l>this.canonical.z?Ug(this.wrap*+h,l,this.canonical.z,this.canonical.x,this.canonical.y):Ug(this.wrap*+h,l,l,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(l){if(l.wrap!==this.wrap)return!1;const h=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>h&&l.canonical.y===this.canonical.y>>h}children(l){if(this.overscaledZ>=l)return[new Ra(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,p=2*this.canonical.x,v=2*this.canonical.y;return[new Ra(h,this.wrap,h,p,v),new Ra(h,this.wrap,h,p+1,v),new Ra(h,this.wrap,h,p,v+1),new Ra(h,this.wrap,h,p+1,v+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new Ra(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new Ra(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new g3(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new n1(l.x-this.wrap,l.y))}}function Ug(u,l,h,p,v){(u*=2)<0&&(u=-1*u-1);const E=1<<h;return(E*E*u+E*v+p).toString(36)+h.toString(36)+l.toString(36)}$e("CanonicalTileID",$v),$e("OverscaledTileID",Ra,{omit:["posMatrix"]});class m3{constructor(l,h,p){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,L=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=l,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void kt(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const R=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=E,this.blueFactor=T,this.baseShift=L;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let V=0;V<R;V++)this.data[this._idx(-1,V)]=this.data[this._idx(0,V)],this.data[this._idx(R,V)]=this.data[this._idx(R-1,V)],this.data[this._idx(V,-1)]=this.data[this._idx(V,0)],this.data[this._idx(V,R)]=this.data[this._idx(V,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let V=0;V<R;V++)for(let W=0;W<R;W++){const K=this.get(V,W);K>this.max&&(this.max=K),K<this.min&&(this.min=K)}}get(l,h){const p=new Uint8Array(this.data.buffer),v=4*this._idx(l,h);return this.unpack(p[v],p[v+1],p[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,h){if(l<-1||l>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(l+1)}unpack(l,h,p){return l*this.redFactor+h*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new Uo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,h,p){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let v=h*this.dim,E=h*this.dim+this.dim,T=p*this.dim,L=p*this.dim+this.dim;switch(h){case-1:v=E-1;break;case 1:E=v+1}switch(p){case-1:T=L-1;break;case 1:L=T+1}const R=-h*this.dim,V=-p*this.dim;for(let W=T;W<L;W++)for(let K=v;K<E;K++)this.data[this._idx(K,W)]=l.data[this._idx(K+R,W+V)]}}$e("DEMData",m3);class y3{constructor(l){this._stringToNumber={},this._numberToString=[];for(let h=0;h<l.length;h++){const p=l[h];this._stringToNumber[p]=h,this._numberToString[h]=p}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class _3{constructor(l,h,p,v,E){this.type="Feature",this._vectorTileFeature=l,l._z=h,l._x=p,l._y=v,this.properties=l.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(l[h]=this[h]);return l}}class v3{constructor(l,h){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new Hc(Ai,16,0),this.grid3D=new Hc(Ai,16,0),this.featureIndexArray=new C,this.promoteId=h}insert(l,h,p,v,E,T){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,v,E);const R=T?this.grid3D:this.grid;for(let V=0;V<h.length;V++){const W=h[V],K=[1/0,1/0,-1/0,-1/0];for(let rt=0;rt<W.length;rt++){const lt=W[rt];K[0]=Math.min(K[0],lt.x),K[1]=Math.min(K[1],lt.y),K[2]=Math.max(K[2],lt.x),K[3]=Math.max(K[3],lt.y)}K[0]<Ai&&K[1]<Ai&&K[2]>=0&&K[3]>=0&&R.insert(L,K[0],K[1],K[2],K[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Rh.VectorTile(new Ov(this.rawTileData)).layers,this.sourceLayerCoder=new y3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,h,p,v){this.loadVTLayers();const E=l.params||{},T=Ai/l.tileSize/l.scale,L=ul(E.filter),R=l.queryGeometry,V=l.queryPadding*T,W=w3(R),K=this.grid.query(W.minX-V,W.minY-V,W.maxX+V,W.maxY+V),rt=w3(l.cameraQueryGeometry),lt=this.grid3D.query(rt.minX-V,rt.minY-V,rt.maxX+V,rt.maxY+V,(Pt,Ot,Yt,Ft)=>function(Wt,_e,be,We,nr){for(const je of Wt)if(_e<=je.x&&be<=je.y&&We>=je.x&&nr>=je.y)return!0;const Ge=[new A(_e,be),new A(_e,nr),new A(We,nr),new A(We,be)];if(Wt.length>2){for(const je of Ge)if(sc(Wt,je))return!0}for(let je=0;je<Wt.length-1;je++)if(jd(Wt[je],Wt[je+1],Ge))return!0;return!1}(l.cameraQueryGeometry,Pt-V,Ot-V,Yt+V,Ft+V));for(const Pt of lt)K.push(Pt);K.sort(MO);const ut={};let _t;for(let Pt=0;Pt<K.length;Pt++){const Ot=K[Pt];if(Ot===_t)continue;_t=Ot;const Yt=this.featureIndexArray.get(Ot);let Ft=null;this.loadMatchingFeature(ut,Yt.bucketIndex,Yt.sourceLayerIndex,Yt.featureIndex,L,E.layers,E.availableImages,h,p,v,(Wt,_e,be)=>(Ft||(Ft=gl(Wt)),_e.queryIntersectsFeature(R,Wt,be,Ft,this.z,l.transform,T,l.pixelPosMatrix)))}return ut}loadMatchingFeature(l,h,p,v,E,T,L,R,V,W,K){const rt=this.bucketLayerIDs[h];if(T&&!function(Pt,Ot){for(let Yt=0;Yt<Pt.length;Yt++)if(Ot.indexOf(Pt[Yt])>=0)return!0;return!1}(T,rt))return;const lt=this.sourceLayerCoder.decode(p),ut=this.vtLayers[lt].feature(v);if(E.needGeometry){const Pt=ml(ut,!0);if(!E.filter(new Mi(this.tileID.overscaledZ),Pt,this.tileID.canonical))return}else if(!E.filter(new Mi(this.tileID.overscaledZ),ut))return;const _t=this.getId(ut,lt);for(let Pt=0;Pt<rt.length;Pt++){const Ot=rt[Pt];if(T&&T.indexOf(Ot)<0)continue;const Yt=R[Ot];if(!Yt)continue;let Ft={};_t&&W&&(Ft=W.getState(Yt.sourceLayer||"_geojsonTileLayer",_t));const Wt=bt({},V[Ot]);Wt.paint=b3(Wt.paint,Yt.paint,ut,Ft,L),Wt.layout=b3(Wt.layout,Yt.layout,ut,Ft,L);const _e=!K||K(ut,Yt,Ft);if(!_e)continue;const be=new _3(ut,this.z,this.x,this.y,_t);be.layer=Wt;let We=l[Ot];We===void 0&&(We=l[Ot]=[]),We.push({featureIndex:v,feature:be,intersectionZ:_e})}}lookupSymbolFeatures(l,h,p,v,E,T,L,R){const V={};this.loadVTLayers();const W=ul(E);for(const K of l)this.loadMatchingFeature(V,p,v,K,W,T,L,R,h);return V}hasLayer(l){for(const h of this.bucketLayerIDs)for(const p of h)if(l===p)return!0;return!1}getId(l,h){let p=l.id;return this.promoteId&&(p=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof p=="boolean"&&(p=Number(p))),p}}function b3(u,l,h,p,v){return zt(u,(E,T)=>{const L=l instanceof Mu?l.get(T):null;return L&&L.evaluate?L.evaluate(h,p,v):L})}function w3(u){let l=1/0,h=1/0,p=-1/0,v=-1/0;for(const E of u)l=Math.min(l,E.x),h=Math.min(h,E.y),p=Math.max(p,E.x),v=Math.max(v,E.y);return{minX:l,minY:h,maxX:p,maxY:v}}function MO(u,l){return l-u}function x3(u,l,h,p,v){const E=[];for(let T=0;T<u.length;T++){const L=u[T];let R;for(let V=0;V<L.length-1;V++){let W=L[V],K=L[V+1];W.x<l&&K.x<l||(W.x<l?W=new A(l,W.y+(l-W.x)/(K.x-W.x)*(K.y-W.y))._round():K.x<l&&(K=new A(l,W.y+(l-W.x)/(K.x-W.x)*(K.y-W.y))._round()),W.y<h&&K.y<h||(W.y<h?W=new A(W.x+(h-W.y)/(K.y-W.y)*(K.x-W.x),h)._round():K.y<h&&(K=new A(W.x+(h-W.y)/(K.y-W.y)*(K.x-W.x),h)._round()),W.x>=p&&K.x>=p||(W.x>=p?W=new A(p,W.y+(p-W.x)/(K.x-W.x)*(K.y-W.y))._round():K.x>=p&&(K=new A(p,W.y+(p-W.x)/(K.x-W.x)*(K.y-W.y))._round()),W.y>=v&&K.y>=v||(W.y>=v?W=new A(W.x+(v-W.y)/(K.y-W.y)*(K.x-W.x),v)._round():K.y>=v&&(K=new A(W.x+(v-W.y)/(K.y-W.y)*(K.x-W.x),v)._round()),R&&W.equals(R[R.length-1])||(R=[W],E.push(R)),R.push(K)))))}}return E}$e("FeatureIndex",v3,{omit:["rawTileData","sourceLayerCoder"]});class Fh extends A{constructor(l,h,p,v){super(l,h),this.angle=p,v!==void 0&&(this.segment=v)}clone(){return new Fh(this.x,this.y,this.angle,this.segment)}}function A3(u,l,h,p,v){if(l.segment===void 0||h===0)return!0;let E=l,T=l.segment+1,L=0;for(;L>-h/2;){if(T--,T<0)return!1;L-=u[T].dist(E),E=u[T]}L+=u[T].dist(u[T+1]),T++;const R=[];let V=0;for(;L<h/2;){const W=u[T],K=u[T+1];if(!K)return!1;let rt=u[T-1].angleTo(W)-W.angleTo(K);for(rt=Math.abs((rt+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:L,angleDelta:rt}),V+=rt;L-R[0].distance>p;)V-=R.shift().angleDelta;if(V>v)return!1;T++,L+=W.dist(K)}return!0}function S3(u){let l=0;for(let h=0;h<u.length-1;h++)l+=u[h].dist(u[h+1]);return l}function E3(u,l,h){return u?.6*l*h:0}function C3(u,l){return Math.max(u?u.right-u.left:0,l?l.right-l.left:0)}function LO(u,l,h,p,v,E){const T=E3(h,v,E),L=C3(h,p)*E;let R=0;const V=S3(u)/2;for(let W=0;W<u.length-1;W++){const K=u[W],rt=u[W+1],lt=K.dist(rt);if(R+lt>V){const ut=(V-R)/lt,_t=En.number(K.x,rt.x,ut),Pt=En.number(K.y,rt.y,ut),Ot=new Fh(_t,Pt,rt.angleTo(K),W);return Ot._round(),!T||A3(u,Ot,L,T,l)?Ot:void 0}R+=lt}}function BO(u,l,h,p,v,E,T,L,R){const V=E3(p,E,T),W=C3(p,v),K=W*T,rt=u[0].x===0||u[0].x===R||u[0].y===0||u[0].y===R;return l-K<l/4&&(l=K+l/4),T3(u,rt?l/2*L%l:(W/2+2*E)*T*L%l,l,V,h,K,rt,!1,R)}function T3(u,l,h,p,v,E,T,L,R){const V=E/2,W=S3(u);let K=0,rt=l-h,lt=[];for(let ut=0;ut<u.length-1;ut++){const _t=u[ut],Pt=u[ut+1],Ot=_t.dist(Pt),Yt=Pt.angleTo(_t);for(;rt+h<K+Ot;){rt+=h;const Ft=(rt-K)/Ot,Wt=En.number(_t.x,Pt.x,Ft),_e=En.number(_t.y,Pt.y,Ft);if(Wt>=0&&Wt<R&&_e>=0&&_e<R&&rt-V>=0&&rt+V<=W){const be=new Fh(Wt,_e,Yt,ut);be._round(),p&&!A3(u,be,E,p,v)||lt.push(be)}}K+=Ot}return L||lt.length||T||(lt=T3(u,K/2,h,p,v,E,T,!0,R)),lt}$e("Anchor",Fh);const Kf=Go;function P3(u,l,h,p){const v=[],E=u.image,T=E.pixelRatio,L=E.paddedRect.w-2*Kf,R=E.paddedRect.h-2*Kf,V=u.right-u.left,W=u.bottom-u.top,K=E.stretchX||[[0,L]],rt=E.stretchY||[[0,R]],lt=(ke,Qe)=>ke+Qe[1]-Qe[0],ut=K.reduce(lt,0),_t=rt.reduce(lt,0),Pt=L-ut,Ot=R-_t;let Yt=0,Ft=ut,Wt=0,_e=_t,be=0,We=Pt,nr=0,Ge=Ot;if(E.content&&p){const ke=E.content;Yt=s1(K,0,ke[0]),Wt=s1(rt,0,ke[1]),Ft=s1(K,ke[0],ke[2]),_e=s1(rt,ke[1],ke[3]),be=ke[0]-Yt,nr=ke[1]-Wt,We=ke[2]-ke[0]-Ft,Ge=ke[3]-ke[1]-_e}const je=(ke,Qe,De,Te)=>{const _r=o1(ke.stretch-Yt,Ft,V,u.left),ar=a1(ke.fixed-be,We,ke.stretch,ut),qr=o1(Qe.stretch-Wt,_e,W,u.top),Xi=a1(Qe.fixed-nr,Ge,Qe.stretch,_t),rn=o1(De.stretch-Yt,Ft,V,u.left),Qn=a1(De.fixed-be,We,De.stretch,ut),ha=o1(Te.stretch-Wt,_e,W,u.top),co=a1(Te.fixed-nr,Ge,Te.stretch,_t),Un=new A(_r,qr),ms=new A(rn,qr),Ms=new A(rn,ha),uo=new A(_r,ha),ho=new A(ar/T,Xi/T),ts=new A(Qn/T,co/T),es=l*Math.PI/180;if(es){const $s=Math.sin(es),Vo=Math.cos(es),qo=[Vo,-$s,$s,Vo];Un._matMult(qo),ms._matMult(qo),uo._matMult(qo),Ms._matMult(qo)}const Ws=ke.stretch+ke.fixed,fo=Qe.stretch+Qe.fixed;return{tl:Un,tr:ms,bl:uo,br:Ms,tex:{x:E.paddedRect.x+Kf+Ws,y:E.paddedRect.y+Kf+fo,w:De.stretch+De.fixed-Ws,h:Te.stretch+Te.fixed-fo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ho,pixelOffsetBR:ts,minFontScaleX:We/T/V,minFontScaleY:Ge/T/W,isSDF:h}};if(p&&(E.stretchX||E.stretchY)){const ke=I3(K,Pt,ut),Qe=I3(rt,Ot,_t);for(let De=0;De<ke.length-1;De++){const Te=ke[De],_r=ke[De+1];for(let ar=0;ar<Qe.length-1;ar++)v.push(je(Te,Qe[ar],_r,Qe[ar+1]))}}else v.push(je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:R+1}));return v}function s1(u,l,h){let p=0;for(const v of u)p+=Math.max(l,Math.min(h,v[1]))-Math.max(l,Math.min(h,v[0]));return p}function I3(u,l,h){const p=[{fixed:-Kf,stretch:0}];for(const[v,E]of u){const T=p[p.length-1];p.push({fixed:v-T.stretch,stretch:T.stretch}),p.push({fixed:v-T.stretch,stretch:T.stretch+(E-v)})}return p.push({fixed:l+Kf,stretch:h}),p}function o1(u,l,h,p){return u/l*h+p}function a1(u,l,h,p){return u-l*h/p}class l1{constructor(l,h,p,v,E,T,L,R,V,W){if(this.boxStartIndex=l.length,V){let K=T.top,rt=T.bottom;const lt=T.collisionPadding;lt&&(K-=lt[1],rt+=lt[3]);let ut=rt-K;ut>0&&(ut=Math.max(10,ut),this.circleDiameter=ut)}else{let K=T.top*L-R[0],rt=T.bottom*L+R[2],lt=T.left*L-R[3],ut=T.right*L+R[1];const _t=T.collisionPadding;if(_t&&(lt-=_t[0]*L,K-=_t[1]*L,ut+=_t[2]*L,rt+=_t[3]*L),W){const Pt=new A(lt,K),Ot=new A(ut,K),Yt=new A(lt,rt),Ft=new A(ut,rt),Wt=W*Math.PI/180;Pt._rotate(Wt),Ot._rotate(Wt),Yt._rotate(Wt),Ft._rotate(Wt),lt=Math.min(Pt.x,Ot.x,Yt.x,Ft.x),ut=Math.max(Pt.x,Ot.x,Yt.x,Ft.x),K=Math.min(Pt.y,Ot.y,Yt.y,Ft.y),rt=Math.max(Pt.y,Ot.y,Yt.y,Ft.y)}l.emplaceBack(h.x,h.y,lt,K,ut,rt,p,v,E)}this.boxEndIndex=l.length}}class kO{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:RO;if(this.data=l,this.length=this.data.length,this.compare=h,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(l){this.data.push(l),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const l=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:h,compare:p}=this,v=h[l];for(;l>0;){const E=l-1>>1,T=h[E];if(p(v,T)>=0)break;h[l]=T,l=E}h[l]=v}_down(l){const{data:h,compare:p}=this,v=this.length>>1,E=h[l];for(;l<v;){let T=1+(l<<1),L=h[T];const R=T+1;if(R<this.length&&p(h[R],L)<0&&(T=R,L=h[R]),p(L,E)>=0)break;h[l]=L,l=T}h[l]=E}}function RO(u,l){return u<l?-1:u>l?1:0}function OO(u){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,p=1/0,v=1/0,E=-1/0,T=-1/0;const L=u[0];for(let lt=0;lt<L.length;lt++){const ut=L[lt];(!lt||ut.x<p)&&(p=ut.x),(!lt||ut.y<v)&&(v=ut.y),(!lt||ut.x>E)&&(E=ut.x),(!lt||ut.y>T)&&(T=ut.y)}const R=Math.min(E-p,T-v);let V=R/2;const W=new kO([],DO);if(R===0)return new A(p,v);for(let lt=p;lt<E;lt+=R)for(let ut=v;ut<T;ut+=R)W.push(new Yf(lt+V,ut+V,V,u));let K=function(lt){let ut=0,_t=0,Pt=0;const Ot=lt[0];for(let Yt=0,Ft=Ot.length,Wt=Ft-1;Yt<Ft;Wt=Yt++){const _e=Ot[Yt],be=Ot[Wt],We=_e.x*be.y-be.x*_e.y;_t+=(_e.x+be.x)*We,Pt+=(_e.y+be.y)*We,ut+=3*We}return new Yf(_t/ut,Pt/ut,0,lt)}(u),rt=W.length;for(;W.length;){const lt=W.pop();(lt.d>K.d||!K.d)&&(K=lt,h&&console.log("found best %d after %d probes",Math.round(1e4*lt.d)/1e4,rt)),lt.max-K.d<=l||(V=lt.h/2,W.push(new Yf(lt.p.x-V,lt.p.y-V,V,u)),W.push(new Yf(lt.p.x+V,lt.p.y-V,V,u)),W.push(new Yf(lt.p.x-V,lt.p.y+V,V,u)),W.push(new Yf(lt.p.x+V,lt.p.y+V,V,u)),rt+=4)}return h&&(console.log(`num probes: ${rt}`),console.log(`best distance: ${K.d}`)),K.p}function DO(u,l){return l.max-u.max}function Yf(u,l,h,p){this.p=new A(u,l),this.h=h,this.d=function(v,E){let T=!1,L=1/0;for(let R=0;R<E.length;R++){const V=E[R];for(let W=0,K=V.length,rt=K-1;W<K;rt=W++){const lt=V[W],ut=V[rt];lt.y>v.y!=ut.y>v.y&&v.x<(ut.x-lt.x)*(v.y-lt.y)/(ut.y-lt.y)+lt.x&&(T=!T),L=Math.min(L,zd(v,lt,ut))}}return(T?1:-1)*Math.sqrt(L)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var Is;a.ap=void 0,(Is=a.ap||(a.ap={}))[Is.center=1]="center",Is[Is.left=2]="left",Is[Is.right=3]="right",Is[Is.top=4]="top",Is[Is.bottom=5]="bottom",Is[Is["top-left"]=6]="top-left",Is[Is["top-right"]=7]="top-right",Is[Is["bottom-left"]=8]="bottom-left",Is[Is["bottom-right"]=9]="bottom-right";const zh=7,Zv=Number.POSITIVE_INFINITY;function M3(u,l){return l[1]!==Zv?function(h,p,v){let E=0,T=0;switch(p=Math.abs(p),v=Math.abs(v),h){case"top-right":case"top-left":case"top":T=v-zh;break;case"bottom-right":case"bottom-left":case"bottom":T=-v+zh}switch(h){case"top-right":case"bottom-right":case"right":E=-p;break;case"top-left":case"bottom-left":case"left":E=p}return[E,T]}(u,l[0],l[1]):function(h,p){let v=0,E=0;p<0&&(p=0);const T=p/Math.SQRT2;switch(h){case"top-right":case"top-left":E=T-zh;break;case"bottom-right":case"bottom-left":E=-T+zh;break;case"bottom":E=-p+zh;break;case"top":E=p-zh}switch(h){case"top-right":case"bottom-right":v=-T;break;case"top-left":case"bottom-left":v=T;break;case"left":v=p;break;case"right":v=-p}return[v,E]}(u,l[0])}function L3(u,l,h){var p;const v=u.layout,E=(p=v.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(l,{},h);if(E){const L=E.values,R=[];for(let V=0;V<L.length;V+=2){const W=R[V]=L[V],K=L[V+1].map(rt=>rt*Yn);W.startsWith("top")?K[1]-=zh:W.startsWith("bottom")&&(K[1]+=zh),R[V+1]=K}return new Fi(R)}const T=v.get("text-variable-anchor");if(T){let L;L=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(l,{},h)*Yn,Zv]:v.get("text-offset").evaluate(l,{},h).map(V=>V*Yn);const R=[];for(const V of T)R.push(V,M3(V,L));return new Fi(R)}return null}function Jv(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function NO(u,l,h,p,v,E,T,L,R,V,W){let K=E.textMaxSize.evaluate(l,{});K===void 0&&(K=T);const rt=u.layers[0].layout,lt=rt.get("icon-offset").evaluate(l,{},W),ut=k3(h.horizontal),_t=T/24,Pt=u.tilePixelRatio*_t,Ot=u.tilePixelRatio*K/24,Yt=u.tilePixelRatio*L,Ft=u.tilePixelRatio*rt.get("symbol-spacing"),Wt=rt.get("text-padding")*u.tilePixelRatio,_e=function(Te,_r,ar){let qr=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const Xi=Te.get("icon-padding").evaluate(_r,{},ar),rn=Xi&&Xi.values;return[rn[0]*qr,rn[1]*qr,rn[2]*qr,rn[3]*qr]}(rt,l,W,u.tilePixelRatio),be=rt.get("text-max-angle")/180*Math.PI,We=rt.get("text-rotation-alignment")!=="viewport"&&rt.get("symbol-placement")!=="point",nr=rt.get("icon-rotation-alignment")==="map"&&rt.get("symbol-placement")!=="point",Ge=rt.get("symbol-placement"),je=Ft/2,ke=rt.get("icon-text-fit");let Qe;p&&ke!=="none"&&(u.allowVerticalPlacement&&h.vertical&&(Qe=r3(p,h.vertical,ke,rt.get("icon-text-fit-padding"),lt,_t)),ut&&(p=r3(p,ut,ke,rt.get("icon-text-fit-padding"),lt,_t)));const De=(Te,_r)=>{_r.x<0||_r.x>=Ai||_r.y<0||_r.y>=Ai||function(ar,qr,Xi,rn,Qn,ha,co,Un,ms,Ms,uo,ho,ts,es,Ws,fo,$s,Vo,qo,rs,Qr,Zs,Ls,is,vl){const lc=ar.addToLineVertexArray(qr,Xi);let cc,Uu,bl,Oa,Ho=0,Gu=0,qg=0,N3=0,ib=-1,nb=-1;const Vu={};let F3=vr("");if(ar.allowVerticalPlacement&&rn.vertical){const Js=Un.layout.get("text-rotate").evaluate(Qr,{},is)+90;bl=new l1(ms,qr,Ms,uo,ho,rn.vertical,ts,es,Ws,Js),co&&(Oa=new l1(ms,qr,Ms,uo,ho,co,$s,Vo,Ws,Js))}if(Qn){const Js=Un.layout.get("icon-rotate").evaluate(Qr,{}),Da=Un.layout.get("icon-text-fit")!=="none",Wd=P3(Qn,Js,Ls,Da),hc=co?P3(co,Js,Ls,Da):void 0;Uu=new l1(ms,qr,Ms,uo,ho,Qn,$s,Vo,!1,Js),Ho=4*Wd.length;const $d=ar.iconSizeData;let Yc=null;$d.kind==="source"?(Yc=[Kc*Un.layout.get("icon-size").evaluate(Qr,{})],Yc[0]>Dh&&kt(`${ar.layerIds[0]}: Value for "icon-size" is >= ${jg}. Reduce your "icon-size".`)):$d.kind==="composite"&&(Yc=[Kc*Zs.compositeIconSizes[0].evaluate(Qr,{},is),Kc*Zs.compositeIconSizes[1].evaluate(Qr,{},is)],(Yc[0]>Dh||Yc[1]>Dh)&&kt(`${ar.layerIds[0]}: Value for "icon-size" is >= ${jg}. Reduce your "icon-size".`)),ar.addSymbols(ar.icon,Wd,Yc,rs,qo,Qr,a.ah.none,qr,lc.lineStartIndex,lc.lineLength,-1,is),ib=ar.icon.placedSymbolArray.length-1,hc&&(Gu=4*hc.length,ar.addSymbols(ar.icon,hc,Yc,rs,qo,Qr,a.ah.vertical,qr,lc.lineStartIndex,lc.lineLength,-1,is),nb=ar.icon.placedSymbolArray.length-1)}const z3=Object.keys(rn.horizontal);for(const Js of z3){const Da=rn.horizontal[Js];if(!cc){F3=vr(Da.text);const hc=Un.layout.get("text-rotate").evaluate(Qr,{},is);cc=new l1(ms,qr,Ms,uo,ho,Da,ts,es,Ws,hc)}const Wd=Da.positionedLines.length===1;if(qg+=B3(ar,qr,Da,ha,Un,Ws,Qr,fo,lc,rn.vertical?a.ah.horizontal:a.ah.horizontalOnly,Wd?z3:[Js],Vu,ib,Zs,is),Wd)break}rn.vertical&&(N3+=B3(ar,qr,rn.vertical,ha,Un,Ws,Qr,fo,lc,a.ah.vertical,["vertical"],Vu,nb,Zs,is));const jO=cc?cc.boxStartIndex:ar.collisionBoxArray.length,UO=cc?cc.boxEndIndex:ar.collisionBoxArray.length,GO=bl?bl.boxStartIndex:ar.collisionBoxArray.length,VO=bl?bl.boxEndIndex:ar.collisionBoxArray.length,qO=Uu?Uu.boxStartIndex:ar.collisionBoxArray.length,HO=Uu?Uu.boxEndIndex:ar.collisionBoxArray.length,WO=Oa?Oa.boxStartIndex:ar.collisionBoxArray.length,$O=Oa?Oa.boxEndIndex:ar.collisionBoxArray.length;let uc=-1;const u1=(Js,Da)=>Js&&Js.circleDiameter?Math.max(Js.circleDiameter,Da):Da;uc=u1(cc,uc),uc=u1(bl,uc),uc=u1(Uu,uc),uc=u1(Oa,uc);const j3=uc>-1?1:0;j3&&(uc*=vl/Yn),ar.glyphOffsetArray.length>=Xf.MAX_GLYPHS&&kt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Qr.sortKey!==void 0&&ar.addToSortKeyRanges(ar.symbolInstances.length,Qr.sortKey);const ZO=L3(Un,Qr,is),[JO,XO]=function(Js,Da){const Wd=Js.length,hc=Da==null?void 0:Da.values;if((hc==null?void 0:hc.length)>0)for(let $d=0;$d<hc.length;$d+=2){const Yc=hc[$d+1];Js.emplaceBack(a.ap[hc[$d]],Yc[0],Yc[1])}return[Wd,Js.length]}(ar.textAnchorOffsets,ZO);ar.symbolInstances.emplaceBack(qr.x,qr.y,Vu.right>=0?Vu.right:-1,Vu.center>=0?Vu.center:-1,Vu.left>=0?Vu.left:-1,Vu.vertical||-1,ib,nb,F3,jO,UO,GO,VO,qO,HO,WO,$O,Ms,qg,N3,Ho,Gu,j3,0,ts,uc,JO,XO)}(u,_r,Te,h,p,v,Qe,u.layers[0],u.collisionBoxArray,l.index,l.sourceLayerIndex,u.index,Pt,[Wt,Wt,Wt,Wt],We,R,Yt,_e,nr,lt,l,E,V,W,T)};if(Ge==="line")for(const Te of x3(l.geometry,0,0,Ai,Ai)){const _r=BO(Te,Ft,be,h.vertical||ut,p,24,Ot,u.overscaling,Ai);for(const ar of _r)ut&&FO(u,ut.text,je,ar)||De(Te,ar)}else if(Ge==="line-center"){for(const Te of l.geometry)if(Te.length>1){const _r=LO(Te,be,h.vertical||ut,p,24,Ot);_r&&De(Te,_r)}}else if(l.type==="Polygon")for(const Te of Tv(l.geometry,0)){const _r=OO(Te,16);De(Te[0],new Fh(_r.x,_r.y,0))}else if(l.type==="LineString")for(const Te of l.geometry)De(Te,new Fh(Te[0].x,Te[0].y,0));else if(l.type==="Point")for(const Te of l.geometry)for(const _r of Te)De([_r],new Fh(_r.x,_r.y,0))}function B3(u,l,h,p,v,E,T,L,R,V,W,K,rt,lt,ut){const _t=function(Yt,Ft,Wt,_e,be,We,nr,Ge){const je=_e.layout.get("text-rotate").evaluate(We,{})*Math.PI/180,ke=[];for(const Qe of Ft.positionedLines)for(const De of Qe.positionedGlyphs){if(!De.rect)continue;const Te=De.rect||{};let _r=JS+1,ar=!0,qr=1,Xi=0;const rn=(be||Ge)&&De.vertical,Qn=De.metrics.advance*De.scale/2;if(Ge&&Ft.verticalizable&&(Xi=Qe.lineOffset/2-(De.imageName?-(Yn-De.metrics.width*De.scale)/2:(De.scale-1)*Yn)),De.imageName){const rs=nr[De.imageName];ar=rs.sdf,qr=rs.pixelRatio,_r=Go/qr}const ha=be?[De.x+Qn,De.y]:[0,0];let co=be?[0,0]:[De.x+Qn+Wt[0],De.y+Wt[1]-Xi],Un=[0,0];rn&&(Un=co,co=[0,0]);const ms=De.metrics.isDoubleResolution?2:1,Ms=(De.metrics.left-_r)*De.scale-Qn+co[0],uo=(-De.metrics.top-_r)*De.scale+co[1],ho=Ms+Te.w/ms*De.scale/qr,ts=uo+Te.h/ms*De.scale/qr,es=new A(Ms,uo),Ws=new A(ho,uo),fo=new A(Ms,ts),$s=new A(ho,ts);if(rn){const rs=new A(-Qn,Qn-Fg),Qr=-Math.PI/2,Zs=Yn/2-Qn,Ls=new A(5-Fg-Zs,-(De.imageName?Zs:0)),is=new A(...Un);es._rotateAround(Qr,rs)._add(Ls)._add(is),Ws._rotateAround(Qr,rs)._add(Ls)._add(is),fo._rotateAround(Qr,rs)._add(Ls)._add(is),$s._rotateAround(Qr,rs)._add(Ls)._add(is)}if(je){const rs=Math.sin(je),Qr=Math.cos(je),Zs=[Qr,-rs,rs,Qr];es._matMult(Zs),Ws._matMult(Zs),fo._matMult(Zs),$s._matMult(Zs)}const Vo=new A(0,0),qo=new A(0,0);ke.push({tl:es,tr:Ws,bl:fo,br:$s,tex:Te,writingMode:Ft.writingMode,glyphOffset:ha,sectionIndex:De.sectionIndex,isSDF:ar,pixelOffsetTL:Vo,pixelOffsetBR:qo,minFontScaleX:0,minFontScaleY:0})}return ke}(0,h,L,v,E,T,p,u.allowVerticalPlacement),Pt=u.textSizeData;let Ot=null;Pt.kind==="source"?(Ot=[Kc*v.layout.get("text-size").evaluate(T,{})],Ot[0]>Dh&&kt(`${u.layerIds[0]}: Value for "text-size" is >= ${jg}. Reduce your "text-size".`)):Pt.kind==="composite"&&(Ot=[Kc*lt.compositeTextSizes[0].evaluate(T,{},ut),Kc*lt.compositeTextSizes[1].evaluate(T,{},ut)],(Ot[0]>Dh||Ot[1]>Dh)&&kt(`${u.layerIds[0]}: Value for "text-size" is >= ${jg}. Reduce your "text-size".`)),u.addSymbols(u.text,_t,Ot,L,E,T,V,l,R.lineStartIndex,R.lineLength,rt,ut);for(const Yt of W)K[Yt]=u.text.placedSymbolArray.length-1;return 4*_t.length}function k3(u){for(const l in u)return u[l];return null}function FO(u,l,h,p){const v=u.compareText;if(l in v){const E=v[l];for(let T=E.length-1;T>=0;T--)if(p.dist(E[T])<h)return!0}else v[l]=[];return v[l].push(p),!1}const R3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Xv{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,p]=new Uint8Array(l,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=p>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const E=R3[15&p];if(!E)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(l,2,1),[L]=new Uint32Array(l,4,1);return new Xv(L,T,E,l)}constructor(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,v=arguments.length>3?arguments[3]:void 0;if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=p,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const E=R3.indexOf(this.ArrayType),T=2*l*this.ArrayType.BYTES_PER_ELEMENT,L=l*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-L%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${p}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+L+R,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+T+L+R),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+L+R,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=l)}add(l,h){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=l,this.coords[this._pos++]=h,p}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return Kv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,h,p,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:T,nodeSize:L}=this,R=[0,E.length-1,0],V=[];for(;R.length;){const W=R.pop()||0,K=R.pop()||0,rt=R.pop()||0;if(K-rt<=L){for(let Pt=rt;Pt<=K;Pt++){const Ot=T[2*Pt],Yt=T[2*Pt+1];Ot>=l&&Ot<=p&&Yt>=h&&Yt<=v&&V.push(E[Pt])}continue}const lt=rt+K>>1,ut=T[2*lt],_t=T[2*lt+1];ut>=l&&ut<=p&&_t>=h&&_t<=v&&V.push(E[lt]),(W===0?l<=ut:h<=_t)&&(R.push(rt),R.push(lt-1),R.push(1-W)),(W===0?p>=ut:v>=_t)&&(R.push(lt+1),R.push(K),R.push(1-W))}return V}within(l,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:E,nodeSize:T}=this,L=[0,v.length-1,0],R=[],V=p*p;for(;L.length;){const W=L.pop()||0,K=L.pop()||0,rt=L.pop()||0;if(K-rt<=T){for(let Pt=rt;Pt<=K;Pt++)D3(E[2*Pt],E[2*Pt+1],l,h)<=V&&R.push(v[Pt]);continue}const lt=rt+K>>1,ut=E[2*lt],_t=E[2*lt+1];D3(ut,_t,l,h)<=V&&R.push(v[lt]),(W===0?l-p<=ut:h-p<=_t)&&(L.push(rt),L.push(lt-1),L.push(1-W)),(W===0?l+p>=ut:h+p>=_t)&&(L.push(lt+1),L.push(K),L.push(1-W))}return R}}function Kv(u,l,h,p,v,E){if(v-p<=h)return;const T=p+v>>1;O3(u,l,T,p,v,E),Kv(u,l,h,p,T-1,1-E),Kv(u,l,h,T+1,v,1-E)}function O3(u,l,h,p,v,E){for(;v>p;){if(v-p>600){const V=v-p+1,W=h-p+1,K=Math.log(V),rt=.5*Math.exp(2*K/3),lt=.5*Math.sqrt(K*rt*(V-rt)/V)*(W-V/2<0?-1:1);O3(u,l,h,Math.max(p,Math.floor(h-W*rt/V+lt)),Math.min(v,Math.floor(h+(V-W)*rt/V+lt)),E)}const T=l[2*h+E];let L=p,R=v;for(Gg(u,l,p,h),l[2*v+E]>T&&Gg(u,l,p,v);L<R;){for(Gg(u,l,L,R),L++,R--;l[2*L+E]<T;)L++;for(;l[2*R+E]>T;)R--}l[2*p+E]===T?Gg(u,l,p,R):(R++,Gg(u,l,R,v)),R<=h&&(p=R+1),h<=R&&(v=R-1)}}function Gg(u,l,h,p){Yv(u,h,p),Yv(l,2*h,2*p),Yv(l,2*h+1,2*p+1)}function Yv(u,l,h){const p=u[l];u[l]=u[h],u[h]=p}function D3(u,l,h,p){const v=u-h,E=l-p;return v*v+E*E}var Qv;a.bd=void 0,(Qv=a.bd||(a.bd={})).create="create",Qv.load="load",Qv.fullLoad="fullLoad";let c1=null,Vg=[];const tb=1e3/60,eb="loadTime",rb="fullLoadTime",zO={mark(u){performance.mark(u)},frame(u){const l=u;c1!=null&&Vg.push(l-c1),c1=l},clearMetrics(){c1=null,Vg=[],performance.clearMeasures(eb),performance.clearMeasures(rb);for(const u in a.bd)performance.clearMarks(a.bd[u])},getPerformanceMetrics(){performance.measure(eb,a.bd.create,a.bd.load),performance.measure(rb,a.bd.create,a.bd.fullLoad);const u=performance.getEntriesByName(eb)[0].duration,l=performance.getEntriesByName(rb)[0].duration,h=Vg.length,p=1/(Vg.reduce((E,T)=>E+T,0)/h/1e3),v=Vg.filter(E=>E>tb).reduce((E,T)=>E+(T-tb)/tb,0);return{loadTime:u,fullLoadTime:l,fps:p,percentDroppedFrames:v/(h+v)*100,totalFrames:h}}};a.$=$t,a.A=Fu,a.B=function(u){if(he==null){const l=u.navigator?u.navigator.userAgent:null;he=!!u.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return he},a.C=class{constructor(u,l){this.target=u,this.mapId=l,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new IO(()=>this.process()),this.subscription=function(h,p,v,E){return h.addEventListener(p,v,!1),{unsubscribe:()=>{h.removeEventListener(p,v,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=oe(self)?u:window}registerMessageHandler(u,l){this.messageHandlers[u]=l}sendAsync(u,l){return new Promise((h,p)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[v]={resolve:h,reject:p},l&&l.signal.addEventListener("abort",()=>{delete this.resolveRejects[v];const L={id:v,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(L)},{once:!0});const E=[],T=Object.assign(Object.assign({},u),{id:v,sourceMapId:this.mapId,origin:location.origin,data:Jl(u.data,E)});this.target.postMessage(T,{transfer:E})})}receive(u){const l=u.data,h=l.id;if(!(l.origin!=="file://"&&location.origin!=="file://"&&l.origin!==location.origin||l.targetMapId&&this.mapId!==l.targetMapId)){if(l.type==="<cancel>"){delete this.tasks[h];const p=this.abortControllers[h];return delete this.abortControllers[h],void(p&&p.abort())}if(oe(self)||l.mustQueue)return this.tasks[h]=l,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,l)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),l=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),l&&this.processTask(u,l)}processTask(u,l){return o(this,void 0,void 0,function*(){if(l.type==="<response>"){const v=this.resolveRejects[u];return delete this.resolveRejects[u],v?void(l.error?v.reject(Xl(l.error)):v.resolve(Xl(l.data))):void 0}if(!this.messageHandlers[l.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${l.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=Xl(l.data),p=new AbortController;this.abortControllers[u]=p;try{const v=yield this.messageHandlers[l.type](l.sourceMapId,h,p);this.completeTask(u,null,v)}catch(v){this.completeTask(u,v)}})}completeTask(u,l,h){const p=[];delete this.abortControllers[u];const v={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:l?Jl(l):null,data:Jl(h,p)};this.target.postMessage(v,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},a.D=or,a.E=Bt,a.F=function(){var u=new Fu(16);return Fu!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},a.G=Kt,a.H=function(u,l,h){var p,v,E,T,L,R,V,W,K,rt,lt,ut,_t=h[0],Pt=h[1],Ot=h[2];return l===u?(u[12]=l[0]*_t+l[4]*Pt+l[8]*Ot+l[12],u[13]=l[1]*_t+l[5]*Pt+l[9]*Ot+l[13],u[14]=l[2]*_t+l[6]*Pt+l[10]*Ot+l[14],u[15]=l[3]*_t+l[7]*Pt+l[11]*Ot+l[15]):(v=l[1],E=l[2],T=l[3],L=l[4],R=l[5],V=l[6],W=l[7],K=l[8],rt=l[9],lt=l[10],ut=l[11],u[0]=p=l[0],u[1]=v,u[2]=E,u[3]=T,u[4]=L,u[5]=R,u[6]=V,u[7]=W,u[8]=K,u[9]=rt,u[10]=lt,u[11]=ut,u[12]=p*_t+L*Pt+K*Ot+l[12],u[13]=v*_t+R*Pt+rt*Ot+l[13],u[14]=E*_t+V*Pt+lt*Ot+l[14],u[15]=T*_t+W*Pt+ut*Ot+l[15]),u},a.I=Nv,a.J=function(u,l,h){var p=h[0],v=h[1],E=h[2];return u[0]=l[0]*p,u[1]=l[1]*p,u[2]=l[2]*p,u[3]=l[3]*p,u[4]=l[4]*v,u[5]=l[5]*v,u[6]=l[6]*v,u[7]=l[7]*v,u[8]=l[8]*E,u[9]=l[9]*E,u[10]=l[10]*E,u[11]=l[11]*E,u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15],u},a.K=Cg,a.L=function(u,l){const h={};for(let p=0;p<l.length;p++){const v=l[p];v in u&&(h[v]=u[v])}return h},a.M=Nh,a.N=h3,a.O=d3,a.P=A,a.Q=Ra,a.R=Uo,a.S=U,a.T=Iu,a.U=z,a.V=ee,a.W=Ai,a.X=fn,a.Y=n1,a.Z=class extends zo{},a._=o,a.a=Ut,a.a$=function(u,l,h){return u[0]=l[0]*h[0],u[1]=l[1]*h[1],u[2]=l[2]*h[2],u[3]=l[3]*h[3],u},a.a0=$v,a.a1=de,a.a2=u=>{const l=window.document.createElement("video");return l.muted=!0,new Promise(h=>{l.onloadstart=()=>{h(l)};for(const p of u){const v=window.document.createElement("source");Be(p)||(l.crossOrigin="Anonymous"),v.src=p,l.appendChild(v)}})},a.a3=function(){return pt++},a.a4=x,a.a5=Xf,a.a6=ul,a.a7=ml,a.a8=Mi,a.a9=_3,a.aA=at,a.aB=function(u,l){if(!u)return[{command:"setStyle",args:[l]}];let h=[];try{if(!ve(u.version,l.version))return[{command:"setStyle",args:[l]}];ve(u.center,l.center)||h.push({command:"setCenter",args:[l.center]}),ve(u.zoom,l.zoom)||h.push({command:"setZoom",args:[l.zoom]}),ve(u.bearing,l.bearing)||h.push({command:"setBearing",args:[l.bearing]}),ve(u.pitch,l.pitch)||h.push({command:"setPitch",args:[l.pitch]}),ve(u.sprite,l.sprite)||h.push({command:"setSprite",args:[l.sprite]}),ve(u.glyphs,l.glyphs)||h.push({command:"setGlyphs",args:[l.glyphs]}),ve(u.transition,l.transition)||h.push({command:"setTransition",args:[l.transition]}),ve(u.light,l.light)||h.push({command:"setLight",args:[l.light]}),ve(u.terrain,l.terrain)||h.push({command:"setTerrain",args:[l.terrain]}),ve(u.sky,l.sky)||h.push({command:"setSky",args:[l.sky]});const p={},v=[];(function(T,L,R,V){let W;for(W in L=L||{},T=T||{})Object.prototype.hasOwnProperty.call(T,W)&&(Object.prototype.hasOwnProperty.call(L,W)||lr(W,R,V));for(W in L)Object.prototype.hasOwnProperty.call(L,W)&&(Object.prototype.hasOwnProperty.call(T,W)?ve(T[W],L[W])||(T[W].type==="geojson"&&L[W].type==="geojson"&&Ir(T,L,W)?Ce(R,{command:"setGeoJSONSourceData",args:[W,L[W].data]}):Er(W,L,R,V)):qe(W,L,R))})(u.sources,l.sources,v,p);const E=[];u.layers&&u.layers.forEach(T=>{"source"in T&&p[T.source]?h.push({command:"removeLayer",args:[T.id]}):E.push(T)}),h=h.concat(v),function(T,L,R){L=L||[];const V=(T=T||[]).map(Wr),W=L.map(Wr),K=T.reduce(Jr,{}),rt=L.reduce(Jr,{}),lt=V.slice(),ut=Object.create(null);let _t,Pt,Ot,Yt,Ft;for(let Wt=0,_e=0;Wt<V.length;Wt++)_t=V[Wt],Object.prototype.hasOwnProperty.call(rt,_t)?_e++:(Ce(R,{command:"removeLayer",args:[_t]}),lt.splice(lt.indexOf(_t,_e),1));for(let Wt=0,_e=0;Wt<W.length;Wt++)_t=W[W.length-1-Wt],lt[lt.length-1-Wt]!==_t&&(Object.prototype.hasOwnProperty.call(K,_t)?(Ce(R,{command:"removeLayer",args:[_t]}),lt.splice(lt.lastIndexOf(_t,lt.length-_e),1)):_e++,Yt=lt[lt.length-Wt],Ce(R,{command:"addLayer",args:[rt[_t],Yt]}),lt.splice(lt.length-Wt,0,_t),ut[_t]=!0);for(let Wt=0;Wt<W.length;Wt++)if(_t=W[Wt],Pt=K[_t],Ot=rt[_t],!ut[_t]&&!ve(Pt,Ot))if(ve(Pt.source,Ot.source)&&ve(Pt["source-layer"],Ot["source-layer"])&&ve(Pt.type,Ot.type)){for(Ft in Mr(Pt.layout,Ot.layout,R,_t,null,"setLayoutProperty"),Mr(Pt.paint,Ot.paint,R,_t,null,"setPaintProperty"),ve(Pt.filter,Ot.filter)||Ce(R,{command:"setFilter",args:[_t,Ot.filter]}),ve(Pt.minzoom,Ot.minzoom)&&ve(Pt.maxzoom,Ot.maxzoom)||Ce(R,{command:"setLayerZoomRange",args:[_t,Ot.minzoom,Ot.maxzoom]}),Pt)Object.prototype.hasOwnProperty.call(Pt,Ft)&&Ft!=="layout"&&Ft!=="paint"&&Ft!=="filter"&&Ft!=="metadata"&&Ft!=="minzoom"&&Ft!=="maxzoom"&&(Ft.indexOf("paint.")===0?Mr(Pt[Ft],Ot[Ft],R,_t,Ft.slice(6),"setPaintProperty"):ve(Pt[Ft],Ot[Ft])||Ce(R,{command:"setLayerProperty",args:[_t,Ft,Ot[Ft]]}));for(Ft in Ot)Object.prototype.hasOwnProperty.call(Ot,Ft)&&!Object.prototype.hasOwnProperty.call(Pt,Ft)&&Ft!=="layout"&&Ft!=="paint"&&Ft!=="filter"&&Ft!=="metadata"&&Ft!=="minzoom"&&Ft!=="maxzoom"&&(Ft.indexOf("paint.")===0?Mr(Pt[Ft],Ot[Ft],R,_t,Ft.slice(6),"setPaintProperty"):ve(Pt[Ft],Ot[Ft])||Ce(R,{command:"setLayerProperty",args:[_t,Ft,Ot[Ft]]}))}else Ce(R,{command:"removeLayer",args:[_t]}),Yt=lt[lt.lastIndexOf(_t)+1],Ce(R,{command:"addLayer",args:[Ot,Yt]})}(E,l.layers,h)}catch(p){console.warn("Unable to compute style diff:",p),h=[{command:"setStyle",args:[l]}]}return h},a.aC=function(u){const l=[],h=u.id;return h===void 0&&l.push({message:`layers.${h}: missing required property "id"`}),u.render===void 0&&l.push({message:`layers.${h}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&l.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),l},a.aD=function u(l,h){if(Array.isArray(l)){if(!Array.isArray(h)||l.length!==h.length)return!1;for(let p=0;p<l.length;p++)if(!u(l[p],h[p]))return!1;return!0}if(typeof l=="object"&&l!==null&&h!==null){if(typeof h!="object"||Object.keys(l).length!==Object.keys(h).length)return!1;for(const p in l)if(!u(l[p],h[p]))return!1;return!0}return l===h},a.aE=zt,a.aF=Rt,a.aG=class extends ci{constructor(u,l){super(u,l),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},a.aH=ui,a.aI=class extends ci{constructor(u,l){super(u,l),this.current=Kn}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let l=1;l<16;l++)if(u[l]!==this.current[l]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},a.aJ=en,a.aK=class extends ci{constructor(u,l){super(u,l),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},a.aL=class extends ci{constructor(u,l){super(u,l),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},a.aM=ti,a.aN=function(u,l,h,p,v,E,T){var L=1/(l-h),R=1/(p-v),V=1/(E-T);return u[0]=-2*L,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*R,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*V,u[11]=0,u[12]=(l+h)*L,u[13]=(v+p)*R,u[14]=(T+E)*V,u[15]=1,u},a.aO=Rr,a.aP=Vf,a.aQ=class extends Ru{},a.aR=rO,a.aS=class extends rc{},a.aT=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},a.aU=Pg,a.aV=M,a.aW=class extends Fd{},a.aX=St,a.aY=function(u,l){return u[0]===l[0]&&u[1]===l[1]&&u[2]===l[2]&&u[3]===l[3]&&u[4]===l[4]&&u[5]===l[5]&&u[6]===l[6]&&u[7]===l[7]&&u[8]===l[8]&&u[9]===l[9]&&u[10]===l[10]&&u[11]===l[11]&&u[12]===l[12]&&u[13]===l[13]&&u[14]===l[14]&&u[15]===l[15]},a.aZ=function(u,l){var h=u[0],p=u[1],v=u[2],E=u[3],T=u[4],L=u[5],R=u[6],V=u[7],W=u[8],K=u[9],rt=u[10],lt=u[11],ut=u[12],_t=u[13],Pt=u[14],Ot=u[15],Yt=l[0],Ft=l[1],Wt=l[2],_e=l[3],be=l[4],We=l[5],nr=l[6],Ge=l[7],je=l[8],ke=l[9],Qe=l[10],De=l[11],Te=l[12],_r=l[13],ar=l[14],qr=l[15];return Math.abs(h-Yt)<=Ps*Math.max(1,Math.abs(h),Math.abs(Yt))&&Math.abs(p-Ft)<=Ps*Math.max(1,Math.abs(p),Math.abs(Ft))&&Math.abs(v-Wt)<=Ps*Math.max(1,Math.abs(v),Math.abs(Wt))&&Math.abs(E-_e)<=Ps*Math.max(1,Math.abs(E),Math.abs(_e))&&Math.abs(T-be)<=Ps*Math.max(1,Math.abs(T),Math.abs(be))&&Math.abs(L-We)<=Ps*Math.max(1,Math.abs(L),Math.abs(We))&&Math.abs(R-nr)<=Ps*Math.max(1,Math.abs(R),Math.abs(nr))&&Math.abs(V-Ge)<=Ps*Math.max(1,Math.abs(V),Math.abs(Ge))&&Math.abs(W-je)<=Ps*Math.max(1,Math.abs(W),Math.abs(je))&&Math.abs(K-ke)<=Ps*Math.max(1,Math.abs(K),Math.abs(ke))&&Math.abs(rt-Qe)<=Ps*Math.max(1,Math.abs(rt),Math.abs(Qe))&&Math.abs(lt-De)<=Ps*Math.max(1,Math.abs(lt),Math.abs(De))&&Math.abs(ut-Te)<=Ps*Math.max(1,Math.abs(ut),Math.abs(Te))&&Math.abs(_t-_r)<=Ps*Math.max(1,Math.abs(_t),Math.abs(_r))&&Math.abs(Pt-ar)<=Ps*Math.max(1,Math.abs(Pt),Math.abs(ar))&&Math.abs(Ot-qr)<=Ps*Math.max(1,Math.abs(Ot),Math.abs(qr))},a.a_=function(u,l){return u[0]=l[0],u[1]=l[1],u[2]=l[2],u[3]=l[3],u[4]=l[4],u[5]=l[5],u[6]=l[6],u[7]=l[7],u[8]=l[8],u[9]=l[9],u[10]=l[10],u[11]=l[11],u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15],u},a.aa=function(u){const l={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,p,v,E)=>{const T=v||E;return l[p]=!T||T.toLowerCase(),""}),l["max-age"]){const h=parseInt(l["max-age"],10);isNaN(h)?delete l["max-age"]:l["max-age"]=h}return l},a.ab=function(u,l){const h=[];for(const p in u)p in l||h.push(p);return h},a.ac=mt,a.ad=function(u,l,h){var p=Math.sin(h),v=Math.cos(h),E=l[0],T=l[1],L=l[2],R=l[3],V=l[4],W=l[5],K=l[6],rt=l[7];return l!==u&&(u[8]=l[8],u[9]=l[9],u[10]=l[10],u[11]=l[11],u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15]),u[0]=E*v+V*p,u[1]=T*v+W*p,u[2]=L*v+K*p,u[3]=R*v+rt*p,u[4]=V*v-E*p,u[5]=W*v-T*p,u[6]=K*v-L*p,u[7]=rt*v-R*p,u},a.ae=function(u){var l=new Fu(16);return l[0]=u[0],l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=u[6],l[7]=u[7],l[8]=u[8],l[9]=u[9],l[10]=u[10],l[11]=u[11],l[12]=u[12],l[13]=u[13],l[14]=u[14],l[15]=u[15],l},a.af=Mh,a.ag=function(u,l){let h=0,p=0;if(u.kind==="constant")p=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:v,minZoom:E,maxZoom:T}=u,L=v?mt(hn.interpolationFactor(v,l,E,T),0,1):0;u.kind==="camera"?p=En.number(u.minSize,u.maxSize,L):h=L}return{uSizeT:h,uSize:p}},a.ai=function(u,l,h){let{uSize:p,uSizeT:v}=l,{lowerSize:E,upperSize:T}=h;return u.kind==="source"?E/Kc:u.kind==="composite"?En.number(E/Kc,T/Kc,v):p},a.aj=Uv,a.ak=function(u,l,h,p){const v=l.y-u.y,E=l.x-u.x,T=p.y-h.y,L=p.x-h.x,R=T*E-L*v;if(R===0)return null;const V=(L*(u.y-h.y)-T*(u.x-h.x))/R;return new A(u.x+V*E,u.y+V*v)},a.al=x3,a.am=Zc,a.an=Ph,a.ao=Yn,a.aq=jv,a.ar=function(u,l){var h=l[0],p=l[1],v=l[2],E=l[3],T=l[4],L=l[5],R=l[6],V=l[7],W=l[8],K=l[9],rt=l[10],lt=l[11],ut=l[12],_t=l[13],Pt=l[14],Ot=l[15],Yt=h*L-p*T,Ft=h*R-v*T,Wt=h*V-E*T,_e=p*R-v*L,be=p*V-E*L,We=v*V-E*R,nr=W*_t-K*ut,Ge=W*Pt-rt*ut,je=W*Ot-lt*ut,ke=K*Pt-rt*_t,Qe=K*Ot-lt*_t,De=rt*Ot-lt*Pt,Te=Yt*De-Ft*Qe+Wt*ke+_e*je-be*Ge+We*nr;return Te?(u[0]=(L*De-R*Qe+V*ke)*(Te=1/Te),u[1]=(v*Qe-p*De-E*ke)*Te,u[2]=(_t*We-Pt*be+Ot*_e)*Te,u[3]=(rt*be-K*We-lt*_e)*Te,u[4]=(R*je-T*De-V*Ge)*Te,u[5]=(h*De-v*je+E*Ge)*Te,u[6]=(Pt*Wt-ut*We-Ot*Ft)*Te,u[7]=(W*We-rt*Wt+lt*Ft)*Te,u[8]=(T*Qe-L*je+V*nr)*Te,u[9]=(p*je-h*Qe-E*nr)*Te,u[10]=(ut*be-_t*Wt+Ot*Yt)*Te,u[11]=(K*Wt-W*be-lt*Yt)*Te,u[12]=(L*Ge-T*ke-R*nr)*Te,u[13]=(h*ke-p*Ge+v*nr)*Te,u[14]=(_t*Ft-ut*_e-Pt*Yt)*Te,u[15]=(W*_e-K*Ft+rt*Yt)*Te,u):null},a.as=Jv,a.at=zv,a.au=Xv,a.av=function(){const u={},l=Xt.$version;for(const h in Xt.$root){const p=Xt.$root[h];if(p.required){let v=null;v=h==="version"?l:p.type==="array"?[]:{},v!=null&&(u[h]=v)}}return u},a.aw=bh,a.ax=re,a.ay=function(u){u=u.slice();const l=Object.create(null);for(let h=0;h<u.length;h++)l[u[h].id]=u[h];for(let h=0;h<u.length;h++)"ref"in u[h]&&(u[h]=Ie(u[h],l[u[h].ref]));return u},a.az=function(u){if(u.type==="custom")return new PO(u);switch(u.type){case"background":return new EO(u);case"circle":return new Gd(u);case"fill":return new IR(u);case"fill-extrusion":return new qR(u);case"heatmap":return new Bh(u);case"hillshade":return new wv(u);case"line":return new YR(u);case"raster":return new TO(u);case"symbol":return new i1(u)}},a.b=Dt,a.b0=function(u,l){return u[0]*l[0]+u[1]*l[1]+u[2]*l[2]+u[3]*l[3]},a.b1=Et,a.b2=g3,a.b3=f3,a.b4=function(u,l,h,p,v){var E,T=1/Math.tan(l/2);return u[0]=T/h,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=T,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,v!=null&&v!==1/0?(u[10]=(v+p)*(E=1/(p-v)),u[14]=2*v*p*E):(u[10]=-1,u[14]=-2*p),u},a.b5=function(u,l,h){var p=Math.sin(h),v=Math.cos(h),E=l[4],T=l[5],L=l[6],R=l[7],V=l[8],W=l[9],K=l[10],rt=l[11];return l!==u&&(u[0]=l[0],u[1]=l[1],u[2]=l[2],u[3]=l[3],u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15]),u[4]=E*v+V*p,u[5]=T*v+W*p,u[6]=L*v+K*p,u[7]=R*v+rt*p,u[8]=V*v-E*p,u[9]=W*v-T*p,u[10]=K*v-L*p,u[11]=rt*v-R*p,u},a.b6=J,a.b7=nt,a.b8=function(u){return u*Math.PI/180},a.b9=function(u,l){return u[0]=l[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=l[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=l[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},a.bA=Ba,a.ba=class extends In{},a.bb=Hv,a.bc=zO,a.be=ne,a.bf=function(u,l){Ut.REGISTERED_PROTOCOLS[u]=l},a.bg=function(u){delete Ut.REGISTERED_PROTOCOLS[u]},a.bh=function(u,l){const h={};for(let v=0;v<u.length;v++){const E=l&&l[u[v].id]||Md(u[v]);l&&(l[u[v].id]=E);let T=h[E];T||(T=h[E]=[]),T.push(u[v])}const p=[];for(const v in h)p.push(h[v]);return p},a.bi=$e,a.bj=y3,a.bk=v3,a.bl=KS,a.bm=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=Ai/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const l=u.bucket.layers[0],h=l.layout,p=l._unevaluatedLayout._values,v={layoutIconSize:p["icon-size"].possiblyEvaluate(new Mi(u.bucket.zoom+1),u.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new Mi(u.bucket.zoom+1),u.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new Mi(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:V,maxZoom:W}=u.bucket.textSizeData;v.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Mi(V),u.canonical),p["text-size"].possiblyEvaluate(new Mi(W),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:V,maxZoom:W}=u.bucket.iconSizeData;v.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Mi(V),u.canonical),p["icon-size"].possiblyEvaluate(new Mi(W),u.canonical)]}const E=h.get("text-line-height")*Yn,T=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",L=h.get("text-keep-upright"),R=h.get("text-size");for(const V of u.bucket.features){const W=h.get("text-font").evaluate(V,{},u.canonical).join(","),K=R.evaluate(V,{},u.canonical),rt=v.layoutTextSize.evaluate(V,{},u.canonical),lt=v.layoutIconSize.evaluate(V,{},u.canonical),ut={horizontal:{},vertical:void 0},_t=V.text;let Pt,Ot=[0,0];if(_t){const Wt=_t.toString(),_e=h.get("text-letter-spacing").evaluate(V,{},u.canonical)*Yn,be=qs(Wt)?_e:0,We=h.get("text-anchor").evaluate(V,{},u.canonical),nr=L3(l,V,u.canonical);if(!nr){const De=h.get("text-radial-offset").evaluate(V,{},u.canonical);Ot=De?M3(We,[De*Yn,Zv]):h.get("text-offset").evaluate(V,{},u.canonical).map(Te=>Te*Yn)}let Ge=T?"center":h.get("text-justify").evaluate(V,{},u.canonical);const je=h.get("symbol-placement"),ke=je==="point"?h.get("text-max-width").evaluate(V,{},u.canonical)*Yn:0,Qe=()=>{u.bucket.allowVerticalPlacement&&Fn(Wt)&&(ut.vertical=t1(_t,u.glyphMap,u.glyphPositions,u.imagePositions,W,ke,E,We,"left",be,Ot,a.ah.vertical,!0,je,rt,K))};if(!T&&nr){const De=new Set;if(Ge==="auto")for(let _r=0;_r<nr.values.length;_r+=2)De.add(Jv(nr.values[_r]));else De.add(Ge);let Te=!1;for(const _r of De)if(!ut.horizontal[_r])if(Te)ut.horizontal[_r]=ut.horizontal[0];else{const ar=t1(_t,u.glyphMap,u.glyphPositions,u.imagePositions,W,ke,E,"center",_r,be,Ot,a.ah.horizontal,!1,je,rt,K);ar&&(ut.horizontal[_r]=ar,Te=ar.positionedLines.length===1)}Qe()}else{Ge==="auto"&&(Ge=Jv(We));const De=t1(_t,u.glyphMap,u.glyphPositions,u.imagePositions,W,ke,E,We,Ge,be,Ot,a.ah.horizontal,!1,je,rt,K);De&&(ut.horizontal[Ge]=De),Qe(),Fn(Wt)&&T&&L&&(ut.vertical=t1(_t,u.glyphMap,u.glyphPositions,u.imagePositions,W,ke,E,We,Ge,be,Ot,a.ah.vertical,!1,je,rt,K))}}let Yt=!1;if(V.icon&&V.icon.name){const Wt=u.imageMap[V.icon.name];Wt&&(Pt=bO(u.imagePositions[V.icon.name],h.get("icon-offset").evaluate(V,{},u.canonical),h.get("icon-anchor").evaluate(V,{},u.canonical)),Yt=!!Wt.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=Yt:u.bucket.sdfIcons!==Yt&&kt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Wt.pixelRatio!==u.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const Ft=k3(ut.horizontal)||ut.vertical;u.bucket.iconsInText=!!Ft&&Ft.iconsInText,(Ft||Pt)&&NO(u.bucket,V,ut,Pt,u.imageMap,v,rt,lt,Ot,Yt,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},a.bn=kv,a.bo=Mv,a.bp=Bv,a.bq=Rh,a.br=Ov,a.bs=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},a.bt=function(u,l,h,p,v){return o(this,void 0,void 0,function*(){if(z())try{return yield ee(u,l,h,p,v)}catch{}return function(E,T,L,R,V){const W=E.width,K=E.height;xe&&it||(xe=new OffscreenCanvas(W,K),it=xe.getContext("2d",{willReadFrequently:!0})),xe.width=W,xe.height=K,it.drawImage(E,0,0,W,K);const rt=it.getImageData(T,L,R,V);return it.clearRect(0,0,W,K),rt.data}(u,l,h,p,v)})},a.bu=m3,a.bv=f,a.bw=m,a.bx=GS,a.by=Zi,a.bz=function(u){return u.message===Tt},a.c=Lt,a.d=u=>o(void 0,void 0,void 0,function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const l=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(l)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),a.e=bt,a.f=u=>new Promise((l,h)=>{const p=new Image;p.onload=()=>{l(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=Qt})},p.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(u)],{type:"image/png"});p.src=u.byteLength?URL.createObjectURL(v):Qt}),a.g=Zt,a.h=(u,l)=>Se(bt(u,{type:"json"}),l),a.i=oe,a.j=ge,a.k=Xe,a.l=(u,l)=>Se(bt(u,{type:"arrayBuffer"}),l),a.m=Se,a.n=function(u){return new Ov(u).readFields(pO,[])},a.o=Lh,a.p=XS,a.q=zn,a.r=Ma,a.s=Be,a.t=La,a.u=Fe,a.v=Xt,a.w=kt,a.x=ji,a.y=function(u){let[l,h,p]=u;return h+=90,h*=Math.PI/180,p*=Math.PI/180,{x:l*Math.cos(h)*Math.sin(p),y:l*Math.sin(h)*Math.sin(p),z:l*Math.cos(p)}},a.z=En}),n("worker",["./shared"],function(a){class o{constructor(Y){this.keyCache={},Y&&this.replace(Y)}replace(Y){this._layerConfigs={},this._layers={},this.update(Y,[])}update(Y,Q){for(const wt of Y){this._layerConfigs[wt.id]=wt;const Nt=this._layers[wt.id]=a.az(wt);Nt._featureFilter=a.a6(Nt.filter),this.keyCache[wt.id]&&delete this.keyCache[wt.id]}for(const wt of Q)delete this.keyCache[wt],delete this._layerConfigs[wt],delete this._layers[wt];this.familiesBySource={};const ot=a.bh(Object.values(this._layerConfigs),this.keyCache);for(const wt of ot){const Nt=wt.map(fe=>this._layers[fe.id]),Gt=Nt[0];if(Gt.visibility==="none")continue;const Ht=Gt.source||"";let Ct=this.familiesBySource[Ht];Ct||(Ct=this.familiesBySource[Ht]={});const Jt=Gt.sourceLayer||"_geojsonTileLayer";let ye=Ct[Jt];ye||(ye=Ct[Jt]=[]),ye.push(Nt)}}}class f{constructor(Y){const Q={},ot=[];for(const Ht in Y){const Ct=Y[Ht],Jt=Q[Ht]={};for(const ye in Ct){const fe=Ct[+ye];if(!fe||fe.bitmap.width===0||fe.bitmap.height===0)continue;const ce={x:0,y:0,w:fe.bitmap.width+2,h:fe.bitmap.height+2};ot.push(ce),Jt[ye]={rect:ce,metrics:fe.metrics}}}const{w:wt,h:Nt}=a.p(ot),Gt=new a.o({width:wt||1,height:Nt||1});for(const Ht in Y){const Ct=Y[Ht];for(const Jt in Ct){const ye=Ct[+Jt];if(!ye||ye.bitmap.width===0||ye.bitmap.height===0)continue;const fe=Q[Ht][Jt].rect;a.o.copy(ye.bitmap,Gt,{x:0,y:0},{x:fe.x+1,y:fe.y+1},ye.bitmap)}}this.image=Gt,this.positions=Q}}a.bi("GlyphAtlas",f);class m{constructor(Y){this.tileID=new a.Q(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.uid=Y.uid,this.zoom=Y.zoom,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.returnDependencies=!!Y.returnDependencies,this.promoteId=Y.promoteId,this.inFlightDependencies=[]}parse(Y,Q,ot,wt){return a._(this,void 0,void 0,function*(){this.status="parsing",this.data=Y,this.collisionBoxArray=new a.a4;const Nt=new a.bj(Object.keys(Y.layers).sort()),Gt=new a.bk(this.tileID,this.promoteId);Gt.bucketLayerIDs=[];const Ht={},Ct={featureIndex:Gt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ot},Jt=Q.familiesBySource[this.source];for(const ur in Jt){const Gr=Y.layers[ur];if(!Gr)continue;Gr.version===1&&a.w(`Vector tile source "${this.source}" layer "${ur}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const pi=Nt.encode(ur),Ri=[];for(let Wi=0;Wi<Gr.length;Wi++){const Ii=Gr.feature(Wi),Zn=Gt.getId(Ii,ur);Ri.push({feature:Ii,id:Zn,index:Wi,sourceLayerIndex:pi})}for(const Wi of Jt[ur]){const Ii=Wi[0];Ii.source!==this.source&&a.w(`layer.source = ${Ii.source} does not equal this.source = ${this.source}`),Ii.minzoom&&this.zoom<Math.floor(Ii.minzoom)||Ii.maxzoom&&this.zoom>=Ii.maxzoom||Ii.visibility!=="none"&&(w(Wi,this.zoom,ot),(Ht[Ii.id]=Ii.createBucket({index:Gt.bucketLayerIDs.length,layers:Wi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pi,sourceID:this.source})).populate(Ri,Ct,this.tileID.canonical),Gt.bucketLayerIDs.push(Wi.map(Zn=>Zn.id)))}}const ye=a.aE(Ct.glyphDependencies,ur=>Object.keys(ur).map(Number));this.inFlightDependencies.forEach(ur=>ur==null?void 0:ur.abort()),this.inFlightDependencies=[];let fe=Promise.resolve({});if(Object.keys(ye).length){const ur=new AbortController;this.inFlightDependencies.push(ur),fe=wt.sendAsync({type:"GG",data:{stacks:ye,source:this.source,tileID:this.tileID,type:"glyphs"}},ur)}const ce=Object.keys(Ct.iconDependencies);let He=Promise.resolve({});if(ce.length){const ur=new AbortController;this.inFlightDependencies.push(ur),He=wt.sendAsync({type:"GI",data:{icons:ce,source:this.source,tileID:this.tileID,type:"icons"}},ur)}const Ze=Object.keys(Ct.patternDependencies);let xr=Promise.resolve({});if(Ze.length){const ur=new AbortController;this.inFlightDependencies.push(ur),xr=wt.sendAsync({type:"GI",data:{icons:Ze,source:this.source,tileID:this.tileID,type:"patterns"}},ur)}const[sr,Cr,zr]=yield Promise.all([fe,He,xr]),$r=new f(sr),li=new a.bl(Cr,zr);for(const ur in Ht){const Gr=Ht[ur];Gr instanceof a.a5?(w(Gr.layers,this.zoom,ot),a.bm({bucket:Gr,glyphMap:sr,glyphPositions:$r.positions,imageMap:Cr,imagePositions:li.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Gr.hasPattern&&(Gr instanceof a.bn||Gr instanceof a.bo||Gr instanceof a.bp)&&(w(Gr.layers,this.zoom,ot),Gr.addFeatures(Ct,this.tileID.canonical,li.patternPositions))}return this.status="done",{buckets:Object.values(Ht).filter(ur=>!ur.isEmpty()),featureIndex:Gt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:$r.image,imageAtlas:li,glyphMap:this.returnDependencies?sr:null,iconMap:this.returnDependencies?Cr:null,glyphPositions:this.returnDependencies?$r.positions:null}})}}function w(At,Y,Q){const ot=new a.a8(Y);for(const wt of At)wt.recalculate(ot,Q)}class A{constructor(Y,Q,ot){this.actor=Y,this.layerIndex=Q,this.availableImages=ot,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Y,Q){return a._(this,void 0,void 0,function*(){const ot=yield a.l(Y.request,Q);try{return{vectorTile:new a.bq.VectorTile(new a.br(ot.data)),rawData:ot.data,cacheControl:ot.cacheControl,expires:ot.expires}}catch(wt){const Nt=new Uint8Array(ot.data);let Gt=`Unable to parse the tile at ${Y.request.url}, `;throw Gt+=Nt[0]===31&&Nt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${wt.messge}`,new Error(Gt)}})}loadTile(Y){return a._(this,void 0,void 0,function*(){const Q=Y.uid,ot=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new a.bs(Y.request),wt=new m(Y);this.loading[Q]=wt;const Nt=new AbortController;wt.abort=Nt;try{const Gt=yield this.loadVectorTile(Y,Nt);if(delete this.loading[Q],!Gt)return null;const Ht=Gt.rawData,Ct={};Gt.expires&&(Ct.expires=Gt.expires),Gt.cacheControl&&(Ct.cacheControl=Gt.cacheControl);const Jt={};if(ot){const fe=ot.finish();fe&&(Jt.resourceTiming=JSON.parse(JSON.stringify(fe)))}wt.vectorTile=Gt.vectorTile;const ye=wt.parse(Gt.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[Q]=wt,this.fetching[Q]={rawTileData:Ht,cacheControl:Ct,resourceTiming:Jt};try{const fe=yield ye;return a.e({rawTileData:Ht.slice(0)},fe,Ct,Jt)}finally{delete this.fetching[Q]}}catch(Gt){throw delete this.loading[Q],wt.status="done",this.loaded[Q]=wt,Gt}})}reloadTile(Y){return a._(this,void 0,void 0,function*(){const Q=Y.uid;if(!this.loaded||!this.loaded[Q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ot=this.loaded[Q];if(ot.showCollisionBoxes=Y.showCollisionBoxes,ot.status==="parsing"){const wt=yield ot.parse(ot.vectorTile,this.layerIndex,this.availableImages,this.actor);let Nt;if(this.fetching[Q]){const{rawTileData:Gt,cacheControl:Ht,resourceTiming:Ct}=this.fetching[Q];delete this.fetching[Q],Nt=a.e({rawTileData:Gt.slice(0)},wt,Ht,Ct)}else Nt=wt;return Nt}if(ot.status==="done"&&ot.vectorTile)return ot.parse(ot.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(Y){return a._(this,void 0,void 0,function*(){const Q=this.loading,ot=Y.uid;Q&&Q[ot]&&Q[ot].abort&&(Q[ot].abort.abort(),delete Q[ot])})}removeTile(Y){return a._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Y.uid]&&delete this.loaded[Y.uid]})}}class P{constructor(){this.loaded={}}loadTile(Y){return a._(this,void 0,void 0,function*(){const{uid:Q,encoding:ot,rawImageData:wt,redFactor:Nt,greenFactor:Gt,blueFactor:Ht,baseShift:Ct}=Y,Jt=wt.width+2,ye=wt.height+2,fe=a.b(wt)?new a.R({width:Jt,height:ye},yield a.bt(wt,-1,-1,Jt,ye)):wt,ce=new a.bu(Q,fe,ot,Nt,Gt,Ht,Ct);return this.loaded=this.loaded||{},this.loaded[Q]=ce,ce})}removeTile(Y){const Q=this.loaded,ot=Y.uid;Q&&Q[ot]&&delete Q[ot]}}function I(At,Y){if(At.length!==0){N(At[0],Y);for(var Q=1;Q<At.length;Q++)N(At[Q],!Y)}}function N(At,Y){for(var Q=0,ot=0,wt=0,Nt=At.length,Gt=Nt-1;wt<Nt;Gt=wt++){var Ht=(At[wt][0]-At[Gt][0])*(At[Gt][1]+At[wt][1]),Ct=Q+Ht;ot+=Math.abs(Q)>=Math.abs(Ht)?Q-Ct+Ht:Ht-Ct+Q,Q=Ct}Q+ot>=0!=!!Y&&At.reverse()}var F=a.bv(function At(Y,Q){var ot,wt=Y&&Y.type;if(wt==="FeatureCollection")for(ot=0;ot<Y.features.length;ot++)At(Y.features[ot],Q);else if(wt==="GeometryCollection")for(ot=0;ot<Y.geometries.length;ot++)At(Y.geometries[ot],Q);else if(wt==="Feature")At(Y.geometry,Q);else if(wt==="Polygon")I(Y.coordinates,Q);else if(wt==="MultiPolygon")for(ot=0;ot<Y.coordinates.length;ot++)I(Y.coordinates[ot],Q);return Y});const Z=a.bq.VectorTileFeature.prototype.toGeoJSON;var U={exports:{}},z=a.bw,J=a.bq.VectorTileFeature,nt=mt;function mt(At,Y){this.options=Y||{},this.features=At,this.length=At.length}function Et(At,Y){this.id=typeof At.id=="number"?At.id:void 0,this.type=At.type,this.rawGeometry=At.type===1?[At.geometry]:At.geometry,this.properties=At.tags,this.extent=Y||4096}mt.prototype.feature=function(At){return new Et(this.features[At],this.options.extent)},Et.prototype.loadGeometry=function(){var At=this.rawGeometry;this.geometry=[];for(var Y=0;Y<At.length;Y++){for(var Q=At[Y],ot=[],wt=0;wt<Q.length;wt++)ot.push(new z(Q[wt][0],Q[wt][1]));this.geometry.push(ot)}return this.geometry},Et.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var At=this.geometry,Y=1/0,Q=-1/0,ot=1/0,wt=-1/0,Nt=0;Nt<At.length;Nt++)for(var Gt=At[Nt],Ht=0;Ht<Gt.length;Ht++){var Ct=Gt[Ht];Y=Math.min(Y,Ct.x),Q=Math.max(Q,Ct.x),ot=Math.min(ot,Ct.y),wt=Math.max(wt,Ct.y)}return[Y,ot,Q,wt]},Et.prototype.toGeoJSON=J.prototype.toGeoJSON;var bt=a.bx,pt=nt;function zt(At){var Y=new bt;return function(Q,ot){for(var wt in Q.layers)ot.writeMessage(3,Rt,Q.layers[wt])}(At,Y),Y.finish()}function Rt(At,Y){var Q;Y.writeVarintField(15,At.version||1),Y.writeStringField(1,At.name||""),Y.writeVarintField(5,At.extent||4096);var ot={keys:[],values:[],keycache:{},valuecache:{}};for(Q=0;Q<At.length;Q++)ot.feature=At.feature(Q),Y.writeMessage(2,at,ot);var wt=ot.keys;for(Q=0;Q<wt.length;Q++)Y.writeStringField(3,wt[Q]);var Nt=ot.values;for(Q=0;Q<Nt.length;Q++)Y.writeMessage(4,oe,Nt[Q])}function at(At,Y){var Q=At.feature;Q.id!==void 0&&Y.writeVarintField(1,Q.id),Y.writeMessage(2,dt,At),Y.writeVarintField(3,Q.type),Y.writeMessage(4,ue,Q)}function dt(At,Y){var Q=At.feature,ot=At.keys,wt=At.values,Nt=At.keycache,Gt=At.valuecache;for(var Ht in Q.properties){var Ct=Q.properties[Ht],Jt=Nt[Ht];if(Ct!==null){Jt===void 0&&(ot.push(Ht),Nt[Ht]=Jt=ot.length-1),Y.writeVarint(Jt);var ye=typeof Ct;ye!=="string"&&ye!=="boolean"&&ye!=="number"&&(Ct=JSON.stringify(Ct));var fe=ye+":"+Ct,ce=Gt[fe];ce===void 0&&(wt.push(Ct),Gt[fe]=ce=wt.length-1),Y.writeVarint(ce)}}}function kt(At,Y){return(Y<<3)+(7&At)}function xt(At){return At<<1^At>>31}function ue(At,Y){for(var Q=At.loadGeometry(),ot=At.type,wt=0,Nt=0,Gt=Q.length,Ht=0;Ht<Gt;Ht++){var Ct=Q[Ht],Jt=1;ot===1&&(Jt=Ct.length),Y.writeVarint(kt(1,Jt));for(var ye=ot===3?Ct.length-1:Ct.length,fe=0;fe<ye;fe++){fe===1&&ot!==1&&Y.writeVarint(kt(2,ye-1));var ce=Ct[fe].x-wt,He=Ct[fe].y-Nt;Y.writeVarint(xt(ce)),Y.writeVarint(xt(He)),wt+=ce,Nt+=He}ot===3&&Y.writeVarint(kt(7,1))}}function oe(At,Y){var Q=typeof At;Q==="string"?Y.writeStringField(1,At):Q==="boolean"?Y.writeBooleanField(7,At):Q==="number"&&(At%1!=0?Y.writeDoubleField(3,At):At<0?Y.writeSVarintField(6,At):Y.writeVarintField(5,At))}U.exports=zt,U.exports.fromVectorTileJs=zt,U.exports.fromGeojsonVt=function(At,Y){Y=Y||{};var Q={};for(var ot in At)Q[ot]=new pt(At[ot].features,Y),Q[ot].name=ot,Q[ot].version=Y.version,Q[ot].extent=Y.extent;return zt({layers:Q})},U.exports.GeoJSONWrapper=pt;var he=a.bv(U.exports);const Dt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:At=>At},Qt=Math.fround||(ee=new Float32Array(1),At=>(ee[0]=+At,ee[0]));var ee;const xe=3,it=5,Tt=6;class Lt{constructor(Y){this.options=Object.assign(Object.create(Dt),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:Q,minZoom:ot,maxZoom:wt}=this.options;Q&&console.time("total time");const Nt=`prepare ${Y.length} points`;Q&&console.time(Nt),this.points=Y;const Gt=[];for(let Ct=0;Ct<Y.length;Ct++){const Jt=Y[Ct];if(!Jt.geometry)continue;const[ye,fe]=Jt.geometry.coordinates,ce=Qt(Kt(ye)),He=Qt(ne(fe));Gt.push(ce,He,1/0,Ct,-1,1),this.options.reduce&&Gt.push(0)}let Ht=this.trees[wt+1]=this._createTree(Gt);Q&&console.timeEnd(Nt);for(let Ct=wt;Ct>=ot;Ct--){const Jt=+Date.now();Ht=this.trees[Ct]=this._createTree(this._cluster(Ht,Ct)),Q&&console.log("z%d: %d clusters in %dms",Ct,Ht.numItems,+Date.now()-Jt)}return Q&&console.timeEnd("total time"),this}getClusters(Y,Q){let ot=((Y[0]+180)%360+360)%360-180;const wt=Math.max(-90,Math.min(90,Y[1]));let Nt=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const Gt=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ot=-180,Nt=180;else if(ot>Nt){const fe=this.getClusters([ot,wt,180,Gt],Q),ce=this.getClusters([-180,wt,Nt,Gt],Q);return fe.concat(ce)}const Ht=this.trees[this._limitZoom(Q)],Ct=Ht.range(Kt(ot),ne(Gt),Kt(Nt),ne(wt)),Jt=Ht.data,ye=[];for(const fe of Ct){const ce=this.stride*fe;ye.push(Jt[ce+it]>1?Ut(Jt,ce,this.clusterProps):this.points[Jt[ce+xe]])}return ye}getChildren(Y){const Q=this._getOriginId(Y),ot=this._getOriginZoom(Y),wt="No cluster with the specified id.",Nt=this.trees[ot];if(!Nt)throw new Error(wt);const Gt=Nt.data;if(Q*this.stride>=Gt.length)throw new Error(wt);const Ht=this.options.radius/(this.options.extent*Math.pow(2,ot-1)),Ct=Nt.within(Gt[Q*this.stride],Gt[Q*this.stride+1],Ht),Jt=[];for(const ye of Ct){const fe=ye*this.stride;Gt[fe+4]===Y&&Jt.push(Gt[fe+it]>1?Ut(Gt,fe,this.clusterProps):this.points[Gt[fe+xe]])}if(Jt.length===0)throw new Error(wt);return Jt}getLeaves(Y,Q,ot){const wt=[];return this._appendLeaves(wt,Y,Q=Q||10,ot=ot||0,0),wt}getTile(Y,Q,ot){const wt=this.trees[this._limitZoom(Y)],Nt=Math.pow(2,Y),{extent:Gt,radius:Ht}=this.options,Ct=Ht/Gt,Jt=(ot-Ct)/Nt,ye=(ot+1+Ct)/Nt,fe={features:[]};return this._addTileFeatures(wt.range((Q-Ct)/Nt,Jt,(Q+1+Ct)/Nt,ye),wt.data,Q,ot,Nt,fe),Q===0&&this._addTileFeatures(wt.range(1-Ct/Nt,Jt,1,ye),wt.data,Nt,ot,Nt,fe),Q===Nt-1&&this._addTileFeatures(wt.range(0,Jt,Ct/Nt,ye),wt.data,-1,ot,Nt,fe),fe.features.length?fe:null}getClusterExpansionZoom(Y){let Q=this._getOriginZoom(Y)-1;for(;Q<=this.options.maxZoom;){const ot=this.getChildren(Y);if(Q++,ot.length!==1)break;Y=ot[0].properties.cluster_id}return Q}_appendLeaves(Y,Q,ot,wt,Nt){const Gt=this.getChildren(Q);for(const Ht of Gt){const Ct=Ht.properties;if(Ct&&Ct.cluster?Nt+Ct.point_count<=wt?Nt+=Ct.point_count:Nt=this._appendLeaves(Y,Ct.cluster_id,ot,wt,Nt):Nt<wt?Nt++:Y.push(Ht),Y.length===ot)break}return Nt}_createTree(Y){const Q=new a.au(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ot=0;ot<Y.length;ot+=this.stride)Q.add(Y[ot],Y[ot+1]);return Q.finish(),Q.data=Y,Q}_addTileFeatures(Y,Q,ot,wt,Nt,Gt){for(const Ht of Y){const Ct=Ht*this.stride,Jt=Q[Ct+it]>1;let ye,fe,ce;if(Jt)ye=Zt(Q,Ct,this.clusterProps),fe=Q[Ct],ce=Q[Ct+1];else{const xr=this.points[Q[Ct+xe]];ye=xr.properties;const[sr,Cr]=xr.geometry.coordinates;fe=Kt(sr),ce=ne(Cr)}const He={type:1,geometry:[[Math.round(this.options.extent*(fe*Nt-ot)),Math.round(this.options.extent*(ce*Nt-wt))]],tags:ye};let Ze;Ze=Jt||this.options.generateId?Q[Ct+xe]:this.points[Q[Ct+xe]].id,Ze!==void 0&&(He.id=Ze),Gt.features.push(He)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,Q){const{radius:ot,extent:wt,reduce:Nt,minPoints:Gt}=this.options,Ht=ot/(wt*Math.pow(2,Q)),Ct=Y.data,Jt=[],ye=this.stride;for(let fe=0;fe<Ct.length;fe+=ye){if(Ct[fe+2]<=Q)continue;Ct[fe+2]=Q;const ce=Ct[fe],He=Ct[fe+1],Ze=Y.within(Ct[fe],Ct[fe+1],Ht),xr=Ct[fe+it];let sr=xr;for(const Cr of Ze){const zr=Cr*ye;Ct[zr+2]>Q&&(sr+=Ct[zr+it])}if(sr>xr&&sr>=Gt){let Cr,zr=ce*xr,$r=He*xr,li=-1;const ur=((fe/ye|0)<<5)+(Q+1)+this.points.length;for(const Gr of Ze){const pi=Gr*ye;if(Ct[pi+2]<=Q)continue;Ct[pi+2]=Q;const Ri=Ct[pi+it];zr+=Ct[pi]*Ri,$r+=Ct[pi+1]*Ri,Ct[pi+4]=ur,Nt&&(Cr||(Cr=this._map(Ct,fe,!0),li=this.clusterProps.length,this.clusterProps.push(Cr)),Nt(Cr,this._map(Ct,pi)))}Ct[fe+4]=ur,Jt.push(zr/sr,$r/sr,1/0,ur,-1,sr),Nt&&Jt.push(li)}else{for(let Cr=0;Cr<ye;Cr++)Jt.push(Ct[fe+Cr]);if(sr>1)for(const Cr of Ze){const zr=Cr*ye;if(!(Ct[zr+2]<=Q)){Ct[zr+2]=Q;for(let $r=0;$r<ye;$r++)Jt.push(Ct[zr+$r])}}}}return Jt}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,Q,ot){if(Y[Q+it]>1){const Gt=this.clusterProps[Y[Q+Tt]];return ot?Object.assign({},Gt):Gt}const wt=this.points[Y[Q+xe]].properties,Nt=this.options.map(wt);return ot&&Nt===wt?Object.assign({},Nt):Nt}}function Ut(At,Y,Q){return{type:"Feature",id:At[Y+xe],properties:Zt(At,Y,Q),geometry:{type:"Point",coordinates:[(ot=At[Y],360*(ot-.5)),re(At[Y+1])]}};var ot}function Zt(At,Y,Q){const ot=At[Y+it],wt=ot>=1e4?`${Math.round(ot/1e3)}k`:ot>=1e3?Math.round(ot/100)/10+"k":ot,Nt=At[Y+Tt],Gt=Nt===-1?{}:Object.assign({},Q[Nt]);return Object.assign(Gt,{cluster:!0,cluster_id:At[Y+xe],point_count:ot,point_count_abbreviated:wt})}function Kt(At){return At/360+.5}function ne(At){const Y=Math.sin(At*Math.PI/180),Q=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return Q<0?0:Q>1?1:Q}function re(At){const Y=(180-360*At)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function Se(At,Y,Q,ot){for(var wt,Nt=ot,Gt=Q-Y>>1,Ht=Q-Y,Ct=At[Y],Jt=At[Y+1],ye=At[Q],fe=At[Q+1],ce=Y+3;ce<Q;ce+=3){var He=Be(At[ce],At[ce+1],Ct,Jt,ye,fe);if(He>Nt)wt=ce,Nt=He;else if(He===Nt){var Ze=Math.abs(ce-Gt);Ze<Ht&&(wt=ce,Ht=Ze)}}Nt>ot&&(wt-Y>3&&Se(At,Y,wt,ot),At[wt+2]=Nt,Q-wt>3&&Se(At,wt,Q,ot))}function Be(At,Y,Q,ot,wt,Nt){var Gt=wt-Q,Ht=Nt-ot;if(Gt!==0||Ht!==0){var Ct=((At-Q)*Gt+(Y-ot)*Ht)/(Gt*Gt+Ht*Ht);Ct>1?(Q=wt,ot=Nt):Ct>0&&(Q+=Gt*Ct,ot+=Ht*Ct)}return(Gt=At-Q)*Gt+(Ht=Y-ot)*Ht}function ze(At,Y,Q,ot){var wt={id:At===void 0?null:At,type:Y,geometry:Q,tags:ot,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Nt){var Gt=Nt.geometry,Ht=Nt.type;if(Ht==="Point"||Ht==="MultiPoint"||Ht==="LineString")Ve(Nt,Gt);else if(Ht==="Polygon"||Ht==="MultiLineString")for(var Ct=0;Ct<Gt.length;Ct++)Ve(Nt,Gt[Ct]);else if(Ht==="MultiPolygon")for(Ct=0;Ct<Gt.length;Ct++)for(var Jt=0;Jt<Gt[Ct].length;Jt++)Ve(Nt,Gt[Ct][Jt])}(wt),wt}function Ve(At,Y){for(var Q=0;Q<Y.length;Q+=3)At.minX=Math.min(At.minX,Y[Q]),At.minY=Math.min(At.minY,Y[Q+1]),At.maxX=Math.max(At.maxX,Y[Q]),At.maxY=Math.max(At.maxY,Y[Q+1])}function Xe(At,Y,Q,ot){if(Y.geometry){var wt=Y.geometry.coordinates,Nt=Y.geometry.type,Gt=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2),Ht=[],Ct=Y.id;if(Q.promoteId?Ct=Y.properties[Q.promoteId]:Q.generateId&&(Ct=ot||0),Nt==="Point")ge(wt,Ht);else if(Nt==="MultiPoint")for(var Jt=0;Jt<wt.length;Jt++)ge(wt[Jt],Ht);else if(Nt==="LineString")Bt(wt,Ht,Gt,!1);else if(Nt==="MultiLineString"){if(Q.lineMetrics){for(Jt=0;Jt<wt.length;Jt++)Bt(wt[Jt],Ht=[],Gt,!1),At.push(ze(Ct,"LineString",Ht,Y.properties));return}Xt(wt,Ht,Gt,!1)}else if(Nt==="Polygon")Xt(wt,Ht,Gt,!0);else{if(Nt!=="MultiPolygon"){if(Nt==="GeometryCollection"){for(Jt=0;Jt<Y.geometry.geometries.length;Jt++)Xe(At,{id:Ct,geometry:Y.geometry.geometries[Jt],properties:Y.properties},Q,ot);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Jt=0;Jt<wt.length;Jt++){var ye=[];Xt(wt[Jt],ye,Gt,!0),Ht.push(ye)}}At.push(ze(Ct,Nt,Ht,Y.properties))}}function ge(At,Y){Y.push(ir(At[0])),Y.push(Ie(At[1])),Y.push(0)}function Bt(At,Y,Q,ot){for(var wt,Nt,Gt=0,Ht=0;Ht<At.length;Ht++){var Ct=ir(At[Ht][0]),Jt=Ie(At[Ht][1]);Y.push(Ct),Y.push(Jt),Y.push(0),Ht>0&&(Gt+=ot?(wt*Jt-Ct*Nt)/2:Math.sqrt(Math.pow(Ct-wt,2)+Math.pow(Jt-Nt,2))),wt=Ct,Nt=Jt}var ye=Y.length-3;Y[2]=1,Se(Y,0,ye,Q),Y[ye+2]=1,Y.size=Math.abs(Gt),Y.start=0,Y.end=Y.size}function Xt(At,Y,Q,ot){for(var wt=0;wt<At.length;wt++){var Nt=[];Bt(At[wt],Nt,Q,ot),Y.push(Nt)}}function ir(At){return At/360+.5}function Ie(At){var Y=Math.sin(At*Math.PI/180),Q=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return Q<0?0:Q>1?1:Q}function ve(At,Y,Q,ot,wt,Nt,Gt,Ht){if(ot/=Y,Nt>=(Q/=Y)&&Gt<ot)return At;if(Gt<Q||Nt>=ot)return null;for(var Ct=[],Jt=0;Jt<At.length;Jt++){var ye=At[Jt],fe=ye.geometry,ce=ye.type,He=wt===0?ye.minX:ye.minY,Ze=wt===0?ye.maxX:ye.maxY;if(He>=Q&&Ze<ot)Ct.push(ye);else if(!(Ze<Q||He>=ot)){var xr=[];if(ce==="Point"||ce==="MultiPoint")Ce(fe,xr,Q,ot,wt);else if(ce==="LineString")qe(fe,xr,Q,ot,wt,!1,Ht.lineMetrics);else if(ce==="MultiLineString")Er(fe,xr,Q,ot,wt,!1);else if(ce==="Polygon")Er(fe,xr,Q,ot,wt,!0);else if(ce==="MultiPolygon")for(var sr=0;sr<fe.length;sr++){var Cr=[];Er(fe[sr],Cr,Q,ot,wt,!0),Cr.length&&xr.push(Cr)}if(xr.length){if(Ht.lineMetrics&&ce==="LineString"){for(sr=0;sr<xr.length;sr++)Ct.push(ze(ye.id,ce,xr[sr],ye.tags));continue}ce!=="LineString"&&ce!=="MultiLineString"||(xr.length===1?(ce="LineString",xr=xr[0]):ce="MultiLineString"),ce!=="Point"&&ce!=="MultiPoint"||(ce=xr.length===3?"Point":"MultiPoint"),Ct.push(ze(ye.id,ce,xr,ye.tags))}}}return Ct.length?Ct:null}function Ce(At,Y,Q,ot,wt){for(var Nt=0;Nt<At.length;Nt+=3){var Gt=At[Nt+wt];Gt>=Q&&Gt<=ot&&(Y.push(At[Nt]),Y.push(At[Nt+1]),Y.push(At[Nt+2]))}}function qe(At,Y,Q,ot,wt,Nt,Gt){for(var Ht,Ct,Jt=lr(At),ye=wt===0?Mr:Wr,fe=At.start,ce=0;ce<At.length-3;ce+=3){var He=At[ce],Ze=At[ce+1],xr=At[ce+2],sr=At[ce+3],Cr=At[ce+4],zr=wt===0?He:Ze,$r=wt===0?sr:Cr,li=!1;Gt&&(Ht=Math.sqrt(Math.pow(He-sr,2)+Math.pow(Ze-Cr,2))),zr<Q?$r>Q&&(Ct=ye(Jt,He,Ze,sr,Cr,Q),Gt&&(Jt.start=fe+Ht*Ct)):zr>ot?$r<ot&&(Ct=ye(Jt,He,Ze,sr,Cr,ot),Gt&&(Jt.start=fe+Ht*Ct)):Ir(Jt,He,Ze,xr),$r<Q&&zr>=Q&&(Ct=ye(Jt,He,Ze,sr,Cr,Q),li=!0),$r>ot&&zr<=ot&&(Ct=ye(Jt,He,Ze,sr,Cr,ot),li=!0),!Nt&&li&&(Gt&&(Jt.end=fe+Ht*Ct),Y.push(Jt),Jt=lr(At)),Gt&&(fe+=Ht)}var ur=At.length-3;He=At[ur],Ze=At[ur+1],xr=At[ur+2],(zr=wt===0?He:Ze)>=Q&&zr<=ot&&Ir(Jt,He,Ze,xr),ur=Jt.length-3,Nt&&ur>=3&&(Jt[ur]!==Jt[0]||Jt[ur+1]!==Jt[1])&&Ir(Jt,Jt[0],Jt[1],Jt[2]),Jt.length&&Y.push(Jt)}function lr(At){var Y=[];return Y.size=At.size,Y.start=At.start,Y.end=At.end,Y}function Er(At,Y,Q,ot,wt,Nt){for(var Gt=0;Gt<At.length;Gt++)qe(At[Gt],Y,Q,ot,wt,Nt,!1)}function Ir(At,Y,Q,ot){At.push(Y),At.push(Q),At.push(ot)}function Mr(At,Y,Q,ot,wt,Nt){var Gt=(Nt-Y)/(ot-Y);return At.push(Nt),At.push(Q+(wt-Q)*Gt),At.push(1),Gt}function Wr(At,Y,Q,ot,wt,Nt){var Gt=(Nt-Q)/(wt-Q);return At.push(Y+(ot-Y)*Gt),At.push(Nt),At.push(1),Gt}function Jr(At,Y){for(var Q=[],ot=0;ot<At.length;ot++){var wt,Nt=At[ot],Gt=Nt.type;if(Gt==="Point"||Gt==="MultiPoint"||Gt==="LineString")wt=de(Nt.geometry,Y);else if(Gt==="MultiLineString"||Gt==="Polygon"){wt=[];for(var Ht=0;Ht<Nt.geometry.length;Ht++)wt.push(de(Nt.geometry[Ht],Y))}else if(Gt==="MultiPolygon")for(wt=[],Ht=0;Ht<Nt.geometry.length;Ht++){for(var Ct=[],Jt=0;Jt<Nt.geometry[Ht].length;Jt++)Ct.push(de(Nt.geometry[Ht][Jt],Y));wt.push(Ct)}Q.push(ze(Nt.id,Gt,wt,Nt.tags))}return Q}function de(At,Y){var Q=[];Q.size=At.size,At.start!==void 0&&(Q.start=At.start,Q.end=At.end);for(var ot=0;ot<At.length;ot+=3)Q.push(At[ot]+Y,At[ot+1],At[ot+2]);return Q}function Tr(At,Y){if(At.transformed)return At;var Q,ot,wt,Nt=1<<At.z,Gt=At.x,Ht=At.y;for(Q=0;Q<At.features.length;Q++){var Ct=At.features[Q],Jt=Ct.geometry,ye=Ct.type;if(Ct.geometry=[],ye===1)for(ot=0;ot<Jt.length;ot+=2)Ct.geometry.push(Re(Jt[ot],Jt[ot+1],Y,Nt,Gt,Ht));else for(ot=0;ot<Jt.length;ot++){var fe=[];for(wt=0;wt<Jt[ot].length;wt+=2)fe.push(Re(Jt[ot][wt],Jt[ot][wt+1],Y,Nt,Gt,Ht));Ct.geometry.push(fe)}}return At.transformed=!0,At}function Re(At,Y,Q,ot,wt,Nt){return[Math.round(Q*(At*ot-wt)),Math.round(Q*(Y*ot-Nt))]}function Hi(At,Y,Q,ot,wt){for(var Nt=Y===wt.maxZoom?0:wt.tolerance/((1<<Y)*wt.extent),Gt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Q,y:ot,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ht=0;Ht<At.length;Ht++){Gt.numFeatures++,Pr(Gt,At[Ht],Nt,wt);var Ct=At[Ht].minX,Jt=At[Ht].minY,ye=At[Ht].maxX,fe=At[Ht].maxY;Ct<Gt.minX&&(Gt.minX=Ct),Jt<Gt.minY&&(Gt.minY=Jt),ye>Gt.maxX&&(Gt.maxX=ye),fe>Gt.maxY&&(Gt.maxY=fe)}return Gt}function Pr(At,Y,Q,ot){var wt=Y.geometry,Nt=Y.type,Gt=[];if(Nt==="Point"||Nt==="MultiPoint")for(var Ht=0;Ht<wt.length;Ht+=3)Gt.push(wt[Ht]),Gt.push(wt[Ht+1]),At.numPoints++,At.numSimplified++;else if(Nt==="LineString")Pe(Gt,wt,At,Q,!1,!1);else if(Nt==="MultiLineString"||Nt==="Polygon")for(Ht=0;Ht<wt.length;Ht++)Pe(Gt,wt[Ht],At,Q,Nt==="Polygon",Ht===0);else if(Nt==="MultiPolygon")for(var Ct=0;Ct<wt.length;Ct++){var Jt=wt[Ct];for(Ht=0;Ht<Jt.length;Ht++)Pe(Gt,Jt[Ht],At,Q,!0,Ht===0)}if(Gt.length){var ye=Y.tags||null;if(Nt==="LineString"&&ot.lineMetrics){for(var fe in ye={},Y.tags)ye[fe]=Y.tags[fe];ye.mapbox_clip_start=wt.start/wt.size,ye.mapbox_clip_end=wt.end/wt.size}var ce={geometry:Gt,type:Nt==="Polygon"||Nt==="MultiPolygon"?3:Nt==="LineString"||Nt==="MultiLineString"?2:1,tags:ye};Y.id!==null&&(ce.id=Y.id),At.features.push(ce)}}function Pe(At,Y,Q,ot,wt,Nt){var Gt=ot*ot;if(ot>0&&Y.size<(wt?Gt:ot))Q.numPoints+=Y.length/3;else{for(var Ht=[],Ct=0;Ct<Y.length;Ct+=3)(ot===0||Y[Ct+2]>Gt)&&(Q.numSimplified++,Ht.push(Y[Ct]),Ht.push(Y[Ct+1])),Q.numPoints++;wt&&function(Jt,ye){for(var fe=0,ce=0,He=Jt.length,Ze=He-2;ce<He;Ze=ce,ce+=2)fe+=(Jt[ce]-Jt[Ze])*(Jt[ce+1]+Jt[Ze+1]);if(fe>0===ye)for(ce=0,He=Jt.length;ce<He/2;ce+=2){var xr=Jt[ce],sr=Jt[ce+1];Jt[ce]=Jt[He-2-ce],Jt[ce+1]=Jt[He-1-ce],Jt[He-2-ce]=xr,Jt[He-1-ce]=sr}}(Ht,Nt),At.push(Ht)}}function Ye(At,Y){var Q=(Y=this.options=function(wt,Nt){for(var Gt in Nt)wt[Gt]=Nt[Gt];return wt}(Object.create(this.options),Y)).debug;if(Q&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");var ot=function(wt,Nt){var Gt=[];if(wt.type==="FeatureCollection")for(var Ht=0;Ht<wt.features.length;Ht++)Xe(Gt,wt.features[Ht],Nt,Ht);else Xe(Gt,wt.type==="Feature"?wt:{geometry:wt},Nt);return Gt}(At,Y);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ot=function(wt,Nt){var Gt=Nt.buffer/Nt.extent,Ht=wt,Ct=ve(wt,1,-1-Gt,Gt,0,-1,2,Nt),Jt=ve(wt,1,1-Gt,2+Gt,0,-1,2,Nt);return(Ct||Jt)&&(Ht=ve(wt,1,-Gt,1+Gt,0,-1,2,Nt)||[],Ct&&(Ht=Jr(Ct,1).concat(Ht)),Jt&&(Ht=Ht.concat(Jr(Jt,-1)))),Ht}(ot,Y),ot.length&&this.splitTile(ot,0,0,0),Q&&(ot.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function tr(At,Y,Q){return 32*((1<<At)*Q+Y)+At}function fi(At,Y){return Y?At.properties[Y]:At.id}function Fr(At,Y){if(At==null)return!0;if(At.type==="Feature")return fi(At,Y)!=null;if(At.type==="FeatureCollection"){const Q=new Set;for(const ot of At.features){const wt=fi(ot,Y);if(wt==null||Q.has(wt))return!1;Q.add(wt)}return!0}return!1}function wr(At,Y){const Q=new Map;if(At!=null)if(At.type==="Feature")Q.set(fi(At,Y),At);else for(const ot of At.features)Q.set(fi(ot,Y),ot);return Q}Ye.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ye.prototype.splitTile=function(At,Y,Q,ot,wt,Nt,Gt){for(var Ht=[At,Y,Q,ot],Ct=this.options,Jt=Ct.debug;Ht.length;){ot=Ht.pop(),Q=Ht.pop(),Y=Ht.pop(),At=Ht.pop();var ye=1<<Y,fe=tr(Y,Q,ot),ce=this.tiles[fe];if(!ce&&(Jt>1&&console.time("creation"),ce=this.tiles[fe]=Hi(At,Y,Q,ot,Ct),this.tileCoords.push({z:Y,x:Q,y:ot}),Jt)){Jt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,Q,ot,ce.numFeatures,ce.numPoints,ce.numSimplified),console.timeEnd("creation"));var He="z"+Y;this.stats[He]=(this.stats[He]||0)+1,this.total++}if(ce.source=At,wt){if(Y===Ct.maxZoom||Y===wt)continue;var Ze=1<<wt-Y;if(Q!==Math.floor(Nt/Ze)||ot!==Math.floor(Gt/Ze))continue}else if(Y===Ct.indexMaxZoom||ce.numPoints<=Ct.indexMaxPoints)continue;if(ce.source=null,At.length!==0){Jt>1&&console.time("clipping");var xr,sr,Cr,zr,$r,li,ur=.5*Ct.buffer/Ct.extent,Gr=.5-ur,pi=.5+ur,Ri=1+ur;xr=sr=Cr=zr=null,$r=ve(At,ye,Q-ur,Q+pi,0,ce.minX,ce.maxX,Ct),li=ve(At,ye,Q+Gr,Q+Ri,0,ce.minX,ce.maxX,Ct),At=null,$r&&(xr=ve($r,ye,ot-ur,ot+pi,1,ce.minY,ce.maxY,Ct),sr=ve($r,ye,ot+Gr,ot+Ri,1,ce.minY,ce.maxY,Ct),$r=null),li&&(Cr=ve(li,ye,ot-ur,ot+pi,1,ce.minY,ce.maxY,Ct),zr=ve(li,ye,ot+Gr,ot+Ri,1,ce.minY,ce.maxY,Ct),li=null),Jt>1&&console.timeEnd("clipping"),Ht.push(xr||[],Y+1,2*Q,2*ot),Ht.push(sr||[],Y+1,2*Q,2*ot+1),Ht.push(Cr||[],Y+1,2*Q+1,2*ot),Ht.push(zr||[],Y+1,2*Q+1,2*ot+1)}}},Ye.prototype.getTile=function(At,Y,Q){var ot=this.options,wt=ot.extent,Nt=ot.debug;if(At<0||At>24)return null;var Gt=1<<At,Ht=tr(At,Y=(Y%Gt+Gt)%Gt,Q);if(this.tiles[Ht])return Tr(this.tiles[Ht],wt);Nt>1&&console.log("drilling down to z%d-%d-%d",At,Y,Q);for(var Ct,Jt=At,ye=Y,fe=Q;!Ct&&Jt>0;)Jt--,ye=Math.floor(ye/2),fe=Math.floor(fe/2),Ct=this.tiles[tr(Jt,ye,fe)];return Ct&&Ct.source?(Nt>1&&console.log("found parent tile z%d-%d-%d",Jt,ye,fe),Nt>1&&console.time("drilling down"),this.splitTile(Ct.source,Jt,ye,fe,At,Y,Q),Nt>1&&console.timeEnd("drilling down"),this.tiles[Ht]?Tr(this.tiles[Ht],wt):null):null};class bi extends A{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Y,Q){return a._(this,void 0,void 0,function*(){const ot=Y.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const wt=this._geoJSONIndex.getTile(ot.z,ot.x,ot.y);if(!wt)return null;const Nt=new class{constructor(Ht){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.W,this.length=Ht.length,this._features=Ht}feature(Ht){return new class{constructor(Ct){this._feature=Ct,this.extent=a.W,this.type=Ct.type,this.properties=Ct.tags,"id"in Ct&&!isNaN(Ct.id)&&(this.id=parseInt(Ct.id,10))}loadGeometry(){if(this._feature.type===1){const Ct=[];for(const Jt of this._feature.geometry)Ct.push([new a.P(Jt[0],Jt[1])]);return Ct}{const Ct=[];for(const Jt of this._feature.geometry){const ye=[];for(const fe of Jt)ye.push(new a.P(fe[0],fe[1]));Ct.push(ye)}return Ct}}toGeoJSON(Ct,Jt,ye){return Z.call(this,Ct,Jt,ye)}}(this._features[Ht])}}(wt.features);let Gt=he(Nt);return Gt.byteOffset===0&&Gt.byteLength===Gt.buffer.byteLength||(Gt=new Uint8Array(Gt)),{vectorTile:Nt,rawData:Gt.buffer}})}loadData(Y){return a._(this,void 0,void 0,function*(){var Q;(Q=this._pendingRequest)===null||Q===void 0||Q.abort();const ot=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new a.bs(Y.request);this._pendingRequest=new AbortController;try{let wt=yield this.loadGeoJSON(Y,this._pendingRequest);if(delete this._pendingRequest,typeof wt!="object")throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`);if(F(wt,!0),Y.filter){const Gt=a.by(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Gt.result==="error")throw new Error(Gt.value.map(Ht=>`${Ht.key}: ${Ht.message}`).join(", "));wt={type:"FeatureCollection",features:wt.features.filter(Ht=>Gt.value.evaluate({zoom:0},Ht))}}this._geoJSONIndex=Y.cluster?new Lt(function(Gt){let{superclusterOptions:Ht,clusterProperties:Ct}=Gt;if(!Ct||!Ht)return Ht;const Jt={},ye={},fe={accumulated:null,zoom:0},ce={properties:null},He=Object.keys(Ct);for(const Ze of He){const[xr,sr]=Ct[Ze],Cr=a.by(sr),zr=a.by(typeof xr=="string"?[xr,["accumulated"],["get",Ze]]:xr);Jt[Ze]=Cr.value,ye[Ze]=zr.value}return Ht.map=Ze=>{ce.properties=Ze;const xr={};for(const sr of He)xr[sr]=Jt[sr].evaluate(fe,ce);return xr},Ht.reduce=(Ze,xr)=>{ce.properties=xr;for(const sr of He)fe.accumulated=Ze[sr],Ze[sr]=ye[sr].evaluate(fe,ce)},Ht}(Y)).load(wt.features):function(Gt,Ht){return new Ye(Gt,Ht)}(wt,Y.geojsonVtOptions),this.loaded={};const Nt={};if(ot){const Gt=ot.finish();Gt&&(Nt.resourceTiming={},Nt.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Gt)))}return Nt}catch(wt){if(delete this._pendingRequest,a.bz(wt))return{abandoned:!0};throw wt}})}reloadTile(Y){const Q=this.loaded;return Q&&Q[Y.uid]?super.reloadTile(Y):this.loadTile(Y)}loadGeoJSON(Y,Q){return a._(this,void 0,void 0,function*(){const{promoteId:ot}=Y;if(Y.request){const wt=yield a.h(Y.request,Q);return this._dataUpdateable=Fr(wt.data,ot)?wr(wt.data,ot):void 0,wt.data}if(typeof Y.data=="string")try{const wt=JSON.parse(Y.data);return this._dataUpdateable=Fr(wt,ot)?wr(wt,ot):void 0,wt}catch{throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`)}if(!Y.dataDiff)throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Y.source}`);return function(wt,Nt,Gt){var Ht,Ct,Jt,ye;if(Nt.removeAll&&wt.clear(),Nt.remove)for(const fe of Nt.remove)wt.delete(fe);if(Nt.add)for(const fe of Nt.add){const ce=fi(fe,Gt);ce!=null&&wt.set(ce,fe)}if(Nt.update)for(const fe of Nt.update){let ce=wt.get(fe.id);if(ce==null)continue;const He=!fe.removeAllProperties&&(((Ht=fe.removeProperties)===null||Ht===void 0?void 0:Ht.length)>0||((Ct=fe.addOrUpdateProperties)===null||Ct===void 0?void 0:Ct.length)>0);if((fe.newGeometry||fe.removeAllProperties||He)&&(ce=Object.assign({},ce),wt.set(fe.id,ce),He&&(ce.properties=Object.assign({},ce.properties))),fe.newGeometry&&(ce.geometry=fe.newGeometry),fe.removeAllProperties)ce.properties={};else if(((Jt=fe.removeProperties)===null||Jt===void 0?void 0:Jt.length)>0)for(const Ze of fe.removeProperties)Object.prototype.hasOwnProperty.call(ce.properties,Ze)&&delete ce.properties[Ze];if(((ye=fe.addOrUpdateProperties)===null||ye===void 0?void 0:ye.length)>0)for(const{key:Ze,value:xr}of fe.addOrUpdateProperties)ce.properties[Ze]=xr}}(this._dataUpdateable,Y.dataDiff,ot),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Y){return a._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Y){return this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId)}getClusterChildren(Y){return this._geoJSONIndex.getChildren(Y.clusterId)}getClusterLeaves(Y){return this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset)}}class ai{constructor(Y){this.self=Y,this.actor=new a.C(Y),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Q,ot)=>{if(this.externalWorkerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.externalWorkerSourceTypes[Q]=ot},this.self.addProtocol=a.bf,this.self.removeProtocol=a.bg,this.self.registerRTLTextPlugin=Q=>{if(a.bA.isParsed())throw new Error("RTL text plugin already registered.");a.bA.setMethods(Q)},this.actor.registerMessageHandler("LDT",(Q,ot)=>this._getDEMWorkerSource(Q,ot.source).loadTile(ot)),this.actor.registerMessageHandler("RDT",(Q,ot)=>a._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Q,ot.source).removeTile(ot)})),this.actor.registerMessageHandler("GCEZ",(Q,ot)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,ot.type,ot.source).getClusterExpansionZoom(ot)})),this.actor.registerMessageHandler("GCC",(Q,ot)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,ot.type,ot.source).getClusterChildren(ot)})),this.actor.registerMessageHandler("GCL",(Q,ot)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,ot.type,ot.source).getClusterLeaves(ot)})),this.actor.registerMessageHandler("LD",(Q,ot)=>this._getWorkerSource(Q,ot.type,ot.source).loadData(ot)),this.actor.registerMessageHandler("LT",(Q,ot)=>this._getWorkerSource(Q,ot.type,ot.source).loadTile(ot)),this.actor.registerMessageHandler("RT",(Q,ot)=>this._getWorkerSource(Q,ot.type,ot.source).reloadTile(ot)),this.actor.registerMessageHandler("AT",(Q,ot)=>this._getWorkerSource(Q,ot.type,ot.source).abortTile(ot)),this.actor.registerMessageHandler("RMT",(Q,ot)=>this._getWorkerSource(Q,ot.type,ot.source).removeTile(ot)),this.actor.registerMessageHandler("RS",(Q,ot)=>a._(this,void 0,void 0,function*(){if(!this.workerSources[Q]||!this.workerSources[Q][ot.type]||!this.workerSources[Q][ot.type][ot.source])return;const wt=this.workerSources[Q][ot.type][ot.source];delete this.workerSources[Q][ot.type][ot.source],wt.removeSource!==void 0&&wt.removeSource(ot)})),this.actor.registerMessageHandler("RM",Q=>a._(this,void 0,void 0,function*(){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.workerSources[Q],delete this.demWorkerSources[Q]})),this.actor.registerMessageHandler("SR",(Q,ot)=>a._(this,void 0,void 0,function*(){this.referrer=ot})),this.actor.registerMessageHandler("SRPS",(Q,ot)=>this._syncRTLPluginState(Q,ot)),this.actor.registerMessageHandler("IS",(Q,ot)=>a._(this,void 0,void 0,function*(){this.self.importScripts(ot)})),this.actor.registerMessageHandler("SI",(Q,ot)=>this._setImages(Q,ot)),this.actor.registerMessageHandler("UL",(Q,ot)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(Q).update(ot.layers,ot.removedIds)})),this.actor.registerMessageHandler("SL",(Q,ot)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(Q).replace(ot)}))}_setImages(Y,Q){return a._(this,void 0,void 0,function*(){this.availableImages[Y]=Q;for(const ot in this.workerSources[Y]){const wt=this.workerSources[Y][ot];for(const Nt in wt)wt[Nt].availableImages=Q}})}_syncRTLPluginState(Y,Q){return a._(this,void 0,void 0,function*(){if(a.bA.isParsed())return a.bA.getState();if(Q.pluginStatus!=="loading")return a.bA.setState(Q),Q;const ot=Q.pluginURL;if(this.self.importScripts(ot),a.bA.isParsed()){const wt={pluginStatus:"loaded",pluginURL:ot};return a.bA.setState(wt),wt}throw a.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ot}`)})}_getAvailableImages(Y){let Q=this.availableImages[Y];return Q||(Q=[]),Q}_getLayerIndex(Y){let Q=this.layerIndexes[Y];return Q||(Q=this.layerIndexes[Y]=new o),Q}_getWorkerSource(Y,Q,ot){if(this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][Q]||(this.workerSources[Y][Q]={}),!this.workerSources[Y][Q][ot]){const wt={sendAsync:(Nt,Gt)=>(Nt.targetMapId=Y,this.actor.sendAsync(Nt,Gt))};switch(Q){case"vector":this.workerSources[Y][Q][ot]=new A(wt,this._getLayerIndex(Y),this._getAvailableImages(Y));break;case"geojson":this.workerSources[Y][Q][ot]=new bi(wt,this._getLayerIndex(Y),this._getAvailableImages(Y));break;default:this.workerSources[Y][Q][ot]=new this.externalWorkerSourceTypes[Q](wt,this._getLayerIndex(Y),this._getAvailableImages(Y))}}return this.workerSources[Y][Q][ot]}_getDEMWorkerSource(Y,Q){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][Q]||(this.demWorkerSources[Y][Q]=new P),this.demWorkerSources[Y][Q]}}return a.i(self)&&(self.worker=new ai(self)),ai}),n("index",["exports","./shared"],function(a,o){var f="4.1.3";let m,w;const A={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:x=>new Promise((c,d)=>{const y=requestAnimationFrame(c);x.signal.addEventListener("abort",()=>{cancelAnimationFrame(y),d(o.c())})}),getImageData(x){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(x).getImageData(-c,-c,x.width+2*c,x.height+2*c)},getImageCanvasContext(x){const c=window.document.createElement("canvas"),d=c.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return c.width=x.width,c.height=x.height,d.drawImage(x,0,0,x.width,x.height),d},resolveURL:x=>(m||(m=document.createElement("a")),m.href=x,m.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(w==null&&(w=matchMedia("(prefers-reduced-motion: reduce)")),w.matches)}};class P{static testProp(c){if(!P.docStyle)return c[0];for(let d=0;d<c.length;d++)if(c[d]in P.docStyle)return c[d];return c[0]}static create(c,d,y){const _=window.document.createElement(c);return d!==void 0&&(_.className=d),y&&y.appendChild(_),_}static createNS(c,d){return window.document.createElementNS(c,d)}static disableDrag(){P.docStyle&&P.selectProp&&(P.userSelect=P.docStyle[P.selectProp],P.docStyle[P.selectProp]="none")}static enableDrag(){P.docStyle&&P.selectProp&&(P.docStyle[P.selectProp]=P.userSelect)}static setTransform(c,d){c.style[P.transformProp]=d}static addEventListener(c,d,y){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};c.addEventListener(d,y,"passive"in _?_:_.capture)}static removeEventListener(c,d,y){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};c.removeEventListener(d,y,"passive"in _?_:_.capture)}static suppressClickInternal(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",P.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",P.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",P.suppressClickInternal,!0)},0)}static getScale(c){const d=c.getBoundingClientRect();return{x:d.width/c.offsetWidth||1,y:d.height/c.offsetHeight||1,boundingClientRect:d}}static getPoint(c,d,y){const _=d.boundingClientRect;return new o.P((y.clientX-_.left)/d.x-c.clientLeft,(y.clientY-_.top)/d.y-c.clientTop)}static mousePos(c,d){const y=P.getScale(c);return P.getPoint(c,y,d)}static touchPos(c,d){const y=[],_=P.getScale(c);for(let S=0;S<d.length;S++)y.push(P.getPoint(c,_,d[S]));return y}static mouseButton(c){return c.button}static remove(c){c.parentNode&&c.parentNode.removeChild(c)}}P.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,P.selectProp=P.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),P.transformProp=P.testProp(["transform","WebkitTransform"]);const I={supported:!1,testSupport:function(x){!Z&&F&&(U?z(x):N=x)}};let N,F,Z=!1,U=!1;function z(x){const c=x.createTexture();x.bindTexture(x.TEXTURE_2D,c);try{if(x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,F),x.isContextLost())return;I.supported=!0}catch{}x.deleteTexture(c),Z=!0}var J;typeof document<"u"&&(F=document.createElement("img"),F.onload=function(){N&&z(N),N=null,U=!0},F.onerror=function(){Z=!0,N=null},F.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(x){let c,d,y,_;x.resetRequestQueue=()=>{c=[],d=0,y=0,_={}},x.addThrottleControl=g=>{const b=y++;return _[b]=g,b},x.removeThrottleControl=g=>{delete _[g],B()},x.getImage=function(g,b){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((M,O)=>{I.supported&&(g.headers||(g.headers={}),g.headers.accept="image/webp,*/*"),o.e(g,{type:"image"}),c.push({abortController:b,requestParameters:g,supportImageRefresh:C,state:"queued",onError:j=>{O(j)},onSuccess:j=>{M(j)}}),B()})};const S=g=>o._(this,void 0,void 0,function*(){g.state="running";const{requestParameters:b,supportImageRefresh:C,onError:M,onSuccess:O,abortController:j}=g,G=C===!1&&!o.i(self)&&!o.g(b.url)&&(!b.headers||Object.keys(b.headers).reduce((X,ct)=>X&&ct==="accept",!0));d++;const H=G?k(b,j):o.m(b,j);try{const X=yield H;delete g.abortController,g.state="completed",X.data instanceof HTMLImageElement||o.b(X.data)?O(X):X.data&&O({data:yield(q=X.data,typeof createImageBitmap=="function"?o.d(q):o.f(q)),cacheControl:X.cacheControl,expires:X.expires})}catch(X){delete g.abortController,M(X)}finally{d--,B()}var q}),B=()=>{const g=(()=>{for(const b of Object.keys(_))if(_[b]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let b=d;b<g&&c.length>0;b++){const C=c.shift();C.abortController.signal.aborted?b--:S(C)}},k=(g,b)=>new Promise((C,M)=>{const O=new Image,j=g.url,G=g.credentials;G&&G==="include"?O.crossOrigin="use-credentials":(G&&G==="same-origin"||!o.s(j))&&(O.crossOrigin="anonymous"),b.signal.addEventListener("abort",()=>{O.src="",M(o.c())}),O.fetchPriority="high",O.onload=()=>{O.onerror=O.onload=null,C({data:O})},O.onerror=()=>{O.onerror=O.onload=null,b.signal.aborted||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},O.src=j})}(J||(J={})),J.resetRequestQueue();class nt{constructor(c){this._transformRequestFn=c}transformRequest(c,d){return this._transformRequestFn&&this._transformRequestFn(c,d)||{url:c}}normalizeSpriteURL(c,d,y){const _=function(S){const B=S.match(mt);if(!B)throw new Error(`Unable to parse URL "${S}"`);return{protocol:B[1],authority:B[2],path:B[3]||"/",params:B[4]?B[4].split("&"):[]}}(c);return _.path+=`${d}${y}`,function(S){const B=S.params.length?`?${S.params.join("&")}`:"";return`${S.protocol}://${S.authority}${S.path}${B}`}(_)}setTransformRequest(c){this._transformRequestFn=c}}const mt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Et(x){var c=new o.A(3);return c[0]=x[0],c[1]=x[1],c[2]=x[2],c}var bt,pt=function(x,c,d){return x[0]=c[0]-d[0],x[1]=c[1]-d[1],x[2]=c[2]-d[2],x};bt=new o.A(3),o.A!=Float32Array&&(bt[0]=0,bt[1]=0,bt[2]=0);var zt=function(x){var c=x[0],d=x[1];return c*c+d*d};function Rt(x){const c=[];if(typeof x=="string")c.push({id:"default",url:x});else if(x&&x.length>0){const d=[];for(const{id:y,url:_}of x){const S=`${y}${_}`;d.indexOf(S)===-1&&(d.push(S),c.push({id:y,url:_}))}}return c}(function(){var x=new o.A(2);o.A!=Float32Array&&(x[0]=0,x[1]=0)})();class at{constructor(c,d,y,_){this.context=c,this.format=y,this.texture=c.gl.createTexture(),this.update(d,_)}update(c,d,y){const{width:_,height:S}=c,B=!(this.size&&this.size[0]===_&&this.size[1]===S||y),{context:k}=this,{gl:g}=k;if(this.useMipmap=!!(d&&d.useMipmap),g.bindTexture(g.TEXTURE_2D,this.texture),k.pixelStoreUnpackFlipY.set(!1),k.pixelStoreUnpack.set(1),k.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!d||d.premultiply!==!1)),B)this.size=[_,S],c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||o.b(c)?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,c):g.texImage2D(g.TEXTURE_2D,0,this.format,_,S,0,this.format,g.UNSIGNED_BYTE,c.data);else{const{x:b,y:C}=y||{x:0,y:0};c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||o.b(c)?g.texSubImage2D(g.TEXTURE_2D,0,b,C,g.RGBA,g.UNSIGNED_BYTE,c):g.texSubImage2D(g.TEXTURE_2D,0,b,C,_,S,g.RGBA,g.UNSIGNED_BYTE,c.data)}this.useMipmap&&this.isSizePowerOfTwo()&&g.generateMipmap(g.TEXTURE_2D)}bind(c,d,y){const{context:_}=this,{gl:S}=_;S.bindTexture(S.TEXTURE_2D,this.texture),y!==S.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(y=S.LINEAR),c!==this.filter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,c),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,y||c),this.filter=c),d!==this.wrap&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,d),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}}function dt(x){const{userImage:c}=x;return!!(c&&c.render&&c.render())&&(x.data.replace(new Uint8Array(c.data.buffer)),!0)}class kt extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:d,promiseResolve:y}of this.requestors)y(this._getImagesForIds(d));this.requestors=[]}}getImage(c){const d=this.images[c];if(d&&!d.data&&d.spriteData){const y=d.spriteData;d.data=new o.R({width:y.width,height:y.height},y.context.getImageData(y.x,y.y,y.width,y.height).data),d.spriteData=null}return d}addImage(c,d){if(this.images[c])throw new Error(`Image id ${c} already exist, use updateImage instead`);this._validate(c,d)&&(this.images[c]=d)}_validate(c,d){let y=!0;const _=d.data||d.spriteData;return this._validateStretch(d.stretchX,_&&_.width)||(this.fire(new o.j(new Error(`Image "${c}" has invalid "stretchX" value`))),y=!1),this._validateStretch(d.stretchY,_&&_.height)||(this.fire(new o.j(new Error(`Image "${c}" has invalid "stretchY" value`))),y=!1),this._validateContent(d.content,d)||(this.fire(new o.j(new Error(`Image "${c}" has invalid "content" value`))),y=!1),y}_validateStretch(c,d){if(!c)return!0;let y=0;for(const _ of c){if(_[0]<y||_[1]<_[0]||d<_[1])return!1;y=_[1]}return!0}_validateContent(c,d){if(!c)return!0;if(c.length!==4)return!1;const y=d.spriteData,_=y&&y.width||d.data.width,S=y&&y.height||d.data.height;return!(c[0]<0||_<c[0]||c[1]<0||S<c[1]||c[2]<0||_<c[2]||c[3]<0||S<c[3]||c[2]<c[0]||c[3]<c[1])}updateImage(c,d){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const _=this.getImage(c);if(y&&(_.data.width!==d.data.width||_.data.height!==d.data.height))throw new Error(`size mismatch between old image (${_.data.width}x${_.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=_.version+1,this.images[c]=d,this.updatedImages[c]=!0}removeImage(c){const d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c){return new Promise((d,y)=>{let _=!0;if(!this.isLoaded())for(const S of c)this.images[S]||(_=!1);this.isLoaded()||_?d(this._getImagesForIds(c)):this.requestors.push({ids:c,promiseResolve:d})})}_getImagesForIds(c){const d={};for(const y of c){let _=this.getImage(y);_||(this.fire(new o.k("styleimagemissing",{id:y})),_=this.getImage(y)),_?d[y]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:o.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:c,height:d}=this.atlasImage;return{width:c,height:d}}getPattern(c){const d=this.patterns[c],y=this.getImage(c);if(!y)return null;if(d&&d.position.version===y.version)return d.position;if(d)d.position.version=y.version;else{const _={w:y.data.width+2,h:y.data.height+2,x:0,y:0},S=new o.I(_,y);this.patterns[c]={bin:_,position:S}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new at(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const S in this.patterns)c.push(this.patterns[S].bin);const{w:d,h:y}=o.p(c),_=this.atlasImage;_.resize({width:d||1,height:y||1});for(const S in this.patterns){const{bin:B}=this.patterns[S],k=B.x+1,g=B.y+1,b=this.getImage(S).data,C=b.width,M=b.height;o.R.copy(b,_,{x:0,y:0},{x:k,y:g},{width:C,height:M}),o.R.copy(b,_,{x:0,y:M-1},{x:k,y:g-1},{width:C,height:1}),o.R.copy(b,_,{x:0,y:0},{x:k,y:g+M},{width:C,height:1}),o.R.copy(b,_,{x:C-1,y:0},{x:k-1,y:g},{width:1,height:M}),o.R.copy(b,_,{x:0,y:0},{x:k+C,y:g},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const d of c){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const y=this.getImage(d);y||o.w(`Image with ID: "${d}" was not found`),dt(y)&&this.updateImage(d,y)}}}const xt=1e20;function ue(x,c,d,y,_,S,B,k,g){for(let b=c;b<c+y;b++)oe(x,d*S+b,S,_,B,k,g);for(let b=d;b<d+_;b++)oe(x,b*S+c,1,y,B,k,g)}function oe(x,c,d,y,_,S,B){S[0]=0,B[0]=-xt,B[1]=xt,_[0]=x[c];for(let k=1,g=0,b=0;k<y;k++){_[k]=x[c+k*d];const C=k*k;do{const M=S[g];b=(_[k]-_[M]+C-M*M)/(k-M)/2}while(b<=B[g]&&--g>-1);g++,S[g]=k,B[g]=b,B[g+1]=xt}for(let k=0,g=0;k<y;k++){for(;B[g+1]<k;)g++;const b=S[g],C=k-b;x[c+k*d]=_[b]+C*C}}class he{constructor(c,d){this.requestManager=c,this.localIdeographFontFamily=d,this.entries={}}setURL(c){this.url=c}getGlyphs(c){return o._(this,void 0,void 0,function*(){const d=[];for(const S in c)for(const B of c[S])d.push(this._getAndCacheGlyphsPromise(S,B));const y=yield Promise.all(d),_={};for(const{stack:S,id:B,glyph:k}of y)_[S]||(_[S]={}),_[S][B]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};return _})}_getAndCacheGlyphsPromise(c,d){return o._(this,void 0,void 0,function*(){let y=this.entries[c];y||(y=this.entries[c]={glyphs:{},requests:{},ranges:{}});let _=y.glyphs[d];if(_!==void 0)return{stack:c,id:d,glyph:_};if(_=this._tinySDF(y,c,d),_)return y.glyphs[d]=_,{stack:c,id:d,glyph:_};const S=Math.floor(d/256);if(256*S>65535)throw new Error("glyphs > 65535 not supported");if(y.ranges[S])return{stack:c,id:d,glyph:_};if(!this.url)throw new Error("glyphsUrl is not set");if(!y.requests[S]){const k=he.loadGlyphRange(c,S,this.url,this.requestManager);y.requests[S]=k}const B=yield y.requests[S];for(const k in B)this._doesCharSupportLocalGlyph(+k)||(y.glyphs[+k]=B[+k]);return y.ranges[S]=!0,{stack:c,id:d,glyph:B[d]||null}})}_doesCharSupportLocalGlyph(c){return!!this.localIdeographFontFamily&&(o.u["CJK Unified Ideographs"](c)||o.u["Hangul Syllables"](c)||o.u.Hiragana(c)||o.u.Katakana(c))}_tinySDF(c,d,y){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(y))return;let S=c.tinySDF;if(!S){let k="400";/bold/i.test(d)?k="900":/medium/i.test(d)?k="500":/light/i.test(d)&&(k="200"),S=c.tinySDF=new he.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:_,fontWeight:k})}const B=S.draw(String.fromCharCode(y));return{id:y,bitmap:new o.o({width:B.width||60,height:B.height||60},B.data),metrics:{width:B.glyphWidth/2||24,height:B.glyphHeight/2||24,left:B.glyphLeft/2+.5||0,top:B.glyphTop/2-27.5||-8,advance:B.glyphAdvance/2||24,isDoubleResolution:!0}}}}he.loadGlyphRange=function(x,c,d,y){return o._(this,void 0,void 0,function*(){const _=256*c,S=_+255,B=y.transformRequest(d.replace("{fontstack}",x).replace("{range}",`${_}-${S}`),"Glyphs"),k=yield o.l(B,new AbortController);if(!k||!k.data)throw new Error(`Could not load glyph range. range: ${c}, ${_}-${S}`);const g={};for(const b of o.n(k.data))g[b.id]=b;return g})},he.TinySDF=class{constructor(){let{fontSize:x=24,buffer:c=3,radius:d=8,cutoff:y=.25,fontFamily:_="sans-serif",fontWeight:S="normal",fontStyle:B="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=c,this.cutoff=y,this.radius=d;const k=this.size=x+4*c,g=this._createCanvas(k),b=this.ctx=g.getContext("2d",{willReadFrequently:!0});b.font=`${B} ${S} ${x}px ${_}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Uint16Array(k)}_createCanvas(x){const c=document.createElement("canvas");return c.width=c.height=x,c}draw(x){const{width:c,actualBoundingBoxAscent:d,actualBoundingBoxDescent:y,actualBoundingBoxLeft:_,actualBoundingBoxRight:S}=this.ctx.measureText(x),B=Math.ceil(d),k=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-_))),g=Math.min(this.size-this.buffer,B+Math.ceil(y)),b=k+2*this.buffer,C=g+2*this.buffer,M=Math.max(b*C,0),O=new Uint8ClampedArray(M),j={data:O,width:b,height:C,glyphWidth:k,glyphHeight:g,glyphTop:B,glyphLeft:0,glyphAdvance:c};if(k===0||g===0)return j;const{ctx:G,buffer:H,gridInner:q,gridOuter:X}=this;G.clearRect(H,H,k,g),G.fillText(x,H,H+B);const ct=G.getImageData(H,H,k,g);X.fill(xt,0,M),q.fill(0,0,M);for(let et=0;et<g;et++)for(let ht=0;ht<k;ht++){const ft=ct.data[4*(et*k+ht)+3]/255;if(ft===0)continue;const Mt=(et+H)*b+ht+H;if(ft===1)X[Mt]=0,q[Mt]=xt;else{const St=.5-ft;X[Mt]=St>0?St*St:0,q[Mt]=St<0?St*St:0}}ue(X,0,0,b,C,b,this.f,this.v,this.z),ue(q,H,H,k,g,b,this.f,this.v,this.z);for(let et=0;et<M;et++){const ht=Math.sqrt(X[et])-Math.sqrt(q[et]);O[et]=Math.round(255-255*(ht/this.radius+this.cutoff))}return j}};class Dt{constructor(){this.specification=o.v.light.position}possiblyEvaluate(c,d){return o.y(c.expression.evaluate(d))}interpolate(c,d,y){return{x:o.z.number(c.x,d.x,y),y:o.z.number(c.y,d.y,y),z:o.z.number(c.z,d.z,y)}}}let Qt;class ee extends o.E{constructor(c){super(),Qt=Qt||new o.q({anchor:new o.D(o.v.light.anchor),position:new Dt,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(Qt),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(o.r,c,d))for(const y in c){const _=c[y];y.endsWith("-transition")?this._transitionable.setTransition(y.slice(0,-11),_):this._transitionable.setValue(y,_)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,d,y){return(!y||y.validate!==!1)&&o.t(this,c.call(o.x,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}class xe{constructor(c,d){this.width=c,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(c,d){const y=c.join(",")+String(d);return this.dashEntry[y]||(this.dashEntry[y]=this.addDash(c,d)),this.dashEntry[y]}getDashRanges(c,d,y){const _=[];let S=c.length%2==1?-c[c.length-1]*y:0,B=c[0]*y,k=!0;_.push({left:S,right:B,isDash:k,zeroLength:c[0]===0});let g=c[0];for(let b=1;b<c.length;b++){k=!k;const C=c[b];S=g*y,g+=C,B=g*y,_.push({left:S,right:B,isDash:k,zeroLength:C===0})}return _}addRoundDash(c,d,y){const _=d/2;for(let S=-y;S<=y;S++){const B=this.width*(this.nextRow+y+S);let k=0,g=c[k];for(let b=0;b<this.width;b++){b/g.right>1&&(g=c[++k]);const C=Math.abs(b-g.left),M=Math.abs(b-g.right),O=Math.min(C,M);let j;const G=S/y*(_+1);if(g.isDash){const H=_-Math.abs(G);j=Math.sqrt(O*O+H*H)}else j=_-Math.sqrt(O*O+G*G);this.data[B+b]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(c){for(let k=c.length-1;k>=0;--k){const g=c[k],b=c[k+1];g.zeroLength?c.splice(k,1):b&&b.isDash===g.isDash&&(b.left=g.left,c.splice(k,1))}const d=c[0],y=c[c.length-1];d.isDash===y.isDash&&(d.left=y.left-this.width,y.right=d.right+this.width);const _=this.width*this.nextRow;let S=0,B=c[S];for(let k=0;k<this.width;k++){k/B.right>1&&(B=c[++S]);const g=Math.abs(k-B.left),b=Math.abs(k-B.right),C=Math.min(g,b);this.data[_+k]=Math.max(0,Math.min(255,(B.isDash?C:-C)+128))}}addDash(c,d){const y=d?7:0,_=2*y+1;if(this.nextRow+_>this.height)return o.w("LineAtlas out of space"),null;let S=0;for(let k=0;k<c.length;k++)S+=c[k];if(S!==0){const k=this.width/S,g=this.getDashRanges(c,this.width,k);d?this.addRoundDash(g,k,y):this.addRegularDash(g)}const B={y:(this.nextRow+y+.5)/this.height,height:2*y/this.height,width:S};return this.nextRow+=_,this.dirty=!0,B}bind(c){const d=c.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const it="maplibre_preloaded_worker_pool";class Tt{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<Tt.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[it]}numActive(){return Object.keys(this.active).length}}const Lt=Math.floor(A.hardwareConcurrency/2);let Ut,Zt;function Kt(){return Ut||(Ut=new Tt),Ut}Tt.workerCount=o.B(globalThis)?Math.max(Math.min(Lt,3),1):1;class ne{constructor(c,d){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=d;const y=this.workerPool.acquire(d);for(let _=0;_<y.length;_++){const S=new o.C(y[_],d);S.name=`Worker ${_}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(c,d){const y=[];for(const _ of this.actors)y.push(_.sendAsync({type:c,data:d}));return Promise.all(y)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(d=>{d.remove()}),this.actors=[],c&&this.workerPool.release(this.id)}registerMessageHandler(c,d){for(const y of this.actors)y.registerMessageHandler(c,d)}}function re(){return Zt||(Zt=new ne(Kt(),o.G),Zt.registerMessageHandler("GR",(x,c,d)=>o.m(c,d))),Zt}function Se(x,c){const d=o.F();return o.H(d,d,[1,1,0]),o.J(d,d,[.5*x.width,.5*x.height,1]),o.K(d,d,x.calculatePosMatrix(c.toUnwrapped()))}function Be(x,c,d,y,_,S){const B=function(M,O,j){if(M)for(const G of M){const H=O[G];if(H&&H.source===j&&H.type==="fill-extrusion")return!0}else for(const G in O){const H=O[G];if(H.source===j&&H.type==="fill-extrusion")return!0}return!1}(_&&_.layers,c,x.id),k=S.maxPitchScaleFactor(),g=x.tilesIn(y,k,B);g.sort(ze);const b=[];for(const M of g)b.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(c,d,x._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,_,S,k,Se(x.transform,M.tileID))});const C=function(M){const O={},j={};for(const G of M){const H=G.queryResults,q=G.wrappedTileID,X=j[q]=j[q]||{};for(const ct in H){const et=H[ct],ht=X[ct]=X[ct]||{},ft=O[ct]=O[ct]||[];for(const Mt of et)ht[Mt.featureIndex]||(ht[Mt.featureIndex]=!0,ft.push(Mt))}}return O}(b);for(const M in C)C[M].forEach(O=>{const j=O.feature,G=x.getFeatureState(j.layer["source-layer"],j.id);j.source=j.layer.source,j.layer["source-layer"]&&(j.sourceLayer=j.layer["source-layer"]),j.state=G});return C}function ze(x,c){const d=x.tileID,y=c.tileID;return d.overscaledZ-y.overscaledZ||d.canonical.y-y.canonical.y||d.wrap-y.wrap||d.canonical.x-y.canonical.x}function Ve(x,c,d){return o._(this,void 0,void 0,function*(){let y=x;if(x.url?y=(yield o.h(c.transformRequest(x.url,"Source"),d)).data:yield A.frameAsync(d),!y)return null;const _=o.L(o.e(y,x),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in y&&y.vector_layers&&(_.vectorLayerIds=y.vector_layers.map(S=>S.id)),_})}class Xe{constructor(c,d){c&&(d?this.setSouthWest(c).setNorthEast(d):Array.isArray(c)&&(c.length===4?this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]]):this.setSouthWest(c[0]).setNorthEast(c[1])))}setNorthEast(c){return this._ne=c instanceof o.M?new o.M(c.lng,c.lat):o.M.convert(c),this}setSouthWest(c){return this._sw=c instanceof o.M?new o.M(c.lng,c.lat):o.M.convert(c),this}extend(c){const d=this._sw,y=this._ne;let _,S;if(c instanceof o.M)_=c,S=c;else{if(!(c instanceof Xe))return Array.isArray(c)?c.length===4||c.every(Array.isArray)?this.extend(Xe.convert(c)):this.extend(o.M.convert(c)):c&&("lng"in c||"lon"in c)&&"lat"in c?this.extend(o.M.convert(c)):this;if(_=c._sw,S=c._ne,!_||!S)return this}return d||y?(d.lng=Math.min(_.lng,d.lng),d.lat=Math.min(_.lat,d.lat),y.lng=Math.max(S.lng,y.lng),y.lat=Math.max(S.lat,y.lat)):(this._sw=new o.M(_.lng,_.lat),this._ne=new o.M(S.lng,S.lat)),this}getCenter(){return new o.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.M(this.getWest(),this.getNorth())}getSouthEast(){return new o.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(c){const{lng:d,lat:y}=o.M.convert(c);let _=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=y&&y<=this._ne.lat&&_}static convert(c){return c instanceof Xe?c:c&&new Xe(c)}static fromLngLat(c){const d=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,y=d/Math.cos(Math.PI/180*c.lat);return new Xe(new o.M(c.lng-y,c.lat-d),new o.M(c.lng+y,c.lat+d))}}class ge{constructor(c,d,y){this.bounds=Xe.convert(this.validateBounds(c)),this.minzoom=d||0,this.maxzoom=y||24}validateBounds(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const d=Math.pow(2,c.z),y=Math.floor(o.N(this.bounds.getWest())*d),_=Math.floor(o.O(this.bounds.getNorth())*d),S=Math.ceil(o.N(this.bounds.getEast())*d),B=Math.ceil(o.O(this.bounds.getSouth())*d);return c.x>=y&&c.x<S&&c.y>=_&&c.y<B}}class Bt extends o.E{constructor(c,d,y,_){if(super(),this.id=c,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.L(d,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const c=yield Ve(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),c&&(o.e(this,c),c.bounds&&(this.tileBounds=new ge(c.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(c){this._tileJSONRequest=null,this.fire(new o.j(c))}})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.abort(),c(),this.load()}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(c){return o._(this,void 0,void 0,function*(){const d=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y={request:this.map._requestManager.transformRequest(d,"Tile"),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};y.request.collectResourceTiming=this._collectResourceTiming;let _="RT";if(c.actor&&c.state!=="expired"){if(c.state==="loading")return new Promise((S,B)=>{c.reloadPromise={resolve:S,reject:B}})}else c.actor=this.dispatcher.getActor(),_="LT";c.abortController=new AbortController;try{const S=yield c.actor.sendAsync({type:_,data:y},c.abortController);if(delete c.abortController,c.aborted)return;this._afterTileLoadWorkerResponse(c,S)}catch(S){if(delete c.abortController,c.aborted)return;if(S&&S.status!==404)throw S;this._afterTileLoadWorkerResponse(c,null)}})}_afterTileLoadWorkerResponse(c,d){if(d&&d.resourceTiming&&(c.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&c.setExpiryData(d),c.loadVectorData(d,this.map.painter),c.reloadPromise){const y=c.reloadPromise;c.reloadPromise=null,this.loadTile(c).then(y.resolve).catch(y.reject)}}abortTile(c){return o._(this,void 0,void 0,function*(){c.abortController&&(c.abortController.abort(),delete c.abortController),c.actor&&(yield c.actor.sendAsync({type:"AT",data:{uid:c.uid,type:this.type,source:this.id}}))})}unloadTile(c){return o._(this,void 0,void 0,function*(){c.unloadVectorData(),c.actor&&(yield c.actor.sendAsync({type:"RMT",data:{uid:c.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Xt extends o.E{constructor(c,d,y,_){super(),this.id=c,this.dispatcher=y,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},d),o.e(this,o.L(d,["url","scheme","tileSize"]))}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const c=yield Ve(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,c&&(o.e(this,c),c.bounds&&(this.tileBounds=new ge(c.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(c){this._tileJSONRequest=null,this.fire(new o.j(c))}})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(c){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),c(),this.load()}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}serialize(){return o.e({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c){return o._(this,void 0,void 0,function*(){const d=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);c.abortController=new AbortController;try{const y=yield J.getImage(this.map._requestManager.transformRequest(d,"Tile"),c.abortController,this.map._refreshExpiredTiles);if(delete c.abortController,c.aborted)return void(c.state="unloaded");if(y&&y.data){this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&c.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const _=this.map.painter.context,S=_.gl,B=y.data;c.texture=this.map.painter.getTileTexture(B.width),c.texture?c.texture.update(B,{useMipmap:!0}):(c.texture=new at(_,B,S.RGBA,{useMipmap:!0}),c.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),_.extTextureFilterAnisotropic&&S.texParameterf(S.TEXTURE_2D,_.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,_.extTextureFilterAnisotropicMax)),c.state="loaded"}}catch(y){if(delete c.abortController,c.aborted)c.state="unloaded";else if(y)throw c.state="errored",y}})}abortTile(c){return o._(this,void 0,void 0,function*(){c.abortController&&(c.abortController.abort(),delete c.abortController)})}unloadTile(c){return o._(this,void 0,void 0,function*(){c.texture&&this.map.painter.saveTileTexture(c.texture)})}hasTransition(){return!1}}class ir extends Xt{constructor(c,d,y,_){super(c,d,y,_),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(c){return o._(this,void 0,void 0,function*(){const d=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y=this.map._requestManager.transformRequest(d,"Tile");c.neighboringTiles=this._getNeighboringTiles(c.tileID),c.abortController=new AbortController;try{const _=yield J.getImage(y,c.abortController,this.map._refreshExpiredTiles);if(delete c.abortController,c.aborted)return void(c.state="unloaded");if(_&&_.data){const S=_.data;this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&c.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const B=o.b(S)&&o.S()?S:yield this.readImageNow(S),k={type:this.type,uid:c.uid,source:this.id,rawImageData:B,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!c.actor||c.state==="expired"){c.actor=this.dispatcher.getActor();const g=yield c.actor.sendAsync({type:"LDT",data:k});c.dem=g,c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0,c.state="loaded"}}}catch(_){if(delete c.abortController,c.aborted)c.state="unloaded";else if(_)throw c.state="errored",_}})}readImageNow(c){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.U()){const d=c.width+2,y=c.height+2;try{return new o.R({width:d,height:y},yield o.V(c,-1,-1,d,y))}catch{}}return A.getImageData(c,1)})}_getNeighboringTiles(c){const d=c.canonical,y=Math.pow(2,d.z),_=(d.x-1+y)%y,S=d.x===0?c.wrap-1:c.wrap,B=(d.x+1+y)%y,k=d.x+1===y?c.wrap+1:c.wrap,g={};return g[new o.Q(c.overscaledZ,S,d.z,_,d.y).key]={backfilled:!1},g[new o.Q(c.overscaledZ,k,d.z,B,d.y).key]={backfilled:!1},d.y>0&&(g[new o.Q(c.overscaledZ,S,d.z,_,d.y-1).key]={backfilled:!1},g[new o.Q(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},g[new o.Q(c.overscaledZ,k,d.z,B,d.y-1).key]={backfilled:!1}),d.y+1<y&&(g[new o.Q(c.overscaledZ,S,d.z,_,d.y+1).key]={backfilled:!1},g[new o.Q(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},g[new o.Q(c.overscaledZ,k,d.z,B,d.y+1).key]={backfilled:!1}),g}unloadTile(c){return o._(this,void 0,void 0,function*(){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&(yield c.actor.sendAsync({type:"RDT",data:{type:this.type,uid:c.uid,source:this.id}}))})}}class Ie extends o.E{constructor(c,d,y,_){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=y.getActor(),this.setEventedParent(_),this._data=d.data,this._options=o.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const S=o.W/this.tileSize;this.workerOptions=o.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*S,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*S,extent:o.W,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:o.W,radius:(d.clusterRadius||50)*S,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(c){this.map=c,this.load()}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){return this._updateWorkerData(c),this}setClusterOptions(c){return this.workerOptions.cluster=c.cluster,c&&(c.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=c.clusterRadius),c.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=c.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(c){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:c,source:this.id}})}getClusterChildren(c){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:c,source:this.id}})}getClusterLeaves(c,d,y){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:c,limit:d,offset:y}})}_updateWorkerData(c){return o._(this,void 0,void 0,function*(){const d=o.e({type:this.type},this.workerOptions);c?d.dataDiff=c:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(A.resolveURL(this._data),"Source"),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"}));try{const y=yield this.actor.sendAsync({type:"LD",data:d});if(this._pendingLoads--,this._removed||y.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let _=null;y.resourceTiming&&y.resourceTiming[this.id]&&(_=y.resourceTiming[this.id].slice(0));const S={dataType:"source"};this._collectResourceTiming&&_&&_.length>0&&o.e(S,{resourceTiming:_}),this.fire(new o.k("data",Object.assign(Object.assign({},S),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},S),{sourceDataType:"content"})))}catch(y){if(this._pendingLoads--,this._removed)return void this.fire(new o.k("dataabort",{dataType:"source"}));this.fire(new o.j(y))}})}loaded(){return this._pendingLoads===0}loadTile(c){return o._(this,void 0,void 0,function*(){const d=c.actor?"RT":"LT";c.actor=this.actor;const y={type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};c.abortController=new AbortController;const _=yield this.actor.sendAsync({type:d,data:y},c.abortController);delete c.abortController,c.unloadVectorData(),c.aborted||c.loadVectorData(_,this.map.painter,d==="RT")})}abortTile(c){return o._(this,void 0,void 0,function*(){c.abortController&&(c.abortController.abort(),delete c.abortController),c.aborted=!0})}unloadTile(c){return o._(this,void 0,void 0,function*(){c.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:c.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ve=o.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ce extends o.E{constructor(c,d,y,_){super(),this.id=c,this.dispatcher=y,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=d}load(c){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield J.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,c&&(this.coordinates=c),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,this.fire(new o.j(d))}})}loaded(){return this._loaded}updateImage(c){return c.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=c.url,this.load(c.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(c){this.coordinates=c;const d=c.map(o.Y.fromLngLat);this.tileID=function(_){let S=1/0,B=1/0,k=-1/0,g=-1/0;for(const O of _)S=Math.min(S,O.x),B=Math.min(B,O.y),k=Math.max(k,O.x),g=Math.max(g,O.y);const b=Math.max(k-S,g-B),C=Math.max(0,Math.floor(-Math.log(b)/Math.LN2)),M=Math.pow(2,C);return new o.a0(C,Math.floor((S+k)/2*M),Math.floor((B+g)/2*M))}(d),this.minzoom=this.maxzoom=this.tileID.z;const y=d.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new o.Z,this._boundsArray.emplaceBack(y[0].x,y[0].y,0,0),this._boundsArray.emplaceBack(y[1].x,y[1].y,o.W,0),this._boundsArray.emplaceBack(y[3].x,y[3].y,0,o.W),this._boundsArray.emplaceBack(y[2].x,y[2].y,o.W,o.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const c=this.map.painter.context,d=c.gl;this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,ve.members)),this.boundsSegments||(this.boundsSegments=o.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new at(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let y=!1;for(const _ in this.tiles){const S=this.tiles[_];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,y=!0)}y&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(c){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={}):c.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class qe extends Ce{constructor(c,d,y,_){super(c,d,y,_),this.roundZoom=!0,this.type="video",this.options=d}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const c=this.options;this.urls=[];for(const d of c.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield o.a2(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new o.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new o.j(new o.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,d=c.gl;this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,ve.members)),this.boundsSegments||(this.boundsSegments=o.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new at(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let y=!1;for(const _ in this.tiles){const S=this.tiles[_];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,y=!0)}y&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class lr extends Ce{constructor(c,d,y,_){super(c,d,y,_),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(B=>typeof B!="number"))||this.fire(new o.j(new o.a1(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.a1(`sources.${c}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new o.j(new o.a1(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.a1(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.a1(`sources.${c}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,y=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,ve.members)),this.boundsSegments||(this.boundsSegments=o.$.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new at(d,this.canvas,y.RGBA,{premultiply:!0});let _=!1;for(const S in this.tiles){const B=this.tiles[S];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture,_=!0)}_&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}}const Er={},Ir=x=>{switch(x){case"geojson":return Ie;case"image":return Ce;case"raster":return Xt;case"raster-dem":return ir;case"vector":return Bt;case"video":return qe;case"canvas":return lr}return Er[x]},Mr="RTLPluginLoaded";class Wr extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=re()}_syncState(c){return this.status=c,this.dispatcher.broadcast("SRPS",{pluginStatus:c,pluginURL:this.url}).catch(d=>{throw this.status="error",d})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(c){return o._(this,arguments,void 0,function(d){var y=this;let _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(y.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(y.url=A.resolveURL(d),!y.url)throw new Error(`requested url ${d} is invalid`);if(y.status==="unavailable"){if(!_)return y._requestImport();y.status="deferred",y._syncState(y.status)}else if(y.status==="requested")return y._requestImport()}()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.k(Mr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Jr=null;function de(){return Jr||(Jr=new Wr),Jr}class Tr{constructor(c,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=c,this.uid=o.a3(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(c){const d=c+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(c){this.demTexture&&c.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(c,d,y){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",c){c.featureIndex&&(this.latestFeatureIndex=c.featureIndex,c.rawTileData?(this.latestRawTileData=c.rawTileData,this.latestFeatureIndex.rawTileData=c.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=c.collisionBoxArray,this.buckets=function(_,S){const B={};if(!S)return B;for(const k of _){const g=k.layerIds.map(b=>S.getLayer(b)).filter(Boolean);if(g.length!==0){k.layers=g,k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map(b=>g.filter(C=>C.id===b)[0]));for(const b of g)B[b.id]=k}}return B}(c.buckets,d.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const S=this.buckets[_];if(S instanceof o.a5){if(this.hasSymbolBuckets=!0,!y)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const S=this.buckets[_];if(S instanceof o.a5&&S.hasRTLText){this.hasRTLText=!0,de().lazyLoad();break}}this.queryPadding=0;for(const _ in this.buckets){const S=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(_).queryRadius(S))}c.imageAtlas&&(this.imageAtlas=c.imageAtlas),c.glyphAtlasImage&&(this.glyphAtlasImage=c.glyphAtlasImage)}else this.collisionBoxArray=new o.a4}unloadVectorData(){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(c){return this.buckets[c.id]}upload(c){for(const y in this.buckets){const _=this.buckets[y];_.uploadPending()&&_.upload(c)}const d=c.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new at(c,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new at(c,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(c){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(c,this.imageAtlasTexture)}queryRenderedFeatures(c,d,y,_,S,B,k,g,b,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:S,scale:B,tileSize:this.tileSize,pixelPosMatrix:C,transform:g,params:k,queryPadding:this.queryPadding*b},c,d,y):{}}querySourceFeatures(c,d){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const _=y.loadVTLayers(),S=d&&d.sourceLayer?d.sourceLayer:"",B=_._geojsonTileLayer||_[S];if(!B)return;const k=o.a6(d&&d.filter),{z:g,x:b,y:C}=this.tileID.canonical,M={z:g,x:b,y:C};for(let O=0;O<B.length;O++){const j=B.feature(O);if(k.needGeometry){const q=o.a7(j,!0);if(!k.filter(new o.a8(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!k.filter(new o.a8(this.tileID.overscaledZ),j))continue;const G=y.getId(j,S),H=new o.a9(j,g,b,C,G);H.tile=M,c.push(H)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(c){const d=this.expirationTime;if(c.cacheControl){const y=o.aa(c.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else c.expires&&(this.expirationTime=new Date(c.expires).getTime());if(this.expirationTime){const y=Date.now();let _=!1;if(this.expirationTime>y)_=!1;else if(d)if(this.expirationTime<d)_=!0;else{const S=this.expirationTime-d;S?this.expirationTime=y+Math.max(S,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(c,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(c).length===0)return;const y=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!d.style.hasLayer(_))continue;const S=this.buckets[_],B=S.layers[0].sourceLayer||"_geojsonTileLayer",k=y[B],g=c[B];if(!k||!g||Object.keys(g).length===0)continue;S.update(g,k,this.imageAtlas&&this.imageAtlas.patternPositions||{});const b=d&&d.style&&d.style.getLayer(_);b&&(this.queryPadding=Math.max(this.queryPadding,b.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<A.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(c){this.symbolFadeHoldUntil=A.now()+c}setDependencies(c,d){const y={};for(const _ of d)y[_]=!0;this.dependencies[c]=y}hasDependency(c,d){for(const y of c){const _=this.dependencies[y];if(_){for(const S of d)if(_[S])return!0}}return!1}}class Re{constructor(c,d){this.max=c,this.onRemove=d,this.reset()}reset(){for(const c in this.data)for(const d of this.data[c])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(c,d,y){const _=c.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const S={value:d,timeout:void 0};if(y!==void 0&&(S.timeout=setTimeout(()=>{this.remove(c,S)},y)),this.data[_].push(S),this.order.push(_),this.order.length>this.max){const B=this._getAndRemoveByKey(this.order[0]);B&&this.onRemove(B)}return this}has(c){return c.wrapped().key in this.data}getAndRemove(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null}_getAndRemoveByKey(c){const d=this.data[c].shift();return d.timeout&&clearTimeout(d.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),d.value}getByKey(c){const d=this.data[c];return d?d[0].value:null}get(c){return this.has(c)?this.data[c.wrapped().key][0].value:null}remove(c,d){if(!this.has(c))return this;const y=c.wrapped().key,_=d===void 0?0:this.data[y].indexOf(d),S=this.data[y][_];return this.data[y].splice(_,1),S.timeout&&clearTimeout(S.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(S.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(c){for(this.max=c;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(c){const d=[];for(const y in this.data)for(const _ of this.data[y])c(_.value)||d.push(_);for(const y of d)this.remove(y.value.tileID,y)}}class Hi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(c,d,y){const _=String(d);if(this.stateChanges[c]=this.stateChanges[c]||{},this.stateChanges[c][_]=this.stateChanges[c][_]||{},o.e(this.stateChanges[c][_],y),this.deletedStates[c]===null){this.deletedStates[c]={};for(const S in this.state[c])S!==_&&(this.deletedStates[c][S]=null)}else if(this.deletedStates[c]&&this.deletedStates[c][_]===null){this.deletedStates[c][_]={};for(const S in this.state[c][_])y[S]||(this.deletedStates[c][_][S]=null)}else for(const S in y)this.deletedStates[c]&&this.deletedStates[c][_]&&this.deletedStates[c][_][S]===null&&delete this.deletedStates[c][_][S]}removeFeatureState(c,d,y){if(this.deletedStates[c]===null)return;const _=String(d);if(this.deletedStates[c]=this.deletedStates[c]||{},y&&d!==void 0)this.deletedStates[c][_]!==null&&(this.deletedStates[c][_]=this.deletedStates[c][_]||{},this.deletedStates[c][_][y]=null);else if(d!==void 0)if(this.stateChanges[c]&&this.stateChanges[c][_])for(y in this.deletedStates[c][_]={},this.stateChanges[c][_])this.deletedStates[c][_][y]=null;else this.deletedStates[c][_]=null;else this.deletedStates[c]=null}getState(c,d){const y=String(d),_=o.e({},(this.state[c]||{})[y],(this.stateChanges[c]||{})[y]);if(this.deletedStates[c]===null)return{};if(this.deletedStates[c]){const S=this.deletedStates[c][d];if(S===null)return{};for(const B in S)delete _[B]}return _}initializeTileState(c,d){c.setFeatureState(this.state,d)}coalesceChanges(c,d){const y={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const S={};for(const B in this.stateChanges[_])this.state[_][B]||(this.state[_][B]={}),o.e(this.state[_][B],this.stateChanges[_][B]),S[B]=this.state[_][B];y[_]=S}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const S={};if(this.deletedStates[_]===null)for(const B in this.state[_])S[B]={},this.state[_][B]={};else for(const B in this.deletedStates[_]){if(this.deletedStates[_][B]===null)this.state[_][B]={};else for(const k of Object.keys(this.deletedStates[_][B]))delete this.state[_][B][k];S[B]=this.state[_][B]}y[_]=y[_]||{},o.e(y[_],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const _ in c)c[_].setFeatureState(y,d)}}class Pr extends o.E{constructor(c,d,y){super(),this.id=c,this.dispatcher=y,this.on("data",_=>this._dataHandler(_)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((_,S,B,k)=>{const g=new(Ir(S.type))(_,S,B,k);if(g.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${g.id}`);return g})(c,d,y,this),this._tiles={},this._cache=new Re(0,_=>this._unloadTile(_)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Hi,this._didEmitContent=!1,this._updated=!1}onAdd(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._maxTileCacheZoomLevels=c?c._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(c)}onRemove(c){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(c)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const c in this._tiles){const d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(c,d,y){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(c),this._tileLoaded(c,d,y)}catch(_){c.state="errored",_.status!==404?this._source.fire(new o.j(_,{tile:c})):this.update(this.transform,this.terrain)}})}_unloadTile(c){this._source.unloadTile&&this._source.unloadTile(c)}_abortTile(c){this._source.abortTile&&this._source.abortTile(c),this._source.fire(new o.k("dataabort",{tile:c,coord:c.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(c){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const y=this._tiles[d];y.upload(c),y.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(c=>c.tileID).sort(Pe).map(c=>c.key)}getRenderableIds(c){const d=[];for(const y in this._tiles)this._isIdRenderable(y,c)&&d.push(this._tiles[y]);return c?d.sort((y,_)=>{const S=y.tileID,B=_.tileID,k=new o.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),g=new o.P(B.canonical.x,B.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-B.overscaledZ||g.y-k.y||g.x-k.x}).map(y=>y.tileID.key):d.map(y=>y.tileID).sort(Pe).map(y=>y.key)}hasRenderableParent(c){const d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const c in this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")}}_reloadTile(c,d){return o._(this,void 0,void 0,function*(){const y=this._tiles[c];y&&(y.state!=="loading"&&(y.state=d),yield this._loadTile(y,c,d))})}_tileLoaded(c,d,y){c.timeAdded=A.now(),y==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),c.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:c,coord:c.tileID}))}_backfillDEM(c){const d=this.getRenderableIds();for(let _=0;_<d.length;_++){const S=d[_];if(c.neighboringTiles&&c.neighboringTiles[S]){const B=this.getTileByID(S);y(c,B),y(B,c)}}function y(_,S){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let B=S.tileID.canonical.x-_.tileID.canonical.x;const k=S.tileID.canonical.y-_.tileID.canonical.y,g=Math.pow(2,_.tileID.canonical.z),b=S.tileID.key;B===0&&k===0||Math.abs(k)>1||(Math.abs(B)>1&&(Math.abs(B+g)===1?B+=g:Math.abs(B-g)===1&&(B-=g)),S.dem&&_.dem&&(_.dem.backfillBorder(S.dem,B,k),_.neighboringTiles&&_.neighboringTiles[b]&&(_.neighboringTiles[b].backfilled=!0)))}}getTile(c){return this.getTileByID(c.key)}getTileByID(c){return this._tiles[c]}_retainLoadedChildren(c,d,y,_){for(const S in this._tiles){let B=this._tiles[S];if(_[S]||!B.hasData()||B.tileID.overscaledZ<=d||B.tileID.overscaledZ>y)continue;let k=B.tileID;for(;B&&B.tileID.overscaledZ>d+1;){const b=B.tileID.scaledTo(B.tileID.overscaledZ-1);B=this._tiles[b.key],B&&B.hasData()&&(k=b)}let g=k;for(;g.overscaledZ>d;)if(g=g.scaledTo(g.overscaledZ-1),c[g.key]){_[k.key]=k;break}}}findLoadedParent(c,d){if(c.key in this._loadedParentTiles){const y=this._loadedParentTiles[c.key];return y&&y.tileID.overscaledZ>=d?y:null}for(let y=c.overscaledZ-1;y>=d;y--){const _=c.scaledTo(y),S=this._getLoadedTile(_);if(S)return S}}_getLoadedTile(c){const d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)}updateCacheSize(c){const d=Math.ceil(c.width/this._source.tileSize)+1,y=Math.ceil(c.height/this._source.tileSize)+1,_=Math.floor(d*y*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(S)}handleWrapJump(c){const d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){const y={};for(const _ in this._tiles){const S=this._tiles[_];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+d),y[S.tileID.key]=S}this._tiles=y;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(c,d){if(!this._sourceLoaded||this._paused)return;let y;this.transform=c,this.terrain=d,this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?y=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new o.Q(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y)):(y=c.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(y=y.filter(C=>this._source.hasTile(C)))):y=[];const _=c.coveringZoomLevel(this._source),S=Math.max(_-Pr.maxOverzooming,this._source.minzoom),B=Math.max(_+Pr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const C={};for(const M of y)if(M.canonical.z>this._source.minzoom){const O=M.scaledTo(M.canonical.z-1);C[O.key]=O;const j=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));C[j.key]=j}y=y.concat(Object.values(C))}const k=y.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,k&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const g=this._updateRetainedTiles(y,_);if(Ye(this._source.type)){const C={},M={},O=Object.keys(g),j=A.now();for(const G of O){const H=g[G],q=this._tiles[G];if(!q||q.fadeEndTime!==0&&q.fadeEndTime<=j)continue;const X=this.findLoadedParent(H,S);X&&(this._addTile(X.tileID),C[X.tileID.key]=X.tileID),M[G]=H}this._retainLoadedChildren(M,_,B,g);for(const G in C)g[G]||(this._coveredTiles[G]=!0,g[G]=C[G]);if(d){const G={},H={};for(const q of y)this._tiles[q.key].hasData()?G[q.key]=q:H[q.key]=q;for(const q in H){const X=H[q].children(this._source.maxzoom);this._tiles[X[0].key]&&this._tiles[X[1].key]&&this._tiles[X[2].key]&&this._tiles[X[3].key]&&(G[X[0].key]=g[X[0].key]=X[0],G[X[1].key]=g[X[1].key]=X[1],G[X[2].key]=g[X[2].key]=X[2],G[X[3].key]=g[X[3].key]=X[3],delete H[q])}for(const q in H){const X=this.findLoadedParent(H[q],this._source.minzoom);if(X){G[X.tileID.key]=g[X.tileID.key]=X.tileID;for(const ct in G)G[ct].isChildOf(X.tileID)&&delete G[ct]}}for(const q in this._tiles)G[q]||(this._coveredTiles[q]=!0)}}for(const C in g)this._tiles[C].clearFadeHold();const b=o.ab(this._tiles,g);for(const C of b){const M=this._tiles[C];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(C)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)}_updateRetainedTiles(c,d){const y={},_={},S=Math.max(d-Pr.maxOverzooming,this._source.minzoom),B=Math.max(d+Pr.maxUnderzooming,this._source.minzoom),k={};for(const g of c){const b=this._addTile(g);y[g.key]=g,b.hasData()||d<this._source.maxzoom&&(k[g.key]=g)}this._retainLoadedChildren(k,d,B,y);for(const g of c){let b=this._tiles[g.key];if(b.hasData())continue;if(d+1>this._source.maxzoom){const M=g.children(this._source.maxzoom)[0],O=this.getTile(M);if(O&&O.hasData()){y[M.key]=M;continue}}else{const M=g.children(this._source.maxzoom);if(y[M[0].key]&&y[M[1].key]&&y[M[2].key]&&y[M[3].key])continue}let C=b.wasRequested();for(let M=g.overscaledZ-1;M>=S;--M){const O=g.scaledTo(M);if(_[O.key])break;if(_[O.key]=!0,b=this.getTile(O),!b&&C&&(b=this._addTile(O)),b){const j=b.hasData();if((C||j)&&(y[O.key]=O),C=b.wasRequested(),j)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const c in this._tiles){const d=[];let y,_=this._tiles[c].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){y=this._loadedParentTiles[_.key];break}d.push(_.key);const S=_.scaledTo(_.overscaledZ-1);if(y=this._getLoadedTile(S),y)break;_=S}for(const S of d)this._loadedParentTiles[S]=y}}_addTile(c){let d=this._tiles[c.key];if(d)return d;d=this._cache.getAndRemove(c),d&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));const y=d;return d||(d=new Tr(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,c.key,d.state)),d.uses++,this._tiles[c.key]=d,y||this._source.fire(new o.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(c,d){c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);const y=d.getExpiryTimeout();y&&(this._timers[c]=setTimeout(()=>{this._reloadTile(c,"expired"),delete this._timers[c]},y))}_removeTile(c){const d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(c){const d=c.sourceDataType;c.dataType==="source"&&d==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&d==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const c in this._tiles)this._removeTile(c);this._cache.reset()}tilesIn(c,d,y){const _=[],S=this.transform;if(!S)return _;const B=y?S.getCameraQueryGeometry(c):c,k=c.map(G=>S.pointCoordinate(G,this.terrain)),g=B.map(G=>S.pointCoordinate(G,this.terrain)),b=this.getIds();let C=1/0,M=1/0,O=-1/0,j=-1/0;for(const G of g)C=Math.min(C,G.x),M=Math.min(M,G.y),O=Math.max(O,G.x),j=Math.max(j,G.y);for(let G=0;G<b.length;G++){const H=this._tiles[b[G]];if(H.holdingForFade())continue;const q=H.tileID,X=Math.pow(2,S.zoom-H.tileID.overscaledZ),ct=d*H.queryPadding*o.W/H.tileSize/X,et=[q.getTilePoint(new o.Y(C,M)),q.getTilePoint(new o.Y(O,j))];if(et[0].x-ct<o.W&&et[0].y-ct<o.W&&et[1].x+ct>=0&&et[1].y+ct>=0){const ht=k.map(Mt=>q.getTilePoint(Mt)),ft=g.map(Mt=>q.getTilePoint(Mt));_.push({tile:H,tileID:q,queryGeometry:ht,cameraQueryGeometry:ft,scale:X})}}return _}getVisibleCoordinates(c){const d=this.getRenderableIds(c).map(y=>this._tiles[y].tileID);for(const y of d)y.posMatrix=this.transform.calculatePosMatrix(y.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(Ye(this._source.type)){const c=A.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=c)return!0}return!1}setFeatureState(c,d,y){this._state.updateState(c=c||"_geojsonTileLayer",d,y)}removeFeatureState(c,d,y){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,y)}getFeatureState(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)}setDependencies(c,d,y){const _=this._tiles[c];_&&_.setDependencies(d,y)}reloadTilesForDependencies(c,d){for(const y in this._tiles)this._tiles[y].hasDependency(c,d)&&this._reloadTile(y,"reloading");this._cache.filter(y=>!y.hasDependency(c,d))}}function Pe(x,c){const d=Math.abs(2*x.wrap)-+(x.wrap<0),y=Math.abs(2*c.wrap)-+(c.wrap<0);return x.overscaledZ-c.overscaledZ||y-d||c.canonical.y-x.canonical.y||c.canonical.x-x.canonical.x}function Ye(x){return x==="raster"||x==="image"||x==="video"}Pr.maxOverzooming=10,Pr.maxUnderzooming=3;class tr{constructor(c,d){this.reset(c,d)}reset(c,d){this.points=c||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(this.points.length===1)return this.points[0];c=o.ac(c,0,1);let d=1,y=this._distances[d];const _=c*this.paddedLength+this.padding;for(;y<_&&d<this._distances.length;)y=this._distances[++d];const S=d-1,B=this._distances[S],k=y-B,g=k>0?(_-B)/k:0;return this.points[S].mult(1-g).add(this.points[d].mult(g))}}function fi(x,c){let d=!0;return x==="always"||x!=="never"&&c!=="never"||(d=!1),d}class Fr{constructor(c,d,y){const _=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(c/y),this.yCellCount=Math.ceil(d/y);for(let B=0;B<this.xCellCount*this.yCellCount;B++)_.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=d,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,d,y,_,S){this._forEachCell(d,y,_,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(_),this.bboxes.push(S)}insertCircle(c,d,y,_){this._forEachCell(d-_,y-_,d+_,y+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(d),this.circles.push(y),this.circles.push(_)}_insertBoxCell(c,d,y,_,S,B){this.boxCells[S].push(B)}_insertCircleCell(c,d,y,_,S,B){this.circleCells[S].push(B)}_query(c,d,y,_,S,B,k){if(y<0||c>this.width||_<0||d>this.height)return[];const g=[];if(c<=0&&d<=0&&this.width<=y&&this.height<=_){if(S)return[{key:null,x1:c,y1:d,x2:y,y2:_}];for(let b=0;b<this.boxKeys.length;b++)g.push({key:this.boxKeys[b],x1:this.bboxes[4*b],y1:this.bboxes[4*b+1],x2:this.bboxes[4*b+2],y2:this.bboxes[4*b+3]});for(let b=0;b<this.circleKeys.length;b++){const C=this.circles[3*b],M=this.circles[3*b+1],O=this.circles[3*b+2];g.push({key:this.circleKeys[b],x1:C-O,y1:M-O,x2:C+O,y2:M+O})}}else this._forEachCell(c,d,y,_,this._queryCell,g,{hitTest:S,overlapMode:B,seenUids:{box:{},circle:{}}},k);return g}query(c,d,y,_){return this._query(c,d,y,_,!1,null)}hitTest(c,d,y,_,S,B){return this._query(c,d,y,_,!0,S,B).length>0}hitTestCircle(c,d,y,_,S){const B=c-y,k=c+y,g=d-y,b=d+y;if(k<0||B>this.width||b<0||g>this.height)return!1;const C=[];return this._forEachCell(B,g,k,b,this._queryCellCircle,C,{hitTest:!0,overlapMode:_,circle:{x:c,y:d,radius:y},seenUids:{box:{},circle:{}}},S),C.length>0}_queryCell(c,d,y,_,S,B,k,g){const{seenUids:b,hitTest:C,overlapMode:M}=k,O=this.boxCells[S];if(O!==null){const G=this.bboxes;for(const H of O)if(!b.box[H]){b.box[H]=!0;const q=4*H,X=this.boxKeys[H];if(c<=G[q+2]&&d<=G[q+3]&&y>=G[q+0]&&_>=G[q+1]&&(!g||g(X))&&(!C||!fi(M,X.overlapMode))&&(B.push({key:X,x1:G[q],y1:G[q+1],x2:G[q+2],y2:G[q+3]}),C))return!0}}const j=this.circleCells[S];if(j!==null){const G=this.circles;for(const H of j)if(!b.circle[H]){b.circle[H]=!0;const q=3*H,X=this.circleKeys[H];if(this._circleAndRectCollide(G[q],G[q+1],G[q+2],c,d,y,_)&&(!g||g(X))&&(!C||!fi(M,X.overlapMode))){const ct=G[q],et=G[q+1],ht=G[q+2];if(B.push({key:X,x1:ct-ht,y1:et-ht,x2:ct+ht,y2:et+ht}),C)return!0}}}return!1}_queryCellCircle(c,d,y,_,S,B,k,g){const{circle:b,seenUids:C,overlapMode:M}=k,O=this.boxCells[S];if(O!==null){const G=this.bboxes;for(const H of O)if(!C.box[H]){C.box[H]=!0;const q=4*H,X=this.boxKeys[H];if(this._circleAndRectCollide(b.x,b.y,b.radius,G[q+0],G[q+1],G[q+2],G[q+3])&&(!g||g(X))&&!fi(M,X.overlapMode))return B.push(!0),!0}}const j=this.circleCells[S];if(j!==null){const G=this.circles;for(const H of j)if(!C.circle[H]){C.circle[H]=!0;const q=3*H,X=this.circleKeys[H];if(this._circlesCollide(G[q],G[q+1],G[q+2],b.x,b.y,b.radius)&&(!g||g(X))&&!fi(M,X.overlapMode))return B.push(!0),!0}}}_forEachCell(c,d,y,_,S,B,k,g){const b=this._convertToXCellCoord(c),C=this._convertToYCellCoord(d),M=this._convertToXCellCoord(y),O=this._convertToYCellCoord(_);for(let j=b;j<=M;j++)for(let G=C;G<=O;G++)if(S.call(this,c,d,y,_,this.xCellCount*G+j,B,k,g))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,d,y,_,S,B){const k=_-c,g=S-d,b=y+B;return b*b>k*k+g*g}_circleAndRectCollide(c,d,y,_,S,B,k){const g=(B-_)/2,b=Math.abs(c-(_+g));if(b>g+y)return!1;const C=(k-S)/2,M=Math.abs(d-(S+C));if(M>C+y)return!1;if(b<=g||M<=C)return!0;const O=b-g,j=M-C;return O*O+j*j<=y*y}}function wr(x,c,d,y,_){const S=o.F();return c?(o.J(S,S,[1/_,1/_,1]),d||o.ad(S,S,y.angle)):o.K(S,y.labelPlaneMatrix,x),S}function bi(x,c,d,y,_){if(c){const S=o.ae(x);return o.J(S,S,[_,_,1]),d||o.ad(S,S,-y.angle),S}return y.glCoordMatrix}function ai(x,c,d){let y;d?(y=[x.x,x.y,d(x.x,x.y),1],o.af(y,y,c)):(y=[x.x,x.y,0,1],He(y,y,c));const _=y[3];return{point:new o.P(y[0]/_,y[1]/_),signedDistanceFromCamera:_}}function At(x,c){return .5+x/c*.5}function Y(x,c){const d=x[0]/x[3],y=x[1]/x[3];return d>=-c[0]&&d<=c[0]&&y>=-c[1]&&y<=c[1]}function Q(x,c,d,y,_,S,B,k,g,b){const C=y?x.textSizeData:x.iconSizeData,M=o.ag(C,d.transform.zoom),O=[256/d.width*2+1,256/d.height*2+1],j=y?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;j.clear();const G=x.lineVertexArray,H=y?x.text.placedSymbolArray:x.icon.placedSymbolArray,q=d.transform.width/d.transform.height;let X=!1;for(let ct=0;ct<H.length;ct++){const et=H.get(ct);if(et.hidden||et.writingMode===o.ah.vertical&&!X){ce(et.numGlyphs,j);continue}let ht;if(X=!1,b?(ht=[et.anchorX,et.anchorY,b(et.anchorX,et.anchorY),1],o.af(ht,ht,c)):(ht=[et.anchorX,et.anchorY,0,1],He(ht,ht,c)),!Y(ht,O)){ce(et.numGlyphs,j);continue}const ft=At(d.transform.cameraToCenterDistance,ht[3]),Mt=o.ai(C,M,et),St=B?Mt/ft:Mt*ft,gt=new o.P(et.anchorX,et.anchorY),yt=ai(gt,_,b).point,Vt={projections:{},offsets:{}},$t=Nt(et,St,!1,k,c,_,S,x.glyphOffsetArray,G,j,yt,gt,Vt,q,g,b);X=$t.useVertical,($t.notEnoughRoom||X||$t.needsFlipping&&Nt(et,St,!0,k,c,_,S,x.glyphOffsetArray,G,j,yt,gt,Vt,q,g,b).notEnoughRoom)&&ce(et.numGlyphs,j)}y?x.text.dynamicLayoutVertexBuffer.updateData(j):x.icon.dynamicLayoutVertexBuffer.updateData(j)}function ot(x,c,d,y,_,S,B,k,g,b,C,M,O){const j=k.glyphStartIndex+k.numGlyphs,G=k.lineStartIndex,H=k.lineStartIndex+k.lineLength,q=c.getoffsetX(k.glyphStartIndex),X=c.getoffsetX(j-1),ct=ye(x*q,d,y,_,S,B,k.segment,G,H,g,b,C,M,O);if(!ct)return null;const et=ye(x*X,d,y,_,S,B,k.segment,G,H,g,b,C,M,O);return et?{first:ct,last:et}:null}function wt(x,c,d,y){return x===o.ah.horizontal&&Math.abs(d.y-c.y)>Math.abs(d.x-c.x)*y?{useVertical:!0}:(x===o.ah.vertical?c.y<d.y:c.x>d.x)?{needsFlipping:!0}:null}function Nt(x,c,d,y,_,S,B,k,g,b,C,M,O,j,G,H){const q=c/24,X=x.lineOffsetX*q,ct=x.lineOffsetY*q;let et;if(x.numGlyphs>1){const ht=x.glyphStartIndex+x.numGlyphs,ft=x.lineStartIndex,Mt=x.lineStartIndex+x.lineLength,St=ot(q,k,X,ct,d,C,M,x,g,S,O,G,H);if(!St)return{notEnoughRoom:!0};const gt=ai(St.first.point,B,H).point,yt=ai(St.last.point,B,H).point;if(y&&!d){const Vt=wt(x.writingMode,gt,yt,j);if(Vt)return Vt}et=[St.first];for(let Vt=x.glyphStartIndex+1;Vt<ht-1;Vt++)et.push(ye(q*k.getoffsetX(Vt),X,ct,d,C,M,x.segment,ft,Mt,g,S,O,G,H));et.push(St.last)}else{if(y&&!d){const ft=ai(M,_,H).point,Mt=x.lineStartIndex+x.segment+1,St=new o.P(g.getx(Mt),g.gety(Mt)),gt=ai(St,_,H),yt=gt.signedDistanceFromCamera>0?gt.point:Gt(M,St,ft,1,_,H),Vt=wt(x.writingMode,ft,yt,j);if(Vt)return Vt}const ht=ye(q*k.getoffsetX(x.glyphStartIndex),X,ct,d,C,M,x.segment,x.lineStartIndex,x.lineStartIndex+x.lineLength,g,S,O,G,H);if(!ht)return{notEnoughRoom:!0};et=[ht]}for(const ht of et)o.aj(b,ht.point,ht.angle);return{}}function Gt(x,c,d,y,_,S){const B=ai(x.add(x.sub(c)._unit()),_,S).point,k=d.sub(B);return d.add(k._mult(y/k.mag()))}function Ht(x,c){const{projectionCache:d,lineVertexArray:y,labelPlaneMatrix:_,tileAnchorPoint:S,distanceFromAnchor:B,getElevation:k,previousVertex:g,direction:b,absOffsetX:C}=c;if(d.projections[x])return d.projections[x];const M=new o.P(y.getx(x),y.gety(x)),O=ai(M,_,k);if(O.signedDistanceFromCamera>0)return d.projections[x]=O.point,O.point;const j=x-b;return Gt(B===0?S:new o.P(y.getx(j),y.gety(j)),M,g,C-B+1,_,k)}function Ct(x,c,d){return x._unit()._perp()._mult(c*d)}function Jt(x,c,d,y,_,S,B,k){const{projectionCache:g,direction:b}=k;if(g.offsets[x])return g.offsets[x];const C=d.add(c);if(x+b<y||x+b>=_)return g.offsets[x]=C,C;const M=Ht(x+b,k),O=Ct(M.sub(d),B,b),j=d.add(O),G=M.add(O);return g.offsets[x]=o.ak(S,C,j,G)||C,g.offsets[x]}function ye(x,c,d,y,_,S,B,k,g,b,C,M,O,j){const G=y?x-c:x+c;let H=G>0?1:-1,q=0;y&&(H*=-1,q=Math.PI),H<0&&(q+=Math.PI);let X,ct,et=H>0?k+B:k+B+1,ht=_,ft=_,Mt=0,St=0;const gt=Math.abs(G),yt=[];let Vt;for(;Mt+St<=gt;){if(et+=H,et<k||et>=g)return null;Mt+=St,ft=ht,ct=X;const le={projectionCache:M,lineVertexArray:b,labelPlaneMatrix:C,tileAnchorPoint:S,distanceFromAnchor:Mt,getElevation:j,previousVertex:ft,direction:H,absOffsetX:gt};if(ht=Ht(et,le),d===0)yt.push(ft),Vt=ht.sub(ft);else{let me;const Le=ht.sub(ft);me=Le.mag()===0?Ct(Ht(et+H,le).sub(ht),d,H):Ct(Le,d,H),ct||(ct=ft.add(me)),X=Jt(et,me,ht,k,g,ct,d,le),yt.push(ct),Vt=X.sub(ct)}St=Vt.mag()}const $t=Vt._mult((gt-Mt)/St)._add(ct||ft),ae=q+Math.atan2(ht.y-ft.y,ht.x-ft.x);return yt.push($t),{point:$t,angle:O?ae:0,path:yt}}const fe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ce(x,c){for(let d=0;d<x;d++){const y=c.length;c.resize(y+4),c.float32.set(fe,3*y)}}function He(x,c,d){const y=c[0],_=c[1];return x[0]=d[0]*y+d[4]*_+d[12],x[1]=d[1]*y+d[5]*_+d[13],x[3]=d[3]*y+d[7]*_+d[15],x}const Ze=100;class xr{constructor(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Fr(c.width+200,c.height+200,25),y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Fr(c.width+200,c.height+200,25);this.transform=c,this.grid=d,this.ignoredGrid=y,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+Ze,this.screenBottomBoundary=c.height+Ze,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(c,d,y,_,S,B){const k=this.projectAndGetPerspectiveRatio(_,c.anchorPointX,c.anchorPointY,B),g=y*k.perspectiveRatio,b=c.x1*g+k.point.x,C=c.y1*g+k.point.y,M=c.x2*g+k.point.x,O=c.y2*g+k.point.y;return!this.isInsideGrid(b,C,M,O)||d!=="always"&&this.grid.hitTest(b,C,M,O,d,S)||k.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[b,C,M,O],offscreen:this.isOffscreen(b,C,M,O)}}placeCollisionCircles(c,d,y,_,S,B,k,g,b,C,M,O,j,G){const H=[],q=new o.P(d.anchorX,d.anchorY),X=ai(q,B,G),ct=At(this.transform.cameraToCenterDistance,X.signedDistanceFromCamera),et=(C?S/ct:S*ct)/o.ao,ht=ai(q,k,G).point,ft=ot(et,_,d.lineOffsetX*et,d.lineOffsetY*et,!1,ht,q,d,y,k,{projections:{},offsets:{}},!1,G);let Mt=!1,St=!1,gt=!0;if(ft){const yt=.5*O*ct+j,Vt=new o.P(-100,-100),$t=new o.P(this.screenRightBoundary,this.screenBottomBoundary),ae=new tr,le=ft.first,me=ft.last;let Le=[];for(let Ke=le.path.length-1;Ke>=1;Ke--)Le.push(le.path[Ke]);for(let Ke=1;Ke<me.path.length;Ke++)Le.push(me.path[Ke]);const we=2.5*yt;if(g){const Ke=Le.map(Je=>ai(Je,g,G));Le=Ke.some(Je=>Je.signedDistanceFromCamera<=0)?[]:Ke.map(Je=>Je.point)}let Ue=[];if(Le.length>0){const Ke=Le[0].clone(),Je=Le[0].clone();for(let vr=1;vr<Le.length;vr++)Ke.x=Math.min(Ke.x,Le[vr].x),Ke.y=Math.min(Ke.y,Le[vr].y),Je.x=Math.max(Je.x,Le[vr].x),Je.y=Math.max(Je.y,Le[vr].y);Ue=Ke.x>=Vt.x&&Je.x<=$t.x&&Ke.y>=Vt.y&&Je.y<=$t.y?[Le]:Je.x<Vt.x||Ke.x>$t.x||Je.y<Vt.y||Ke.y>$t.y?[]:o.al([Le],Vt.x,Vt.y,$t.x,$t.y)}for(const Ke of Ue){ae.reset(Ke,.25*yt);let Je=0;Je=ae.length<=.5*yt?1:Math.ceil(ae.paddedLength/we)+1;for(let vr=0;vr<Je;vr++){const br=vr/Math.max(Je-1,1),Vr=ae.lerp(br),gr=Vr.x+Ze,Ur=Vr.y+Ze;H.push(gr,Ur,yt,0);const ci=gr-yt,ui=Ur-yt,en=gr+yt,ti=Ur+yt;if(gt=gt&&this.isOffscreen(ci,ui,en,ti),St=St||this.isInsideGrid(ci,ui,en,ti),c!=="always"&&this.grid.hitTestCircle(gr,Ur,yt,c,M)&&(Mt=!0,!b))return{circles:[],offscreen:!1,collisionDetected:Mt}}}}return{circles:!b&&Mt||!St||ct<this.perspectiveRatioCutoff?[]:H,offscreen:gt,collisionDetected:Mt}}queryRenderedSymbols(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let y=1/0,_=1/0,S=-1/0,B=-1/0;for(const C of c){const M=new o.P(C.x+Ze,C.y+Ze);y=Math.min(y,M.x),_=Math.min(_,M.y),S=Math.max(S,M.x),B=Math.max(B,M.y),d.push(M)}const k=this.grid.query(y,_,S,B).concat(this.ignoredGrid.query(y,_,S,B)),g={},b={};for(const C of k){const M=C.key;if(g[M.bucketInstanceId]===void 0&&(g[M.bucketInstanceId]={}),g[M.bucketInstanceId][M.featureIndex])continue;const O=[new o.P(C.x1,C.y1),new o.P(C.x2,C.y1),new o.P(C.x2,C.y2),new o.P(C.x1,C.y2)];o.am(d,O)&&(g[M.bucketInstanceId][M.featureIndex]=!0,b[M.bucketInstanceId]===void 0&&(b[M.bucketInstanceId]=[]),b[M.bucketInstanceId].push(M.featureIndex))}return b}insertCollisionBox(c,d,y,_,S,B){(y?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:S,collisionGroupID:B,overlapMode:d},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,d,y,_,S,B){const k=y?this.ignoredGrid:this.grid,g={bucketInstanceId:_,featureIndex:S,collisionGroupID:B,overlapMode:d};for(let b=0;b<c.length;b+=4)k.insertCircle(g,c[b],c[b+1],c[b+2])}projectAndGetPerspectiveRatio(c,d,y,_){let S;return _?(S=[d,y,_(d,y),1],o.af(S,S,c)):(S=[d,y,0,1],He(S,S,c)),{point:new o.P((S[0]/S[3]+1)/2*this.transform.width+Ze,(-S[1]/S[3]+1)/2*this.transform.height+Ze),perspectiveRatio:.5+this.transform.cameraToCenterDistance/S[3]*.5}}isOffscreen(c,d,y,_){return y<Ze||c>=this.screenRightBoundary||_<Ze||d>this.screenBottomBoundary}isInsideGrid(c,d,y,_){return y>=0&&c<this.gridRightBoundary&&_>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const c=o.an([]);return o.H(c,c,[-100,-100,0]),c}}function sr(x,c,d){return c*(o.W/(x.tileSize*Math.pow(2,d-x.tileID.overscaledZ)))}class Cr{constructor(c,d,y,_){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?d:-d))):_&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class zr{constructor(c,d,y,_,S){this.text=new Cr(c?c.text:null,d,y,S),this.icon=new Cr(c?c.icon:null,d,_,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class $r{constructor(c,d,y){this.text=c,this.icon=d,this.skipFade=y}}class li{constructor(){this.invProjMatrix=o.F(),this.viewportMatrix=o.F(),this.circles=[]}}class ur{constructor(c,d,y,_,S){this.bucketInstanceId=c,this.featureIndex=d,this.sourceLayerIndex=y,this.bucketIndex=_,this.tileID=S}}class Gr{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const d=++this.maxGroupID;this.collisionGroups[c]={ID:d,predicate:y=>y.collisionGroupID===d}}return this.collisionGroups[c]}}function pi(x,c,d,y,_){const{horizontalAlign:S,verticalAlign:B}=o.at(x);return new o.P(-(S-.5)*c+y[0]*_,-(B-.5)*d+y[1]*_)}function Ri(x,c,d,y,_,S){const{x1:B,x2:k,y1:g,y2:b,anchorPointX:C,anchorPointY:M}=x,O=new o.P(c,d);return y&&O._rotate(_?S:-S),{x1:B+O.x,y1:g+O.y,x2:k+O.x,y2:b+O.y,anchorPointX:C,anchorPointY:M}}class Wi{constructor(c,d,y,_,S){this.transform=c.clone(),this.terrain=d,this.collisionIndex=new xr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new Gr(_),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,d,y,_){const S=y.getBucket(d),B=y.latestFeatureIndex;if(!S||!B||d.id!==S.layerIds[0])return;const k=y.collisionBoxArray,g=S.layers[0].layout,b=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),C=y.tileSize/o.W,M=this.transform.calculatePosMatrix(y.tileID.toUnwrapped()),O=g.get("text-pitch-alignment")==="map",j=g.get("text-rotation-alignment")==="map",G=sr(y,1,this.transform.zoom),H=wr(M,O,j,this.transform,G);let q=null;if(O){const ct=bi(M,O,j,this.transform,G);q=o.K([],this.transform.labelPlaneMatrix,ct)}this.retainedQueryData[S.bucketInstanceId]=new ur(S.bucketInstanceId,B,S.sourceLayerIndex,S.index,y.tileID);const X={bucket:S,layout:g,posMatrix:M,textLabelPlaneMatrix:H,labelToScreenMatrix:q,scale:b,textPixelRatio:C,holdingForFade:y.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:o.ag(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(_)for(const ct of S.sortKeyRanges){const{sortKey:et,symbolInstanceStart:ht,symbolInstanceEnd:ft}=ct;c.push({sortKey:et,symbolInstanceStart:ht,symbolInstanceEnd:ft,parameters:X})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:X})}attemptAnchorPlacement(c,d,y,_,S,B,k,g,b,C,M,O,j,G,H,q){const X=o.ap[c.textAnchor],ct=[c.textOffset0,c.textOffset1],et=pi(X,y,_,ct,S),ht=this.collisionIndex.placeCollisionBox(Ri(d,et.x,et.y,B,k,this.transform.angle),M,g,b,C.predicate,q);if((!H||this.collisionIndex.placeCollisionBox(Ri(H,et.x,et.y,B,k,this.transform.angle),M,g,b,C.predicate,q).box.length!==0)&&ht.box.length>0){let ft;if(this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(ft=this.prevPlacement.variableOffsets[O.crossTileID].anchor),O.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[O.crossTileID]={textOffset:ct,width:y,height:_,anchor:X,textBoxScale:S,prevAnchor:ft},this.markUsedJustification(j,X,O,G),j.allowVerticalPlacement&&(this.markUsedOrientation(j,G,O),this.placedOrientations[O.crossTileID]=G),{shift:et,placedGlyphBoxes:ht}}}placeLayerBucketPart(c,d,y){const{bucket:_,layout:S,posMatrix:B,textLabelPlaneMatrix:k,labelToScreenMatrix:g,textPixelRatio:b,holdingForFade:C,collisionBoxArray:M,partiallyEvaluatedTextSize:O,collisionGroup:j}=c.parameters,G=S.get("text-optional"),H=S.get("icon-optional"),q=o.aq(S,"text-overlap","text-allow-overlap"),X=q==="always",ct=o.aq(S,"icon-overlap","icon-allow-overlap"),et=ct==="always",ht=S.get("text-rotation-alignment")==="map",ft=S.get("text-pitch-alignment")==="map",Mt=S.get("icon-text-fit")!=="none",St=S.get("symbol-z-order")==="viewport-y",gt=X&&(et||!_.hasIconData()||H),yt=et&&(X||!_.hasTextData()||G);!_.collisionArrays&&M&&_.deserializeCollisionBoxes(M);const Vt=this.retainedQueryData[_.bucketInstanceId].tileID,$t=this.terrain?(le,me)=>this.terrain.getElevation(Vt,le,me):null,ae=(le,me)=>{var Le,we;if(d[le.crossTileID])return;if(C)return void(this.placements[le.crossTileID]=new $r(!1,!1,!1));let Ue=!1,Ke=!1,Je=!0,vr=null,br={box:null,offscreen:null},Vr={box:null,offscreen:null},gr=null,Ur=null,ci=null,ui=0,en=0,ti=0;me.textFeatureIndex?ui=me.textFeatureIndex:le.useRuntimeCollisionCircles&&(ui=le.featureIndex),me.verticalTextFeatureIndex&&(en=me.verticalTextFeatureIndex);const Kn=me.textBox;if(Kn){const ei=Yr=>{let hi=o.ah.horizontal;if(_.allowVerticalPlacement&&!Yr&&this.prevPlacement){const jn=this.prevPlacement.placedOrientations[le.crossTileID];jn&&(this.placedOrientations[le.crossTileID]=jn,hi=jn,this.markUsedOrientation(_,hi,le))}return hi},Zr=(Yr,hi)=>{if(_.allowVerticalPlacement&&le.numVerticalGlyphVertices>0&&me.verticalTextBox){for(const jn of _.writingModes)if(jn===o.ah.vertical?(br=hi(),Vr=br):br=Yr(),br&&br.box&&br.box.length)break}else br=Yr()},ri=le.textAnchorOffsetStartIndex,pn=le.textAnchorOffsetEndIndex;if(pn===ri){const Yr=(hi,jn)=>{const Ui=this.collisionIndex.placeCollisionBox(hi,q,b,B,j.predicate,$t);return Ui&&Ui.box&&Ui.box.length&&(this.markUsedOrientation(_,jn,le),this.placedOrientations[le.crossTileID]=jn),Ui};Zr(()=>Yr(Kn,o.ah.horizontal),()=>{const hi=me.verticalTextBox;return _.allowVerticalPlacement&&le.numVerticalGlyphVertices>0&&hi?Yr(hi,o.ah.vertical):{box:null,offscreen:null}}),ei(br&&br.box&&br.box.length)}else{let Yr=o.ap[(we=(Le=this.prevPlacement)===null||Le===void 0?void 0:Le.variableOffsets[le.crossTileID])===null||we===void 0?void 0:we.anchor];const hi=(Ui,Ai,Ji)=>{const Ch=Ui.x2-Ui.x1,gl=Ui.y2-Ui.y1,ml=le.textBoxScale,nc=Mt&&ct==="never"?Ai:null;let ao={box:[],offscreen:!1},Zc=q==="never"?1:2,lo="never";Yr&&Zc++;for(let yl=0;yl<Zc;yl++){for(let _l=ri;_l<pn;_l++){const Nu=_.textAnchorOffsets.get(_l);if(Yr&&Nu.textAnchor!==Yr)continue;const Jc=this.attemptAnchorPlacement(Nu,Ui,Ch,gl,ml,ht,ft,b,B,j,lo,le,_,Ji,nc,$t);if(Jc&&(ao=Jc.placedGlyphBoxes,ao&&ao.box&&ao.box.length))return Ue=!0,vr=Jc.shift,ao}Yr?Yr=null:lo=q}return ao};Zr(()=>hi(Kn,me.iconBox,o.ah.horizontal),()=>{const Ui=me.verticalTextBox;return _.allowVerticalPlacement&&!(br&&br.box&&br.box.length)&&le.numVerticalGlyphVertices>0&&Ui?hi(Ui,me.verticalIconBox,o.ah.vertical):{box:null,offscreen:null}}),br&&(Ue=br.box,Je=br.offscreen);const jn=ei(br&&br.box);if(!Ue&&this.prevPlacement){const Ui=this.prevPlacement.variableOffsets[le.crossTileID];Ui&&(this.variableOffsets[le.crossTileID]=Ui,this.markUsedJustification(_,Ui.anchor,le,jn))}}}if(gr=br,Ue=gr&&gr.box&&gr.box.length>0,Je=gr&&gr.offscreen,le.useRuntimeCollisionCircles){const ei=_.text.placedSymbolArray.get(le.centerJustifiedTextSymbolIndex),Zr=o.ai(_.textSizeData,O,ei),ri=S.get("text-padding");Ur=this.collisionIndex.placeCollisionCircles(q,ei,_.lineVertexArray,_.glyphOffsetArray,Zr,B,k,g,y,ft,j.predicate,le.collisionCircleDiameter,ri,$t),Ur.circles.length&&Ur.collisionDetected&&!y&&o.w("Collisions detected, but collision boxes are not shown"),Ue=X||Ur.circles.length>0&&!Ur.collisionDetected,Je=Je&&Ur.offscreen}if(me.iconFeatureIndex&&(ti=me.iconFeatureIndex),me.iconBox){const ei=Zr=>{const ri=Mt&&vr?Ri(Zr,vr.x,vr.y,ht,ft,this.transform.angle):Zr;return this.collisionIndex.placeCollisionBox(ri,ct,b,B,j.predicate,$t)};Vr&&Vr.box&&Vr.box.length&&me.verticalIconBox?(ci=ei(me.verticalIconBox),Ke=ci.box.length>0):(ci=ei(me.iconBox),Ke=ci.box.length>0),Je=Je&&ci.offscreen}const bn=G||le.numHorizontalGlyphVertices===0&&le.numVerticalGlyphVertices===0,Li=H||le.numIconVertices===0;if(bn||Li?Li?bn||(Ke=Ke&&Ue):Ue=Ke&&Ue:Ke=Ue=Ke&&Ue,Ue&&gr&&gr.box&&this.collisionIndex.insertCollisionBox(gr.box,q,S.get("text-ignore-placement"),_.bucketInstanceId,Vr&&Vr.box&&en?en:ui,j.ID),Ke&&ci&&this.collisionIndex.insertCollisionBox(ci.box,ct,S.get("icon-ignore-placement"),_.bucketInstanceId,ti,j.ID),Ur&&(Ue&&this.collisionIndex.insertCollisionCircles(Ur.circles,q,S.get("text-ignore-placement"),_.bucketInstanceId,ui,j.ID),y)){const ei=_.bucketInstanceId;let Zr=this.collisionCircleArrays[ei];Zr===void 0&&(Zr=this.collisionCircleArrays[ei]=new li);for(let ri=0;ri<Ur.circles.length;ri+=4)Zr.circles.push(Ur.circles[ri+0]),Zr.circles.push(Ur.circles[ri+1]),Zr.circles.push(Ur.circles[ri+2]),Zr.circles.push(Ur.collisionDetected?1:0)}if(le.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[le.crossTileID]=new $r(Ue||gt,Ke||yt,Je||_.justReloaded),d[le.crossTileID]=!0};if(St){if(c.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const le=_.getSortedSymbolIndexes(this.transform.angle);for(let me=le.length-1;me>=0;--me){const Le=le[me];ae(_.symbolInstances.get(Le),_.collisionArrays[Le])}}else for(let le=c.symbolInstanceStart;le<c.symbolInstanceEnd;le++)ae(_.symbolInstances.get(le),_.collisionArrays[le]);if(y&&_.bucketInstanceId in this.collisionCircleArrays){const le=this.collisionCircleArrays[_.bucketInstanceId];o.ar(le.invProjMatrix,B),le.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(c,d,y,_){let S;S=_===o.ah.vertical?y.verticalPlacedTextSymbolIndex:{left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex}[o.as(d)];const B=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex];for(const k of B)k>=0&&(c.text.placedSymbolArray.get(k).crossTileID=S>=0&&k!==S?0:y.crossTileID)}markUsedOrientation(c,d,y){const _=d===o.ah.horizontal||d===o.ah.horizontalOnly?d:0,S=d===o.ah.vertical?d:0,B=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex];for(const k of B)c.text.placedSymbolArray.get(k).placedOrientation=_;y.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let y=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const _=d?d.symbolFadeChange(c):1,S=d?d.opacities:{},B=d?d.variableOffsets:{},k=d?d.placedOrientations:{};for(const g in this.placements){const b=this.placements[g],C=S[g];C?(this.opacities[g]=new zr(C,_,b.text,b.icon),y=y||b.text!==C.text.placed||b.icon!==C.icon.placed):(this.opacities[g]=new zr(null,_,b.text,b.icon,b.skipFade),y=y||b.text||b.icon)}for(const g in S){const b=S[g];if(!this.opacities[g]){const C=new zr(b,_,!1,!1);C.isHidden()||(this.opacities[g]=C,y=y||b.text.placed||b.icon.placed)}}for(const g in B)this.variableOffsets[g]||!this.opacities[g]||this.opacities[g].isHidden()||(this.variableOffsets[g]=B[g]);for(const g in k)this.placedOrientations[g]||!this.opacities[g]||this.opacities[g].isHidden()||(this.placedOrientations[g]=k[g]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");y?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:c)}updateLayerOpacities(c,d){const y={};for(const _ of d){const S=_.getBucket(c);S&&_.latestFeatureIndex&&c.id===S.layerIds[0]&&this.updateBucketOpacities(S,y,_.collisionBoxArray)}}updateBucketOpacities(c,d,y){c.hasTextData()&&(c.text.opacityVertexArray.clear(),c.text.hasVisibleVertices=!1),c.hasIconData()&&(c.icon.opacityVertexArray.clear(),c.icon.hasVisibleVertices=!1),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const _=c.layers[0],S=_.layout,B=new zr(null,0,!1,!1,!0),k=S.get("text-allow-overlap"),g=S.get("icon-allow-overlap"),b=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),C=S.get("text-rotation-alignment")==="map",M=S.get("text-pitch-alignment")==="map",O=S.get("icon-text-fit")!=="none",j=new zr(null,0,k&&(g||!c.hasIconData()||S.get("icon-optional")),g&&(k||!c.hasTextData()||S.get("text-optional")),!0);!c.collisionArrays&&y&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(y);const G=(H,q,X)=>{for(let ct=0;ct<q/4;ct++)H.opacityVertexArray.emplaceBack(X);H.hasVisibleVertices=H.hasVisibleVertices||X!==On};for(let H=0;H<c.symbolInstances.length;H++){const q=c.symbolInstances.get(H),{numHorizontalGlyphVertices:X,numVerticalGlyphVertices:ct,crossTileID:et}=q;let ht=this.opacities[et];d[et]?ht=B:ht||(ht=j,this.opacities[et]=ht),d[et]=!0;const ft=q.numIconVertices>0,Mt=this.placedOrientations[q.crossTileID],St=Mt===o.ah.vertical,gt=Mt===o.ah.horizontal||Mt===o.ah.horizontalOnly;if(X>0||ct>0){const yt=$i(ht.text);G(c.text,X,St?On:yt),G(c.text,ct,gt?On:yt);const Vt=ht.text.isHidden();[q.rightJustifiedTextSymbolIndex,q.centerJustifiedTextSymbolIndex,q.leftJustifiedTextSymbolIndex].forEach(le=>{le>=0&&(c.text.placedSymbolArray.get(le).hidden=Vt||St?1:0)}),q.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(q.verticalPlacedTextSymbolIndex).hidden=Vt||gt?1:0);const $t=this.variableOffsets[q.crossTileID];$t&&this.markUsedJustification(c,$t.anchor,q,Mt);const ae=this.placedOrientations[q.crossTileID];ae&&(this.markUsedJustification(c,"left",q,ae),this.markUsedOrientation(c,ae,q))}if(ft){const yt=$i(ht.icon),Vt=!(O&&q.verticalPlacedIconSymbolIndex&&St);q.placedIconSymbolIndex>=0&&(G(c.icon,q.numIconVertices,Vt?yt:On),c.icon.placedSymbolArray.get(q.placedIconSymbolIndex).hidden=ht.icon.isHidden()),q.verticalPlacedIconSymbolIndex>=0&&(G(c.icon,q.numVerticalIconVertices,Vt?On:yt),c.icon.placedSymbolArray.get(q.verticalPlacedIconSymbolIndex).hidden=ht.icon.isHidden())}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const yt=c.collisionArrays[H];if(yt){let Vt=new o.P(0,0);if(yt.textBox||yt.verticalTextBox){let ae=!0;if(b){const le=this.variableOffsets[et];le?(Vt=pi(le.anchor,le.width,le.height,le.textOffset,le.textBoxScale),C&&Vt._rotate(M?this.transform.angle:-this.transform.angle)):ae=!1}yt.textBox&&Ii(c.textCollisionBox.collisionVertexArray,ht.text.placed,!ae||St,Vt.x,Vt.y),yt.verticalTextBox&&Ii(c.textCollisionBox.collisionVertexArray,ht.text.placed,!ae||gt,Vt.x,Vt.y)}const $t=!!(!gt&&yt.verticalIconBox);yt.iconBox&&Ii(c.iconCollisionBox.collisionVertexArray,ht.icon.placed,$t,O?Vt.x:0,O?Vt.y:0),yt.verticalIconBox&&Ii(c.iconCollisionBox.collisionVertexArray,ht.icon.placed,!$t,O?Vt.x:0,O?Vt.y:0)}}}if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.text.opacityVertexArray.length!==c.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${c.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${c.text.layoutVertexArray.length}) / 4`);if(c.icon.opacityVertexArray.length!==c.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${c.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${c.icon.layoutVertexArray.length}) / 4`);if(c.bucketInstanceId in this.collisionCircleArrays){const H=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=H.invProjMatrix,c.placementViewportMatrix=H.viewportMatrix,c.collisionCircleArray=H.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,d){const y=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*y>c}setStale(){this.stale=!0}}function Ii(x,c,d,y,_){x.emplaceBack(c?1:0,d?1:0,y||0,_||0),x.emplaceBack(c?1:0,d?1:0,y||0,_||0),x.emplaceBack(c?1:0,d?1:0,y||0,_||0),x.emplaceBack(c?1:0,d?1:0,y||0,_||0)}const Zn=Math.pow(2,25),Nl=Math.pow(2,24),Qa=Math.pow(2,17),Rr=Math.pow(2,16),ds=Math.pow(2,9),fs=Math.pow(2,8),Ni=Math.pow(2,1);function $i(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;const c=x.placed?1:0,d=Math.floor(127*x.opacity);return d*Zn+c*Nl+d*Qa+c*Rr+d*ds+c*fs+d*Ni+c}const On=0;class Fi{constructor(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&!c.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(c,d,y,_,S){const B=this._bucketParts;for(;this._currentTileIndex<c.length;)if(d.getBucketParts(B,_,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,B.sort((k,g)=>k.sortKey-g.sortKey));this._currentPartIndex<B.length;)if(d.placeLayerBucketPart(B[this._currentPartIndex],this._seenCrossTileIDs,y),this._currentPartIndex++,S())return!0;return!1}}class Jn{constructor(c,d,y,_,S,B,k,g){this.placement=new Wi(c,d,B,k,g),this._currentPlacementIndex=y.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(c,d,y){const _=A.now(),S=()=>!this._forceFullPlacement&&A.now()-_>2;for(;this._currentPlacementIndex>=0;){const B=d[c[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(B.type==="symbol"&&(!B.minzoom||B.minzoom<=k)&&(!B.maxzoom||B.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new Fi(B)),this._inProgressLayer.continuePlacement(y[B.source],this.placement,this._showCollisionBoxes,B,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const xs=512/o.W/2;class To{constructor(c,d,y){this.tileID=c,this.bucketInstanceId=y,this._symbolsByKey={};const _=new Map;for(let S=0;S<d.length;S++){const B=d.get(S),k=B.key,g=_.get(k);g?g.push(B):_.set(k,[B])}for(const[S,B]of _){const k={positions:B.map(g=>({x:Math.floor(g.anchorX*xs),y:Math.floor(g.anchorY*xs)})),crossTileIDs:B.map(g=>g.crossTileID)};if(k.positions.length>128){const g=new o.au(k.positions.length,16,Uint16Array);for(const{x:b,y:C}of k.positions)g.add(b,C);g.finish(),delete k.positions,k.index=g}this._symbolsByKey[S]=k}}getScaledCoordinates(c,d){const{x:y,y:_,z:S}=this.tileID.canonical,{x:B,y:k,z:g}=d.canonical,b=xs/Math.pow(2,g-S),C=(k*o.W+c.anchorY)*b,M=_*o.W*xs;return{x:Math.floor((B*o.W+c.anchorX)*b-y*o.W*xs),y:Math.floor(C-M)}}findMatches(c,d,y){const _=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let S=0;S<c.length;S++){const B=c.get(S);if(B.crossTileID)continue;const k=this._symbolsByKey[B.key];if(!k)continue;const g=this.getScaledCoordinates(B,d);if(k.index){const b=k.index.range(g.x-_,g.y-_,g.x+_,g.y+_).sort();for(const C of b){const M=k.crossTileIDs[C];if(!y[M]){y[M]=!0,B.crossTileID=M;break}}}else if(k.positions)for(let b=0;b<k.positions.length;b++){const C=k.positions[b],M=k.crossTileIDs[b];if(Math.abs(C.x-g.x)<=_&&Math.abs(C.y-g.y)<=_&&!y[M]){y[M]=!0,B.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(c=>{let{crossTileIDs:d}=c;return d})}}class Sr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class js{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const d=Math.round((c-this.lng)/360);if(d!==0)for(const y in this.indexes){const _=this.indexes[y],S={};for(const B in _){const k=_[B];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+d),S[k.tileID.key]=k}this.indexes[y]=S}this.lng=c}addBucket(c,d,y){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let S=0;S<d.symbolInstances.length;S++)d.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});const _=this.usedCrossTileIDs[c.overscaledZ];for(const S in this.indexes){const B=this.indexes[S];if(Number(S)>c.overscaledZ)for(const k in B){const g=B[k];g.tileID.isChildOf(c)&&g.findMatches(d.symbolInstances,c,_)}else{const k=B[c.scaledTo(Number(S)).key];k&&k.findMatches(d.symbolInstances,c,_)}}for(let S=0;S<d.symbolInstances.length;S++){const B=d.symbolInstances.get(S);B.crossTileID||(B.crossTileID=y.generate(),_[B.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new To(c,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(c,d){for(const y of d.getCrossTileIDsLists())for(const _ of y)delete this.usedCrossTileIDs[c][_]}removeStaleBuckets(c){let d=!1;for(const y in this.indexes){const _=this.indexes[y];for(const S in _)c[_[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,_[S]),delete _[S],d=!0)}return d}}class ps{constructor(){this.layerIndexes={},this.crossTileIDs=new Sr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,d,y){let _=this.layerIndexes[c.id];_===void 0&&(_=this.layerIndexes[c.id]=new js);let S=!1;const B={};_.handleWrapJump(y);for(const k of d){const g=k.getBucket(c);g&&c.id===g.layerIds[0]&&(g.bucketInstanceId||(g.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(k.tileID,g,this.crossTileIDs)&&(S=!0),B[g.bucketInstanceId]=!0)}return _.removeStaleBuckets(B)&&(S=!0),S}pruneUnusedLayers(c){const d={};c.forEach(y=>{d[y]=!0});for(const y in this.layerIndexes)d[y]||delete this.layerIndexes[y]}}const gi=(x,c)=>o.t(x,c&&c.filter(d=>d.identifier!=="source.canvas")),eo=o.av();class xn extends o.E{constructor(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlPluginLoaded=()=>{for(const y in this.sourceCaches){const _=this.sourceCaches[y].getSource().type;_!=="vector"&&_!=="geojson"||this.sourceCaches[y].reload()}},this.map=c,this.dispatcher=new ne(Kt(),c._getMapId()),this.dispatcher.registerMessageHandler("GG",(y,_)=>this.getGlyphs(y,_)),this.dispatcher.registerMessageHandler("GI",(y,_)=>this.getImages(y,_)),this.imageManager=new kt,this.imageManager.setEventedParent(this),this.glyphManager=new he(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new xe(256,512),this.crossTileSymbolIndex=new ps,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",o.ax()),de().on(Mr,this._rtlPluginLoaded),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const _=this.sourceCaches[y.sourceId];if(!_)return;const S=_.getSource();if(S&&S.vectorLayerIds)for(const B in this._layers){const k=this._layers[B];k.source===S.id&&this._validateLayer(k)}})}loadURL(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const _=this.map._requestManager.transformRequest(c,"Style");this._loadStyleRequest=new AbortController,o.h(_,this._loadStyleRequest).then(S=>{this._loadStyleRequest=null,this._load(S.data,d,y)}).catch(S=>{this._loadStyleRequest=null,S&&this.fire(new o.j(S))})}loadJSON(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;this.fire(new o.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,A.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(c,d,y)}).catch(()=>{})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(eo,{validate:!1})}_load(c,d,y){var _;const S=d.transformStyle?d.transformStyle(y,c):c;if(!d.validate||!gi(this,o.x(S))){this._loaded=!0,this.stylesheet=S;for(const B in S.sources)this.addSource(B,S.sources[B],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new ee(this.stylesheet.light),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const c=o.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",c),this._order=c.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of c){const y=o.az(d);y.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=y}}_loadSprite(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,_;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(S,B,k,g){return o._(this,void 0,void 0,function*(){const b=Rt(S),C=k>1?"@2x":"",M={},O={};for(const{id:j,url:G}of b){const H=B.transformRequest(B.normalizeSpriteURL(G,C,".json"),"SpriteJSON");M[j]=o.h(H,g);const q=B.transformRequest(B.normalizeSpriteURL(G,C,".png"),"SpriteImage");O[j]=J.getImage(q,g)}return yield Promise.all([...Object.values(M),...Object.values(O)]),function(j,G){return o._(this,void 0,void 0,function*(){const H={};for(const q in j){H[q]={};const X=A.getImageCanvasContext((yield G[q]).data),ct=(yield j[q]).data;for(const et in ct){const{width:ht,height:ft,x:Mt,y:St,sdf:gt,pixelRatio:yt,stretchX:Vt,stretchY:$t,content:ae}=ct[et];H[q][et]={data:null,pixelRatio:yt,sdf:gt,stretchX:Vt,stretchY:$t,content:ae,spriteData:{width:ht,height:ft,x:Mt,y:St,context:X}}}}return H})}(M,O)})}(c,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(S=>{if(this._spriteRequest=null,S)for(const B in S){this._spritesImagesIds[B]=[];const k=this._spritesImagesIds[B]?this._spritesImagesIds[B].filter(g=>!(g in S)):[];for(const g of k)this.imageManager.removeImage(g),this._changedImages[g]=!0;for(const g in S[B]){const b=B==="default"?g:`${B}:${g}`;this._spritesImagesIds[B].push(b),b in this.imageManager.images?this.imageManager.updateImage(b,S[B][g],!1):this.imageManager.addImage(b,S[B][g]),d&&(this._changedImages[b]=!0)}}}).catch(S=>{this._spriteRequest=null,_=S,this.fire(new o.j(_))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),y&&y(_)})}_unloadSprite(){for(const c of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(c),this._changedImages[c]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(c){const d=this.sourceCaches[c.source];if(!d)return;const y=c.sourceLayer;if(!y)return;const _=d.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(y)===-1)&&this.fire(new o.j(new Error(`Source layer "${y}" does not exist on source "${_.id}" as specified by style layer "${c.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(c){const d=this._serializedAllLayers();if(!c||c.length===0)return Object.values(d);const y=[];for(const _ of c)d[_]&&y.push(d[_]);return y}_serializedAllLayers(){let c=this._serializedLayers;if(c)return c;c=this._serializedLayers={};const d=Object.keys(this._layers);for(const y of d){const _=this._layers[y];_.type!=="custom"&&(c[y]=_.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(c){if(!this._loaded)return;const d=this._changed;if(d){const _=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(_.length||S.length)&&this._updateWorkerLayers(_,S);for(const B in this._updatedSources){const k=this._updatedSources[B];if(k==="reload")this._reloadSource(B);else{if(k!=="clear")throw new Error(`Invalid action ${k}`);this._clearSource(B)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const B in this._updatedPaintProps)this._layers[B].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}const y={};for(const _ in this.sourceCaches){const S=this.sourceCaches[_];y[_]=S.used,S.used=!1}for(const _ of this._order){const S=this._layers[_];S.recalculate(c,this._availableImages),!S.isHidden(c.zoom)&&S.source&&(this.sourceCaches[S.source].used=!0)}for(const _ in y){const S=this.sourceCaches[_];!!y[_]!=!!S.used&&S.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const c in this.sourceCaches)this.sourceCaches[c].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(c,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(c),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var y;this._checkLoaded();const _=this.serialize();if(c=d.transformStyle?d.transformStyle(_,c):c,((y=d.validate)===null||y===void 0||y)&&gi(this,o.x(c)))return!1;(c=o.aA(c)).layers=o.ay(c.layers);const S=o.aB(_,c),B=this._getOperationsToPerform(S);if(B.unimplemented.length>0)throw new Error(`Unimplemented: ${B.unimplemented.join(", ")}.`);if(B.operations.length===0)return!1;for(const k of B.operations)k();return this.stylesheet=c,this._serializedLayers=null,!0}_getOperationsToPerform(c){const d=[],y=[];for(const _ of c)switch(_.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,_.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,_.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,_.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,_.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,_.args));break;case"addSource":d.push(()=>this.addSource.apply(this,_.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,_.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,_.args));break;case"setLight":d.push(()=>this.setLight.apply(this,_.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,_.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,_.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,_.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,_.args));break;case"setTransition":d.push(()=>{});break;default:y.push(_.command)}return{operations:d,unimplemented:y}}addImage(c,d){if(this.getImage(c))return this.fire(new o.j(new Error(`An image named "${c}" already exists.`)));this.imageManager.addImage(c,d),this._afterImageUpdated(c)}updateImage(c,d){this.imageManager.updateImage(c,d)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){if(!this.getImage(c))return this.fire(new o.j(new Error(`An image named "${c}" does not exist.`)));this.imageManager.removeImage(c),this._afterImageUpdated(c)}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(c,d){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error(`Source "${c}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(o.x.source,`sources.${c}`,d,null,y))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const _=this.sourceCaches[c]=new Pr(c,d,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:_.loaded(),source:_.serialize(),sourceId:c})),_.onAdd(this.map),this._changed=!0}removeSource(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===c)return this.fire(new o.j(new Error(`Source "${c}" cannot be removed while layer "${y}" is using it.`)));const d=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],d.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(c,d){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error(`There is no source with this ID=${c}`);const y=this.sourceCaches[c].getSource();if(y.type!=="geojson")throw new Error(`geojsonSource.type is ${y.type}, which is !== 'geojson`);y.setData(d),this._changed=!0}getSource(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()}addLayer(c,d){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const _=c.id;if(this.getLayer(_))return void this.fire(new o.j(new Error(`Layer "${_}" already exists on this map.`)));let S;if(c.type==="custom"){if(gi(this,o.aC(c)))return;S=o.az(c)}else{if("source"in c&&typeof c.source=="object"&&(this.addSource(_,c.source),c=o.aA(c),c=o.e(c,{source:_})),this._validate(o.x.layer,`layers.${_}`,c,{arrayIndex:-1},y))return;S=o.az(c),this._validateLayer(S),S.setEventedParent(this,{layer:{id:_}})}const B=d?this._order.indexOf(d):this._order.length;if(d&&B===-1)this.fire(new o.j(new Error(`Cannot add layer "${_}" before non-existing layer "${d}".`)));else{if(this._order.splice(B,0,_),this._layerOrderChanged=!0,this._layers[_]=S,this._removedLayers[_]&&S.source&&S.type!=="custom"){const k=this._removedLayers[_];delete this._removedLayers[_],k.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}moveLayer(c,d){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new o.j(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===d)return;const y=this._order.indexOf(c);this._order.splice(y,1);const _=d?this._order.indexOf(d):this._order.length;d&&_===-1?this.fire(new o.j(new Error(`Cannot move layer "${c}" before non-existing layer "${d}".`))):(this._order.splice(_,0,c),this._layerOrderChanged=!0)}removeLayer(c){this._checkLoaded();const d=this._layers[c];if(!d)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${c}".`)));d.setEventedParent(null);const y=this._order.indexOf(c);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],this._serializedLayers&&delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}getLayer(c){return this._layers[c]}getLayersOrder(){return[...this._order]}hasLayer(c){return c in this._layers}setLayerZoomRange(c,d,y){this._checkLoaded();const _=this.getLayer(c);_?_.minzoom===d&&_.maxzoom===y||(d!=null&&(_.minzoom=d),y!=null&&(_.maxzoom=y),this._updateLayer(_)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${c}".`)))}setFilter(c,d){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const _=this.getLayer(c);if(_){if(!o.aD(_.filter,d))return d==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(o.x.filter,`layers.${_.id}.filter`,d,null,y)||(_.filter=o.aA(d),this._updateLayer(_)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${c}".`)))}getFilter(c){return o.aA(this.getLayer(c).filter)}setLayoutProperty(c,d,y){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const S=this.getLayer(c);S?o.aD(S.getLayoutProperty(d),y)||(S.setLayoutProperty(d,y,_),this._updateLayer(S)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${c}".`)))}getLayoutProperty(c,d){const y=this.getLayer(c);if(y)return y.getLayoutProperty(d);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${c}".`)))}setPaintProperty(c,d,y){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const S=this.getLayer(c);S?o.aD(S.getPaintProperty(d),y)||(S.setPaintProperty(d,y,_)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[c]=!0,this._serializedLayers=null):this.fire(new o.j(new Error(`Cannot style non-existing layer "${c}".`)))}getPaintProperty(c,d){return this.getLayer(c).getPaintProperty(d)}setFeatureState(c,d){this._checkLoaded();const y=c.source,_=c.sourceLayer,S=this.sourceCaches[y];if(S===void 0)return void this.fire(new o.j(new Error(`The source '${y}' does not exist in the map's style.`)));const B=S.getSource().type;B==="geojson"&&_?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):B!=="vector"||_?(c.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),S.setFeatureState(_,c.id,d)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(c,d){this._checkLoaded();const y=c.source,_=this.sourceCaches[y];if(_===void 0)return void this.fire(new o.j(new Error(`The source '${y}' does not exist in the map's style.`)));const S=_.getSource().type,B=S==="vector"?c.sourceLayer:void 0;S!=="vector"||B?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(B,c.id,d):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(c){this._checkLoaded();const d=c.source,y=c.sourceLayer,_=this.sourceCaches[d];if(_!==void 0)return _.getSource().type!=="vector"||y?(c.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),_.getFeatureState(y,c.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const c=o.aE(this.sourceCaches,S=>S.serialize()),d=this._serializeByIds(this._order),y=this.map.getTerrain()||void 0,_=this.stylesheet;return o.aF({version:_.version,name:_.name,metadata:_.metadata,light:_.light,center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,sprite:_.sprite,glyphs:_.glyphs,transition:_.transition,sources:c,layers:d,terrain:y},S=>S!==void 0)}_updateLayer(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(c){const d=B=>this._layers[B].type==="fill-extrusion",y={},_=[];for(let B=this._order.length-1;B>=0;B--){const k=this._order[B];if(d(k)){y[k]=B;for(const g of c){const b=g[k];if(b)for(const C of b)_.push(C)}}}_.sort((B,k)=>k.intersectionZ-B.intersectionZ);const S=[];for(let B=this._order.length-1;B>=0;B--){const k=this._order[B];if(d(k))for(let g=_.length-1;g>=0;g--){const b=_[g].feature;if(y[b.layer.id]<B)break;S.push(b),_.pop()}else for(const g of c){const b=g[k];if(b)for(const C of b)S.push(C.feature)}}return S}queryRenderedFeatures(c,d,y){d&&d.filter&&this._validate(o.x.filter,"queryRenderedFeatures.filter",d.filter,null,d);const _={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const k of d.layers){const g=this._layers[k];if(!g)return this.fire(new o.j(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];_[g.source]=!0}}const S=[];d.availableImages=this._availableImages;const B=this._serializedAllLayers();for(const k in this.sourceCaches)d.layers&&!_[k]||S.push(Be(this.sourceCaches[k],this._layers,B,c,d,y));return this.placement&&S.push(function(k,g,b,C,M,O,j){const G={},H=O.queryRenderedSymbols(C),q=[];for(const X of Object.keys(H).map(Number))q.push(j[X]);q.sort(ze);for(const X of q){const ct=X.featureIndex.lookupSymbolFeatures(H[X.bucketInstanceId],g,X.bucketIndex,X.sourceLayerIndex,M.filter,M.layers,M.availableImages,k);for(const et in ct){const ht=G[et]=G[et]||[],ft=ct[et];ft.sort((Mt,St)=>{const gt=X.featureSortOrder;if(gt){const yt=gt.indexOf(Mt.featureIndex);return gt.indexOf(St.featureIndex)-yt}return St.featureIndex-Mt.featureIndex});for(const Mt of ft)ht.push(Mt)}}for(const X in G)G[X].forEach(ct=>{const et=ct.feature,ht=b[k[X].source].getFeatureState(et.layer["source-layer"],et.id);et.source=et.layer.source,et.layer["source-layer"]&&(et.sourceLayer=et.layer["source-layer"]),et.state=ht});return G}(this._layers,B,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(c,d){d&&d.filter&&this._validate(o.x.filter,"querySourceFeatures.filter",d.filter,null,d);const y=this.sourceCaches[c];return y?function(_,S){const B=_.getRenderableIds().map(b=>_.getTileByID(b)),k=[],g={};for(let b=0;b<B.length;b++){const C=B[b],M=C.tileID.canonical.key;g[M]||(g[M]=!0,C.querySourceFeatures(k,S))}return k}(y,d):[]}getLight(){return this.light.getLight()}setLight(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const y=this.light.getLight();let _=!1;for(const B in c)if(!o.aD(c[B],y[B])){_=!0;break}if(!_)return;const S={now:A.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(S)}_validate(c,d,y,_){let S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!S||S.validate!==!1)&&gi(this,c.call(o.x,o.e({key:d,style:this.serialize(),value:y,styleSpec:o.v},_)))}_remove(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),de().off(Mr,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const y=this.sourceCaches[d];y.setEventedParent(null),y.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),c&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(c)}_clearSource(c){this.sourceCaches[c].clearTiles()}_reloadSource(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()}_updateSources(c){for(const d in this.sourceCaches)this.sourceCaches[d].update(c,this.map.terrain)}_generateCollisionBoxes(){for(const c in this.sourceCaches)this._reloadSource(c)}_updatePlacement(c,d,y,_){let S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,B=!1,k=!1;const g={};for(const b of this._order){const C=this._layers[b];if(C.type!=="symbol")continue;if(!g[C.source]){const O=this.sourceCaches[C.source];g[C.source]=O.getRenderableIds(!0).map(j=>O.getTileByID(j)).sort((j,G)=>G.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(G.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(C,g[C.source],c.center.lng);B=B||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(A.now(),c.zoom))&&(this.pauseablePlacement=new Jn(c,this.map.terrain,this._order,S,d,y,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,g),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(A.now()),k=!0),B&&this.pauseablePlacement.placement.setStale()),k||B)for(const b of this._order){const C=this._layers[b];C.type==="symbol"&&this.placement.updateLayerOpacities(C,g[C.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(A.now())}_releaseSymbolFadeTiles(){for(const c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,d){return o._(this,void 0,void 0,function*(){const y=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const _=this.sourceCaches[d.source];return _&&_.setDependencies(d.tileID.key,d.type,d.icons),y})}getGlyphs(c,d){return o._(this,void 0,void 0,function*(){const y=yield this.glyphManager.getGlyphs(d.stacks),_=this.sourceCaches[d.source];return _&&_.setDependencies(d.tileID.key,d.type,[""]),y})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),c&&this._validate(o.x.glyphs,"glyphs",c,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=c,this.glyphManager.entries={},this.glyphManager.setURL(c))}addSprite(c,d){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},_=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const S=[{id:c,url:d}],B=[...Rt(this.stylesheet.sprite),...S];this._validate(o.x.sprite,"sprite",B,null,y)||(this.stylesheet.sprite=B,this._loadSprite(S,!0,_))}removeSprite(c){this._checkLoaded();const d=Rt(this.stylesheet.sprite);if(d.find(y=>y.id===c)){if(this._spritesImagesIds[c])for(const y of this._spritesImagesIds[c])this.imageManager.removeImage(y),this._changedImages[y]=!0;d.splice(d.findIndex(y=>y.id===c),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[c],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${c}" doesn't exists on this map.`)))}getSprite(){return Rt(this.stylesheet.sprite)}setSprite(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),c&&this._validate(o.x.sprite,"sprite",c,null,d)||(this.stylesheet.sprite=c,c?this._loadSprite(c,!0,y):(this._unloadSprite(),y&&y(null)))}}var An=o.X([{name:"a_pos",type:"Int16",components:2}]),zi="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const vn={prelude:Xr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Xr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Xr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Xr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Xr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Xr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Xr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Xr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Xr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Xr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Xr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Xr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Xr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Xr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Xr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Xr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Xr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Xr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Xr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Xr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Xr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Xr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Xr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Xr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Xr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",zi),terrainDepth:Xr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",zi),terrainCoords:Xr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",zi)};function Xr(x,c){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=c.match(/attribute ([\w]+) ([\w]+)/g),_=x.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),B=S?S.concat(_):_,k={};return{fragmentSource:x=x.replace(d,(g,b,C,M,O)=>(k[O]=!0,b==="define"?`
#ifndef HAS_UNIFORM_u_${O}
varying ${C} ${M} ${O};
#else
uniform ${C} ${M} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${C} ${M} ${O} = u_${O};
#endif
`)),vertexSource:c=c.replace(d,(g,b,C,M,O)=>{const j=M==="float"?"vec2":"vec4",G=O.match(/color/)?"color":j;return k[O]?b==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${C} ${j} a_${O};
varying ${C} ${M} ${O};
#else
uniform ${C} ${M} u_${O};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${C} ${M} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${G}(a_${O}, u_${O}_t);
#else
    ${C} ${M} ${O} = u_${O};
#endif
`:b==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${C} ${j} a_${O};
#else
uniform ${C} ${M} u_${O};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${C} ${M} ${O} = a_${O};
#else
    ${C} ${M} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${C} ${M} ${O} = unpack_mix_${G}(a_${O}, u_${O}_t);
#else
    ${C} ${M} ${O} = u_${O};
#endif
`}),staticAttributes:y,staticUniforms:B}}class Po{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(c,d,y,_,S,B,k,g,b){this.context=c;let C=this.boundPaintVertexBuffers.length!==_.length;for(let M=0;!C&&M<_.length;M++)this.boundPaintVertexBuffers[M]!==_[M]&&(C=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==y||C||this.boundIndexBuffer!==S||this.boundVertexOffset!==B||this.boundDynamicVertexBuffer!==k||this.boundDynamicVertexBuffer2!==g||this.boundDynamicVertexBuffer3!==b?this.freshBind(d,y,_,S,B,k,g,b):(c.bindVertexArray.set(this.vao),k&&k.bind(),S&&S.dynamicDraw&&S.bind(),g&&g.bind(),b&&b.bind())}freshBind(c,d,y,_,S,B,k,g){const b=c.numAttributes,C=this.context,M=C.gl;this.vao&&this.destroy(),this.vao=C.createVertexArray(),C.bindVertexArray.set(this.vao),this.boundProgram=c,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=_,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=B,this.boundDynamicVertexBuffer2=k,this.boundDynamicVertexBuffer3=g,d.enableAttributes(M,c);for(const O of y)O.enableAttributes(M,c);B&&B.enableAttributes(M,c),k&&k.enableAttributes(M,c),g&&g.enableAttributes(M,c),d.bind(),d.setVertexAttribPointers(M,c,S);for(const O of y)O.bind(),O.setVertexAttribPointers(M,c,S);B&&(B.bind(),B.setVertexAttribPointers(M,c,S)),_&&_.bind(),k&&(k.bind(),k.setVertexAttribPointers(M,c,S)),g&&(g.bind(),g.setVertexAttribPointers(M,c,S)),C.currentNumAttributes=b}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Io(x){const c=[];for(let d=0;d<x.length;d++){if(x[d]===null)continue;const y=x[d].split(" ");c.push(y.pop())}return c}class Us{constructor(c,d,y,_,S,B){const k=c.gl;this.program=k.createProgram();const g=Io(d.staticAttributes),b=y?y.getBinderAttributes():[],C=g.concat(b),M=vn.prelude.staticUniforms?Io(vn.prelude.staticUniforms):[],O=d.staticUniforms?Io(d.staticUniforms):[],j=y?y.getBinderUniforms():[],G=M.concat(O).concat(j),H=[];for(const Mt of G)H.indexOf(Mt)<0&&H.push(Mt);const q=y?y.defines():[];S&&q.push("#define OVERDRAW_INSPECTOR;"),B&&q.push("#define TERRAIN3D;");const X=q.concat(vn.prelude.fragmentSource,d.fragmentSource).join(`
`),ct=q.concat(vn.prelude.vertexSource,d.vertexSource).join(`
`),et=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(et,X),k.compileShader(et),!k.getShaderParameter(et,k.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${k.getShaderInfoLog(et)}`);k.attachShader(this.program,et);const ht=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(ht,ct),k.compileShader(ht),!k.getShaderParameter(ht,k.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${k.getShaderInfoLog(ht)}`);k.attachShader(this.program,ht),this.attributes={};const ft={};this.numAttributes=C.length;for(let Mt=0;Mt<this.numAttributes;Mt++)C[Mt]&&(k.bindAttribLocation(this.program,Mt,C[Mt]),this.attributes[C[Mt]]=Mt);if(k.linkProgram(this.program),!k.getProgramParameter(this.program,k.LINK_STATUS))throw new Error(`Program failed to link: ${k.getProgramInfoLog(this.program)}`);k.deleteShader(ht),k.deleteShader(et);for(let Mt=0;Mt<H.length;Mt++){const St=H[Mt];if(St&&!ft[St]){const gt=k.getUniformLocation(this.program,St);gt&&(ft[St]=gt)}}this.fixedUniforms=_(c,ft),this.terrainUniforms=((Mt,St)=>({u_depth:new o.aG(Mt,St.u_depth),u_terrain:new o.aG(Mt,St.u_terrain),u_terrain_dim:new o.aH(Mt,St.u_terrain_dim),u_terrain_matrix:new o.aI(Mt,St.u_terrain_matrix),u_terrain_unpack:new o.aJ(Mt,St.u_terrain_unpack),u_terrain_exaggeration:new o.aH(Mt,St.u_terrain_exaggeration)}))(c,ft),this.binderUniforms=y?y.getUniforms(c,ft):[]}draw(c,d,y,_,S,B,k,g,b,C,M,O,j,G,H,q,X,ct){const et=c.gl;if(this.failedToCreate)return;if(c.program.set(this.program),c.setDepthMode(y),c.setStencilMode(_),c.setColorMode(S),c.setCullFace(B),g){c.activeTexture.set(et.TEXTURE2),et.bindTexture(et.TEXTURE_2D,g.depthTexture),c.activeTexture.set(et.TEXTURE3),et.bindTexture(et.TEXTURE_2D,g.texture);for(const ft in this.terrainUniforms)this.terrainUniforms[ft].set(g[ft])}for(const ft in this.fixedUniforms)this.fixedUniforms[ft].set(k[ft]);H&&H.setUniforms(c,this.binderUniforms,j,{zoom:G});let ht=0;switch(d){case et.LINES:ht=2;break;case et.TRIANGLES:ht=3;break;case et.LINE_STRIP:ht=1}for(const ft of O.get()){const Mt=ft.vaos||(ft.vaos={});(Mt[b]||(Mt[b]=new Po)).bind(c,this,C,H?H.getPaintVertexBuffers():[],M,ft.vertexOffset,q,X,ct),et.drawElements(d,ft.primitiveLength*ht,et.UNSIGNED_SHORT,ft.primitiveOffset*ht*2)}}}function tl(x,c,d){const y=1/sr(d,1,c.transform.tileZoom),_=Math.pow(2,d.tileID.overscaledZ),S=d.tileSize*Math.pow(2,c.transform.tileZoom)/_,B=S*(d.tileID.canonical.x+d.tileID.wrap*_),k=S*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[y,x.fromScale,x.toScale],u_fade:x.t,u_pixel_coord_upper:[B>>16,k>>16],u_pixel_coord_lower:[65535&B,65535&k]}}const st=(x,c,d,y)=>{const _=c.style.light,S=_.properties.get("position"),B=[S.x,S.y,S.z],k=function(){var b=new o.A(9);return o.A!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[5]=0,b[6]=0,b[7]=0),b[0]=1,b[4]=1,b[8]=1,b}();_.properties.get("anchor")==="viewport"&&function(b,C){var M=Math.sin(C),O=Math.cos(C);b[0]=O,b[1]=M,b[2]=0,b[3]=-M,b[4]=O,b[5]=0,b[6]=0,b[7]=0,b[8]=1}(k,-c.transform.angle),function(b,C,M){var O=C[0],j=C[1],G=C[2];b[0]=O*M[0]+j*M[3]+G*M[6],b[1]=O*M[1]+j*M[4]+G*M[7],b[2]=O*M[2]+j*M[5]+G*M[8]}(B,B,k);const g=_.properties.get("color");return{u_matrix:x,u_lightpos:B,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[g.r,g.g,g.b],u_vertical_gradient:+d,u_opacity:y}},vt=(x,c,d,y,_,S,B)=>o.e(st(x,c,d,y),tl(S,c,B),{u_height_factor:-Math.pow(2,_.overscaledZ)/B.tileSize/8}),jt=x=>({u_matrix:x}),pe=(x,c,d,y)=>o.e(jt(x),tl(d,c,y)),Ee=(x,c)=>({u_matrix:x,u_world:c}),yr=(x,c,d,y,_)=>o.e(pe(x,c,d,y),{u_world:_}),Br=(x,c,d,y)=>{const _=x.transform;let S,B;if(y.paint.get("circle-pitch-alignment")==="map"){const k=sr(d,1,_.zoom);S=!0,B=[k,k]}else S=!1,B=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(y.paint.get("circle-pitch-scale")==="map"),u_matrix:x.translatePosMatrix(c.posMatrix,d,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:x.pixelRatio,u_extrude_scale:B}},mi=(x,c,d)=>{const y=sr(d,1,c.zoom),_=Math.pow(2,c.zoom-d.tileID.overscaledZ),S=d.tileID.overscaleFactor();return{u_matrix:x,u_camera_to_center_distance:c.cameraToCenterDistance,u_pixels_to_tile_units:y,u_extrude_scale:[c.pixelsToGLUnits[0]/(y*_),c.pixelsToGLUnits[1]/(y*_)],u_overscale_factor:S}},Sn=function(x,c){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:x,u_color:c,u_overlay:0,u_overlay_scale:d}},un=x=>({u_matrix:x}),Ti=(x,c,d,y)=>({u_matrix:x,u_extrude_scale:sr(c,1,d),u_intensity:y});function _h(x,c){const d=Math.pow(2,c.canonical.z),y=c.canonical.y;return[new o.Y(0,y/d).toLngLat().lat,new o.Y(0,(y+1)/d).toLngLat().lat]}const Fl=(x,c,d,y)=>{const _=x.transform;return{u_matrix:el(x,c,d,y),u_ratio:1/sr(c,1,_.zoom),u_device_pixel_ratio:x.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},kr=(x,c,d,y,_)=>o.e(Fl(x,c,d,_),{u_image:0,u_image_height:y}),Sa=(x,c,d,y,_)=>{const S=x.transform,B=on(c,S);return{u_matrix:el(x,c,d,_),u_texsize:c.imageAtlasTexture.size,u_ratio:1/sr(c,1,S.zoom),u_device_pixel_ratio:x.pixelRatio,u_image:0,u_scale:[B,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Rc=(x,c,d,y,_,S)=>{const B=x.lineAtlas,k=on(c,x.transform),g=d.layout.get("line-cap")==="round",b=B.getDash(y.from,g),C=B.getDash(y.to,g),M=b.width*_.fromScale,O=C.width*_.toScale;return o.e(Fl(x,c,d,S),{u_patternscale_a:[k/M,-b.height/2],u_patternscale_b:[k/O,-C.height/2],u_sdfgamma:B.width/(256*Math.min(M,O)*x.pixelRatio)/2,u_image:0,u_tex_y_a:b.y,u_tex_y_b:C.y,u_mix:_.t})};function on(x,c){return 1/sr(x,1,c.tileZoom)}function el(x,c,d,y){return x.translatePosMatrix(y?y.posMatrix:c.tileID.posMatrix,c,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const zl=(x,c,d,y,_)=>{return{u_matrix:x,u_tl_parent:c,u_scale_parent:d,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(B=_.paint.get("raster-saturation"),B>0?1-1/(1.001-B):-B),u_contrast_factor:(S=_.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:ta(_.paint.get("raster-hue-rotate"))};var S,B};function ta(x){x*=Math.PI/180;const c=Math.sin(x),d=Math.cos(x);return[(2*d+1)/3,(-Math.sqrt(3)*c-d+1)/3,(Math.sqrt(3)*c-d+1)/3]}const Ea=(x,c,d,y,_,S,B,k,g,b)=>{const C=_.transform;return{u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:C.cameraToCenterDistance,u_pitch:C.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:C.width/C.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:B,u_coord_matrix:k,u_is_text:+g,u_pitch_with_map:+y,u_texsize:b,u_texture:0}},jl=(x,c,d,y,_,S,B,k,g,b,C)=>{const M=_.transform;return o.e(Ea(x,c,d,y,_,S,B,k,g,b),{u_gamma_scale:y?Math.cos(M._pitch)*M.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+C})},Ul=(x,c,d,y,_,S,B,k,g,b)=>o.e(jl(x,c,d,y,_,S,B,k,!0,g,!0),{u_texsize_icon:b,u_texture_icon:1}),Pd=(x,c,d)=>({u_matrix:x,u_opacity:c,u_color:d}),bu=(x,c,d,y,_,S)=>o.e(function(B,k,g,b){const C=g.imageManager.getPattern(B.from.toString()),M=g.imageManager.getPattern(B.to.toString()),{width:O,height:j}=g.imageManager.getPixelSize(),G=Math.pow(2,b.tileID.overscaledZ),H=b.tileSize*Math.pow(2,g.transform.tileZoom)/G,q=H*(b.tileID.canonical.x+b.tileID.wrap*G),X=H*b.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[O,j],u_mix:k.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/sr(b,1,g.transform.tileZoom),u_pixel_coord_upper:[q>>16,X>>16],u_pixel_coord_lower:[65535&q,65535&X]}}(y,S,d,_),{u_matrix:x,u_opacity:c}),rl={fillExtrusion:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_lightpos:new o.aK(x,c.u_lightpos),u_lightintensity:new o.aH(x,c.u_lightintensity),u_lightcolor:new o.aK(x,c.u_lightcolor),u_vertical_gradient:new o.aH(x,c.u_vertical_gradient),u_opacity:new o.aH(x,c.u_opacity)}),fillExtrusionPattern:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_lightpos:new o.aK(x,c.u_lightpos),u_lightintensity:new o.aH(x,c.u_lightintensity),u_lightcolor:new o.aK(x,c.u_lightcolor),u_vertical_gradient:new o.aH(x,c.u_vertical_gradient),u_height_factor:new o.aH(x,c.u_height_factor),u_image:new o.aG(x,c.u_image),u_texsize:new o.aL(x,c.u_texsize),u_pixel_coord_upper:new o.aL(x,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aL(x,c.u_pixel_coord_lower),u_scale:new o.aK(x,c.u_scale),u_fade:new o.aH(x,c.u_fade),u_opacity:new o.aH(x,c.u_opacity)}),fill:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix)}),fillPattern:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_image:new o.aG(x,c.u_image),u_texsize:new o.aL(x,c.u_texsize),u_pixel_coord_upper:new o.aL(x,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aL(x,c.u_pixel_coord_lower),u_scale:new o.aK(x,c.u_scale),u_fade:new o.aH(x,c.u_fade)}),fillOutline:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_world:new o.aL(x,c.u_world)}),fillOutlinePattern:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_world:new o.aL(x,c.u_world),u_image:new o.aG(x,c.u_image),u_texsize:new o.aL(x,c.u_texsize),u_pixel_coord_upper:new o.aL(x,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aL(x,c.u_pixel_coord_lower),u_scale:new o.aK(x,c.u_scale),u_fade:new o.aH(x,c.u_fade)}),circle:(x,c)=>({u_camera_to_center_distance:new o.aH(x,c.u_camera_to_center_distance),u_scale_with_map:new o.aG(x,c.u_scale_with_map),u_pitch_with_map:new o.aG(x,c.u_pitch_with_map),u_extrude_scale:new o.aL(x,c.u_extrude_scale),u_device_pixel_ratio:new o.aH(x,c.u_device_pixel_ratio),u_matrix:new o.aI(x,c.u_matrix)}),collisionBox:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_camera_to_center_distance:new o.aH(x,c.u_camera_to_center_distance),u_pixels_to_tile_units:new o.aH(x,c.u_pixels_to_tile_units),u_extrude_scale:new o.aL(x,c.u_extrude_scale),u_overscale_factor:new o.aH(x,c.u_overscale_factor)}),collisionCircle:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_inv_matrix:new o.aI(x,c.u_inv_matrix),u_camera_to_center_distance:new o.aH(x,c.u_camera_to_center_distance),u_viewport_size:new o.aL(x,c.u_viewport_size)}),debug:(x,c)=>({u_color:new o.aM(x,c.u_color),u_matrix:new o.aI(x,c.u_matrix),u_overlay:new o.aG(x,c.u_overlay),u_overlay_scale:new o.aH(x,c.u_overlay_scale)}),clippingMask:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix)}),heatmap:(x,c)=>({u_extrude_scale:new o.aH(x,c.u_extrude_scale),u_intensity:new o.aH(x,c.u_intensity),u_matrix:new o.aI(x,c.u_matrix)}),heatmapTexture:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_world:new o.aL(x,c.u_world),u_image:new o.aG(x,c.u_image),u_color_ramp:new o.aG(x,c.u_color_ramp),u_opacity:new o.aH(x,c.u_opacity)}),hillshade:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_image:new o.aG(x,c.u_image),u_latrange:new o.aL(x,c.u_latrange),u_light:new o.aL(x,c.u_light),u_shadow:new o.aM(x,c.u_shadow),u_highlight:new o.aM(x,c.u_highlight),u_accent:new o.aM(x,c.u_accent)}),hillshadePrepare:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_image:new o.aG(x,c.u_image),u_dimension:new o.aL(x,c.u_dimension),u_zoom:new o.aH(x,c.u_zoom),u_unpack:new o.aJ(x,c.u_unpack)}),line:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_ratio:new o.aH(x,c.u_ratio),u_device_pixel_ratio:new o.aH(x,c.u_device_pixel_ratio),u_units_to_pixels:new o.aL(x,c.u_units_to_pixels)}),lineGradient:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_ratio:new o.aH(x,c.u_ratio),u_device_pixel_ratio:new o.aH(x,c.u_device_pixel_ratio),u_units_to_pixels:new o.aL(x,c.u_units_to_pixels),u_image:new o.aG(x,c.u_image),u_image_height:new o.aH(x,c.u_image_height)}),linePattern:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_texsize:new o.aL(x,c.u_texsize),u_ratio:new o.aH(x,c.u_ratio),u_device_pixel_ratio:new o.aH(x,c.u_device_pixel_ratio),u_image:new o.aG(x,c.u_image),u_units_to_pixels:new o.aL(x,c.u_units_to_pixels),u_scale:new o.aK(x,c.u_scale),u_fade:new o.aH(x,c.u_fade)}),lineSDF:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_ratio:new o.aH(x,c.u_ratio),u_device_pixel_ratio:new o.aH(x,c.u_device_pixel_ratio),u_units_to_pixels:new o.aL(x,c.u_units_to_pixels),u_patternscale_a:new o.aL(x,c.u_patternscale_a),u_patternscale_b:new o.aL(x,c.u_patternscale_b),u_sdfgamma:new o.aH(x,c.u_sdfgamma),u_image:new o.aG(x,c.u_image),u_tex_y_a:new o.aH(x,c.u_tex_y_a),u_tex_y_b:new o.aH(x,c.u_tex_y_b),u_mix:new o.aH(x,c.u_mix)}),raster:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_tl_parent:new o.aL(x,c.u_tl_parent),u_scale_parent:new o.aH(x,c.u_scale_parent),u_buffer_scale:new o.aH(x,c.u_buffer_scale),u_fade_t:new o.aH(x,c.u_fade_t),u_opacity:new o.aH(x,c.u_opacity),u_image0:new o.aG(x,c.u_image0),u_image1:new o.aG(x,c.u_image1),u_brightness_low:new o.aH(x,c.u_brightness_low),u_brightness_high:new o.aH(x,c.u_brightness_high),u_saturation_factor:new o.aH(x,c.u_saturation_factor),u_contrast_factor:new o.aH(x,c.u_contrast_factor),u_spin_weights:new o.aK(x,c.u_spin_weights)}),symbolIcon:(x,c)=>({u_is_size_zoom_constant:new o.aG(x,c.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aG(x,c.u_is_size_feature_constant),u_size_t:new o.aH(x,c.u_size_t),u_size:new o.aH(x,c.u_size),u_camera_to_center_distance:new o.aH(x,c.u_camera_to_center_distance),u_pitch:new o.aH(x,c.u_pitch),u_rotate_symbol:new o.aG(x,c.u_rotate_symbol),u_aspect_ratio:new o.aH(x,c.u_aspect_ratio),u_fade_change:new o.aH(x,c.u_fade_change),u_matrix:new o.aI(x,c.u_matrix),u_label_plane_matrix:new o.aI(x,c.u_label_plane_matrix),u_coord_matrix:new o.aI(x,c.u_coord_matrix),u_is_text:new o.aG(x,c.u_is_text),u_pitch_with_map:new o.aG(x,c.u_pitch_with_map),u_texsize:new o.aL(x,c.u_texsize),u_texture:new o.aG(x,c.u_texture)}),symbolSDF:(x,c)=>({u_is_size_zoom_constant:new o.aG(x,c.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aG(x,c.u_is_size_feature_constant),u_size_t:new o.aH(x,c.u_size_t),u_size:new o.aH(x,c.u_size),u_camera_to_center_distance:new o.aH(x,c.u_camera_to_center_distance),u_pitch:new o.aH(x,c.u_pitch),u_rotate_symbol:new o.aG(x,c.u_rotate_symbol),u_aspect_ratio:new o.aH(x,c.u_aspect_ratio),u_fade_change:new o.aH(x,c.u_fade_change),u_matrix:new o.aI(x,c.u_matrix),u_label_plane_matrix:new o.aI(x,c.u_label_plane_matrix),u_coord_matrix:new o.aI(x,c.u_coord_matrix),u_is_text:new o.aG(x,c.u_is_text),u_pitch_with_map:new o.aG(x,c.u_pitch_with_map),u_texsize:new o.aL(x,c.u_texsize),u_texture:new o.aG(x,c.u_texture),u_gamma_scale:new o.aH(x,c.u_gamma_scale),u_device_pixel_ratio:new o.aH(x,c.u_device_pixel_ratio),u_is_halo:new o.aG(x,c.u_is_halo)}),symbolTextAndIcon:(x,c)=>({u_is_size_zoom_constant:new o.aG(x,c.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aG(x,c.u_is_size_feature_constant),u_size_t:new o.aH(x,c.u_size_t),u_size:new o.aH(x,c.u_size),u_camera_to_center_distance:new o.aH(x,c.u_camera_to_center_distance),u_pitch:new o.aH(x,c.u_pitch),u_rotate_symbol:new o.aG(x,c.u_rotate_symbol),u_aspect_ratio:new o.aH(x,c.u_aspect_ratio),u_fade_change:new o.aH(x,c.u_fade_change),u_matrix:new o.aI(x,c.u_matrix),u_label_plane_matrix:new o.aI(x,c.u_label_plane_matrix),u_coord_matrix:new o.aI(x,c.u_coord_matrix),u_is_text:new o.aG(x,c.u_is_text),u_pitch_with_map:new o.aG(x,c.u_pitch_with_map),u_texsize:new o.aL(x,c.u_texsize),u_texsize_icon:new o.aL(x,c.u_texsize_icon),u_texture:new o.aG(x,c.u_texture),u_texture_icon:new o.aG(x,c.u_texture_icon),u_gamma_scale:new o.aH(x,c.u_gamma_scale),u_device_pixel_ratio:new o.aH(x,c.u_device_pixel_ratio),u_is_halo:new o.aG(x,c.u_is_halo)}),background:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_opacity:new o.aH(x,c.u_opacity),u_color:new o.aM(x,c.u_color)}),backgroundPattern:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_opacity:new o.aH(x,c.u_opacity),u_image:new o.aG(x,c.u_image),u_pattern_tl_a:new o.aL(x,c.u_pattern_tl_a),u_pattern_br_a:new o.aL(x,c.u_pattern_br_a),u_pattern_tl_b:new o.aL(x,c.u_pattern_tl_b),u_pattern_br_b:new o.aL(x,c.u_pattern_br_b),u_texsize:new o.aL(x,c.u_texsize),u_mix:new o.aH(x,c.u_mix),u_pattern_size_a:new o.aL(x,c.u_pattern_size_a),u_pattern_size_b:new o.aL(x,c.u_pattern_size_b),u_scale_a:new o.aH(x,c.u_scale_a),u_scale_b:new o.aH(x,c.u_scale_b),u_pixel_coord_upper:new o.aL(x,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aL(x,c.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aH(x,c.u_tile_units_to_pixels)}),terrain:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_texture:new o.aG(x,c.u_texture),u_ele_delta:new o.aH(x,c.u_ele_delta)}),terrainDepth:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_ele_delta:new o.aH(x,c.u_ele_delta)}),terrainCoords:(x,c)=>({u_matrix:new o.aI(x,c.u_matrix),u_texture:new o.aG(x,c.u_texture),u_terrain_coords_id:new o.aH(x,c.u_terrain_coords_id),u_ele_delta:new o.aH(x,c.u_ele_delta)})};class il{constructor(c,d,y){this.context=c;const _=c.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ca={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ea{constructor(c,d,y,_){this.length=d.length,this.attributes=y,this.itemSize=d.bytesPerElement,this.dynamicDraw=_,this.context=c;const S=c.gl;this.buffer=S.createBuffer(),c.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){if(c.length!==this.length)throw new Error(`Length of new data is ${c.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,d){for(let y=0;y<this.attributes.length;y++){const _=d.attributes[this.attributes[y].name];_!==void 0&&c.enableVertexAttribArray(_)}}setVertexAttribPointers(c,d,y){for(let _=0;_<this.attributes.length;_++){const S=this.attributes[_],B=d.attributes[S.name];B!==void 0&&c.vertexAttribPointer(B,S.components,c[Ca[S.type]],!1,this.itemSize,S.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const En=new WeakMap;function hn(x){var c;if(En.has(x))return En.get(x);{const d=(c=x.getParameter(x.VERSION))===null||c===void 0?void 0:c.startsWith("WebGL 2.0");return En.set(x,d),d}}class Kr{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Gl extends Kr{getDefault(){return o.aO.transparent}set(c){const d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Vl extends Kr{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Oc extends Kr{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class Mo extends Kr{getDefault(){return[!0,!0,!0,!0]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Lo extends Kr{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class wu extends Kr{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class ra extends Kr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class As extends Kr{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class Dc extends Kr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}}class nl extends Kr{getDefault(){return[0,1]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class sl extends Kr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}}class Nc extends Kr{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class Id extends Kr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}}class xu extends Kr{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class Au extends Kr{getDefault(){return o.aO.transparent}set(c){const d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class vh extends Kr{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class Fc extends Kr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}}class ql extends Kr{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class ol extends Kr{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}class zc extends Kr{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}}class Su extends Kr{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class Bo extends Kr{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class al extends Kr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class jc extends Kr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class ia extends Kr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class ko extends Kr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class D extends Kr{getDefault(){return null}set(c){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class tt extends Kr{getDefault(){return null}set(c){var d;if(c===this.current&&!this.dirty)return;const y=this.gl;hn(y)?y.bindVertexArray(c):(d=y.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(c),this.current=c,this.dirty=!1}}class It extends Kr{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class qt extends Kr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class te extends Kr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class ie extends Kr{constructor(c,d){super(c),this.context=c,this.parent=d}getDefault(){return null}}class Me extends ie{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class er extends ie{set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Ar extends ie{set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Lr{constructor(c,d,y,_,S){this.context=c,this.width=d,this.height=y;const B=c.gl,k=this.framebuffer=B.createFramebuffer();if(this.colorAttachment=new Me(c,k),_)this.depthAttachment=S?new Ar(c,k):new er(c,k);else if(S)throw new Error("Stencil cannot be set without depth");if(B.checkFramebufferStatus(B.FRAMEBUFFER)!==B.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const c=this.context.gl,d=this.colorAttachment.get();if(d&&c.deleteTexture(d),this.depthAttachment){const y=this.depthAttachment.get();y&&c.deleteRenderbuffer(y)}c.deleteFramebuffer(this.framebuffer)}}class dr{constructor(c,d,y){this.blendFunction=c,this.blendColor=d,this.mask=y}}dr.Replace=[1,0],dr.disabled=new dr(dr.Replace,o.aO.transparent,[!1,!1,!1,!1]),dr.unblended=new dr(dr.Replace,o.aO.transparent,[!0,!0,!0,!0]),dr.alphaBlended=new dr([1,771],o.aO.transparent,[!0,!0,!0,!0]);class si{constructor(c){var d,y;if(this.gl=c,this.clearColor=new Gl(this),this.clearDepth=new Vl(this),this.clearStencil=new Oc(this),this.colorMask=new Mo(this),this.depthMask=new Lo(this),this.stencilMask=new wu(this),this.stencilFunc=new ra(this),this.stencilOp=new As(this),this.stencilTest=new Dc(this),this.depthRange=new nl(this),this.depthTest=new sl(this),this.depthFunc=new Nc(this),this.blend=new Id(this),this.blendFunc=new xu(this),this.blendColor=new Au(this),this.blendEquation=new vh(this),this.cullFace=new Fc(this),this.cullFaceSide=new ql(this),this.frontFace=new ol(this),this.program=new zc(this),this.activeTexture=new Su(this),this.viewport=new Bo(this),this.bindFramebuffer=new al(this),this.bindRenderbuffer=new jc(this),this.bindTexture=new ia(this),this.bindVertexBuffer=new ko(this),this.bindElementBuffer=new D(this),this.bindVertexArray=new tt(this),this.pixelStoreUnpack=new It(this),this.pixelStoreUnpackPremultiplyAlpha=new qt(this),this.pixelStoreUnpackFlipY=new te(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE),hn(c)){this.HALF_FLOAT=c.HALF_FLOAT;const _=c.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=c.RGBA16F)!==null&&d!==void 0?d:_==null?void 0:_.RGBA16F_EXT,this.RGB16F=(y=c.RGB16F)!==null&&y!==void 0?y:_==null?void 0:_.RGB16F_EXT,c.getExtension("EXT_color_buffer_float")}else{c.getExtension("EXT_color_buffer_half_float"),c.getExtension("OES_texture_half_float_linear");const _=c.getExtension("OES_texture_half_float");this.HALF_FLOAT=_==null?void 0:_.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,d){return new il(this,c,d)}createVertexBuffer(c,d,y){return new ea(this,c,d,y)}createRenderbuffer(c,d,y){const _=this.gl,S=_.createRenderbuffer();return this.bindRenderbuffer.set(S),_.renderbufferStorage(_.RENDERBUFFER,c,d,y),this.bindRenderbuffer.set(null),S}createFramebuffer(c,d,y,_){return new Lr(this,c,d,y,_)}clear(c){let{color:d,depth:y,stencil:_}=c;const S=this.gl;let B=0;d&&(B|=S.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),y!==void 0&&(B|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(y),this.depthMask.set(!0)),_!==void 0&&(B|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),S.clear(B)}setCullFace(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){o.aD(c.blendFunction,dr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}createVertexArray(){var c;return hn(this.gl)?this.gl.createVertexArray():(c=this.gl.getExtension("OES_vertex_array_object"))===null||c===void 0?void 0:c.createVertexArrayOES()}deleteVertexArray(c){var d;return hn(this.gl)?this.gl.deleteVertexArray(c):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(c)}unbindVAO(){this.bindVertexArray.set(null)}}class fr{constructor(c,d,y){this.func=c,this.mask=d,this.range=y}}fr.ReadOnly=!1,fr.ReadWrite=!0,fr.disabled=new fr(519,fr.ReadOnly,[0,1]);const Qi=7680;class Or{constructor(c,d,y,_,S,B){this.test=c,this.ref=d,this.mask=y,this.fail=_,this.depthFail=S,this.pass=B}}Or.disabled=new Or({func:519,mask:0},0,0,Qi,Qi,Qi);class jr{constructor(c,d,y){this.enable=c,this.mode=d,this.frontFace=y}}let Zi;function Ss(x,c,d,y,_,S,B){const k=x.context,g=k.gl,b=x.useProgram("collisionBox"),C=[];let M=0,O=0;for(let et=0;et<y.length;et++){const ht=y[et],ft=c.getTile(ht),Mt=ft.getBucket(d);if(!Mt)continue;let St=ht.posMatrix;_[0]===0&&_[1]===0||(St=x.translatePosMatrix(ht.posMatrix,ft,_,S));const gt=B?Mt.textCollisionBox:Mt.iconCollisionBox,yt=Mt.collisionCircleArray;if(yt.length>0){const Vt=o.F(),$t=St;o.aP(Vt,Mt.placementInvProjMatrix,x.transform.glCoordMatrix),o.aP(Vt,Vt,Mt.placementViewportMatrix),C.push({circleArray:yt,circleOffset:O,transform:$t,invTransform:Vt,coord:ht}),M+=yt.length/4,O=M}gt&&b.draw(k,g.LINES,fr.disabled,Or.disabled,x.colorModeForRenderPass(),jr.disabled,mi(St,x.transform,ft),x.style.map.terrain&&x.style.map.terrain.getTerrainData(ht),d.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,null,x.transform.zoom,null,null,gt.collisionVertexBuffer)}if(!B||!C.length)return;const j=x.useProgram("collisionCircle"),G=new o.aQ;G.resize(4*M),G._trim();let H=0;for(const et of C)for(let ht=0;ht<et.circleArray.length/4;ht++){const ft=4*ht,Mt=et.circleArray[ft+0],St=et.circleArray[ft+1],gt=et.circleArray[ft+2],yt=et.circleArray[ft+3];G.emplace(H++,Mt,St,gt,yt,0),G.emplace(H++,Mt,St,gt,yt,1),G.emplace(H++,Mt,St,gt,yt,2),G.emplace(H++,Mt,St,gt,yt,3)}(!Zi||Zi.length<2*M)&&(Zi=function(et){const ht=2*et,ft=new o.aS;ft.resize(ht),ft._trim();for(let Mt=0;Mt<ht;Mt++){const St=6*Mt;ft.uint16[St+0]=4*Mt+0,ft.uint16[St+1]=4*Mt+1,ft.uint16[St+2]=4*Mt+2,ft.uint16[St+3]=4*Mt+2,ft.uint16[St+4]=4*Mt+3,ft.uint16[St+5]=4*Mt+0}return ft}(M));const q=k.createIndexBuffer(Zi,!0),X=k.createVertexBuffer(G,o.aR.members,!0);for(const et of C){const ht={u_matrix:et.transform,u_inv_matrix:et.invTransform,u_camera_to_center_distance:(ct=x.transform).cameraToCenterDistance,u_viewport_size:[ct.width,ct.height]};j.draw(k,g.TRIANGLES,fr.disabled,Or.disabled,x.colorModeForRenderPass(),jr.disabled,ht,x.style.map.terrain&&x.style.map.terrain.getTerrainData(et.coord),d.id,X,q,o.$.simpleSegment(0,2*et.circleOffset,et.circleArray.length,et.circleArray.length/2),null,x.transform.zoom,null,null,null)}var ct;X.destroy(),q.destroy()}jr.disabled=new jr(!1,1029,2305),jr.backCCW=new jr(!0,1029,2305);const Es=o.an(new Float32Array(16));function na(x,c,d,y,_,S){const{horizontalAlign:B,verticalAlign:k}=o.at(x);return new o.P((-(B-.5)*c/_+y[0])*S,(-(k-.5)*d/_+y[1])*S)}function Hl(x,c,d,y,_,S,B,k,g,b,C){const M=x.text.placedSymbolArray,O=x.text.dynamicLayoutVertexArray,j=x.icon.dynamicLayoutVertexArray,G={};O.clear();for(let H=0;H<M.length;H++){const q=M.get(H),X=q.hidden||!q.crossTileID||x.allowVerticalPlacement&&!q.placedOrientation?null:y[q.crossTileID];if(X){const ct=new o.P(q.anchorX,q.anchorY),et=ai(ct,d?B:S,C),ht=At(_.cameraToCenterDistance,et.signedDistanceFromCamera);let ft=o.ai(x.textSizeData,g,q)*ht/o.ao;d&&(ft*=x.tilePixelRatio/k);const{width:Mt,height:St,anchor:gt,textOffset:yt,textBoxScale:Vt}=X,$t=na(gt,Mt,St,yt,Vt,ft),ae=d?ai(ct.add($t),S,C).point:et.point.add(c?$t.rotate(-_.angle):$t),le=x.allowVerticalPlacement&&q.placedOrientation===o.ah.vertical?Math.PI/2:0;for(let me=0;me<q.numGlyphs;me++)o.aj(O,ae,le);b&&q.associatedIconIndex>=0&&(G[q.associatedIconIndex]={shiftedAnchor:ae,angle:le})}else ce(q.numGlyphs,O)}if(b){j.clear();const H=x.icon.placedSymbolArray;for(let q=0;q<H.length;q++){const X=H.get(q);if(X.hidden)ce(X.numGlyphs,j);else{const ct=G[q];if(ct)for(let et=0;et<X.numGlyphs;et++)o.aj(j,ct.shiftedAnchor,ct.angle);else ce(X.numGlyphs,j)}}x.icon.dynamicLayoutVertexBuffer.updateData(j)}x.text.dynamicLayoutVertexBuffer.updateData(O)}function ll(x,c,d){return d.iconsInText&&c?"symbolTextAndIcon":x?"symbolSDF":"symbolIcon"}function cl(x,c,d,y,_,S,B,k,g,b,C,M){const O=x.context,j=O.gl,G=x.transform,H=k==="map",q=g==="map",X=k!=="viewport"&&d.layout.get("symbol-placement")!=="point",ct=H&&!q&&!X,et=!d.layout.get("symbol-sort-key").isConstant();let ht=!1;const ft=x.depthModeForSublayer(0,fr.ReadOnly),Mt=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),St=[];for(const gt of y){const yt=c.getTile(gt),Vt=yt.getBucket(d);if(!Vt)continue;const $t=_?Vt.text:Vt.icon;if(!$t||!$t.segments.get().length||!$t.hasVisibleVertices)continue;const ae=$t.programConfigurations.get(d.id),le=_||Vt.sdfIcons,me=_?Vt.textSizeData:Vt.iconSizeData,Le=q||G.pitch!==0,we=x.useProgram(ll(le,_,Vt),ae),Ue=o.ag(me,G.zoom),Ke=x.style.map.terrain&&x.style.map.terrain.getTerrainData(gt);let Je,vr,br,Vr,gr=[0,0],Ur=null;if(_)vr=yt.glyphAtlasTexture,br=j.LINEAR,Je=yt.glyphAtlasTexture.size,Vt.iconsInText&&(gr=yt.imageAtlasTexture.size,Ur=yt.imageAtlasTexture,Vr=Le||x.options.rotating||x.options.zooming||me.kind==="composite"||me.kind==="camera"?j.LINEAR:j.NEAREST);else{const Yr=d.layout.get("icon-size").constantOr(0)!==1||Vt.iconsNeedLinear;vr=yt.imageAtlasTexture,br=le||x.options.rotating||x.options.zooming||Yr||Le?j.LINEAR:j.NEAREST,Je=yt.imageAtlasTexture.size}const ci=sr(yt,1,x.transform.zoom),ui=wr(gt.posMatrix,q,H,x.transform,ci),en=bi(gt.posMatrix,q,H,x.transform,ci),ti=Mt&&Vt.hasTextData(),Kn=d.layout.get("icon-text-fit")!=="none"&&ti&&Vt.hasIconData();if(X){const Yr=x.style.map.terrain?(jn,Ui)=>x.style.map.terrain.getElevation(gt,jn,Ui):null,hi=d.layout.get("text-rotation-alignment")==="map";Q(Vt,gt.posMatrix,x,_,ui,en,q,b,hi,Yr)}const bn=x.translatePosMatrix(gt.posMatrix,yt,S,B),Li=X||_&&Mt||Kn?Es:ui,ei=x.translatePosMatrix(en,yt,S,B,!0),Zr=le&&d.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ri;ri=le?Vt.iconsInText?Ul(me.kind,Ue,ct,q,x,bn,Li,ei,Je,gr):jl(me.kind,Ue,ct,q,x,bn,Li,ei,_,Je,!0):Ea(me.kind,Ue,ct,q,x,bn,Li,ei,_,Je);const pn={program:we,buffers:$t,uniformValues:ri,atlasTexture:vr,atlasTextureIcon:Ur,atlasInterpolation:br,atlasInterpolationIcon:Vr,isSDF:le,hasHalo:Zr};if(et&&Vt.canOverlap){ht=!0;const Yr=$t.segments.get();for(const hi of Yr)St.push({segments:new o.$([hi]),sortKey:hi.sortKey,state:pn,terrainData:Ke})}else St.push({segments:$t.segments,sortKey:0,state:pn,terrainData:Ke})}ht&&St.sort((gt,yt)=>gt.sortKey-yt.sortKey);for(const gt of St){const yt=gt.state;if(O.activeTexture.set(j.TEXTURE0),yt.atlasTexture.bind(yt.atlasInterpolation,j.CLAMP_TO_EDGE),yt.atlasTextureIcon&&(O.activeTexture.set(j.TEXTURE1),yt.atlasTextureIcon&&yt.atlasTextureIcon.bind(yt.atlasInterpolationIcon,j.CLAMP_TO_EDGE)),yt.isSDF){const Vt=yt.uniformValues;yt.hasHalo&&(Vt.u_is_halo=1,Wl(yt.buffers,gt.segments,d,x,yt.program,ft,C,M,Vt,gt.terrainData)),Vt.u_is_halo=0}Wl(yt.buffers,gt.segments,d,x,yt.program,ft,C,M,yt.uniformValues,gt.terrainData)}}function Wl(x,c,d,y,_,S,B,k,g,b){const C=y.context;_.draw(C,C.gl.TRIANGLES,S,B,k,jr.disabled,g,b,d.id,x.layoutVertexBuffer,x.indexBuffer,c,d.paint,y.transform.zoom,x.programConfigurations.get(d.id),x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer)}function ul(x,c,d,y,_){if(!d||!y||!y.imageAtlas)return;const S=y.imageAtlas.patternPositions;let B=S[d.to.toString()],k=S[d.from.toString()];if(!B&&k&&(B=k),!k&&B&&(k=B),!B||!k){const g=_.getPaintProperty(c);B=S[g],k=S[g]}B&&k&&x.setConstantPatternPositions(B,k)}function Uc(x,c,d,y,_,S,B){const k=x.context.gl,g="fill-pattern",b=d.paint.get(g),C=b&&b.constantOr(1),M=d.getCrossfadeParameters();let O,j,G,H,q;B?(j=C&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=k.LINES):(j=C?"fillPattern":"fill",O=k.TRIANGLES);const X=b.constantOr(null);for(const ct of y){const et=c.getTile(ct);if(C&&!et.patternsLoaded())continue;const ht=et.getBucket(d);if(!ht)continue;const ft=ht.programConfigurations.get(d.id),Mt=x.useProgram(j,ft),St=x.style.map.terrain&&x.style.map.terrain.getTerrainData(ct);C&&(x.context.activeTexture.set(k.TEXTURE0),et.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ft.updatePaintBuffers(M)),ul(ft,g,X,et,d);const gt=St?ct:null,yt=x.translatePosMatrix(gt?gt.posMatrix:ct.posMatrix,et,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(B){H=ht.indexBuffer2,q=ht.segments2;const Vt=[k.drawingBufferWidth,k.drawingBufferHeight];G=j==="fillOutlinePattern"&&C?yr(yt,x,M,et,Vt):Ee(yt,Vt)}else H=ht.indexBuffer,q=ht.segments,G=C?pe(yt,x,M,et):jt(yt);Mt.draw(x.context,O,_,x.stencilModeForClipping(ct),S,jr.disabled,G,St,d.id,ht.layoutVertexBuffer,H,q,d.paint,x.transform.zoom,ft)}}function Ta(x,c,d,y,_,S,B){const k=x.context,g=k.gl,b="fill-extrusion-pattern",C=d.paint.get(b),M=C.constantOr(1),O=d.getCrossfadeParameters(),j=d.paint.get("fill-extrusion-opacity"),G=C.constantOr(null);for(const H of y){const q=c.getTile(H),X=q.getBucket(d);if(!X)continue;const ct=x.style.map.terrain&&x.style.map.terrain.getTerrainData(H),et=X.programConfigurations.get(d.id),ht=x.useProgram(M?"fillExtrusionPattern":"fillExtrusion",et);M&&(x.context.activeTexture.set(g.TEXTURE0),q.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),et.updatePaintBuffers(O)),ul(et,b,G,q,d);const ft=x.translatePosMatrix(H.posMatrix,q,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Mt=d.paint.get("fill-extrusion-vertical-gradient"),St=M?vt(ft,x,Mt,j,H,O,q):st(ft,x,Mt,j);ht.draw(k,k.gl.TRIANGLES,_,S,B,jr.backCCW,St,ct,d.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,d.paint,x.transform.zoom,et,x.style.map.terrain&&X.centroidVertexBuffer)}}function Xn(x,c,d,y,_,S,B){const k=x.context,g=k.gl,b=d.fbo;if(!b)return;const C=x.useProgram("hillshade"),M=x.style.map.terrain&&x.style.map.terrain.getTerrainData(c);k.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,b.colorAttachment.get()),C.draw(k,g.TRIANGLES,_,S,B,jr.disabled,((O,j,G,H)=>{const q=G.paint.get("hillshade-shadow-color"),X=G.paint.get("hillshade-highlight-color"),ct=G.paint.get("hillshade-accent-color");let et=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);G.paint.get("hillshade-illumination-anchor")==="viewport"&&(et-=O.transform.angle);const ht=!O.options.moving;return{u_matrix:H?H.posMatrix:O.transform.calculatePosMatrix(j.tileID.toUnwrapped(),ht),u_image:0,u_latrange:_h(0,j.tileID),u_light:[G.paint.get("hillshade-exaggeration"),et],u_shadow:q,u_highlight:X,u_accent:ct}})(x,d,y,M?c:null),M,y.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments)}function hl(x,c,d,y,_,S){const B=x.context,k=B.gl,g=c.dem;if(g&&g.data){const b=g.dim,C=g.stride,M=g.getPixels();if(B.activeTexture.set(k.TEXTURE1),B.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||x.getTileTexture(C),c.demTexture){const j=c.demTexture;j.update(M,{premultiply:!1}),j.bind(k.NEAREST,k.CLAMP_TO_EDGE)}else c.demTexture=new at(B,M,k.RGBA,{premultiply:!1}),c.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);B.activeTexture.set(k.TEXTURE0);let O=c.fbo;if(!O){const j=new at(B,{width:b,height:b,data:null},k.RGBA);j.bind(k.LINEAR,k.CLAMP_TO_EDGE),O=c.fbo=B.createFramebuffer(b,b,!0,!1),O.colorAttachment.set(j.texture)}B.bindFramebuffer.set(O.framebuffer),B.viewport.set([0,0,b,b]),x.useProgram("hillshadePrepare").draw(B,k.TRIANGLES,y,_,S,jr.disabled,((j,G)=>{const H=G.stride,q=o.F();return o.aN(q,0,o.W,-o.W,0,0,1),o.H(q,q,[0,-o.W,0]),{u_matrix:q,u_image:1,u_dimension:[H,H],u_zoom:j.overscaledZ,u_unpack:G.getUnpackVector()}})(c.tileID,g),null,d.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments),c.needsHillshadePrepare=!1}}function $l(x,c,d,y,_,S){const B=y.paint.get("raster-fade-duration");if(!S&&B>0){const k=A.now(),g=(k-x.timeAdded)/B,b=c?(k-c.timeAdded)/B:-1,C=d.getSource(),M=_.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),O=!c||Math.abs(c.tileID.overscaledZ-M)>Math.abs(x.tileID.overscaledZ-M),j=O&&x.refreshedUponExpiration?1:o.ac(O?g:1-b,0,1);return x.refreshedUponExpiration&&g>=1&&(x.refreshedUponExpiration=!1),c?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}const Zl=new o.aO(1,0,0,1),dl=new o.aO(0,1,0,1),ls=new o.aO(0,0,1,1),Md=new o.aO(1,0,1,1),Gc=new o.aO(0,1,1,1);function Oi(x,c,d,y){Cn(x,0,c+d/2,x.transform.width,d,y)}function Dn(x,c,d,y){Cn(x,c-d/2,0,d,x.transform.height,y)}function Cn(x,c,d,y,_,S){const B=x.context,k=B.gl;k.enable(k.SCISSOR_TEST),k.scissor(c*x.pixelRatio,d*x.pixelRatio,y*x.pixelRatio,_*x.pixelRatio),B.clear({color:S}),k.disable(k.SCISSOR_TEST)}function Eu(x,c,d){const y=x.context,_=y.gl,S=d.posMatrix,B=x.useProgram("debug"),k=fr.disabled,g=Or.disabled,b=x.colorModeForRenderPass(),C="$debug",M=x.style.map.terrain&&x.style.map.terrain.getTerrainData(d);y.activeTexture.set(_.TEXTURE0);const O=c.getTileByID(d.key).latestRawTileData,j=Math.floor((O&&O.byteLength||0)/1024),G=c.getTile(d).tileSize,H=512/Math.min(G,512)*(d.overscaledZ/x.transform.zoom)*.5;let q=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(q+=` => ${d.overscaledZ}`),function(X,ct){X.initDebugOverlayCanvas();const et=X.debugOverlayCanvas,ht=X.context.gl,ft=X.debugOverlayCanvas.getContext("2d");ft.clearRect(0,0,et.width,et.height),ft.shadowColor="white",ft.shadowBlur=2,ft.lineWidth=1.5,ft.strokeStyle="white",ft.textBaseline="top",ft.font="bold 36px Open Sans, sans-serif",ft.fillText(ct,5,5),ft.strokeText(ct,5,5),X.debugOverlayTexture.update(et),X.debugOverlayTexture.bind(ht.LINEAR,ht.CLAMP_TO_EDGE)}(x,`${q} ${j}kB`),B.draw(y,_.TRIANGLES,k,g,dr.alphaBlended,jr.disabled,Sn(S,o.aO.transparent,H),null,C,x.debugBuffer,x.quadTriangleIndexBuffer,x.debugSegments),B.draw(y,_.LINE_STRIP,k,g,b,jr.disabled,Sn(S,o.aO.red),M,C,x.debugBuffer,x.tileBorderIndexBuffer,x.debugSegments)}function Vc(x,c,d){const y=x.context,_=y.gl,S=x.colorModeForRenderPass(),B=new fr(_.LEQUAL,fr.ReadWrite,x.depthRangeFor3D),k=x.useProgram("terrain"),g=c.getTerrainMesh();y.bindFramebuffer.set(null),y.viewport.set([0,0,x.width,x.height]);for(const b of d){const C=x.renderToTexture.getTexture(b),M=c.getTerrainData(b.tileID);y.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,C.texture);const O={u_matrix:x.transform.calculatePosMatrix(b.tileID.toUnwrapped()),u_texture:0,u_ele_delta:c.getMeshFrameDelta(x.transform.zoom)};k.draw(y,_.TRIANGLES,B,Or.disabled,S,jr.backCCW,O,M,"terrain",g.vertexBuffer,g.indexBuffer,g.segments)}}class Pa{constructor(c,d){this.context=new si(c),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Pr.maxUnderzooming+Pr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ps}resize(c,d,y){if(this.width=Math.floor(c*y),this.height=Math.floor(d*y),this.pixelRatio=y,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const c=this.context,d=new o.aV;d.emplaceBack(0,0),d.emplaceBack(o.W,0),d.emplaceBack(0,o.W),d.emplaceBack(o.W,o.W),this.tileExtentBuffer=c.createVertexBuffer(d,An.members),this.tileExtentSegments=o.$.simpleSegment(0,0,4,2);const y=new o.aV;y.emplaceBack(0,0),y.emplaceBack(o.W,0),y.emplaceBack(0,o.W),y.emplaceBack(o.W,o.W),this.debugBuffer=c.createVertexBuffer(y,An.members),this.debugSegments=o.$.simpleSegment(0,0,4,5);const _=new o.Z;_.emplaceBack(0,0,0,0),_.emplaceBack(o.W,0,o.W,0),_.emplaceBack(0,o.W,0,o.W),_.emplaceBack(o.W,o.W,o.W,o.W),this.rasterBoundsBuffer=c.createVertexBuffer(_,ve.members),this.rasterBoundsSegments=o.$.simpleSegment(0,0,4,2);const S=new o.aV;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(S,An.members),this.viewportSegments=o.$.simpleSegment(0,0,4,2);const B=new o.aW;B.emplaceBack(0),B.emplaceBack(1),B.emplaceBack(3),B.emplaceBack(2),B.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(B);const k=new o.aX;k.emplaceBack(0,1,2),k.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(k);const g=this.context.gl;this.stencilClearMode=new Or({func:g.ALWAYS,mask:0},0,255,g.ZERO,g.ZERO,g.ZERO)}clearStencil(){const c=this.context,d=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const y=o.F();o.aN(y,0,this.width,this.height,0,0,1),o.J(y,y,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,d.TRIANGLES,fr.disabled,this.stencilClearMode,dr.disabled,jr.disabled,un(y),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(c,d){if(this.currentStencilSource===c.source||!c.isTileClipped()||!d||!d.length)return;this.currentStencilSource=c.source;const y=this.context,_=y.gl;this.nextStencilID+d.length>256&&this.clearStencil(),y.setColorMode(dr.disabled),y.setDepthMode(fr.disabled);const S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const B of d){const k=this._tileClippingMaskIDs[B.key]=this.nextStencilID++,g=this.style.map.terrain&&this.style.map.terrain.getTerrainData(B);S.draw(y,_.TRIANGLES,fr.disabled,new Or({func:_.ALWAYS,mask:0},k,255,_.KEEP,_.KEEP,_.REPLACE),dr.disabled,jr.disabled,un(B.posMatrix),g,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,d=this.context.gl;return new Or({func:d.NOTEQUAL,mask:255},c,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(c){const d=this.context.gl;return new Or({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(c){const d=this.context.gl,y=c.sort((B,k)=>k.overscaledZ-B.overscaledZ),_=y[y.length-1].overscaledZ,S=y[0].overscaledZ-_+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const B={};for(let k=0;k<S;k++)B[k+_]=new Or({func:d.GEQUAL,mask:255},k+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=S,[B,y]}return[{[_]:Or.disabled},y]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new dr([c.CONSTANT_COLOR,c.ONE],new o.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?dr.unblended:dr.alphaBlended}depthModeForSublayer(c,d,y){if(!this.opaquePassEnabledForLayer())return fr.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new fr(y||this.context.gl.LEQUAL,d,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,d){this.style=c,this.options=d,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(A.now()),this.imageManager.beginFrame();const y=this.style._order,_=this.style.sourceCaches,S={},B={},k={};for(const g in _){const b=_[g];b.used&&b.prepare(this.context),S[g]=b.getVisibleCoordinates(),B[g]=S[g].slice().reverse(),k[g]=b.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let g=0;g<y.length;g++)if(this.style._layers[y[g]].is3D()){this.opaquePassCutoff=g;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const g of y){const b=this.style._layers[g];if(!b.hasOffscreenPass()||b.isHidden(this.transform.zoom))continue;const C=B[b.source];(b.type==="custom"||C.length)&&this.renderLayer(this,_[b.source],b,C)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?o.aO.black:o.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const g=this.style._layers[y[this.currentLayer]],b=_[g.source],C=S[g.source];this._renderTileClippingMasks(g,C),this.renderLayer(this,b,g,C)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const g=this.style._layers[y[this.currentLayer]],b=_[g.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(g))continue;const C=(g.type==="symbol"?k:B)[g.source];this._renderTileClippingMasks(g,S[g.source]),this.renderLayer(this,b,g,C)}if(this.options.showTileBoundaries){const g=function(b,C){let M=null;const O=Object.values(b._layers).flatMap(q=>q.source&&!q.isHidden(C)?[b.sourceCaches[q.source]]:[]),j=O.filter(q=>q.getSource().type==="vector"),G=O.filter(q=>q.getSource().type!=="vector"),H=q=>{(!M||M.getSource().maxzoom<q.getSource().maxzoom)&&(M=q)};return j.forEach(q=>H(q)),M||G.forEach(q=>H(q)),M}(this.style,this.transform.zoom);g&&function(b,C,M){for(let O=0;O<M.length;O++)Eu(b,C,M[O])}(this,g,g.getVisibleCoordinates())}this.options.showPadding&&function(g){const b=g.transform.padding;Oi(g,g.transform.height-(b.top||0),3,Zl),Oi(g,b.bottom||0,3,dl),Dn(g,b.left||0,3,ls),Dn(g,g.transform.width-(b.right||0),3,Md);const C=g.transform.centerPoint;(function(M,O,j,G){Cn(M,O-1,j-10,2,20,G),Cn(M,O-10,j-1,20,2,G)})(g,C.x,g.transform.height-C.y,Gc)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(c){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,y=this.transform.projMatrix;let _=this.terrainFacilitator.dirty;_||(_=c?!o.aY(d,y):!o.aZ(d,y)),_||(_=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),_&&(o.a_(d,y),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(S,B){const k=S.context,g=k.gl,b=dr.unblended,C=new fr(g.LEQUAL,fr.ReadWrite,[0,1]),M=B.getTerrainMesh(),O=B.sourceCache.getRenderableTiles(),j=S.useProgram("terrainDepth");k.bindFramebuffer.set(B.getFramebuffer("depth").framebuffer),k.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),k.clear({color:o.aO.transparent,depth:1});for(const G of O){const H=B.getTerrainData(G.tileID),q={u_matrix:S.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_ele_delta:B.getMeshFrameDelta(S.transform.zoom)};j.draw(k,g.TRIANGLES,C,Or.disabled,b,jr.backCCW,q,H,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}k.bindFramebuffer.set(null),k.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain),function(S,B){const k=S.context,g=k.gl,b=dr.unblended,C=new fr(g.LEQUAL,fr.ReadWrite,[0,1]),M=B.getTerrainMesh(),O=B.getCoordsTexture(),j=B.sourceCache.getRenderableTiles(),G=S.useProgram("terrainCoords");k.bindFramebuffer.set(B.getFramebuffer("coords").framebuffer),k.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),k.clear({color:o.aO.transparent,depth:1}),B.coordsIndex=[];for(const H of j){const q=B.getTerrainData(H.tileID);k.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,O.texture);const X={u_matrix:S.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_terrain_coords_id:(255-B.coordsIndex.length)/255,u_texture:0,u_ele_delta:B.getMeshFrameDelta(S.transform.zoom)};G.draw(k,g.TRIANGLES,C,Or.disabled,b,jr.backCCW,X,q,"terrain",M.vertexBuffer,M.indexBuffer,M.segments),B.coordsIndex.push(H.tileID.key)}k.bindFramebuffer.set(null),k.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain))}renderLayer(c,d,y,_){if(!y.isHidden(this.transform.zoom)&&(y.type==="background"||y.type==="custom"||(_||[]).length))switch(this.id=y.id,y.type){case"symbol":(function(S,B,k,g,b){if(S.renderPass!=="translucent")return;const C=Or.disabled,M=S.colorModeForRenderPass();(k._unevaluatedLayout.hasValue("text-variable-anchor")||k._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(O,j,G,H,q,X,ct){const et=j.transform,ht=q==="map",ft=X==="map";for(const Mt of O){const St=H.getTile(Mt),gt=St.getBucket(G);if(!gt||!gt.text||!gt.text.segments.get().length)continue;const yt=o.ag(gt.textSizeData,et.zoom),Vt=sr(St,1,j.transform.zoom),$t=wr(Mt.posMatrix,ft,ht,j.transform,Vt),ae=G.layout.get("icon-text-fit")!=="none"&&gt.hasIconData();if(yt){const le=Math.pow(2,et.zoom-St.tileID.overscaledZ);Hl(gt,ht,ft,ct,et,$t,Mt.posMatrix,le,yt,ae,j.style.map.terrain?(me,Le)=>j.style.map.terrain.getElevation(Mt,me,Le):null)}}}(g,S,k,B,k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),b),k.paint.get("icon-opacity").constantOr(1)!==0&&cl(S,B,k,g,!1,k.paint.get("icon-translate"),k.paint.get("icon-translate-anchor"),k.layout.get("icon-rotation-alignment"),k.layout.get("icon-pitch-alignment"),k.layout.get("icon-keep-upright"),C,M),k.paint.get("text-opacity").constantOr(1)!==0&&cl(S,B,k,g,!0,k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.layout.get("text-keep-upright"),C,M),B.map.showCollisionBoxes&&(Ss(S,B,k,g,k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),!0),Ss(S,B,k,g,k.paint.get("icon-translate"),k.paint.get("icon-translate-anchor"),!1))})(c,d,y,_,this.style.placement.variableOffsets);break;case"circle":(function(S,B,k,g){if(S.renderPass!=="translucent")return;const b=k.paint.get("circle-opacity"),C=k.paint.get("circle-stroke-width"),M=k.paint.get("circle-stroke-opacity"),O=!k.layout.get("circle-sort-key").isConstant();if(b.constantOr(1)===0&&(C.constantOr(1)===0||M.constantOr(1)===0))return;const j=S.context,G=j.gl,H=S.depthModeForSublayer(0,fr.ReadOnly),q=Or.disabled,X=S.colorModeForRenderPass(),ct=[];for(let et=0;et<g.length;et++){const ht=g[et],ft=B.getTile(ht),Mt=ft.getBucket(k);if(!Mt)continue;const St=Mt.programConfigurations.get(k.id),gt=S.useProgram("circle",St),yt=Mt.layoutVertexBuffer,Vt=Mt.indexBuffer,$t=S.style.map.terrain&&S.style.map.terrain.getTerrainData(ht),ae={programConfiguration:St,program:gt,layoutVertexBuffer:yt,indexBuffer:Vt,uniformValues:Br(S,ht,ft,k),terrainData:$t};if(O){const le=Mt.segments.get();for(const me of le)ct.push({segments:new o.$([me]),sortKey:me.sortKey,state:ae})}else ct.push({segments:Mt.segments,sortKey:0,state:ae})}O&&ct.sort((et,ht)=>et.sortKey-ht.sortKey);for(const et of ct){const{programConfiguration:ht,program:ft,layoutVertexBuffer:Mt,indexBuffer:St,uniformValues:gt,terrainData:yt}=et.state;ft.draw(j,G.TRIANGLES,H,q,X,jr.disabled,gt,yt,k.id,Mt,St,et.segments,k.paint,S.transform.zoom,ht)}})(c,d,y,_);break;case"heatmap":(function(S,B,k,g){if(k.paint.get("heatmap-opacity")!==0)if(S.renderPass==="offscreen"){const b=S.context,C=b.gl,M=Or.disabled,O=new dr([C.ONE,C.ONE],o.aO.transparent,[!0,!0,!0,!0]);(function(j,G,H){const q=j.gl;j.activeTexture.set(q.TEXTURE1),j.viewport.set([0,0,G.width/4,G.height/4]);let X=H.heatmapFbo;if(X)q.bindTexture(q.TEXTURE_2D,X.colorAttachment.get()),j.bindFramebuffer.set(X.framebuffer);else{const ct=q.createTexture();q.bindTexture(q.TEXTURE_2D,ct),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),X=H.heatmapFbo=j.createFramebuffer(G.width/4,G.height/4,!1,!1),function(et,ht,ft,Mt){var St,gt;const yt=et.gl,Vt=(St=et.HALF_FLOAT)!==null&&St!==void 0?St:yt.UNSIGNED_BYTE,$t=(gt=et.RGBA16F)!==null&&gt!==void 0?gt:yt.RGBA;yt.texImage2D(yt.TEXTURE_2D,0,$t,ht.width/4,ht.height/4,0,yt.RGBA,Vt,null),Mt.colorAttachment.set(ft)}(j,G,ct,X)}})(b,S,k),b.clear({color:o.aO.transparent});for(let j=0;j<g.length;j++){const G=g[j];if(B.hasRenderableParent(G))continue;const H=B.getTile(G),q=H.getBucket(k);if(!q)continue;const X=q.programConfigurations.get(k.id),ct=S.useProgram("heatmap",X),{zoom:et}=S.transform;ct.draw(b,C.TRIANGLES,fr.disabled,M,O,jr.disabled,Ti(G.posMatrix,H,et,k.paint.get("heatmap-intensity")),null,k.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,k.paint,S.transform.zoom,X)}b.viewport.set([0,0,S.width,S.height])}else S.renderPass==="translucent"&&(S.context.setColorMode(S.colorModeForRenderPass()),function(b,C){const M=b.context,O=M.gl,j=C.heatmapFbo;if(!j)return;M.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,j.colorAttachment.get()),M.activeTexture.set(O.TEXTURE1);let G=C.colorRampTexture;G||(G=C.colorRampTexture=new at(M,C.colorRamp,O.RGBA)),G.bind(O.LINEAR,O.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(M,O.TRIANGLES,fr.disabled,Or.disabled,b.colorModeForRenderPass(),jr.disabled,((H,q,X,ct)=>{const et=o.F();o.aN(et,0,H.width,H.height,0,0,1);const ht=H.context.gl;return{u_matrix:et,u_world:[ht.drawingBufferWidth,ht.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:q.paint.get("heatmap-opacity")}})(b,C),null,C.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,C.paint,b.transform.zoom)}(S,k))})(c,d,y,_);break;case"line":(function(S,B,k,g){if(S.renderPass!=="translucent")return;const b=k.paint.get("line-opacity"),C=k.paint.get("line-width");if(b.constantOr(1)===0||C.constantOr(1)===0)return;const M=S.depthModeForSublayer(0,fr.ReadOnly),O=S.colorModeForRenderPass(),j=k.paint.get("line-dasharray"),G=k.paint.get("line-pattern"),H=G.constantOr(1),q=k.paint.get("line-gradient"),X=k.getCrossfadeParameters(),ct=H?"linePattern":j?"lineSDF":q?"lineGradient":"line",et=S.context,ht=et.gl;let ft=!0;for(const Mt of g){const St=B.getTile(Mt);if(H&&!St.patternsLoaded())continue;const gt=St.getBucket(k);if(!gt)continue;const yt=gt.programConfigurations.get(k.id),Vt=S.context.program.get(),$t=S.useProgram(ct,yt),ae=ft||$t.program!==Vt,le=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Mt),me=G.constantOr(null);if(me&&St.imageAtlas){const Ue=St.imageAtlas,Ke=Ue.patternPositions[me.to.toString()],Je=Ue.patternPositions[me.from.toString()];Ke&&Je&&yt.setConstantPatternPositions(Ke,Je)}const Le=le?Mt:null,we=H?Sa(S,St,k,X,Le):j?Rc(S,St,k,j,X,Le):q?kr(S,St,k,gt.lineClipsArray.length,Le):Fl(S,St,k,Le);if(H)et.activeTexture.set(ht.TEXTURE0),St.imageAtlasTexture.bind(ht.LINEAR,ht.CLAMP_TO_EDGE),yt.updatePaintBuffers(X);else if(j&&(ae||S.lineAtlas.dirty))et.activeTexture.set(ht.TEXTURE0),S.lineAtlas.bind(et);else if(q){const Ue=gt.gradients[k.id];let Ke=Ue.texture;if(k.gradientVersion!==Ue.version){let Je=256;if(k.stepInterpolant){const vr=B.getSource().maxzoom,br=Mt.canonical.z===vr?Math.ceil(1<<S.transform.maxZoom-Mt.canonical.z):1;Je=o.ac(o.aT(gt.maxLineLength/o.W*1024*br),256,et.maxTextureSize)}Ue.gradient=o.aU({expression:k.gradientExpression(),evaluationKey:"lineProgress",resolution:Je,image:Ue.gradient||void 0,clips:gt.lineClipsArray}),Ue.texture?Ue.texture.update(Ue.gradient):Ue.texture=new at(et,Ue.gradient,ht.RGBA),Ue.version=k.gradientVersion,Ke=Ue.texture}et.activeTexture.set(ht.TEXTURE0),Ke.bind(k.stepInterpolant?ht.NEAREST:ht.LINEAR,ht.CLAMP_TO_EDGE)}$t.draw(et,ht.TRIANGLES,M,S.stencilModeForClipping(Mt),O,jr.disabled,we,le,k.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,k.paint,S.transform.zoom,yt,gt.layoutVertexBuffer2),ft=!1}})(c,d,y,_);break;case"fill":(function(S,B,k,g){const b=k.paint.get("fill-color"),C=k.paint.get("fill-opacity");if(C.constantOr(1)===0)return;const M=S.colorModeForRenderPass(),O=k.paint.get("fill-pattern"),j=S.opaquePassEnabledForLayer()&&!O.constantOr(1)&&b.constantOr(o.aO.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(S.renderPass===j){const G=S.depthModeForSublayer(1,S.renderPass==="opaque"?fr.ReadWrite:fr.ReadOnly);Uc(S,B,k,g,G,M,!1)}if(S.renderPass==="translucent"&&k.paint.get("fill-antialias")){const G=S.depthModeForSublayer(k.getPaintProperty("fill-outline-color")?2:0,fr.ReadOnly);Uc(S,B,k,g,G,M,!0)}})(c,d,y,_);break;case"fill-extrusion":(function(S,B,k,g){const b=k.paint.get("fill-extrusion-opacity");if(b!==0&&S.renderPass==="translucent"){const C=new fr(S.context.gl.LEQUAL,fr.ReadWrite,S.depthRangeFor3D);if(b!==1||k.paint.get("fill-extrusion-pattern").constantOr(1))Ta(S,B,k,g,C,Or.disabled,dr.disabled),Ta(S,B,k,g,C,S.stencilModeFor3D(),S.colorModeForRenderPass());else{const M=S.colorModeForRenderPass();Ta(S,B,k,g,C,Or.disabled,M)}}})(c,d,y,_);break;case"hillshade":(function(S,B,k,g){if(S.renderPass!=="offscreen"&&S.renderPass!=="translucent")return;const b=S.context,C=S.depthModeForSublayer(0,fr.ReadOnly),M=S.colorModeForRenderPass(),[O,j]=S.renderPass==="translucent"?S.stencilConfigForOverlap(g):[{},g];for(const G of j){const H=B.getTile(G);H.needsHillshadePrepare!==void 0&&H.needsHillshadePrepare&&S.renderPass==="offscreen"?hl(S,H,k,C,Or.disabled,M):S.renderPass==="translucent"&&Xn(S,G,H,k,C,O[G.overscaledZ],M)}b.viewport.set([0,0,S.width,S.height])})(c,d,y,_);break;case"raster":(function(S,B,k,g){if(S.renderPass!=="translucent"||k.paint.get("raster-opacity")===0||!g.length)return;const b=S.context,C=b.gl,M=B.getSource(),O=S.useProgram("raster"),j=S.colorModeForRenderPass(),[G,H]=M instanceof Ce?[{},g]:S.stencilConfigForOverlap(g),q=H[H.length-1].overscaledZ,X=!S.options.moving;for(const ct of H){const et=S.depthModeForSublayer(ct.overscaledZ-q,k.paint.get("raster-opacity")===1?fr.ReadWrite:fr.ReadOnly,C.LESS),ht=B.getTile(ct);ht.registerFadeDuration(k.paint.get("raster-fade-duration"));const ft=B.findLoadedParent(ct,0),Mt=$l(ht,ft,B,k,S.transform,S.style.map.terrain);let St,gt;const yt=k.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;b.activeTexture.set(C.TEXTURE0),ht.texture.bind(yt,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),b.activeTexture.set(C.TEXTURE1),ft?(ft.texture.bind(yt,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),St=Math.pow(2,ft.tileID.overscaledZ-ht.tileID.overscaledZ),gt=[ht.tileID.canonical.x*St%1,ht.tileID.canonical.y*St%1]):ht.texture.bind(yt,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);const Vt=S.style.map.terrain&&S.style.map.terrain.getTerrainData(ct),$t=Vt?ct:null,ae=$t?$t.posMatrix:S.transform.calculatePosMatrix(ct.toUnwrapped(),X),le=zl(ae,gt||[0,0],St||1,Mt,k);M instanceof Ce?O.draw(b,C.TRIANGLES,et,Or.disabled,j,jr.disabled,le,Vt,k.id,M.boundsBuffer,S.quadTriangleIndexBuffer,M.boundsSegments):O.draw(b,C.TRIANGLES,et,G[ct.overscaledZ],j,jr.disabled,le,Vt,k.id,S.rasterBoundsBuffer,S.quadTriangleIndexBuffer,S.rasterBoundsSegments)}})(c,d,y,_);break;case"background":(function(S,B,k,g){const b=k.paint.get("background-color"),C=k.paint.get("background-opacity");if(C===0)return;const M=S.context,O=M.gl,j=S.transform,G=j.tileSize,H=k.paint.get("background-pattern");if(S.isPatternMissing(H))return;const q=!H&&b.a===1&&C===1&&S.opaquePassEnabledForLayer()?"opaque":"translucent";if(S.renderPass!==q)return;const X=Or.disabled,ct=S.depthModeForSublayer(0,q==="opaque"?fr.ReadWrite:fr.ReadOnly),et=S.colorModeForRenderPass(),ht=S.useProgram(H?"backgroundPattern":"background"),ft=g||j.coveringTiles({tileSize:G,terrain:S.style.map.terrain});H&&(M.activeTexture.set(O.TEXTURE0),S.imageManager.bind(S.context));const Mt=k.getCrossfadeParameters();for(const St of ft){const gt=g?St.posMatrix:S.transform.calculatePosMatrix(St.toUnwrapped()),yt=H?bu(gt,C,S,H,{tileID:St,tileSize:G},Mt):Pd(gt,C,b),Vt=S.style.map.terrain&&S.style.map.terrain.getTerrainData(St);ht.draw(M,O.TRIANGLES,ct,X,et,jr.disabled,yt,Vt,k.id,S.tileExtentBuffer,S.quadTriangleIndexBuffer,S.tileExtentSegments)}})(c,0,y,_);break;case"custom":(function(S,B,k){const g=S.context,b=k.implementation;if(S.renderPass==="offscreen"){const C=b.prerender;C&&(S.setCustomLayerDefaults(),g.setColorMode(S.colorModeForRenderPass()),C.call(b,g.gl,S.transform.customLayerMatrix()),g.setDirty(),S.setBaseState())}else if(S.renderPass==="translucent"){S.setCustomLayerDefaults(),g.setColorMode(S.colorModeForRenderPass()),g.setStencilMode(Or.disabled);const C=b.renderingMode==="3d"?new fr(S.context.gl.LEQUAL,fr.ReadWrite,S.depthRangeFor3D):S.depthModeForSublayer(0,fr.ReadOnly);g.setDepthMode(C),b.render(g.gl,S.transform.customLayerMatrix()),g.setDirty(),S.setBaseState(),g.bindFramebuffer.set(null)}})(c,0,y)}}translatePosMatrix(c,d,y,_,S){if(!y[0]&&!y[1])return c;const B=S?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(B){const b=Math.sin(B),C=Math.cos(B);y=[y[0]*C-y[1]*b,y[0]*b+y[1]*C]}const k=[S?y[0]:sr(d,y[0],this.transform.zoom),S?y[1]:sr(d,y[1],this.transform.zoom),0],g=new Float32Array(16);return o.H(g,c,k),g}saveTileTexture(c){const d=this._tileTextures[c.size[0]];d?d.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const d=this._tileTextures[c];return d&&d.length>0?d.pop():null}isPatternMissing(c){if(!c)return!1;if(!c.from||!c.to)return!0;const d=this.imageManager.getPattern(c.from.toString()),y=this.imageManager.getPattern(c.to.toString());return!d||!y}useProgram(c,d){this.cache=this.cache||{};const y=c+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[y]||(this.cache[y]=new Us(this.context,vn[c],d,rl[c],this._showOverdrawInspector,this.style.map.terrain)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new at(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:c,drawingBufferHeight:d}=this.context.gl;return this.width!==c||this.height!==d}}class Tn{constructor(c,d){this.points=c,this.planes=d}static fromInvProjectionMatrix(c,d,y){const _=Math.pow(2,y),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(k=>{const g=1/(k=o.af([],k,c))[3]/d*_;return o.a$(k,k,[g,g,1/k[3],g])}),B=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(k=>{const g=function(O,j){var G=j[0],H=j[1],q=j[2],X=G*G+H*H+q*q;return X>0&&(X=1/Math.sqrt(X)),O[0]=j[0]*X,O[1]=j[1]*X,O[2]=j[2]*X,O}([],function(O,j,G){var H=j[0],q=j[1],X=j[2],ct=G[0],et=G[1],ht=G[2];return O[0]=q*ht-X*et,O[1]=X*ct-H*ht,O[2]=H*et-q*ct,O}([],pt([],S[k[0]],S[k[1]]),pt([],S[k[2]],S[k[1]]))),b=-((C=g)[0]*(M=S[k[1]])[0]+C[1]*M[1]+C[2]*M[2]);var C,M;return g.concat(b)});return new Tn(S,B)}}class Nn{constructor(c,d){this.min=c,this.max=d,this.center=function(y,_,S){return y[0]=.5*_[0],y[1]=.5*_[1],y[2]=.5*_[2],y}([],function(y,_,S){return y[0]=_[0]+S[0],y[1]=_[1]+S[1],y[2]=_[2]+S[2],y}([],this.min,this.max))}quadrant(c){const d=[c%2==0,c<2],y=Et(this.min),_=Et(this.max);for(let S=0;S<d.length;S++)y[S]=d[S]?this.min[S]:this.center[S],_[S]=d[S]?this.center[S]:this.max[S];return _[2]=this.max[2],new Nn(y,_)}distanceX(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]}distanceY(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]}intersects(c){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let y=!0;for(let _=0;_<c.planes.length;_++){const S=c.planes[_];let B=0;for(let k=0;k<d.length;k++)o.b0(S,d[k])>=0&&B++;if(B===0)return 0;B!==d.length&&(y=!1)}if(y)return 2;for(let _=0;_<3;_++){let S=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(let k=0;k<c.points.length;k++){const g=c.points[k][_]-this.min[_];S=Math.min(S,g),B=Math.max(B,g)}if(B<0||S>this.max[_]-this.min[_])return 0}return 1}}class Gs{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,_=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(c)||c<0||isNaN(d)||d<0||isNaN(y)||y<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=d,this.left=y,this.right=_}interpolate(c,d,y){return d.top!=null&&c.top!=null&&(this.top=o.z.number(c.top,d.top,y)),d.bottom!=null&&c.bottom!=null&&(this.bottom=o.z.number(c.bottom,d.bottom,y)),d.left!=null&&c.left!=null&&(this.left=o.z.number(c.left,d.left,y)),d.right!=null&&c.right!=null&&(this.right=o.z.number(c.right,d.right,y)),this}getCenter(c,d){const y=o.ac((this.left+c-this.right)/2,0,c),_=o.ac((this.top+d-this.bottom)/2,0,d);return new o.P(y,_)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new Gs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ro=85.051129;class io{constructor(c,d,y,_,S){this.tileSize=512,this._renderWorldCopies=S===void 0||!!S,this._minZoom=c||0,this._maxZoom=d||22,this._minPitch=y??0,this._maxPitch=_??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Gs,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const c=new io(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.apply(this),c}apply(c){this.tileSize=c.tileSize,this.latRange=c.latRange,this.width=c.width,this.height=c.height,this._center=c._center,this._elevation=c._elevation,this.minElevationForCurrentTile=c.minElevationForCurrentTile,this.zoom=c.zoom,this.angle=c.angle,this._fov=c._fov,this._pitch=c._pitch,this._unmodified=c._unmodified,this._edgeInsets=c._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(c){const d=-o.b1(c,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var y=new o.A(4);return o.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}(),function(y,_,S){var B=_[0],k=_[1],g=_[2],b=_[3],C=Math.sin(S),M=Math.cos(S);y[0]=B*M+g*C,y[1]=k*M+b*C,y[2]=B*-C+g*M,y[3]=k*-C+b*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const d=o.ac(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(c){const d=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(c){c!==this._elevation&&(this._elevation=c,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,d,y){this._unmodified=!1,this._edgeInsets.interpolate(c,d,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const d=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(c){const d=[new o.b2(0,c)];if(this._renderWorldCopies){const y=this.pointCoordinate(new o.P(0,0)),_=this.pointCoordinate(new o.P(this.width,0)),S=this.pointCoordinate(new o.P(this.width,this.height)),B=this.pointCoordinate(new o.P(0,this.height)),k=Math.floor(Math.min(y.x,_.x,S.x,B.x)),g=Math.floor(Math.max(y.x,_.x,S.x,B.x)),b=1;for(let C=k-b;C<=g+b;C++)C!==0&&d.push(new o.b2(C,c))}return d}coveringTiles(c){var d,y;let _=this.coveringZoomLevel(c);const S=_;if(c.minzoom!==void 0&&_<c.minzoom)return[];c.maxzoom!==void 0&&_>c.maxzoom&&(_=c.maxzoom);const B=this.pointCoordinate(this.getCameraPoint()),k=o.Y.fromLngLat(this.center),g=Math.pow(2,_),b=[g*B.x,g*B.y,0],C=[g*k.x,g*k.y,0],M=Tn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_);let O=c.minzoom||0;!c.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(O=_);const j=c.terrain?2/Math.min(this.tileSize,c.tileSize)*this.tileSize:3,G=et=>({aabb:new Nn([et*g,0,0],[(et+1)*g,g,0]),zoom:0,x:0,y:0,wrap:et,fullyVisible:!1}),H=[],q=[],X=_,ct=c.reparseOverscaled?S:_;if(this._renderWorldCopies)for(let et=1;et<=3;et++)H.push(G(-et)),H.push(G(et));for(H.push(G(0));H.length>0;){const et=H.pop(),ht=et.x,ft=et.y;let Mt=et.fullyVisible;if(!Mt){const $t=et.aabb.intersects(M);if($t===0)continue;Mt=$t===2}const St=c.terrain?b:C,gt=et.aabb.distanceX(St),yt=et.aabb.distanceY(St),Vt=Math.max(Math.abs(gt),Math.abs(yt));if(et.zoom===X||Vt>j+(1<<X-et.zoom)-2&&et.zoom>=O){const $t=X-et.zoom,ae=b[0]-.5-(ht<<$t),le=b[1]-.5-(ft<<$t);q.push({tileID:new o.Q(et.zoom===X?ct:et.zoom,et.wrap,et.zoom,ht,ft),distanceSq:zt([C[0]-.5-ht,C[1]-.5-ft]),tileDistanceToCamera:Math.sqrt(ae*ae+le*le)})}else for(let $t=0;$t<4;$t++){const ae=(ht<<1)+$t%2,le=(ft<<1)+($t>>1),me=et.zoom+1;let Le=et.aabb.quadrant($t);if(c.terrain){const we=new o.Q(me,et.wrap,me,ae,le),Ue=c.terrain.getMinMaxElevation(we),Ke=(d=Ue.minElevation)!==null&&d!==void 0?d:this.elevation,Je=(y=Ue.maxElevation)!==null&&y!==void 0?y:this.elevation;Le=new Nn([Le.min[0],Le.min[1],Ke],[Le.max[0],Le.max[1],Je])}H.push({aabb:Le,zoom:me,x:ae,y:le,wrap:et.wrap,fullyVisible:Mt})}}return q.sort((et,ht)=>et.distanceSq-ht.distanceSq).map(et=>et.tileID)}resize(c,d){this.width=c,this.height=d,this.pixelsToGLUnits=[2/c,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const d=o.ac(c.lat,-85.051129,ro);return new o.P(o.N(c.lng)*this.worldSize,o.O(d)*this.worldSize)}unproject(c){return new o.Y(c.x/this.worldSize,c.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(c){const d=this.elevation,y=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,_=this.pointLocation(this.centerPoint,c),S=c.getElevationForLngLatZoom(_,this.tileZoom);if(!(this.elevation-S))return;const B=y+d-S,k=Math.cos(this._pitch)*this.cameraToCenterDistance/B/o.b3(1,_.lat),g=this.scaleZoom(k/this.tileSize);this._elevation=S,this._center=_,this.zoom=g}setLocationAtPoint(c,d){const y=this.pointCoordinate(d),_=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(c),B=new o.Y(S.x-(y.x-_.x),S.y-(y.y-_.y));this.center=this.coordinateLocation(B),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(c,d){return d?this.coordinatePoint(this.locationCoordinate(c),d.getElevationForLngLatZoom(c,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(c))}pointLocation(c,d){return this.coordinateLocation(this.pointCoordinate(c,d))}locationCoordinate(c){return o.Y.fromLngLat(c)}coordinateLocation(c){return c&&c.toLngLat()}pointCoordinate(c,d){if(d){const O=d.pointCoordinate(c);if(O!=null)return O}const y=[c.x,c.y,0,1],_=[c.x,c.y,1,1];o.af(y,y,this.pixelMatrixInverse),o.af(_,_,this.pixelMatrixInverse);const S=y[3],B=_[3],k=y[1]/S,g=_[1]/B,b=y[2]/S,C=_[2]/B,M=b===C?0:(0-b)/(C-b);return new o.Y(o.z.number(y[0]/S,_[0]/B,M)/this.worldSize,o.z.number(k,g,M)/this.worldSize)}coordinatePoint(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const _=[c.x*this.worldSize,c.y*this.worldSize,d,1];return o.af(_,_,y),new o.P(_[0]/_[3],_[1]/_[3])}getBounds(){const c=Math.max(0,this.height/2-this.getHorizon());return new Xe().extend(this.pointLocation(new o.P(0,c))).extend(this.pointLocation(new o.P(this.width,c))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Xe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,ro])}calculatePosMatrix(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const y=c.key,_=d?this._alignedPosMatrixCache:this._posMatrixCache;if(_[y])return _[y];const S=c.canonical,B=this.worldSize/this.zoomScale(S.z),k=S.x+Math.pow(2,S.z)*c.wrap,g=o.an(new Float64Array(16));return o.H(g,g,[k*B,S.y*B,0]),o.J(g,g,[B/o.W,B/o.W,1]),o.K(g,d?this.alignedProjMatrix:this.projMatrix,g),_[y]=new Float32Array(g),_[y]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(c,d){d=o.ac(+d,this.minZoom,this.maxZoom);const y={center:new o.M(c.lng,c.lat),zoom:d};let _=this.lngRange;if(!this._renderWorldCopies&&_===null){const et=179.9999999999;_=[-et,et]}const S=this.tileSize*this.zoomScale(y.zoom);let B=0,k=S,g=0,b=S,C=0,M=0;const{x:O,y:j}=this.size;if(this.latRange){const et=this.latRange;B=o.O(et[1])*S,k=o.O(et[0])*S,k-B<j&&(C=j/(k-B))}_&&(g=o.b1(o.N(_[0])*S,0,S),b=o.b1(o.N(_[1])*S,0,S),b<g&&(b+=S),b-g<O&&(M=O/(b-g)));const{x:G,y:H}=this.project.call({worldSize:S},c);let q,X;const ct=Math.max(M||0,C||0);if(ct){const et=new o.P(M?(b+g)/2:G,C?(k+B)/2:H);return y.center=this.unproject.call({worldSize:S},et).wrap(),y.zoom+=this.scaleZoom(ct),y}if(this.latRange){const et=j/2;H-et<B&&(X=B+et),H+et>k&&(X=k-et)}if(_){const et=(g+b)/2;let ht=G;this._renderWorldCopies&&(ht=o.b1(G,et-S/2,et+S/2));const ft=O/2;ht-ft<g&&(q=g+ft),ht+ft>b&&(q=b-ft)}if(q!==void 0||X!==void 0){const et=new o.P(q??G,X??H);y.center=this.unproject.call({worldSize:S},et).wrap()}return y}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c=this._unmodified,{center:d,zoom:y}=this.getConstrained(this.center,this.zoom);this.center=d,this.zoom=y,this._unmodified=c,this._constraining=!1}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,d=this.point.x,y=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b3(1,this.center.lat)*this.worldSize;let _=o.an(new Float64Array(16));o.J(_,_,[this.width/2,-this.height/2,1]),o.H(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=o.an(new Float64Array(16)),o.J(_,_,[1,-1,1]),o.H(_,_,[-1,-1,0]),o.J(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_;const S=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),B=Math.min(this.elevation,this.minElevationForCurrentTile),k=S-B*this._pixelPerMeter/Math.cos(this._pitch),g=B<0?k:S,b=Math.PI/2+this._pitch,C=this._fov*(.5+c.y/this.height),M=Math.sin(C)*g/Math.sin(o.ac(Math.PI-b-C,.01,Math.PI-.01)),O=this.getHorizon(),j=2*Math.atan(O/this.cameraToCenterDistance)*(.5+c.y/(2*O)),G=Math.sin(j)*g/Math.sin(o.ac(Math.PI-b-j,.01,Math.PI-.01)),H=Math.min(M,G),q=1.01*(Math.cos(Math.PI/2-this._pitch)*H+g),X=this.height/50;_=new Float64Array(16),o.b4(_,this._fov,this.width/this.height,X,q),_[8]=2*-c.x/this.width,_[9]=2*c.y/this.height,o.J(_,_,[1,-1,1]),o.H(_,_,[0,0,-this.cameraToCenterDistance]),o.b5(_,_,this._pitch),o.ad(_,_,this.angle),o.H(_,_,[-d,-y,0]),this.mercatorMatrix=o.J([],_,[this.worldSize,this.worldSize,this.worldSize]),o.J(_,_,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.K(new Float64Array(16),this.labelPlaneMatrix,_),o.H(_,_,[0,0,-this.elevation]),this.projMatrix=_,this.invProjMatrix=o.ar([],_),this.pixelMatrix3D=o.K(new Float64Array(16),this.labelPlaneMatrix,_);const ct=this.width%2/2,et=this.height%2/2,ht=Math.cos(this.angle),ft=Math.sin(this.angle),Mt=d-Math.round(d)+ht*ct+ft*et,St=y-Math.round(y)+ht*et+ft*ct,gt=new Float64Array(_);if(o.H(gt,gt,[Mt>.5?Mt-1:Mt,St>.5?St-1:St,0]),this.alignedProjMatrix=gt,_=o.ar(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const c=this.pointCoordinate(new o.P(0,0)),d=[c.x*this.worldSize,c.y*this.worldSize,0,1];return o.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,c))}getCameraQueryGeometry(c){const d=this.getCameraPoint();if(c.length===1)return[c[0],d];{let y=d.x,_=d.y,S=d.x,B=d.y;for(const k of c)y=Math.min(y,k.x),_=Math.min(_,k.y),S=Math.max(S,k.x),B=Math.max(B,k.y);return[new o.P(y,_),new o.P(S,_),new o.P(S,B),new o.P(y,B),new o.P(y,_)]}}lngLatToCameraDepth(c,d){const y=this.locationCoordinate(c),_=[y.x*this.worldSize,y.y*this.worldSize,d,1];return o.af(_,_,this.projMatrix),_[2]/_[3]}}function fl(x,c){var d=this;let y,_=!1,S=null,B=null;const k=()=>{S=null,_&&(x.apply(B,y),S=setTimeout(k,c),_=!1)};return function(){for(var g=arguments.length,b=new Array(g),C=0;C<g;C++)b[C]=arguments[C];return _=!0,B=d,y=b,S||k(),S}}class Vs{constructor(c){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let y;return d.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(y=_)}),(y&&y[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(y=>isNaN(y))){const y=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:y,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=fl(this._updateHashUnthrottled,300),this._hashName=c&&encodeURIComponent(c)}addTo(c){return this._map=c,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(c){const d=this._map.getCenter(),y=Math.round(100*this._map.getZoom())/100,_=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,_),B=Math.round(d.lng*S)/S,k=Math.round(d.lat*S)/S,g=this._map.getBearing(),b=this._map.getPitch();let C="";if(C+=c?`/${B}/${k}/${y}`:`${y}/${k}/${B}`,(g||b)&&(C+="/"+Math.round(10*g)/10),b&&(C+=`/${Math.round(b)}`),this._hashName){const M=this._hashName;let O=!1;const j=window.location.hash.slice(1).split("&").map(G=>{const H=G.split("=")[0];return H===M?(O=!0,`${H}=${C}`):G}).filter(G=>G);return O||j.push(`${M}=${C}`),`#${j.join("&")}`}return`#${C}`}}const sa={linearity:.3,easing:o.b6(0,0,.3,1)},Ro=o.e({deceleration:2500,maxSpeed:1400},sa),Ia=o.e({deceleration:20,maxSpeed:1400},sa),no=o.e({deceleration:1e3,maxSpeed:360},sa),oa=o.e({deceleration:1e3,maxSpeed:90},sa);class pl{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:A.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,d=A.now();for(;c.length>0&&d-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)d.zoom+=S.zoomDelta||0,d.bearing+=S.bearingDelta||0,d.pitch+=S.pitchDelta||0,S.panDelta&&d.pan._add(S.panDelta),S.around&&(d.around=S.around),S.pinchAround&&(d.pinchAround=S.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(d.pan.mag()){const S=Oo(d.pan.mag(),y,o.e({},Ro,c||{}));_.offset=d.pan.mult(S.amount/d.pan.mag()),_.center=this._map.transform.center,aa(_,S)}if(d.zoom){const S=Oo(d.zoom,y,Ia);_.zoom=this._map.transform.zoom+S.amount,aa(_,S)}if(d.bearing){const S=Oo(d.bearing,y,no);_.bearing=this._map.transform.bearing+o.ac(S.amount,-179,179),aa(_,S)}if(d.pitch){const S=Oo(d.pitch,y,oa);_.pitch=this._map.transform.pitch+S.amount,aa(_,S)}if(_.zoom||_.bearing){const S=d.pinchAround===void 0?d.around:d.pinchAround;_.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),o.e(_,{noMoveStart:!0})}}function aa(x,c){(!x.duration||x.duration<c.duration)&&(x.duration=c.duration,x.easing=c.easing)}function Oo(x,c,d){const{maxSpeed:y,linearity:_,deceleration:S}=d,B=o.ac(x*_/(c/1e3),-y,y),k=Math.abs(B)/(S*_);return{easing:d.easing,duration:1e3*k,amount:B*(k/2)}}class dn extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,y){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const S=P.mousePos(d.getCanvas(),y),B=d.unproject(S);super(c,o.e({point:S,lngLat:B,originalEvent:y},_)),this._defaultPrevented=!1,this.target=d}}class Cs extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,y){const _=c==="touchend"?y.changedTouches:y.touches,S=P.touchPos(d.getCanvasContainer(),_),B=S.map(g=>d.unproject(g)),k=S.reduce((g,b,C,M)=>g.add(b.div(M.length)),new o.P(0,0));super(c,{points:S,point:k,lngLats:B,lngLat:d.unproject(k),originalEvent:y}),this._defaultPrevented=!1}}class Ts extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,y){super(c,{originalEvent:y}),this._defaultPrevented=!1}}class Pn{constructor(c,d){this._map=c,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(c){return this._firePreventable(new Ts(c.type,this._map,c))}mousedown(c,d){return this._mousedownPos=d,this._firePreventable(new dn(c.type,this._map,c))}mouseup(c){this._map.fire(new dn(c.type,this._map,c))}click(c,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new dn(c.type,this._map,c))}dblclick(c){return this._firePreventable(new dn(c.type,this._map,c))}mouseover(c){this._map.fire(new dn(c.type,this._map,c))}mouseout(c){this._map.fire(new dn(c.type,this._map,c))}touchstart(c){return this._firePreventable(new Cs(c.type,this._map,c))}touchmove(c){this._map.fire(new Cs(c.type,this._map,c))}touchend(c){this._map.fire(new Cs(c.type,this._map,c))}touchcancel(c){this._map.fire(new Cs(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ii{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(c){this._map.fire(new dn(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new dn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._ignoreContextMenu||this._map.fire(new dn(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yi{constructor(c){this._map=c}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(c){return this.transform.pointLocation(o.P.convert(c),this._map.terrain)}}class _i{constructor(c,d){this._map=c,this._tr=new yi(c),this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,d){this.isEnabled()&&c.shiftKey&&c.button===0&&(P.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(c,d){if(!this._active)return;const y=d;if(this._lastPos.equals(y)||!this._box&&y.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=y,this._box||(this._box=P.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",c));const S=Math.min(_.x,y.x),B=Math.max(_.x,y.x),k=Math.min(_.y,y.y),g=Math.max(_.y,y.y);P.setTransform(this._box,`translate(${S}px,${k}px)`),this._box.style.width=B-S+"px",this._box.style.height=g-k+"px"}mouseupWindow(c,d){if(!this._active||c.button!==0)return;const y=this._startPos,_=d;if(this.reset(),P.suppressClick(),y.x!==_.x||y.y!==_.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:c})),{cameraAnimation:S=>S.fitScreenCoordinates(y,_,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",c)}keydown(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(P.remove(this._box),this._box=null),P.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(c,d){return this._map.fire(new o.k(c,{originalEvent:d}))}}function ji(x,c){if(x.length!==c.length)throw new Error(`The number of touches and points are not equal - touches ${x.length}, points ${c.length}`);const d={};for(let y=0;y<x.length;y++)d[x[y].identifier]=c[y];return d}class Ma{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(c,d,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),y.length===this.numTouches&&(this.centroid=function(_){const S=new o.P(0,0);for(const B of _)S._add(B);return S.div(_.length)}(d),this.touches=ji(y,d)))}touchmove(c,d,y){if(this.aborted||!this.centroid)return;const _=ji(y,d);for(const S in this.touches){const B=_[S];(!B||B.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(c,d,y){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class la{constructor(c){this.singleTap=new Ma(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(c,d,y){this.singleTap.touchstart(c,d,y)}touchmove(c,d,y){this.singleTap.touchmove(c,d,y)}touchend(c,d,y){const _=this.singleTap.touchend(c,d,y);if(_){const S=c.timeStamp-this.lastTime<500,B=!this.lastTap||this.lastTap.dist(_)<30;if(S&&B||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class qc{constructor(c){this._tr=new yi(c),this._zoomIn=new la({numTouches:1,numTaps:2}),this._zoomOut=new la({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,d,y){this._zoomIn.touchstart(c,d,y),this._zoomOut.touchstart(c,d,y)}touchmove(c,d,y){this._zoomIn.touchmove(c,d,y),this._zoomOut.touchmove(c,d,y)}touchend(c,d,y){const _=this._zoomIn.touchend(c,d,y),S=this._zoomOut.touchend(c,d,y),B=this._tr;return _?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:B.zoom+1,around:B.unproject(_)},{originalEvent:c})}):S?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:B.zoom-1,around:B.unproject(S)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class La{constructor(c){this._enabled=!!c.enable,this._moveStateManager=c.moveStateManager,this._clickTolerance=c.clickTolerance||1,this._moveFunction=c.move,this._activateOnStart=!!c.activateOnStart,c.assignEvents(this),this.reset()}reset(c){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(c)}_move(){const c=this._moveFunction(...arguments);if(c.bearingDelta||c.pitchDelta||c.around||c.panDelta)return this._active=!0,c}dragStart(c,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(c)&&(this._moveStateManager.startMove(c),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(c,d){if(!this.isEnabled())return;const y=this._lastPoint;if(!y)return;if(c.preventDefault(),!this._moveStateManager.isValidMoveEvent(c))return void this.reset(c);const _=d.length?d[0]:d;return!this._moved&&_.dist(y)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=_,this._move(y,_))}dragEnd(c){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(c)&&(this._moved&&P.suppressClick(),this.reset(c))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Hc={0:1,2:2};class Do{constructor(c){this._correctEvent=c.checkCorrectEvent}startMove(c){const d=P.mouseButton(c);this._eventButton=d}endMove(c){delete this._eventButton}isValidStartEvent(c){return this._correctEvent(c)}isValidMoveEvent(c){return!function(d,y){const _=Hc[y];return d.buttons===void 0||(d.buttons&_)!==_}(c,this._eventButton)}isValidEndEvent(c){return P.mouseButton(c)===this._eventButton}}class $e{constructor(){this._firstTouch=void 0}_isOneFingerTouch(c){return c.targetTouches.length===1}_isSameTouchEvent(c){return c.targetTouches[0].identifier===this._firstTouch}startMove(c){this._firstTouch=c.targetTouches[0].identifier}endMove(c){delete this._firstTouch}isValidStartEvent(c){return this._isOneFingerTouch(c)}isValidMoveEvent(c){return this._isOneFingerTouch(c)&&this._isSameTouchEvent(c)}isValidEndEvent(c){return this._isOneFingerTouch(c)&&this._isSameTouchEvent(c)}}const Cu=x=>{x.mousedown=x.dragStart,x.mousemoveWindow=x.dragMove,x.mouseup=x.dragEnd,x.contextmenu=function(c){c.preventDefault()}},Jl=x=>{let{enable:c,clickTolerance:d,bearingDegreesPerPixelMoved:y=.8}=x;const _=new Do({checkCorrectEvent:S=>P.mouseButton(S)===0&&S.ctrlKey||P.mouseButton(S)===2});return new La({clickTolerance:d,move:(S,B)=>({bearingDelta:(B.x-S.x)*y}),moveStateManager:_,enable:c,assignEvents:Cu})},Xl=x=>{let{enable:c,clickTolerance:d,pitchDegreesPerPixelMoved:y=-.5}=x;const _=new Do({checkCorrectEvent:S=>P.mouseButton(S)===0&&S.ctrlKey||P.mouseButton(S)===2});return new La({clickTolerance:d,move:(S,B)=>({pitchDelta:(B.y-S.y)*y}),moveStateManager:_,enable:c,assignEvents:Cu})};class bh{constructor(c,d){this._clickTolerance=c.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(c,d,y){return this._calculateTransform(c,d,y)}touchmove(c,d,y){if(this._active&&!(y.length<this.minTouchs()))return c.preventDefault(),this._calculateTransform(c,d,y)}touchend(c,d,y){this._calculateTransform(c,d,y),this._active&&y.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,d,y){y.length>0&&(this._active=!0);const _=ji(y,d),S=new o.P(0,0),B=new o.P(0,0);let k=0;for(const b in _){const C=_[b],M=this._touches[b];M&&(S._add(C),B._add(C.sub(M)),k++,_[b]=C)}if(this._touches=_,k<this.minTouchs()||!B.mag())return;const g=B.div(k);return this._sum._add(g),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(k),panDelta:g}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fe{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(c,d,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([d[0],d[1]]))}touchmove(c,d,y){if(!this._firstTwoTouches)return;c.preventDefault();const[_,S]=this._firstTwoTouches,B=Fn(y,d,_),k=Fn(y,d,S);if(!B||!k)return;const g=this._aroundCenter?null:B.add(k).div(2);return this._move([B,k],g,c)}touchend(c,d,y){if(!this._firstTwoTouches)return;const[_,S]=this._firstTwoTouches,B=Fn(y,d,_),k=Fn(y,d,S);B&&k||(this._active&&P.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Fn(x,c,d){for(let y=0;y<x.length;y++)if(x[y].identifier===d)return c[y]}function qs(x,c){return Math.log(x/c)/Math.LN2}class Tu extends Fe{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,d){const y=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(qs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qs(this._distance,y),pinchAround:d}}}function Kl(x,c){return 180*x.angleWith(c)/Math.PI}class wh extends Fe{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,d,y){const _=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Kl(this._vector,_),pinchAround:d}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const d=25/(Math.PI*this._minDiameter)*360,y=Kl(c,this._startVector);return Math.abs(y)<d}}function Yl(x){return Math.abs(x.y)>Math.abs(x.x)}class Pu extends Fe{constructor(c){super(),this._currentTouchCount=0,this._map=c}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(c,d,y){super.touchstart(c,d,y),this._currentTouchCount=y.length}_start(c){this._lastPoints=c,Yl(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,d,y){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const _=c[0].sub(this._lastPoints[0]),S=c[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,S,y.timeStamp),this._valid?(this._lastPoints=c,this._active=!0,{pitchDelta:(_.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(c,d,y){if(this._valid!==void 0)return this._valid;const _=c.mag()>=2,S=d.mag()>=2;if(!_&&!S)return;if(!_||!S)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;const B=c.y>0==d.y>0;return Yl(c)&&Yl(d)&&B}}const Ld={panStep:100,bearingStep:15,pitchStep:10};class Ba{constructor(c){this._tr=new yi(c);const d=Ld;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let d=0,y=0,_=0,S=0,B=0;switch(c.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:c.shiftKey?y=-1:(c.preventDefault(),S=-1);break;case 39:c.shiftKey?y=1:(c.preventDefault(),S=1);break;case 38:c.shiftKey?_=1:(c.preventDefault(),B=-1);break;case 40:c.shiftKey?_=-1:(c.preventDefault(),B=1);break;default:return}return this._rotationDisabled&&(y=0,_=0),{cameraAnimation:k=>{const g=this._tr;k.easeTo({duration:300,easeId:"keyboardHandler",easing:Mi,zoom:d?Math.round(g.zoom)+d*(c.shiftKey?2:1):g.zoom,bearing:g.bearing+y*this._bearingStep,pitch:g.pitch+_*this._pitchStep,offset:[-S*this._panStep,-B*this._panStep],center:g.center},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Mi(x){return x*(2-x)}const Ql=4.000244140625;class tc{constructor(c,d){this._onTimeout=y=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)},this._map=c,this._tr=new yi(c),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&c.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(c){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!c[this._map.cooperativeGestures._bypassKey])return;let d=c.deltaMode===WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const y=A.now(),_=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,d!==0&&d%Ql==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(_*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),c.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=c,this._delta-=d,this._active||this._start(c)),c.preventDefault()}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=P.mousePos(this._map.getCanvas(),c),y=this._tr;this._around=d.y>y.transform.height/2-y.transform.getHorizon()?o.M.convert(this._aroundCenter?y.center:y.unproject(d)):o.M.convert(y.center),this._aroundPoint=y.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._tr.transform;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>Ql?this._wheelZoomRate:this._defaultZoomRate;let g=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&g!==0&&(g=1/g);const b=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):c.scale;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(b*g))),this._type==="wheel"&&(this._startZoom=c.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:c.zoom,y=this._startZoom,_=this._easing;let S,B=!1;if(this._type==="wheel"&&y&&_){const k=Math.min((A.now()-this._lastWheelEventTime)/200,1),g=_(k);S=o.z.number(y,d,g),k<1?this._frameId||(this._frameId=!0):B=!0}else S=d,B=!0;return this._active=!0,B&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!B,zoomDelta:S-c.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let d=o.b7;if(this._prevEase){const y=this._prevEase,_=(A.now()-y.start)/y.duration,S=y.easing(_+.01)-y.easing(_),B=.27/Math.sqrt(S*S+1e-4)*.01,k=Math.sqrt(.0729-B*B);d=o.b6(B,k,.25,1)}return this._prevEase={start:A.now(),duration:c,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Iu{constructor(c,d){this._clickZoom=c,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Df{constructor(c){this._tr=new yi(c),this.reset()}reset(){this._active=!1}dblclick(c,d){return c.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:this._tr.zoom+(c.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nf{constructor(){this._tap=new la({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(c,d,y){if(!this._swipePoint)if(this._tapTime){const _=d[0],S=c.timeStamp-this._tapTime<500,B=this._tapPoint.dist(_)<30;S&&B?y.length>0&&(this._swipePoint=_,this._swipeTouch=y[0].identifier):this.reset()}else this._tap.touchstart(c,d,y)}touchmove(c,d,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const _=d[0],S=_.y-this._swipePoint.y;return this._swipePoint=_,c.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(c,d,y)}touchend(c,d,y){if(this._tapTime)this._swipePoint&&y.length===0&&this.reset();else{const _=this._tap.touchend(c,d,y);_&&(this._tapTime=c.timeStamp,this._tapPoint=_)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bd{constructor(c,d,y){this._el=c,this._mousePan=d,this._touchPan=y}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class No{constructor(c,d,y){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=d,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Mu{constructor(c,d,y,_){this._el=c,this._touchZoom=d,this._touchRotate=y,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class or{constructor(c,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=c,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const c=this._map.getCanvasContainer();c.classList.add("maplibregl-cooperative-gestures"),this._container=P.create("div","maplibregl-cooperative-gesture-screen",c);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const y=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),_=document.createElement("div");_.className="maplibregl-desktop-message",_.textContent=d,this._container.appendChild(_);const S=document.createElement("div");S.className="maplibregl-mobile-message",S.textContent=y,this._container.appendChild(S),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(P.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(c){this._onCooperativeGesture(c.touches.length===1)}wheel(c){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!c[this._bypassKey])}_onCooperativeGesture(c){this._enabled&&c&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const pr=x=>x.zoom||x.drag||x.pitch||x.rotate;class xh extends o.k{}function ec(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta}class Lu{constructor(c,d){this.handleWindowEvent=_=>{this.handleEvent(_,`${_.type}Window`)},this.handleEvent=(_,S)=>{if(_.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const B=_.type==="renderFrame"?void 0:_,k={needsRenderFrame:!1},g={},b={},C=_.touches,M=C?this._getMapTouches(C):void 0,O=M?P.touchPos(this._map.getCanvas(),M):P.mousePos(this._map.getCanvas(),_);for(const{handlerName:H,handler:q,allowed:X}of this._handlers){if(!q.isEnabled())continue;let ct;this._blockedByActive(b,X,H)?q.reset():q[S||_.type]&&(ct=q[S||_.type](_,O,M),this.mergeHandlerResult(k,g,ct,H,B),ct&&ct.needsRenderFrame&&this._triggerRenderFrame()),(ct||q.isActive())&&(b[H]=q)}const j={};for(const H in this._previousActiveHandlers)b[H]||(j[H]=B);this._previousActiveHandlers=b,(Object.keys(j).length||ec(k))&&(this._changes.push([k,g,j]),this._triggerRenderFrame()),(Object.keys(b).length||ec(k))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=k;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))},this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new pl(c),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,S,B]of this._listeners)P.addEventListener(_,S,_===document?this.handleWindowEvent:this.handleEvent,B)}destroy(){for(const[c,d,y]of this._listeners)P.removeEventListener(c,d,c===document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(c){const d=this._map,y=d.getCanvasContainer();this._add("mapEvent",new Pn(d,c));const _=d.boxZoom=new _i(d,c);this._add("boxZoom",_),c.interactive&&c.boxZoom&&_.enable();const S=d.cooperativeGestures=new or(d,c.cooperativeGestures);this._add("cooperativeGestures",S),c.cooperativeGestures&&S.enable();const B=new qc(d),k=new Df(d);d.doubleClickZoom=new Iu(k,B),this._add("tapZoom",B),this._add("clickZoom",k),c.interactive&&c.doubleClickZoom&&d.doubleClickZoom.enable();const g=new Nf;this._add("tapDragZoom",g);const b=d.touchPitch=new Pu(d);this._add("touchPitch",b),c.interactive&&c.touchPitch&&d.touchPitch.enable(c.touchPitch);const C=Jl(c),M=Xl(c);d.dragRotate=new No(c,C,M),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),c.interactive&&c.dragRotate&&d.dragRotate.enable();const O=(ct=>{let{enable:et,clickTolerance:ht}=ct;const ft=new Do({checkCorrectEvent:Mt=>P.mouseButton(Mt)===0&&!Mt.ctrlKey});return new La({clickTolerance:ht,move:(Mt,St)=>({around:St,panDelta:St.sub(Mt)}),activateOnStart:!0,moveStateManager:ft,enable:et,assignEvents:Cu})})(c),j=new bh(c,d);d.dragPan=new Bd(y,O,j),this._add("mousePan",O),this._add("touchPan",j,["touchZoom","touchRotate"]),c.interactive&&c.dragPan&&d.dragPan.enable(c.dragPan);const G=new wh,H=new Tu;d.touchZoomRotate=new Mu(y,H,G,g),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),c.interactive&&c.touchZoomRotate&&d.touchZoomRotate.enable(c.touchZoomRotate);const q=d.scrollZoom=new tc(d,()=>this._triggerRenderFrame());this._add("scrollZoom",q,["mousePan"]),c.interactive&&c.scrollZoom&&d.scrollZoom.enable(c.scrollZoom);const X=d.keyboard=new Ba(d);this._add("keyboard",X),c.interactive&&c.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new ii(d))}_add(c,d,y){this._handlers.push({handlerName:c,handler:d,allowed:y}),this._handlersById[c]=d}stop(c){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!pr(this._eventsInProgress)||this.isZooming()}_blockedByActive(c,d,y){for(const _ in c)if(_!==y&&(!d||d.indexOf(_)<0))return!0;return!1}_getMapTouches(c){const d=[];for(const y of c)this._el.contains(y.target)&&d.push(y);return d}mergeHandlerResult(c,d,y,_,S){if(!y)return;o.e(c,y);const B={handlerName:_,originalEvent:y.originalEvent||S};y.zoomDelta!==void 0&&(d.zoom=B),y.panDelta!==void 0&&(d.drag=B),y.pitchDelta!==void 0&&(d.pitch=B),y.bearingDelta!==void 0&&(d.rotate=B)}_applyChanges(){const c={},d={},y={};for(const[_,S,B]of this._changes)_.panDelta&&(c.panDelta=(c.panDelta||new o.P(0,0))._add(_.panDelta)),_.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(c.around=_.around),_.pinchAround!==void 0&&(c.pinchAround=_.pinchAround),_.noInertia&&(c.noInertia=_.noInertia),o.e(d,S),o.e(y,B);this._updateMapTransform(c,d,y),this._changes=[]}_updateMapTransform(c,d,y){const _=this._map,S=_._getTransformForUpdate(),B=_.terrain;if(!(ec(c)||B&&this._terrainMovement))return this._fireEvents(d,y,!0);let{panDelta:k,zoomDelta:g,bearingDelta:b,pitchDelta:C,around:M,pinchAround:O}=c;O!==void 0&&(M=O),_._stop(!0),M=M||_.transform.centerPoint;const j=S.pointLocation(k?M.sub(k):M);b&&(S.bearing+=b),C&&(S.pitch+=C),g&&(S.zoom+=g),B?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?S.center=S.pointLocation(S.centerPoint.sub(k)):S.setLocationAtPoint(j,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,S.setLocationAtPoint(j,M),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,S.recalculateZoom(_.terrain)})):S.setLocationAtPoint(j,M),_._applyUpdatedTransform(S),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(d,y,!0)}_fireEvents(c,d,y){const _=pr(this._eventsInProgress),S=pr(c),B={};for(const C in c){const{originalEvent:M}=c[C];this._eventsInProgress[C]||(B[`${C}start`]=M),this._eventsInProgress[C]=c[C]}!_&&S&&this._fireEvent("movestart",S.originalEvent);for(const C in B)this._fireEvent(C,B[C]);S&&this._fireEvent("move",S.originalEvent);for(const C in c){const{originalEvent:M}=c[C];this._fireEvent(C,M)}const k={};let g;for(const C in this._eventsInProgress){const{handlerName:M,originalEvent:O}=this._eventsInProgress[C];this._handlersById[M].isActive()||(delete this._eventsInProgress[C],g=d[M]||O,k[`${C}end`]=g)}for(const C in k)this._fireEvent(C,k[C]);const b=pr(this._eventsInProgress);if(y&&(_||S)&&!b){this._updatingCamera=!0;const C=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),M=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;!C||!C.essential&&A.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:g})),M(this._map.getBearing())&&this._map.resetNorth()):(M(C.bearing||this._map.getBearing())&&(C.bearing=0),C.freezeElevation=!0,this._map.easeTo(C,{originalEvent:g})),this._updatingCamera=!1}}_fireEvent(c,d){this._map.fire(new o.k(c,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{delete this._frameId,this.handleEvent(new xh("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class zn extends o.E{constructor(c,d){super(),this._renderFrameCallback=()=>{const y=Math.min((A.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.M(this.transform.center.lng,this.transform.center.lat)}setCenter(c,d){return this.jumpTo({center:c},d)}panBy(c,d,y){return c=o.P.convert(c).mult(-1),this.panTo(this.transform.center,o.e({offset:c},d),y)}panTo(c,d,y){return this.easeTo(o.e({center:c},d),y)}getZoom(){return this.transform.zoom}setZoom(c,d){return this.jumpTo({zoom:c},d),this}zoomTo(c,d,y){return this.easeTo(o.e({zoom:c},d),y)}zoomIn(c,d){return this.zoomTo(this.getZoom()+1,c,d),this}zoomOut(c,d){return this.zoomTo(this.getZoom()-1,c,d),this}getBearing(){return this.transform.bearing}setBearing(c,d){return this.jumpTo({bearing:c},d),this}getPadding(){return this.transform.padding}setPadding(c,d){return this.jumpTo({padding:c},d),this}rotateTo(c,d,y){return this.easeTo(o.e({bearing:c},d),y)}resetNorth(c,d){return this.rotateTo(0,o.e({duration:1e3},c),d),this}resetNorthPitch(c,d){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},c),d),this}snapToNorth(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this}getPitch(){return this.transform.pitch}setPitch(c,d){return this.jumpTo({pitch:c},d),this}cameraForBounds(c,d){c=Xe.convert(c);const y=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),y,d)}_cameraForBoxAndBearing(c,d,y,_){const S={top:0,bottom:0,right:0,left:0};if(typeof(_=o.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const $t=_.padding;_.padding={top:$t,bottom:$t,right:$t,left:$t}}_.padding=o.e(S,_.padding);const B=this.transform,k=B.padding,g=new Xe(c,d),b=B.project(g.getNorthWest()),C=B.project(g.getNorthEast()),M=B.project(g.getSouthEast()),O=B.project(g.getSouthWest()),j=o.b8(-y),G=b.rotate(j),H=C.rotate(j),q=M.rotate(j),X=O.rotate(j),ct=new o.P(Math.max(G.x,H.x,X.x,q.x),Math.max(G.y,H.y,X.y,q.y)),et=new o.P(Math.min(G.x,H.x,X.x,q.x),Math.min(G.y,H.y,X.y,q.y)),ht=ct.sub(et),ft=(B.width-(k.left+k.right+_.padding.left+_.padding.right))/ht.x,Mt=(B.height-(k.top+k.bottom+_.padding.top+_.padding.bottom))/ht.y;if(Mt<0||ft<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const St=Math.min(B.scaleZoom(B.scale*Math.min(ft,Mt)),_.maxZoom),gt=o.P.convert(_.offset),yt=new o.P((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(o.b8(y)),Vt=gt.add(yt).mult(B.scale/B.zoomScale(St));return{center:B.unproject(b.add(M).div(2).sub(Vt)),zoom:St,bearing:y}}fitBounds(c,d,y){return this._fitInternal(this.cameraForBounds(c,d),d,y)}fitScreenCoordinates(c,d,y,_,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(c)),this.transform.pointLocation(o.P.convert(d)),y,_),_,S)}_fitInternal(c,d,y){return c?(delete(d=o.e(c,d)).padding,d.linear?this.easeTo(d,y):this.flyTo(d,y)):this}jumpTo(c,d){this.stop();const y=this._getTransformForUpdate();let _=!1,S=!1,B=!1;return"zoom"in c&&y.zoom!==+c.zoom&&(_=!0,y.zoom=+c.zoom),c.center!==void 0&&(y.center=o.M.convert(c.center)),"bearing"in c&&y.bearing!==+c.bearing&&(S=!0,y.bearing=+c.bearing),"pitch"in c&&y.pitch!==+c.pitch&&(B=!0,y.pitch=+c.pitch),c.padding==null||y.isPaddingEqual(c.padding)||(y.padding=c.padding),this._applyUpdatedTransform(y),this.fire(new o.k("movestart",d)).fire(new o.k("move",d)),_&&this.fire(new o.k("zoomstart",d)).fire(new o.k("zoom",d)).fire(new o.k("zoomend",d)),S&&this.fire(new o.k("rotatestart",d)).fire(new o.k("rotate",d)).fire(new o.k("rotateend",d)),B&&this.fire(new o.k("pitchstart",d)).fire(new o.k("pitch",d)).fire(new o.k("pitchend",d)),this.fire(new o.k("moveend",d))}calculateCameraOptionsFromTo(c,d,y){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const S=o.Y.fromLngLat(c,d),B=o.Y.fromLngLat(y,_),k=B.x-S.x,g=B.y-S.y,b=B.z-S.z,C=Math.hypot(k,g,b);if(C===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(k,g),O=this.transform.scaleZoom(this.transform.cameraToCenterDistance/C/this.transform.tileSize),j=180*Math.atan2(k,-g)/Math.PI;let G=180*Math.acos(M/C)/Math.PI;return G=b<0?90-G:90+G,{center:B.toLngLat(),zoom:O,pitch:G,bearing:j}}easeTo(c,d){var y;this._stop(!1,c.easeId),((c=o.e({offset:[0,0],duration:500,easing:o.b7},c)).animate===!1||!c.essential&&A.prefersReducedMotion)&&(c.duration=0);const _=this._getTransformForUpdate(),S=this.getZoom(),B=this.getBearing(),k=this.getPitch(),g=this.getPadding(),b="bearing"in c?this._normalizeBearing(c.bearing,B):B,C="pitch"in c?+c.pitch:k,M="padding"in c?c.padding:_.padding,O=o.P.convert(c.offset);let j=_.centerPoint.add(O);const G=_.pointLocation(j),{center:H,zoom:q}=_.getConstrained(o.M.convert(c.center||G),(y=c.zoom)!==null&&y!==void 0?y:S);this._normalizeCenter(H);const X=_.project(G),ct=_.project(H).sub(X),et=_.zoomScale(q-S);let ht,ft;c.around&&(ht=o.M.convert(c.around),ft=_.locationPoint(ht));const Mt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||q!==S,this._rotating=this._rotating||B!==b,this._pitching=this._pitching||C!==k,this._padding=!_.isPaddingEqual(M),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,Mt),this.terrain&&this._prepareElevation(H),this._ease(St=>{if(this._zooming&&(_.zoom=o.z.number(S,q,St)),this._rotating&&(_.bearing=o.z.number(B,b,St)),this._pitching&&(_.pitch=o.z.number(k,C,St)),this._padding&&(_.interpolatePadding(g,M,St),j=_.centerPoint.add(O)),this.terrain&&!c.freezeElevation&&this._updateElevation(St),ht)_.setLocationAtPoint(ht,ft);else{const gt=_.zoomScale(_.zoom-S),yt=q>S?Math.min(2,et):Math.max(.5,et),Vt=Math.pow(yt,1-St),$t=_.unproject(X.add(ct.mult(St*Vt)).mult(gt));_.setLocationAtPoint(_.renderWorldCopies?$t.wrap():$t,j)}this._applyUpdatedTransform(_),this._fireMoveEvents(d)},St=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,St)},c),this}_prepareEase(c,d){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,d||y.moving||this.fire(new o.k("movestart",c)),this._zooming&&!y.zooming&&this.fire(new o.k("zoomstart",c)),this._rotating&&!y.rotating&&this.fire(new o.k("rotatestart",c)),this._pitching&&!y.pitching&&this.fire(new o.k("pitchstart",c))}_prepareElevation(c){this._elevationCenter=c,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(c,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(c){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(c<1&&d!==this._elevationTarget){const y=this._elevationTarget-this._elevationStart;this._elevationStart+=c*(y-(d-(y*c+this._elevationStart))/(1-c)),this._elevationTarget=d}this.transform.elevation=o.z.number(this._elevationStart,this._elevationTarget,c)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(c){if(!this.transformCameraUpdate)return;const d=c.clone(),{center:y,zoom:_,pitch:S,bearing:B,elevation:k}=this.transformCameraUpdate(d);y&&(d.center=y),_!==void 0&&(d.zoom=_),S!==void 0&&(d.pitch=S),B!==void 0&&(d.bearing=B),k!==void 0&&(d.elevation=k),this.transform.apply(d)}_fireMoveEvents(c){this.fire(new o.k("move",c)),this._zooming&&this.fire(new o.k("zoom",c)),this._rotating&&this.fire(new o.k("rotate",c)),this._pitching&&this.fire(new o.k("pitch",c))}_afterEase(c,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const y=this._zooming,_=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new o.k("zoomend",c)),_&&this.fire(new o.k("rotateend",c)),S&&this.fire(new o.k("pitchend",c)),this.fire(new o.k("moveend",c))}flyTo(c,d){var y;if(!c.essential&&A.prefersReducedMotion){const we=o.L(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(we,d)}this.stop(),c=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.b7},c);const _=this._getTransformForUpdate(),S=this.getZoom(),B=this.getBearing(),k=this.getPitch(),g=this.getPadding(),b="bearing"in c?this._normalizeBearing(c.bearing,B):B,C="pitch"in c?+c.pitch:k,M="padding"in c?c.padding:_.padding,O=o.P.convert(c.offset);let j=_.centerPoint.add(O);const G=_.pointLocation(j),{center:H,zoom:q}=_.getConstrained(o.M.convert(c.center||G),(y=c.zoom)!==null&&y!==void 0?y:S);this._normalizeCenter(H);const X=_.zoomScale(q-S),ct=_.project(G),et=_.project(H).sub(ct);let ht=c.curve;const ft=Math.max(_.width,_.height),Mt=ft/X,St=et.mag();if("minZoom"in c){const we=o.ac(Math.min(c.minZoom,S,q),_.minZoom,_.maxZoom),Ue=ft/_.zoomScale(we-S);ht=Math.sqrt(Ue/St*2)}const gt=ht*ht;function yt(we){const Ue=(Mt*Mt-ft*ft+(we?-1:1)*gt*gt*St*St)/(2*(we?Mt:ft)*gt*St);return Math.log(Math.sqrt(Ue*Ue+1)-Ue)}function Vt(we){return(Math.exp(we)-Math.exp(-we))/2}function $t(we){return(Math.exp(we)+Math.exp(-we))/2}const ae=yt(!1);let le=function(we){return $t(ae)/$t(ae+ht*we)},me=function(we){return ft*(($t(ae)*(Vt(Ue=ae+ht*we)/$t(Ue))-Vt(ae))/gt)/St;var Ue},Le=(yt(!0)-ae)/ht;if(Math.abs(St)<1e-6||!isFinite(Le)){if(Math.abs(ft-Mt)<1e-6)return this.easeTo(c,d);const we=Mt<ft?-1:1;Le=Math.abs(Math.log(Mt/ft))/ht,me=function(){return 0},le=function(Ue){return Math.exp(we*ht*Ue)}}return c.duration="duration"in c?+c.duration:1e3*Le/("screenSpeed"in c?+c.screenSpeed/ht:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=B!==b,this._pitching=C!==k,this._padding=!_.isPaddingEqual(M),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(H),this._ease(we=>{const Ue=we*Le,Ke=1/le(Ue);_.zoom=we===1?q:S+_.scaleZoom(Ke),this._rotating&&(_.bearing=o.z.number(B,b,we)),this._pitching&&(_.pitch=o.z.number(k,C,we)),this._padding&&(_.interpolatePadding(g,M,we),j=_.centerPoint.add(O)),this.terrain&&!c.freezeElevation&&this._updateElevation(we);const Je=we===1?H:_.unproject(ct.add(et.mult(me(Ue))).mult(Ke));_.setLocationAtPoint(_.renderWorldCopies?Je.wrap():Je,j),this._applyUpdatedTransform(_),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,d)}if(!c){const y=this.handlers;y&&y.stop(!1)}return this}_ease(c,d,y){y.animate===!1||y.duration===0?(c(1),d()):(this._easeStart=A.now(),this._easeOptions=y,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(c,d){c=o.b1(c,-180,180);const y=Math.abs(c-d);return Math.abs(c-360-d)<y&&(c-=360),Math.abs(c+360-d)<y&&(c+=360),c}_normalizeCenter(c){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const y=c.lng-d.center.lng;c.lng+=y>180?-360:y<-180?360:0}queryTerrainElevation(c){return this.terrain?this.terrain.getElevationForLngLatZoom(o.M.convert(c),this.transform.tileZoom)-this.transform.elevation:null}}const kd={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Fo{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:kd;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=c}getDefaultPosition(){return"bottom-right"}onAdd(c){return this._map=c,this._compact=this.options.compact,this._container=P.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=P.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=P.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){P.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(c,d){const y=this._map._getUIString(`AttributionControl.${d}`);c.title=y,c.setAttribute("aria-label",y)}_updateAttributions(){if(!this._map.style)return;let c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const d=this._map.style.sourceCaches;for(const _ in d){const S=d[_];if(S.used||S.usedForTerrain){const B=S.getSource();B.attribution&&c.indexOf(B.attribution)<0&&c.push(B.attribution)}}c=c.filter(_=>String(_).trim()),c.sort((_,S)=>_.length-S.length),c=c.filter((_,S)=>{for(let B=S+1;B<c.length;B++)if(c[B].indexOf(_)>=0)return!1;return!0});const y=c.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,c.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Rd{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const d=this._container.children;if(d.length){const y=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&y.classList.add("maplibregl-compact"):y.classList.remove("maplibregl-compact")}},this.options=c}getDefaultPosition(){return"bottom-left"}onAdd(c){this._map=c,this._compact=this.options&&this.options.compact,this._container=P.create("div","maplibregl-ctrl");const d=P.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){P.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Bu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const d=++this._id;return this._queue.push({callback:c,id:d,cancelled:!1}),d}remove(c){const d=this._currentlyRunning,y=d?this._queue.concat(d):this._queue;for(const _ of y)if(_.id===c)return void(_.cancelled=!0)}run(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const y of d)if(!y.cancelled&&(y.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var tn=o.X([{name:"a_pos3d",type:"Int16",components:3}]);class fn extends o.E{constructor(c){super(),this.sourceCache=c,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,c.usedForTerrain=!0,c.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(c,d){this.sourceCache.update(c,d),this._renderableTilesKeys=[];const y={};for(const _ of c.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))y[_.key]=!0,this._renderableTilesKeys.push(_.key),this._tiles[_.key]||(_.posMatrix=new Float64Array(16),o.aN(_.posMatrix,0,o.W,0,o.W,0,1),this._tiles[_.key]=new Tr(_,this.tileSize));for(const _ in this._tiles)y[_]||delete this._tiles[_]}freeRtt(c){for(const d in this._tiles){const y=this._tiles[d];(!c||y.tileID.equals(c)||y.tileID.isChildOf(c)||c.isChildOf(y.tileID))&&(y.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(c=>this.getTileByID(c))}getTileByID(c){return this._tiles[c]}getTerrainCoords(c){const d={};for(const y of this._renderableTilesKeys){const _=this._tiles[y].tileID;if(_.canonical.equals(c.canonical)){const S=c.clone();S.posMatrix=new Float64Array(16),o.aN(S.posMatrix,0,o.W,0,o.W,0,1),d[y]=S}else if(_.canonical.isChildOf(c.canonical)){const S=c.clone();S.posMatrix=new Float64Array(16);const B=_.canonical.z-c.canonical.z,k=_.canonical.x-(_.canonical.x>>B<<B),g=_.canonical.y-(_.canonical.y>>B<<B),b=o.W>>B;o.aN(S.posMatrix,0,b,0,b,0,1),o.H(S.posMatrix,S.posMatrix,[-k*b,-g*b,0]),d[y]=S}else if(c.canonical.isChildOf(_.canonical)){const S=c.clone();S.posMatrix=new Float64Array(16);const B=c.canonical.z-_.canonical.z,k=c.canonical.x-(c.canonical.x>>B<<B),g=c.canonical.y-(c.canonical.y>>B<<B),b=o.W>>B;o.aN(S.posMatrix,0,o.W,0,o.W,0,1),o.H(S.posMatrix,S.posMatrix,[k*b,g*b,0]),o.J(S.posMatrix,S.posMatrix,[1/2**B,1/2**B,0]),d[y]=S}}return d}getSourceTile(c,d){const y=this.sourceCache._source;let _=c.overscaledZ-this.deltaZoom;if(_>y.maxzoom&&(_=y.maxzoom),_<y.minzoom)return null;this._sourceTileCache[c.key]||(this._sourceTileCache[c.key]=c.scaledTo(_).key);let S=this.sourceCache.getTileByID(this._sourceTileCache[c.key]);if((!S||!S.dem)&&d)for(;_>=y.minzoom&&(!S||!S.dem);)S=this.sourceCache.getTileByID(c.scaledTo(_--).key);return S}tilesAfterTime(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(d=>d.timeAdded>=c)}}class Ff{constructor(c,d,y){this.painter=c,this.sourceCache=new fn(d),this.options=y,this.exaggeration=typeof y.exaggeration=="number"?y.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(c,d,y){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.W;var S;if(!(d>=0&&d<_&&y>=0&&y<_))return 0;const B=this.getTerrainData(c),k=(S=B.tile)===null||S===void 0?void 0:S.dem;if(!k)return 0;const g=function(G,H,q){var X=H[0],ct=H[1];return G[0]=q[0]*X+q[4]*ct+q[12],G[1]=q[1]*X+q[5]*ct+q[13],G}([],[d/_*o.W,y/_*o.W],B.u_terrain_matrix),b=[g[0]*k.dim,g[1]*k.dim],C=Math.floor(b[0]),M=Math.floor(b[1]),O=b[0]-C,j=b[1]-M;return k.get(C,M)*(1-O)*(1-j)+k.get(C+1,M)*O*(1-j)+k.get(C,M+1)*(1-O)*j+k.get(C+1,M+1)*O*j}getElevationForLngLatZoom(c,d){const{tileID:y,mercatorX:_,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(c,d);return this.getElevation(y,_%o.W,S%o.W,o.W)}getElevation(c,d,y){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.W;return this.getDEMElevation(c,d,y,_)*this.exaggeration}getTerrainData(c){if(!this._emptyDemTexture){const _=this.painter.context,S=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new at(_,S,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new at(_,new o.R({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.an([])}const d=this.sourceCache.getSourceTile(c,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const _=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new at(_,d.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),d.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const y=d&&d+d.tileID.key+c.key;if(y&&!this._demMatrixCache[y]){const _=this.sourceCache.sourceCache._source.maxzoom;let S=c.canonical.z-d.tileID.canonical.z;c.overscaledZ>c.canonical.z&&(c.canonical.z>=_?S=c.canonical.z-_:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const B=c.canonical.x-(c.canonical.x>>S<<S),k=c.canonical.y-(c.canonical.y>>S<<S),g=o.b9(new Float64Array(16),[1/(o.W<<S),1/(o.W<<S),0]);o.H(g,g,[B*o.W,k*o.W,0]),this._demMatrixCache[c.key]={matrix:g,coord:c}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:y?this._demMatrixCache[c.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(c){const d=this.painter,y=d.width/devicePixelRatio,_=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===y&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new at(d.context,{width:y,height:_,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new at(d.context,{width:y,height:_,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(y,_,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,y,_))),this._fbo.colorAttachment.set(c==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const c=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,B=0;S<this._coordsTextureSize;S++)for(let k=0;k<this._coordsTextureSize;k++,B+=4)d[B+0]=255&k,d[B+1]=255&S,d[B+2]=k>>8<<4|S>>8,d[B+3]=0;const y=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),_=new at(c,y,c.gl.RGBA,{premultiply:!1});return _.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(c){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),y=this.painter.context,_=y.gl,S=Math.round(c.x*this.painter.pixelRatio/devicePixelRatio),B=Math.round(c.y*this.painter.pixelRatio/devicePixelRatio),k=Math.round(this.painter.height/devicePixelRatio);y.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),_.readPixels(S,k-B-1,1,1,_.RGBA,_.UNSIGNED_BYTE,d),y.bindFramebuffer.set(null);const g=d[0]+(d[2]>>4<<8),b=d[1]+((15&d[2])<<8),C=this.coordsIndex[255-d[3]],M=C&&this.sourceCache.getTileByID(C);if(!M)return null;const O=this._coordsTextureSize,j=(1<<M.tileID.canonical.z)*O;return new o.Y((M.tileID.canonical.x*O+g)/j+M.tileID.wrap,(M.tileID.canonical.y*O+b)/j,this.getElevation(M.tileID,g,b,O))}depthAtPoint(c){const d=new Uint8Array(4),y=this.painter.context,_=y.gl;return y.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),_.readPixels(c.x,this.painter.height/devicePixelRatio-c.y-1,1,1,_.RGBA,_.UNSIGNED_BYTE,d),y.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const c=this.painter.context,d=new o.ba,y=new o.aX,_=this.meshSize,S=o.W/_,B=_*_;for(let M=0;M<=_;M++)for(let O=0;O<=_;O++)d.emplaceBack(O*S,M*S,0);for(let M=0;M<B;M+=_+1)for(let O=0;O<_;O++)y.emplaceBack(O+M,_+O+M+1,_+O+M+2),y.emplaceBack(O+M,_+O+M+2,O+M+1);const k=d.length,g=k+2*(_+1);for(const M of[0,1])for(let O=0;O<=_;O++)for(const j of[0,1])d.emplaceBack(O*S,M*o.W,j);for(let M=0;M<2*_;M+=2)y.emplaceBack(g+M,g+M+1,g+M+3),y.emplaceBack(g+M,g+M+3,g+M+2),y.emplaceBack(k+M,k+M+3,k+M+1),y.emplaceBack(k+M,k+M+2,k+M+3);const b=d.length,C=b+2*(_+1);for(const M of[0,1])for(let O=0;O<=_;O++)for(const j of[0,1])d.emplaceBack(M*o.W,O*S,j);for(let M=0;M<2*_;M+=2)y.emplaceBack(b+M,b+M+1,b+M+3),y.emplaceBack(b+M,b+M+3,b+M+2),y.emplaceBack(C+M,C+M+3,C+M+1),y.emplaceBack(C+M,C+M+2,C+M+3);return this._mesh={indexBuffer:c.createIndexBuffer(y),vertexBuffer:c.createVertexBuffer(d,tn.members),segments:o.$.simpleSegment(0,0,d.length,y.length)},this._mesh}getMeshFrameDelta(c){return 2*Math.PI*o.bb/Math.pow(2,c)/5}getMinTileElevationForLngLatZoom(c,d){var y;const{tileID:_}=this._getOverscaledTileIDFromLngLatZoom(c,d);return(y=this.getMinMaxElevation(_).minElevation)!==null&&y!==void 0?y:0}getMinMaxElevation(c){const d=this.getTerrainData(c).tile,y={minElevation:null,maxElevation:null};return d&&d.dem&&(y.minElevation=d.dem.min*this.exaggeration,y.maxElevation=d.dem.max*this.exaggeration),y}_getOverscaledTileIDFromLngLatZoom(c,d){const y=o.Y.fromLngLat(c.wrap()),_=(1<<d)*o.W,S=y.x*_,B=y.y*_,k=Math.floor(S/o.W),g=Math.floor(B/o.W);return{tileID:new o.Q(d,0,d,k,g),mercatorX:S,mercatorY:B}}}class so{constructor(c,d,y){this._context=c,this._size=d,this._tileSize=y,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const c of this._objects)c.texture.destroy(),c.fbo.destroy()}_createObject(c){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),y=new at(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return y.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(y.texture),{id:c,fbo:d,texture:y,stamp:-1,inUse:!1}}getObjectForId(c){return this._objects[c]}useObject(c){c.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>c.id!==d),this._recentlyUsed.push(c.id)}stampObject(c){c.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const c=this._createObject(this._objects.length);return this._objects.push(c),c}freeObject(c){c.inUse=!1}freeAllObjects(){for(const c of this._objects)this.freeObject(c)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(c=>!c.inUse)===!1}}const In={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class zo{constructor(c,d){this.painter=c,this.terrain=d,this.pool=new so(c.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(c){return this.pool.getObjectForId(c.rtt[this._stacks.length-1].id).texture}prepareForRender(c,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=c._order.filter(y=>!c._layers[y].isHidden(d)),this._coordsDescendingInv={};for(const y in c.sourceCaches){this._coordsDescendingInv[y]={};const _=c.sourceCaches[y].getVisibleCoordinates();for(const S of _){const B=this.terrain.sourceCache.getTerrainCoords(S);for(const k in B)this._coordsDescendingInv[y][k]||(this._coordsDescendingInv[y][k]=[]),this._coordsDescendingInv[y][k].push(B[k])}}this._coordsDescendingInvStr={};for(const y of c._order){const _=c._layers[y],S=_.source;if(In[_.type]&&!this._coordsDescendingInvStr[S]){this._coordsDescendingInvStr[S]={};for(const B in this._coordsDescendingInv[S])this._coordsDescendingInvStr[S][B]=this._coordsDescendingInv[S][B].map(k=>k.key).sort().join()}}for(const y of this._renderableTiles)for(const _ in this._coordsDescendingInvStr){const S=this._coordsDescendingInvStr[_][y.tileID.key];S&&S!==y.rttCoords[_]&&(y.rtt=[])}}renderLayer(c){if(c.isHidden(this.painter.transform.zoom))return!1;const d=c.type,y=this.painter,_=this._renderableLayerIds[this._renderableLayerIds.length-1]===c.id;if(In[d]&&(this._prevType&&In[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(c.id),!_))return!0;if(In[this._prevType]||In[d]&&_){this._prevType=d;const S=this._stacks.length-1,B=this._stacks[S]||[];for(const k of this._renderableTiles){if(this.pool.isFull()&&(Vc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(k),k.rtt[S]){const b=this.pool.getObjectForId(k.rtt[S].id);if(b.stamp===k.rtt[S].stamp){this.pool.useObject(b);continue}}const g=this.pool.getOrCreateFreeObject();this.pool.useObject(g),this.pool.stampObject(g),k.rtt[S]={id:g.id,stamp:g.stamp},y.context.bindFramebuffer.set(g.fbo.framebuffer),y.context.clear({color:o.aO.transparent,stencil:0}),y.currentStencilSource=void 0;for(let b=0;b<B.length;b++){const C=y.style._layers[B[b]],M=C.source?this._coordsDescendingInv[C.source][k.tileID.key]:[k.tileID];y.context.viewport.set([0,0,g.fbo.width,g.fbo.height]),y._renderTileClippingMasks(C,M),y.renderLayer(y,y.style.sourceCaches[C.source],C,M),C.source&&(k.rttCoords[C.source]=this._coordsDescendingInvStr[C.source][k.tileID.key])}}return Vc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),In[d]}return!1}}const Od={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ah=f,oo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:kd,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},gs=x=>{x.touchstart=x.dragStart,x.touchmoveWindow=x.dragMove,x.touchend=x.dragEnd},Dd={showCompass:!0,showZoom:!0,visualizePitch:!1};class Nd{constructor(c,d){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=B=>{this.startMouse(o.e({},B,{ctrlKey:!0,preventDefault:()=>B.preventDefault()}),P.mousePos(this.element,B)),P.addEventListener(window,"mousemove",this.mousemove),P.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=B=>{this.moveMouse(B,P.mousePos(this.element,B))},this.mouseup=B=>{this.mouseRotate.dragEnd(B),this.mousePitch&&this.mousePitch.dragEnd(B),this.offTemp()},this.touchstart=B=>{B.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=P.touchPos(this.element,B.targetTouches)[0],this.startTouch(B,this._startPos),P.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.addEventListener(window,"touchend",this.touchend))},this.touchmove=B=>{B.targetTouches.length!==1?this.reset():(this._lastPos=P.touchPos(this.element,B.targetTouches)[0],this.moveTouch(B,this._lastPos))},this.touchend=B=>{B.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const _=c.dragRotate._mouseRotate.getClickTolerance(),S=c.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=Jl({clickTolerance:_,enable:!0}),this.touchRotate=(B=>{let{enable:k,clickTolerance:g,bearingDegreesPerPixelMoved:b=.8}=B;const C=new $e;return new La({clickTolerance:g,move:(M,O)=>({bearingDelta:(O.x-M.x)*b}),moveStateManager:C,enable:k,assignEvents:gs})})({clickTolerance:_,enable:!0}),this.map=c,y&&(this.mousePitch=Xl({clickTolerance:S,enable:!0}),this.touchPitch=(B=>{let{enable:k,clickTolerance:g,pitchDegreesPerPixelMoved:b=-.5}=B;const C=new $e;return new La({clickTolerance:g,move:(M,O)=>({pitchDelta:(O.y-M.y)*b}),moveStateManager:C,enable:k,assignEvents:gs})})({clickTolerance:S,enable:!0})),P.addEventListener(d,"mousedown",this.mousedown),P.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),P.addEventListener(d,"touchcancel",this.reset)}startMouse(c,d){this.mouseRotate.dragStart(c,d),this.mousePitch&&this.mousePitch.dragStart(c,d),P.disableDrag()}startTouch(c,d){this.touchRotate.dragStart(c,d),this.touchPitch&&this.touchPitch.dragStart(c,d),P.disableDrag()}moveMouse(c,d){const y=this.map,{bearingDelta:_}=this.mouseRotate.dragMove(c,d)||{};if(_&&y.setBearing(y.getBearing()+_),this.mousePitch){const{pitchDelta:S}=this.mousePitch.dragMove(c,d)||{};S&&y.setPitch(y.getPitch()+S)}}moveTouch(c,d){const y=this.map,{bearingDelta:_}=this.touchRotate.dragMove(c,d)||{};if(_&&y.setBearing(y.getBearing()+_),this.touchPitch){const{pitchDelta:S}=this.touchPitch.dragMove(c,d)||{};S&&y.setPitch(y.getPitch()+S)}}off(){const c=this.element;P.removeEventListener(c,"mousedown",this.mousedown),P.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend),P.removeEventListener(c,"touchcancel",this.reset),this.offTemp()}offTemp(){P.enableDrag(),P.removeEventListener(window,"mousemove",this.mousemove),P.removeEventListener(window,"mouseup",this.mouseup),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend)}}let ca;function ku(x,c,d){const y=new o.M(x.lng,x.lat);if(x=new o.M(x.lng,x.lat),c){const _=new o.M(x.lng-360,x.lat),S=new o.M(x.lng+360,x.lat),B=d.locationPoint(x).distSqr(c);d.locationPoint(_).distSqr(c)<B?x=_:d.locationPoint(S).distSqr(c)<B&&(x=S)}for(;Math.abs(x.lng-d.center.lng)>180;){const _=d.locationPoint(x);if(_.x>=0&&_.y>=0&&_.x<=d.width&&_.y<=d.height)break;x.lng>d.center.lng?x.lng-=360:x.lng+=360}return x.lng!==y.lng&&d.locationPoint(x).y>d.height/2-d.getHorizon()?x:y}const Wc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ru(x,c,d){const y=x.classList;for(const _ in Wc)y.remove(`maplibregl-${d}-anchor-${_}`);y.add(`maplibregl-${d}-anchor-${c}`)}class Ou extends o.E{constructor(c){if(super(),this._onKeyPress=d=>{const y=d.code,_=d.charCode||d.keyCode;y!=="Space"&&y!=="Enter"&&_!==32&&_!==13||this.togglePopup()},this._onMapClick=d=>{const y=d.originalEvent.target,_=this._element;this._popup&&(y===_||_.contains(y))&&this.togglePopup()},this._update=d=>{var y;if(!this._map)return;const _=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!_)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?ku(this._lngLat,this._flatPos,this._map.transform):(y=this._lngLat)===null||y===void 0?void 0:y.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let S="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?S=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(S=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let B="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?B="rotateX(0deg)":this._pitchAlignment==="map"&&(B=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),P.setTransform(this._element,`${Wc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${B} ${S}`),A.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const y=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(c==null?void 0:c.opacity,c==null?void 0:c.opacityWhenCovered),c&&c.element)this._element=c.element,this._offset=o.P.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=P.create("div"),this._element.setAttribute("aria-label","Map marker");const d=P.createNS("http://www.w3.org/2000/svg","svg"),y=41,_=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${y}px`),d.setAttributeNS(null,"width",`${_}px`),d.setAttributeNS(null,"viewBox",`0 0 ${_} ${y}`);const S=P.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const B=P.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill-rule","nonzero");const k=P.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");const g=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const X of g){const ct=P.createNS("http://www.w3.org/2000/svg","ellipse");ct.setAttributeNS(null,"opacity","0.04"),ct.setAttributeNS(null,"cx","10.5"),ct.setAttributeNS(null,"cy","5.80029008"),ct.setAttributeNS(null,"rx",X.rx),ct.setAttributeNS(null,"ry",X.ry),k.appendChild(ct)}const b=P.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill",this._color);const C=P.createNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),b.appendChild(C);const M=P.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const O=P.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(O);const j=P.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const G=P.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const H=P.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");const q=P.createNS("http://www.w3.org/2000/svg","circle");q.setAttributeNS(null,"fill","#FFFFFF"),q.setAttributeNS(null,"cx","5.5"),q.setAttributeNS(null,"cy","5.5"),q.setAttributeNS(null,"r","5.4999962"),G.appendChild(H),G.appendChild(q),B.appendChild(k),B.appendChild(b),B.appendChild(M),B.appendChild(j),B.appendChild(G),d.appendChild(B),d.setAttributeNS(null,"height",y*this._scale+"px"),d.setAttributeNS(null,"width",_*this._scale+"px"),this._element.appendChild(d),this._offset=o.P.convert(c&&c.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),Ru(this._element,this._anchor,"marker"),c&&c.className)for(const d of c.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),c.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),P.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=o.M.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const d=Math.abs(13.5)/Math.SQRT2;c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=c,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const c=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:c?(c.isOpen()?c.remove():(c.setLngLat(this._lngLat),c.addTo(this._map)),this):this}_updateOpacity(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var d,y;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(c)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const _=this._map,S=_.terrain.depthAtPoint(this._pos),B=_.terrain.getElevationForLngLatZoom(this._lngLat,_.transform.tileZoom);if(_.transform.lngLatToCameraDepth(this._lngLat,B)-S<.006)return void(this._element.style.opacity=this._opacity);const k=-this._offset.y/_.transform._pixelPerMeter,g=Math.sin(_.getPitch()*Math.PI/180)*k,b=_.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),C=_.transform.lngLatToCameraDepth(this._lngLat,B+g)-b>.006;!((y=this._popup)===null||y===void 0)&&y.isOpen()&&C&&this._popup.remove(),this._element.style.opacity=C?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(c){return this._offset=o.P.convert(c),this._update(),this}addClassName(c){this._element.classList.add(c)}removeClassName(c){this._element.classList.remove(c)}toggleClassName(c){return this._element.classList.toggle(c)}setDraggable(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(c,d){return c===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),c!==void 0&&(this._opacity=c),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const rc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ka=0,jo=!1;const $c={maxWidth:100,unit:"metric"};function Du(x,c,d){const y=d&&d.maxWidth||100,_=x._container.clientHeight/2,S=x.unproject([0,_]),B=x.unproject([y,_]),k=S.distanceTo(B);if(d&&d.unit==="imperial"){const g=3.2808*k;g>5280?ic(c,y,g/5280,x._getUIString("ScaleControl.Miles")):ic(c,y,g,x._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?ic(c,y,k/1852,x._getUIString("ScaleControl.NauticalMiles")):k>=1e3?ic(c,y,k/1e3,x._getUIString("ScaleControl.Kilometers")):ic(c,y,k,x._getUIString("ScaleControl.Meters"))}function ic(x,c,d,y){const _=function(S){const B=Math.pow(10,`${Math.floor(S)}`.length-1);let k=S/B;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(g){const b=Math.pow(10,Math.ceil(-Math.log(g)/Math.LN10));return Math.round(g*b)/b}(k),B*k}(d);x.style.width=c*(_/d)+"px",x.innerHTML=`${_}&nbsp;${y}`}const Sh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Fd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Eh(x){if(x){if(typeof x=="number"){const c=Math.round(Math.abs(x)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,x),"top-left":new o.P(c,c),"top-right":new o.P(-c,c),bottom:new o.P(0,-x),"bottom-left":new o.P(c,-c),"bottom-right":new o.P(-c,-c),left:new o.P(x,0),right:new o.P(-x,0)}}if(x instanceof o.P||Array.isArray(x)){const c=o.P.convert(x);return{center:c,top:c,"top-left":c,"top-right":c,bottom:c,"bottom-left":c,"bottom-right":c,left:c,right:c}}return{center:o.P.convert(x.center||[0,0]),top:o.P.convert(x.top||[0,0]),"top-left":o.P.convert(x["top-left"]||[0,0]),"top-right":o.P.convert(x["top-right"]||[0,0]),bottom:o.P.convert(x.bottom||[0,0]),"bottom-left":o.P.convert(x["bottom-left"]||[0,0]),"bottom-right":o.P.convert(x["bottom-right"]||[0,0]),left:o.P.convert(x.left||[0,0]),right:o.P.convert(x.right||[0,0])}}return Eh(new o.P(0,0))}const zf=f;a.AJAXError=o.be,a.Evented=o.E,a.LngLat=o.M,a.MercatorCoordinate=o.Y,a.Point=o.P,a.addProtocol=o.bf,a.config=o.a,a.removeProtocol=o.bg,a.AttributionControl=Fo,a.BoxZoomHandler=_i,a.CanvasSource=lr,a.CooperativeGesturesHandler=or,a.DoubleClickZoomHandler=Iu,a.DragPanHandler=Bd,a.DragRotateHandler=No,a.EdgeInsets=Gs,a.FullscreenControl=class extends o.E{constructor(){let x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{var c;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((c=d==null?void 0:d.shadowRoot)===null||c===void 0)&&c.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,x&&x.container&&(x.container instanceof HTMLElement?this._container=x.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){P.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const x=this._fullscreenButton=P.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);P.create("span","maplibregl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.title=x}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},a.GeoJSONSource=Ie,a.GeolocateControl=class extends o.E{constructor(x){super(),this._onSuccess=c=>{if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",c)),this._finish()}},this._updateCamera=c=>{const d=new o.M(c.coords.longitude,c.coords.latitude),y=c.coords.accuracy,_=this._map.getBearing(),S=o.e({bearing:_},this.options.fitBoundsOptions),B=Xe.fromLngLat(d,y);this._map.fitBounds(B,S,{geolocateSource:!0})},this._updateMarker=c=>{if(c){const d=new o.M(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=c=>{if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&jo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",c)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=c=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=P.create("button","maplibregl-ctrl-geolocate",this._container),P.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ou({element:this._dotElement}),this._circleElement=P.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ou({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")))})}},this.options=o.e({},rc,x)}onAdd(x){return this._map=x,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return o._(this,arguments,void 0,function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){if(ca!==void 0&&!c)return ca;if(window.navigator.permissions===void 0)return ca=!!window.navigator.geolocation,ca;try{ca=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ca=!!window.navigator.geolocation}return ca}()})}().then(c=>this._setupUI(c)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),P.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ka=0,jo=!1}_isOutOfMapMaxBounds(x){const c=this._map.getMaxBounds(),d=x.coords;return c&&(d.longitude<c.getWest()||d.longitude>c.getEast()||d.latitude<c.getSouth()||d.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const x=this._map.getBounds(),c=x.getSouthEast(),d=x.getNorthEast(),y=c.distanceTo(d),_=Math.ceil(this._accuracy/(y/this._map._container.clientHeight)*2);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ka--,jo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ka++,ka>1?(x={maximumAge:6e5,timeout:0},jo=!0):(x=this.options.positionOptions,jo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,x)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},a.Hash=Vs,a.ImageSource=Ce,a.KeyboardHandler=Ba,a.LngLatBounds=Xe,a.LogoControl=Rd,a.Map=class extends zn{constructor(x){if(o.bc.mark(o.bd.create),(x=o.e({},oo,x)).minZoom!=null&&x.maxZoom!=null&&x.minZoom>x.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(x.minPitch!=null&&x.maxPitch!=null&&x.minPitch>x.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(x.minPitch!=null&&x.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(x.maxPitch!=null&&x.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new io(x.minZoom,x.maxZoom,x.minPitch,x.maxPitch,x.renderWorldCopies),{bearingSnap:x.bearingSnap}),this._contextLost=c=>{c.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.k("webglcontextlost",{originalEvent:c}))},this._contextRestored=c=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:c}))},this._onMapScroll=c=>{if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=x.interactive,this._maxTileCacheSize=x.maxTileCacheSize,this._maxTileCacheZoomLevels=x.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=x.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=x.preserveDrawingBuffer,this._antialias=x.antialias,this._trackResize=x.trackResize,this._bearingSnap=x.bearingSnap,this._refreshExpiredTiles=x.refreshExpiredTiles,this._fadeDuration=x.fadeDuration,this._crossSourceCollisions=x.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=x.collectResourceTiming,this._renderTaskQueue=new Bu,this._controls=[],this._mapId=o.a3(),this._locale=o.e({},Od,x.locale),this._clickTolerance=x.clickTolerance,this._overridePixelRatio=x.pixelRatio,this._maxCanvasSize=x.maxCanvasSize,this.transformCameraUpdate=x.transformCameraUpdate,this._imageQueueHandle=J.addThrottleControl(()=>this.isMoving()),this._requestManager=new nt(x.transformRequest),typeof x.container=="string"){if(this._container=document.getElementById(x.container),!this._container)throw new Error(`Container '${x.container}' not found.`)}else{if(!(x.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=x.container}if(x.maxBounds&&this.setMaxBounds(x.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let c=!1;const d=fl(y=>{this._trackResize&&!this._removed&&this.resize(y)._update()},50);this._resizeObserver=new ResizeObserver(y=>{c?d(y):c=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Lu(this,x),this._hash=x.hash&&new Vs(typeof x.hash=="string"&&x.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch}),x.bounds&&(this.resize(),this.fitBounds(x.bounds,o.e({},x.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=x.localIdeographFontFamily,this._validateStyle=x.validateStyle,x.style&&this.setStyle(x.style,{localIdeographFontFamily:x.localIdeographFontFamily}),x.attributionControl&&this.addControl(new Fo(typeof x.attributionControl=="boolean"?void 0:x.attributionControl)),x.maplibreLogo&&this.addControl(new Rd,x.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new o.k(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new o.k(`${c.dataType}dataloading`,c))}),this.on("dataabort",c=>{this.fire(new o.k("sourcedataabort",c))})}_getMapId(){return this._mapId}addControl(x,c){if(c===void 0&&(c=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=x.onAdd(this);this._controls.push(x);const y=this._controlPositions[c];return c.indexOf("bottom")!==-1?y.insertBefore(d,y.firstChild):y.appendChild(d),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(x);return c>-1&&this._controls.splice(c,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}calculateCameraOptionsFromTo(x,c,d,y){return y==null&&this.terrain&&(y=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(x,c,d,y)}resize(x){var c;const d=this._containerDimensions(),y=d[0],_=d[1],S=this._getClampedPixelRatio(y,_);if(this._resizeCanvas(y,_,S),this.painter.resize(y,_,S),this.painter.overLimit()){const k=this.painter.context.gl;this._maxCanvasSize=[k.drawingBufferWidth,k.drawingBufferHeight];const g=this._getClampedPixelRatio(y,_);this._resizeCanvas(y,_,g),this.painter.resize(y,_,g)}this.transform.resize(y,_),(c=this._requestedCameraState)===null||c===void 0||c.resize(y,_);const B=!this._moving;return B&&(this.stop(),this.fire(new o.k("movestart",x)).fire(new o.k("move",x))),this.fire(new o.k("resize",x)),B&&this.fire(new o.k("moveend",x)),this}_getClampedPixelRatio(x,c){const{0:d,1:y}=this._maxCanvasSize,_=this.getPixelRatio(),S=x*_,B=c*_;return Math.min(S>d?d/S:1,B>y?y/B:1)*_}getPixelRatio(){var x;return(x=this._overridePixelRatio)!==null&&x!==void 0?x:devicePixelRatio}setPixelRatio(x){this._overridePixelRatio=x,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(x){return this.transform.setMaxBounds(Xe.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom)return this.transform.minZoom=x,this._update(),this.getZoom()<x&&this.setZoom(x),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom)return this.transform.maxZoom=x,this._update(),this.getZoom()>x&&this.setZoom(x),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.minPitch=x,this._update(),this.getPitch()<x&&this.setPitch(x),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(x>=this.transform.minPitch)return this.transform.maxPitch=x,this._update(),this.getPitch()>x&&this.setPitch(x),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.renderWorldCopies=x,this._update()}project(x){return this.transform.locationPoint(o.M.convert(x),this.style&&this.terrain)}unproject(x){return this.transform.pointLocation(o.P.convert(x),this.terrain)}isMoving(){var x;return this._moving||((x=this.handlers)===null||x===void 0?void 0:x.isMoving())}isZooming(){var x;return this._zooming||((x=this.handlers)===null||x===void 0?void 0:x.isZooming())}isRotating(){var x;return this._rotating||((x=this.handlers)===null||x===void 0?void 0:x.isRotating())}_createDelegatedListener(x,c,d){if(x==="mouseenter"||x==="mouseover"){let y=!1;return{layer:c,listener:d,delegates:{mousemove:_=>{const S=this.getLayer(c)?this.queryRenderedFeatures(_.point,{layers:[c]}):[];S.length?y||(y=!0,d.call(this,new dn(x,this,_.originalEvent,{features:S}))):y=!1},mouseout:()=>{y=!1}}}}if(x==="mouseleave"||x==="mouseout"){let y=!1;return{layer:c,listener:d,delegates:{mousemove:_=>{(this.getLayer(c)?this.queryRenderedFeatures(_.point,{layers:[c]}):[]).length?y=!0:y&&(y=!1,d.call(this,new dn(x,this,_.originalEvent)))},mouseout:_=>{y&&(y=!1,d.call(this,new dn(x,this,_.originalEvent)))}}}}{const y=_=>{const S=this.getLayer(c)?this.queryRenderedFeatures(_.point,{layers:[c]}):[];S.length&&(_.features=S,d.call(this,_),delete _.features)};return{layer:c,listener:d,delegates:{[x]:y}}}}on(x,c,d){if(d===void 0)return super.on(x,c);const y=this._createDelegatedListener(x,c,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(y);for(const _ in y.delegates)this.on(_,y.delegates[_]);return this}once(x,c,d){if(d===void 0)return super.once(x,c);const y=this._createDelegatedListener(x,c,d);for(const _ in y.delegates)this.once(_,y.delegates[_]);return this}off(x,c,d){return d===void 0?super.off(x,c):(this._delegatedListeners&&this._delegatedListeners[x]&&(y=>{const _=this._delegatedListeners[x];for(let S=0;S<_.length;S++){const B=_[S];if(B.layer===c&&B.listener===d){for(const k in B.delegates)this.off(k,B.delegates[k]);return _.splice(S,1),this}}})(),this)}queryRenderedFeatures(x,c){if(!this.style)return[];let d;const y=x instanceof o.P||Array.isArray(x),_=y?x:[[0,0],[this.transform.width,this.transform.height]];if(c=c||(y?{}:x)||{},_ instanceof o.P||typeof _[0]=="number")d=[o.P.convert(_)];else{const S=o.P.convert(_[0]),B=o.P.convert(_[1]);d=[S,new o.P(B.x,S.y),B,new o.P(S.x,B.y),S]}return this.style.queryRenderedFeatures(d,c,this.transform)}querySourceFeatures(x,c){return this.style.querySourceFeatures(x,c)}setStyle(x,c){return(c=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},c)).diff!==!1&&c.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&x?(this._diffStyle(x,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._updateStyle(x,c))}setTransformRequest(x){return this._requestManager.setTransformRequest(x),this}_getUIString(x){const c=this._locale[x];if(c==null)throw new Error(`Missing UI string '${x}'`);return c}_updateStyle(x,c){if(c.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(x,c));const d=this.style&&c.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!x)),x?(this.style=new xn(this,c||{}),this.style.setEventedParent(this,{style:this.style}),typeof x=="string"?this.style.loadURL(x,c,d):this.style.loadJSON(x,c,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(x,c){if(typeof x=="string"){const d=this._requestManager.transformRequest(x,"Style");o.h(d,new AbortController).then(y=>{this._updateDiff(y.data,c)}).catch(y=>{y&&this.fire(new o.j(y))})}else typeof x=="object"&&this._updateDiff(x,c)}_updateDiff(x,c){try{this.style.setState(x,c)&&this._update(!0)}catch(d){o.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(x,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(x,c){return this._lazyInitEmptyStyle(),this.style.addSource(x,c),this._update(!0)}isSourceLoaded(x){const c=this.style&&this.style.sourceCaches[x];if(c!==void 0)return c.loaded();this.fire(new o.j(new Error(`There is no source with ID '${x}'`)))}setTerrain(x){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),x){const c=this.style.sourceCaches[x.source];if(!c)throw new Error(`cannot load terrain, because there exists no source with ID: ${x.source}`);this.terrain===null&&c.reload();for(const d in this.style._layers){const y=this.style._layers[d];y.type==="hillshade"&&y.source===x.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ff(this.painter,c,x),this.painter.renderToTexture=new zo(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==x.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:x})),this}getTerrain(){var x,c;return(c=(x=this.terrain)===null||x===void 0?void 0:x.options)!==null&&c!==void 0?c:null}areTilesLoaded(){const x=this.style&&this.style.sourceCaches;for(const c in x){const d=x[c]._tiles;for(const y in d){const _=d[y];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}removeSource(x){return this.style.removeSource(x),this._update(!0)}getSource(x){return this.style.getSource(x)}addImage(x,c){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:y=1,sdf:_=!1,stretchX:S,stretchY:B,content:k}=d;if(this._lazyInitEmptyStyle(),!(c instanceof HTMLImageElement||o.b(c))){if(c.width===void 0||c.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:g,height:b,data:C}=c,M=c;return this.style.addImage(x,{data:new o.R({width:g,height:b},new Uint8Array(C)),pixelRatio:y,stretchX:S,stretchY:B,content:k,sdf:_,version:0,userImage:M}),M.onAdd&&M.onAdd(this,x),this}}{const{width:g,height:b,data:C}=A.getImageData(c);this.style.addImage(x,{data:new o.R({width:g,height:b},C),pixelRatio:y,stretchX:S,stretchY:B,content:k,sdf:_,version:0})}}updateImage(x,c){const d=this.style.getImage(x);if(!d)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=c instanceof HTMLImageElement||o.b(c)?A.getImageData(c):c,{width:_,height:S,data:B}=y;if(_===void 0||S===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==d.data.width||S!==d.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const k=!(c instanceof HTMLImageElement||o.b(c));return d.data.replace(B,k),this.style.updateImage(x,d),this}getImage(x){return this.style.getImage(x)}hasImage(x){return x?!!this.style.getImage(x):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(x)}loadImage(x){return J.getImage(this._requestManager.transformRequest(x,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(x,c){return this._lazyInitEmptyStyle(),this.style.addLayer(x,c),this._update(!0)}moveLayer(x,c){return this.style.moveLayer(x,c),this._update(!0)}removeLayer(x){return this.style.removeLayer(x),this._update(!0)}getLayer(x){return this.style.getLayer(x)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(x,c,d){return this.style.setLayerZoomRange(x,c,d),this._update(!0)}setFilter(x,c){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(x,c,d),this._update(!0)}getFilter(x){return this.style.getFilter(x)}setPaintProperty(x,c,d){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(x,c,d,y),this._update(!0)}getPaintProperty(x,c){return this.style.getPaintProperty(x,c)}setLayoutProperty(x,c,d){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(x,c,d,y),this._update(!0)}getLayoutProperty(x,c){return this.style.getLayoutProperty(x,c)}setGlyphs(x){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(x,c),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(x,c){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(x,c,d,y=>{y||this._update(!0)}),this}removeSprite(x){return this._lazyInitEmptyStyle(),this.style.removeSprite(x),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(x){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(x,c,d=>{d||this._update(!0)}),this}setLight(x){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(x,c),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(x,c){return this.style.setFeatureState(x,c),this._update()}removeFeatureState(x,c){return this.style.removeFeatureState(x,c),this._update()}getFeatureState(x){return this.style.getFeatureState(x)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let x=0,c=0;return this._container&&(x=this._container.clientWidth||400,c=this._container.clientHeight||300),[x,c]}_setupContainer(){const x=this._container;x.classList.add("maplibregl-map");const c=this._canvasContainer=P.create("div","maplibregl-canvas-container",x);this._interactive&&c.classList.add("maplibregl-interactive"),this._canvas=P.create("canvas","maplibregl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),y=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],y);const _=this._controlContainer=P.create("div","maplibregl-control-container",x),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(B=>{S[B]=P.create("div",`maplibregl-ctrl-${B} `,_)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,c,d){this._canvas.width=Math.floor(d*x),this._canvas.height=Math.floor(d*c),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${c}px`}_setupPainter(){const x={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let c=null;this._canvas.addEventListener("webglcontextcreationerror",y=>{c={requestedAttributes:x},y&&(c.statusMessage=y.statusMessage,c.type=y.type)},{once:!0});const d=this._canvas.getContext("webgl2",x)||this._canvas.getContext("webgl",x);if(!d){const y="Failed to initialize WebGL";throw c?(c.message=y,new Error(JSON.stringify(c))):new Error(y)}this.painter=new Pa(d,this.transform),I.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(x){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_render(x){const c=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(x),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const _=this.transform.zoom,S=A.now();this.style.zoomHistory.update(_,S);const B=new o.a8(_,{now:S,fadeDuration:c,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),k=B.crossFadingFactor();k===1&&k===this._crossFadingFactor||(d=!0,this._crossFadingFactor=k),this.style.update(B)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,c,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:c,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bc.mark(o.bd.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const y=this._sourcesDirty||this._styleDirty||this._placementDirty;return y||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,o.bc.mark(o.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var x;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),J.removeThrottleControl(this._imageQueueHandle),(x=this._resizeObserver)===null||x===void 0||x.disconnect();const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),P.remove(this._canvasContainer),P.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),o.bc.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,A.frameAsync(this._frameRequest).then(x=>{o.bc.frame(x),this._frameRequest=null,this._render(x)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get version(){return Ah}getCameraTargetElevation(){return this.transform.elevation}},a.MapMouseEvent=dn,a.MapTouchEvent=Cs,a.MapWheelEvent=Ts,a.Marker=Ou,a.NavigationControl=class{constructor(x){this._updateZoomButtons=()=>{const c=this._map.getZoom(),d=c===this._map.getMaxZoom(),y=c===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())},this._rotateCompassArrow=()=>{const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=c},this._setButtonTitle=(c,d)=>{const y=this._map._getUIString(`NavigationControl.${d}`);c.title=y,c.setAttribute("aria-label",y)},this.options=o.e({},Dd,x),this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",c=>this._map.zoomIn({},{originalEvent:c})),P.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",c=>this._map.zoomOut({},{originalEvent:c})),P.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",c=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:c}):this._map.resetNorth({},{originalEvent:c})}),this._compassIcon=P.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Nd(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){P.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(x,c){const d=P.create("button",x,this._container);return d.type="button",d.addEventListener("click",c),d}},a.Popup=class extends o.E{constructor(x){super(),this.remove=()=>(this._content&&P.remove(this._content),this._container&&(P.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.k("close"))),this),this._onMouseUp=c=>{this._update(c.point)},this._onMouseMove=c=>{this._update(c.point)},this._onDrag=c=>{this._update(c.point)},this._update=c=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=P.create("div","maplibregl-popup",this._map.getContainer()),this._tip=P.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const k of this.options.className.split(" "))this._container.classList.add(k);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?ku(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!c)return;const y=this._flatPos=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&c?c:this._map.transform.locationPoint(this._lngLat));let _=this.options.anchor;const S=Eh(this.options.offset);if(!_){const k=this._container.offsetWidth,g=this._container.offsetHeight;let b;b=y.y+S.bottom.y<g?["top"]:y.y>this._map.transform.height-g?["bottom"]:[],y.x<k/2?b.push("left"):y.x>this._map.transform.width-k/2&&b.push("right"),_=b.length===0?"bottom":b.join("-")}let B=y.add(S[_]);this.options.subpixelPositioning||(B=B.round()),P.setTransform(this._container,`${Wc[_]} translate(${B.x}px,${B.y}px)`),Ru(this._container,_,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(Sh),x)}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(x){return this._lngLat=o.M.convert(x),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(document.createTextNode(x))}setHTML(x){const c=document.createDocumentFragment(),d=document.createElement("body");let y;for(d.innerHTML=x;y=d.firstChild,y;)c.appendChild(y);return this.setDOMContent(c)}getMaxWidth(){var x;return(x=this._container)===null||x===void 0?void 0:x.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=P.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(x),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(x){this._container&&this._container.classList.add(x)}removeClassName(x){this._container&&this._container.classList.remove(x)}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){if(this._container)return this._container.classList.toggle(x)}setSubpixelPositioning(x){this.options.subpixelPositioning=x}_createCloseButton(){this.options.closeButton&&(this._closeButton=P.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(Fd);x&&x.focus()}},a.RasterDEMTileSource=ir,a.RasterTileSource=Xt,a.ScaleControl=class{constructor(x){this._onMove=()=>{Du(this._map,this._container,this.options)},this.setUnit=c=>{this.options.unit=c,Du(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},$c),x)}getDefaultPosition(){return"bottom-left"}onAdd(x){return this._map=x,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-scale",x.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){P.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},a.ScrollZoomHandler=tc,a.Style=xn,a.TerrainControl=class{constructor(x){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=x}onAdd(x){return this._map=x,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=P.create("button","maplibregl-ctrl-terrain",this._container),P.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){P.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},a.TwoFingersTouchPitchHandler=Pu,a.TwoFingersTouchRotateHandler=wh,a.TwoFingersTouchZoomHandler=Tu,a.TwoFingersTouchZoomRotateHandler=Mu,a.VectorTileSource=Bt,a.VideoSource=qe,a.addSourceType=(x,c)=>o._(void 0,void 0,void 0,function*(){if(Ir(x))throw new Error(`A source type called "${x}" already exists.`);((d,y)=>{Er[d]=y})(x,c)}),a.clearPrewarmedResources=function(){const x=Ut;x&&(x.isPreloaded()&&x.numActive()===1?(x.release(it),Ut=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},a.getRTLTextPluginStatus=function(){return de().getRTLTextPluginStatus()},a.getVersion=function(){return zf},a.getWorkerCount=function(){return Tt.workerCount},a.getWorkerUrl=function(){return o.a.WORKER_URL},a.importScriptInWorkers=function(x){return re().broadcast("IS",x)},a.prewarm=function(){Kt().acquire(it)},a.setMaxParallelImageRequests=function(x){o.a.MAX_PARALLEL_IMAGE_REQUESTS=x},a.setRTLTextPlugin=function(x,c){return de().setRTLTextPlugin(x,c)},a.setWorkerCount=function(x){Tt.workerCount=x},a.setWorkerUrl=function(x){o.a.WORKER_URL=x}});var s=r;return s})})(xL);var SL=xL.exports;const Bs=K_(SL);var Ns;(function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon",e[e.MultiPoint=4]="MultiPoint",e[e.MultiLineString=5]="MultiLineString",e[e.MultiPolygon=6]="MultiPolygon",e[e.GeometryCollection=7]="GeometryCollection",e[e.CircularString=8]="CircularString",e[e.CompoundCurve=9]="CompoundCurve",e[e.CurvePolygon=10]="CurvePolygon",e[e.MultiCurve=11]="MultiCurve",e[e.MultiSurface=12]="MultiSurface",e[e.Curve=13]="Curve",e[e.Surface=14]="Surface",e[e.PolyhedralSurface=15]="PolyhedralSurface",e[e.TIN=16]="TIN",e[e.Triangle=17]="Triangle"})(Ns||(Ns={}));const Qg=4,tm=4,E0=4,td=new Int32Array(2),KE=new Float32Array(td.buffer),YE=new Float64Array(td.buffer),P1=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Vw;(function(e){e[e.UTF8_BYTES=1]="UTF8_BYTES",e[e.UTF16_STRING=2]="UTF16_STRING"})(Vw||(Vw={}));class hh{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new hh(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return td[0]=this.readInt32(t),KE[0]}readFloat64(t){return td[P1?0:1]=this.readInt32(t),td[P1?1:0]=this.readInt32(t+4),YE[0]}writeInt8(t,r){this.bytes_[t]=r}writeUint8(t,r){this.bytes_[t]=r}writeInt16(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8}writeUint16(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8}writeInt32(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8,this.bytes_[t+2]=r>>16,this.bytes_[t+3]=r>>24}writeUint32(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8,this.bytes_[t+2]=r>>16,this.bytes_[t+3]=r>>24}writeInt64(t,r){this.writeInt32(t,Number(BigInt.asIntN(32,r))),this.writeInt32(t+4,Number(BigInt.asIntN(32,r>>BigInt(32))))}writeUint64(t,r){this.writeUint32(t,Number(BigInt.asUintN(32,r))),this.writeUint32(t+4,Number(BigInt.asUintN(32,r>>BigInt(32))))}writeFloat32(t,r){KE[0]=r,this.writeInt32(t,td[0])}writeFloat64(t,r){YE[0]=r,this.writeInt32(t,td[P1?0:1]),this.writeInt32(t+4,td[P1?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Qg+tm)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let r=0;r<tm;r++)t+=String.fromCharCode(this.readInt8(this.position_+Qg+r));return t}__offset(t,r){const i=t-this.readInt32(t);return r<this.readInt16(i)?this.readInt16(i+r):0}__union(t,r){return t.bb_pos=r+this.readInt32(r),t.bb=this,t}__string(t,r){t+=this.readInt32(t);const i=this.readInt32(t);t+=Qg;const n=this.bytes_.subarray(t,t+i);return r===Vw.UTF8_BYTES?n:this.text_decoder_.decode(n)}__union_with_string(t,r){return typeof t=="string"?this.__string(r):this.__union(t,r)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+Qg}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=tm)throw new Error("FlatBuffers: file identifier must be length "+tm);for(let r=0;r<tm;r++)if(t.charCodeAt(r)!=this.readInt8(this.position()+Qg+r))return!1;return!0}createScalarList(t,r){const i=[];for(let n=0;n<r;++n){const s=t(n);s!==null&&i.push(s)}return i}createObjList(t,r){const i=[];for(let n=0;n<r;++n){const s=t(n);s!==null&&i.push(s.unpack())}return i}}let PN=class fa{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsGeometry(t,r){return(r||new fa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometry(t,r){return t.setPosition(t.position()+E0),(r||new fa).__init(t.readInt32(t.position())+t.position(),t)}ends(t){const r=this.bb.__offset(this.bb_pos,4);return r?this.bb.readUint32(this.bb.__vector(this.bb_pos+r)+t*4):0}endsLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}endsArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}xy(t){const r=this.bb.__offset(this.bb_pos,6);return r?this.bb.readFloat64(this.bb.__vector(this.bb_pos+r)+t*8):0}xyLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}xyArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}z(t){const r=this.bb.__offset(this.bb_pos,8);return r?this.bb.readFloat64(this.bb.__vector(this.bb_pos+r)+t*8):0}zLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}zArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}m(t){const r=this.bb.__offset(this.bb_pos,10);return r?this.bb.readFloat64(this.bb.__vector(this.bb_pos+r)+t*8):0}mLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}mArray(){const t=this.bb.__offset(this.bb_pos,10);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}t(t){const r=this.bb.__offset(this.bb_pos,12);return r?this.bb.readFloat64(this.bb.__vector(this.bb_pos+r)+t*8):0}tLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}tArray(){const t=this.bb.__offset(this.bb_pos,12);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}tm(t){const r=this.bb.__offset(this.bb_pos,14);return r?this.bb.readUint64(this.bb.__vector(this.bb_pos+r)+t*8):BigInt(0)}tmLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}type(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):Ns.Unknown}parts(t,r){const i=this.bb.__offset(this.bb_pos,18);return i?(r||new fa).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+t*4),this.bb):null}partsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}static startGeometry(t){t.startObject(8)}static addEnds(t,r){t.addFieldOffset(0,r,0)}static createEndsVector(t,r){t.startVector(4,r.length,4);for(let i=r.length-1;i>=0;i--)t.addInt32(r[i]);return t.endVector()}static startEndsVector(t,r){t.startVector(4,r,4)}static addXy(t,r){t.addFieldOffset(1,r,0)}static createXyVector(t,r){t.startVector(8,r.length,8);for(let i=r.length-1;i>=0;i--)t.addFloat64(r[i]);return t.endVector()}static startXyVector(t,r){t.startVector(8,r,8)}static addZ(t,r){t.addFieldOffset(2,r,0)}static createZVector(t,r){t.startVector(8,r.length,8);for(let i=r.length-1;i>=0;i--)t.addFloat64(r[i]);return t.endVector()}static startZVector(t,r){t.startVector(8,r,8)}static addM(t,r){t.addFieldOffset(3,r,0)}static createMVector(t,r){t.startVector(8,r.length,8);for(let i=r.length-1;i>=0;i--)t.addFloat64(r[i]);return t.endVector()}static startMVector(t,r){t.startVector(8,r,8)}static addT(t,r){t.addFieldOffset(4,r,0)}static createTVector(t,r){t.startVector(8,r.length,8);for(let i=r.length-1;i>=0;i--)t.addFloat64(r[i]);return t.endVector()}static startTVector(t,r){t.startVector(8,r,8)}static addTm(t,r){t.addFieldOffset(5,r,0)}static createTmVector(t,r){t.startVector(8,r.length,8);for(let i=r.length-1;i>=0;i--)t.addInt64(r[i]);return t.endVector()}static startTmVector(t,r){t.startVector(8,r,8)}static addType(t,r){t.addFieldInt8(6,r,Ns.Unknown)}static addParts(t,r){t.addFieldOffset(7,r,0)}static createPartsVector(t,r){t.startVector(4,r.length,4);for(let i=r.length-1;i>=0;i--)t.addOffset(r[i]);return t.endVector()}static startPartsVector(t,r){t.startVector(4,r,4)}static endGeometry(t){return t.endObject()}static createGeometry(t,r,i,n,s,a,o,f,m){return fa.startGeometry(t),fa.addEnds(t,r),fa.addXy(t,i),fa.addZ(t,n),fa.addM(t,s),fa.addT(t,a),fa.addTm(t,o),fa.addType(t,f),fa.addParts(t,m),fa.endGeometry(t)}};function qw(e,t){const r=[];for(let i=0;i<e.length;i+=2){const n=[e[i],e[i+1]];t&&n.push(t[i>>1]),r.push(n)}return r}function QE(e,t,r){if(!r||r.length===0)return[qw(e,t)];let i=0;const n=Array.from(r).map(a=>e.slice(i,i=a<<1));let s;return t&&(i=0,s=Array.from(r).map(a=>t.slice(i,i=a))),n.map((a,o)=>qw(a,s?s[o]:void 0))}function IN(e,t){const r=e.xyArray(),i=e.zArray();switch(t){case Ns.Point:{const n=Array.from(r);return i&&n.push(i[0]),n}case Ns.MultiPoint:case Ns.LineString:return qw(r,i);case Ns.MultiLineString:return QE(r,i,e.endsArray());case Ns.Polygon:return QE(r,i,e.endsArray())}}function Hw(e,t){let r=t;if(r===Ns.Unknown&&(r=e.type()),r===Ns.GeometryCollection){const n=[];for(let s=0;s<e.partsLength();s++){const a=e.parts(s),o=a.type();n.push(Hw(a,o))}return{type:Ns[r],geometries:n}}else if(r===Ns.MultiPolygon){const n=[];for(let s=0;s<e.partsLength();s++)n.push(Hw(e.parts(s),Ns.Polygon));return{type:Ns[r],coordinates:n.map(s=>s.coordinates)}}const i=IN(e,r);return{type:Ns[r],coordinates:i}}var Rs;(function(e){e[e.Byte=0]="Byte",e[e.UByte=1]="UByte",e[e.Bool=2]="Bool",e[e.Short=3]="Short",e[e.UShort=4]="UShort",e[e.Int=5]="Int",e[e.UInt=6]="UInt",e[e.Long=7]="Long",e[e.ULong=8]="ULong",e[e.Float=9]="Float",e[e.Double=10]="Double",e[e.String=11]="String",e[e.Json=12]="Json",e[e.DateTime=13]="DateTime",e[e.Binary=14]="Binary"})(Rs||(Rs={}));class ks{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsColumn(t,r){return(r||new ks).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsColumn(t,r){return t.setPosition(t.position()+E0),(r||new ks).__init(t.readInt32(t.position())+t.position(),t)}name(t){const r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,t):null}type(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):Rs.Byte}title(t){const r=this.bb.__offset(this.bb_pos,8);return r?this.bb.__string(this.bb_pos+r,t):null}description(t){const r=this.bb.__offset(this.bb_pos,10);return r?this.bb.__string(this.bb_pos+r,t):null}width(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1}precision(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1}scale(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1}nullable(){const t=this.bb.__offset(this.bb_pos,18);return t?!!this.bb.readInt8(this.bb_pos+t):!0}unique(){const t=this.bb.__offset(this.bb_pos,20);return t?!!this.bb.readInt8(this.bb_pos+t):!1}primaryKey(){const t=this.bb.__offset(this.bb_pos,22);return t?!!this.bb.readInt8(this.bb_pos+t):!1}metadata(t){const r=this.bb.__offset(this.bb_pos,24);return r?this.bb.__string(this.bb_pos+r,t):null}static startColumn(t){t.startObject(11)}static addName(t,r){t.addFieldOffset(0,r,0)}static addType(t,r){t.addFieldInt8(1,r,Rs.Byte)}static addTitle(t,r){t.addFieldOffset(2,r,0)}static addDescription(t,r){t.addFieldOffset(3,r,0)}static addWidth(t,r){t.addFieldInt32(4,r,-1)}static addPrecision(t,r){t.addFieldInt32(5,r,-1)}static addScale(t,r){t.addFieldInt32(6,r,-1)}static addNullable(t,r){t.addFieldInt8(7,+r,1)}static addUnique(t,r){t.addFieldInt8(8,+r,0)}static addPrimaryKey(t,r){t.addFieldInt8(9,+r,0)}static addMetadata(t,r){t.addFieldOffset(10,r,0)}static endColumn(t){const r=t.endObject();return t.requiredField(r,4),r}static createColumn(t,r,i,n,s,a,o,f,m,w,A,P){return ks.startColumn(t),ks.addName(t,r),ks.addType(t,i),ks.addTitle(t,n),ks.addDescription(t,s),ks.addWidth(t,a),ks.addPrecision(t,o),ks.addScale(t,f),ks.addNullable(t,m),ks.addUnique(t,w),ks.addPrimaryKey(t,A),ks.addMetadata(t,P),ks.endColumn(t)}}class vc{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsFeature(t,r){return(r||new vc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFeature(t,r){return t.setPosition(t.position()+E0),(r||new vc).__init(t.readInt32(t.position())+t.position(),t)}geometry(t){const r=this.bb.__offset(this.bb_pos,4);return r?(t||new PN).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}properties(t){const r=this.bb.__offset(this.bb_pos,6);return r?this.bb.readUint8(this.bb.__vector(this.bb_pos+r)+t):0}propertiesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}propertiesArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}columns(t,r){const i=this.bb.__offset(this.bb_pos,8);return i?(r||new ks).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFeature(t){t.startObject(3)}static addGeometry(t,r){t.addFieldOffset(0,r,0)}static addProperties(t,r){t.addFieldOffset(1,r,0)}static createPropertiesVector(t,r){t.startVector(1,r.length,1);for(let i=r.length-1;i>=0;i--)t.addInt8(r[i]);return t.endVector()}static startPropertiesVector(t,r){t.startVector(1,r,1)}static addColumns(t,r){t.addFieldOffset(2,r,0)}static createColumnsVector(t,r){t.startVector(4,r.length,4);for(let i=r.length-1;i>=0;i--)t.addOffset(r[i]);return t.endVector()}static startColumnsVector(t,r){t.startVector(4,r,4)}static endFeature(t){return t.endObject()}static finishFeatureBuffer(t,r){t.finish(r)}static finishSizePrefixedFeatureBuffer(t,r){t.finish(r,void 0,!0)}static createFeature(t,r,i,n){return vc.startFeature(t),vc.addGeometry(t,r),vc.addProperties(t,i),vc.addColumns(t,n),vc.endFeature(t)}}new TextEncoder;const tC=new TextDecoder;function MN(e,t){const r={};if(!t||t.length===0)return r;const i=e.propertiesArray();if(!i)return r;const n=new DataView(i.buffer,i.byteOffset),s=e.propertiesLength();let a=0;for(;a<s;){const o=n.getUint16(a,!0);a+=2;const f=t[o],m=f.name;switch(f.type){case Rs.Bool:{r[m]=!!n.getUint8(a),a+=1;break}case Rs.Byte:{r[m]=n.getInt8(a),a+=1;break}case Rs.UByte:{r[m]=n.getUint8(a),a+=1;break}case Rs.Short:{r[m]=n.getInt16(a,!0),a+=2;break}case Rs.UShort:{r[m]=n.getUint16(a,!0),a+=2;break}case Rs.Int:{r[m]=n.getInt32(a,!0),a+=4;break}case Rs.UInt:{r[m]=n.getUint32(a,!0),a+=4;break}case Rs.Long:{r[m]=Number(n.getBigInt64(a,!0)),a+=8;break}case Rs.ULong:{r[m]=Number(n.getBigUint64(a,!0)),a+=8;break}case Rs.Float:{r[m]=n.getFloat32(a,!0),a+=4;break}case Rs.Double:{r[m]=n.getFloat64(a,!0),a+=8;break}case Rs.DateTime:case Rs.String:{const w=n.getUint32(a,!0);a+=4,r[m]=tC.decode(i.subarray(a,a+w)),a+=w;break}case Rs.Json:{const w=n.getUint32(a,!0);a+=4;const A=tC.decode(i.subarray(a,a+w));r[m]=JSON.parse(A),a+=w;break}default:throw new Error("Unknown type "+f.type)}}return r}function Z5(e,t){const r=t.columns;return{type:"Feature",geometry:Hw(e.geometry(),t.geometryType),properties:MN(e,r)}}const J5=new Uint8Array(0);function LN(){return this._source.cancel()}function BN(e,t){if(!e.length)return t;if(!t.length)return e;var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function kN(){var e=this,t=e._array.subarray(e._index);return e._source.read().then(function(r){return e._array=J5,e._index=0,r.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:BN(t,r.value)}})}function RN(e){if((e|=0)<0)throw new Error("invalid length");var t=this,r=this._array.length-this._index;if(this._index+e<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=e));var i=new Uint8Array(e);return i.set(this._array.subarray(this._index)),function n(){return t._source.read().then(function(s){return s.done?(t._array=J5,t._index=0,r>0?i.subarray(0,r):null):r+s.value.length>=e?(t._array=s.value,t._index=e-r,i.set(s.value.subarray(0,e-r),r),i):(i.set(s.value,r),r+=s.value.length,n())})}()}function ON(e){return typeof e.slice=="function"?e:new Y_(typeof e.read=="function"?e:e.getReader())}function Y_(e){this._source=e,this._array=J5,this._index=0}Y_.prototype.read=kN;Y_.prototype.slice=RN;Y_.prototype.cancel=LN;class wl{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsCrs(t,r){return(r||new wl).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsCrs(t,r){return t.setPosition(t.position()+E0),(r||new wl).__init(t.readInt32(t.position())+t.position(),t)}org(t){const r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,t):null}code(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}name(t){const r=this.bb.__offset(this.bb_pos,8);return r?this.bb.__string(this.bb_pos+r,t):null}description(t){const r=this.bb.__offset(this.bb_pos,10);return r?this.bb.__string(this.bb_pos+r,t):null}wkt(t){const r=this.bb.__offset(this.bb_pos,12);return r?this.bb.__string(this.bb_pos+r,t):null}codeString(t){const r=this.bb.__offset(this.bb_pos,14);return r?this.bb.__string(this.bb_pos+r,t):null}static startCrs(t){t.startObject(6)}static addOrg(t,r){t.addFieldOffset(0,r,0)}static addCode(t,r){t.addFieldInt32(1,r,0)}static addName(t,r){t.addFieldOffset(2,r,0)}static addDescription(t,r){t.addFieldOffset(3,r,0)}static addWkt(t,r){t.addFieldOffset(4,r,0)}static addCodeString(t,r){t.addFieldOffset(5,r,0)}static endCrs(t){return t.endObject()}static createCrs(t,r,i,n,s,a,o){return wl.startCrs(t),wl.addOrg(t,r),wl.addCode(t,i),wl.addName(t,n),wl.addDescription(t,s),wl.addWkt(t,a),wl.addCodeString(t,o),wl.endCrs(t)}}class c_{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsHeader(t,r){return(r||new c_).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsHeader(t,r){return t.setPosition(t.position()+E0),(r||new c_).__init(t.readInt32(t.position())+t.position(),t)}name(t){const r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,t):null}envelope(t){const r=this.bb.__offset(this.bb_pos,6);return r?this.bb.readFloat64(this.bb.__vector(this.bb_pos+r)+t*8):0}envelopeLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}envelopeArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}geometryType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):Ns.Unknown}hasZ(){const t=this.bb.__offset(this.bb_pos,10);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasM(){const t=this.bb.__offset(this.bb_pos,12);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasT(){const t=this.bb.__offset(this.bb_pos,14);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasTm(){const t=this.bb.__offset(this.bb_pos,16);return t?!!this.bb.readInt8(this.bb_pos+t):!1}columns(t,r){const i=this.bb.__offset(this.bb_pos,18);return i?(r||new ks).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}featuresCount(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):BigInt("0")}indexNodeSize(){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16}crs(t){const r=this.bb.__offset(this.bb_pos,24);return r?(t||new wl).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}title(t){const r=this.bb.__offset(this.bb_pos,26);return r?this.bb.__string(this.bb_pos+r,t):null}description(t){const r=this.bb.__offset(this.bb_pos,28);return r?this.bb.__string(this.bb_pos+r,t):null}metadata(t){const r=this.bb.__offset(this.bb_pos,30);return r?this.bb.__string(this.bb_pos+r,t):null}static startHeader(t){t.startObject(14)}static addName(t,r){t.addFieldOffset(0,r,0)}static addEnvelope(t,r){t.addFieldOffset(1,r,0)}static createEnvelopeVector(t,r){t.startVector(8,r.length,8);for(let i=r.length-1;i>=0;i--)t.addFloat64(r[i]);return t.endVector()}static startEnvelopeVector(t,r){t.startVector(8,r,8)}static addGeometryType(t,r){t.addFieldInt8(2,r,Ns.Unknown)}static addHasZ(t,r){t.addFieldInt8(3,+r,0)}static addHasM(t,r){t.addFieldInt8(4,+r,0)}static addHasT(t,r){t.addFieldInt8(5,+r,0)}static addHasTm(t,r){t.addFieldInt8(6,+r,0)}static addColumns(t,r){t.addFieldOffset(7,r,0)}static createColumnsVector(t,r){t.startVector(4,r.length,4);for(let i=r.length-1;i>=0;i--)t.addOffset(r[i]);return t.endVector()}static startColumnsVector(t,r){t.startVector(4,r,4)}static addFeaturesCount(t,r){t.addFieldInt64(8,r,BigInt("0"))}static addIndexNodeSize(t,r){t.addFieldInt16(9,r,16)}static addCrs(t,r){t.addFieldOffset(10,r,0)}static addTitle(t,r){t.addFieldOffset(11,r,0)}static addDescription(t,r){t.addFieldOffset(12,r,0)}static addMetadata(t,r){t.addFieldOffset(13,r,0)}static endHeader(t){return t.endObject()}static finishHeaderBuffer(t,r){t.finish(r)}static finishSizePrefixedHeaderBuffer(t,r){t.finish(r,void 0,!0)}}function X5(e){const t=c_.getRootAsHeader(e),r=t.featuresCount(),i=t.indexNodeSize(),n=[];for(let o=0;o<t.columnsLength();o++){const f=t.columns(o);if(!f)throw new Error("Column unexpectedly missing");if(!f.name())throw new Error("Column name unexpectedly missing");n.push({name:f.name(),type:f.type(),title:f.title(),description:f.description(),width:f.width(),precision:f.precision(),scale:f.scale(),nullable:f.nullable(),unique:f.unique(),primary_key:f.primaryKey()})}const s=t.crs(),a=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:t.geometryType(),columns:n,envelope:null,featuresCount:Number(r),indexNodeSize:i,crs:a,title:t.title(),description:t.description(),metadata:t.metadata()}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ww=function(e,t){return Ww=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Ww(e,t)};function DN(e,t){Ww(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function sg(e,t,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function o(w){try{m(i.next(w))}catch(A){a(A)}}function f(w){try{m(i.throw(w))}catch(A){a(A)}}function m(w){w.done?s(w.value):n(w.value).then(o,f)}m((i=i.apply(e,t||[])).next())})}function bd(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(m){return function(w){return f([m,w])}}function f(m){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=m[0]&2?n.return:m[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,m[1])).done)return s;switch(n=0,s&&(m=[m[0]&2,s.value]),m[0]){case 0:case 1:s=m;break;case 4:return r.label++,{value:m[1],done:!1};case 5:r.label++,n=m[1],m=[0];continue;case 7:m=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(m[0]===6||m[0]===2)){r=0;continue}if(m[0]===3&&(!s||m[1]>s[0]&&m[1]<s[3])){r.label=m[1];break}if(m[0]===6&&r.label<s[1]){r.label=s[1],s=m;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(m);break}s[2]&&r.ops.pop(),r.trys.pop();continue}m=t.call(e,r)}catch(w){m=[6,w],n=0}finally{i=s=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}}function bg(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function o0(e){return this instanceof o0?(this.v=e,this):new o0(e)}function NN(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(e,t||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(P){i[P]&&(n[P]=function(I){return new Promise(function(N,F){s.push([P,I,N,F])>1||o(P,I)})})}function o(P,I){try{f(i[P](I))}catch(N){A(s[0][3],N)}}function f(P){P.value instanceof o0?Promise.resolve(P.value.v).then(m,w):A(s[0][2],P)}function m(P){o("next",P)}function w(P){o("throw",P)}function A(P,I){P(I),s.shift(),s.length&&o(s[0][0],s[0][1])}}var EL=function(e){DN(t,e);function t(r){var i=e.call(this,r)||this;return Object.defineProperty(i,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(i,i.constructor.prototype):i.__proto__=i.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(i,i.constructor),i}return t}(Error);(function(){function e(t){if(t<0)throw new RangeError("Capacity may not be less than 0");this._c=t,this._q=[]}return Object.defineProperty(e.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this.full)throw new Error("Buffer full");this._q.push(t)},e.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},e})();(function(){function e(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(e.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.add=function(t){for(;this._q.length>=this._c;)this._q.shift();this._q.push(t)},e.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},e})();(function(){function e(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(e.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.add=function(t){this._q.length<this._c&&this._q.push(t)},e.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},e})();function $w(e){e!=null&&typeof e.then=="function"&&e.then(d_,d_)}var Lb=0,eC=1,Ef=2,u_=3,Zw=4,h_=1024,d_=function(){};function Up(e){var t=e.err,r=Promise.resolve(e.execution).then(function(i){if(t!=null)throw t;return i});return e.err=void 0,e.execution=r.then(function(){},function(){}),e.pending===void 0?r:e.pending.then(function(){return r})}function nf(e,t){var r=e.state>=u_;return Promise.resolve(t).then(function(i){return!r&&e.state>=Zw?Up(e).then(function(n){return{value:n,done:!0}}):{value:i,done:r}})}function K5(e,t){var r,i;if(!(e.state>=Ef))if(e.state=Ef,e.onnext(),e.onstop(),e.err==null&&(e.err=t),e.pushes.length===0&&(typeof e.buffer>"u"||e.buffer.empty))Rm(e);else try{for(var n=bg(e.pushes),s=n.next();!s.done;s=n.next()){var a=s.value;a.resolve()}}catch(o){r={error:o}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}}function Rm(e){var t,r;if(!(e.state>=u_)){e.state<Ef&&K5(e),e.state=u_,e.buffer=void 0;try{for(var i=bg(e.nexts),n=i.next();!n.done;n=i.next()){var s=n.value,a=e.pending===void 0?Up(e):e.pending.then(function(){return Up(e)});s.resolve(nf(e,a))}}catch(o){t={error:o}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.pushes=[],e.nexts=[]}}function rC(e){e.state>=Zw||(e.state<u_&&Rm(e),e.state=Zw)}function FN(e,t){if($w(t),e.pushes.length>=h_)throw new EL("No more than "+h_+" pending calls to push are allowed on a single repeater.");if(e.state>=Ef)return Promise.resolve(void 0);var r=e.pending===void 0?Promise.resolve(t):e.pending.then(function(){return t});r=r.catch(function(f){e.state<Ef&&(e.err=f),rC(e)});var i;if(e.nexts.length){var n=e.nexts.shift();n.resolve(nf(e,r)),e.nexts.length?i=Promise.resolve(e.nexts[0].value):i=new Promise(function(f){return e.onnext=f})}else typeof e.buffer<"u"&&!e.buffer.full?(e.buffer.add(r),i=Promise.resolve(void 0)):i=new Promise(function(f){return e.pushes.push({resolve:f,value:r})});var s=!0,a={},o=i.catch(function(f){if(s)throw f});return a.then=function(f,m){return s=!1,Promise.prototype.then.call(i,f,m)},a.catch=function(f){return s=!1,Promise.prototype.catch.call(i,f)},a.finally=i.finally.bind(i),e.pending=r.then(function(){return o}).catch(function(f){e.err=f,rC(e)}),a}function zN(e){var t=K5.bind(null,e),r=new Promise(function(i){return e.onstop=i});return t.then=r.then.bind(r),t.catch=r.catch.bind(r),t.finally=r.finally.bind(r),t}function jN(e){if(!(e.state>=eC)){e.state=eC;var t=FN.bind(null,e),r=zN(e);e.execution=new Promise(function(i){return i(e.executor(t,r))}),e.execution.catch(function(){return K5(e)})}}var I1=new WeakMap,C0=function(){function e(t,r){I1.set(this,{executor:t,buffer:r,err:void 0,state:Lb,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:d_,onstop:d_})}return e.prototype.next=function(t){$w(t);var r=I1.get(this);if(r===void 0)throw new Error("WeakMap error");if(r.nexts.length>=h_)throw new EL("No more than "+h_+" pending calls to next are allowed on a single repeater.");if(r.state<=Lb&&jN(r),r.onnext(t),typeof r.buffer<"u"&&!r.buffer.empty){var i=nf(r,r.buffer.remove());if(r.pushes.length){var n=r.pushes.shift();r.buffer.add(n.value),r.onnext=n.resolve}return i}else if(r.pushes.length){var s=r.pushes.shift();return r.onnext=s.resolve,nf(r,s.value)}else if(r.state>=Ef)return Rm(r),nf(r,Up(r));return new Promise(function(a){return r.nexts.push({resolve:a,value:t})})},e.prototype.return=function(t){$w(t);var r=I1.get(this);if(r===void 0)throw new Error("WeakMap error");return Rm(r),r.execution=Promise.resolve(r.execution).then(function(){return t}),nf(r,Up(r))},e.prototype.throw=function(t){var r=I1.get(this);if(r===void 0)throw new Error("WeakMap error");return r.state<=Lb||r.state>=Ef||typeof r.buffer<"u"&&!r.buffer.empty?(Rm(r),r.err==null&&(r.err=t),nf(r,Up(r))):this.next(Promise.reject(t))},e.prototype[Symbol.asyncIterator]=function(){return this},e.race=UN,e.merge=GN,e.zip=VN,e.latest=qN,e}();function Q_(e,t){var r,i,n=[],s=function(m){m!=null&&typeof m[Symbol.asyncIterator]=="function"?n.push(m[Symbol.asyncIterator]()):m!=null&&typeof m[Symbol.iterator]=="function"?n.push(m[Symbol.iterator]()):n.push(function(){return NN(this,arguments,function(){return bd(this,function(w){switch(w.label){case 0:return t.yieldValues?[4,o0(m)]:[3,3];case 1:return[4,w.sent()];case 2:w.sent(),w.label=3;case 3:return t.returnValues?[4,o0(m)]:[3,5];case 4:return[2,w.sent()];case 5:return[2]}})})}())};try{for(var a=bg(e),o=a.next();!o.done;o=a.next()){var f=o.value;s(f)}}catch(m){r={error:m}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return n}function UN(e){var t=this,r=Q_(e,{returnValues:!0});return new C0(function(i,n){return sg(t,void 0,void 0,function(){var s,a,o,f,m,w;return bd(this,function(A){switch(A.label){case 0:if(!r.length)return n(),[2];a=!1,n.then(function(){s(),a=!0}),A.label=1;case 1:A.trys.push([1,,5,7]),f=void 0,m=0,w=function(){var P,I,N,F,Z,U;return bd(this,function(z){switch(z.label){case 0:P=m;try{for(I=(Z=void 0,bg(r)),N=I.next();!N.done;N=I.next())F=N.value,Promise.resolve(F.next()).then(function(J){J.done?(n(),o===void 0&&(o=J)):m===P&&(m++,s(J))},function(J){return n(J)})}catch(J){Z={error:J}}finally{try{N&&!N.done&&(U=I.return)&&U.call(I)}finally{if(Z)throw Z.error}}return[4,new Promise(function(J){return s=J})];case 1:return f=z.sent(),f===void 0?[3,3]:[4,i(f.value)];case 2:z.sent(),z.label=3;case 3:return[2]}})},A.label=2;case 2:return a?[3,4]:[5,w()];case 3:return A.sent(),[3,2];case 4:return[2,o&&o.value];case 5:return n(),[4,Promise.race(r.map(function(P){return P.return&&P.return()}))];case 6:return A.sent(),[7];case 7:return[2]}})})})}function GN(e){var t=this,r=Q_(e,{yieldValues:!0});return new C0(function(i,n){return sg(t,void 0,void 0,function(){var s,a,o,f=this;return bd(this,function(m){switch(m.label){case 0:if(!r.length)return n(),[2];s=[],a=!1,n.then(function(){var w,A;a=!0;try{for(var P=bg(s),I=P.next();!I.done;I=P.next()){var N=I.value;N()}}catch(F){w={error:F}}finally{try{I&&!I.done&&(A=P.return)&&A.call(P)}finally{if(w)throw w.error}}}),m.label=1;case 1:return m.trys.push([1,,3,4]),[4,Promise.all(r.map(function(w,A){return sg(f,void 0,void 0,function(){var P,I;return bd(this,function(N){switch(N.label){case 0:N.trys.push([0,,6,9]),N.label=1;case 1:return a?[3,5]:(Promise.resolve(w.next()).then(function(F){return s[A](F)},function(F){return n(F)}),[4,new Promise(function(F){s[A]=F})]);case 2:return P=N.sent(),P===void 0?[3,4]:P.done?(o=P,[2]):[4,i(P.value)];case 3:N.sent(),N.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return I=w.return,I?[4,w.return()]:[3,8];case 7:I=N.sent(),N.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return m.sent(),[2,o&&o.value];case 3:return n(),[7];case 4:return[2]}})})})}function VN(e){var t=this,r=Q_(e,{returnValues:!0});return new C0(function(i,n){return sg(t,void 0,void 0,function(){var s,a,o,f;return bd(this,function(m){switch(m.label){case 0:if(!r.length)return n(),[2,[]];a=!1,n.then(function(){s(),a=!0}),m.label=1;case 1:m.trys.push([1,,6,8]),m.label=2;case 2:return a?[3,5]:(Promise.all(r.map(function(w){return w.next()})).then(function(w){return s(w)},function(w){return n(w)}),[4,new Promise(function(w){return s=w})]);case 3:return o=m.sent(),o===void 0?[2]:(f=o.map(function(w){return w.value}),o.some(function(w){return w.done})?[2,f]:[4,i(f)]);case 4:return m.sent(),[3,2];case 5:return[3,8];case 6:return n(),[4,Promise.all(r.map(function(w){return w.return&&w.return()}))];case 7:return m.sent(),[7];case 8:return[2]}})})})}function qN(e){var t=this,r=Q_(e,{yieldValues:!0,returnValues:!0});return new C0(function(i,n){return sg(t,void 0,void 0,function(){var s,a,o,f,m,w=this;return bd(this,function(A){switch(A.label){case 0:if(!r.length)return n(),[2,[]];a=[],o=!1,n.then(function(){var P,I;s();try{for(var N=bg(a),F=N.next();!F.done;F=N.next()){var Z=F.value;Z()}}catch(U){P={error:U}}finally{try{F&&!F.done&&(I=N.return)&&I.call(N)}finally{if(P)throw P.error}}o=!0}),A.label=1;case 1:return A.trys.push([1,,5,7]),Promise.all(r.map(function(P){return P.next()})).then(function(P){return s(P)},function(P){return n(P)}),[4,new Promise(function(P){return s=P})];case 2:return f=A.sent(),f===void 0?[2]:(m=f.map(function(P){return P.value}),f.every(function(P){return P.done})?[2,m]:[4,i(m.slice())]);case 3:return A.sent(),[4,Promise.all(r.map(function(P,I){return sg(w,void 0,void 0,function(){var N;return bd(this,function(F){switch(F.label){case 0:if(f[I].done)return[2,f[I].value];F.label=1;case 1:return o?[3,4]:(Promise.resolve(P.next()).then(function(Z){return a[I](Z)},function(Z){return n(Z)}),[4,new Promise(function(Z){return a[I]=Z})]);case 2:return N=F.sent(),N===void 0?[2,f[I].value]:N.done?[2,N.value]:(m[I]=N.value,[4,i(m.slice())]);case 3:return F.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,A.sent()];case 5:return n(),[4,Promise.all(r.map(function(P){return P.return&&P.return()}))];case 6:return A.sent(),[7];case 7:return[2]}})})})}let f_=class{constructor(){this._extraRequestThreshold=256*1024}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw new Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}};f_.global=new f_;var yc;(function(e){e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Warn=2]="Warn",e[e.Error=3]="Error"})(yc||(yc={}));class Fs{static debug(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.log(yc.Debug,...r)}static info(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.log(yc.Info,...r)}static warn(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.log(yc.Warn,...r)}static error(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.log(yc.Error,...r)}static log(t){if(!(this.logLevel>t)){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];switch(t){case yc.Debug:{console.debug(...i);break}case yc.Info:{console.info(...i);break}case yc.Warn:{console.warn(...i);break}case yc.Error:{console.error(...i);break}}}}}Fs.logLevel=yc.Warn;const sf=8*4+8,HN=16;function Y5(e,t){t=Math.min(Math.max(+t,2),65535);let r=e,i=r;do r=Math.ceil(r/t),i+=r;while(r!==1);return i*sf}function WN(e,t){if(t<2)throw new Error("Node size must be at least 2");if(e===0)throw new Error("Number of items must be greater than 0");let r=e,i=r;const n=[r];do r=Math.ceil(r/t),i+=r,n.push(r);while(r!==1);const s=[];r=i;for(const o of n)s.push(r-o),r-=o;const a=[];for(let o=0;o<n.length;o++)a.push([s[o],s[o]+n[o]]);return a}async function*$N(e,t,r,i){class n{constructor(I,N){this._level=N,this.nodes=I}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(I){console.assert(I>this.nodes[1]),this.nodes[1]=I}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}const{minX:s,minY:a,maxX:o,maxY:f}=r;Fs.info(`tree items: ${e}, nodeSize: ${t}`);const m=WN(e,t),w=m[0][0],A=[(()=>{const P=[0,1],I=m.length-1;return new n(P,I)})()];for(Fs.debug(`starting stream search with queue: ${A}, numItems: ${e}, nodeSize: ${t}, levelBounds: ${m}`);A.length!=0;){const P=A.shift();Fs.debug(`popped node: ${P}, queueLength: ${A.length}`);const I=P.startNodeIdx(),N=I>=w,F=(()=>{const[,J]=m[P.level()],nt=Math.min(P.endNodeIdx()+t,J);return N&&nt<J?nt+1:nt})(),Z=F-I,U=await i(I*sf,Z*sf),z=new DataView(U);for(let J=I;J<F;J++){const nt=J-I,mt=nt*sf;if(o<z.getFloat64(mt+0,!0)||f<z.getFloat64(mt+8,!0)||s>z.getFloat64(mt+16,!0)||a>z.getFloat64(mt+24,!0))continue;const Et=z.getBigUint64(mt+32,!0);if(N){const at=Et,dt=(()=>{if(J<e-1){const xt=(nt+1)*sf;return z.getBigUint64(xt+32,!0)-at}else return null})(),kt=J-w;yield[Number(at),kt,Number(dt)];continue}const bt=Et,pt=f_.global.extraRequestThreshold()/sf,zt=A[A.length-1];if(zt!==void 0&&zt.level()==P.level()-1&&bt<zt.endNodeIdx()+pt){Fs.debug(`Merging "nodeRange" request into existing range: ${zt}, newEndNodeIdx: ${zt.endNodeIdx()} -> ${bt}`),zt.extendEndNodeIdx(Number(bt));continue}const Rt=(()=>{const at=P.level()-1,dt=[Number(bt),Number(bt)+1];return new n(dt,at)})();zt!==void 0&&zt.level()==Rt.level()?Fs.info(`Same level, but too far away. Pushing new request for nodeIdx: ${bt} rather than merging with distant ${zt}`):Fs.info(`Pushing new level for ${Rt} onto queue with nearestNodeRange: ${zt} since there's not already a range for this level.`),A.push(Rt)}}}const sd=new Uint8Array([102,103,98,3,102,103,98,0]),Qu=4;class Q5{constructor(t,r,i,n,s){this.headerClient=t,this.header=r,this.headerLength=i,this.indexLength=n,this.nocache=s}static async open(t,r){const i=new iC(t,r),n=(()=>{const A=HN,P=3;let I=0,N;for(N=0;N<P;N++){const F=A**N*sf;I+=F}return I})(),s=2024+n;Fs.debug(`fetching header. minReqLength: ${s} (assumedHeaderLength: 2024, assumedIndexLength: ${n})`);{const A=new Uint8Array(await i.getRange(0,8,s,"header"));if(!A.subarray(0,3).every((P,I)=>sd[I]===P))throw Fs.error(`bytes: ${A} != ${sd}`),new Error("Not a FlatGeobuf file");Fs.debug("magic bytes look good")}let a;{const A=await i.getRange(8,4,s,"header");a=new DataView(A).getUint32(0,!0);const P=1048576*10;if(a>P||a<8)throw new Error("Invalid header size");Fs.debug(`headerLength: ${a}`)}const o=await i.getRange(12,a,s,"header"),f=new hh(new Uint8Array(o)),m=X5(f),w=Y5(m.featuresCount,m.indexNodeSize);return Fs.debug("completed: opening http reader"),new Q5(i,m,a,w,r)}async*selectBbox(t){const r=this.lengthBeforeTree(),i=this.headerClient,n=async function(f,m){return i.getRange(r+f,m,0,"index")},s=[];let a=[];for await(const f of $N(this.header.featuresCount,this.header.indexNodeSize,t,n)){const[m,,]=f;let[,,w]=f;if(w||(Fs.info("final feature"),w=4),a.length==0){a.push([m,w]);continue}const A=a[a.length-1],P=m-(A[0]+A[1]);P>f_.global.extraRequestThreshold()&&(Fs.info(`Pushing new feature batch, since gap ${P} was too large`),s.push(a),a=[]),a.push([m,w])}this.headerClient.logUsage("header+index"),a.length>0&&s.push(a);const o=s.flatMap(f=>this.readFeatureBatch(f,this.nocache));yield*C0.merge(o)}lengthBeforeTree(){return sd.length+Qu+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(t){return new iC(this.headerClient.httpClient,t)}async*readFeatureBatch(t,r){const[i]=t[0],[n,s]=t[t.length-1],a=i,o=n+s-a,f=this.buildFeatureClient(r);let m=o;for(const[w]of t)yield await this.readFeature(f,w,m),m=0;f.logUsage("feature")}async readFeature(t,r,i){const n=r+this.lengthBeforeFeatures();let s;{const w=await t.getRange(n,4,i,"feature length");s=new DataView(w).getUint32(0,!0)}const a=await t.getRange(n+4,s,i,"feature data"),o=new Uint8Array(a),f=new Uint8Array(s+Qu);f.set(o,Qu);const m=new hh(f);return m.setPosition(Qu),vc.getRootAsFeature(m)}}class iC{constructor(t,r){if(this.bytesEverUsed=0,this.bytesEverFetched=0,this.buffer=new ArrayBuffer(0),this.head=0,typeof t=="string")this.httpClient=new nC(t,r);else if(t instanceof nC)this.httpClient=t;else throw new Error("Unknown source ")}async getRange(t,r,i,n){this.bytesEverUsed+=r;const s=t-this.head,a=s+r;if(s>=0&&a<=this.buffer.byteLength)return this.buffer.slice(s,a);const o=Math.max(r,i);return this.bytesEverFetched+=o,Fs.debug(`requesting for new Range: ${t}-${t+o-1}`),this.buffer=await this.httpClient.getRange(t,o,n),this.head=t,this.buffer.slice(0,r)}logUsage(t){const r=t.split(" ")[0],i=this.bytesEverUsed,n=this.bytesEverFetched,s=(100*i/n).toFixed(2);Fs.info(`${r} bytes used/requested: ${i} / ${n} = ${s}%`)}}class nC{constructor(t,r){this.requestsEverMade=0,this.bytesEverRequested=0,this.url=t,this.nocache=r}async getRange(t,r,i){this.requestsEverMade+=1,this.bytesEverRequested+=r;const n=`bytes=${t}-${t+r-1}`;Fs.info(`request: #${this.requestsEverMade}, purpose: ${i}), bytes: (this_request: ${r}, ever: ${this.bytesEverRequested}), Range: ${n}`);const s={Range:n};return this.nocache&&(s["Cache-Control"]="no-cache, no-store"),(await fetch(this.url,{headers:s})).arrayBuffer()}}function ZN(e,t,r){if(!e.subarray(0,3).every((w,A)=>sd[A]===w))throw new Error("Not a FlatGeobuf file");const i=new hh(e),n=i.readUint32(sd.length);i.setPosition(sd.length+Qu);const s=X5(i);r&&r(s);let a=sd.length+Qu+n;const{indexNodeSize:o,featuresCount:f}=s;o>0&&(a+=Y5(f,o));const m=[];for(;a<i.capacity();){const w=i.readUint32(a);i.setPosition(a+Qu);const A=vc.getRootAsFeature(i);m.push(t(A,s)),a+=Qu+w}return m}async function*JN(e,t,r){const i=ON(e),n=async P=>await i.slice(P);let s=new Uint8Array(await n(8));if(!s.subarray(0,3).every((P,I)=>sd[I]===P))throw new Error("Not a FlatGeobuf file");s=new Uint8Array(await n(4));let a=new hh(s);const o=a.readUint32(0);s=new Uint8Array(await n(o)),a=new hh(s);const f=X5(a);r&&r(f);const{indexNodeSize:m,featuresCount:w}=f;if(m>0){const P=Y5(w,m);await n(P)}let A;for(;A=await KN(n,f,t);)yield A}function XN(e,t,r,i){try{let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return async function*(){const s=await Q5.open(e,n);Fs.debug("opened reader"),i&&i(s.header);for await(const a of s.selectBbox(t))yield r(a,s.header)}()}catch(n){return Promise.reject(n)}}async function KN(e,t,r){let i=new Uint8Array(await e(4,"feature length"));if(i.byteLength===0)return;let n=new hh(i);const s=n.readUint32(0);i=new Uint8Array(await e(s,"feature data"));const a=new Uint8Array(s+4);a.set(i,4),n=new hh(a),n.setPosition(Qu);const o=vc.getRootAsFeature(n);return r(o,t)}function YN(e,t){return{type:"FeatureCollection",features:ZN(e,Z5,t)}}function QN(e,t){return JN(e,Z5,t)}function tF(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return XN(e,t,Z5,r,i)}function sC(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e instanceof Uint8Array?YN(e,r):e instanceof ReadableStream?QN(e,r):tF(e,t,r,i)}class eF{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(t){this._map=t;let r=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(r._btn.className.indexOf("3d")!=-1){let m={pitch:r._pitch,bearing:r._bearing};r._minpitchzoom&&t.getZoom()>r._minpitchzoom&&(m.zoom=r._minpitchzoom);var i=0,n=38.5,s=6,a=62.33,{longitude:o,latitude:f}=t.getCenter();t.getZoom()<10?t.setTerrain({source:"terrainMapZen",exaggeration:1.5}):o>=i&&o<=s&&f>=n&&f<=a?t.setTerrain({source:"terrainICGC",exaggeration:1.2}):t.setTerrain({source:"terrainMapZen",exaggeration:1.5}),t.easeTo(m),r._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else t.setTerrain(null),t.easeTo({pitch:0,bearing:0}),r._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function a0(e){"@babel/helpers - typeof";return a0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a0(e)}function rF(e,t){if(a0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(a0(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function iF(e){var t=rF(e,"string");return a0(t)=="symbol"?t:String(t)}function $(e,t,r){return t=iF(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sn(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const tv=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),oC=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);oC&&parseFloat(oC[1]);const nF="3.4.14";function yu(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const Bb={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},sF=Bb.global||Bb.self||Bb.window||{},nh=typeof process!="object"||String(process)!=="[object process]"||process.browser,tA=typeof importScripts=="function",oF=typeof window<"u"&&typeof window.orientation<"u",aC=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);aC&&parseFloat(aC[1]);class aF{constructor(t,r){$(this,"name",void 0),$(this,"workerThread",void 0),$(this,"isRunning",!0),$(this,"result",void 0),$(this,"_resolve",()=>{}),$(this,"_reject",()=>{}),this.name=t,this.workerThread=r,this.result=new Promise((i,n)=>{this._resolve=i,this._reject=n})}postMessage(t,r){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:r})}done(t){yu(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){yu(this.isRunning),this.isRunning=!1,this._reject(t)}}let kb=class{terminate(){}};const Rb=new Map;function lF(e){yu(e.source&&!e.url||!e.source&&e.url);let t=Rb.get(e.source||e.url);return t||(e.url&&(t=cF(e.url),Rb.set(e.url,t)),e.source&&(t=CL(e.source),Rb.set(e.source,t))),yu(t),t}function cF(e){if(!e.startsWith("http"))return e;const t=uF(e);return CL(t)}function CL(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function uF(e){return`try {
  importScripts('`.concat(e,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function TL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2?arguments[2]:void 0;const i=r||new Set;if(e){if(lC(e))i.add(e);else if(lC(e.buffer))i.add(e.buffer);else if(!ArrayBuffer.isView(e)&&t&&typeof e=="object")for(const n in e)TL(e[n],t,i)}return r===void 0?Array.from(i):[]}function lC(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}const Ob=()=>{};class Jw{static isSupported(){return typeof Worker<"u"&&nh||typeof kb<"u"&&!nh}constructor(t){$(this,"name",void 0),$(this,"source",void 0),$(this,"url",void 0),$(this,"terminated",!1),$(this,"worker",void 0),$(this,"onMessage",void 0),$(this,"onError",void 0),$(this,"_loadableURL","");const{name:r,source:i,url:n}=t;yu(i||n),this.name=r,this.source=i,this.url=n,this.onMessage=Ob,this.onError=s=>console.log(s),this.worker=nh?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Ob,this.onError=Ob,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,r){r=r||TL(t),this.worker.postMessage(t,r)}_getErrorFromErrorEvent(t){let r="Failed to load ";return r+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(r+="".concat(t.message," in ")),t.lineno&&(r+=":".concat(t.lineno,":").concat(t.colno)),new Error(r)}_createBrowserWorker(){this._loadableURL=lF({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},t.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},t.onmessageerror=r=>console.error(r),t}_createNodeWorker(){let t;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);t=new kb(r,{eval:!1})}else if(this.source)t=new kb(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",r=>{this.onMessage(r)}),t.on("error",r=>{this.onError(r)}),t.on("exit",r=>{}),t}}class hF{static isSupported(){return Jw.isSupported()}constructor(t){$(this,"name","unnamed"),$(this,"source",void 0),$(this,"url",void 0),$(this,"maxConcurrency",1),$(this,"maxMobileConcurrency",1),$(this,"onDebug",()=>{}),$(this,"reuseWorkers",!0),$(this,"props",{}),$(this,"jobQueue",[]),$(this,"idleQueue",[]),$(this,"count",0),$(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s,a,o)=>s.done(o),i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s,a)=>s.error(a);const n=new Promise(s=>(this.jobQueue.push({name:t,onMessage:r,onError:i,onStart:s}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:t,backlog:this.jobQueue.length});const i=new aF(r.name,t);t.onMessage=n=>r.onMessage(i,n.type,n.payload),t.onError=n=>r.onError(i,n),r.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Jw({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return oF?this.maxMobileConcurrency:this.maxConcurrency}}const dF={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Ju{static isSupported(){return Jw.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Ju._workerFarm=Ju._workerFarm||new Ju({}),Ju._workerFarm.setProps(t),Ju._workerFarm}constructor(t){$(this,"props",void 0),$(this,"workerPools",new Map),this.props={...dF},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:r,source:i,url:n}=t;let s=this.workerPools.get(r);return s||(s=new hF({name:r,source:i,url:n}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}$(Ju,"_workerFarm",void 0);const fF="latest";function pF(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t[e.id]||{},i="".concat(e.id,"-worker.js");let n=r.workerUrl;if(!n&&e.id==="compression"&&(n=t.workerUrl),t._workerType==="test"&&(n="modules/".concat(e.module,"/dist/").concat(i)),!n){let s=e.version;s==="latest"&&(s=fF);const a=s?"@".concat(s):"";n="https://unpkg.com/@loaders.gl/".concat(e.module).concat(a,"/dist/").concat(i)}return yu(n),n}function gF(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:nF;yu(e,"no worker provided");const r=e.version;return!(!t||!r)}const mF=null,yF=null,Xw=null,PL=null,_F=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:mF,readFileAsText:yF,requireFromFile:Xw,requireFromString:PL},Symbol.toStringTag,{value:"Module"})),vF="3.4.14",Db={};async function yf(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return t&&(e=bF(e,t,r)),Db[e]=Db[e]||wF(e),await Db[e]}function bF(e,t,r){if(e.startsWith("http"))return e;const i=r.modules||{};return i[e]?i[e]:nh?r.CDN?(yu(r.CDN.startsWith("http")),"".concat(r.CDN,"/").concat(t,"@").concat(vF,"/dist/libs/").concat(e)):tA?"../src/libs/".concat(e):"modules/".concat(t,"/src/libs/").concat(e):"modules/".concat(t,"/dist/libs/").concat(e)}async function wF(e){if(e.endsWith("wasm"))return await(await fetch(e)).arrayBuffer();if(!nh)try{return _F&&Xw&&await Xw(e)}catch{return null}if(tA)return importScripts(e);const t=await(await fetch(e)).text();return xF(t,e)}function xF(e,t){if(!nh)return PL;if(tA)return eval.call(sF,e),null;const r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch{r.text=e}return document.body.appendChild(r),null}function AF(e,t){return!Ju.isSupported()||!nh&&!(t!=null&&t._nodeWorkers)?!1:e.worker&&(t==null?void 0:t.worker)}async function SF(e,t,r,i,n){const s=e.id,a=pF(e,r),o=Ju.getWorkerFarm(r).getWorkerPool({name:s,url:a});r=JSON.parse(JSON.stringify(r)),i=JSON.parse(JSON.stringify(i||{}));const f=await o.startJob("process-on-worker",EF.bind(null,n));return f.postMessage("process",{input:t,options:r,context:i}),await(await f.result).result}async function EF(e,t,r,i){switch(r){case"done":t.done(i);break;case"error":t.error(new Error(i.error));break;case"process":const{id:n,input:s,options:a}=i;try{const o=await e(s,a);t.postMessage("done",{id:n,result:o})}catch(o){const f=o instanceof Error?o.message:"unknown error";t.postMessage("error",{id:n,error:f})}break;default:console.warn("parse-with-worker unknown message ".concat(r))}}function CF(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?cC(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?cC(e,0,t):""}function cC(e,t,r){if(e.byteLength<=t+r)return"";const i=new DataView(e);let n="";for(let s=0;s<r;s++)n+=String.fromCharCode(i.getUint8(t+s));return n}function TF(e){try{return JSON.parse(e)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(CF(e),'"'))}}function PF(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;const i=new Uint8Array(e),n=new Uint8Array(t);for(let s=0;s<i.length;++s)if(i[s]!==n[s])return!1;return!0}function IF(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const i=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),n=i.reduce((o,f)=>o+f.byteLength,0),s=new Uint8Array(n);let a=0;for(const o of i)s.set(o,a),a+=o.byteLength;return s.buffer}function eA(e,t,r){const i=r!==void 0?new Uint8Array(e).subarray(t,t+r):new Uint8Array(e).subarray(t);return new Uint8Array(i).buffer}function T0(e,t){return sn(e>=0),sn(t>0),e+(t-1)&~(t-1)}function MF(e,t,r){let i;if(e instanceof ArrayBuffer)i=new Uint8Array(e);else{const n=e.byteOffset,s=e.byteLength;i=new Uint8Array(e.buffer||e.arrayBuffer,n,s)}return t.set(i,r),r+T0(i.byteLength,4)}async function LF(e){const t=[];for await(const r of e)t.push(r);return IF(...t)}function uC(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}let hC=class{constructor(e,t){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=uC(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(uC()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},BF=class{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(e){const{name:t,type:r}=e;let i=this.stats[t];return i||(e instanceof hC?i=e:i=new hC(t,r),this.stats[t]=i),i}};const kF="Queued Requests",RF="Active Requests",OF="Cancelled Requests",DF="Queued Requests Ever",NF="Active Requests Ever",FF={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class zF{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"props",void 0),$(this,"stats",void 0),$(this,"activeRequestCount",0),$(this,"requestQueue",[]),$(this,"requestMap",new Map),$(this,"deferredUpdate",null),this.props={...FF,...t},this.stats=new BF({id:this.props.id}),this.stats.get(kF),this.stats.get(RF),this.stats.get(OF),this.stats.get(DF),this.stats.get(NF)}scheduleRequest(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const i={handle:t,priority:0,getPriority:r},n=new Promise(s=>(i.resolve=s,i));return this.requestQueue.push(i),this.requestMap.set(t,n),this._issueNewRequests(),n}_issueRequest(t){const{handle:r,resolve:i}=t;let n=!1;const s=()=>{n||(n=!0,this.requestMap.delete(r),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let r=0;r<t;++r){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const t=this.requestQueue;for(let r=0;r<t.length;++r){const i=t[r];this._updateRequest(i)||(t.splice(r,1),this.requestMap.delete(i.handle),r--)}t.sort((r,i)=>r.priority-i.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let jF="";const dC={};function UF(e){for(const t in dC)if(e.startsWith(t)){const r=dC[t];e=e.replace(t,r)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e="".concat(jF).concat(e)),e}function GF(e){return e&&typeof e=="object"&&e.isBuffer}function IL(e){if(GF(e)||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function ML(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function rA(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}const VF=e=>typeof e=="boolean",Om=e=>typeof e=="function",P0=e=>e!==null&&typeof e=="object",fC=e=>P0(e)&&e.constructor==={}.constructor,qF=e=>e&&typeof e[Symbol.iterator]=="function",HF=e=>e&&typeof e[Symbol.asyncIterator]=="function",Lf=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Bf=e=>typeof Blob<"u"&&e instanceof Blob,WF=e=>e&&typeof e=="object"&&e.isBuffer,$F=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||P0(e)&&Om(e.tee)&&Om(e.cancel)&&Om(e.getReader),ZF=e=>P0(e)&&Om(e.read)&&Om(e.pipe)&&VF(e.readable),LL=e=>$F(e)||ZF(e),JF=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,XF=/^([-\w.]+\/[-\w.+]+)/;function KF(e){const t=XF.exec(e);return t?t[1]:e}function pC(e){const t=JF.exec(e);return t?t[1]:""}const BL=/\?.*/;function YF(e){const t=e.match(BL);return t&&t[0]}function iA(e){return e.replace(BL,"")}function ev(e){return Lf(e)?e.url:Bf(e)?e.name||"":typeof e=="string"?e:""}function nA(e){if(Lf(e)){const t=e,r=t.headers.get("content-type")||"",i=iA(t.url);return KF(r)||pC(i)}return Bf(e)?e.type||"":typeof e=="string"?pC(e):""}function QF(e){return Lf(e)?e.headers["content-length"]||-1:Bf(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function kL(e){if(Lf(e))return e;const t={},r=QF(e);r>=0&&(t["content-length"]=String(r));const i=ev(e),n=nA(e);n&&(t["content-type"]=n);const s=await rz(e);s&&(t["x-first-bytes"]=s),typeof e=="string"&&(e=new TextEncoder().encode(e));const a=new Response(e,{headers:t});return Object.defineProperty(a,"url",{value:i}),a}async function tz(e){if(!e.ok){const t=await ez(e);throw new Error(t)}}async function ez(e){let t="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): ");try{const r=e.headers.get("Content-Type");let i=e.statusText;r.includes("application/json")&&(i+=" ".concat(await e.text())),t+=i,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch{}return t}async function rz(e){if(typeof e=="string")return"data:,".concat(e.slice(0,5));if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=n=>{var s;return r(n==null||(s=n.target)===null||s===void 0?void 0:s.result)},i.readAsDataURL(t)})}if(e instanceof ArrayBuffer){const t=e.slice(0,5),r=iz(t);return"data:base64,".concat(r)}return null}function iz(e){let t="";const r=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)t+=String.fromCharCode(r[i]);return btoa(t)}async function gC(e,t){if(typeof e=="string"){e=UF(e);let r=t;return t!=null&&t.fetch&&typeof(t==null?void 0:t.fetch)!="function"&&(r=t.fetch),await fetch(e,r)}return await kL(e)}function nz(e){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,r=e||t;return!!(r&&r.indexOf("Electron")>=0)}function I0(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||nz()}const Nb=globalThis.window||globalThis.self||globalThis.global,M1=globalThis.process||{},RL=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";I0();function sz(e){try{const t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch{return null}}let oz=class{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=sz(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function az(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function lz(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const r=Math.max(t-e.length,0);return`${" ".repeat(r)}${e}`}function Fb(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const n=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>i&&(r=Math.min(r,i/e.width));const s=e.width*r,a=e.height*r,o=["font-size:1px;",`padding:${Math.floor(a/2)}px ${Math.floor(s/2)}px;`,`line-height:${a}px;`,`background:url(${n});`,`background-size:${s}px ${a}px;`,"color:transparent;"].join("");return[`${t} %c+`,o]}let p_;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(p_||(p_={}));const cz=10;function mC(e){return typeof e!="string"?e:(e=e.toUpperCase(),p_[e]||p_.WHITE)}function uz(e,t,r){return!I0&&typeof e=="string"&&(t&&(e=`\x1B[${mC(t)}m${e}\x1B[39m`),r&&(e=`\x1B[${mC(r)+cz}m${e}\x1B[49m`)),e}function hz(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const r=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(r),n=e;for(const s of i){const a=n[s];typeof a=="function"&&(t.find(o=>s===o)||(n[s]=a.bind(e)))}}function g_(e,t){if(!e)throw new Error(t||"Assertion failed")}function tp(){let e;if(I0()&&Nb.performance){var t,r;e=Nb==null||(t=Nb.performance)===null||t===void 0||(r=t.now)===null||r===void 0?void 0:r.call(t)}else if("hrtime"in M1){var i;const n=M1==null||(i=M1.hrtime)===null||i===void 0?void 0:i.call(M1);e=n[0]*1e3+n[1]/1e6}else e=Date.now();return e}const ep={debug:I0()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},dz={enabled:!0,level:0};function Sl(){}const yC={},_C={once:!0};let sA=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=RL,this._startTs=tp(),this._deltaTs=tp(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new oz(`__probe-${this.id}__`,dz),this.timeStamp(`${this.id} started`),hz(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((tp()-this._startTs).toPrecision(10))}getDelta(){return Number((tp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){g_(e,t)}warn(e){return this._getLogFunction(0,e,ep.warn,arguments,_C)}error(e){return this._getLogFunction(0,e,ep.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,ep.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,ep.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,ep.debug||ep.info,arguments,_C)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||Sl,r&&[r],{tag:mz(t)}):Sl}image(e){let{logLevel:t,priority:r,image:i,message:n="",scale:s=1}=e;return this._shouldLog(t||r)?I0()?gz({image:i,message:n,scale:s}):pz():Sl}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Sl)}group(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=vC({logLevel:e,message:t,opts:r}),{collapsed:n}=r;return i.method=(n?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Sl)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=OL(e)}_getLogFunction(e,t,r,i,n){if(this._shouldLog(e)){n=vC({logLevel:e,message:t,args:i,opts:n}),r=r||n.method,g_(r),n.total=this.getTotal(),n.delta=this.getDelta(),this._deltaTs=tp();const s=n.tag||n.message;if(n.once&&s)if(!yC[s])yC[s]=tp();else return Sl;return t=fz(this.id,n.message,n),r.bind(console,t,...n.args)}return Sl}};sA.VERSION=RL;function OL(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return g_(Number.isFinite(t)&&t>=0),t}function vC(e){const{logLevel:t,message:r}=e;e.logLevel=OL(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==r;);switch(typeof t){case"string":case"function":r!==void 0&&i.unshift(r),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const n=typeof e.message;return g_(n==="string"||n==="object"),Object.assign(e,{args:i},e.opts)}function fz(e,t,r){if(typeof t=="string"){const i=r.time?lz(az(r.total)):"";t=r.time?`${e}: ${i}  ${t}`:`${e}: ${t}`,t=uz(t,r.color,r.background)}return t}function pz(e){return console.warn("removed"),Sl}function gz(e){let{image:t,message:r="",scale:i=1}=e;if(typeof t=="string"){const s=new Image;return s.onload=()=>{const a=Fb(s,r,i);console.log(...a)},s.src=t,Sl}const n=t.nodeName||"";if(n.toLowerCase()==="img")return console.log(...Fb(t,r,i)),Sl;if(n.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Fb(s,r,i)),s.src=t.toDataURL(),Sl}return Sl}function mz(e){for(const t in e)for(const r in e[t])return r||"untitled";return"empty"}const bC=new sA({id:"loaders.gl"});class yz{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class _z{constructor(){$(this,"console",void 0),this.console=console}log(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return this.console.log.bind(this.console,...r)}info(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return this.console.info.bind(this.console,...r)}warn(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return this.console.warn.bind(this.console,...r)}error(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return this.console.error.bind(this.console,...r)}}const DL={fetch:null,mimeType:void 0,nothrow:!1,log:new _z,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:tv,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},vz={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function NL(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}const FL=()=>{const e=NL();return e.globalOptions=e.globalOptions||{...DL},e.globalOptions};function bz(e,t,r,i){return r=r||[],r=Array.isArray(r)?r:[r],wz(e,r),Az(t,e,i)}function wz(e,t){wC(e,null,DL,vz,t);for(const r of t){const i=e&&e[r.id]||{},n=r.options&&r.options[r.id]||{},s=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};wC(i,r.id,n,s,t)}}function wC(e,t,r,i,n){const s=t||"Top level",a=t?"".concat(t,"."):"";for(const o in e){const f=!t&&P0(e[o]),m=o==="baseUri"&&!t,w=o==="workerUrl"&&t;if(!(o in r)&&!m&&!w){if(o in i)bC.warn("".concat(s," loader option '").concat(a).concat(o,"' no longer supported, use '").concat(i[o],"'"))();else if(!f){const A=xz(o,n);bC.warn("".concat(s," loader option '").concat(a).concat(o,"' not recognized. ").concat(A))()}}}}function xz(e,t){const r=e.toLowerCase();let i="";for(const n of t)for(const s in n.options){if(e===s)return"Did you mean '".concat(n.id,".").concat(s,"'?");const a=s.toLowerCase();(r.startsWith(a)||a.startsWith(r))&&(i=i||"Did you mean '".concat(n.id,".").concat(s,"'?"))}return i}function Az(e,t,r){const i={...e.options||{}};return Sz(i,r),i.log===null&&(i.log=new yz),xC(i,FL()),xC(i,t),i}function xC(e,t){for(const r in t)if(r in t){const i=t[r];fC(i)&&fC(e[r])?e[r]={...e[r],...t[r]}:e[r]=t[r]}}function Sz(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function oA(e){var t;return e?(Array.isArray(e)&&(e=e[0]),Array.isArray((t=e)===null||t===void 0?void 0:t.extensions)):!1}function aA(e){var t,r;sn(e,"null loader"),sn(oA(e),"invalid loader");let i;return Array.isArray(e)&&(i=e[1],e=e[0],e={...e,options:{...e.options,...i}}),((t=e)!==null&&t!==void 0&&t.parseTextSync||(r=e)!==null&&r!==void 0&&r.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const zL=()=>{const e=NL();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function Ez(e){const t=zL();e=Array.isArray(e)?e:[e];for(const r of e){const i=aA(r);t.find(n=>i===n)||t.unshift(i)}}function Cz(){return zL()}const Tz=new sA({id:"loaders.gl"}),Pz=/\.([^.]+)$/;async function Iz(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!jL(e))return null;let n=AC(e,t,{...r,nothrow:!0},i);if(n)return n;if(Bf(e)&&(e=await e.slice(0,10).arrayBuffer(),n=AC(e,t,r,i)),!n&&!(r!=null&&r.nothrow))throw new Error(UL(e));return n}function AC(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!jL(e))return null;if(t&&!Array.isArray(t))return aA(t);let n=[];t&&(n=n.concat(t)),r!=null&&r.ignoreRegisteredLoaders||n.push(...Cz()),Lz(n);const s=Mz(e,n,r,i);if(!s&&!(r!=null&&r.nothrow))throw new Error(UL(e));return s}function Mz(e,t,r,i){const n=ev(e),s=nA(e),a=iA(n)||(i==null?void 0:i.url);let o=null,f="";if(r!=null&&r.mimeType&&(o=zb(t,r==null?void 0:r.mimeType),f="match forced by supplied MIME type ".concat(r==null?void 0:r.mimeType)),o=o||Bz(t,a),f=f||(o?"matched url ".concat(a):""),o=o||zb(t,s),f=f||(o?"matched MIME type ".concat(s):""),o=o||Rz(t,e),f=f||(o?"matched initial data ".concat(VL(e)):""),o=o||zb(t,r==null?void 0:r.fallbackMimeType),f=f||(o?"matched fallback MIME type ".concat(s):""),f){var m;Tz.log(1,"selectLoader selected ".concat((m=o)===null||m===void 0?void 0:m.name,": ").concat(f,"."))}return o}function jL(e){return!(e instanceof Response&&e.status===204)}function UL(e){const t=ev(e),r=nA(e);let i="No valid loader found (";i+=t?"".concat(ML(t),", "):"no url provided, ",i+="MIME type: ".concat(r?'"'.concat(r,'"'):"not provided",", ");const n=e?VL(e):"";return i+=n?' first bytes: "'.concat(n,'"'):"first bytes: not available",i+=")",i}function Lz(e){for(const t of e)aA(t)}function Bz(e,t){const r=t&&Pz.exec(t),i=r&&r[1];return i?kz(e,i):null}function kz(e,t){t=t.toLowerCase();for(const r of e)for(const i of r.extensions)if(i.toLowerCase()===t)return r;return null}function zb(e,t){for(const r of e)if(r.mimeTypes&&r.mimeTypes.includes(t)||t==="application/x.".concat(r.id))return r;return null}function Rz(e,t){if(!t)return null;for(const r of e)if(typeof t=="string"){if(Oz(t,r))return r}else if(ArrayBuffer.isView(t)){if(SC(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&SC(t,0,r))return r;return null}function Oz(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(r=>e.startsWith(r))}function SC(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(i=>Dz(e,t,r,i))}function Dz(e,t,r,i){if(i instanceof ArrayBuffer)return PF(i,e,i.byteLength);switch(typeof i){case"function":return i(e,r);case"string":const n=Kw(e,t,i.length);return i===n;default:return!1}}function VL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?Kw(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?Kw(e,0,t):""}function Kw(e,t,r){if(e.byteLength<t+r)return"";const i=new DataView(e);let n="";for(let s=0;s<r;s++)n+=String.fromCharCode(i.getUint8(t+s));return n}const Nz=256*1024;function*Fz(e,t){const r=(t==null?void 0:t.chunkSize)||Nz;let i=0;const n=new TextEncoder;for(;i<e.length;){const s=Math.min(e.length-i,r),a=e.slice(i,i+s);i+=s,yield n.encode(a)}}const zz=256*1024;function jz(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:r=zz}=t;let i=0;for(;i<e.byteLength;){const n=Math.min(e.byteLength-i,r),s=new ArrayBuffer(n),a=new Uint8Array(e,i,n);new Uint8Array(s).set(a),i+=n,yield s}}()}const Uz=1024*1024;async function*Gz(e,t){const r=(t==null?void 0:t.chunkSize)||Uz;let i=0;for(;i<e.size;){const n=i+r,s=await e.slice(i,n).arrayBuffer();i=n,yield s}}function EC(e,t){return tv?Vz(e,t):qz(e)}async function*Vz(e,t){const r=e.getReader();let i;try{for(;;){const n=i||r.read();t!=null&&t._streamReadAhead&&(i=r.read());const{done:s,value:a}=await n;if(s)return;yield IL(a)}}catch{r.releaseLock()}}async function*qz(e,t){for await(const r of e)yield IL(r)}function Hz(e,t){if(typeof e=="string")return Fz(e,t);if(e instanceof ArrayBuffer)return jz(e,t);if(Bf(e))return Gz(e,t);if(LL(e))return EC(e,t);if(Lf(e))return EC(e.body,t);throw new Error("makeIterator")}const qL="Cannot convert supplied data type";function Wz(e,t,r){if(t.text&&typeof e=="string")return e;if(WF(e)&&(e=e.buffer),e instanceof ArrayBuffer){const i=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let i=e.buffer;const n=e.byteLength||e.length;return(e.byteOffset!==0||n!==i.byteLength)&&(i=i.slice(e.byteOffset,e.byteOffset+n)),i}throw new Error(qL)}async function $z(e,t,r){const i=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||i)return Wz(e,t);if(Bf(e)&&(e=await kL(e)),Lf(e)){const n=e;return await tz(n),t.binary?await n.arrayBuffer():await n.text()}if(LL(e)&&(e=Hz(e,r)),qF(e)||HF(e))return LF(e);throw new Error(qL)}function HL(e,t){const r=FL(),i=e||r;return typeof i.fetch=="function"?i.fetch:P0(i.fetch)?n=>gC(n,i):t!=null&&t.fetch?t==null?void 0:t.fetch:gC}function Zz(e,t,r){if(r)return r;const i={fetch:HL(t,e),...e};if(i.url){const n=iA(i.url);i.baseUrl=n,i.queryString=YF(i.url),i.filename=ML(n),i.baseUrl=rA(n)}return Array.isArray(i.loaders)||(i.loaders=null),i}function Jz(e,t){if(!t&&e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){const i=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...i]:i}return r&&r.length?r:null}async function lA(e,t,r,i){yu(!i||typeof i=="object"),t&&!Array.isArray(t)&&!oA(t)&&(i=void 0,r=t,t=void 0),e=await e,r=r||{};const n=ev(e),s=Jz(t,i),a=await Iz(e,s,r);return a?(r=bz(r,a,s,n),i=Zz({url:n,parse:lA,loaders:s},r,i||null),await Xz(a,e,r,i)):null}async function Xz(e,t,r,i){if(gF(e),Lf(t)){const n=t,{ok:s,redirected:a,status:o,statusText:f,type:m,url:w}=n,A=Object.fromEntries(n.headers.entries());i.response={headers:A,ok:s,redirected:a,status:o,statusText:f,type:m,url:w}}if(t=await $z(t,e,r),e.parseTextSync&&typeof t=="string")return r.dataType="text",e.parseTextSync(t,r,i,e);if(AF(e,r))return await SF(e,t,r,i,lA);if(e.parseText&&typeof t=="string")return await e.parseText(t,r,i,e);if(e.parse)return await e.parse(t,r,i,e);throw yu(!e.parseSync),new Error("".concat(e.id," loader - no parser found and worker is disabled"))}async function wd(e,t,r,i){!Array.isArray(t)&&!oA(t)&&(r=t,t=void 0);const n=HL(r);let s=e;return typeof e=="string"&&(s=await n(e)),Bf(e)&&(s=await n(e)),await lA(s,t,r)}const Kz="3.4.14",{_parseImageNode:Yz}=globalThis,Yw=typeof Image<"u",Qw=typeof ImageBitmap<"u",Qz=!!Yz,tx=tv?!0:Qz;function t7(e){switch(e){case"auto":return Qw||Yw||tx;case"imagebitmap":return Qw;case"image":return Yw;case"data":return tx;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}}function e7(){if(Qw)return"imagebitmap";if(Yw)return"image";if(tx)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function r7(e){const t=n7(e);if(!t)throw new Error("Not an image");return t}function i7(e){switch(r7(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function n7(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}const s7=/^data:image\/svg\+xml/,o7=/\.svg((\?|#).*)?$/;function cA(e){return e&&(s7.test(e)||o7.test(e))}function a7(e,t){if(cA(t)){let r=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(i){throw new Error(i.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return WL(e,t)}function WL(e,t){if(cA(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function $L(e,t,r){const i=a7(e,r),n=self.URL||self.webkitURL,s=typeof i!="string"&&n.createObjectURL(i);try{return await l7(s||i,t)}finally{s&&n.revokeObjectURL(s)}}async function l7(e,t){const r=new Image;return r.src=e,t.image&&t.image.decode&&r.decode?(await r.decode(),r):await new Promise((i,n)=>{try{r.onload=()=>i(r),r.onerror=s=>n(new Error("Could not load image ".concat(e,": ").concat(s)))}catch(s){n(s)}})}const c7={};let CC=!0;async function u7(e,t,r){let i;cA(r)?i=await $L(e,t,r):i=WL(e,r);const n=t&&t.imagebitmap;return await h7(i,n)}async function h7(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((d7(t)||!CC)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(r){console.warn(r),CC=!1}return await createImageBitmap(e)}function d7(e){for(const t in e||c7)return!1;return!0}function f7(e){return!y7(e,"ftyp",4)||!(e[8]&96)?null:p7(e)}function p7(e){switch(g7(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function g7(e,t,r){return String.fromCharCode(...e.slice(t,r))}function m7(e){return[...e].map(t=>t.charCodeAt(0))}function y7(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=m7(t);for(let n=0;n<i.length;++n)if(i[n]!==e[n+r])return!1;return!0}const au=!1,Dm=!0;function uA(e){const t=M0(e);return v7(t)||x7(t)||b7(t)||w7(t)||_7(t)}function _7(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),r=f7(t);return r?{mimeType:r.mimeType,width:0,height:0}:null}function v7(e){const t=M0(e);return t.byteLength>=24&&t.getUint32(0,au)===2303741511?{mimeType:"image/png",width:t.getUint32(16,au),height:t.getUint32(20,au)}:null}function b7(e){const t=M0(e);return t.byteLength>=10&&t.getUint32(0,au)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,Dm),height:t.getUint16(8,Dm)}:null}function w7(e){const t=M0(e);return t.byteLength>=14&&t.getUint16(0,au)===16973&&t.getUint32(2,Dm)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Dm),height:t.getUint32(22,Dm)}:null}function x7(e){const t=M0(e);if(!(t.byteLength>=3&&t.getUint16(0,au)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=A7();let n=2;for(;n+9<t.byteLength;){const s=t.getUint16(n,au);if(i.has(s))return{mimeType:"image/jpeg",height:t.getUint16(n+5,au),width:t.getUint16(n+7,au)};if(!r.has(s))return null;n+=2,n+=t.getUint16(n,au)}return null}function A7(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function M0(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function S7(e,t){const{mimeType:r}=uA(e)||{},i=globalThis._parseImageNode;return sn(i),await i(e,r)}async function E7(e,t,r){t=t||{};const i=(t.image||{}).type||"auto",{url:n}=r||{},s=C7(i);let a;switch(s){case"imagebitmap":a=await u7(e,t,n);break;case"image":a=await $L(e,t,n);break;case"data":a=await S7(e);break;default:sn(!1)}return i==="data"&&(a=i7(a)),a}function C7(e){switch(e){case"auto":case"data":return e7();default:return t7(e),e}}const T7=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],P7=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],I7={image:{type:"auto",decode:!0}},ZL={id:"image",module:"images",name:"Images",version:Kz,mimeTypes:P7,extensions:T7,parse:E7,tests:[e=>!!uA(new DataView(e))],options:I7},jb={};function M7(e){if(jb[e]===void 0){const t=tv?B7(e):L7(e);jb[e]=t}return jb[e]}function L7(e){const t=["image/png","image/jpeg","image/gif"],{_parseImageNode:r,_imageFormatsNode:i=t}=globalThis;return!!r&&i.includes(e)}function B7(e){switch(e){case"image/avif":case"image/webp":return k7(e);default:return!0}}function k7(e){try{return document.createElement("canvas").toDataURL(e).indexOf("data:".concat(e))===0}catch{return!1}}function JL(e){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,r=e||t;return!!(r&&r.indexOf("Electron")>=0)}function mh(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||JL()}const vy={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Ub=vy.window||vy.self||vy.global,L1=vy.process||{},XL=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";mh();const Gb=globalThis;function KL(e){if(!e&&!mh())return"Node";if(JL(e))return"Electron";const t=e||(typeof navigator<"u"?navigator:{}).userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";const r=t.indexOf("MSIE ")!==-1,i=t.indexOf("Trident/")!==-1;return r||i?"IE":Gb.chrome?"Chrome":Gb.safari?"Safari":Gb.mozInnerScreenX?"Firefox":"Unknown"}function R7(e){try{const t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch{return null}}class O7{constructor(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";$(this,"storage",void 0),$(this,"id",void 0),$(this,"config",void 0),this.storage=R7(i),this.id=t,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let t={};if(this.storage){const r=this.storage.getItem(this.id);t=r?JSON.parse(r):{}}return Object.assign(this.config,t),this}}function D7(e){let t;return e<10?t="".concat(e.toFixed(2),"ms"):e<100?t="".concat(e.toFixed(1),"ms"):e<1e3?t="".concat(e.toFixed(0),"ms"):t="".concat((e/1e3).toFixed(2),"s"),t}function N7(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const r=Math.max(t-e.length,0);return"".concat(" ".repeat(r)).concat(e)}function Vb(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const n=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>i&&(r=Math.min(r,i/e.width));const s=e.width*r,a=e.height*r,o=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(n,");"),"background-size:".concat(s,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),o]}let m_;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(m_||(m_={}));function TC(e){return typeof e=="string"?m_[e.toUpperCase()]||m_.WHITE:e}function F7(e,t,r){return!mh&&typeof e=="string"&&(t&&(t=TC(t),e="\x1B[".concat(t,"m").concat(e,"\x1B[39m")),r&&(t=TC(r),e="\x1B[".concat(r+10,"m").concat(e,"\x1B[49m"))),e}function z7(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const r=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(r);for(const n of i)typeof e[n]=="function"&&(t.find(s=>n===s)||(e[n]=e[n].bind(e)))}function y_(e,t){if(!e)throw new Error(t||"Assertion failed")}function rp(){let e;if(mh&&"performance"in Ub){var t,r;e=Ub==null||(t=Ub.performance)===null||t===void 0||(r=t.now)===null||r===void 0?void 0:r.call(t)}else if("hrtime"in L1){var i;const n=L1==null||(i=L1.hrtime)===null||i===void 0?void 0:i.call(L1);e=n[0]*1e3+n[1]/1e6}else e=Date.now();return e}const ip={debug:mh&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},j7={enabled:!0,level:0};function El(){}const PC={},IC={once:!0};class hA{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};$(this,"id",void 0),$(this,"VERSION",XL),$(this,"_startTs",rp()),$(this,"_deltaTs",rp()),$(this,"_storage",void 0),$(this,"userData",{}),$(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new O7("__probe-".concat(this.id,"__"),j7),this.timeStamp("".concat(this.id," started")),z7(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((rp()-this._startTs).toPrecision(10))}getDelta(){return Number((rp()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,r){this._storage.setConfiguration({[t]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,r){y_(t,r)}warn(t){return this._getLogFunction(0,t,ip.warn,arguments,IC)}error(t){return this._getLogFunction(0,t,ip.error,arguments)}deprecated(t,r){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(r,"` instead"))}removed(t,r){return this.error("`".concat(t,"` has been removed. Use `").concat(r,"` instead"))}probe(t,r){return this._getLogFunction(t,r,ip.log,arguments,{time:!0,once:!0})}log(t,r){return this._getLogFunction(t,r,ip.debug,arguments)}info(t,r){return this._getLogFunction(t,r,console.info,arguments)}once(t,r){for(var i=arguments.length,n=new Array(i>2?i-2:0),s=2;s<i;s++)n[s-2]=arguments[s];return this._getLogFunction(t,r,ip.debug||ip.info,arguments,IC)}table(t,r,i){return r?this._getLogFunction(t,r,console.table||El,i&&[i],{tag:q7(r)}):El}image(t){let{logLevel:r,priority:i,image:n,message:s="",scale:a=1}=t;return this._shouldLog(r||i)?mh?V7({image:n,message:s,scale:a}):G7():El}time(t,r){return this._getLogFunction(t,r,console.time?console.time:console.info)}timeEnd(t,r){return this._getLogFunction(t,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,r){return this._getLogFunction(t,r,console.timeStamp||El)}group(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const n=MC({logLevel:t,message:r,opts:i}),{collapsed:s}=i;return n.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,r,Object.assign({},i,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||El)}withGroup(t,r,i){this.group(t,r)();try{i()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=YL(t)}_getLogFunction(t,r,i,n,s){if(this._shouldLog(t)){s=MC({logLevel:t,message:r,args:n,opts:s}),i=i||s.method,y_(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=rp();const a=s.tag||s.message;if(s.once)if(!PC[a])PC[a]=rp();else return El;return r=U7(this.id,s.message,s),i.bind(console,r,...s.args)}return El}}$(hA,"VERSION",XL);function YL(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return y_(Number.isFinite(t)&&t>=0),t}function MC(e){const{logLevel:t,message:r}=e;e.logLevel=YL(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==r;);switch(typeof t){case"string":case"function":r!==void 0&&i.unshift(r),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const n=typeof e.message;return y_(n==="string"||n==="object"),Object.assign(e,{args:i},e.opts)}function U7(e,t,r){if(typeof t=="string"){const i=r.time?N7(D7(r.total)):"";t=r.time?"".concat(e,": ").concat(i,"  ").concat(t):"".concat(e,": ").concat(t),t=F7(t,r.color,r.background)}return t}function G7(e){return console.warn("removed"),El}function V7(e){let{image:t,message:r="",scale:i=1}=e;if(typeof t=="string"){const s=new Image;return s.onload=()=>{const a=Vb(s,r,i);console.log(...a)},s.src=t,El}const n=t.nodeName||"";if(n.toLowerCase()==="img")return console.log(...Vb(t,r,i)),El;if(n.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Vb(s,r,i)),s.src=t.toDataURL(),El}return El}function q7(e){for(const t in e)for(const r in e[t])return r||"untitled";return"empty"}const xi=new hA({id:"deck"}),Uh={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},qb=1,em=2,Hb=3,Wb=4,H7=2,W7=e=>({"layer.changeFlag":(t,r,i)=>{e.log(Hb,"".concat(t.id," ").concat(r,": "),i[r])()},"layer.initialize":t=>{e.log(qb,"Initializing ".concat(t))()},"layer.update":(t,r)=>{if(r){const i=t.getChangeFlags();e.log(em,"Updating ".concat(t," because: ").concat(Object.keys(i).filter(n=>i[n]).join(", ")))()}else e.log(Wb,"".concat(t," does not need update"))()},"layer.matched":(t,r)=>{r&&e.log(Wb,"Matched ".concat(t,", state transfered"))()},"layer.finalize":t=>{e.log(qb,"Finalizing ".concat(t))()},"compositeLayer.renderLayers":(t,r,i)=>{r?e.log(em,"Composite layer rendered new subLayers ".concat(t),i)():e.log(Wb,"Composite layer reused subLayers ".concat(t),i)()},"layerManager.setLayers":(t,r,i)=>{r&&e.log(em,"Updating ".concat(i.length," deck layers"))()},"layerManager.activateViewport":(t,r)=>{e.log(Hb,"Viewport changed",r)()},"attributeManager.invalidate":(t,r,i)=>{e.log(qb,i?"invalidated attributes ".concat(i," (").concat(r,") for ").concat(t.id):"invalidated all attributes for ".concat(t.id))()},"attributeManager.updateStart":t=>{Uh.attributeUpdateMessages.length=0,Uh.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(t,r)=>{const i=Math.round(Date.now()-Uh.attributeManagerUpdateStart);e.groupCollapsed(em,"Updated attributes for ".concat(r," instances in ").concat(t.id," in ").concat(i,"ms"))();for(const n of Uh.attributeUpdateMessages)e.log(Hb,n)();e.groupEnd(em)()},"attribute.updateStart":t=>{Uh.attributeUpdateStart=Date.now()},"attribute.allocate":(t,r)=>{const i="".concat(t.id," allocated ").concat(r);Uh.attributeUpdateMessages.push(i)},"attribute.updateEnd":(t,r)=>{const i=Math.round(Date.now()-Uh.attributeUpdateStart),n="".concat(t.id," updated ").concat(r," in ").concat(i,"ms");Uh.attributeUpdateMessages.push(n)},"deckRenderer.renderLayers":(t,r,i)=>{const{pass:n,redrawReason:s,stats:a}=i;for(const o of r){const{totalCount:f,visibleCount:m,compositeCount:w,pickableCount:A}=o,P=f-w-m;e.log(H7,"RENDER #".concat(t.renderCount,"   ").concat(m," (of ").concat(f," layers) to ").concat(n," because ").concat(s,"   (").concat(P," hidden, ").concat(w," composite ").concat(A," pickable)"))(),a&&a.get("Redraw Layers").add(m)}}});var $7={};let __={};$7.NODE_ENV!=="production"&&(__=W7(xi));function Z7(e){__=e}function wo(e,t,r,i){xi.level>0&&__[e]&&__[e].call(null,t,r,i)}function J7(e){const t=e[0],r=e[e.length-1];return t==="{"&&r==="}"||t==="["&&r==="]"}const X7={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:J7,parseTextSync:JSON.parse};function K7(){const e="8.9.35",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error("deck.gl - multiple versions detected: ".concat(t," vs ").concat(e));return t||(xi.log(1,"deck.gl ".concat(e))(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:xi,_registerLoggers:Z7},Ez([X7,[ZL,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}const Y7=K7(),vi={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(vi,"IDENTITY",{get:()=>(xi.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const cu={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ex={common:0,meters:1,pixels:2},LC={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},hr=new hA({id:"luma.gl"});function $o(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}const Q7="Invalid WebGLRenderingContext",t9="Requires WebGL2";function rv(e){return typeof WebGLRenderingContext<"u"&&e instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&Number.isFinite(e._version))}function ni(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}function e9(e){return ni(e)?e:null}function iv(e){return $o(rv(e),Q7),e}function Zo(e){return $o(ni(e),t9),e}const wm={};function r9(e){globalThis.console&&globalThis.console.error&&globalThis.console.error(e)}function i9(e){globalThis.console&&globalThis.console.log&&globalThis.console.log(e)}function n9(e,t){wm[e]=!0,t!==void 0&&r9(t)}function s9(e){const t=e.getError;e.getError=function(){let r;do r=t.apply(e),r!==0&&(wm[r]=!0);while(r!==0);for(r in wm)if(wm[r])return delete wm[r],parseInt(r,10);return 0}}const L0=function e(t){const r=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const n=new e.VertexAttrib(r);this.attribs[i]=n}this.maxAttrib=0};L0.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};L0.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const kf=function(e){const t=this;this.gl=e,s9(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(i){return i===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(i){const n=t.currentVertexArrayObject;n.maxAttrib=Math.max(n.maxAttrib,i);const s=n.attribs[i];return s.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(i){const n=t.currentVertexArrayObject;n.maxAttrib=Math.max(n.maxAttrib,i);const s=n.attribs[i];return s.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(i,n){switch(i){case 34962:t.currentArrayBuffer=n;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=n;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(i,n){const s=t.currentVertexArrayObject.attribs[i];switch(n){case 34975:return s.buffer;case 34338:return s.enabled;case 34339:return s.size;case 34340:return s.stride;case 34341:return s.type;case 34922:return s.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(i,n,s,a,o,f){const m=t.currentVertexArrayObject;m.maxAttrib=Math.max(m.maxAttrib,i);const w=m.attribs[i];return w.buffer=t.currentArrayBuffer,w.size=n,w.type=s,w.normalized=a,w.stride=o,w.offset=f,w.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{i9("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};kf.prototype.VERTEX_ARRAY_BINDING_OES=34229;kf.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;const e=this.gl;this.maxVertexAttribs=e.getParameter(34921),this.defaultVertexArrayObject=new L0(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};kf.prototype.createVertexArrayOES=function(){const e=new L0(this);return this.vertexArrayObjects.push(e),e};kf.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};kf.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof L0&&e.hasBeenBound&&e.ext===this)};kf.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive){n9(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const n=this.currentVertexArrayObject;if(i===n)return;(!i||n.elementArrayBuffer!==i.elementArrayBuffer)&&r.bindBuffer.call(t,34963,n.elementArrayBuffer);let s=this.currentArrayBuffer;const a=Math.max(i?i.maxAttrib:0,n.maxAttrib);for(let o=0;o<=a;o++){const f=n.attribs[o],m=i?i.attribs[o]:null;if((!i||f.enabled!==m.enabled)&&(f.enabled?r.enableVertexAttribArray.call(t,o):r.disableVertexAttribArray.call(t,o)),f.enabled){let w=!1;(!i||f.buffer!==m.buffer)&&(s!==f.buffer&&(r.bindBuffer.call(t,34962,f.buffer),s=f.buffer),w=!0),(w||f.cached!==m.cached)&&r.vertexAttribPointer.call(t,o,f.size,f.type,f.normalized,f.stride,f.offset)}}this.currentArrayBuffer!==s&&r.bindBuffer.call(t,34962,this.currentArrayBuffer)};function o9(e){if(typeof e.createVertexArray=="function")return;const t=e.getSupportedExtensions;e.getSupportedExtensions=function(){const i=t.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};const r=e.getExtension;e.getExtension=function(i){return r.call(this,i)||(i!=="OES_vertex_array_object"?null:(e.__OESVertexArrayObject||(this.__OESVertexArrayObject=new kf(this)),this.__OESVertexArrayObject))}}const BC="OES_element_index",kC="WEBGL_draw_buffers",a9="EXT_disjoint_timer_query",l9="EXT_disjoint_timer_query_webgl2",c9="EXT_texture_filter_anisotropic",RC="WEBGL_debug_renderer_info",u9=35723,h9=4352,d9=36795,f9=34047,p9=37445,g9=37446,an=e=>ni(e)?void 0:0,m9={3074:e=>ni(e)?void 0:36064,[u9]:e=>ni(e)?void 0:h9,35977:an,32937:an,[d9]:(e,t)=>{const r=ni(e)?e.getExtension(l9):e.getExtension(a9);return r&&r.GPU_DISJOINT_EXT?t(r.GPU_DISJOINT_EXT):0},[p9]:(e,t)=>{const r=e.getExtension(RC);return t(r&&r.UNMASKED_VENDOR_WEBGL||7936)},[g9]:(e,t)=>{const r=e.getExtension(RC);return t(r&&r.UNMASKED_RENDERER_WEBGL||7937)},[f9]:(e,t)=>{const r=e.luma.extensions[c9];return r?t(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:an,35071:an,37447:an,36063:(e,t)=>{if(!ni(e)){const r=e.getExtension(kC);return r?t(r.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:an,35374:an,35377:an,34852:e=>{if(!ni(e)){const t=e.getExtension(kC);return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},36203:e=>e.getExtension(BC)?2147483647:65535,33001:e=>e.getExtension(BC)?16777216:65535,33e3:e=>16777216,37157:an,35373:an,35657:an,36183:an,37137:an,34045:an,35978:an,35979:an,35968:an,35376:an,35375:an,35659:an,37154:an,35371:an,35658:an,35076:an,35077:an,35380:an};function y9(e,t,r){const i=m9[r],n=typeof i=="function"?i(e,t,r):i;return n!==void 0?n:t(r)}const _9="OES_vertex_array_object",QL="ANGLE_instanced_arrays",v9="WEBGL_draw_buffers",b9="EXT_disjoint_timer_query",w9="EXT_texture_filter_anisotropic",x9="VertexArray requires WebGL2 or OES_vertex_array_object extension";function A9(e,t){return{webgl2:ni(e),ext:e.getExtension(t)}}const tB={[_9]:{meta:{suffix:"OES"},createVertexArray:()=>{$o(!1,x9)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[QL]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(e,t){$o(t===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[v9]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{$o(!1)}},[b9]:{meta:{suffix:"EXT"},createQuery:()=>{$o(!1)},deleteQuery:()=>{$o(!1)},beginQuery:()=>{$o(!1)},endQuery:()=>{},getQuery(e,t){return this.getQueryObject(e,t)},getQueryParameter(e,t){return this.getQueryObject(e,t)},getQueryObject:()=>{}}},$b={readBuffer:(e,t,r)=>{ni(e)&&t(r)},getVertexAttrib:(e,t,r,i)=>{const{webgl2:n,ext:s}=A9(e,QL);let a;switch(i){case 35069:a=n?void 0:!1;break;case 35070:a=!n&&!s?0:void 0;break}return a!==void 0?a:t(r,i)},getProgramParameter:(e,t,r,i)=>{if(!ni(e))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return t(r,i)},getInternalformatParameter:(e,t,r,i,n)=>{if(!ni(e))switch(n){case 32937:return new Int32Array([0])}return e.getInternalformatParameter(r,i,n)},getTexParameter(e,t,r,i){switch(i){case 34046:const{extensions:n}=e.luma,s=n[w9];i=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return t(r,i)},getParameter:y9,hint(e,t,r,i){return t(r,i)}};function S9(e){e.luma=e.luma||{};const{luma:t}=e;return t.polyfilled||(o9(e),E9(e),T9(e,tB),C9(e,{target:t,target2:e}),t.polyfilled=!0),e}globalThis.polyfillContext=S9;function E9(e){e.luma.extensions={};const t=e.getSupportedExtensions()||[];for(const r of t)e.luma[r]=e.getExtension(r)}function C9(e,t){let{target:r,target2:i}=t;Object.keys($b).forEach(n=>{if(typeof $b[n]=="function"){const s=e[n]?e[n].bind(e):()=>{},a=$b[n].bind(null,e,s);r[n]=a,i[n]=a}})}function T9(e,t){for(const r of Object.getOwnPropertyNames(t))r!=="overrides"&&P9(e,{extension:r,target:e.luma,target2:e})}function P9(e,t){let{extension:r,target:i,target2:n}=t;const s=tB[r];$o(s);const{meta:a={}}=s,{suffix:o=""}=a,f=e.getExtension(r);for(const m of Object.keys(s)){const w="".concat(m).concat(o);let A=null;m==="meta"||typeof e[m]=="function"||(f&&typeof f[w]=="function"?A=function(){return f[w](...arguments)}:typeof s[m]=="function"&&(A=s[m].bind(i))),A&&(i[m]=A,n[m]=A)}}const dA={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Gh=(e,t,r)=>t?e.enable(r):e.disable(r),OC=(e,t,r)=>e.hint(r,t),Na=(e,t,r)=>e.pixelStorei(r,t),I9=(e,t)=>{const r=ni(e)?36009:36160;return e.bindFramebuffer(r,t)},M9=(e,t)=>e.bindFramebuffer(36008,t);function rm(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const L9={3042:Gh,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:Gh,2885:(e,t)=>e.cullFace(t),2929:Gh,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:Gh,35723:OC,36006:I9,2886:(e,t)=>e.frontFace(t),33170:OC,2849:(e,t)=>e.lineWidth(t),32823:Gh,32824:"polygonOffset",10752:"polygonOffset",35977:Gh,32938:"sampleCoverage",32939:"sampleCoverage",3089:Gh,3088:(e,t)=>e.scissor(...t),2960:Gh,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),3333:Na,3317:Na,37440:Na,37441:Na,37443:Na,3330:Na,3332:Na,3331:Na,36010:M9,3314:Na,32878:Na,3316:Na,3315:Na,32877:Na,framebuffer:(e,t)=>{const r=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,r)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{t=rm(t)?t:[t,t],e.blendEquationSeparate(...t)},blendFunc:(e,t)=>{t=rm(t)&&t.length===2?[...t,...t]:t,e.blendFuncSeparate(...t)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=rm(t)?t:[t,t];const[r,i]=t;e.stencilMaskSeparate(1028,r),e.stencilMaskSeparate(1029,i)},stencilFunc:(e,t)=>{t=rm(t)&&t.length===3?[...t,...t]:t;const[r,i,n,s,a,o]=t;e.stencilFuncSeparate(1028,r,i,n),e.stencilFuncSeparate(1029,s,a,o)},stencilOp:(e,t)=>{t=rm(t)&&t.length===3?[...t,...t]:t;const[r,i,n,s,a,o]=t;e.stencilOpSeparate(1028,r,i,n),e.stencilOpSeparate(1029,s,a,o)},viewport:(e,t)=>e.viewport(...t)};function Gn(e,t,r){return t[e]!==void 0?t[e]:r[e]}const B9={blendEquation:(e,t,r)=>e.blendEquationSeparate(Gn(32777,t,r),Gn(34877,t,r)),blendFunc:(e,t,r)=>e.blendFuncSeparate(Gn(32969,t,r),Gn(32968,t,r),Gn(32971,t,r),Gn(32970,t,r)),polygonOffset:(e,t,r)=>e.polygonOffset(Gn(32824,t,r),Gn(10752,t,r)),sampleCoverage:(e,t,r)=>e.sampleCoverage(Gn(32938,t,r),Gn(32939,t,r)),stencilFuncFront:(e,t,r)=>e.stencilFuncSeparate(1028,Gn(2962,t,r),Gn(2967,t,r),Gn(2963,t,r)),stencilFuncBack:(e,t,r)=>e.stencilFuncSeparate(1029,Gn(34816,t,r),Gn(36003,t,r),Gn(36004,t,r)),stencilOpFront:(e,t,r)=>e.stencilOpSeparate(1028,Gn(2964,t,r),Gn(2965,t,r),Gn(2966,t,r)),stencilOpBack:(e,t,r)=>e.stencilOpSeparate(1029,Gn(34817,t,r),Gn(34818,t,r),Gn(34819,t,r))},DC={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,r)=>e({[t]:r}),hint:(e,t,r)=>e({[t]:r}),bindFramebuffer:(e,t,r)=>{switch(t){case 36160:return e({36006:r,36010:r});case 36009:return e({36006:r});case 36008:return e({36010:r});default:return null}},blendColor:(e,t,r,i,n)=>e({32773:new Float32Array([t,r,i,n])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,r)=>e({32777:t,34877:r}),blendFunc:(e,t,r)=>e({32969:t,32968:r,32971:t,32970:r}),blendFuncSeparate:(e,t,r,i,n)=>e({32969:t,32968:r,32971:i,32970:n}),clearColor:(e,t,r,i,n)=>e({3106:new Float32Array([t,r,i,n])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,r,i,n)=>e({3107:[t,r,i,n]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,r)=>e({2928:new Float32Array([t,r])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,r)=>e({32824:t,10752:r}),sampleCoverage:(e,t,r)=>e({32938:t,32939:r}),scissor:(e,t,r,i,n)=>e({3088:new Int32Array([t,r,i,n])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,r)=>e({[t===1028?2968:36005]:r}),stencilFunc:(e,t,r,i)=>e({2962:t,2967:r,2963:i,34816:t,36003:r,36004:i}),stencilFuncSeparate:(e,t,r,i,n)=>e({[t===1028?2962:34816]:r,[t===1028?2967:36003]:i,[t===1028?2963:36004]:n}),stencilOp:(e,t,r,i)=>e({2964:t,2965:r,2966:i,34817:t,34818:r,34819:i}),stencilOpSeparate:(e,t,r,i,n)=>e({[t===1028?2964:34817]:r,[t===1028?2965:34818]:i,[t===1028?2966:34819]:n}),viewport:(e,t,r,i,n)=>e({2978:[t,r,i,n]})},tu=(e,t)=>e.isEnabled(t),NC={3042:tu,2884:tu,2929:tu,3024:tu,32823:tu,32926:tu,32928:tu,3089:tu,2960:tu,35977:tu};function eB(e){for(const t in e)return!1;return!0}function k9(e,t){if(e===t)return!0;const r=Array.isArray(e)||ArrayBuffer.isView(e),i=Array.isArray(t)||ArrayBuffer.isView(t);if(r&&i&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}function FC(e,t){const r=e[t].bind(e);e[t]=function(){const i=arguments.length<=0?void 0:arguments[0];return i in e.state.cache?e.state.enable?e.state.cache[i]:r(...arguments):r(...arguments)},Object.defineProperty(e[t],"name",{value:"".concat(t,"-from-cache"),configurable:!1})}function R9(e,t,r){const i=e[t].bind(e);e[t]=function(){for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];const{valueChanged:o,oldValue:f}=r(e.state._updateCache,...s);return o&&i(...s),f},Object.defineProperty(e[t],"name",{value:"".concat(t,"-to-cache"),configurable:!1})}function O9(e){const t=e.useProgram.bind(e);e.useProgram=function(r){e.state.program!==r&&(t(r),e.state.program=r)}}class D9{constructor(t){let{copyState:r=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=r?F9(t):Object.assign({},dA),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){$o(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];dh(this.gl,t),this.stateStack.pop()}_updateCache(t){let r=!1,i;const n=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in t){$o(s!==void 0);const a=t[s],o=this.cache[s];k9(a,o)||(r=!0,i=o,n&&!(s in n)&&(n[s]=o),this.cache[s]=a)}return{valueChanged:r,oldValue:i}}}function rB(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:r=!0,copyState:i}=t;if($o(i!==void 0),!e.state){const{polyfillContext:n}=globalThis;n&&n(e),e.state=new D9(e,{copyState:i}),O9(e);for(const s in DC){const a=DC[s];R9(e,s,a)}FC(e,"getParameter"),FC(e,"isEnabled")}return e.state.enable=r,e}function N9(e){e.state||rB(e,{copyState:!1}),e.state.push()}function zC(e){$o(e.state),e.state.pop()}function dh(e,t){if($o(rv(e),"setParameters requires a WebGL context"),eB(t))return;const r={};for(const n in t){const s=Number(n),a=L9[n];a&&(typeof a=="string"?r[a]=!0:a(e,t[n],s))}const i=e.state&&e.state.cache;if(i)for(const n in r){const s=B9[n];s(e,t,i)}}function F9(e,t){if(t=t||dA,typeof t=="number"){const n=t,s=NC[n];return s?s(e,n):e.getParameter(n)}const r=Array.isArray(t)?t:Object.keys(t),i={};for(const n of r){const s=NC[n];i[n]=s?s(e,Number(n)):e.getParameter(Number(n))}return i}function z9(e){dh(e,dA)}function Tc(e,t,r){if(eB(t))return r(e);const{nocatch:i=!0}=t;N9(e),dh(e,t);let n;if(i)n=r(e),zC(e);else try{n=r(e)}finally{zC(e)}return n}function og(e){const{luma:t}=e;if(e.canvas&&t){const r=t.canvasSizeInfo,i="clientWidth"in r?r.clientWidth:e.canvas.clientWidth;return i?e.drawingBufferWidth/i:1}return 1}function Zb(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=og(e),n=e.drawingBufferWidth,s=e.drawingBufferHeight;return U9(t,i,n,s,r)}function j9(e){const t=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(e)?e<=0?1:e:e?t:1}function U9(e,t,r,i,n){const s=jC(e[0],t,r);let a=UC(e[1],t,i,n),o=jC(e[0]+1,t,r);const f=o===r-1?o:o-1;o=UC(e[1]+1,t,i,n);let m;return n?(o=o===0?o:o+1,m=a,a=o):m=o===i-1?o:o-1,{x:s,y:a,width:Math.max(f-s+1,1),height:Math.max(m-a+1,1)}}function jC(e,t,r){return Math.min(Math.round(e*t),r-1)}function UC(e,t,r,i){return i?Math.max(0,r-1-Math.round(e*t)):Math.min(Math.round(e*t),r-1)}const fA=mh(),G9=fA&&typeof document<"u",iB={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function nB(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$o(fA,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),e=Object.assign({},iB,e);const{width:t,height:r}=e;function i(o){if(e.throwOnError)throw new Error(o);return console.error(o),null}e.onError=i;let n;const{canvas:s}=e,a=W9({canvas:s,width:t,height:r,onError:i});return n=H9(a,e),n?(n=pA(n,e),$9(n),n):null}function pA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!e||e._instrumented)return e;e._version=e._version||Z9(e),e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{},t=Object.assign({},iB,t);const{manageState:r,debug:i}=t;return r&&rB(e,{copyState:!1,log:function(){for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return hr.log(1,...s)()}}),fA&&i&&(globalThis.makeDebugContext?(e=globalThis.makeDebugContext(e,t),hr.level=Math.max(hr.level,1)):hr.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),e._instrumented=!0,e}function V9(e){const t=e.getParameter(7936),r=e.getParameter(7937),i=e.getExtension("WEBGL_debug_renderer_info"),n=i&&e.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),s=i&&e.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:n||t,renderer:s||r,vendorMasked:t,rendererMasked:r,version:e.getParameter(7938),shadingLanguageVersion:e.getParameter(35724)}}function q9(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.canvas){const i=j9(t.useDevicePixels);J9(e,i,t);return}const r=e.getExtension("STACKGL_resize_drawingbuffer");r&&"width"in t&&"height"in t&&r.resize(t.width,t.height)}function H9(e,t){const{onError:r}=t;let i=null;const n=f=>i=f.statusMessage||i;e.addEventListener("webglcontextcreationerror",n,!1);const{webgl1:s=!0,webgl2:a=!0}=t;let o=null;return a&&(o=o||e.getContext("webgl2",t),o=o||e.getContext("experimental-webgl2",t)),s&&(o=o||e.getContext("webgl",t),o=o||e.getContext("experimental-webgl",t)),e.removeEventListener("webglcontextcreationerror",n,!1),o?(t.onContextLost&&e.addEventListener("webglcontextlost",t.onContextLost,!1),t.onContextRestored&&e.addEventListener("webglcontextrestored",t.onContextRestored,!1),o):r("Failed to create ".concat(a&&!s?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function W9(e){let{canvas:t,width:r=800,height:i=600,onError:n}=e,s;return typeof t=="string"?(G9&&document.readyState==="complete"||n("createGLContext called on canvas '".concat(t,"' before page was loaded")),s=document.getElementById(t)):t?s=t:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(r)?"".concat(r,"px"):"100%",s.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function $9(e){const t=ni(e)?"WebGL2":"WebGL1",r=V9(e),i=r?"(".concat(r.vendor,",").concat(r.renderer,")"):"",n=e.debug?" debug":"";hr.info(1,"".concat(t).concat(n," context ").concat(i))()}function Z9(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?2:1}function J9(e,t,r){let i="width"in r?r.width:e.canvas.clientWidth,n="height"in r?r.height:e.canvas.clientHeight;(!i||!n)&&(hr.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,i=e.canvas.width||1,n=e.canvas.height||1),e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{};const s=e.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==n||s.devicePixelRatio!==t){let a=t;const o=Math.floor(i*a),f=Math.floor(n*a);e.canvas.width=o,e.canvas.height=f,(e.drawingBufferWidth!==o||e.drawingBufferHeight!==f)&&(hr.warn("Device pixel ratio clamped")(),a=Math.min(e.drawingBufferWidth/i,e.drawingBufferHeight/n),e.canvas.width=Math.floor(i*a),e.canvas.height=Math.floor(n*a)),Object.assign(e.luma.canvasSizeInfo,{clientWidth:i,clientHeight:n,devicePixelRatio:t})}}function GC(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}let VC=class{constructor(e,t){$(this,"name",void 0),$(this,"type",void 0),$(this,"sampleSize",1),$(this,"time",void 0),$(this,"count",void 0),$(this,"samples",void 0),$(this,"lastTiming",void 0),$(this,"lastSampleTime",void 0),$(this,"lastSampleCount",void 0),$(this,"_count",0),$(this,"_time",0),$(this,"_samples",0),$(this,"_startTime",0),$(this,"_timerPending",!1),this.name=e,this.type=t,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=GC(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(GC()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},gA=class{constructor(e){$(this,"id",void 0),$(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t])}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(e){if(!e||!e.name)return null;const{name:t,type:r}=e;return this.stats[t]||(e instanceof VC?this.stats[t]=e:this.stats[t]=new VC(t,r)),this.stats[t]}};const Nm="8.5.21",X9="set luma.log.level=1 (or higher) to trace rendering";class K9{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new gA({id:t})),this.stats.get(t)}}const hf=new K9;if(globalThis.luma&&globalThis.luma.VERSION!==Nm)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Nm));globalThis.luma||(mh()&&hr.log(1,"luma.gl ".concat(Nm," - ").concat(X9))(),globalThis.luma=globalThis.luma||{VERSION:Nm,version:Nm,log:hr,stats:hf,globals:{modules:{},nodeIO:{}}});function Y9(e){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function Q9(e){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}function rr(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}function Jb(e,t){if(typeof t!="string")return t;const r=Number(t);if(!isNaN(r))return r;t=t.replace(/^.*\./,"");const i=e[t];return rr(i!==void 0,"Accessing undefined constant GL.".concat(t)),i}function md(e,t){t=Number(t);for(const r in e)if(e[r]===t)return"GL.".concat(r);return String(t)}const Xb={};function fh(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Xb[e]=Xb[e]||1;const t=Xb[e]++;return"".concat(e,"-").concat(t)}function qC(e){return rr(typeof e=="number","Input must be a number"),e&&(e&e-1)===0}function ag(e){let t=!0;for(const r in e){t=!1;break}return t}function sB(e,t,r,i){const n="See luma.gl ".concat(r," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(e);i.forEach(a=>{s.methodName||(s[a]=()=>{throw hr.removed("Calling removed method ".concat(t,".").concat(a,": "),n)(),new Error(a)})})}const np="Resource subclass must define virtual methods";let yh=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};iv(e);const{id:r,userData:i={}}=t;this.gl=e,this.gl2=e,this.id=r||fh(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=t.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Jb(this.gl,e),rr(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const i=ni(this.gl);if(!((!("webgl2"in r)||i)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const n=r.webgl1,s="webgl2"in r?r.webgl2:r.webgl1;return i?s:n}}return this._getParameter(e,t)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:t,keys:r}=e,i=this.constructor.PARAMETERS||{},n=ni(this.gl),s={},a=t||Object.keys(i);for(const o of a){const f=i[o];if(f&&(!("webgl2"in f)||n)&&(!("extension"in f)||this.gl.getExtension(f.extension))){const m=r?md(this.gl,o):o;s[m]=this.getParameter(o,e),r&&f.type==="GLenum"&&(s[m]=md(this.gl,s[m]))}}return s}setParameter(e,t){e=Jb(this.gl,e),rr(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const i=ni(this.gl);if(!((!("webgl2"in r)||i)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");r.type==="GLenum"&&(t=Jb(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,r){return sB(this,e,t,r)}initialize(e){}_createHandle(){throw new Error(np)}_deleteHandle(){throw new Error(np)}_bindHandle(e){throw new Error(np)}_getOptsFromHandle(){throw new Error(np)}_getParameter(e,t){throw new Error(np)}_setParameter(e,t){throw new Error(np)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],t=hf.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(e,"s Created")).incrementCount(),t.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];hf.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,t),this._trackAllocatedMemoryForContext(e,t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const i=hf.get("Memory Usage".concat(r));i.get("GPU Memory").addCount(e),i.get("".concat(t," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=hf.get("Memory Usage".concat(t));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const tj="Failed to deduce GL constant from typed array";function rx(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(tj)}}function l0(e){let{clamped:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function ej(e){let{data:t,width:r,height:i,bytesPerPixel:n=4,temp:s}=e;const a=r*n;s=s||new Uint8Array(a);for(let o=0;o<i/2;++o){const f=o*a,m=(i-o-1)*a;s.set(t.subarray(f,f+a)),t.copyWithin(f,m,m+a),t.set(s,m)}}function rj(e){let{data:t,width:r,height:i}=e;const n=Math.round(r/2),s=Math.round(i/2),a=new Uint8Array(n*s*4);for(let o=0;o<s;o++)for(let f=0;f<n;f++)for(let m=0;m<4;m++)a[(o*n+f)*4+m]=t[(o*2*r+f*2)*4+m];return{data:a,width:n,height:s}}function ix(e,t,r){const{removedProps:i={},deprecatedProps:n={},replacedProps:s={}}=r;for(const o in i)if(o in t){const f=i[o]?"".concat(e,".").concat(i[o]):"N/A";hr.removed("".concat(e,".").concat(o),f)()}for(const o in n)if(o in t){const f=n[o];hr.deprecated("".concat(e,".").concat(o),"".concat(e,".").concat(f))()}let a=null;for(const o in s)if(o in t){const f=s[o];hr.deprecated("".concat(e,".").concat(o),"".concat(e,".").concat(f))(),a=a||Object.assign({},t),a[f]=t[o],delete a[o]}return a||t}const ij={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},nj={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class ga{static getBytesPerElement(t){return l0(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return rr(t.size),l0(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return new ga(ij,...r)}constructor(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];r.forEach(n=>this._assign(n)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return ga.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return ga.getBytesPerVertex(this)}_assign(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t=ix("Accessor",t,nj),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this}}const HC=10,oB={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},sj={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:oB},oj={removedProps:oB};let Ki=class extends yh{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ga.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ga.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=ix("Buffer",e,sj),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=ix("Buffer",e,oj),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new ga(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:r=0,srcOffset:i=0}=e,n=e.byteLength||e.length;rr(t);const s=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(s,this.handle),i!==0||n!==void 0?(Zo(this.gl),this.gl.bufferSubData(this.target,r,t,i,n)):this.gl.bufferSubData(s,r,t),this.gl.bindBuffer(s,null),this.debugData=null,this._inferType(t),this}copyData(e){let{sourceBuffer:t,readOffset:r=0,writeOffset:i=0,size:n}=e;const{gl:s}=this;return Zo(s),s.bindBuffer(36662,t.handle),s.bindBuffer(36663,this.handle),s.copyBufferSubData(36662,36663,r,i,n),s.bindBuffer(36662,null),s.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:t=0,dstOffset:r=0,length:i=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Zo(this.gl);const n=l0(this.accessor.type||5126,{clamped:!1}),s=this._getAvailableElementCount(t),a=r;let o,f;e?(f=e.length,o=f-a):(o=Math.min(s,i||s),f=a+o);const m=Math.min(s,o);return i=i||m,rr(i<=m),e=e||new n(f),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,e,r,i),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:r=0,size:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?i!==void 0?this.gl.bindBufferRange(e,t,this.handle,r,i):(rr(r===0),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(HC,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+t;rr(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.usage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.debugData=e.slice(0,HC),this.bytesUsed=r,this._trackAllocatedMemory(r);const n=rx(e);return rr(n),this.setAccessor(new ga(this.accessor,{type:n})),this}_setByteLength(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;rr(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,t),this.gl.bindBuffer(i,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const t=l0(this.accessor.type||5126,{clamped:!1}),r=e/t.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new ga(this.accessor,{type:rx(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return hr.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return hr.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return hr.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return hr.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new ga(this.accessor,e),this}};const mA={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},aB={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},lB={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function aj(e,t){const r=mA[t];if(!r)return!1;if(r.gl1===void 0&&r.gl2===void 0)return!0;const i=ni(e)&&r.gl2||r.gl1;return typeof i=="string"?e.getExtension(i):i}function lj(e,t){const r=mA[t];switch(r&&r.types[0]){case 5126:return e.getExtension("OES_texture_float_linear");case 5131:return e.getExtension("OES_texture_half_float_linear");default:return!0}}const cj=[9729,9728],WC=globalThis.WebGLBuffer||function(){};class lg extends yh{get[Symbol.toStringTag](){return"Texture"}static isSupported(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:n}=r;let s=!0;return i&&(s=s&&aj(t,i),s=s&&(!n||lj(t,i))),s}constructor(t,r){const{id:i=fh("texture"),handle:n,target:s}=r;super(t,{id:i,handle:n}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.data;if(r instanceof Promise)return r.then(z=>this.initialize(Object.assign({},t,{pixels:z,data:z}))),this;const i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(i&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(t)),this;const{pixels:n=null,format:s=6408,border:a=0,recreate:o=!1,parameters:f={},pixelStore:m={},textureUnit:w=void 0}=t;r||(r=n);let{width:A,height:P,dataFormat:I,type:N,compressed:F=!1,mipmaps:Z=!0}=t;const{depth:U=0}=t;return{width:A,height:P,compressed:F,dataFormat:I,type:N}=this._deduceParameters({format:s,type:N,dataFormat:I,compressed:F,data:r,width:A,height:P}),this.width=A,this.height=P,this.depth=U,this.format=s,this.type=N,this.dataFormat=I,this.border=a,this.textureUnit=w,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),Z&&this._isNPOT()&&(hr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),Z=!1,this._updateForNPOT(f)),this.mipmaps=Z,this.setImageData({data:r,width:A,height:P,depth:U,format:s,type:N,dataFormat:I,border:a,mipmaps:Z,parameters:m,compressed:F}),Z&&this.generateMipmap(),this.setParameters(f),o&&(this.data=r),i&&(this._video={video:r,parameters:f,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:r,lastTime:i}=this._video;if(i===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize(t){let{height:r,width:i,mipmaps:n=!1}=t;return i!==this.width||r!==this.height?this.initialize({width:i,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:n}):this}generateMipmap(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(hr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Tc(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:i=null,level:n=0,format:s=this.format,border:a=this.border,offset:o=0,parameters:f={}}=t;let{data:m=null,type:w=this.type,width:A=this.width,height:P=this.height,dataFormat:I=this.dataFormat,compressed:N=!1}=t;m||(m=i),{type:w,dataFormat:I,compressed:N,width:A,height:P}=this._deduceParameters({format:s,type:w,dataFormat:I,compressed:N,data:m,width:A,height:P});const{gl:F}=this;F.bindTexture(this.target,this.handle);let Z=null;({data:m,dataType:Z}=this._getDataType({data:m,compressed:N}));let U,z=0;if(Tc(this.gl,f,()=>{switch(Z){case"null":F.texImage2D(r,n,s,A,P,a,I,w,m);break;case"typed-array":F.texImage2D(r,n,s,A,P,a,I,w,m,o);break;case"buffer":U=Zo(F),U.bindBuffer(35052,m.handle||m),U.texImage2D(r,n,s,A,P,a,I,w,o),U.bindBuffer(35052,null);break;case"browser-object":ni(F)?F.texImage2D(r,n,s,A,P,a,I,w,m):F.texImage2D(r,n,s,I,w,m);break;case"compressed":for(const[J,nt]of m.entries())F.compressedTexImage2D(r,J,nt.format,nt.width,nt.height,a,nt.data),z+=nt.levelSize;break;default:rr(!1,"Unknown image data type")}}),Z==="compressed")this._trackAllocatedMemory(z,"Texture");else if(m&&m.byteLength)this._trackAllocatedMemory(m.byteLength,"Texture");else{const J=aB[this.dataFormat]||4,nt=lB[this.type]||1;this._trackAllocatedMemory(this.width*this.height*J*nt,"Texture")}return this.loaded=!0,this}setSubImageData(t){let{target:r=this.target,pixels:i=null,data:n=null,x:s=0,y:a=0,width:o=this.width,height:f=this.height,level:m=0,format:w=this.format,type:A=this.type,dataFormat:P=this.dataFormat,compressed:I=!1,offset:N=0,border:F=this.border,parameters:Z={}}=t;if({type:A,dataFormat:P,compressed:I,width:o,height:f}=this._deduceParameters({format:w,type:A,dataFormat:P,compressed:I,data:n,width:o,height:f}),rr(this.depth===0,"texSubImage not supported for 3D textures"),n||(n=i),n&&n.data){const U=n;n=U.data,o=U.shape[0],f=U.shape[1]}n instanceof Ki&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),Tc(this.gl,Z,()=>{if(I)this.gl.compressedTexSubImage2D(r,m,s,a,o,f,w,n);else if(n===null)this.gl.texSubImage2D(r,m,s,a,o,f,P,A,null);else if(ArrayBuffer.isView(n))this.gl.texSubImage2D(r,m,s,a,o,f,P,A,n,N);else if(n instanceof WC){const U=Zo(this.gl);U.bindBuffer(35052,n),U.texSubImage2D(r,m,s,a,o,f,P,A,N),U.bindBuffer(35052,null)}else ni(this.gl)?Zo(this.gl).texSubImage2D(r,m,s,a,o,f,P,A,n):this.gl.texSubImage2D(r,m,s,a,P,A,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return hr.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.target,this.handle),t}unbind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.target,null),t}_getDataType(t){let{data:r,compressed:i=!1}=t;return i?{data:r,dataType:"compressed"}:r===null?{data:r,dataType:"null"}:ArrayBuffer.isView(r)?{data:r,dataType:"typed-array"}:r instanceof Ki?{data:r.handle,dataType:"buffer"}:r instanceof WC?{data:r,dataType:"buffer"}:{data:r,dataType:"browser-object"}}_deduceParameters(t){const{format:r,data:i}=t;let{width:n,height:s,dataFormat:a,type:o,compressed:f}=t;const m=mA[r];return a=a||m&&m.dataFormat,o=o||m&&m.types[0],f=f||m&&m.compressed,{width:n,height:s}=this._deduceImageSize(i,n,s),{dataFormat:a,type:o,compressed:f,width:n,height:s,format:r,data:i}}_deduceImageSize(t,r,i){let n;return typeof ImageData<"u"&&t instanceof ImageData?n={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?n={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?n={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?n={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?n={width:t.videoWidth,height:t.videoHeight}:t?n={width:r,height:i}:n={width:r>=0?r:1,height:i>=0?i:1},rr(n,"Could not deduced texture size"),rr(r===void 0||n.width===r,"Deduced texture width does not match supplied width"),rr(i===void 0||n.height===i,"Deduced texture height does not match supplied height"),n}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const r=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),r}}_setParameter(t,r){switch(this.gl.bindTexture(this.target,this.handle),r=this._getNPOTParam(t,r),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,r);break;case 4096:case 4097:rr(!1);break;default:this.gl.texParameteri(this.target,t,r);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return ni(this.gl)||!this.width||!this.height?!1:!qC(this.width)||!qC(this.height)}_updateForNPOT(t){t[this.gl.TEXTURE_MIN_FILTER]===void 0&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),t[this.gl.TEXTURE_WRAP_S]===void 0&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),t[this.gl.TEXTURE_WRAP_T]===void 0&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,r){if(this._isNPOT())switch(t){case 10241:cj.indexOf(r)===-1&&(r=9729);break;case 10242:case 10243:r!==33071&&(r=33071);break}return r}}let uj="";function hj(e,t){return rr(typeof e=="string"),e=uj+e,new Promise((r,i)=>{try{const n=new Image;n.onload=()=>r(n),n.onerror=()=>i(new Error("Could not load image ".concat(e,"."))),n.crossOrigin=t&&t.crossOrigin||"anonymous",n.src=e}catch(n){i(n)}})}class Xa extends lg{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(t,r){return lg.isSupported(t,r)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};iv(t),(r instanceof Promise||typeof r=="string")&&(r={data:r}),typeof r.data=="string"&&(r=Object.assign({},r,{data:hj(r.data)})),super(t,Object.assign({},r,{target:3553})),this.initialize(r),Object.seal(this)}}const nx=[34069,34070,34071,34072,34073,34074];class cB extends lg{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};iv(t),super(t,Object.assign({},r,{target:34067})),this.initialize(r),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:r=!0,parameters:i={}}=t;return this.opts=t,this.setCubeMapImageData(t).then(()=>{this.loaded=!0,r&&this.generateMipmap(t),this.setParameters(i)}),this}subImage(t){let{face:r,data:i,x:n=0,y:s=0,mipmapLevel:a=0}=t;return this._subImage({target:r,data:i,x:n,y:s,mipmapLevel:a})}async setCubeMapImageData(t){let{width:r,height:i,pixels:n,data:s,border:a=0,format:o=6408,type:f=5121}=t;const{gl:m}=this,w=n||s,A=await Promise.all(nx.map(P=>{const I=w[P];return Promise.all(Array.isArray(I)?I:[I])}));this.bind(),nx.forEach((P,I)=>{A[I].length>1&&this.opts.mipmaps!==!1&&hr.warn("".concat(this.id," has mipmap and multiple LODs."))(),A[I].forEach((N,F)=>{r&&i?m.texImage2D(P,F,o,r,i,a,o,f,N):m.texImage2D(P,F,o,o,f,N)})}),this.unbind()}setImageDataForFace(t){const{face:r,width:i,height:n,pixels:s,data:a,border:o=0,format:f=6408,type:m=5121}=t,{gl:w}=this,A=s||a;return this.bind(),A instanceof Promise?A.then(P=>this.setImageDataForFace(Object.assign({},t,{face:r,data:P,pixels:P}))):this.width||this.height?w.texImage2D(r,0,f,i,n,o,f,m,A):w.texImage2D(r,0,f,f,m,A),this}}cB.FACES=nx;class dj extends lg{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(t){return ni(t)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Zo(t),r=Object.assign({depth:1},r,{target:32879,unpackFlipY:!1}),super(t,r),this.initialize(r),Object.seal(this)}setImageData(t){let{level:r=0,dataFormat:i=6408,width:n,height:s,depth:a=1,border:o=0,format:f,type:m=5121,offset:w=0,data:A,parameters:P={}}=t;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Tc(this.gl,P,()=>{ArrayBuffer.isView(A)&&this.gl.texImage3D(this.target,r,i,n,s,a,o,f,m,A),A instanceof Ki&&(this.gl.bindBuffer(35052,A.handle),this.gl.texImage3D(this.target,r,i,n,s,a,o,f,m,w))}),A&&A.byteLength)this._trackAllocatedMemory(A.byteLength,"Texture");else{const I=aB[this.dataFormat]||4,N=lB[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*I*N,"Texture")}return this.loaded=!0,this}}const Zd="EXT_color_buffer_float",$C={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:Zd,bpp:2},33327:{gl2:Zd,bpp:4},34842:{gl2:Zd,bpp:8},33326:{gl2:Zd,bpp:4},33328:{gl2:Zd,bpp:8},34836:{gl2:Zd,bpp:16},35898:{gl2:Zd,bpp:4}};function fj(e,t,r){const i=r[t];if(!i)return!1;const n=ni(e)&&i.gl2||i.gl1;return typeof n=="string"?e.getExtension(n):n}class Mp extends yh{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(t){let{format:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!r||fj(t,r,$C)}static getSamplesForFormat(t,r){let{format:i}=r;return t.getInternalformatParameter(36161,i,32937)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,r),this.initialize(r),Object.seal(this)}initialize(t){let{format:r,width:i=1,height:n=1,samples:s=0}=t;return rr(r,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&ni(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,r,i,n):this.gl.renderbufferStorage(36161,r,i,n),this.format=r,this.width=i,this.height=n,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*$C[this.format].bpp),this}resize(t){let{width:r,height:i}=t;return r!==this.width||i!==this.height?this.initialize({width:r,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}const pj=256,gj=1024,mj=16384,ZC=6144,JC=6145,XC=6146,KC=34041,uB="clear: bad arguments";function yA(e){let{framebuffer:t=null,color:r=null,depth:i=null,stencil:n=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};t&&(s.framebuffer=t);let a=0;r&&(a|=mj,r!==!0&&(s.clearColor=r)),i&&(a|=pj,i!==!0&&(s.clearDepth=i)),n&&(a|=gj,i!==!0&&(s.clearStencil=i)),rr(a!==0,uB),Tc(e,s,()=>{e.clear(a)})}function yj(e){let{framebuffer:t=null,buffer:r=ZC,drawBuffer:i=0,value:n=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Zo(e),Tc(e,{framebuffer:t},()=>{switch(r){case ZC:switch(n.constructor){case Int32Array:e.clearBufferiv(r,i,n);break;case Uint32Array:e.clearBufferuiv(r,i,n);break;case Float32Array:default:e.clearBufferfv(r,i,n)}break;case JC:e.clearBufferfv(JC,0,[n]);break;case XC:e.clearBufferiv(XC,0,[n]);break;case KC:const[s,a]=n;e.clearBufferfi(KC,0,s,a);break;default:rr(!1,uB)}})}function _j(e){switch(e){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return rr(!1),0}}function nv(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:r=0,sourceY:i=0,sourceFormat:n=6408}=t;let{sourceAttachment:s=36064,target:a=null,sourceWidth:o,sourceHeight:f,sourceType:m}=t;const{framebuffer:w,deleteFramebuffer:A}=vj(e);rr(w);const{gl:P,handle:I,attachments:N}=w;o=o||w.width,f=f||w.height,s===36064&&I===null&&(s=1028),rr(N[s]),m=m||N[s].type,a=bj(a,m,n,o,f),m=m||rx(a);const F=P.bindFramebuffer(36160,I);return P.readPixels(r,i,o,f,n,m,a),P.bindFramebuffer(36160,F||null),A&&w.delete(),a}function YC(e){let{sourceAttachment:t=36064,targetMaxHeight:r=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=nv(e,{sourceAttachment:t}),{width:n,height:s}=e;for(;s>r;)({data:i,width:n,height:s}=rj({data:i,width:n,height:s}));ej({data:i,width:n,height:s});const a=document.createElement("canvas");a.width=n,a.height=s;const o=a.getContext("2d"),f=o.createImageData(n,s);return f.data.set(i),o.putImageData(f,0,0),a.toDataURL()}function vj(e){return e instanceof ws?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:Ij(e),deleteFramebuffer:!0}}function bj(e,t,r,i,n){if(e)return e;t=t||5121;const s=l0(t,{clamped:!1}),a=_j(r);return new s(i*n*a)}const ln={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function wj(e){const t=new Xa(e,{format:6408,type:5126,dataFormat:6408}),r=new ws(e,{id:"test-framebuffer",check:!1,attachments:{36064:t}}),i=r.getStatus();return t.delete(),r.delete(),i===36053}const hB={[ln.WEBGL2]:[!1,!0],[ln.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[ln.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[ln.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[ln.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[ln.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[ln.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[ln.FLOAT_BLEND]:["EXT_float_blend"],[ln.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[ln.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[ln.TEXTURE_FLOAT]:["OES_texture_float",!0],[ln.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[ln.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[ln.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[ln.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[ln.COLOR_ATTACHMENT_RGBA32F]:[wj,"EXT_color_buffer_float"],[ln.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[ln.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[ln.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[ln.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[ln.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[ln.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},xj=2;function _A(e,t){return dB(e,t)}function dB(e,t){return t=Array.isArray(t)?t:[t],t.every(r=>fB(e,r))}function Aj(e){e.luma=e.luma||{},e.luma.caps=e.luma.caps||{};for(const t in hB)e.luma.caps[t]===void 0&&(e.luma.caps[t]=fB(e,t));return e.luma.caps}function fB(e,t){return e.luma=e.luma||{},e.luma.caps=e.luma.caps||{},e.luma.caps[t]===void 0&&(e.luma.caps[t]=Sj(e,t)),e.luma.caps[t]||hr.log(xj,"Feature: ".concat(t," not supported"))(),e.luma.caps[t]}function Sj(e,t){const r=hB[t];rr(r,t);let i;const n=ni(e)&&r[1]||r[0];if(typeof n=="function")i=n(e);else if(Array.isArray(n)){i=!0;for(const s of n)i=i&&!!e.getExtension(s)}else typeof n=="string"?i=!!e.getExtension(n):typeof n=="boolean"?i=n:rr(!1);return i}const QC="Multiple render targets not supported";class ws extends yh{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:n}=r;let s=!0;return i&&(s=!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),n&&(s=s&&!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new ws(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=Zo(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=Zo(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,r),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(r),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(t){let{width:r=1,height:i=1,attachments:n=null,color:s=!0,depth:a=!0,stencil:o=!1,check:f=!0,readBuffer:m=void 0,drawBuffers:w=void 0}=t;if(rr(r>=0&&i>=0,"Width and height need to be integers"),this.width=r,this.height=i,n)for(const A in n){const P=n[A];(Array.isArray(P)?P[0]:P).resize({width:r,height:i})}else n=this._createDefaultAttachments(s,a,o,r,i);this.update({clearAttachments:!0,attachments:n,readBuffer:m,drawBuffers:w}),n&&f&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update(t){let{attachments:r={},readBuffer:i,drawBuffers:n,clearAttachments:s=!1,resizeAttachments:a=!0}=t;this.attach(r,{clearAttachments:s,resizeAttachments:a});const{gl:o}=this,f=o.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),n&&this._setDrawBuffers(n),o.bindFramebuffer(36160,f||null),this}resize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:r,height:i}=t;if(this.handle===null)return rr(r===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;r===void 0&&(r=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),r!==this.width&&i!==this.height&&hr.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(r,"x").concat(i))();for(const n in this.attachments)this.attachments[n].resize({width:r,height:i});return this.width=r,this.height=i,this}attach(t){let{clearAttachments:r=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n={};r&&Object.keys(this.attachments).forEach(a=>{n[a]=null}),Object.assign(n,t);const s=this.gl.bindFramebuffer(36160,this.handle);for(const a in n){rr(a!==void 0,"Misspelled framebuffer binding point?");const o=Number(a),f=n[o];let m=f;if(!m)this._unattach(o);else if(m instanceof Mp)this._attachRenderbuffer({attachment:o,renderbuffer:m});else if(Array.isArray(f)){const[w,A=0,P=0]=f;m=w,this._attachTexture({attachment:o,texture:w,layer:A,level:P})}else this._attachTexture({attachment:o,texture:m,layer:0,level:0});i&&m&&m.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(a=>!this.attachments[a]).forEach(a=>{delete this.attachments[a]})}checkStatus(){const t=this.getStatus();if(t!==36053)throw new Error(Cj(t));return this}getStatus(){const{gl:t}=this,r=t.bindFramebuffer(36160,this.handle),i=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,r||null),i}clear(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:r,depth:i,stencil:n,drawBuffers:s=[]}=t,a=this.gl.bindFramebuffer(36160,this.handle);return(r||i||n)&&yA(this.gl,{color:r,depth:i,stencil:n}),s.forEach((o,f)=>{yj(this.gl,{drawBuffer:f,value:o})}),this.gl.bindFramebuffer(36160,a||null),this}readPixels(){return hr.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return hr.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return hr.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return hr.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return hr.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return hr.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(t){let{attachments:r=[],x:i=0,y:n=0,width:s,height:a}=t;const o=Zo(this.gl),f=o.bindFramebuffer(36008,this.handle);return i===0&&n===0&&s===void 0&&a===void 0?o.invalidateFramebuffer(36008,r):o.invalidateFramebuffer(36008,r,i,n,s,a),o.bindFramebuffer(36008,f),this}getAttachmentParameter(t,r,i){let n=this._getAttachmentParameterFallback(r);return n===null&&(this.gl.bindFramebuffer(36160,this.handle),n=this.gl.getFramebufferAttachmentParameter(36160,t,r),this.gl.bindFramebuffer(36160,null)),i&&n>1e3&&(n=md(this.gl,n)),n}getAttachmentParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,r=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const n={};for(const s of i){const a=r?md(this.gl,s):s;n[a]=this.getAttachmentParameter(t,s,r)}return n}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const r=Object.keys(this.attachments),i={};for(const n of r){const s=Number(n),a=t?md(this.gl,s):s;i[a]=this.getAttachmentParameters(s,t)}return i}show(){return typeof window<"u"&&window.open(YC(this),"luma-debug-texture"),this}log(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(t>hr.level||typeof window>"u")return this;r=r||"Framebuffer ".concat(this.id);const i=YC(this,{targetMaxHeight:100});return hr.image({logLevel:t,message:r,image:i},r)(),this}bind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,this.handle),this}unbind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,r,i,n,s){let a=null;return t&&(a=a||{},a[36064]=new Xa(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:n,height:s,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(a[36064])),r&&i?(a=a||{},a[33306]=new Mp(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:n,height:111}),this.ownResources.push(a[33306])):r?(a=a||{},a[36096]=new Mp(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:n,height:s}),this.ownResources.push(a[36096])):i&&rr(!1),a}_unattach(t){const r=this.attachments[t];r&&(r instanceof Mp?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer(t){let{attachment:r=36064,renderbuffer:i}=t;const{gl:n}=this;n.framebufferRenderbuffer(36160,r,36161,i.handle),this.attachments[r]=i}_attachTexture(t){let{attachment:r=36064,texture:i,layer:n,level:s}=t;const{gl:a}=this;switch(a.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:Zo(a).framebufferTextureLayer(36160,r,i.target,s,n);break;case 34067:const o=Ej(n);a.framebufferTexture2D(36160,r,o,i.handle,s);break;case 3553:a.framebufferTexture2D(36160,r,3553,i.handle,s);break;default:rr(!1,"Illegal texture type")}a.bindTexture(i.target,null),this.attachments[r]=i}_setReadBuffer(t){const r=e9(this.gl);r?r.readBuffer(t):rr(t===36064||t===1029,QC),this.readBuffer=t}_setDrawBuffers(t){const{gl:r}=this,i=Zo(r);if(i)i.drawBuffers(t);else{const n=r.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(t):rr(t.length===1&&(t[0]===36064||t[0]===1029),QC)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const r=Aj(this.gl);switch(t){case 36052:return r.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return r.WEBGL2?null:8;case 33297:return r.WEBGL2?null:5125;case 33296:return!r.WEBGL2&&!r.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}function Ej(e){return e<34069?e+34069:e}function Cj(e){return(ws.STATUS||{})[e]||"Framebuffer error ".concat(e)}const Tj=[36049,36048,33296,33298,33299,33300,33301,33302,33303];ws.ATTACHMENT_PARAMETERS=Tj;function Pj(e,t){rr(e instanceof Xa||e instanceof cB||e instanceof dj);const r=e.constructor,{gl:i,width:n,height:s,format:a,type:o,dataFormat:f,border:m,mipmaps:w}=e,A=Object.assign({width:n,height:s,format:a,type:o,dataFormat:f,border:m,mipmaps:w},t);return new r(i,A)}function Ij(e,t){const{gl:r,width:i,height:n,id:s}=e;return new ws(r,Object.assign({},t,{id:"framebuffer-for-".concat(s),width:i,height:n,attachments:{36064:e}}))}function by(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=e.match(r);return i?i[1]:t}const Mj=35632,Lj=35633;function Bj(e){switch(e){case Mj:return"fragment";case Lj:return"vertex";default:return"unknown type"}}function kj(e,t,r,i){const n=e.split(/\r?\n/),s={},a={},o=i||by(t)||"(unnamed)",f="".concat(Bj(r)," shader ").concat(o);for(let w=0;w<n.length;w++){const A=n[w];if(A.length<=1)continue;const P=A.split(":"),I=P[0],N=parseInt(P[2],10);if(isNaN(N))throw new Error("GLSL compilation error in ".concat(f,": ").concat(e));I!=="WARNING"?s[N]=A:a[N]=A}const m=Rj(t);return{shaderName:f,errors:tT(s,m),warnings:tT(a,m)}}function tT(e,t){let r="";for(let i=0;i<t.length;i++){const n=t[i];if(!(!e[i+3]&&!e[i+2]&&!e[i+1])&&(r+="".concat(n,`
`),e[i+1])){const s=e[i+1],a=s.split(":",3),o=a[0],f=parseInt(a[1],10)||0,m=s.substring(a.join(":").length+1).trim();r+=pB("^^^ ".concat(o,": ").concat(m,`

`),f)}}return r}function Rj(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=e.split(/\r?\n/),n=String(i.length+t-1).length;return i.map((s,a)=>{const o=String(a+t),f=o.length;return pB(o,n-f)+r+s})}function pB(e,t){let r="";for(let i=0;i<t;++i)r+=" ";return"".concat(r).concat(e)}function gB(e){let t=100;const r=e.match(/[^\s]+/g);if(r.length>=2&&r[0]==="#version"){const i=parseInt(r[1],10);Number.isFinite(i)&&(t=i)}return t}const Oj="Shader: GLSL source code must be a JavaScript string";class c0 extends yh{get[Symbol.toStringTag](){return"Shader"}static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return rr(!1),"unknown"}}constructor(t,r){iv(t),rr(typeof r.source=="string",Oj);const i=by(r.source,null)||r.id||fh("unnamed ".concat(c0.getTypeName(r.shaderType)));super(t,{id:i}),this.shaderType=r.shaderType,this.source=r.source,this.initialize(r)}initialize(t){let{source:r}=t;const i=by(r,null);i&&(this.id=fh(i)),this._compile(r)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(c0.getTypeName(this.shaderType),":").concat(this.id)}getName(){return by(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(t.startsWith("#version ")||(t=`#version 100
`.concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:i,errors:n,warnings:s}=kj(r,this.source,this.shaderType,this.id);throw hr.error("GLSL compilation errors in ".concat(i,`
`).concat(n))(),hr.warn("GLSL compilation warnings in ".concat(i,`
`).concat(s))(),new Error("GLSL compilation errors in ".concat(i))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Kb extends c0{get[Symbol.toStringTag](){return"VertexShader"}constructor(t,r){typeof r=="string"&&(r={source:r}),super(t,Object.assign({},r,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class Yb extends c0{get[Symbol.toStringTag](){return"FragmentShader"}constructor(t,r){typeof r=="string"&&(r={source:r}),super(t,Object.assign({},r,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const Dj={5126:gn.bind(null,"uniform1fv",Fa,1,mo),35664:gn.bind(null,"uniform2fv",Fa,2,mo),35665:gn.bind(null,"uniform3fv",Fa,3,mo),35666:gn.bind(null,"uniform4fv",Fa,4,mo),5124:gn.bind(null,"uniform1iv",Vh,1,mo),35667:gn.bind(null,"uniform2iv",Vh,2,mo),35668:gn.bind(null,"uniform3iv",Vh,3,mo),35669:gn.bind(null,"uniform4iv",Vh,4,mo),35670:gn.bind(null,"uniform1iv",Vh,1,mo),35671:gn.bind(null,"uniform2iv",Vh,2,mo),35672:gn.bind(null,"uniform3iv",Vh,3,mo),35673:gn.bind(null,"uniform4iv",Vh,4,mo),35674:gn.bind(null,"uniformMatrix2fv",Fa,4,qu),35675:gn.bind(null,"uniformMatrix3fv",Fa,9,qu),35676:gn.bind(null,"uniformMatrix4fv",Fa,16,qu),35678:Xs,35680:Xs,5125:gn.bind(null,"uniform1uiv",B1,1,mo),36294:gn.bind(null,"uniform2uiv",B1,2,mo),36295:gn.bind(null,"uniform3uiv",B1,3,mo),36296:gn.bind(null,"uniform4uiv",B1,4,mo),35685:gn.bind(null,"uniformMatrix2x3fv",Fa,6,qu),35686:gn.bind(null,"uniformMatrix2x4fv",Fa,8,qu),35687:gn.bind(null,"uniformMatrix3x2fv",Fa,6,qu),35688:gn.bind(null,"uniformMatrix3x4fv",Fa,12,qu),35689:gn.bind(null,"uniformMatrix4x2fv",Fa,8,qu),35690:gn.bind(null,"uniformMatrix4x3fv",Fa,12,qu),35678:Xs,35680:Xs,35679:Xs,35682:Xs,36289:Xs,36292:Xs,36293:Xs,36298:Xs,36299:Xs,36300:Xs,36303:Xs,36306:Xs,36307:Xs,36308:Xs,36311:Xs},Nj={},Fj={},zj={},eT=[0];function vA(e,t,r,i){t===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(eT[0]=e,e=eT);const n=e.length;if(n%t&&hr.warn("Uniform size should be multiples of ".concat(t),e)(),e instanceof r)return e;let s=i[n];s||(s=new r(n),i[n]=s);for(let a=0;a<n;a++)s[a]=e[a];return s}function Fa(e,t){return vA(e,t,Float32Array,Nj)}function Vh(e,t){return vA(e,t,Int32Array,Fj)}function B1(e,t){return vA(e,t,Uint32Array,zj)}function rT(e,t,r){const i=Dj[r.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(r.type));return i().bind(null,e,t)}function jj(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/,r=e.match(t);if(!r||r.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:r[1],length:r[2]||1,isArray:!!r[2]}}function Uj(e,t,r){for(const i in e){const n=e[i];if((!r||r[i])&&!Gj(n))throw t=t?"".concat(t," "):"",console.error("".concat(t," Bad uniform ").concat(i),n),new Error("".concat(t," Bad uniform ").concat(i))}return!0}function Gj(e){return Array.isArray(e)||ArrayBuffer.isView(e)?qj(e):isFinite(e)||e===!0||e===!1||e instanceof lg||e instanceof Mp?!0:e instanceof ws?!!e.texture:!1}function Vj(e,t,r){if(Array.isArray(r)||ArrayBuffer.isView(r))if(e[t]){const i=e[t];for(let n=0,s=r.length;n<s;++n)i[n]=r[n]}else e[t]=r.slice();else e[t]=r}function qj(e){if(e.length===0)return!1;const t=Math.min(e.length,16);for(let r=0;r<t;++r)if(!Number.isFinite(e[r]))return!1;return!0}function Xs(){let e=null;return(t,r,i)=>{const n=e!==i;return n&&(t.uniform1i(r,i),e=i),n}}function gn(e,t,r,i){let n=null,s=null;return(a,o,f)=>{const m=t(f,r),w=m.length;let A=!1;if(n===null)n=new Float32Array(w),s=w,A=!0;else{rr(s===w,"Uniform length cannot change.");for(let P=0;P<w;++P)if(m[P]!==n[P]){A=!0;break}}return A&&(i(a,e,o,m),n.set(m)),A}}function mo(e,t,r,i){e[t](r,i)}function qu(e,t,r,i){e[t](r,!1,i)}const Hj=5120,Wj=5121,$j=5122,Zj=5123,iT=0,k1=1,Jj=2,Xj=3,R1=4,Kj=5,Yj=6,ys=5126,Qj=35664,tU=35665,eU=35666,im=5124,rU=35667,iU=35668,nU=35669,nm=5125,sU=36294,oU=36295,aU=36296,lU=35670,cU=35671,uU=35672,hU=35673,dU=35674,fU=35675,pU=35676,gU=35685,mU=35686,yU=35687,_U=35688,vU=35689,bU=35690,sx={[ys]:[ys,1,"float"],[Qj]:[ys,2,"vec2"],[tU]:[ys,3,"vec3"],[eU]:[ys,4,"vec4"],[im]:[im,1,"int"],[rU]:[im,2,"ivec2"],[iU]:[im,3,"ivec3"],[nU]:[im,4,"ivec4"],[nm]:[nm,1,"uint"],[sU]:[nm,2,"uvec2"],[oU]:[nm,3,"uvec3"],[aU]:[nm,4,"uvec4"],[lU]:[ys,1,"bool"],[cU]:[ys,2,"bvec2"],[uU]:[ys,3,"bvec3"],[hU]:[ys,4,"bvec4"],[dU]:[ys,8,"mat2"],[gU]:[ys,8,"mat2x3"],[mU]:[ys,8,"mat2x4"],[fU]:[ys,12,"mat3"],[yU]:[ys,12,"mat3x2"],[_U]:[ys,12,"mat3x4"],[pU]:[ys,16,"mat4"],[vU]:[ys,16,"mat4x2"],[bU]:[ys,16,"mat4x3"]};function wU(e){switch(e){case iT:return iT;case k1:return k1;case Xj:return k1;case Jj:return k1;case R1:return R1;case Kj:return R1;case Yj:return R1;default:return rr(!1),0}}function nT(e){const t=sx[e];if(!t)return null;const[r,i]=t;return{type:r,components:i}}function mB(e,t){switch(e){case Hj:case Wj:case $j:case Zj:e=ys;break}for(const r in sx){const[i,n,s]=sx[r];if(i===e&&n===t)return{glType:r,name:s}}return null}class xU{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const r=Number(t);return Number.isFinite(r)?this.attributeInfosByLocation[r]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const r=this.getAttributeInfo(t);return r?r.location:-1}getAttributeAccessor(t){const r=this.getAttributeInfo(t);return r?r.accessor:null}getVaryingInfo(t){const r=Number(t);return Number.isFinite(r)?this.varyingInfos[r]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const r=this.getVaryingInfo();return r?r.location:-1}getVaryingAccessor(t){const r=this.getVaryingInfo();return r?r.accessor:null}_readAttributesFromProgram(t){const{gl:r}=t,i=r.getProgramParameter(t.handle,35721);for(let n=0;n<i;n++){const{name:s,type:a,size:o}=r.getActiveAttrib(t.handle,n),f=r.getAttribLocation(t.handle,s);f>=0&&this._addAttribute(f,s,a,o)}this.attributeInfos.sort((n,s)=>n.location-s.location)}_readVaryingsFromProgram(t){const{gl:r}=t;if(!ni(r))return;const i=r.getProgramParameter(t.handle,35971);for(let n=0;n<i;n++){const{name:s,type:a,size:o}=r.getTransformFeedbackVarying(t.handle,n);this._addVarying(n,s,a,o)}this.varyingInfos.sort((n,s)=>n.location-s.location)}_addAttribute(t,r,i,n){const{type:s,components:a}=nT(i),o={type:s,size:n*a};this._inferProperties(t,r,o);const f={location:t,name:r,accessor:new ga(o)};this.attributeInfos.push(f),this.attributeInfosByLocation[t]=f,this.attributeInfosByName[f.name]=f}_inferProperties(t,r,i){/instance/i.test(r)&&(i.divisor=1)}_addVarying(t,r,i,n){const{type:s,components:a}=nT(i),o=new ga({type:s,size:n*a}),f={location:t,name:r,accessor:o};this.varyingInfos.push(f),this.varyingInfosByName[f.name]=f}}const sT=4,AU=35981,SU=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class yB extends yh{get[Symbol.toStringTag](){return"Program"}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,r),this.stubRemovedMethods("Program","v6.0",SU),this._isCached=!1,this.initialize(r),Object.seal(this),this._setId(r.id)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:r,vs:i,fs:n,varyings:s,bufferMode:a=AU}=t;return this.hash=r||"",this.vs=typeof i=="string"?new Kb(this.gl,{id:"".concat(t.id,"-vs"),source:i}):i,this.fs=typeof n=="string"?new Yb(this.gl,{id:"".concat(t.id,"-fs"),source:n}):n,rr(this.vs instanceof Kb),rr(this.fs instanceof Yb),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(Zo(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new xU(this),this.setProps(t)}delete(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw(t){let{logPriority:r,drawMode:i=4,vertexCount:n,offset:s=0,start:a,end:o,isIndexed:f=!1,indexType:m=5123,instanceCount:w=0,isInstanced:A=w>0,vertexArray:P=null,transformFeedback:I,framebuffer:N,parameters:F={},uniforms:Z,samplers:U}=t;if((Z||U)&&(hr.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(Z||{})),hr.priority>=r){const z=N?N.id:"default",J="mode=".concat(md(this.gl,i)," verts=").concat(n," ")+"instances=".concat(w," indexType=").concat(md(this.gl,m)," ")+"isInstanced=".concat(A," isIndexed=").concat(f," ")+"Framebuffer=".concat(z);hr.log(r,J)()}return rr(P),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||n===0||A&&w===0?!1:(P.bindForDraw(n,w,()=>{if(N!==void 0&&(F=Object.assign({},F,{framebuffer:N})),I){const z=wU(i);I.begin(z)}this._bindTextures(),Tc(this.gl,F,()=>{f&&A?this.gl2.drawElementsInstanced(i,n,m,s,w):f&&ni(this.gl)&&!isNaN(a)&&!isNaN(o)?this.gl2.drawRangeElements(i,a,o,n,m,s):f?this.gl.drawElements(i,n,m,s):A?this.gl2.drawArraysInstanced(i,s,n,w):this.gl.drawArrays(i,s,n)}),I&&I.end()}),!0)}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};hr.priority>=2&&Uj(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const r in t){const i=t[r],n=this._uniformSetters[r];if(n){let s=i,a=!1;if(s instanceof ws&&(s=s.texture),s instanceof lg)if(a=this.uniforms[r]!==i,a){n.textureIndex===void 0&&(n.textureIndex=this._textureIndexCounter++);const o=s,{textureIndex:f}=n;o.bind(f),s=f,this._textureUniforms[r]=o}else s=n.textureIndex;else this._textureUniforms[r]&&delete this._textureUniforms[r];(n(s)||a)&&Vj(this.uniforms,r,i)}}return this}_areTexturesRenderable(){let t=!0;for(const r in this._textureUniforms){const i=this._textureUniforms[r];i.update(),t=t&&i.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const r=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(r)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const r=this.gl.getAttachedShaders(t),i={};for(const n of r)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new Kb({handle:n});break;case 35632:i.fs=new Yb({handle:n});break}return i}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const r=this._getName();this.id=fh(r)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),hr.time(sT,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),hr.timeEnd(sT,"linkProgram for ".concat(this._getName()))(),t.debug||hr.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let r=0;r<this._uniformCount;r++){const i=this.gl.getActiveUniform(this.handle,r),{name:n}=jj(i.name);let s=t.getUniformLocation(this.handle,n);if(this._uniformSetters[n]=rT(t,s,i),i.size>1)for(let a=0;a<i.size;a++)s=t.getUniformLocation(this.handle,"".concat(n,"[").concat(a,"]")),this._uniformSetters["".concat(n,"[").concat(a,"]")]=rT(t,s,i)}this._textureIndexCounter=0}getActiveUniforms(t,r){return this.gl2.getActiveUniforms(this.handle,t,r)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,r){return this.gl2.getActiveUniformBlockParameter(this.handle,t,r)}uniformBlockBinding(t,r){this.gl2.uniformBlockBinding(this.handle,t,r)}}const EU=34918,CU=34919,TU=35007,PU=36795,IU=35976,MU=35887,LU=36202;class v_ extends yh{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=ni(t),n=dB(t,ln.TIMER_QUERY);let s=i||n;for(const a of r)switch(a){case"queries":s=s&&i;break;case"timers":s=s&&n;break;default:rr(!1)}return s}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,r),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(TU)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(t?LU:MU)}beginTransformFeedbackQuery(){return this.begin(IU)}begin(t){return this._queryPending?this:(this.target=t,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,CU);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(PU)}getResult(){return this.gl2.getQueryParameter(this.handle,EU)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,n)=>{const s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>t?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return v_.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class _B extends yh{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(t){return ni(t)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Zo(t),super(t,r),this.initialize(r),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,ag(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const r in t)this.setBuffer(r,t[r])}),this}setBuffer(t,r){const i=this._getVaryingIndex(t),{buffer:n,byteSize:s,byteOffset:a}=this._getBufferParams(r);return i<0?(this.unused[t]=n,hr.warn("".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[i]=r,this.bindOnUse||this._bindBuffer(i,n,a,s),this)}begin(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let r,i,n;return t instanceof Ki?n=t:(n=t.buffer,i=t.byteSize,r=t.byteOffset),(r!==void 0||i!==void 0)&&(r=r||0,i=i||n.byteLength-r),{buffer:n,byteOffset:r,byteSize:i}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const r=Number(t);return Number.isFinite(r)?r:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:r,byteSize:i,byteOffset:n}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,r,n,i)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;const s=r&&r.handle;return!s||n===void 0?this.gl.bindBufferBase(35982,t,s):this.gl.bindBufferRange(35982,t,s,i,n),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}let O1=null;function BU(e){return(!O1||O1.byteLength<e)&&(O1=new ArrayBuffer(e)),O1}function kU(e,t){const r=BU(e.BYTES_PER_ELEMENT*t);return new e(r,0,t)}function RU(e){let{target:t,source:r,start:i=0,count:n=1}=e;const s=r.length,a=n*s;let o=0;for(let f=i;o<s;o++)t[f++]=r[o];for(;o<a;)o<a-o?(t.copyWithin(i+o,i,i+o),o*=2):(t.copyWithin(i+o,i,i+a-o),o=a);return t}const OU="elements must be GL.ELEMENT_ARRAY_BUFFER";class Ga extends yh{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(t){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?ni(t)||KL()==="Chrome":!0}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new Ga(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return Ga.MAX_ATTRIBUTES=Ga.MAX_ATTRIBUTES||t.getParameter(34921),Ga.MAX_ATTRIBUTES}static setConstant(t,r,i){switch(i.constructor){case Float32Array:Ga._setConstantFloatArray(t,r,i);break;case Int32Array:Ga._setConstantIntArray(t,r,i);break;case Uint32Array:Ga._setConstantUintArray(t,r,i);break;default:rr(!1)}}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=r.id||r.program&&r.program.id;super(t,Object.assign({},r,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=r.isDefaultArray||!1,this.gl2=t,this.initialize(r),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Ga.getMaxAttributes(this.gl)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(t)}setProps(t){return this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return rr(!t||t.target===34963,OU),this.bind(()=>{this.gl.bindBuffer(34963,t?t.handle:null)}),this}setBuffer(t,r,i){if(r.target===34963)return this.setElementBuffer(r,i);const{size:n,type:s,stride:a,offset:o,normalized:f,integer:m,divisor:w}=i,{gl:A,gl2:P}=this;return t=Number(t),this.bind(()=>{A.bindBuffer(34962,r.handle),m?(rr(ni(A)),P.vertexAttribIPointer(t,n,s,a,o)):A.vertexAttribPointer(t,n,s,f,a,o),A.enableVertexAttribArray(t),P.vertexAttribDivisor(t,w||0)}),this}enable(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!r&&t===0&&!Ga.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind(()=>r?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t))),this}getConstantBuffer(t,r){const i=this._normalizeConstantArrayValue(r),n=i.byteLength*t,s=i.length*t;let a=!this.buffer;if(this.buffer=this.buffer||new Ki(this.gl,n),a=a||this.buffer.reallocate(n),a=a||!this._compareConstantArrayValues(i,this.bufferValue),a){const o=kU(r.constructor,s);RU({target:o,source:i,start:0,count:s}),this.buffer.subData(o),this.bufferValue=r}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,r){if(!t||!r||t.length!==r.length||t.constructor!==r.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==r[i])return!1;return!0}static _setConstantFloatArray(t,r,i){switch(i.length){case 1:t.vertexAttrib1fv(r,i);break;case 2:t.vertexAttrib2fv(r,i);break;case 3:t.vertexAttrib3fv(r,i);break;case 4:t.vertexAttrib4fv(r,i);break;default:rr(!1)}}static _setConstantIntArray(t,r,i){switch(rr(ni(t)),i.length){case 1:t.vertexAttribI1iv(r,i);break;case 2:t.vertexAttribI2iv(r,i);break;case 3:t.vertexAttribI3iv(r,i);break;case 4:t.vertexAttribI4iv(r,i);break;default:rr(!1)}}static _setConstantUintArray(t,r,i){switch(rr(ni(t)),i.length){case 1:t.vertexAttribI1uiv(r,i);break;case 2:t.vertexAttribI2uiv(r,i);break;case 3:t.vertexAttribI3uiv(r,i);break;case 4:t.vertexAttribI4uiv(r,i);break;default:rr(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,r){let{location:i}=r;return rr(Number.isFinite(i)),this.bind(()=>{switch(t){case 34373:return this.gl.getVertexAttribOffset(i,t);default:return this.gl.getVertexAttrib(i,t)}})}}const DU="VertexArray: attributes must be Buffers or constants (i.e. typed array)",NU=/^(.+)__LOCATION_([0-9]+)$/,FU=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class zU{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=r.id||r.program&&r.program.id;this.id=i,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Ga(t),sB(this,"VertexArray","v6.0",FU),this.initialize(r),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind(()=>{for(const r in t){const i=t[r];this._setAttribute(r,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=t,this.elementsAccessor=r,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,r),this}setBuffer(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(r.target===34963)return this.setElementBuffer(r,i);const{location:n,accessor:s}=this._resolveLocationAndAccessor(t,r,r.accessor,i);return n>=0&&(this.values[n]=r,this.accessors[n]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(n,r,s)),this}setConstant(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:n,accessor:s}=this._resolveLocationAndAccessor(t,r,Object.assign({size:r.length},i));return n>=0&&(r=this.vertexArrayObject._normalizeConstantArrayValue(r),this.values[n]=r,this.accessors[n]=s,this.clearDrawParams(),this.vertexArrayObject.enable(n,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Ki(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof Ki&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const r=this.values[t];r instanceof Ki&&this.setBuffer(t,r)}}),this}bindForDraw(t,r,i){let n;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(t,r),n=i()}),n}_resolveLocationAndAccessor(t,r,i,n){const s={location:-1,accessor:null},{location:a,name:o}=this._getAttributeIndex(t);if(!Number.isFinite(a)||a<0)return this.unused[t]=r,hr.once(3,()=>"unused value ".concat(t," in ").concat(this.id))(),s;const f=this._getAttributeInfo(o||a);if(!f)return s;const m=this.accessors[a]||{},w=ga.resolve(f.accessor,m,i,n),{size:A,type:P}=w;return rr(Number.isFinite(A)&&Number.isFinite(P)),{location:a,accessor:w}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const r=Number(t);if(Number.isFinite(r))return{location:r};const i=NU.exec(t),n=i?i[1]:t,s=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(n)+s,name:n}:{location:-1}}_setAttribute(t,r){if(r instanceof Ki)this.setBuffer(t,r);else if(Array.isArray(r)&&r.length&&r[0]instanceof Ki){const i=r[0],n=r[1];this.setBuffer(t,i,n)}else if(ArrayBuffer.isView(r)||Array.isArray(r)){const i=r;this.setConstant(t,i)}else if(r.buffer instanceof Ki){const i=r;this.setBuffer(t,i.buffer,i)}else throw new Error(DU)}_setConstantAttributes(t,r){const i=Math.max(t|0,r|0);let n=this.values[0];ArrayBuffer.isView(n)&&this._setConstantAttributeZero(n,i);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)n=this.values[s],ArrayBuffer.isView(n)&&this._setConstantAttribute(s,n)}_setConstantAttributeZero(t,r){if(Ga.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,t);return}const i=this.vertexArrayObject.getConstantBuffer(r,t);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(t,r){Ga.setConstant(this.gl,t,r)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let r=0;r<this.vertexArrayObject.MAX_ATTRIBUTES;r++)this._updateDrawParamsForLocation(t,r);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,r){const i=this.values[r],n=this.accessors[r];if(!i)return;const{divisor:s}=n,a=s>0;if(t.isInstanced=t.isInstanced||a,i instanceof Ki){const o=i;if(a){const f=o.getVertexCount(n);t.instanceCount=Math.min(t.instanceCount,f)}else{const f=o.getVertexCount(n);t.vertexCount=Math.min(t.vertexCount,f)}}}setElements(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return hr.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,r)}}function jU(e,t){const{maxElts:r=16,size:i=1}=t;let n="[";for(let a=0;a<e.length&&a<r;++a)a>0&&(n+=",".concat(a%i===0?" ":"")),n+=u0(e[a],t);const s=e.length>r?"...":"]";return"".concat(n).concat(s)}function u0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=1e-16,{isInteger:i=!1}=t;if(Array.isArray(e)||ArrayBuffer.isView(e))return jU(e,t);if(!Number.isFinite(e))return String(e);if(Math.abs(e)<r)return i?"0":"0.";if(i||Math.abs(e)>100&&Math.abs(e)<1e4)return e.toFixed(0);const n=e.toPrecision(2);return n.indexOf(".0")===n.length-2?n.slice(0,-1):n}function oT(e){let{header:t="Uniforms",program:r,uniforms:i,undefinedOnly:n=!1}=e;rr(r);const s=".*_.*",a=".*Matrix",o=r._uniformSetters,f={},m=Object.keys(o).sort();let w=0;for(const I of m)!I.match(s)&&!I.match(a)&&Qb({table:f,header:t,uniforms:i,uniformName:I,undefinedOnly:n})&&w++;for(const I of m)I.match(a)&&Qb({table:f,header:t,uniforms:i,uniformName:I,undefinedOnly:n})&&w++;for(const I of m)f[I]||Qb({table:f,header:t,uniforms:i,uniformName:I,undefinedOnly:n})&&w++;let A=0;const P={};if(!n)for(const I in i){const N=i[I];f[I]||(A++,P[I]={Type:"NOT USED: ".concat(N),[t]:u0(N)})}return{table:f,count:w,unusedTable:P,unusedCount:A}}function Qb(e){let{table:t,header:r,uniforms:i,uniformName:n,undefinedOnly:s}=e;const a=i[n],o=UU(a);return!s||!o?(t[n]={[r]:o?u0(a):"N/A","Uniform Type":o?a:"NOT PROVIDED"},!0):!1}function UU(e){return e!=null}function GU(e){let{vertexArray:t,header:r="Attributes"}=e;if(!t.configuration)return{};const i={};t.elements&&(i.ELEMENT_ARRAY_BUFFER=aT(t,t.elements,null,r));const n=t.values;for(const s in n){const a=t._getAttributeInfo(s);if(a){let o="".concat(s,": ").concat(a.name);const f=t.accessors[a.location];f&&(o="".concat(s,": ").concat(VU(a.name,f))),i[o]=aT(t,n[s],f,r)}}return i}function aT(e,t,r,i){const{gl:n}=e;if(!t)return{[i]:"null","Format ":"N/A"};let s="NOT PROVIDED",a=1,o=0,f=0,m,w,A;if(r&&(s=r.type,a=r.size,s=String(s).replace("Array",""),m=s.indexOf("nt")!==-1),t instanceof Ki){const P=t,{data:I,changed:N}=P.getDebugData();w=N?"*":"",A=I,f=P.byteLength,o=f/I.BYTES_PER_ELEMENT/a;let F;if(r){const Z=r.divisor>0;F="".concat(Z?"I ":"P "," ").concat(o," (x").concat(a,"=").concat(f," bytes ").concat(md(n,s),")")}else m=!0,F="".concat(f," bytes");return{[i]:"".concat(w).concat(u0(A,{size:a,isInteger:m})),"Format ":F}}return A=t,a=t.length,s=String(t.constructor.name).replace("Array",""),m=s.indexOf("nt")!==-1,{[i]:"".concat(u0(A,{size:a,isInteger:m})," (constant)"),"Format ":"".concat(a,"x").concat(s," (constant)")}}function VU(e,t){const{type:r,size:i}=t,n=mB(r,i);return n?"".concat(e," (").concat(n.name,")"):e}function qU(e){const t={},r="Accessors for ".concat(e.id);for(const i of e.attributeInfos)if(i){const n=lT(i);t["in ".concat(n)]={[r]:JSON.stringify(i.accessor)}}for(const i of e.varyingInfos)if(i){const n=lT(i);t["out ".concat(n)]={[r]:JSON.stringify(i.accessor)}}return t}function lT(e){const{type:t,size:r}=e.accessor,i=mB(t,r);return i?"".concat(i.name," ").concat(e.name):e.name}const cT=mh()&&typeof document<"u";let HU=0;class WU{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:r=Z=>nB(Z),onAddHTML:i=null,onInitialize:n=()=>{},onRender:s=()=>{},onFinalize:a=()=>{},onError:o,gl:f=null,glOptions:m={},debug:w=!1,createFramebuffer:A=!1,autoResizeViewport:P=!0,autoResizeDrawingBuffer:I=!0,stats:N=hf.get("animation-loop-".concat(HU++))}=t;let{useDevicePixels:F=!0}=t;"useDevicePixelRatio"in t&&(hr.deprecated("useDevicePixelRatio","useDevicePixels")(),F=t.useDevicePixelRatio),this.props={onCreateContext:r,onAddHTML:i,onInitialize:n,onRender:s,onFinalize:a,onError:o,gl:f,glOptions:m,debug:w,createFramebuffer:A},this.gl=f,this.needsRedraw=null,this.timeline=null,this.stats=N,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:P,autoResizeDrawingBuffer:I,useDevicePixels:F}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return rr(typeof t=="string"),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const r=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=v_.isSupported(this.gl,["timers"])?new v_(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&r.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(t);return i?Number(i.value):r}setViewParameters(){return hr.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=cT?new Promise((t,r)=>{if(cT&&document.readyState==="complete"){t(document);return}window.addEventListener("load",()=>{t(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):Q9(t)}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):Y9(t)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:r,aspect:i}=this._getSizeAndAspect();(t!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=r,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){typeof t=="object"&&t!==null&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&typeof OffscreenCanvas<"u"&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?pA(this.props.gl,t):this.onCreateContext(t),!rv(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");z9(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(r);const i=this.props.onAddHTML(r);i&&(r.innerHTML=i)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,r=this.gl.drawingBufferHeight;let i=1;const{canvas:n}=this.gl;return n&&n.clientHeight?i=n.clientWidth/n.clientHeight:t>0&&r>0&&(i=t/r),{width:t,height:r,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&q9(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new ws(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}const B0="vs",bA="fs";function Za(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const t2={number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},array:{validate(e,t){return Array.isArray(e)||ArrayBuffer.isView(e)}}};function $U(e){const t={};for(const r in e){const i=e[r],n=ZU(i);t[r]=n}return t}function ZU(e){let t=uT(e);return t==="object"?e?"type"in e?Object.assign({},e,t2[e.type]):"value"in e?(t=uT(e.value),Object.assign({type:t},e,t2[t])):{type:"object",value:e}:{type:"object",value:null}:Object.assign({type:t,value:e},t2[t])}function uT(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const JU="vs",XU="fs";class hT{constructor(t){let{name:r,vs:i,fs:n,dependencies:s=[],uniforms:a,getUniforms:o,deprecations:f=[],defines:m={},inject:w={},vertexShader:A,fragmentShader:P}=t;Za(typeof r=="string"),this.name=r,this.vs=i||A,this.fs=n||P,this.getModuleUniforms=o,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(f),this.defines=m,this.injections=KU(w),a&&(this.uniforms=$U(a))}getModuleSource(t){let r;switch(t){case JU:r=this.vs||"";break;case XU:r=this.fs||"";break;default:Za(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(r,"// END MODULE_").concat(this.name,`

`)}getUniforms(t,r){return this.getModuleUniforms?this.getModuleUniforms(t,r):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,r){this.deprecations.forEach(i=>{i.regex.test(t)&&(i.deprecated?r.deprecated(i.old,i.new)():r.removed(i.old,i.new)())})}_parseDeprecationDefinitions(t){return t.forEach(r=>{switch(r.type){case"function":r.regex=new RegExp("\\b".concat(r.old,"\\("));break;default:r.regex=new RegExp("".concat(r.type," ").concat(r.old,";"))}}),t}_defaultGetUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r={},i=this.uniforms;for(const n in i){const s=i[n];n in t&&!s.private?(s.validate&&Za(s.validate(t[n],s),"".concat(this.name,": invalid ").concat(n)),r[n]=t[n]):r[n]=s.value}return r}}function KU(e){const t={vs:{},fs:{}};for(const r in e){let i=e[r];const n=r.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),t[n][r]=i}return t}function YU(e){return QU(bB(e))}function QU(e){const t={},r={};return vB({modules:e,level:0,moduleMap:t,moduleDepth:r}),Object.keys(r).sort((i,n)=>r[n]-r[i]).map(i=>t[i])}function vB(e){let{modules:t,level:r,moduleMap:i,moduleDepth:n}=e;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)i[s.name]=s,(n[s.name]===void 0||n[s.name]<r)&&(n[s.name]=r);for(const s of t)s.dependencies&&vB({modules:s.dependencies,level:r+1,moduleMap:i,moduleDepth:n})}function bB(e,t){return e.map(r=>(r instanceof hT||(Za(typeof r!="string","Shader module use by name is deprecated. Import shader module '".concat(r,"' and use it directly.")),Za(r.name,"shader module has no name"),r=new hT(r),r.dependencies=bB(r.dependencies)),r))}function tG(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=typeof window<"u"?window.navigator||{}:{},r=e.userAgent||t.userAgent||"",i=r.indexOf("MSIE ")!==-1,n=r.indexOf("Trident/")!==-1;return i||n}const eG=7936,rG=7937,iG=7938,nG=35724,wA={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},ef={};Object.keys(wA).forEach(e=>{ef[e]=e});function sG(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}function oG(e){const t=e.getExtension("WEBGL_debug_renderer_info"),r=e.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||eG),i=e.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||rG);return{gpuVendor:aG(r,i),vendor:r,renderer:i,version:e.getParameter(iG),shadingLanguageVersion:e.getParameter(nG)}}function aG(e,t){return e.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":e.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":e.match(/AMD/i)||t.match(/AMD/i)||e.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const e2={};function dT(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=wA[t];if(Za(i,t),!tG(r))return!0;if(t in e2)return e2[t];const n=i[0],s=r.behavior||"enable",a="#extension GL_".concat(n," : ").concat(s,`
void main(void) {}`),o=e.createShader(35633);e.shaderSource(o,a),e.compileShader(o);const f=e.getShaderParameter(o,35713);return e.deleteShader(o),e2[t]=f,f}function lG(e,t){const r=wA[t];Za(r,t);const i=sG(e)&&r[1]||r[0],n=typeof i=="string"?!!e.getExtension(i):i;return Za(n===!1||n===!0),n}function D1(e,t){return t=Array.isArray(t)?t:[t],t.every(r=>lG(e,r))}function cG(e){switch(oG(e).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function uG(e,t,r){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return D1(e,ef.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),D1(e,ef.GLSL_DERIVATIVES)&&dT(e,ef.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),D1(e,ef.GLSL_FRAG_DATA)&&dT(e,ef.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),D1(e,ef.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const hG=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,dG=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,fG={[B0]:hG,[bA]:dG},wy="__LUMA_INJECT_DECLARATIONS__",fT=/void\s+main\s*\([^)]*\)\s*\{\n?/,pT=/}\n?[^{}]*$/,r2=[];function gT(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const n=t===B0;for(const s in r){const a=r[s];a.sort((f,m)=>f.order-m.order),r2.length=a.length;for(let f=0,m=a.length;f<m;++f)r2[f]=a[f].injection;const o="".concat(r2.join(`
`),`
`);switch(s){case"vs:#decl":n&&(e=e.replace(wy,o));break;case"vs:#main-start":n&&(e=e.replace(fT,f=>f+o));break;case"vs:#main-end":n&&(e=e.replace(pT,f=>o+f));break;case"fs:#decl":n||(e=e.replace(wy,o));break;case"fs:#main-start":n||(e=e.replace(fT,f=>f+o));break;case"fs:#main-end":n||(e=e.replace(pT,f=>o+f));break;default:e=e.replace(s,f=>f+o)}}return e=e.replace(wy,""),i&&(e=e.replace(/\}\s*$/,s=>s+fG[t])),e}function ox(e){const t={};return Za(Array.isArray(e)&&e.length>1),e.forEach(r=>{for(const i in r)t[i]=t[i]?"".concat(t[i],`
`).concat(r[i]):r[i]}),t}function cg(e){return new RegExp("\\b".concat(e,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const wB=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],pG=[...wB,[cg("attribute"),"in $1"],[cg("varying"),"out $1"]],gG=[...wB,[cg("varying"),"in $1"]],xB=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],mG=[...xB,[cg("in"),"attribute $1"],[cg("out"),"varying $1"]],yG=[...xB,[cg("in"),"varying $1"]],ax="gl_FragColor",lx=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,_G=/void\s+main\s*\([^)]*\)\s*\{\n?/;function vG(e,t,r){switch(t){case 300:return r?b_(e,pG):bG(e);case 100:return r?b_(e,mG):wG(e);default:throw new Error("unknown GLSL version ".concat(t))}}function b_(e,t){for(const[r,i]of t)e=e.replace(r,i);return e}function bG(e){e=b_(e,gG);const t=e.match(lx);if(t){const r=t[1];e=e.replace(new RegExp("\\b".concat(ax,"\\b"),"g"),r)}else{const r="fragmentColor";e=e.replace(_G,i=>"out vec4 ".concat(r,`;
`).concat(i)).replace(new RegExp("\\b".concat(ax,"\\b"),"g"),r)}return e}function wG(e){e=b_(e,yG);const t=e.match(lx);if(t){const r=t[1];e=e.replace(lx,"").replace(new RegExp("\\b".concat(r,"\\b"),"g"),ax)}return e}const xG=`

`.concat(wy,`

`),AB={[B0]:"vertex",[bA]:"fragment"},AG=`precision highp float;

`;function SG(e,t){const{vs:r,fs:i}=t,n=YU(t.modules||[]);return{gl:e,vs:mT(e,Object.assign({},t,{source:r,type:B0,modules:n})),fs:mT(e,Object.assign({},t,{source:i,type:bA,modules:n})),getUniforms:EG(n)}}function mT(e,t){let{id:r,source:i,type:n,modules:s,defines:a={},hookFunctions:o=[],inject:f={},transpileToGLSL100:m=!1,prologue:w=!0,log:A}=t;Za(typeof i=="string","shader source must be a string");const P=n===B0,I=i.split(`
`);let N=100,F="",Z=i;I[0].indexOf("#version ")===0?(N=300,F=I[0],Z=I.slice(1).join(`
`)):F="#version ".concat(N);const U={};s.forEach(bt=>{Object.assign(U,bt.getDefines())}),Object.assign(U,a);let z=w?"".concat(F,`
`).concat(TG({id:r,source:i,type:n}),`
`).concat(CG({type:n}),`
`).concat(cG(e),`
`).concat(uG(e),`
`).concat(PG(U),`
`).concat(P?"":AG,`
`):"".concat(F,`
`);const J=MG(o),nt={},mt={},Et={};for(const bt in f){const pt=typeof f[bt]=="string"?{injection:f[bt],order:0}:f[bt],zt=bt.match(/^(v|f)s:(#)?([\w-]+)$/);if(zt){const Rt=zt[2],at=zt[3];Rt?at==="decl"?mt[bt]=[pt]:Et[bt]=[pt]:nt[bt]=[pt]}else Et[bt]=[pt]}for(const bt of s){A&&bt.checkDeprecations(Z,A);const pt=bt.getModuleSource(n,N);z+=pt;const zt=bt.injections[n];for(const Rt in zt){const at=Rt.match(/^(v|f)s:#([\w-]+)$/);if(at){const dt=at[2]==="decl"?mt:Et;dt[Rt]=dt[Rt]||[],dt[Rt].push(zt[Rt])}else nt[Rt]=nt[Rt]||[],nt[Rt].push(zt[Rt])}}return z+=xG,z=gT(z,n,mt),z+=IG(J[n],nt),z+=Z,z=gT(z,n,Et),z=vG(z,m?100:N,P),z}function EG(e){return function(t){const r={};for(const i of e){const n=i.getUniforms(t,r);Object.assign(r,n)}return r}}function CG(e){let{type:t}=e;return`
#define SHADER_TYPE_`.concat(AB[t].toUpperCase(),`
`)}function TG(e){let{id:t,source:r,type:i}=e;return t&&typeof t=="string"&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(t,"_").concat(AB[i],`

`):""}function PG(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=0,r="";for(const i in e){t===0&&(r+=`
// APPLICATION DEFINES
`),t++;const n=e[i];(n||Number.isFinite(n))&&(r+="#define ".concat(i.toUpperCase()," ").concat(e[i],`
`))}return t===0&&(r+=`
`),r}function IG(e,t){let r="";for(const i in e){const n=e[i];if(r+="void ".concat(n.signature,` {
`),n.header&&(r+="  ".concat(n.header)),t[i]){const s=t[i];s.sort((a,o)=>a.order-o.order);for(const a of s)r+="  ".concat(a.injection,`
`)}n.footer&&(r+="  ".concat(n.footer)),r+=`}
`}return r}function MG(e){const t={vs:{},fs:{}};return e.forEach(r=>{let i;typeof r!="string"?(i=r,r=i.hook):i={},r=r.trim();const[n,s]=r.split(":"),a=r.replace(/\(.+/,"");t[n][a]=Object.assign(i,{signature:s})}),t}const LG="void main() {gl_FragColor = vec4(0);}",SB=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,BG=`#version 300 es
`.concat(SB);function EB(e,t){t=Array.isArray(t)?t:[t];const r=e.replace(/^\s+/,"").split(/\s+/),[i,n,s]=r;if(!t.includes(i)||!n||!s)return null;const a=s.split(";")[0];return{qualifier:i,type:n,name:a}}function CB(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:t=100,input:r,inputType:i,output:n}=e;if(!r)return t===300?BG:t>300?"#version ".concat(t,`
`).concat(SB):LG;const s=OG(r,i);return t>=300?"#version ".concat(t," ").concat(t===300?"es":"",`
in `).concat(i," ").concat(r,`;
out vec4 `).concat(n,`;
void main() {
  `).concat(n," = ").concat(s,`;
}`):"varying ".concat(i," ").concat(r,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function kG(e){switch(e){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Za(!1),null}}function RG(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Za(!1),null}}function OG(e,t){switch(t){case"float":return"vec4(".concat(e,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(e,", 0.0, 1.0)");case"vec3":return"vec4(".concat(e,", 1.0)");case"vec4":return e;default:return Za(!1),null}}const DG=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,NG={name:"fp32",vs:DG,fs:null};function xc(e,t){if(!e)throw new Error("math.gl assertion ".concat(t))}const FG=1/Math.PI*180,zG=1/180*Math.PI,bs={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function jG(e){let{precision:t=bs.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e=qG(e),"".concat(parseFloat(e.toPrecision(t)))}function xd(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function UG(e){return VG(e)}function GG(e){return th(e)}function VG(e,t){return xA(e,r=>r*zG,t)}function th(e,t){return xA(e,r=>r*FG,t)}function eh(e,t,r){return xA(e,i=>Math.max(t,Math.min(r,i)))}function w_(e,t,r){return xd(e)?e.map((i,n)=>w_(i,t[n],r)):r*t+(1-r)*e}function Pc(e,t,r){const i=bs.EPSILON;r&&(bs.EPSILON=r);try{if(e===t)return!0;if(xd(e)&&xd(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Pc(e[n],t[n]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=bs.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{bs.EPSILON=i}}function qG(e){return Math.round(e/bs.EPSILON)*bs.EPSILON}function HG(e){return e.clone?e.clone():new Array(e.length)}function xA(e,t,r){if(xd(e)){const i=e;r=r||HG(i);for(let n=0;n<r.length&&n<i.length;++n)r[n]=t(e[n],n,r);return r}return t(e)}function WG(e){function t(){var r=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(r,Object.getPrototypeOf(this)),r}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}class AA extends WG(Array){clone(){return new this.constructor().copy(this)}fromArray(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let i=0;i<this.ELEMENTS;++i)this[i]=t[i+r];return this.check()}toArray(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let i=0;i<this.ELEMENTS;++i)t[r+i]=this[i];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:xd(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(bs)}formatString(t){let r="";for(let i=0;i<this.ELEMENTS;++i)r+=(i>0?", ":"")+jG(this[i],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(r,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!Pc(this[r],t[r]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==t[r])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,r,i){if(i===void 0)return this.lerp(this,t,r);for(let n=0;n<this.ELEMENTS;++n){const s=t[n];this[n]=s+i*(r[n]-s)}return this.check()}min(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(t[r],this[r]);return this.check()}max(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(t[r],this[r]);return this.check()}clamp(t,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t[i]),r[i]);return this.check()}add(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(const n of r)for(let s=0;s<this.ELEMENTS;++s)this[s]+=n[s];return this.check()}subtract(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(const n of r)for(let s=0;s<this.ELEMENTS;++s)this[s]-=n[s];return this.check()}scale(t){if(typeof t=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;else for(let r=0;r<this.ELEMENTS&&r<t.length;++r)this[r]*=t[r];return this.check()}multiplyByScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}check(){if(bs.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)t=t&&Number.isFinite(this[r]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=t;return this.check()}addScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t),r);return this.check()}get elements(){return this}}function $G(e,t){if(e.length!==t)return!1;for(let r=0;r<e.length;++r)if(!Number.isFinite(e[r]))return!1;return!0}function ki(e){if(!Number.isFinite(e))throw new Error("Invalid number ".concat(e));return e}function Fm(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(bs.debug&&!$G(e,t))throw new Error("math.gl: ".concat(r," some fields set to invalid numbers'"));return e}class SA extends AA{get x(){return this[0]}set x(t){this[0]=ki(t)}get y(){return this[1]}set y(t){this[1]=ki(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*this[r];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let r=0;for(let i=0;i<this.ELEMENTS;++i){const n=this[i]-t[i];r+=n*n}return ki(r)}dot(t){let r=0;for(let i=0;i<this.ELEMENTS;++i)r+=this[i]*t[i];return ki(r)}normalize(){const t=this.magnitude();if(t!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t;return this.check()}multiply(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(const n of r)for(let s=0;s<this.ELEMENTS;++s)this[s]*=n[s];return this.check()}divide(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(const n of r)for(let s=0;s<this.ELEMENTS;++s)this[s]/=n[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return xc(t>=0&&t<this.ELEMENTS,"index is out of range"),ki(this[t])}setComponent(t,r){return xc(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=r,this.check()}addVectors(t,r){return this.copy(t).add(r)}subVectors(t,r){return this.copy(t).subtract(r)}multiplyVectors(t,r){return this.copy(t).multiply(r)}addScaledVector(t,r){return this.add(new this.constructor(t).multiplyScalar(r))}}var zm=1e-6,Mc=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function ZG(){var e=new Mc(2);return Mc!=Float32Array&&(e[0]=0,e[1]=0),e}function yT(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function JG(e,t){return e[0]=-t[0],e[1]=-t[1],e}function TB(e,t,r,i){var n=t[0],s=t[1];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e}function XG(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function KG(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function PB(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function IB(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}(function(){var e=ZG();return function(t,r,i,n,s,a){var o,f;for(r||(r=2),i||(i=0),n?f=Math.min(n*r+i,t.length):f=t.length,o=i;o<f;o+=r)e[0]=t[o],e[1]=t[o+1],s(e,e,a),t[o]=e[0],t[o+1]=e[1];return t}})();function MB(e,t,r){const i=t[0],n=t[1],s=r[3]*i+r[7]*n||1;return e[0]=(r[0]*i+r[4]*n)/s,e[1]=(r[1]*i+r[5]*n)/s,e}function LB(e,t,r){const i=t[0],n=t[1],s=t[2],a=r[3]*i+r[7]*n+r[11]*s||1;return e[0]=(r[0]*i+r[4]*n+r[8]*s)/a,e[1]=(r[1]*i+r[5]*n+r[9]*s)/a,e[2]=(r[2]*i+r[6]*n+r[10]*s)/a,e}function YG(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e[2]=t[2],e}function QG(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e[2]=t[2],e[3]=t[3],e}function BB(e,t,r){const i=t[0],n=t[1],s=t[2];return e[0]=r[0]*i+r[3]*n+r[6]*s,e[1]=r[1]*i+r[4]*n+r[7]*s,e[2]=r[2]*i+r[5]*n+r[8]*s,e[3]=t[3],e}class EA extends SA{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),xd(t)&&arguments.length===1?this.copy(t):(bs.debug&&(ki(t),ki(r)),this[0]=t,this[1]=r)}set(t,r){return this[0]=t,this[1]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return bs.debug&&(ki(t.x),ki(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return IB(this,this,t),this.check()}transformAsVector(t){return MB(this,this,t),this.check()}transformByMatrix3(t){return PB(this,this,t),this.check()}transformByMatrix2x3(t){return KG(this,this,t),this.check()}transformByMatrix2(t){return XG(this,this,t),this.check()}}function kB(){var e=new Mc(3);return Mc!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function RB(e){var t=e[0],r=e[1],i=e[2];return Math.hypot(t,r,i)}function _T(e,t,r){var i=new Mc(3);return i[0]=e,i[1]=t,i[2]=r,i}function tV(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function eV(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function rV(e,t){var r=t[0],i=t[1],n=t[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function CA(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function xy(e,t,r){var i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],f=r[2];return e[0]=n*f-s*o,e[1]=s*a-i*f,e[2]=i*o-n*a,e}function TA(e,t,r){var i=t[0],n=t[1],s=t[2],a=r[3]*i+r[7]*n+r[11]*s+r[15];return a=a||1,e[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/a,e[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/a,e[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/a,e}function OB(e,t,r){var i=t[0],n=t[1],s=t[2];return e[0]=i*r[0]+n*r[3]+s*r[6],e[1]=i*r[1]+n*r[4]+s*r[7],e[2]=i*r[2]+n*r[5]+s*r[8],e}function DB(e,t,r){var i=r[0],n=r[1],s=r[2],a=r[3],o=t[0],f=t[1],m=t[2],w=n*m-s*f,A=s*o-i*m,P=i*f-n*o,I=n*P-s*A,N=s*w-i*P,F=i*A-n*w,Z=a*2;return w*=Z,A*=Z,P*=Z,I*=2,N*=2,F*=2,e[0]=o+w+I,e[1]=f+A+N,e[2]=m+P+F,e}function iV(e,t,r,i){var n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function nV(e,t,r,i){var n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function sV(e,t,r,i){var n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function oV(e,t){var r=e[0],i=e[1],n=e[2],s=t[0],a=t[1],o=t[2],f=Math.sqrt(r*r+i*i+n*n),m=Math.sqrt(s*s+a*a+o*o),w=f*m,A=w&&CA(e,t)/w;return Math.acos(Math.min(Math.max(A,-1),1))}var aV=tV,lV=RB;(function(){var e=kB();return function(t,r,i,n,s,a){var o,f;for(r||(r=3),i||(i=0),n?f=Math.min(n*r+i,t.length):f=t.length,o=i;o<f;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],s(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}})();const i2=[0,0,0];let N1;class se extends SA{static get ZERO(){return N1||(N1=new se(0,0,0),Object.freeze(N1)),N1}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&xd(t)?this.copy(t):(bs.debug&&(ki(t),ki(r),ki(i)),this[0]=t,this[1]=r,this[2]=i)}set(t,r,i){return this[0]=t,this[1]=r,this[2]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return bs.debug&&(ki(t.x),ki(t.y),ki(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=ki(t)}angle(t){return oV(this,t)}cross(t){return xy(this,this,t),this.check()}rotateX(t){let{radians:r,origin:i=i2}=t;return iV(this,this,i,r),this.check()}rotateY(t){let{radians:r,origin:i=i2}=t;return nV(this,this,i,r),this.check()}rotateZ(t){let{radians:r,origin:i=i2}=t;return sV(this,this,i,r),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return TA(this,this,t),this.check()}transformAsVector(t){return LB(this,this,t),this.check()}transformByMatrix3(t){return OB(this,this,t),this.check()}transformByMatrix2(t){return YG(this,this,t),this.check()}transformByQuaternion(t){return DB(this,this,t),this.check()}}let F1;class PA extends SA{static get ZERO(){return F1||(F1=new PA(0,0,0,0),Object.freeze(F1)),F1}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),xd(t)&&arguments.length===1?this.copy(t):(bs.debug&&(ki(t),ki(r),ki(i),ki(n)),this[0]=t,this[1]=r,this[2]=i,this[3]=n)}set(t,r,i,n){return this[0]=t,this[1]=r,this[2]=i,this[3]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return bs.debug&&(ki(t.x),ki(t.y),ki(t.z),ki(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=ki(t)}get w(){return this[3]}set w(t){this[3]=ki(t)}transform(t){return TA(this,this,t),this.check()}transformByMatrix3(t){return BB(this,this,t),this.check()}transformByMatrix2(t){return QG(this,this,t),this.check()}transformByQuaternion(t){return DB(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class NB extends AA{toString(){let t="[";if(bs.printRowMajor){t+="row-major:";for(let r=0;r<this.RANK;++r)for(let i=0;i<this.RANK;++i)t+=" ".concat(this[i*this.RANK+r])}else{t+="column-major:";for(let r=0;r<this.ELEMENTS;++r)t+=" ".concat(this[r])}return t+="]",t}getElementIndex(t,r){return r*this.RANK+t}getElement(t,r){return this[r*this.RANK+t]}setElement(t,r,i){return this[r*this.RANK+t]=ki(i),this}getColumn(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const i=t*this.RANK;for(let n=0;n<this.RANK;++n)r[n]=this[i+n];return r}setColumn(t,r){const i=t*this.RANK;for(let n=0;n<this.RANK;++n)this[i+n]=r[n];return this}}function cV(){var e=new Mc(9);return Mc!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function uV(e,t){if(e===t){var r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function hV(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],f=t[6],m=t[7],w=t[8],A=w*a-o*m,P=-w*s+o*f,I=m*s-a*f,N=r*A+i*P+n*I;return N?(N=1/N,e[0]=A*N,e[1]=(-w*i+n*m)*N,e[2]=(o*i-n*a)*N,e[3]=P*N,e[4]=(w*r-n*f)*N,e[5]=(-o*r+n*s)*N,e[6]=I*N,e[7]=(-m*r+i*f)*N,e[8]=(a*r-i*s)*N,e):null}function dV(e){var t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],f=e[7],m=e[8];return t*(m*s-a*f)+r*(-m*n+a*o)+i*(f*n-s*o)}function vT(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],f=t[5],m=t[6],w=t[7],A=t[8],P=r[0],I=r[1],N=r[2],F=r[3],Z=r[4],U=r[5],z=r[6],J=r[7],nt=r[8];return e[0]=P*i+I*a+N*m,e[1]=P*n+I*o+N*w,e[2]=P*s+I*f+N*A,e[3]=F*i+Z*a+U*m,e[4]=F*n+Z*o+U*w,e[5]=F*s+Z*f+U*A,e[6]=z*i+J*a+nt*m,e[7]=z*n+J*o+nt*w,e[8]=z*s+J*f+nt*A,e}function fV(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],f=t[5],m=t[6],w=t[7],A=t[8],P=r[0],I=r[1];return e[0]=i,e[1]=n,e[2]=s,e[3]=a,e[4]=o,e[5]=f,e[6]=P*i+I*a+m,e[7]=P*n+I*o+w,e[8]=P*s+I*f+A,e}function pV(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],f=t[5],m=t[6],w=t[7],A=t[8],P=Math.sin(r),I=Math.cos(r);return e[0]=I*i+P*a,e[1]=I*n+P*o,e[2]=I*s+P*f,e[3]=I*a-P*i,e[4]=I*o-P*n,e[5]=I*f-P*s,e[6]=m,e[7]=w,e[8]=A,e}function bT(e,t,r){var i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function gV(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=r+r,o=i+i,f=n+n,m=r*a,w=i*a,A=i*o,P=n*a,I=n*o,N=n*f,F=s*a,Z=s*o,U=s*f;return e[0]=1-A-N,e[3]=w-U,e[6]=P+Z,e[1]=w+U,e[4]=1-m-N,e[7]=I-F,e[2]=P-Z,e[5]=I+F,e[8]=1-m-A,e}var cx;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(cx||(cx={}));const mV=Object.freeze([1,0,0,0,1,0,0,0,1]);class $n extends NB{static get IDENTITY(){return _V()}static get ZERO(){return yV()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return cx}constructor(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):i.length>0?this.copy([t,...i]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(mV)}fromObject(t){return this.check()}fromQuaternion(t){return gV(this,t),this.check()}set(t,r,i,n,s,a,o,f,m){return this[0]=t,this[1]=r,this[2]=i,this[3]=n,this[4]=s,this[5]=a,this[6]=o,this[7]=f,this[8]=m,this.check()}setRowMajor(t,r,i,n,s,a,o,f,m){return this[0]=t,this[1]=n,this[2]=o,this[3]=r,this[4]=s,this[5]=f,this[6]=i,this[7]=a,this[8]=m,this.check()}determinant(){return dV(this)}transpose(){return uV(this,this),this.check()}invert(){return hV(this,this),this.check()}multiplyLeft(t){return vT(this,t,this),this.check()}multiplyRight(t){return vT(this,this,t),this.check()}rotate(t){return pV(this,this,t),this.check()}scale(t){return Array.isArray(t)?bT(this,this,t):bT(this,this,[t,t]),this.check()}translate(t){return fV(this,this,t),this.check()}transform(t,r){let i;switch(t.length){case 2:i=PB(r||[-0,-0],t,this);break;case 3:i=OB(r||[-0,-0,-0],t,this);break;case 4:i=BB(r||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Fm(i,t.length),i}transformVector(t,r){return this.transform(t,r)}transformVector2(t,r){return this.transform(t,r)}transformVector3(t,r){return this.transform(t,r)}}let z1,j1;function yV(){return z1||(z1=new $n([0,0,0,0,0,0,0,0,0]),Object.freeze(z1)),z1}function _V(){return j1||(j1=new $n,Object.freeze(j1)),j1}function vV(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bV(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],s=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=n,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function ux(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],f=t[6],m=t[7],w=t[8],A=t[9],P=t[10],I=t[11],N=t[12],F=t[13],Z=t[14],U=t[15],z=r*o-i*a,J=r*f-n*a,nt=r*m-s*a,mt=i*f-n*o,Et=i*m-s*o,bt=n*m-s*f,pt=w*F-A*N,zt=w*Z-P*N,Rt=w*U-I*N,at=A*Z-P*F,dt=A*U-I*F,kt=P*U-I*Z,xt=z*kt-J*dt+nt*at+mt*Rt-Et*zt+bt*pt;return xt?(xt=1/xt,e[0]=(o*kt-f*dt+m*at)*xt,e[1]=(n*dt-i*kt-s*at)*xt,e[2]=(F*bt-Z*Et+U*mt)*xt,e[3]=(P*Et-A*bt-I*mt)*xt,e[4]=(f*Rt-a*kt-m*zt)*xt,e[5]=(r*kt-n*Rt+s*zt)*xt,e[6]=(Z*nt-N*bt-U*J)*xt,e[7]=(w*bt-P*nt+I*J)*xt,e[8]=(a*dt-o*Rt+m*pt)*xt,e[9]=(i*Rt-r*dt-s*pt)*xt,e[10]=(N*Et-F*nt+U*z)*xt,e[11]=(A*nt-w*Et-I*z)*xt,e[12]=(o*zt-a*at-f*pt)*xt,e[13]=(r*at-i*zt+n*pt)*xt,e[14]=(F*J-N*mt-Z*z)*xt,e[15]=(w*mt-A*J+P*z)*xt,e):null}function wV(e){var t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],f=e[7],m=e[8],w=e[9],A=e[10],P=e[11],I=e[12],N=e[13],F=e[14],Z=e[15],U=t*a-r*s,z=t*o-i*s,J=t*f-n*s,nt=r*o-i*a,mt=r*f-n*a,Et=i*f-n*o,bt=m*N-w*I,pt=m*F-A*I,zt=m*Z-P*I,Rt=w*F-A*N,at=w*Z-P*N,dt=A*Z-P*F;return U*dt-z*at+J*Rt+nt*zt-mt*pt+Et*bt}function _f(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],f=t[5],m=t[6],w=t[7],A=t[8],P=t[9],I=t[10],N=t[11],F=t[12],Z=t[13],U=t[14],z=t[15],J=r[0],nt=r[1],mt=r[2],Et=r[3];return e[0]=J*i+nt*o+mt*A+Et*F,e[1]=J*n+nt*f+mt*P+Et*Z,e[2]=J*s+nt*m+mt*I+Et*U,e[3]=J*a+nt*w+mt*N+Et*z,J=r[4],nt=r[5],mt=r[6],Et=r[7],e[4]=J*i+nt*o+mt*A+Et*F,e[5]=J*n+nt*f+mt*P+Et*Z,e[6]=J*s+nt*m+mt*I+Et*U,e[7]=J*a+nt*w+mt*N+Et*z,J=r[8],nt=r[9],mt=r[10],Et=r[11],e[8]=J*i+nt*o+mt*A+Et*F,e[9]=J*n+nt*f+mt*P+Et*Z,e[10]=J*s+nt*m+mt*I+Et*U,e[11]=J*a+nt*w+mt*N+Et*z,J=r[12],nt=r[13],mt=r[14],Et=r[15],e[12]=J*i+nt*o+mt*A+Et*F,e[13]=J*n+nt*f+mt*P+Et*Z,e[14]=J*s+nt*m+mt*I+Et*U,e[15]=J*a+nt*w+mt*N+Et*z,e}function x_(e,t,r){var i=r[0],n=r[1],s=r[2],a,o,f,m,w,A,P,I,N,F,Z,U;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*s+t[12],e[13]=t[1]*i+t[5]*n+t[9]*s+t[13],e[14]=t[2]*i+t[6]*n+t[10]*s+t[14],e[15]=t[3]*i+t[7]*n+t[11]*s+t[15]):(a=t[0],o=t[1],f=t[2],m=t[3],w=t[4],A=t[5],P=t[6],I=t[7],N=t[8],F=t[9],Z=t[10],U=t[11],e[0]=a,e[1]=o,e[2]=f,e[3]=m,e[4]=w,e[5]=A,e[6]=P,e[7]=I,e[8]=N,e[9]=F,e[10]=Z,e[11]=U,e[12]=a*i+w*n+N*s+t[12],e[13]=o*i+A*n+F*s+t[13],e[14]=f*i+P*n+Z*s+t[14],e[15]=m*i+I*n+U*s+t[15]),e}function IA(e,t,r){var i=r[0],n=r[1],s=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function xV(e,t,r,i){var n=i[0],s=i[1],a=i[2],o=Math.hypot(n,s,a),f,m,w,A,P,I,N,F,Z,U,z,J,nt,mt,Et,bt,pt,zt,Rt,at,dt,kt,xt,ue;return o<zm?null:(o=1/o,n*=o,s*=o,a*=o,f=Math.sin(r),m=Math.cos(r),w=1-m,A=t[0],P=t[1],I=t[2],N=t[3],F=t[4],Z=t[5],U=t[6],z=t[7],J=t[8],nt=t[9],mt=t[10],Et=t[11],bt=n*n*w+m,pt=s*n*w+a*f,zt=a*n*w-s*f,Rt=n*s*w-a*f,at=s*s*w+m,dt=a*s*w+n*f,kt=n*a*w+s*f,xt=s*a*w-n*f,ue=a*a*w+m,e[0]=A*bt+F*pt+J*zt,e[1]=P*bt+Z*pt+nt*zt,e[2]=I*bt+U*pt+mt*zt,e[3]=N*bt+z*pt+Et*zt,e[4]=A*Rt+F*at+J*dt,e[5]=P*Rt+Z*at+nt*dt,e[6]=I*Rt+U*at+mt*dt,e[7]=N*Rt+z*at+Et*dt,e[8]=A*kt+F*xt+J*ue,e[9]=P*kt+Z*xt+nt*ue,e[10]=I*kt+U*xt+mt*ue,e[11]=N*kt+z*xt+Et*ue,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function FB(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[4],a=t[5],o=t[6],f=t[7],m=t[8],w=t[9],A=t[10],P=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+m*i,e[5]=a*n+w*i,e[6]=o*n+A*i,e[7]=f*n+P*i,e[8]=m*n-s*i,e[9]=w*n-a*i,e[10]=A*n-o*i,e[11]=P*n-f*i,e}function AV(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],f=t[3],m=t[8],w=t[9],A=t[10],P=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-m*i,e[1]=a*n-w*i,e[2]=o*n-A*i,e[3]=f*n-P*i,e[8]=s*i+m*n,e[9]=a*i+w*n,e[10]=o*i+A*n,e[11]=f*i+P*n,e}function zB(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],f=t[3],m=t[4],w=t[5],A=t[6],P=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+m*i,e[1]=a*n+w*i,e[2]=o*n+A*i,e[3]=f*n+P*i,e[4]=m*n-s*i,e[5]=w*n-a*i,e[6]=A*n-o*i,e[7]=P*n-f*i,e}function SV(e,t){var r=t[0],i=t[1],n=t[2],s=t[4],a=t[5],o=t[6],f=t[8],m=t[9],w=t[10];return e[0]=Math.hypot(r,i,n),e[1]=Math.hypot(s,a,o),e[2]=Math.hypot(f,m,w),e}function EV(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=r+r,o=i+i,f=n+n,m=r*a,w=i*a,A=i*o,P=n*a,I=n*o,N=n*f,F=s*a,Z=s*o,U=s*f;return e[0]=1-A-N,e[1]=w+U,e[2]=P-Z,e[3]=0,e[4]=w-U,e[5]=1-m-N,e[6]=I+F,e[7]=0,e[8]=P+Z,e[9]=I-F,e[10]=1-m-A,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function CV(e,t,r,i,n,s,a){var o=1/(r-t),f=1/(n-i),m=1/(s-a);return e[0]=s*2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*f,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(n+i)*f,e[10]=(a+s)*m,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*s*2*m,e[15]=0,e}function TV(e,t,r,i,n){var s=1/Math.tan(t/2),a;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0?(a=1/(i-n),e[10]=(n+i)*a,e[14]=2*n*i*a):(e[10]=-1,e[14]=-2*i),e}var PV=TV;function IV(e,t,r,i,n,s,a){var o=1/(t-r),f=1/(i-n),m=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*m,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*f,e[14]=(a+s)*m,e[15]=1,e}var MV=IV;function LV(e,t,r,i){var n,s,a,o,f,m,w,A,P,I,N=t[0],F=t[1],Z=t[2],U=i[0],z=i[1],J=i[2],nt=r[0],mt=r[1],Et=r[2];return Math.abs(N-nt)<zm&&Math.abs(F-mt)<zm&&Math.abs(Z-Et)<zm?vV(e):(w=N-nt,A=F-mt,P=Z-Et,I=1/Math.hypot(w,A,P),w*=I,A*=I,P*=I,n=z*P-J*A,s=J*w-U*P,a=U*A-z*w,I=Math.hypot(n,s,a),I?(I=1/I,n*=I,s*=I,a*=I):(n=0,s=0,a=0),o=A*a-P*s,f=P*n-w*a,m=w*s-A*n,I=Math.hypot(o,f,m),I?(I=1/I,o*=I,f*=I,m*=I):(o=0,f=0,m=0),e[0]=n,e[1]=o,e[2]=w,e[3]=0,e[4]=s,e[5]=f,e[6]=A,e[7]=0,e[8]=a,e[9]=m,e[10]=P,e[11]=0,e[12]=-(n*N+s*F+a*Z),e[13]=-(o*N+f*F+m*Z),e[14]=-(w*N+A*F+P*Z),e[15]=1,e)}function BV(){var e=new Mc(4);return Mc!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function kV(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function jB(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function RV(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.hypot(t,r,i,n)}function OV(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function DV(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=r*r+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=i*a,e[2]=n*a,e[3]=s*a,e}function NV(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function FV(e,t,r,i){var n=t[0],s=t[1],a=t[2],o=t[3];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=a+i*(r[2]-a),e[3]=o+i*(r[3]-o),e}function k0(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*a,e[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*a,e[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*a,e[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*a,e}function zV(e,t,r){var i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],f=r[2],m=r[3],w=m*i+o*s-f*n,A=m*n+f*i-a*s,P=m*s+a*n-o*i,I=-a*i-o*n-f*s;return e[0]=w*m+I*-a+A*-f-P*-o,e[1]=A*m+I*-o+P*-a-w*-f,e[2]=P*m+I*-f+w*-o-A*-a,e[3]=t[3],e}(function(){var e=BV();return function(t,r,i,n,s,a){var o,f;for(r||(r=4),i||(i=0),n?f=Math.min(n*r+i,t.length):f=t.length,o=i;o<f;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],s(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}})();var hx;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(hx||(hx={}));const jV=45*Math.PI/180,UV=1,n2=.1,s2=500,GV=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class di extends NB{static get IDENTITY(){return qV()}static get ZERO(){return VV()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return hx}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,r,i,n,s,a,o,f,m,w,A,P,I,N,F,Z){return this[0]=t,this[1]=r,this[2]=i,this[3]=n,this[4]=s,this[5]=a,this[6]=o,this[7]=f,this[8]=m,this[9]=w,this[10]=A,this[11]=P,this[12]=I,this[13]=N,this[14]=F,this[15]=Z,this.check()}setRowMajor(t,r,i,n,s,a,o,f,m,w,A,P,I,N,F,Z){return this[0]=t,this[1]=s,this[2]=m,this[3]=I,this[4]=r,this[5]=a,this[6]=w,this[7]=N,this[8]=i,this[9]=o,this[10]=A,this[11]=F,this[12]=n,this[13]=f,this[14]=P,this[15]=Z,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(GV)}fromObject(t){return this.check()}fromQuaternion(t){return EV(this,t),this.check()}frustum(t){const{left:r,right:i,bottom:n,top:s,near:a=n2,far:o=s2}=t;return o===1/0?HV(this,r,i,n,s,a):CV(this,r,i,n,s,a,o),this.check()}lookAt(t){const{eye:r,center:i=[0,0,0],up:n=[0,1,0]}=t;return LV(this,r,i,n),this.check()}ortho(t){const{left:r,right:i,bottom:n,top:s,near:a=n2,far:o=s2}=t;return MV(this,r,i,n,s,a,o),this.check()}orthographic(t){const{fovy:r=jV,aspect:i=UV,focalDistance:n=1,near:s=n2,far:a=s2}=t;wT(r);const o=r/2,f=n*Math.tan(o),m=f*i;return this.ortho({left:-m,right:m,bottom:-f,top:f,near:s,far:a})}perspective(t){const{fovy:r=45*Math.PI/180,aspect:i=1,near:n=.1,far:s=500}=t;return wT(r),PV(this,r,i,n,s),this.check()}determinant(){return wV(this)}getScale(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const i=this.getScale(r),n=1/i[0],s=1/i[1],a=1/i[2];return t[0]=this[0]*n,t[1]=this[1]*s,t[2]=this[2]*a,t[3]=0,t[4]=this[4]*n,t[5]=this[5]*s,t[6]=this[6]*a,t[7]=0,t[8]=this[8]*n,t[9]=this[9]*s,t[10]=this[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const i=this.getScale(r),n=1/i[0],s=1/i[1],a=1/i[2];return t[0]=this[0]*n,t[1]=this[1]*s,t[2]=this[2]*a,t[3]=this[4]*n,t[4]=this[5]*s,t[5]=this[6]*a,t[6]=this[8]*n,t[7]=this[9]*s,t[8]=this[10]*a,t}transpose(){return bV(this,this),this.check()}invert(){return ux(this,this),this.check()}multiplyLeft(t){return _f(this,t,this),this.check()}multiplyRight(t){return _f(this,this,t),this.check()}rotateX(t){return FB(this,this,t),this.check()}rotateY(t){return AV(this,this,t),this.check()}rotateZ(t){return zB(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,r){return xV(this,this,t,r),this.check()}scale(t){return IA(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return x_(this,this,t),this.check()}transform(t,r){return t.length===4?(r=k0(r||[-0,-0,-0,-0],t,this),Fm(r,4),r):this.transformAsPoint(t,r)}transformAsPoint(t,r){const{length:i}=t;let n;switch(i){case 2:n=IB(r||[-0,-0],t,this);break;case 3:n=TA(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Fm(n,t.length),n}transformAsVector(t,r){let i;switch(t.length){case 2:i=MB(r||[-0,-0],t,this);break;case 3:i=LB(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Fm(i,t.length),i}transformPoint(t,r){return this.transformAsPoint(t,r)}transformVector(t,r){return this.transformAsPoint(t,r)}transformDirection(t,r){return this.transformAsVector(t,r)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,r,i){return this.identity().translate([t,r,i])}}let U1,G1;function VV(){return U1||(U1=new di([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(U1)),U1}function qV(){return G1||(G1=new di,Object.freeze(G1)),G1}function wT(e){if(e>Math.PI*2)throw Error("expected radians")}function HV(e,t,r,i,n,s){const a=2*s/(r-t),o=2*s/(n-i),f=(r+t)/(r-t),m=(n+i)/(n-i),w=-1,A=-1,P=-2*s;return e[0]=a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=f,e[9]=m,e[10]=w,e[11]=A,e[12]=0,e[13]=0,e[14]=P,e[15]=0,e}function xT(){var e=new Mc(4);return Mc!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function WV(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function UB(e,t,r){r=r*.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function AT(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=r[0],f=r[1],m=r[2],w=r[3];return e[0]=i*w+a*o+n*m-s*f,e[1]=n*w+a*f+s*o-i*m,e[2]=s*w+a*m+i*f-n*o,e[3]=a*w-i*o-n*f-s*m,e}function $V(e,t,r){r*=.5;var i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),f=Math.cos(r);return e[0]=i*f+a*o,e[1]=n*f+s*o,e[2]=s*f-n*o,e[3]=a*f-i*o,e}function ZV(e,t,r){r*=.5;var i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),f=Math.cos(r);return e[0]=i*f-s*o,e[1]=n*f+a*o,e[2]=s*f+i*o,e[3]=a*f-n*o,e}function JV(e,t,r){r*=.5;var i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),f=Math.cos(r);return e[0]=i*f+n*o,e[1]=n*f-i*o,e[2]=s*f+a*o,e[3]=a*f-s*o,e}function XV(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e}function Ay(e,t,r,i){var n=t[0],s=t[1],a=t[2],o=t[3],f=r[0],m=r[1],w=r[2],A=r[3],P,I,N,F,Z;return I=n*f+s*m+a*w+o*A,I<0&&(I=-I,f=-f,m=-m,w=-w,A=-A),1-I>zm?(P=Math.acos(I),N=Math.sin(P),F=Math.sin((1-i)*P)/N,Z=Math.sin(i*P)/N):(F=1-i,Z=i),e[0]=F*n+Z*f,e[1]=F*s+Z*m,e[2]=F*a+Z*w,e[3]=F*o+Z*A,e}function KV(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=r*r+i*i+n*n+s*s,o=a?1/a:0;return e[0]=-r*o,e[1]=-i*o,e[2]=-n*o,e[3]=s*o,e}function YV(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function GB(e,t){var r=t[0]+t[4]+t[8],i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var s=(n+1)%3,a=(n+2)%3;i=Math.sqrt(t[n*3+n]-t[s*3+s]-t[a*3+a]+1),e[n]=.5*i,i=.5/i,e[3]=(t[s*3+a]-t[a*3+s])*i,e[s]=(t[s*3+n]+t[n*3+s])*i,e[a]=(t[a*3+n]+t[n*3+a])*i}return e}var QV=kV,tq=jB,eq=NV,rq=FV,iq=RV,nq=OV,VB=DV,sq=function(){var e=kB(),t=_T(1,0,0),r=_T(0,1,0);return function(i,n,s){var a=CA(n,s);return a<-.999999?(xy(e,t,n),lV(e)<1e-6&&xy(e,r,n),rV(e,e),UB(i,e,Math.PI),i):a>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(xy(e,n,s),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+a,VB(i,i))}}();(function(){var e=xT(),t=xT();return function(r,i,n,s,a,o){return Ay(e,i,a,o),Ay(t,n,s,o),Ay(r,e,t,2*o*(1-o)),r}})();(function(){var e=cV();return function(t,r,i,n){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],VB(t,GB(t,e))}})();const oq=[0,0,0,1];class h0 extends AA{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,r,i,n)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,r,i,n){return this[0]=t,this[1]=r,this[2]=i,this[3]=n,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return GB(this,t),this.check()}fromAxisRotation(t,r){return UB(this,t,r),this.check()}identity(){return WV(this),this.check()}setAxisAngle(t,r){return this.fromAxisRotation(t,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=ki(t)}get y(){return this[1]}set y(t){this[1]=ki(t)}get z(){return this[2]}set z(t){this[2]=ki(t)}get w(){return this[3]}set w(t){this[3]=ki(t)}len(){return iq(this)}lengthSquared(){return nq(this)}dot(t){return eq(this,t)}rotationTo(t,r){return sq(this,t,r),this.check()}add(t){return QV(this,this,t),this.check()}calculateW(){return XV(this,this),this.check()}conjugate(){return YV(this,this),this.check()}invert(){return KV(this,this),this.check()}lerp(t,r,i){return i===void 0?this.lerp(this,t,r):(rq(this,t,r,i),this.check())}multiplyRight(t){return AT(this,this,t),this.check()}multiplyLeft(t){return AT(this,t,this),this.check()}normalize(){const t=this.len(),r=t>0?1/t:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,t===0&&(this[3]=1),this.check()}rotateX(t){return $V(this,this,t),this.check()}rotateY(t){return ZV(this,this,t),this.check()}rotateZ(t){return JV(this,this,t),this.check()}scale(t){return tq(this,this,t),this.check()}slerp(t,r,i){let n,s,a;switch(arguments.length){case 1:({start:n=oq,target:s,ratio:a}=t);break;case 2:n=this,s=t,a=r;break;default:n=t,s=r,a=i}return Ay(this,n,s,a),this.check()}transformVector4(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new PA;return zV(r,t,this),Fm(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,r){return this.setAxisAngle(t,r)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const d0={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},ST=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,aq={lightSources:{}};function o2(){let{color:e=[0,0,0],intensity:t=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.map(r=>r*t/255)}function lq(e){let{ambientLight:t,pointLights:r=[],directionalLights:i=[]}=e;const n={};return t?n["lighting_uAmbientLight.color"]=o2(t):n["lighting_uAmbientLight.color"]=[0,0,0],r.forEach((s,a)=>{n["lighting_uPointLight[".concat(a,"].color")]=o2(s),n["lighting_uPointLight[".concat(a,"].position")]=s.position,n["lighting_uPointLight[".concat(a,"].attenuation")]=s.attenuation||[1,0,0]}),n.lighting_uPointLightCount=r.length,i.forEach((s,a)=>{n["lighting_uDirectionalLight[".concat(a,"].color")]=o2(s),n["lighting_uDirectionalLight[".concat(a,"].direction")]=s.direction}),n.lighting_uDirectionalLightCount=i.length,n}function qB(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:aq;if("lightSources"in e){const{ambientLight:t,pointLights:r,directionalLights:i}=e.lightSources||{};return t||r&&r.length>0||i&&i.length>0?Object.assign({},lq({ambientLight:t,pointLights:r,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){const t={pointLights:[],directionalLights:[]};for(const r of e.lights||[])switch(r.type){case"ambient":t.ambientLight=r;break;case"directional":t.directionalLights.push(r);break;case"point":t.pointLights.push(r);break}return qB({lightSources:t})}return{}}const MA={name:"lights",vs:ST,fs:ST,getUniforms:qB,defines:{MAX_LIGHTS:3}},cq=new Uint8Array([0,255,255,255]),uq={pickingSelectedColor:null,pickingHighlightColor:cq,pickingActive:!1,pickingAttribute:!1};function hq(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:uq;const t={};if(e.pickingSelectedColor!==void 0)if(!e.pickingSelectedColor)t.picking_uSelectedColorValid=0;else{const r=e.pickingSelectedColor.slice(0,3);t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=r}if(e.pickingHighlightColor){const r=Array.from(e.pickingHighlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),t.picking_uHighlightColor=r}return e.pickingActive!==void 0&&(t.picking_uActive=!!e.pickingActive,t.picking_uAttribute=!!e.pickingAttribute),t}const dq=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fq=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,pq={name:"picking",vs:dq,fs:fq,getUniforms:hq},HB=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,gq={};function mq(e){const{ambient:t=.35,diffuse:r=.6,shininess:i=32,specularColor:n=[30,30,30]}=e;return{lighting_uAmbient:t,lighting_uDiffuse:r,lighting_uShininess:i,lighting_uSpecularColor:n.map(s=>s/255)}}function WB(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:gq;if(!("material"in e))return{};const{material:t}=e;return t?mq(t):{lighting_uEnabled:!1}}const yq={name:"gouraud-lighting",dependencies:[MA],vs:HB,defines:{LIGHTING_VERTEX:1},getUniforms:WB},_q={name:"phong-lighting",dependencies:[MA],fs:HB,defines:{LIGHTING_FRAGMENT:1},getUniforms:WB},vq=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,bq=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,LA={name:"pbr",vs:vq,fs:bq,defines:{LIGHTING_FRAGMENT:1},dependencies:[MA]},wq=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,xq={name:"transform",vs:wq,fs:null};class R0{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new R0(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find(r=>r.name===t.name)||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const r=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==r),this.stateHash++}addShaderHook(t,r){r&&(t=Object.assign(r,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:r="",fs:i="",defines:n={},inject:s={},varyings:a=[],bufferMode:o=35981,transpileToGLSL100:f=!1}=t,m=this._getModuleList(t.modules),w=this._getHash(r),A=this._getHash(i),P=m.map(J=>this._getHash(J.name)).sort(),I=a.map(J=>this._getHash(J)),N=Object.keys(n).sort(),F=Object.keys(s).sort(),Z=[],U=[];for(const J of N)Z.push(this._getHash(J)),Z.push(this._getHash(n[J]));for(const J of F)U.push(this._getHash(J)),U.push(this._getHash(s[J]));const z="".concat(w,"/").concat(A,"D").concat(Z.join("/"),"M").concat(P.join("/"),"I").concat(U.join("/"),"V").concat(I.join("/"),"H").concat(this.stateHash,"B").concat(o).concat(f?"T":"");if(!this._programCache[z]){const J=SG(this.gl,{vs:r,fs:i,modules:m,inject:s,defines:n,hookFunctions:this._hookFunctions,transpileToGLSL100:f});this._programCache[z]=new yB(this.gl,{hash:z,vs:J.vs,fs:J.fs,varyings:a,bufferMode:o}),this._getUniforms[z]=J.getUniforms||(nt=>{}),this._useCounts[z]=0}return this._useCounts[z]++,this._programCache[z]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const r=t.hash;this._useCounts[r]--,this._useCounts[r]===0&&(this._programCache[r].delete(),delete this._programCache[r],delete this._getUniforms[r],delete this._useCounts[r])}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const r=new Array(this._defaultModules.length+t.length),i={};let n=0;for(let s=0,a=this._defaultModules.length;s<a;++s){const o=this._defaultModules[s],f=o.name;r[n++]=o,i[f]=!0}for(let s=0,a=t.length;s<a;++s){const o=t[s],f=o.name;i[f]||(r[n++]=o,i[f]=!0)}return r.length=n,r}}const Aq={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Sq(e,t,r){const i={};let n=t.indices;for(const s in t.attributes){const a=t.attributes[s],o=Eq(s,r);if(s==="indices")n=a;else if(a.constant)i[o]=a.value;else{const f=a.value,m={...a};delete m.value,i[o]=[new Ki(e,f),m],Cq(s,m)}}if(n){const s=n.value||n;rr(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const a={size:1,isIndexed:n.isIndexed===void 0?!0:n.isIndexed};i.indices=[new Ki(e,{data:s,target:34963}),a]}return i}function Eq(e,t){const{attributeMap:r=Aq}=t||{};return r&&r[e]||e}function Cq(e,t){let r;switch(e){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":r="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":r="vectors";break}switch(r){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2;break}rr(Number.isFinite(t.size),"attribute ".concat(e," needs size"))}const sp=2,Tq=1e4,Pq="Model needs drawMode and vertexCount",ET=()=>{},Iq={};class ug{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=fh("model")}=r;rr(rv(t)),this.id=i,this.gl=t,this.id=r.id||fh("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(r)}initialize(t){this.props={},this.programManager=t.programManager||R0.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:r=null,vs:i,fs:n,modules:s,defines:a,inject:o,varyings:f,bufferMode:m,transpileToGLSL100:w}=t;this.programProps={program:r,vs:i,fs:n,modules:s,defines:a,inject:o,varyings:f,bufferMode:m,transpileToGLSL100:w},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=t.drawMode!==void 0?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},rr(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),Pq)}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:r,vs:i,fs:n,modules:s,defines:a,inject:o,varyings:f,bufferMode:m,transpileToGLSL100:w}=t;this.programProps={program:r,vs:i,fs:n,modules:s,defines:a,inject:o,varyings:f,bufferMode:m,transpileToGLSL100:w},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return rr(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return rr(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=Sq(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ag(t))return this;const r={};for(const i in t){const n=t[i];r[i]=n.getValue?n.getValue():n}return this.vertexArray.setAttributes(r),this}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const r=this.programManager.getUniforms(this.program);return r?r(t):{}}updateModuleSettings(t){const r=this.getModuleUniforms(t||{});return this.setUniforms(r)}clear(t){return yA(this.program.gl,t),this}draw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:r=null,framebuffer:i,uniforms:n={},attributes:s={},transformFeedback:a=this.transformFeedback,parameters:o={},vertexArray:f=this.vertexArray}=t;this.setAttributes(s),this.updateModuleSettings(r),this.setUniforms(n);let m;hr.priority>=sp&&(m=this._logDrawCallStart(sp));const w=this.vertexArray.getDrawParams(),{isIndexed:A=w.isIndexed,indexType:P=w.indexType,indexOffset:I=w.indexOffset,vertexArrayInstanced:N=w.isInstanced}=this.props;N&&!this.isInstanced&&hr.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:F,instanceCount:Z}=this,{onBeforeRender:U=ET,onAfterRender:z=ET}=this.props;U(),this.program.setUniforms(this.uniforms);const J=this.program.draw(Object.assign(Iq,t,{logPriority:m,uniforms:null,framebuffer:i,parameters:o,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:f,transformFeedback:a,isIndexed:A,indexType:P,isInstanced:F,instanceCount:Z,offset:A?I:0}));return z(),hr.priority>=sp&&this._logDrawCallEnd(m,f,i),J}transform(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:r=!0,feedbackBuffers:i,unbindModels:n=[]}=t;let{parameters:s}=t;i&&this._setFeedbackBuffers(i),r&&(s=Object.assign({},s,{35977:r})),n.forEach(a=>a.vertexArray.unbindBuffers());try{this.draw(Object.assign({},t,{parameters:s}))}finally{n.forEach(a=>a.vertexArray.bindBuffers())}return this}render(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return hr.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:r,fs:i,modules:n,inject:s,defines:a,varyings:o,bufferMode:f,transpileToGLSL100:m}=this.programProps;t=this.programManager.get({vs:r,fs:i,modules:n,inject:s,defines:a,varyings:o,bufferMode:f,transpileToGLSL100:m}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}rr(t instanceof yB,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new zU(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const r=this.geometryBuffers[t][0]||this.geometryBuffers[t];r instanceof Ki&&r.delete()}}_setAnimationProps(t){this.animated&&rr(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ag(t))return this;const{gl:r}=this.program;return this.transformFeedback=this.transformFeedback||new _B(r,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const r=t>3?0:Tq;if(!(Date.now()-this.lastLogTime<r))return this.lastLogTime=Date.now(),hr.group(sp,">>> DRAWING MODEL ".concat(this.id),{collapsed:hr.level<=2})(),t}_logDrawCallEnd(t,r,i,n){if(t===void 0)return;const s=GU({vertexArray:r,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:a,unusedTable:o,unusedCount:f}=oT({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:m,count:w}=oT({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});w>0&&hr.log("MISSING UNIFORMS",Object.keys(m))(),f>0&&hr.log("UNUSED UNIFORMS",Object.keys(o))();const A=qU(this.vertexArray.configuration);hr.table(t,s)(),hr.table(t,a)(),hr.table(t+1,A)(),n&&n.log({logLevel:sp,message:"Rendered to ".concat(n.id)}),hr.groupEnd(sp)()}}class Mq{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(r),Object.seal(this)}setupResources(t){for(const r of this.bindings)this._setupTransformFeedback(r,t)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:r}=this;return r.length>0&&(t=Object.assign({},t,{varyings:r})),t}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:n}=r;return{attributes:Object.assign({},i,t.attributes),transformFeedback:n}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:r}=this.bindings[this.currentIndex],i=t?r[t]:null;return i?i instanceof Ki?i:i.buffer:null}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:r}=t,i=this.getBuffer(r);return i?i.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&rr(ni(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:r={}}=t,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const n in this.feedbackMap){const s=this.feedbackMap[n];n in r&&(i[s]=n)}Object.assign(i,t.feedbackBuffers);for(const n in i){const s=i[n];if(typeof s=="string"){const a=r[s],{byteLength:o,usage:f,accessor:m}=a;i[n]=this._createNewBuffer(n,{byteLength:o,usage:f,accessor:m})}}return i}_setupBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:r=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const i=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:r,feedbackBuffers:i})}_setupTransformFeedback(t,r){let{model:i}=r;const{program:n}=i;t.transformFeedback=new _B(this.gl,{program:n,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:r,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceBuffers:r,feedbackBuffers:i})}}_updateBinding(t,r){return t?(Object.assign(t.sourceBuffers,r.sourceBuffers),Object.assign(t.feedbackBuffers,r.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},r.sourceBuffers),feedbackBuffers:Object.assign({},r.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const r=Object.assign({},t.sourceBuffers),i=Object.assign({},t.feedbackBuffers);for(const n in this.feedbackMap){const s=this.feedbackMap[n];r[n]=t.feedbackBuffers[s],i[s]=t.sourceBuffers[n],rr(i[s]instanceof Ki)}return{sourceBuffers:r,feedbackBuffers:i}}_createNewBuffer(t,r){const i=new Ki(this.gl,r);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const Lq="transform_uSampler_",A_="transform_uSize_",CT="transform_position";function Bq(e){let{vs:t,sourceTextureMap:r,targetTextureVarying:i,targetTexture:n}=e,s=Object.keys(r).length,a=null;const o={};let f=t,m={};if(s>0||i){const w=f.split(`
`),A=w.slice();if(w.forEach((P,I,N)=>{if(s>0){const F=Nq(P,r);if(F){const{updatedLine:Z,inject:U}=F;A[I]=Z,m=ox([m,U]),Object.assign(o,F.samplerTextureMap),s--}}i&&!a&&(a=Dq(P,i))}),i){rr(n);const P="".concat(A_).concat(i),I="uniform vec2 ".concat(P,`;
`),N="     vec2 ".concat(CT," = transform_getPos(").concat(P,`);
     gl_Position = vec4(`).concat(CT,`, 0, 1.);
`);m=ox([m,{"vs:#decl":I,"vs:#main-start":N}])}f=A.join(`
`)}return{vs:f,targetTextureType:a,inject:m,samplerTextureMap:o}}function kq(e){let{sourceTextureMap:t,targetTextureVarying:r,targetTexture:i}=e;const n={};let s,a;r&&({width:s,height:a}=i,n["".concat(A_).concat(r)]=[s,a]);for(const o in t)({width:s,height:a}=t[o]),n["".concat(A_).concat(o)]=[s,a];return n}function Rq(e){return EB(e,["attribute","in"])}function Oq(e){const t="".concat(Lq).concat(e),r="".concat(A_).concat(e),i="  uniform sampler2D ".concat(t,`;
  uniform vec2 `).concat(r,";");return{samplerName:t,sizeName:r,uniformDeclerations:i}}function Dq(e,t){const r=EB(e,["varying","out"]);return r&&r.name===t?r.type:null}function Nq(e,t){const r={},i=Rq(e);if(!i)return null;const{type:n,name:s}=i;if(s&&t[s]){const a="// ".concat(e," => Replaced by Transform with a sampler"),{samplerName:o,sizeName:f,uniformDeclerations:m}=Oq(s),w=kG(n),A="  ".concat(n," ").concat(s," = transform_getInput(").concat(o,", ").concat(f,").").concat(w,`;
`);return r[o]=s,{updatedLine:a,inject:{"vs:#decl":m,"vs:#main-start":A},samplerTextureMap:r}}return null}const Fq={10241:9728,10240:9728,10242:33071,10243:33071},zq="transform_output";class jq{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(r),Object.seal(this)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=this._processVertexShader(t);return Object.assign({},t,r)}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:r,sourceTextures:i,framebuffer:n,targetTexture:s}=this.bindings[this.currentIndex],a=Object.assign({},r,t.attributes),o=Object.assign({},t.uniforms),f=Object.assign({},t.parameters);let m=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){a.transform_elementID=this.elementIDBuffer;for(const A in this.samplerTextureMap){const P=this.samplerTextureMap[A];o[A]=i[P]}this._setSourceTextureParameters();const w=kq({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(o,w)}return this.hasTargetTexture&&(m=!1,f.viewport=[0,0,n.width,n.height]),{attributes:a,framebuffer:n,uniforms:o,discard:m,parameters:f}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData(){let{packed:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:r}=this.bindings[this.currentIndex],i=nv(r);if(!t)return i;const n=i.constructor,s=RG(this.targetTextureType),a=new n(i.length*s/4);let o=0;for(let f=0;f<i.length;f+=4)for(let m=0;m<s;m++)a[o++]=i[f+m];return a}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:r,_swapTexture:i}=t;this._swapTexture=i,this.targetTextureVarying=r,this.hasTargetTexture=r,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:r,textureOrReference:i}=t;if(i instanceof Xa)return i;const n=r[i];return n?(this._targetRefTexName=i,this._createNewTexture(n)):null}_setupTextures(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:r,_sourceTextures:i={},_targetTexture:n}=t,s=this._createTargetTexture({sourceTextures:i,textureOrReference:n});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:r,sourceTextures:i,targetTexture:s}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if(typeof t!="number"||this.elementCount>=t)return;const r=new Float32Array(t);r.forEach((i,n,s)=>{s[n]=n}),this.elementIDBuffer?this.elementIDBuffer.setData({data:r}):this.elementIDBuffer=new Ki(this.gl,{data:r,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:r,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceTextures:r,targetTexture:i})}}_updateBinding(t,r){const{sourceBuffers:i,sourceTextures:n,targetTexture:s}=r;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,n),Object.assign(t.sourceBuffers,i),s){t.targetTexture=s;const{width:a,height:o}=s,{framebuffer:f}=t;f?(f.update({attachments:{36064:s},resizeAttachments:!1}),f.resize({width:a,height:o})):t.framebuffer=new ws(this.gl,{id:"transform-framebuffer",width:a,height:o,attachments:{36064:s}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:r}=this.bindings[t];for(const i in r)r[i].setParameters(Fq)}_swapTextures(t){if(!this._swapTexture)return null;const r=Object.assign({},t.sourceTextures);r[this._swapTexture]=t.targetTexture;const i=t.sourceTextures[this._swapTexture];return{sourceTextures:r,targetTexture:i}}_createNewTexture(t){const r=Pj(t,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=r,r}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:r,targetTexture:i}=this.bindings[this.currentIndex],{vs:n,uniforms:s,targetTextureType:a,inject:o,samplerTextureMap:f}=Bq({vs:t.vs,sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),m=ox([t.inject||{},o]);this.targetTextureType=a,this.samplerTextureMap=f;const w=t._fs||CB({version:gB(n),input:this.targetTextureVarying,inputType:a,output:zq}),A=this.hasSourceTextures||this.targetTextureVarying?[xq].concat(t.modules||[]):t.modules;return{vs:n,fs:w,modules:A,uniforms:s,inject:m}}}class BA{static isSupported(t){return ni(t)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(r),Object.seal(this)}delete(){const{model:t,bufferTransform:r,textureTransform:i}=this;t&&t.delete(),r&&r.delete(),i&&i.delete()}run(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:r=!0}=t,i=this._updateDrawOptions(t);r&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let t=!1;const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)t=t||i.swap();rr(t,"Nothing to swap")}getBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r){const n=i.getData(t);if(n)return n}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)i.update(t)}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:r}=this;this._buildResourceTransforms(r,t),t=this._updateModelProps(t),this.model=new ug(r,Object.assign({},t,{fs:t.fs||CB({version:gB(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let r=Object.assign({},t);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of i)r=n.updateModelProps(r);return r}_buildResourceTransforms(t,r){Uq(r)&&(this.bufferTransform=new Mq(t,r)),Gq(r)&&(this.textureTransform=new jq(t,r)),rr(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let r=Object.assign({},t);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of i)r=Object.assign(r,n.getDrawOptions(r));return r}}function Uq(e){return!!(!ag(e.feedbackBuffers)||!ag(e.feedbackMap)||e.varyings&&e.varyings.length>0)}function Gq(e){return!!(!ag(e._sourceTextures)||e._targetTexture||e._targetTextureVarying)}const TT={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class jm{static get DRAW_MODE(){return TT}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:r=fh("geometry"),drawMode:i=TT.TRIANGLES,attributes:n={},indices:s=null,vertexCount:a=null}=t;this.id=r,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(n,s),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return"Geometry ".concat(this.id," attribute ").concat(t)}_setAttributes(t,r){r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r);for(const i in t){let n=t[i];n=ArrayBuffer.isView(n)?{value:n}:n,rr(ArrayBuffer.isView(n.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!n.size&&(n.size=3),i==="indices"?(rr(!this.indices),this.indices=n):this.attributes[i]=n}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,r){if(r)return r.value.length;let i=1/0;for(const n in t){const s=t[n],{value:a,size:o,constant:f}=s;!f&&a&&o>=1&&(i=Math.min(i,a.length/o))}return rr(Number.isFinite(i)),i}}let Vq=1,qq=1;class $B{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:r=0,duration:i=Number.POSITIVE_INFINITY,rate:n=1,repeat:s=1}=t,a=Vq++,o={time:0,delay:r,duration:i,rate:n,repeat:s};return this._setChannelTime(o,this.time),this.channels.set(a,o),a}removeChannel(t){this.channels.delete(t);for(const[r,i]of this.animations)i.channel===t&&this.detachAnimation(r)}isFinished(t){const r=this.channels.get(t);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(t){if(t===void 0)return this.time;const r=this.channels.get(t);return r===void 0?-1:r.time}setTime(t){this.time=Math.max(0,t);const r=this.channels.values();for(const n of r)this._setChannelTime(n,this.time);const i=this.animations.values();for(const n of i){const{animation:s,channel:a}=n;s.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,r){const i=qq++;return this.animations.set(i,{animation:t,channel:r}),t.setTime(this.getTime(r)),i}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,r){const i=r-t.delay,n=t.duration*t.repeat;i>=n?t.time=t.duration*t.rate:(t.time=Math.max(0,i)%t.duration,t.time*=t.rate)}}const Hq=[255,255,255],Wq=1;let $q=0;class ZB{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"id",void 0),$(this,"color",void 0),$(this,"intensity",void 0),$(this,"type","ambient");const{color:r=Hq}=t,{intensity:i=Wq}=t;this.id=t.id||"ambient-".concat($q++),this.color=r,this.intensity=i}}const Zq=[255,255,255],Jq=1,Xq=[0,0,-1];let Kq=0;class PT{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"id",void 0),$(this,"color",void 0),$(this,"intensity",void 0),$(this,"type","directional"),$(this,"direction",void 0),$(this,"shadow",void 0);const{color:r=Zq}=t,{intensity:i=Jq}=t,{direction:n=Xq}=t,{_shadow:s=!1}=t;this.id=t.id||"directional-".concat(Kq++),this.color=r,this.intensity=i,this.type="directional",this.direction=new se(n).normalize().toArray(),this.shadow=s}getProjectedLight(t){return this}}class Yq{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};$(this,"id",void 0),$(this,"gl",void 0),$(this,"props",void 0);const{id:i}=r;this.id=i,this.gl=t,this.props={...r}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class kA extends Yq{constructor(){super(...arguments),$(this,"_lastRenderIndex",-1)}render(t){const r=this.gl;return dh(r,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{target:r,moduleParameters:i,viewports:n,views:s,onViewportActive:a,clearStack:o=!0,clearCanvas:f=!0}=t;t.pass=t.pass||"unknown";const m=this.gl;f&&tH(m,r),o&&(this._lastRenderIndex=-1);const w=[];for(const A of n){const P=s&&s[A.id];a==null||a(A);const I=this._getDrawLayerParams(A,t),N=A.subViewports||[A];for(const F of N){const Z=this._drawLayersInViewport(m,{target:r,moduleParameters:i,viewport:F,view:P,pass:t.pass,layers:t.layers},I);w.push(Z)}}return w}_getDrawLayerParams(t,r){let{layers:i,pass:n,isPicking:s=!1,layerFilter:a,cullRect:o,effects:f,moduleParameters:m}=r,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const A=[],P=JB(this._lastRenderIndex+1),I={layer:i[0],viewport:t,isPicking:s,renderPass:n,cullRect:o},N={};for(let F=0;F<i.length;F++){const Z=i[F],U=this._shouldDrawLayer(Z,I,a,N),z={shouldDrawLayer:U};U&&!w&&(z.layerRenderIndex=P(Z,U),z.moduleParameters=this._getModuleParameters(Z,f,n,m),z.layerParameters=this.getLayerParameters(Z,F,t)),A[F]=z}return A}_drawLayersInViewport(t,r,i){let{layers:n,moduleParameters:s,pass:a,target:o,viewport:f,view:m}=r;const w=Qq(t,{moduleParameters:s,target:o,viewport:f});if(m&&m.props.clear){const P=m.props.clear===!0?{color:!0,depth:!0}:m.props.clear;Tc(t,{scissorTest:!0,scissor:w},()=>yA(t,P))}const A={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};dh(t,{viewport:w});for(let P=0;P<n.length;P++){const I=n[P],{shouldDrawLayer:N,layerRenderIndex:F,moduleParameters:Z,layerParameters:U}=i[P];if(N&&I.props.pickable&&A.pickableCount++,I.isComposite)A.compositeCount++;else if(N){A.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,F),Z.viewport=f;try{I._drawLayer({moduleParameters:Z,uniforms:{layerIndex:F},parameters:U})}catch(z){I.raiseError(z,"drawing ".concat(I," to ").concat(a))}}}return A}shouldDrawLayer(t){return!0}getModuleParameters(t,r){return null}getLayerParameters(t,r,i){return t.props.parameters}_shouldDrawLayer(t,r,i,n){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;r.layer=t;let s=t.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(r))return!1;r.layer=s,s=s.parent}if(i){const a=r.layer.id;if(a in n||(n[a]=i(r)),!n[a])return!1}return t.activateViewport(r.viewport),!0}_getModuleParameters(t,r,i,n){var s;const a=Object.assign(Object.create(((s=t.internalState)===null||s===void 0?void 0:s.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:og(this.gl)});if(r)for(const f of r){var o;Object.assign(a,(o=f.getModuleParameters)===null||o===void 0?void 0:o.call(f,t))}return Object.assign(a,this.getModuleParameters(t,r),n)}}function JB(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r={},i=(n,s)=>{const a=n.props._offset,o=n.id,f=n.parent&&n.parent.id;let m;if(f&&!(f in t)&&i(n.parent,!1),f in r){const w=r[f]=r[f]||JB(t[f],t);m=w(n,s),r[o]=w}else Number.isFinite(a)?(m=a+(t[f]||0),r[o]=null):m=e;return s&&m>=e&&(e=m+1),t[o]=m,m};return i}function Qq(e,t){let{moduleParameters:r,target:i,viewport:n}=t;const s=i&&i.id!=="default-framebuffer",a=r&&r.devicePixelRatio||og(e),o=s?i.height:e.drawingBufferHeight,f=n;return[f.x*a,o-(f.y+f.height)*a,f.width*a,f.height*a]}function tH(e,t){const r=t?t.width:e.drawingBufferWidth,i=t?t.height:e.drawingBufferHeight;dh(e,{viewport:[0,0,r,i]}),e.clear(16640)}class eH extends kA{constructor(t,r){super(t,r),$(this,"shadowMap",void 0),$(this,"depthBuffer",void 0),$(this,"fbo",void 0),this.shadowMap=new Xa(t,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Mp(t,{format:33189,width:1,height:1}),this.fbo=new ws(t,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(t){const r=this.fbo;Tc(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=t.viewports[0],n=og(this.gl),s=i.width*n,a=i.height*n;(s!==r.width||a!==r.height)&&r.resize({width:s,height:a}),super.render({...t,target:r,pass:"shadow"})})}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const XB="#define SMOOTH_EDGE_RADIUS 0.5",rH=`
`.concat(XB,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),iH=`
`.concat(XB,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),nH={name:"geometry",vs:rH,fs:iH},sH=Object.keys(vi).map(e=>"const int COORDINATE_SYSTEM_".concat(e," = ").concat(vi[e],";")).join(""),oH=Object.keys(cu).map(e=>"const int PROJECTION_MODE_".concat(e," = ").concat(cu[e],";")).join(""),aH=Object.keys(ex).map(e=>"const int UNIT_".concat(e.toUpperCase()," = ").concat(ex[e],";")).join(""),lH="".concat(sH,`
`).concat(oH,`
`).concat(aH,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function cH(e,t){if(e===t)return!0;if(Array.isArray(e)){const r=e.length;if(!t||t.length!==r)return!1;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}return!1}function O0(e){let t={},r;return i=>{for(const n in i)if(!cH(i[n],t[n])){r=e(i),t=i;break}return r}}const IT=[0,0,0,0],uH=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],KB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],hH=[0,0,0],YB=[0,0,0],dH=O0(gH);function QB(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:YB;r.length<3&&(r=[r[0],r[1],0]);let i=r,n,s=!0;switch(t===vi.LNGLAT_OFFSETS||t===vi.METER_OFFSETS?n=r:n=e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case cu.WEB_MERCATOR:(t===vi.LNGLAT||t===vi.CARTESIAN)&&(n=[0,0,0],s=!1);break;case cu.WEB_MERCATOR_AUTO_OFFSET:t===vi.LNGLAT?i=n:t===vi.CARTESIAN&&(i=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],n=e.unprojectPosition(i),i[0]-=r[0],i[1]-=r[1],i[2]-=r[2]);break;case cu.IDENTITY:i=e.position.map(Math.fround),i[2]=i[2]||0;break;case cu.GLOBE:s=!1,n=null;break;default:s=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:i,offsetMode:s}}function fH(e,t,r){const{viewMatrixUncentered:i,projectionMatrix:n}=e;let{viewMatrix:s,viewProjectionMatrix:a}=e,o=IT,f=IT,m=e.cameraPosition;const{geospatialOrigin:w,shaderCoordinateOrigin:A,offsetMode:P}=QB(e,t,r);return P&&(f=e.projectPosition(w||A),m=[m[0]-f[0],m[1]-f[1],m[2]-f[2]],f[3]=1,o=k0([],f,a),s=i||s,a=_f([],n,s),a=_f([],a,uH)),{viewMatrix:s,viewProjectionMatrix:a,projectionCenter:o,originCommon:f,cameraPosCommon:m,shaderCoordinateOrigin:A,geospatialOrigin:w}}function pH(e){let{viewport:t,devicePixelRatio:r=1,modelMatrix:i=null,coordinateSystem:n=vi.DEFAULT,coordinateOrigin:s=YB,autoWrapLongitude:a=!1}=e;n===vi.DEFAULT&&(n=t.isGeospatial?vi.LNGLAT:vi.CARTESIAN);const o=dH({viewport:t,devicePixelRatio:r,coordinateSystem:n,coordinateOrigin:s});return o.project_uWrapLongitude=a,o.project_uModelMatrix=i||KB,o}function gH(e){let{viewport:t,devicePixelRatio:r,coordinateSystem:i,coordinateOrigin:n}=e;const{projectionCenter:s,viewProjectionMatrix:a,originCommon:o,cameraPosCommon:f,shaderCoordinateOrigin:m,geospatialOrigin:w}=fH(t,i,n),A=t.getDistanceScales(),P=[t.width*r,t.height*r],I=k0([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,N={project_uCoordinateSystem:i,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:m,project_uCommonOrigin:o.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:P,project_uDevicePixelRatio:r,project_uFocalDistance:I,project_uCommonUnitsPerMeter:A.unitsPerMeter,project_uCommonUnitsPerWorldUnit:A.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:hH,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:a,project_uModelMatrix:KB,project_uCameraPosition:f};if(w){const F=t.getDistanceScales(w);switch(i){case vi.METER_OFFSETS:N.project_uCommonUnitsPerWorldUnit=F.unitsPerMeter,N.project_uCommonUnitsPerWorldUnit2=F.unitsPerMeter2;break;case vi.LNGLAT:case vi.LNGLAT_OFFSETS:t._pseudoMeters||(N.project_uCommonUnitsPerMeter=F.unitsPerMeter),N.project_uCommonUnitsPerWorldUnit=F.unitsPerDegree,N.project_uCommonUnitsPerWorldUnit2=F.unitsPerDegree2;break;case vi.CARTESIAN:N.project_uCommonUnitsPerWorldUnit=[1,1,F.unitsPerMeter[2]],N.project_uCommonUnitsPerWorldUnit2=[0,0,F.unitsPerMeter2[2]];break}}return N}const mH={};function yH(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:mH;return"viewport"in e?pH(e):{}}const RA={name:"project",dependencies:[NG,nH],vs:lH,getUniforms:yH};function _H(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Gp(e,t){const r=k0([],t,e);return jB(r,r,1/r[3]),r}function MT(e,t){const r=e%t;return r<0?t+r:r}function dx(e,t,r){return e<t?t:e>r?r:e}function vH(e){return Math.log(e)*Math.LOG2E}const OA=Math.log2||vH;function ph(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const Ac=Math.PI,t6=Ac/4,kl=Ac/180,fx=180/Ac,hg=512,S_=4003e4,V1=85.051129,bH=1.5;function wH(e){return OA(e)}function f0(e){const[t,r]=e;ph(Number.isFinite(t)),ph(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const i=t*kl,n=r*kl,s=hg*(i+Ac)/(2*Ac),a=hg*(Ac+Math.log(Math.tan(t6+n*.5)))/(2*Ac);return[s,a]}function dg(e){const[t,r]=e,i=t/hg*(2*Ac)-Ac,n=2*(Math.atan(Math.exp(r/hg*(2*Ac)-Ac))-t6);return[i*fx,n*fx]}function xH(e){const{latitude:t}=e;ph(Number.isFinite(t));const r=Math.cos(t*kl);return wH(S_*r)-9}function Sy(e){const t=Math.cos(e*kl);return hg/S_/t}function px(e){const{latitude:t,longitude:r,highPrecision:i=!1}=e;ph(Number.isFinite(t)&&Number.isFinite(r));const n=hg,s=Math.cos(t*kl),a=n/360,o=a/s,f=n/S_/s,m={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[a,o,f],degreesPerUnit:[1/a,1/o,1/f]};if(i){const w=kl*Math.tan(t*kl)/s,A=a*w/2,P=n/S_*w,I=P/o*f;m.unitsPerDegree2=[0,A,P],m.unitsPerMeter2=[I,0,I]}return m}function e6(e,t){const[r,i,n]=e,[s,a,o]=t,{unitsPerMeter:f,unitsPerMeter2:m}=px({longitude:r,latitude:i,highPrecision:!0}),w=f0(e);w[0]+=s*(f[0]+m[0]*a),w[1]+=a*(f[1]+m[1]*a);const A=dg(w),P=(n||0)+(o||0);return Number.isFinite(n)||Number.isFinite(o)?[A[0],A[1],P]:A}function AH(e){const{height:t,pitch:r,bearing:i,altitude:n,scale:s,center:a}=e,o=_H();x_(o,o,[0,0,-n]),FB(o,o,-r*kl),zB(o,o,i*kl);const f=s/t;return IA(o,o,[f,f,f]),a&&x_(o,o,eV([],a)),o}function SH(e){const{width:t,height:r,altitude:i,pitch:n=0,offset:s,center:a,scale:o,nearZMultiplier:f=1,farZMultiplier:m=1}=e;let{fovy:w=E_(bH)}=e;i!==void 0&&(w=E_(i));const A=w*kl,P=n*kl,I=r6(w);let N=I;a&&(N+=a[2]*o/Math.cos(P)/r);const F=A*(.5+(s?s[1]:0)/r),Z=Math.sin(F)*N/Math.sin(dx(Math.PI/2-P-F,.01,Math.PI-.01)),U=Math.sin(P)*Z+N,z=N*10,J=Math.min(U*m,z);return{fov:A,aspect:t/r,focalDistance:I,near:f,far:J}}function E_(e){return 2*Math.atan(.5/e)*fx}function r6(e){return .5/Math.tan(.5*e*kl)}function i6(e,t){const[r,i,n=0]=e;return ph(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(n)),Gp(t,[r,i,n,1])}function DA(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[i,n,s]=e;if(ph(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(s))return Gp(t,[i,n,s,1]);const a=Gp(t,[i,n,0,1]),o=Gp(t,[i,n,1,1]),f=a[2],m=o[2],w=f===m?0:((r||0)-f)/(m-f);return TB([],a,o,w)}function EH(e){const{width:t,height:r,bounds:i,minExtent:n=0,maxZoom:s=24,offset:a=[0,0]}=e,[[o,f],[m,w]]=i,A=CH(e.padding),P=f0([o,dx(w,-V1,V1)]),I=f0([m,dx(f,-V1,V1)]),N=[Math.max(Math.abs(I[0]-P[0]),n),Math.max(Math.abs(I[1]-P[1]),n)],F=[t-A.left-A.right-Math.abs(a[0])*2,r-A.top-A.bottom-Math.abs(a[1])*2];ph(F[0]>0&&F[1]>0);const Z=F[0]/N[0],U=F[1]/N[1],z=(A.right-A.left)/2/Z,J=(A.top-A.bottom)/2/U,nt=[(I[0]+P[0])/2+z,(I[1]+P[1])/2+J],mt=dg(nt),Et=Math.min(s,OA(Math.abs(Math.min(Z,U))));return ph(Number.isFinite(Et)),{longitude:mt[0],latitude:mt[1],zoom:Et}}function CH(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(ph(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}const LT=Math.PI/180;function TH(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:r,height:i,unproject:n}=e,s={targetZ:t},a=n([0,i],s),o=n([r,i],s);let f,m;const w=e.fovy?.5*e.fovy*LT:Math.atan(.5/e.altitude),A=(90-e.pitch)*LT;return w>A-.01?(f=BT(e,0,t),m=BT(e,r,t)):(f=n([0,0],s),m=n([r,0],s)),[a,o,m,f]}function BT(e,t,r){const{pixelUnprojectionMatrix:i}=e,n=Gp(i,[t,0,1,1]),s=Gp(i,[t,e.height,1,1]),a=(r*e.distanceScales.unitsPerMeter[2]-n[2])/(s[2]-n[2]),o=TB([],n,s,a),f=dg(o);return f.push(r),f}const kT=512;function PH(e){const{width:t,height:r,pitch:i=0}=e;let{longitude:n,latitude:s,zoom:a,bearing:o=0}=e;(n<-180||n>180)&&(n=MT(n+180,360)-180),(o<-180||o>180)&&(o=MT(o+180,360)-180);const f=OA(r/kT);if(a<=f)a=f,s=0;else{const m=r/2/Math.pow(2,a),w=dg([0,m])[1];if(s<w)s=w;else{const A=dg([0,kT-m])[1];s>A&&(s=A)}}return{width:t,height:r,longitude:n,latitude:s,zoom:a,pitch:i,bearing:o}}const IH=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,MH=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,LH=O0(DH),BH=O0(NH),kH=[0,0,0,1],RH=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function OH(e,t){const[r,i,n]=e,s=DA([r,i,n],t);return Number.isFinite(n)?s:[s[0],s[1],0]}function DH(e){let{viewport:t,center:r}=e;return new di(t.viewProjectionMatrix).invert().transform(r)}function NH(e){let{viewport:t,shadowMatrices:r}=e;const i=[],n=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,a=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>OH(o,n));for(const o of r){const f=o.clone().translate(new se(t.center).negate()),m=a.map(A=>f.transform(A)),w=new di().ortho({left:Math.min(...m.map(A=>A[0])),right:Math.max(...m.map(A=>A[0])),bottom:Math.min(...m.map(A=>A[1])),top:Math.max(...m.map(A=>A[1])),near:Math.min(...m.map(A=>-A[2])),far:Math.max(...m.map(A=>-A[2]))});i.push(w.multiplyRight(o))}return i}function FH(e,t){const{shadowEnabled:r=!0}=e;if(!r||!e.shadowMatrices||!e.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:!!e.drawToShadowMap,shadow_uUseShadowMap:e.shadowMaps?e.shadowMaps.length>0:!1,shadow_uColor:e.shadowColor||kH,shadow_uLightId:e.shadowLightId||0,shadow_uLightCount:e.shadowMatrices.length},n=LH({viewport:e.viewport,center:t.project_uCenter}),s=[],a=BH({shadowMatrices:e.shadowMatrices,viewport:e.viewport}).slice();for(let o=0;o<e.shadowMatrices.length;o++){const f=a[o],m=f.clone().translate(new se(e.viewport.center).negate());t.project_uCoordinateSystem===vi.LNGLAT&&t.project_uProjectionMode===cu.WEB_MERCATOR?(a[o]=m,s[o]=n):(a[o]=f.clone().multiplyRight(RH),s[o]=m.transform(n))}for(let o=0;o<a.length;o++)i["shadow_uViewProjectionMatrices[".concat(o,"]")]=a[o],i["shadow_uProjectCenters[".concat(o,"]")]=s[o],e.shadowMaps&&e.shadowMaps.length>0?i["shadow_uShadowMap".concat(o)]=e.shadowMaps[o]:i["shadow_uShadowMap".concat(o)]=e.dummyShadowMap;return i}const a2={name:"shadow",dependencies:[RA],vs:IH,fs:MH,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in e&&(e.drawToShadowMap||e.shadowMaps&&e.shadowMaps.length>0)?FH(e,t):{}}},zH={color:[255,255,255],intensity:1},RT=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],jH=[0,0,0,200/255];class NA{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"id","lighting-effect"),$(this,"props",void 0),$(this,"shadowColor",jH),$(this,"shadow",void 0),$(this,"ambientLight",void 0),$(this,"directionalLights",void 0),$(this,"pointLights",void 0),$(this,"shadowPasses",[]),$(this,"shadowMaps",[]),$(this,"dummyShadowMap",null),$(this,"programManager",void 0),$(this,"shadowMatrices",void 0),this.setProps(t)}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const r in t){const i=t[r];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.props=t}preRender(t,r){let{layers:i,layerFilter:n,viewports:s,onViewportActive:a,views:o}=r;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(t),this.programManager||(this.programManager=R0.getDefaultProgramManager(t),a2&&this.programManager.addDefaultModule(a2)),this.dummyShadowMap||(this.dummyShadowMap=new Xa(t,{width:1,height:1}));for(let f=0;f<this.shadowPasses.length;f++)this.shadowPasses[f].render({layers:i,layerFilter:n,viewports:s,onViewportActive:a,views:o,moduleParameters:{shadowLightId:f,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const r=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return r.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:t})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:t}))},r}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(a2),this.programManager=null)}_calculateMatrices(){const t=[];for(const r of this.directionalLights){const i=new di().lookAt({eye:new se(r.direction).negate()});t.push(i)}return t}_createShadowPasses(t){for(let r=0;r<this.directionalLights.length;r++){const i=new eH(t);this.shadowPasses[r]=i,this.shadowMaps[r]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:r,directionalLights:i}=this;!t&&r.length===0&&i.length===0&&(this.ambientLight=new ZB(zH),this.directionalLights.push(new PT(RT[0]),new PT(RT[1])))}}class UH{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"_pool",[]),$(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,r,i){let{size:n=1,type:s,padding:a=0,copy:o=!1,initialize:f=!1,maxCount:m}=i;const w=s||t&&t.constructor||Float32Array,A=r*n+a;if(ArrayBuffer.isView(t)){if(A<=t.length)return t;if(A*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new w(t.buffer,0,A)}let P=1/0;m&&(P=m*n+a);const I=this._allocate(w,A,f,P);return t&&o?I.set(t):f||I.fill(0,0,4),this._release(t),I}release(t){this._release(t)}_allocate(t,r,i,n){let s=Math.max(Math.ceil(r*this.opts.overAlloc),1);s>n&&(s=n);const a=this._pool,o=t.BYTES_PER_ELEMENT*s,f=a.findIndex(m=>m.byteLength>=o);if(f>=0){const m=new t(a.splice(f,1)[0],0,s);return i&&m.fill(0),m}return new t(s)}_release(t){if(!ArrayBuffer.isView(t))return;const r=this._pool,{buffer:i}=t,{byteLength:n}=i,s=r.findIndex(a=>a.byteLength>=n);s<0?r.push(i):(s>0||r.length<this.opts.poolSize)&&r.splice(s,0,i),r.length>this.opts.poolSize&&r.shift()}}const p0=new UH;function xm(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function GH(e){return[e[12],e[13],e[14]]}function VH(e){return{left:op(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:op(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:op(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:op(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:op(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:op(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}const OT=new se;function op(e,t,r,i){OT.set(e,t,r);const n=OT.len();return{distance:i/n,normal:new se(-e/n,-t/n,-r/n)}}function qH(e){return e-Math.fround(e)}let sm;function l2(e,t){const{size:r=1,startIndex:i=0}=t,n=t.endIndex!==void 0?t.endIndex:e.length,s=(n-i)/r;sm=p0.allocate(sm,s,{type:Float32Array,size:r*2});let a=i,o=0;for(;a<n;){for(let f=0;f<r;f++){const m=e[a++];sm[o+f]=m,sm[o+f+r]=qH(m)}o+=r*2}return sm.subarray(0,s*r*2)}function HH(e){let t=null,r=!1;for(const i of e)i&&(t?(r||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],r=!0),t[0][0]=Math.min(t[0][0],i[0][0]),t[0][1]=Math.min(t[0][1],i[0][1]),t[1][0]=Math.max(t[1][0],i[1][0]),t[1][1]=Math.max(t[1][1],i[1][1])):t=i);return t}const WH=Math.PI/180,$H=xm(),DT=[0,0,0],ZH={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function JH(e){let{width:t,height:r,orthographic:i,fovyRadians:n,focalDistance:s,padding:a,near:o,far:f}=e;const m=t/r,w=i?new di().orthographic({fovy:n,aspect:m,focalDistance:s,near:o,far:f}):new di().perspective({fovy:n,aspect:m,near:o,far:f});if(a){const{left:A=0,right:P=0,top:I=0,bottom:N=0}=a,F=eh((A+t-P)/2,0,t)-t/2,Z=eh((I+r-N)/2,0,r)-r/2;w[8]-=F*2/t,w[9]+=Z*2/r}return w}class wg{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,"id",void 0),$(this,"x",void 0),$(this,"y",void 0),$(this,"width",void 0),$(this,"height",void 0),$(this,"padding",void 0),$(this,"isGeospatial",void 0),$(this,"zoom",void 0),$(this,"focalDistance",void 0),$(this,"position",void 0),$(this,"modelMatrix",void 0),$(this,"distanceScales",void 0),$(this,"scale",void 0),$(this,"center",void 0),$(this,"cameraPosition",void 0),$(this,"projectionMatrix",void 0),$(this,"viewMatrix",void 0),$(this,"viewMatrixUncentered",void 0),$(this,"viewMatrixInverse",void 0),$(this,"viewProjectionMatrix",void 0),$(this,"pixelProjectionMatrix",void 0),$(this,"pixelUnprojectionMatrix",void 0),$(this,"resolution",void 0),$(this,"_frustumPlanes",{}),this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||ZH,this.focalDistance=t.focalDistance||1,this.position=t.position||DT,this.modelMatrix=t.modelMatrix||null;const{longitude:r,latitude:i}=t;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(r),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?cu.WEB_MERCATOR:cu.WEB_MERCATOR_AUTO_OFFSET:cu.IDENTITY}equals(t){return t instanceof wg?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&Pc(t.projectionMatrix,this.projectionMatrix)&&Pc(t.viewMatrix,this.viewMatrix):!1}project(t){let{topLeft:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=this.projectPosition(t),n=i6(i,this.pixelProjectionMatrix),[s,a]=n,o=r?a:this.height-a;return t.length===2?[s,o]:[s,o,n[2]]}unproject(t){let{topLeft:r=!0,targetZ:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[n,s,a]=t,o=r?s:this.height-s,f=i&&i*this.distanceScales.unitsPerMeter[2],m=DA([n,o,a],this.pixelUnprojectionMatrix,f),[w,A,P]=this.unprojectPosition(m);return Number.isFinite(a)?[w,A,P]:Number.isFinite(i)?[w,A,i]:[w,A]}projectPosition(t){const[r,i]=this.projectFlat(t),n=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,i,n]}unprojectPosition(t){const[r,i]=this.unprojectFlat(t),n=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[r,i,n]}projectFlat(t){if(this.isGeospatial){const r=f0(t);return r[1]=eh(r[1],-318,830),r}return t}unprojectFlat(t){return this.isGeospatial?dg(t):t}getBounds(){const t={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},r=this.unproject([0,0],t),i=this.unproject([this.width,0],t),n=this.unproject([0,this.height],t),s=this.unproject([this.width,this.height],t);return[Math.min(r[0],i[0],n[0],s[0]),Math.min(r[1],i[1],n[1],s[1]),Math.max(r[0],i[0],n[0],s[0]),Math.max(r[1],i[1],n[1],s[1])]}getDistanceScales(t){return t?px({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel(t){let{x:r,y:i,width:n=1,height:s=1}=t;return r<this.x+this.width&&this.x<r+n&&i<this.y+this.height&&this.y<i+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,VH(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,r){return null}_initProps(t){const r=t.longitude,i=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=xH({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||px({latitude:i,longitude:r}));const n=Math.pow(2,this.zoom);this.scale=n;const{position:s,modelMatrix:a}=t;let o=DT;if(s&&(o=a?new di(a).transformAsVector(s,[]):s),this.isGeospatial){const f=this.projectPosition([r,i,0]);this.center=new se(o).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(o)}_initMatrices(t){const{viewMatrix:r=$H,projectionMatrix:i=null,orthographic:n=!1,fovyRadians:s,fovy:a=75,near:o=.1,far:f=1e3,padding:m=null,focalDistance:w=1}=t;this.viewMatrixUncentered=r,this.viewMatrix=new di().multiplyRight(r).translate(new se(this.center).negate()),this.projectionMatrix=i||JH({width:this.width,height:this.height,orthographic:n,fovyRadians:s||a*WH,focalDistance:w,padding:m,near:o,far:f});const A=xm();_f(A,A,this.projectionMatrix),_f(A,A,this.viewMatrix),this.viewProjectionMatrix=A,this.viewMatrixInverse=ux([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=GH(this.viewMatrixInverse);const P=xm(),I=xm();IA(P,P,[this.width/2,-this.height/2,1]),x_(P,P,[1,-1,0]),_f(I,P,this.viewProjectionMatrix),this.pixelProjectionMatrix=I,this.pixelUnprojectionMatrix=ux(xm(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||xi.warn("Pixel project matrix not invertible")()}}$(wg,"displayName","Viewport");class Cf extends wg{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:r=0,longitude:i=0,zoom:n=0,pitch:s=0,bearing:a=0,nearZMultiplier:o=.1,farZMultiplier:f=1.01,nearZ:m,farZ:w,orthographic:A=!1,projectionMatrix:P,repeat:I=!1,worldOffset:N=0,position:F,padding:Z,legacyMeterSizes:U=!1}=t;let{width:z,height:J,altitude:nt=1.5}=t;const mt=Math.pow(2,n);z=z||1,J=J||1;let Et,bt=null;if(P)nt=P[5]/2,Et=E_(nt);else{t.fovy?(Et=t.fovy,nt=r6(Et)):Et=E_(nt);let zt;if(Z){const{top:Rt=0,bottom:at=0}=Z;zt=[0,eh((Rt+J-at)/2,0,J)-J/2]}bt=SH({width:z,height:J,scale:mt,center:F&&[0,0,F[2]*Sy(r)],offset:zt,pitch:s,fovy:Et,nearZMultiplier:o,farZMultiplier:f}),Number.isFinite(m)&&(bt.near=m),Number.isFinite(w)&&(bt.far=w)}let pt=AH({height:J,pitch:s,bearing:a,scale:mt,altitude:nt});N&&(pt=new di().translate([512*N,0,0]).multiplyLeft(pt)),super({...t,width:z,height:J,viewMatrix:pt,longitude:i,latitude:r,zoom:n,...bt,fovy:Et,focalDistance:nt}),$(this,"longitude",void 0),$(this,"latitude",void 0),$(this,"pitch",void 0),$(this,"bearing",void 0),$(this,"altitude",void 0),$(this,"fovy",void 0),$(this,"orthographic",void 0),$(this,"_subViewports",void 0),$(this,"_pseudoMeters",void 0),this.latitude=r,this.longitude=i,this.zoom=n,this.pitch=s,this.bearing=a,this.altitude=nt,this.fovy=Et,this.orthographic=A,this._subViewports=I?[]:null,this._pseudoMeters=U,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),r=Math.floor((t[0]+180)/360),i=Math.ceil((t[2]-180)/360);for(let n=r;n<=i;n++){const s=n?new Cf({...this,worldOffset:n}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[r,i]=this.projectFlat(t),n=(t[2]||0)*Sy(t[1]);return[r,i,n]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[r,i]=this.unprojectFlat(t),n=(t[2]||0)/Sy(i);return[r,i,n]}addMetersToLngLat(t,r){return e6(t,r)}panByPosition(t,r){const i=DA(r,this.pixelUnprojectionMatrix),n=this.projectFlat(t),s=yT([],n,JG([],i)),a=yT([],this.center,s),[o,f]=this.unprojectFlat(a);return{longitude:o,latitude:f}}getBounds(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=TH(this,t.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:i,height:n}=this,{longitude:s,latitude:a,zoom:o}=EH({width:i,height:n,bounds:t,...r});return new Cf({width:i,height:n,longitude:s,latitude:a,zoom:o})}}$(Cf,"displayName","WebMercatorViewport");const NT=[0,0,0];function c2(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=t.projectPosition(e);if(r&&t instanceof Cf){const[n,s,a=0]=e,o=t.getDistanceScales([n,s]);i[2]=a*o.unitsPerMeter[2]}return i}function XH(e){const{viewport:t,modelMatrix:r,coordinateOrigin:i}=e;let{coordinateSystem:n,fromCoordinateSystem:s,fromCoordinateOrigin:a}=e;return n===vi.DEFAULT&&(n=t.isGeospatial?vi.LNGLAT:vi.CARTESIAN),s===void 0&&(s=n),a===void 0&&(a=i),{viewport:t,coordinateSystem:n,coordinateOrigin:i,modelMatrix:r,fromCoordinateSystem:s,fromCoordinateOrigin:a}}function n6(e,t){let{viewport:r,modelMatrix:i,coordinateSystem:n,coordinateOrigin:s,offsetMode:a}=t,[o,f,m=0]=e;switch(i&&([o,f,m]=k0([],[o,f,m,1],i)),n){case vi.LNGLAT:return c2([o,f,m],r,a);case vi.LNGLAT_OFFSETS:return c2([o+s[0],f+s[1],m+(s[2]||0)],r,a);case vi.METER_OFFSETS:return c2(e6(s,[o,f,m]),r,a);case vi.CARTESIAN:default:return r.isGeospatial?[o+s[0],f+s[1],m+s[2]]:r.projectPosition([o,f,m])}}function KH(e,t){const{viewport:r,coordinateSystem:i,coordinateOrigin:n,modelMatrix:s,fromCoordinateSystem:a,fromCoordinateOrigin:o}=XH(t),{autoOffset:f=!0}=t,{geospatialOrigin:m=NT,shaderCoordinateOrigin:w=NT,offsetMode:A=!1}=f?QB(r,i,n):{},P=n6(e,{viewport:r,modelMatrix:s,coordinateSystem:a,coordinateOrigin:o,offsetMode:A});if(A){const I=r.projectPosition(m||w);aV(P,P,I)}return P}const FT={blendFunc:[1,0,32771,0],blendEquation:32774};class s6 extends kA{constructor(){super(...arguments),$(this,"pickZ",void 0),$(this,"_colorEncoderState",null)}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer(t){let{layers:r,layerFilter:i,views:n,viewports:s,onViewportActive:a,pickingFBO:o,deviceRect:{x:f,y:m,width:w,height:A},cullRect:P,effects:I,pass:N="picking",pickZ:F,moduleParameters:Z}=t;const U=this.gl;this.pickZ=F;const z=this._resetColorEncoder(F),J=Tc(U,{scissorTest:!0,scissor:[f,m,w,A],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...FT,blend:!F},()=>super.render({target:o,layers:r,layerFilter:i,views:n,viewports:s,onViewportActive:a,cullRect:P,effects:I==null?void 0:I.filter(nt=>nt.useInPicking),pass:N,isPicking:!0,moduleParameters:Z}));return this._colorEncoderState=null,{decodePickingColor:z&&QH.bind(null,z),stats:J}}shouldDrawLayer(t){const{pickable:r,operation:i}=t.props;return r&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,r,i){const n={...t.props.parameters},{pickable:s,operation:a}=t.props;return this._colorEncoderState?s&&a.includes("draw")&&(Object.assign(n,FT),n.blend=!0,n.blendColor=YH(this._colorEncoderState,t,i)):n.blend=!1,a.includes("terrain")&&(n.blend=!1),n}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function YH(e,t,r){const{byLayer:i,byAlpha:n}=e;let s,a=i.get(t);return a?(a.viewports.push(r),s=a.a):(s=i.size+1,s<=255?(a={a:s,layer:t,viewports:[r]},i.set(t,a),n[s]=a):(xi.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function QH(e,t){const r=e.byAlpha[t[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(t)}}const fp={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},C_=Symbol.for("component"),yd=Symbol.for("propTypes"),u2=Symbol.for("deprecatedProps"),Vp=Symbol.for("asyncPropDefaults"),Tf=Symbol.for("asyncPropOriginal"),od=Symbol.for("asyncPropResolved");function sv(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(e)?o6(e,t,[]):t(e)?[e]:[]}function o6(e,t,r){let i=-1;for(;++i<e.length;){const n=e[i];Array.isArray(n)?o6(n,t,r):t(n)&&r.push(n)}return r}function tW(e){let{target:t,source:r,start:i=0,count:n=1}=e;const s=r.length,a=n*s;let o=0;for(let f=i;o<s;o++)t[f++]=r[o];for(;o<a;)o<a-o?(t.copyWithin(i+o,i,i+o),o*=2):(t.copyWithin(i+o,i,i+a-o),o=a);return t}class eW{constructor(t,r,i){$(this,"id",void 0),$(this,"context",void 0),$(this,"isLoaded",void 0),$(this,"persistent",void 0),$(this,"_loadCount",0),$(this,"_subscribers",new Set),$(this,"_data",void 0),$(this,"_loader",void 0),$(this,"_error",void 0),$(this,"_content",void 0),this.id=t,this.context=i,this.setData(r)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,r){if(t===this._data&&!r)return;this._data=t;const i=++this._loadCount;let n=t;typeof t=="string"&&(n=wd(t)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const s of this._subscribers)s.onChange(this.getData())}}class rW{constructor(t){let{gl:r,protocol:i}=t;$(this,"protocol",void 0),$(this,"_context",void 0),$(this,"_resources",void 0),$(this,"_consumers",void 0),$(this,"_pruneRequest",void 0),this.protocol=i||"resource://",this._context={gl:r,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add(t){let{resourceId:r,data:i,forceUpdate:n=!1,persistent:s=!0}=t,a=this._resources[r];a?a.setData(i,n):(a=new eW(r,i,this._context),this._resources[r]=a),a.persistent=s}remove(t){const r=this._resources[t];r&&(r.delete(),delete this._resources[t])}unsubscribe(t){let{consumerId:r}=t;const i=this._consumers[r];if(i){for(const n in i){const s=i[n],a=this._resources[s.resourceId];a&&a.unsubscribe(s)}delete this._consumers[r],this.prune()}}subscribe(t){let{resourceId:r,onChange:i,consumerId:n,requestId:s="default"}=t;const{_resources:a,protocol:o}=this;r.startsWith(o)&&(r=r.replace(o,""),a[r]||this.add({resourceId:r,data:null,persistent:!1}));const f=a[r];if(this._track(n,s,f,i),f)return f.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,r,i,n){const s=this._consumers,a=s[t]=s[t]||{},o=a[r]||{},f=o.resourceId&&this._resources[o.resourceId];f&&(f.unsubscribe(o),this.prune()),i&&(a[r]=o,o.onChange=n,o.resourceId=i.id,i.subscribe(o))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const r=this._resources[t];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[t])}}}const iW=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,FA={name:"project32",dependencies:[RA],vs:iW},zA={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...pq},nW=[RA],sW=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function oW(e){const t=R0.getDefaultProgramManager(e);for(const r of nW)t.addDefaultModule(r);for(const r of sW)t.addShaderHook(r);return t}const aW="layerManager.setLayers",lW="layerManager.activateViewport";class cW{constructor(t){let{deck:r,stats:i,viewport:n,timeline:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$(this,"layers",void 0),$(this,"context",void 0),$(this,"resourceManager",void 0),$(this,"_lastRenderedLayers",[]),$(this,"_needsRedraw",!1),$(this,"_needsUpdate",!1),$(this,"_nextLayers",null),$(this,"_debug",!1),$(this,"activateViewport",a=>{wo(lW,this,a),a&&(this.context.viewport=a)}),this.layers=[],this.resourceManager=new rW({gl:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:t,deck:r,programManager:t&&oW(t),stats:i||new gA({id:"deck.gl"}),viewport:n||new wg({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new $B,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const n=i.getNeedsRedraw(t);r=r||n}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers(){let{layerIds:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t?this.layers.filter(r=>t.find(i=>r.id.indexOf(i)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,r){wo(aW,this,r,t),this._lastRenderedLayers=t;const i=sv(t,Boolean);for(const n of i)n.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}_handleError(t,r,i){i.raiseError(r,"".concat(t," of ").concat(i))}_updateLayers(t,r){const i={};for(const a of t)i[a.id]?xi.warn("Multiple old layers with same id ".concat(a.id))():i[a.id]=a;const n=[];this._updateSublayersRecursively(r,i,n),this._finalizeOldLayers(i);let s=!1;for(const a of n)if(a.hasUniformTransition()){s="Uniform transition in ".concat(a);break}this._needsUpdate=s,this.layers=n}_updateSublayersRecursively(t,r,i){for(const n of t){n.context=this.context;const s=r[n.id];s===null&&xi.warn("Multiple new layers with same id ".concat(n.id))(),r[n.id]=null;let a=null;try{this._debug&&s!==n&&n.validateProps(),s?(this._transferLayerState(s,n),this._updateLayer(n)):this._initializeLayer(n),i.push(n),a=n.isComposite?n.getSubLayers():null}catch(o){this._handleError("matching",o,n)}a&&this._updateSublayersRecursively(a,r,i)}}_finalizeOldLayers(t){for(const r in t){const i=t[r];i&&this._finalizeLayer(i)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=fp.INITIALIZED}catch(r){this._handleError("initialization",r,t)}}_transferLayerState(t,r){r._transferState(t),r.lifecycle=fp.MATCHED,r!==t&&(t.lifecycle=fp.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(r){this._handleError("update",r,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=fp.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=fp.FINALIZED}catch(r){this._handleError("finalization",r,t)}}}function uu(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!uu(e[i],t[i],r-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){const i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(const s of i)if(!t.hasOwnProperty(s)||!uu(e[s],t[s],r-1))return!1;return!0}return!1}class uW{constructor(t){$(this,"width",void 0),$(this,"height",void 0),$(this,"views",void 0),$(this,"viewState",void 0),$(this,"controllers",void 0),$(this,"timeline",void 0),$(this,"_viewports",void 0),$(this,"_viewportMap",void 0),$(this,"_isUpdating",void 0),$(this,"_needsRedraw",void 0),$(this,"_needsUpdate",void 0),$(this,"_eventManager",void 0),$(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const r=this.controllers[t];r&&r.finalize()}this.controllers={}}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const r=this.controllers[t];r&&r.updateTransition()}}getViewports(t){return t?this._viewports.filter(r=>r.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(r=>{t[r.id]=r}),t}getView(t){return this.views.find(r=>r.id===t)}getViewState(t){const r=typeof t=="string"?this.getView(t):t,i=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(i):i}getViewport(t){return this._viewportMap[t]}unproject(t,r){const i=this.getViewports(),n={x:t[0],y:t[1]};for(let s=i.length-1;s>=0;--s){const a=i[s];if(a.containsPixel(n)){const o=t.slice();return o[0]-=a.x,o[1]-=a.y,a.unproject(o,r)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,r){(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(t){t=sv(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!uu(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):xi.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,r){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...r,viewId:t})}_createController(t,r){const i=r.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,r.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:n=>{var s;return(s=this.getView(t.id))===null||s===void 0?void 0:s.makeViewport({viewState:n,width:this.width,height:this.height})}})}_updateController(t,r,i,n){const s=t.controller;if(s&&i){const a={...r,...s,id:t.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!n||n.constructor!==s.type)&&(n=this._createController(t,a)),n&&n.setProps(a),n}return null}_rebuildViewports(){const{views:t}=this,r=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let n=t.length;n--;){const s=t[n],a=this.getViewState(s),o=s.makeViewport({viewState:a,width:this.width,height:this.height});let f=r[s.id];const m=!!s.controller;m&&!f&&(i=!0),(i||!m)&&f&&(f.finalize(),f=null),this.controllers[s.id]=this._updateController(s,a,o,f),o&&this._viewports.unshift(o)}for(const n in r){const s=r[n];s&&!this.controllers[n]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,r){return t.length!==r.length?!0:t.some((i,n)=>!t[n].equals(r[n]))}}const hW=/([0-9]+\.?[0-9]*)(%|px)/;function qh(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=hW.exec(e);if(t&&t.length>=3){const r=t[2]==="%",i=parseFloat(t[1]);return{position:r?i/100:i,relative:r}}default:throw new Error("Could not parse position string ".concat(e))}}function Hh(e,t){return e.relative?Math.round(e.position*t):e.position}function Ys(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}class dW{constructor(t){$(this,"id",void 0),$(this,"viewportInstance",void 0),$(this,"_x",void 0),$(this,"_y",void 0),$(this,"_width",void 0),$(this,"_height",void 0),$(this,"_padding",void 0),$(this,"props",void 0);const{id:r,x:i=0,y:n=0,width:s="100%",height:a="100%",padding:o=null,viewportInstance:f}=t||{};Ys(!f||f instanceof wg),this.viewportInstance=f,this.id=r||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=qh(i),this._y=qh(n),this._width=qh(s),this._height=qh(a),this._padding=o&&{left:qh(o.left||0),right:qh(o.right||0),top:qh(o.top||0),bottom:qh(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.viewportInstance?t.viewportInstance?this.viewportInstance.equals(t.viewportInstance):!1:this.ViewportType===t.ViewportType&&uu(this.props,t.props,2)}makeViewport(t){let{width:r,height:i,viewState:n}=t;if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);const s=this.getDimensions({width:r,height:i});return!s.height||!s.width?null:new this.ViewportType({...n,...this.props,...s})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const r={...t};for(const i in this.props.viewState)i!=="id"&&(r[i]=this.props.viewState[i]);return r}return t}getDimensions(t){let{width:r,height:i}=t;const n={x:Hh(this._x,r),y:Hh(this._y,i),width:Hh(this._width,r),height:Hh(this._height,i)};return this._padding&&(n.padding={left:Hh(this._padding.left,r),top:Hh(this._padding.top,i),right:Hh(this._padding.right,r),bottom:Hh(this._padding.bottom,i)}),n}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class D0{constructor(t){$(this,"_inProgress",void 0),$(this,"_handle",void 0),$(this,"_timeline",void 0),$(this,"time",void 0),$(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=t,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(t){var r,i;this.cancel(),this.settings=t,this._inProgress=!0,(r=(i=this.settings).onStart)===null||r===void 0||r.call(i,this)}end(){if(this._inProgress){var t,r;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(r=this.settings).onEnd)===null||t===void 0||t.call(r,this)}}cancel(){if(this._inProgress){var t,r;(t=(r=this.settings).onInterrupt)===null||t===void 0||t.call(r,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var t,r;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:n}=this;this._handle=i.addChannel({delay:i.getTime(),duration:n.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(r=this.settings).onUpdate)===null||t===void 0||t.call(r,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const zT=()=>{},gx={BREAK:1,SNAP_TO_END:2,IGNORE:3},fW=e=>e,pW=gx.BREAK;class gW{constructor(t){$(this,"getControllerState",void 0),$(this,"props",void 0),$(this,"propsInTransition",void 0),$(this,"transition",void 0),$(this,"onViewStateChange",void 0),$(this,"onStateChange",void 0),$(this,"_onTransitionUpdate",r=>{const{time:i,settings:{interpolator:n,startProps:s,endProps:a,duration:o,easing:f}}=r,m=f(i/o),w=n.interpolateProps(s,a,m);this.propsInTransition=this.getControllerState({...this.props,...w}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new D0(t.timeline),this.onViewStateChange=t.onViewStateChange||zT,this.onStateChange=t.onStateChange||zT}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let r=!1;const i=this.props;if(this.props=t,!i||this._shouldIgnoreViewportChange(i,t))return!1;if(this._isTransitionEnabled(t)){let n=i;if(this.transition.inProgress){const{interruption:s,endProps:a}=this.transition.settings;n={...i,...s===gx.SNAP_TO_END?a:this.propsInTransition||i}}this._triggerTransition(n,t),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:r,transitionInterpolator:i}=t;return(r>0||r==="auto")&&!!i}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,r){return this.transition.inProgress?this.transition.settings.interruption===gx.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(t,r):!0}_triggerTransition(t,r){const i=this.getControllerState(t),n=this.getControllerState(r).shortestPathFrom(i),s=r.transitionInterpolator,a=s.getDuration?s.getDuration(t,r):r.transitionDuration;if(a===0)return;const o=s.initializeProps(t,n);this.propsInTransition={};const f={duration:a,easing:r.transitionEasing||fW,interpolator:s,interruption:r.transitionInterruption||pW,startProps:o.start,endProps:o.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t==null||t(r)}}}class mW{constructor(t){$(this,"_propsToCompare",void 0),$(this,"_propsToExtract",void 0),$(this,"_requiredProps",void 0);const{compare:r,extract:i,required:n}=t;this._propsToCompare=r,this._propsToExtract=i||r,this._requiredProps=n}arePropsEqual(t,r){for(const i of this._propsToCompare)if(!(i in t)||!(i in r)||!Pc(t[i],r[i]))return!1;return!0}initializeProps(t,r){const i={},n={};for(const s of this._propsToExtract)(s in t||s in r)&&(i[s]=t[s],n[s]=r[s]);return this._checkRequiredProps(i),this._checkRequiredProps(n),{start:i,end:n}}getDuration(t,r){return r.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(r=>{const i=t[r];Ys(Number.isFinite(i)||Array.isArray(i),"".concat(r," is required for transition"))})}}const yW=["longitude","latitude","zoom","bearing","pitch"],_W=["longitude","latitude","zoom"];class a6 extends mW{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=Array.isArray(t)?t:t.transitionProps,i=Array.isArray(t)?{}:t;i.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:yW,required:_W},super(i.transitionProps),$(this,"opts",void 0),this.opts=i}initializeProps(t,r){const i=super.initializeProps(t,r),{makeViewport:n,around:s}=this.opts;if(n&&s){const a=n(t),o=n(r),f=a.unproject(s);i.start.around=s,Object.assign(i.end,{around:o.project(f),aroundPosition:f,width:r.width,height:r.height})}return i}interpolateProps(t,r,i){const n={};for(const s of this._propsToExtract)n[s]=w_(t[s]||0,r[s]||0,i);if(r.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...r,...n});Object.assign(n,s.panByPosition(r.aroundPosition,w_(t.around,r.around,i)))}return n}}const Wh={transitionDuration:0},vW=300,q1=e=>1-(1-e)*(1-e),ap={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Jd={};class bW{constructor(t){$(this,"props",void 0),$(this,"state",{}),$(this,"transitionManager",void 0),$(this,"eventManager",void 0),$(this,"onViewStateChange",void 0),$(this,"onStateChange",void 0),$(this,"makeViewport",void 0),$(this,"_controllerState",void 0),$(this,"_events",{}),$(this,"_interactionState",{isDragging:!1}),$(this,"_customEvents",[]),$(this,"_eventStartBlocked",null),$(this,"_panMove",!1),$(this,"invertPan",!1),$(this,"dragMode","rotate"),$(this,"inertia",0),$(this,"scrollZoom",!0),$(this,"dragPan",!0),$(this,"dragRotate",!0),$(this,"doubleClickZoom",!0),$(this,"touchZoom",!0),$(this,"touchRotate",!1),$(this,"keyboard",!0),this.transitionManager=new gW({...t,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const r in this._events)if(this._events[r]){var t;(t=this.eventManager)===null||t===void 0||t.off(r,this.handleEvent)}this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const r=this._eventStartBlocked;switch(t.type){case"panstart":return r?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return r?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return r?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:r,y:i}=this.props,{offsetCenter:n}=t;return[n.x-r,n.y-i]}isPointInBounds(t,r){const{width:i,height:n}=this.props;if(r&&r.handled)return!1;const s=t[0]>=0&&t[0]<=i&&t[1]>=0&&t[1]<=n;return s&&r&&r.stopPropagation(),s}isFunctionKeyPressed(t){const{srcEvent:r}=t;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=r}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:r}=t;this.inertia=Number.isFinite(r)?r:r===!0?vW:0;const{scrollZoom:i=!0,dragPan:n=!0,dragRotate:s=!0,doubleClickZoom:a=!0,touchZoom:o=!0,touchRotate:f=!1,keyboard:m=!0}=t,w=!!this.onViewStateChange;this.toggleEvents(ap.WHEEL,w&&i),this.toggleEvents(ap.PAN,w),this.toggleEvents(ap.PINCH,w&&(o||f)),this.toggleEvents(ap.TRIPLE_PAN,w&&f),this.toggleEvents(ap.DOUBLE_TAP,w&&a),this.toggleEvents(ap.KEYBOARD,w&&m),this.scrollZoom=i,this.dragPan=n,this.dragRotate=s,this.doubleClickZoom=a,this.touchZoom=o,this.touchRotate=f,this.keyboard=m}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,r){this.eventManager&&t.forEach(i=>{this._events[i]!==r&&(this._events[i]=r,r?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n={...t.getViewportProps(),...r},s=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(i),s){const a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:a})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let i=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const n=this.controllerState[i?"panStart":"rotateStart"]({pos:r});return this._panMove=i,this.updateViewport(n,Wh,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const r=this.getCenter(t),i=this.controllerState.pan({pos:r});return this.updateViewport(i,Wh,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:r}=this;if(this.dragPan&&r&&t.velocity){const i=this.getCenter(t),n=[i[0]+t.velocityX*r/2,i[1]+t.velocityY*r/2],s=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:q1},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const r=this.getCenter(t),i=this.controllerState.rotate({pos:r});return this.updateViewport(i,Wh,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:r}=this;if(this.dragRotate&&r&&t.velocity){const i=this.getCenter(t),n=[i[0]+t.velocityX*r/2,i[1]+t.velocityY*r/2],s=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:q1},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;t.srcEvent.preventDefault();const{speed:i=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=t;let a=2/(1+Math.exp(-Math.abs(s*i)));s<0&&a!==0&&(a=1/a);const o=this.controllerState.zoom({pos:r,scale:a});return this.updateViewport(o,{...this._getTransitionProps({around:r}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;const i=this.controllerState.rotateStart({pos:r});return this.updateViewport(i,Wh,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;const r=this.getCenter(t);r[0]-=t.deltaX;const i=this.controllerState.rotate({pos:r});return this.updateViewport(i,Wh,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:r}=this;if(this.touchRotate&&r&&t.velocityY){const i=this.getCenter(t),n=[i[0],i[1]+=t.velocityY*r/2],s=this.controllerState.rotate({pos:n});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:q1},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;const i=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return Jd._startPinchRotation=t.rotation,Jd._lastPinchEvent=t,this.updateViewport(i,Wh,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){const{scale:i}=t,n=this.getCenter(t);r=r.zoom({pos:n,scale:i})}if(this.touchRotate){const{rotation:i}=t;r=r.rotate({deltaAngleX:Jd._startPinchRotation-i})}return this.updateViewport(r,Wh,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Jd._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:r}=this,{_lastPinchEvent:i}=Jd;if(this.touchZoom&&r&&i&&t.scale!==i.scale){const n=this.getCenter(t);let s=this.controllerState.rotateEnd();const a=Math.log2(t.scale),o=(a-Math.log2(i.scale))/(t.deltaTime-i.deltaTime),f=Math.pow(2,a+o*r/2);s=s.zoom({pos:n,scale:f}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:n}),transitionDuration:r,transitionEasing:q1},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{const n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Jd._startPinchRotation=null,Jd._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;const i=this.isFunctionKeyPressed(t),n=this.controllerState.zoom({pos:r,scale:i?.5:2});return this.updateViewport(n,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const r=this.isFunctionKeyPressed(t),{zoomSpeed:i,moveSpeed:n,rotateSpeedX:s,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:o}=this;let f;const m={};switch(t.srcEvent.code){case"Minus":f=r?o.zoomOut(i).zoomOut(i):o.zoomOut(i),m.isZooming=!0;break;case"Equal":f=r?o.zoomIn(i).zoomIn(i):o.zoomIn(i),m.isZooming=!0;break;case"ArrowLeft":r?(f=o.rotateLeft(s),m.isRotating=!0):(f=o.moveLeft(n),m.isPanning=!0);break;case"ArrowRight":r?(f=o.rotateRight(s),m.isRotating=!0):(f=o.moveRight(n),m.isPanning=!0);break;case"ArrowUp":r?(f=o.rotateUp(a),m.isRotating=!0):(f=o.moveUp(n),m.isPanning=!0);break;case"ArrowDown":r?(f=o.rotateDown(a),m.isRotating=!0):(f=o.moveDown(n),m.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),m),!0}_getTransitionProps(t){const{transition:r}=this;return!r||!r.transitionInterpolator?Wh:t?{...r,transitionInterpolator:new a6({...t,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}}class wW{constructor(t,r){$(this,"_viewportProps",void 0),$(this,"_state",void 0),this._viewportProps=this.applyConstraints(t),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}}const jT=5,xW=1.2;class AW extends wW{constructor(t){const{width:r,height:i,latitude:n,longitude:s,zoom:a,bearing:o=0,pitch:f=0,altitude:m=1.5,position:w=[0,0,0],maxZoom:A=20,minZoom:P=0,maxPitch:I=60,minPitch:N=0,startPanLngLat:F,startZoomLngLat:Z,startRotatePos:U,startBearing:z,startPitch:J,startZoom:nt,normalize:mt=!0}=t;Ys(Number.isFinite(s)),Ys(Number.isFinite(n)),Ys(Number.isFinite(a)),super({width:r,height:i,latitude:n,longitude:s,zoom:a,bearing:o,pitch:f,altitude:m,maxZoom:A,minZoom:P,maxPitch:I,minPitch:N,normalize:mt,position:w},{startPanLngLat:F,startZoomLngLat:Z,startRotatePos:U,startBearing:z,startPitch:J,startZoom:nt}),$(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart(t){let{pos:r}=t;return this._getUpdatedState({startPanLngLat:this._unproject(r)})}pan(t){let{pos:r,startPos:i}=t;const n=this.getState().startPanLngLat||this._unproject(i);if(!n)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(n,r);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(t){let{pos:r}=t;return this._getUpdatedState({startRotatePos:r,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(t){let{pos:r,deltaAngleX:i=0,deltaAngleY:n=0}=t;const{startRotatePos:s,startBearing:a,startPitch:o}=this.getState();if(!s||a===void 0||o===void 0)return this;let f;return r?f=this._getNewRotation(r,s,o,a):f={bearing:a+i,pitch:o+n},this._getUpdatedState(f)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(t){let{pos:r}=t;return this._getUpdatedState({startZoomLngLat:this._unproject(r),startZoom:this.getViewportProps().zoom})}zoom(t){let{pos:r,startPos:i,scale:n}=t,{startZoom:s,startZoomLngLat:a}=this.getState();if(a||(s=this.getViewportProps().zoom,a=this._unproject(i)||this._unproject(r)),!a)return this;const{maxZoom:o,minZoom:f}=this.getViewportProps();let m=s+Math.log2(n);m=eh(m,f,o);const w=this.makeViewport({...this.getViewportProps(),zoom:m});return this._getUpdatedState({zoom:m,...w.panByPosition(a,r)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(t)}zoomOut(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/t)}moveLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([t,0])}moveRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-t,0])}moveUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,t])}moveDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-t])}rotateLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const r=t.getViewportProps(),i={...this.getViewportProps()},{bearing:n,longitude:s}=i;return Math.abs(n-r.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(s-r.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(t){const{maxZoom:r,minZoom:i,zoom:n}=t;t.zoom=eh(n,i,r);const{maxPitch:s,minPitch:a,pitch:o}=t;t.pitch=eh(o,a,s);const{normalize:f=!0}=t;return f&&Object.assign(t,PH(t)),t}_zoomFromCenter(t){const{width:r,height:i}=this.getViewportProps();return this.zoom({pos:[r/2,i/2],scale:t})}_panFromCenter(t){const{width:r,height:i}=this.getViewportProps();return this.pan({startPos:[r/2,i/2],pos:[r/2+t[0],i/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const r=this.makeViewport(this.getViewportProps());return t&&r.unproject(t)}_getNewRotation(t,r,i,n){const s=t[0]-r[0],a=t[1]-r[1],o=t[1],f=r[1],{width:m,height:w}=this.getViewportProps(),A=s/m;let P=0;a>0?Math.abs(w-f)>jT&&(P=a/(f-w)*xW):a<0&&f>jT&&(P=1-o/f),P=eh(P,-1,1);const{minPitch:I,maxPitch:N}=this.getViewportProps(),F=n+180*A;let Z=i;return P>0?Z=i+P*(N-i):P<0&&(Z=i-P*(I-i)),{pitch:Z,bearing:F}}}class SW extends bW{constructor(){super(...arguments),$(this,"ControllerState",AW),$(this,"transition",{transitionDuration:300,transitionInterpolator:new a6({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),$(this,"dragMode","pan")}setProps(t){t.position=t.position||[0,0,0];const r=this.props;super.setProps(t),(!r||r.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class jA extends dW{get ViewportType(){return Cf}get ControllerType(){return SW}}$(jA,"displayName","MapView");const EW=new NA;function CW(e,t){var r,i;const n=(r=e.order)!==null&&r!==void 0?r:1/0,s=(i=t.order)!==null&&i!==void 0?i:1/0;return n-s}class TW{constructor(){$(this,"effects",void 0),$(this,"_resolvedEffects",[]),$(this,"_defaultEffects",[]),$(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const r=this._defaultEffects;if(!r.find(i=>i.id===t.id)){const i=r.findIndex(n=>CW(n,t)>0);i<0?r.push(t):r.splice(i,0,t),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(uu(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(t){const r={};for(const n of this.effects)r[n.id]=n;const i=[];for(const n of t){const s=r[n.id];s&&s!==n?s.setProps?(s.setProps(n.props),i.push(s)):(s.cleanup(),i.push(n)):i.push(n),delete r[n.id]}for(const n in r)r[n].cleanup();this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),t.some(n=>n instanceof NA)||this._resolvedEffects.push(EW),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class PW extends kA{shouldDrawLayer(t){const{operation:r}=t.props;return r.includes("draw")||r.includes("terrain")}}const IW="deckRenderer.renderLayers";class MW{constructor(t){$(this,"gl",void 0),$(this,"layerFilter",void 0),$(this,"drawPickingColors",void 0),$(this,"drawLayersPass",void 0),$(this,"pickLayersPass",void 0),$(this,"renderCount",void 0),$(this,"_needsRedraw",void 0),$(this,"renderBuffers",void 0),$(this,"lastPostProcessEffect",void 0),this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new PW(t),this.pickLayersPass=new s6(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t,target:t.target||ws.getDefaultFramebuffer(this.gl)};i.effects&&this._preRender(i.effects,i);const n=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,s=r.render({...i,target:n});i.effects&&this._postRender(i.effects,i),this.renderCount++,wo(IW,this,s,t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){const{renderBuffers:t}=this;for(const r of t)r.delete();t.length=0}_preRender(t,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(const i of t)r.preRenderStats[i.id]=i.preRender(this.gl,r),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this;t.length===0&&t.push(new ws(this.gl),new ws(this.gl));for(const r of t)r.resize()}_postRender(t,r){const{renderBuffers:i}=this,n={...r,inputBuffer:i[0],swapBuffer:i[1],target:null};for(const s of t)if(s.postRender){if(s.id===this.lastPostProcessEffect){n.target=r.target,s.postRender(this.gl,n);break}const a=s.postRender(this.gl,n);n.inputBuffer=a,n.swapBuffer=a===i[0]?i[1]:i[0]}}}const LW={pickedColor:null,pickedObjectIndex:-1};function BW(e){let{pickedColors:t,decodePickingColor:r,deviceX:i,deviceY:n,deviceRadius:s,deviceRect:a}=e;const{x:o,y:f,width:m,height:w}=a;let A=s*s,P=-1,I=0;for(let N=0;N<w;N++){const F=N+f-n,Z=F*F;if(Z>A)I+=4*m;else for(let U=0;U<m;U++){if(t[I+3]-1>=0){const z=U+o-i,J=z*z+Z;J<=A&&(A=J,P=I)}I+=4}}if(P>=0){const N=t.slice(P,P+4),F=r(N);if(F){const Z=Math.floor(P/4/m),U=P/4-Z*m;return{...F,pickedColor:N,pickedX:o+U,pickedY:f+Z}}xi.error("Picked non-existent layer. Is picking buffer corrupt?")()}return LW}function kW(e){let{pickedColors:t,decodePickingColor:r}=e;const i=new Map;if(t){for(let n=0;n<t.length;n+=4)if(t[n+3]-1>=0){const s=t.slice(n,n+4),a=s.join(",");if(!i.has(a)){const o=r(s);o?i.set(a,{...o,color:s}):xi.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function l6(e){let{pickInfo:t,viewports:r,pixelRatio:i,x:n,y:s,z:a}=e,o=r[0];r.length>1&&(o=OW((t==null?void 0:t.pickedViewports)||r,{x:n,y:s}));let f;if(o){const m=[n-o.x,s-o.y];a!==void 0&&(m[2]=a),f=o.unproject(m)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:n,y:s,pixel:[n,s],coordinate:f,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:i}}function RW(e){const{pickInfo:t,lastPickedInfo:r,mode:i,layers:n}=e,{pickedColor:s,pickedLayer:a,pickedObjectIndex:o}=t,f=a?[a]:[];if(i==="hover"){const A=r.index,P=r.layerId,I=a?a.props.id:null;if(I!==P||o!==A){if(I!==P){const N=n.find(F=>F.props.id===P);N&&f.unshift(N)}r.layerId=I,r.index=o,r.info=null}}const m=l6(e),w=new Map;return w.set(null,m),f.forEach(A=>{let P={...m};A===a&&(P.color=s,P.index=o,P.picked=!0),P=c6({layer:A,info:P,mode:i});const I=P.layer;A===a&&i==="hover"&&(r.info=P),w.set(I.id,P),i==="hover"&&I.updateAutoHighlight(P)}),w}function c6(e){let{layer:t,info:r,mode:i}=e;for(;t&&r;){const n=r.layer||null;r.sourceLayer=n,r.layer=t,r=t.getPickingInfo({info:r,mode:i,sourceLayer:n}),t=t.parent}return r}function OW(e,t){for(let r=e.length-1;r>=0;r--){const i=e[r];if(i.containsPixel(t))return i}return e[0]}class DW{constructor(t){$(this,"gl",void 0),$(this,"pickingFBO",void 0),$(this,"depthFBO",void 0),$(this,"pickLayersPass",void 0),$(this,"layerFilter",void 0),$(this,"lastPickedInfo",void 0),$(this,"_pickable",!0),this.gl=t,this.pickLayersPass=new s6(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject(t){let{x:r,y:i,layers:n,viewports:s}=t,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const o=a&&a.layer&&a.layer.id,f=a&&a.viewport&&a.viewport.id,m=o?n.find(P=>P.id===o):null,w=f&&s.find(P=>P.id===f)||s[0],A=w&&w.unproject([r-w.x,i-w.y]);return{...a,x:r,y:i,viewport:w,coordinate:A,layer:m}}_resizeBuffer(){var t,r;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new ws(i),ws.isSupported(i,{colorBufferFloat:!0}))){const n=new ws(i);n.attach({36064:new Xa(i,{format:ni(i)?34836:6408,type:5126})}),this.depthFBO=n}(t=this.pickingFBO)===null||t===void 0||t.resize({width:i.canvas.width,height:i.canvas.height}),(r=this.depthFBO)===null||r===void 0||r.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(t){if(this._pickable===!1)return null;const r=t.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return r.length?r:null}_pickClosestObject(t){let{layers:r,views:i,viewports:n,x:s,y:a,radius:o=0,depth:f=1,mode:m="query",unproject3D:w,onViewportActive:A,effects:P}=t;const I=this._getPickable(r),N=og(this.gl);if(!I)return{result:[],emptyInfo:l6({viewports:n,x:s,y:a,pixelRatio:N})};this._resizeBuffer();const F=Zb(this.gl,[s,a],!0),Z=[F.x+Math.floor(F.width/2),F.y+Math.floor(F.height/2)],U=Math.round(o*N),{width:z,height:J}=this.pickingFBO,nt=this._getPickingRect({deviceX:Z[0],deviceY:Z[1],deviceRadius:U,deviceWidth:z,deviceHeight:J}),mt={x:s-o,y:a-o,width:o*2+1,height:o*2+1};let Et;const bt=[],pt=new Set;for(let zt=0;zt<f;zt++){let Rt;if(nt){const dt=this._drawAndSample({layers:I,views:i,viewports:n,onViewportActive:A,deviceRect:nt,cullRect:mt,effects:P,pass:"picking:".concat(m)});Rt=BW({...dt,deviceX:Z[0],deviceY:Z[1],deviceRadius:U,deviceRect:nt})}else Rt={pickedColor:null,pickedObjectIndex:-1};let at;if(Rt.pickedLayer&&w&&this.depthFBO){const{pickedColors:dt}=this._drawAndSample({layers:[Rt.pickedLayer],views:i,viewports:n,onViewportActive:A,deviceRect:{x:Rt.pickedX,y:Rt.pickedY,width:1,height:1},cullRect:mt,effects:P,pass:"picking:".concat(m,":z")},!0);dt[3]&&(at=dt[0])}Rt.pickedLayer&&zt+1<f&&(pt.add(Rt.pickedLayer),Rt.pickedLayer.disablePickingIndex(Rt.pickedObjectIndex)),Et=RW({pickInfo:Rt,lastPickedInfo:this.lastPickedInfo,mode:m,layers:I,viewports:n,x:s,y:a,z:at,pixelRatio:N});for(const dt of Et.values())dt.layer&&bt.push(dt);if(!Rt.pickedColor)break}for(const zt of pt)zt.restorePickingColors();return{result:bt,emptyInfo:Et.get(null)}}_pickVisibleObjects(t){let{layers:r,views:i,viewports:n,x:s,y:a,width:o=1,height:f=1,mode:m="query",maxObjects:w=null,onViewportActive:A,effects:P}=t;const I=this._getPickable(r);if(!I)return[];this._resizeBuffer();const N=og(this.gl),F=Zb(this.gl,[s,a],!0),Z=F.x,U=F.y+F.height,z=Zb(this.gl,[s+o,a+f],!0),J=z.x+z.width,nt=z.y,mt={x:Z,y:nt,width:J-Z,height:U-nt},Et=this._drawAndSample({layers:I,views:i,viewports:n,onViewportActive:A,deviceRect:mt,cullRect:{x:s,y:a,width:o,height:f},effects:P,pass:"picking:".concat(m)}),bt=kW(Et),pt=new Map,zt=Number.isFinite(w);for(let at=0;at<bt.length;at++){var Rt;if(zt&&w&&pt.size>=w)break;const dt=bt[at];let kt={color:dt.pickedColor,layer:null,index:dt.pickedObjectIndex,picked:!0,x:s,y:a,pixelRatio:N};kt=c6({layer:dt.pickedLayer,info:kt,mode:m});const xt=(Rt=kt.object)!==null&&Rt!==void 0?Rt:"".concat(kt.layer.id,"[").concat(kt.index,"]");pt.has(xt)||pt.set(xt,kt)}return Array.from(pt.values())}_drawAndSample(t){let{layers:r,views:i,viewports:n,onViewportActive:s,deviceRect:a,cullRect:o,effects:f,pass:m}=t,w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const A=w?this.depthFBO:this.pickingFBO,P={layers:r,layerFilter:this.layerFilter,views:i,viewports:n,onViewportActive:s,pickingFBO:A,deviceRect:a,cullRect:o,effects:f,pass:m,pickZ:w,preRenderStats:{}};for(const J of f)J.useInPicking&&(P.preRenderStats[J.id]=J.preRender(this.gl,P));const{decodePickingColor:I}=this.pickLayersPass.render(P),{x:N,y:F,width:Z,height:U}=a,z=new(w?Float32Array:Uint8Array)(Z*U*4);return nv(A,{sourceX:N,sourceY:F,sourceWidth:Z,sourceHeight:U,target:z}),{pickedColors:z,decodePickingColor:I}}_getPickingRect(t){let{deviceX:r,deviceY:i,deviceRadius:n,deviceWidth:s,deviceHeight:a}=t;const o=Math.max(0,r-n),f=Math.max(0,i-n),m=Math.min(s,r+n+1)-o,w=Math.min(a,i+n+1)-f;return m<=0||w<=0?null:{x:o,y:f,width:m,height:w}}}const NW={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class FW{constructor(t){$(this,"el",null),$(this,"isVisible",!1);const r=t.parentElement;r&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,NW),r.appendChild(this.el))}setTooltip(t,r,i){const n=this.el;if(n){if(typeof t=="string")n.innerText=t;else if(t)t.text&&(n.innerText=t.text),t.html&&(n.innerHTML=t.html),t.className&&(n.className=t.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform="translate(".concat(r,"px, ").concat(i,"px)"),t&&typeof t=="object"&&"style"in t&&Object.assign(n.style,t.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var u6={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(e){(function(t,r,i,n){var s=["","webkit","Moz","MS","ms","o"],a=r.createElement("div"),o="function",f=Math.round,m=Math.abs,w=Date.now;function A(st,vt,jt){return setTimeout(J(st,jt),vt)}function P(st,vt,jt){return Array.isArray(st)?(I(st,jt[vt],jt),!0):!1}function I(st,vt,jt){var pe;if(st)if(st.forEach)st.forEach(vt,jt);else if(st.length!==n)for(pe=0;pe<st.length;)vt.call(jt,st[pe],pe,st),pe++;else for(pe in st)st.hasOwnProperty(pe)&&vt.call(jt,st[pe],pe,st)}function N(st,vt,jt){var pe="DEPRECATED METHOD: "+vt+`
`+jt+` AT 
`;return function(){var Ee=new Error("get-stack-trace"),yr=Ee&&Ee.stack?Ee.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Br=t.console&&(t.console.warn||t.console.log);return Br&&Br.call(t.console,pe,yr),st.apply(this,arguments)}}var F;typeof Object.assign!="function"?F=function(st){if(st===n||st===null)throw new TypeError("Cannot convert undefined or null to object");for(var vt=Object(st),jt=1;jt<arguments.length;jt++){var pe=arguments[jt];if(pe!==n&&pe!==null)for(var Ee in pe)pe.hasOwnProperty(Ee)&&(vt[Ee]=pe[Ee])}return vt}:F=Object.assign;var Z=N(function(st,vt,jt){for(var pe=Object.keys(vt),Ee=0;Ee<pe.length;)(!jt||jt&&st[pe[Ee]]===n)&&(st[pe[Ee]]=vt[pe[Ee]]),Ee++;return st},"extend","Use `assign`."),U=N(function(st,vt){return Z(st,vt,!0)},"merge","Use `assign`.");function z(st,vt,jt){var pe=vt.prototype,Ee;Ee=st.prototype=Object.create(pe),Ee.constructor=st,Ee._super=pe,jt&&F(Ee,jt)}function J(st,vt){return function(){return st.apply(vt,arguments)}}function nt(st,vt){return typeof st==o?st.apply(vt&&vt[0]||n,vt):st}function mt(st,vt){return st===n?vt:st}function Et(st,vt,jt){I(Rt(vt),function(pe){st.addEventListener(pe,jt,!1)})}function bt(st,vt,jt){I(Rt(vt),function(pe){st.removeEventListener(pe,jt,!1)})}function pt(st,vt){for(;st;){if(st==vt)return!0;st=st.parentNode}return!1}function zt(st,vt){return st.indexOf(vt)>-1}function Rt(st){return st.trim().split(/\s+/g)}function at(st,vt,jt){if(st.indexOf&&!jt)return st.indexOf(vt);for(var pe=0;pe<st.length;){if(jt&&st[pe][jt]==vt||!jt&&st[pe]===vt)return pe;pe++}return-1}function dt(st){return Array.prototype.slice.call(st,0)}function kt(st,vt,jt){for(var pe=[],Ee=[],yr=0;yr<st.length;){var Br=vt?st[yr][vt]:st[yr];at(Ee,Br)<0&&pe.push(st[yr]),Ee[yr]=Br,yr++}return jt&&(vt?pe=pe.sort(function(mi,Sn){return mi[vt]>Sn[vt]}):pe=pe.sort()),pe}function xt(st,vt){for(var jt,pe,Ee=vt[0].toUpperCase()+vt.slice(1),yr=0;yr<s.length;){if(jt=s[yr],pe=jt?jt+Ee:vt,pe in st)return pe;yr++}return n}var ue=1;function oe(){return ue++}function he(st){var vt=st.ownerDocument||st;return vt.defaultView||vt.parentWindow||t}var Dt=/mobile|tablet|ip(ad|hone|od)|android/i,Qt="ontouchstart"in t,ee=xt(t,"PointerEvent")!==n,xe=Qt&&Dt.test(navigator.userAgent),it="touch",Tt="pen",Lt="mouse",Ut="kinect",Zt=25,Kt=1,ne=2,re=4,Se=8,Be=1,ze=2,Ve=4,Xe=8,ge=16,Bt=ze|Ve,Xt=Xe|ge,ir=Bt|Xt,Ie=["x","y"],ve=["clientX","clientY"];function Ce(st,vt){var jt=this;this.manager=st,this.callback=vt,this.element=st.element,this.target=st.options.inputTarget,this.domHandler=function(pe){nt(st.options.enable,[st])&&jt.handler(pe)},this.init()}Ce.prototype={handler:function(){},init:function(){this.evEl&&Et(this.element,this.evEl,this.domHandler),this.evTarget&&Et(this.target,this.evTarget,this.domHandler),this.evWin&&Et(he(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&bt(this.element,this.evEl,this.domHandler),this.evTarget&&bt(this.target,this.evTarget,this.domHandler),this.evWin&&bt(he(this.element),this.evWin,this.domHandler)}};function qe(st){var vt,jt=st.options.inputClass;return jt?vt=jt:ee?vt=Y:xe?vt=Jt:Qt?vt=He:vt=Fr,new vt(st,lr)}function lr(st,vt,jt){var pe=jt.pointers.length,Ee=jt.changedPointers.length,yr=vt&Kt&&pe-Ee===0,Br=vt&(re|Se)&&pe-Ee===0;jt.isFirst=!!yr,jt.isFinal=!!Br,yr&&(st.session={}),jt.eventType=vt,Er(st,jt),st.emit("hammer.input",jt),st.recognize(jt),st.session.prevInput=jt}function Er(st,vt){var jt=st.session,pe=vt.pointers,Ee=pe.length;jt.firstInput||(jt.firstInput=Wr(vt)),Ee>1&&!jt.firstMultiple?jt.firstMultiple=Wr(vt):Ee===1&&(jt.firstMultiple=!1);var yr=jt.firstInput,Br=jt.firstMultiple,mi=Br?Br.center:yr.center,Sn=vt.center=Jr(pe);vt.timeStamp=w(),vt.deltaTime=vt.timeStamp-yr.timeStamp,vt.angle=Hi(mi,Sn),vt.distance=Re(mi,Sn),Ir(jt,vt),vt.offsetDirection=Tr(vt.deltaX,vt.deltaY);var un=de(vt.deltaTime,vt.deltaX,vt.deltaY);vt.overallVelocityX=un.x,vt.overallVelocityY=un.y,vt.overallVelocity=m(un.x)>m(un.y)?un.x:un.y,vt.scale=Br?Pe(Br.pointers,pe):1,vt.rotation=Br?Pr(Br.pointers,pe):0,vt.maxPointers=jt.prevInput?vt.pointers.length>jt.prevInput.maxPointers?vt.pointers.length:jt.prevInput.maxPointers:vt.pointers.length,Mr(jt,vt);var Ti=st.element;pt(vt.srcEvent.target,Ti)&&(Ti=vt.srcEvent.target),vt.target=Ti}function Ir(st,vt){var jt=vt.center,pe=st.offsetDelta||{},Ee=st.prevDelta||{},yr=st.prevInput||{};(vt.eventType===Kt||yr.eventType===re)&&(Ee=st.prevDelta={x:yr.deltaX||0,y:yr.deltaY||0},pe=st.offsetDelta={x:jt.x,y:jt.y}),vt.deltaX=Ee.x+(jt.x-pe.x),vt.deltaY=Ee.y+(jt.y-pe.y)}function Mr(st,vt){var jt=st.lastInterval||vt,pe=vt.timeStamp-jt.timeStamp,Ee,yr,Br,mi;if(vt.eventType!=Se&&(pe>Zt||jt.velocity===n)){var Sn=vt.deltaX-jt.deltaX,un=vt.deltaY-jt.deltaY,Ti=de(pe,Sn,un);yr=Ti.x,Br=Ti.y,Ee=m(Ti.x)>m(Ti.y)?Ti.x:Ti.y,mi=Tr(Sn,un),st.lastInterval=vt}else Ee=jt.velocity,yr=jt.velocityX,Br=jt.velocityY,mi=jt.direction;vt.velocity=Ee,vt.velocityX=yr,vt.velocityY=Br,vt.direction=mi}function Wr(st){for(var vt=[],jt=0;jt<st.pointers.length;)vt[jt]={clientX:f(st.pointers[jt].clientX),clientY:f(st.pointers[jt].clientY)},jt++;return{timeStamp:w(),pointers:vt,center:Jr(vt),deltaX:st.deltaX,deltaY:st.deltaY}}function Jr(st){var vt=st.length;if(vt===1)return{x:f(st[0].clientX),y:f(st[0].clientY)};for(var jt=0,pe=0,Ee=0;Ee<vt;)jt+=st[Ee].clientX,pe+=st[Ee].clientY,Ee++;return{x:f(jt/vt),y:f(pe/vt)}}function de(st,vt,jt){return{x:vt/st||0,y:jt/st||0}}function Tr(st,vt){return st===vt?Be:m(st)>=m(vt)?st<0?ze:Ve:vt<0?Xe:ge}function Re(st,vt,jt){jt||(jt=Ie);var pe=vt[jt[0]]-st[jt[0]],Ee=vt[jt[1]]-st[jt[1]];return Math.sqrt(pe*pe+Ee*Ee)}function Hi(st,vt,jt){jt||(jt=Ie);var pe=vt[jt[0]]-st[jt[0]],Ee=vt[jt[1]]-st[jt[1]];return Math.atan2(Ee,pe)*180/Math.PI}function Pr(st,vt){return Hi(vt[1],vt[0],ve)+Hi(st[1],st[0],ve)}function Pe(st,vt){return Re(vt[0],vt[1],ve)/Re(st[0],st[1],ve)}var Ye={mousedown:Kt,mousemove:ne,mouseup:re},tr="mousedown",fi="mousemove mouseup";function Fr(){this.evEl=tr,this.evWin=fi,this.pressed=!1,Ce.apply(this,arguments)}z(Fr,Ce,{handler:function(st){var vt=Ye[st.type];vt&Kt&&st.button===0&&(this.pressed=!0),vt&ne&&st.which!==1&&(vt=re),this.pressed&&(vt&re&&(this.pressed=!1),this.callback(this.manager,vt,{pointers:[st],changedPointers:[st],pointerType:Lt,srcEvent:st}))}});var wr={pointerdown:Kt,pointermove:ne,pointerup:re,pointercancel:Se,pointerout:Se},bi={2:it,3:Tt,4:Lt,5:Ut},ai="pointerdown",At="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(ai="MSPointerDown",At="MSPointerMove MSPointerUp MSPointerCancel");function Y(){this.evEl=ai,this.evWin=At,Ce.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}z(Y,Ce,{handler:function(st){var vt=this.store,jt=!1,pe=st.type.toLowerCase().replace("ms",""),Ee=wr[pe],yr=bi[st.pointerType]||st.pointerType,Br=yr==it,mi=at(vt,st.pointerId,"pointerId");Ee&Kt&&(st.button===0||Br)?mi<0&&(vt.push(st),mi=vt.length-1):Ee&(re|Se)&&(jt=!0),!(mi<0)&&(vt[mi]=st,this.callback(this.manager,Ee,{pointers:vt,changedPointers:[st],pointerType:yr,srcEvent:st}),jt&&vt.splice(mi,1))}});var Q={touchstart:Kt,touchmove:ne,touchend:re,touchcancel:Se},ot="touchstart",wt="touchstart touchmove touchend touchcancel";function Nt(){this.evTarget=ot,this.evWin=wt,this.started=!1,Ce.apply(this,arguments)}z(Nt,Ce,{handler:function(st){var vt=Q[st.type];if(vt===Kt&&(this.started=!0),!!this.started){var jt=Gt.call(this,st,vt);vt&(re|Se)&&jt[0].length-jt[1].length===0&&(this.started=!1),this.callback(this.manager,vt,{pointers:jt[0],changedPointers:jt[1],pointerType:it,srcEvent:st})}}});function Gt(st,vt){var jt=dt(st.touches),pe=dt(st.changedTouches);return vt&(re|Se)&&(jt=kt(jt.concat(pe),"identifier",!0)),[jt,pe]}var Ht={touchstart:Kt,touchmove:ne,touchend:re,touchcancel:Se},Ct="touchstart touchmove touchend touchcancel";function Jt(){this.evTarget=Ct,this.targetIds={},Ce.apply(this,arguments)}z(Jt,Ce,{handler:function(st){var vt=Ht[st.type],jt=ye.call(this,st,vt);jt&&this.callback(this.manager,vt,{pointers:jt[0],changedPointers:jt[1],pointerType:it,srcEvent:st})}});function ye(st,vt){var jt=dt(st.touches),pe=this.targetIds;if(vt&(Kt|ne)&&jt.length===1)return pe[jt[0].identifier]=!0,[jt,jt];var Ee,yr,Br=dt(st.changedTouches),mi=[],Sn=this.target;if(yr=jt.filter(function(un){return pt(un.target,Sn)}),vt===Kt)for(Ee=0;Ee<yr.length;)pe[yr[Ee].identifier]=!0,Ee++;for(Ee=0;Ee<Br.length;)pe[Br[Ee].identifier]&&mi.push(Br[Ee]),vt&(re|Se)&&delete pe[Br[Ee].identifier],Ee++;if(mi.length)return[kt(yr.concat(mi),"identifier",!0),mi]}var fe=2500,ce=25;function He(){Ce.apply(this,arguments);var st=J(this.handler,this);this.touch=new Jt(this.manager,st),this.mouse=new Fr(this.manager,st),this.primaryTouch=null,this.lastTouches=[]}z(He,Ce,{handler:function(st,vt,jt){var pe=jt.pointerType==it,Ee=jt.pointerType==Lt;if(!(Ee&&jt.sourceCapabilities&&jt.sourceCapabilities.firesTouchEvents)){if(pe)Ze.call(this,vt,jt);else if(Ee&&sr.call(this,jt))return;this.callback(st,vt,jt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Ze(st,vt){st&Kt?(this.primaryTouch=vt.changedPointers[0].identifier,xr.call(this,vt)):st&(re|Se)&&xr.call(this,vt)}function xr(st){var vt=st.changedPointers[0];if(vt.identifier===this.primaryTouch){var jt={x:vt.clientX,y:vt.clientY};this.lastTouches.push(jt);var pe=this.lastTouches,Ee=function(){var yr=pe.indexOf(jt);yr>-1&&pe.splice(yr,1)};setTimeout(Ee,fe)}}function sr(st){for(var vt=st.srcEvent.clientX,jt=st.srcEvent.clientY,pe=0;pe<this.lastTouches.length;pe++){var Ee=this.lastTouches[pe],yr=Math.abs(vt-Ee.x),Br=Math.abs(jt-Ee.y);if(yr<=ce&&Br<=ce)return!0}return!1}var Cr=xt(a.style,"touchAction"),zr=Cr!==n,$r="compute",li="auto",ur="manipulation",Gr="none",pi="pan-x",Ri="pan-y",Wi=Nl();function Ii(st,vt){this.manager=st,this.set(vt)}Ii.prototype={set:function(st){st==$r&&(st=this.compute()),zr&&this.manager.element.style&&Wi[st]&&(this.manager.element.style[Cr]=st),this.actions=st.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var st=[];return I(this.manager.recognizers,function(vt){nt(vt.options.enable,[vt])&&(st=st.concat(vt.getTouchAction()))}),Zn(st.join(" "))},preventDefaults:function(st){var vt=st.srcEvent,jt=st.offsetDirection;if(this.manager.session.prevented){vt.preventDefault();return}var pe=this.actions,Ee=zt(pe,Gr)&&!Wi[Gr],yr=zt(pe,Ri)&&!Wi[Ri],Br=zt(pe,pi)&&!Wi[pi];if(Ee){var mi=st.pointers.length===1,Sn=st.distance<2,un=st.deltaTime<250;if(mi&&Sn&&un)return}if(!(Br&&yr)&&(Ee||yr&&jt&Bt||Br&&jt&Xt))return this.preventSrc(vt)},preventSrc:function(st){this.manager.session.prevented=!0,st.preventDefault()}};function Zn(st){if(zt(st,Gr))return Gr;var vt=zt(st,pi),jt=zt(st,Ri);return vt&&jt?Gr:vt||jt?vt?pi:Ri:zt(st,ur)?ur:li}function Nl(){if(!zr)return!1;var st={},vt=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(jt){st[jt]=vt?t.CSS.supports("touch-action",jt):!0}),st}var Qa=1,Rr=2,ds=4,fs=8,Ni=fs,$i=16,On=32;function Fi(st){this.options=F({},this.defaults,st||{}),this.id=oe(),this.manager=null,this.options.enable=mt(this.options.enable,!0),this.state=Qa,this.simultaneous={},this.requireFail=[]}Fi.prototype={defaults:{},set:function(st){return F(this.options,st),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(st){if(P(st,"recognizeWith",this))return this;var vt=this.simultaneous;return st=To(st,this),vt[st.id]||(vt[st.id]=st,st.recognizeWith(this)),this},dropRecognizeWith:function(st){return P(st,"dropRecognizeWith",this)?this:(st=To(st,this),delete this.simultaneous[st.id],this)},requireFailure:function(st){if(P(st,"requireFailure",this))return this;var vt=this.requireFail;return st=To(st,this),at(vt,st)===-1&&(vt.push(st),st.requireFailure(this)),this},dropRequireFailure:function(st){if(P(st,"dropRequireFailure",this))return this;st=To(st,this);var vt=at(this.requireFail,st);return vt>-1&&this.requireFail.splice(vt,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(st){return!!this.simultaneous[st.id]},emit:function(st){var vt=this,jt=this.state;function pe(Ee){vt.manager.emit(Ee,st)}jt<fs&&pe(vt.options.event+Jn(jt)),pe(vt.options.event),st.additionalEvent&&pe(st.additionalEvent),jt>=fs&&pe(vt.options.event+Jn(jt))},tryEmit:function(st){if(this.canEmit())return this.emit(st);this.state=On},canEmit:function(){for(var st=0;st<this.requireFail.length;){if(!(this.requireFail[st].state&(On|Qa)))return!1;st++}return!0},recognize:function(st){var vt=F({},st);if(!nt(this.options.enable,[this,vt])){this.reset(),this.state=On;return}this.state&(Ni|$i|On)&&(this.state=Qa),this.state=this.process(vt),this.state&(Rr|ds|fs|$i)&&this.tryEmit(vt)},process:function(st){},getTouchAction:function(){},reset:function(){}};function Jn(st){return st&$i?"cancel":st&fs?"end":st&ds?"move":st&Rr?"start":""}function xs(st){return st==ge?"down":st==Xe?"up":st==ze?"left":st==Ve?"right":""}function To(st,vt){var jt=vt.manager;return jt?jt.get(st):st}function Sr(){Fi.apply(this,arguments)}z(Sr,Fi,{defaults:{pointers:1},attrTest:function(st){var vt=this.options.pointers;return vt===0||st.pointers.length===vt},process:function(st){var vt=this.state,jt=st.eventType,pe=vt&(Rr|ds),Ee=this.attrTest(st);return pe&&(jt&Se||!Ee)?vt|$i:pe||Ee?jt&re?vt|fs:vt&Rr?vt|ds:Rr:On}});function js(){Sr.apply(this,arguments),this.pX=null,this.pY=null}z(js,Sr,{defaults:{event:"pan",threshold:10,pointers:1,direction:ir},getTouchAction:function(){var st=this.options.direction,vt=[];return st&Bt&&vt.push(Ri),st&Xt&&vt.push(pi),vt},directionTest:function(st){var vt=this.options,jt=!0,pe=st.distance,Ee=st.direction,yr=st.deltaX,Br=st.deltaY;return Ee&vt.direction||(vt.direction&Bt?(Ee=yr===0?Be:yr<0?ze:Ve,jt=yr!=this.pX,pe=Math.abs(st.deltaX)):(Ee=Br===0?Be:Br<0?Xe:ge,jt=Br!=this.pY,pe=Math.abs(st.deltaY))),st.direction=Ee,jt&&pe>vt.threshold&&Ee&vt.direction},attrTest:function(st){return Sr.prototype.attrTest.call(this,st)&&(this.state&Rr||!(this.state&Rr)&&this.directionTest(st))},emit:function(st){this.pX=st.deltaX,this.pY=st.deltaY;var vt=xs(st.direction);vt&&(st.additionalEvent=this.options.event+vt),this._super.emit.call(this,st)}});function ps(){Sr.apply(this,arguments)}z(ps,Sr,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Gr]},attrTest:function(st){return this._super.attrTest.call(this,st)&&(Math.abs(st.scale-1)>this.options.threshold||this.state&Rr)},emit:function(st){if(st.scale!==1){var vt=st.scale<1?"in":"out";st.additionalEvent=this.options.event+vt}this._super.emit.call(this,st)}});function gi(){Fi.apply(this,arguments),this._timer=null,this._input=null}z(gi,Fi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[li]},process:function(st){var vt=this.options,jt=st.pointers.length===vt.pointers,pe=st.distance<vt.threshold,Ee=st.deltaTime>vt.time;if(this._input=st,!pe||!jt||st.eventType&(re|Se)&&!Ee)this.reset();else if(st.eventType&Kt)this.reset(),this._timer=A(function(){this.state=Ni,this.tryEmit()},vt.time,this);else if(st.eventType&re)return Ni;return On},reset:function(){clearTimeout(this._timer)},emit:function(st){this.state===Ni&&(st&&st.eventType&re?this.manager.emit(this.options.event+"up",st):(this._input.timeStamp=w(),this.manager.emit(this.options.event,this._input)))}});function eo(){Sr.apply(this,arguments)}z(eo,Sr,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Gr]},attrTest:function(st){return this._super.attrTest.call(this,st)&&(Math.abs(st.rotation)>this.options.threshold||this.state&Rr)}});function xn(){Sr.apply(this,arguments)}z(xn,Sr,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Bt|Xt,pointers:1},getTouchAction:function(){return js.prototype.getTouchAction.call(this)},attrTest:function(st){var vt=this.options.direction,jt;return vt&(Bt|Xt)?jt=st.overallVelocity:vt&Bt?jt=st.overallVelocityX:vt&Xt&&(jt=st.overallVelocityY),this._super.attrTest.call(this,st)&&vt&st.offsetDirection&&st.distance>this.options.threshold&&st.maxPointers==this.options.pointers&&m(jt)>this.options.velocity&&st.eventType&re},emit:function(st){var vt=xs(st.offsetDirection);vt&&this.manager.emit(this.options.event+vt,st),this.manager.emit(this.options.event,st)}});function An(){Fi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}z(An,Fi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ur]},process:function(st){var vt=this.options,jt=st.pointers.length===vt.pointers,pe=st.distance<vt.threshold,Ee=st.deltaTime<vt.time;if(this.reset(),st.eventType&Kt&&this.count===0)return this.failTimeout();if(pe&&Ee&&jt){if(st.eventType!=re)return this.failTimeout();var yr=this.pTime?st.timeStamp-this.pTime<vt.interval:!0,Br=!this.pCenter||Re(this.pCenter,st.center)<vt.posThreshold;this.pTime=st.timeStamp,this.pCenter=st.center,!Br||!yr?this.count=1:this.count+=1,this._input=st;var mi=this.count%vt.taps;if(mi===0)return this.hasRequireFailures()?(this._timer=A(function(){this.state=Ni,this.tryEmit()},vt.interval,this),Rr):Ni}return On},failTimeout:function(){return this._timer=A(function(){this.state=On},this.options.interval,this),On},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ni&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function zi(st,vt){return vt=vt||{},vt.recognizers=mt(vt.recognizers,zi.defaults.preset),new Po(st,vt)}zi.VERSION="2.0.7",zi.defaults={domEvents:!1,touchAction:$r,enable:!0,inputTarget:null,inputClass:null,preset:[[eo,{enable:!1}],[ps,{enable:!1},["rotate"]],[xn,{direction:Bt}],[js,{direction:Bt},["swipe"]],[An],[An,{event:"doubletap",taps:2},["tap"]],[gi]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var vn=1,Xr=2;function Po(st,vt){this.options=F({},zi.defaults,vt||{}),this.options.inputTarget=this.options.inputTarget||st,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=st,this.input=qe(this),this.touchAction=new Ii(this,this.options.touchAction),Io(this,!0),I(this.options.recognizers,function(jt){var pe=this.add(new jt[0](jt[1]));jt[2]&&pe.recognizeWith(jt[2]),jt[3]&&pe.requireFailure(jt[3])},this)}Po.prototype={set:function(st){return F(this.options,st),st.touchAction&&this.touchAction.update(),st.inputTarget&&(this.input.destroy(),this.input.target=st.inputTarget,this.input.init()),this},stop:function(st){this.session.stopped=st?Xr:vn},recognize:function(st){var vt=this.session;if(!vt.stopped){this.touchAction.preventDefaults(st);var jt,pe=this.recognizers,Ee=vt.curRecognizer;(!Ee||Ee&&Ee.state&Ni)&&(Ee=vt.curRecognizer=null);for(var yr=0;yr<pe.length;)jt=pe[yr],vt.stopped!==Xr&&(!Ee||jt==Ee||jt.canRecognizeWith(Ee))?jt.recognize(st):jt.reset(),!Ee&&jt.state&(Rr|ds|fs)&&(Ee=vt.curRecognizer=jt),yr++}},get:function(st){if(st instanceof Fi)return st;for(var vt=this.recognizers,jt=0;jt<vt.length;jt++)if(vt[jt].options.event==st)return vt[jt];return null},add:function(st){if(P(st,"add",this))return this;var vt=this.get(st.options.event);return vt&&this.remove(vt),this.recognizers.push(st),st.manager=this,this.touchAction.update(),st},remove:function(st){if(P(st,"remove",this))return this;if(st=this.get(st),st){var vt=this.recognizers,jt=at(vt,st);jt!==-1&&(vt.splice(jt,1),this.touchAction.update())}return this},on:function(st,vt){if(st!==n&&vt!==n){var jt=this.handlers;return I(Rt(st),function(pe){jt[pe]=jt[pe]||[],jt[pe].push(vt)}),this}},off:function(st,vt){if(st!==n){var jt=this.handlers;return I(Rt(st),function(pe){vt?jt[pe]&&jt[pe].splice(at(jt[pe],vt),1):delete jt[pe]}),this}},emit:function(st,vt){this.options.domEvents&&Us(st,vt);var jt=this.handlers[st]&&this.handlers[st].slice();if(!(!jt||!jt.length)){vt.type=st,vt.preventDefault=function(){vt.srcEvent.preventDefault()};for(var pe=0;pe<jt.length;)jt[pe](vt),pe++}},destroy:function(){this.element&&Io(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Io(st,vt){var jt=st.element;if(jt.style){var pe;I(st.options.cssProps,function(Ee,yr){pe=xt(jt.style,yr),vt?(st.oldCssProps[pe]=jt.style[pe],jt.style[pe]=Ee):jt.style[pe]=st.oldCssProps[pe]||""}),vt||(st.oldCssProps={})}}function Us(st,vt){var jt=r.createEvent("Event");jt.initEvent(st,!0,!0),jt.gesture=vt,vt.target.dispatchEvent(jt)}F(zi,{INPUT_START:Kt,INPUT_MOVE:ne,INPUT_END:re,INPUT_CANCEL:Se,STATE_POSSIBLE:Qa,STATE_BEGAN:Rr,STATE_CHANGED:ds,STATE_ENDED:fs,STATE_RECOGNIZED:Ni,STATE_CANCELLED:$i,STATE_FAILED:On,DIRECTION_NONE:Be,DIRECTION_LEFT:ze,DIRECTION_RIGHT:Ve,DIRECTION_UP:Xe,DIRECTION_DOWN:ge,DIRECTION_HORIZONTAL:Bt,DIRECTION_VERTICAL:Xt,DIRECTION_ALL:ir,Manager:Po,Input:Ce,TouchAction:Ii,TouchInput:Jt,MouseInput:Fr,PointerEventInput:Y,TouchMouseInput:He,SingleTouchInput:Nt,Recognizer:Fi,AttrRecognizer:Sr,Tap:An,Pan:js,Swipe:xn,Pinch:ps,Rotate:eo,Press:gi,on:Et,off:bt,each:I,merge:U,extend:Z,assign:F,inherit:z,bindFn:J,prefixed:xt});var tl=typeof t<"u"?t:typeof self<"u"?self:{};tl.Hammer=zi,typeof n=="function"&&n.amd?n(function(){return zi}):e.exports?e.exports=zi:t[i]=zi})(window,document,"Hammer")})(u6);var N0=u6.exports;const zW=K_(N0),eu=TN({__proto__:null,default:zW},[N0]),h6=1,d6=2,mx=4,jW={mousedown:h6,mousemove:d6,mouseup:mx};function UW(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return!0;return!1}function GW(e){const t=e.prototype.handler;e.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(UW(i,n=>n.pointerId===r.pointerId)||i.push(r)),t.call(this,r)}}function VW(e){e.prototype.handler=function(t){let r=jW[t.type];r&h6&&t.button>=0&&(this.pressed=!0),r&d6&&t.which===0&&(r=mx),this.pressed&&(r&mx&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}GW(N0.PointerEventInput);VW(N0.MouseInput);const qW=N0.Manager;class ov{constructor(t,r,i){this.element=t,this.callback=r,this.options={enable:!0,...i}}}const HW=eu?[[eu.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[eu.Rotate,{enable:!1}],[eu.Pinch,{enable:!1}],[eu.Swipe,{enable:!1}],[eu.Pan,{threshold:0,enable:!1}],[eu.Press,{enable:!1}],[eu.Tap,{event:"doubletap",taps:2,enable:!1}],[eu.Tap,{event:"anytap",enable:!1}],[eu.Tap,{enable:!1}]]:null,UT={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},WW={doubletap:["tap"]},$W={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},UA={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},ZW={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},GT={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},JW=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Lp=typeof window<"u"?window:global;let yx=!1;try{const e={get passive(){return yx=!0,!0}};Lp.addEventListener("test",null,e),Lp.removeEventListener("test",null)}catch{yx=!1}const XW=JW.indexOf("firefox")!==-1,{WHEEL_EVENTS:KW}=UA,VT="wheel",qT=4.000244140625,YW=40,QW=.25;class t$ extends ov{constructor(t,r,i){super(t,r,i),this.handleEvent=n=>{if(!this.options.enable)return;let s=n.deltaY;Lp.WheelEvent&&(XW&&n.deltaMode===Lp.WheelEvent.DOM_DELTA_PIXEL&&(s/=Lp.devicePixelRatio),n.deltaMode===Lp.WheelEvent.DOM_DELTA_LINE&&(s*=YW)),s!==0&&s%qT===0&&(s=Math.floor(s/qT)),n.shiftKey&&s&&(s=s*QW),this.callback({type:VT,center:{x:n.clientX,y:n.clientY},delta:-s,srcEvent:n,pointerType:"mouse",target:n.target})},this.events=(this.options.events||[]).concat(KW),this.events.forEach(n=>t.addEventListener(n,this.handleEvent,yx?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t===VT&&(this.options.enable=r)}}const{MOUSE_EVENTS:e$}=UA,HT="pointermove",WT="pointerover",$T="pointerout",ZT="pointerenter",JT="pointerleave";class r$ extends ov{constructor(t,r,i){super(t,r,i),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,this.events=(this.options.events||[]).concat(e$),this.events.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t===HT&&(this.enableMoveEvent=r),t===WT&&(this.enableOverEvent=r),t===$T&&(this.enableOutEvent=r),t===ZT&&(this.enableEnterEvent=r),t===JT&&(this.enableLeaveEvent=r)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(WT,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit($T,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(ZT,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(JT,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.which===0&&(this.pressed=!1),this.pressed||this._emit(HT,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,r){this.callback({type:t,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}}const{KEY_EVENTS:i$}=UA,XT="keydown",KT="keyup";class n$ extends ov{constructor(t,r,i){super(t,r,i),this.handleEvent=n=>{const s=n.target||n.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:XT,srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:KT,srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(i$),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(n=>t.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t===XT&&(this.enableDownEvent=r),t===KT&&(this.enableUpEvent=r)}}const YT="contextmenu";class s$ extends ov{constructor(t,r,i){super(t,r,i),this.handleEvent=n=>{this.options.enable&&this.callback({type:YT,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,r){t===YT&&(this.options.enable=r)}}const _x=1,T_=2,vx=4,o$={pointerdown:_x,pointermove:T_,pointerup:vx,mousedown:_x,mousemove:T_,mouseup:vx},a$=1,l$=2,c$=3,u$=0,h$=1,d$=2,f$=1,p$=2,g$=4;function m$(e){const t=o$[e.srcEvent.type];if(!t)return null;const{buttons:r,button:i,which:n}=e.srcEvent;let s=!1,a=!1,o=!1;return t===vx||t===T_&&!Number.isFinite(r)?(s=n===a$,a=n===l$,o=n===c$):t===T_?(s=!!(r&f$),a=!!(r&g$),o=!!(r&p$)):t===_x&&(s=i===u$,a=i===h$,o=i===d$),{leftButton:s,middleButton:a,rightButton:o}}function y$(e,t){const r=e.center;if(!r)return null;const i=t.getBoundingClientRect(),n=i.width/t.offsetWidth||1,s=i.height/t.offsetHeight||1,a={x:(r.x-i.left-t.clientLeft)/n,y:(r.y-i.top-t.clientTop)/s};return{center:r,offsetCenter:a}}const h2={srcElement:"root",priority:0};class _${constructor(t){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let n=r.srcEvent.target;for(;n&&n!==i.rootElement;){if(this._emit(i,n),i.handled)return;n=n.parentNode}this._emit(i,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,r,i){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:a,handlersByElement:o}=this;let f=h2;typeof i=="string"||i&&i.addEventListener?f={...h2,srcElement:i}:i&&(f={...h2,...i});let m=o.get(f.srcElement);m||(m=[],o.set(f.srcElement,m));const w={type:t,handler:r,srcElement:f.srcElement,priority:f.priority};n&&(w.once=!0),s&&(w.passive=!0),a.push(w),this._active=this._active||!w.passive;let A=m.length-1;for(;A>=0&&!(m[A].priority>=w.priority);)A--;m.splice(A+1,0,w)}remove(t,r){const{handlers:i,handlersByElement:n}=this;for(let s=i.length-1;s>=0;s--){const a=i[s];if(a.type===t&&a.handler===r){i.splice(s,1);const o=n.get(a.srcElement);o.splice(o.indexOf(a),1),o.length===0&&n.delete(a.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(t,r){const i=this.handlersByElement.get(r);if(i){let n=!1;const s=()=>{t.handled=!0},a=()=>{t.handled=!0,n=!0},o=[];for(let f=0;f<i.length;f++){const{type:m,handler:w,once:A}=i[f];if(w({...t,type:m,stopPropagation:s,stopImmediatePropagation:a}),A&&o.push(i[f]),n)break}for(let f=0;f<o.length;f++){const{type:m,handler:w}=o[f];this.remove(m,w)}}}_normalizeEvent(t){const r=this.eventManager.getElement();return{...t,...m$(t),...y$(t,r),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}}const v$={events:null,recognizers:null,recognizerOptions:{},Manager:qW,touchAction:"none",tabIndex:0};class b${constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1?arguments[1]:void 0;this._onBasicInput=n=>{const{srcEvent:s}=n,a=$W[s.type];a&&this.manager.emit(a,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={...v$,...r},this.events=new Map,this.setElement(t);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:r}=this,i=r.Manager;this.manager=new i(t,{touchAction:r.touchAction,recognizers:r.recognizers||HW}).on("hammer.input",this._onBasicInput),r.recognizers||Object.keys(UT).forEach(n=>{const s=this.manager.get(n);s&&UT[n].forEach(a=>{s.recognizeWith(a)})});for(const n in r.recognizerOptions){const s=this.manager.get(n);if(s){const a=r.recognizerOptions[n];delete a.enable,s.set(a)}}this.wheelInput=new t$(t,this._onOtherEvent,{enable:!1}),this.moveInput=new r$(t,this._onOtherEvent,{enable:!1}),this.keyInput=new n$(t,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new s$(t,this._onOtherEvent,{enable:!1});for(const[n,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(n,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,r,i){this._addEventHandler(t,r,i,!1)}once(t,r,i){this._addEventHandler(t,r,i,!0)}watch(t,r,i){this._addEventHandler(t,r,i,!1,!0)}off(t,r){this._removeEventHandler(t,r)}_toggleRecognizer(t,r){const{manager:i}=this;if(!i)return;const n=i.get(t);if(n&&n.options.enable!==r){n.set({enable:r});const s=WW[t];s&&!this.options.recognizers&&s.forEach(a=>{const o=i.get(a);r?(o.requireFailure(t),n.dropRequireFailure(a)):o.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,r),this.moveInput.enableEventType(t,r),this.keyInput.enableEventType(t,r),this.contextmenuInput.enableEventType(t,r)}_addEventHandler(t,r,i,n,s){if(typeof t!="string"){i=r;for(const w in t)this._addEventHandler(w,t[w],i,n,s);return}const{manager:a,events:o}=this,f=GT[t]||t;let m=o.get(f);m||(m=new _$(this),o.set(f,m),m.recognizerName=ZW[f]||f,a&&a.on(f,m.handleEvent)),m.add(t,r,i,n,s),m.isEmpty()||this._toggleRecognizer(m.recognizerName,!0)}_removeEventHandler(t,r){if(typeof t!="string"){for(const a in t)this._removeEventHandler(a,t[a]);return}const{events:i}=this,n=GT[t]||t,s=i.get(n);if(s&&(s.remove(t,r),s.isEmpty())){const{recognizerName:a}=s;let o=!1;for(const f of i.values())if(f.recognizerName===a&&!f.isEmpty()){o=!0;break}o||this._toggleRecognizer(a,!1)}}}function Xd(){}const w$=e=>{let{isDragging:t}=e;return t?"grabbing":"grab"},f6={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Xd,onResize:Xd,onViewStateChange:Xd,onInteractionStateChange:Xd,onBeforeRender:Xd,onAfterRender:Xd,onLoad:Xd,onError:e=>xi.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:w$,getTooltip:null,debug:!1,drawPickingColors:!1};class GA{constructor(t){$(this,"props",void 0),$(this,"width",0),$(this,"height",0),$(this,"userData",{}),$(this,"canvas",null),$(this,"viewManager",null),$(this,"layerManager",null),$(this,"effectManager",null),$(this,"deckRenderer",null),$(this,"deckPicker",null),$(this,"eventManager",null),$(this,"tooltip",null),$(this,"metrics",void 0),$(this,"animationLoop",void 0),$(this,"stats",void 0),$(this,"viewState",void 0),$(this,"cursorState",void 0),$(this,"_needsRedraw",void 0),$(this,"_pickRequest",void 0),$(this,"_lastPointerDownInfo",null),$(this,"_metricsCounter",void 0),$(this,"_onPointerMove",r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const n=r.offsetCenter;if(!n)return;i.x=n.x,i.y=n.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r}),$(this,"_onEvent",r=>{const i=LC[r.type],n=r.offsetCenter;if(!i||!n||!this.layerManager)return;const s=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:s,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:o}=a,f=o&&(o[i.handler]||o.props[i.handler]),m=this.props[i.handler];let w=!1;f&&(w=f.call(o,a,r)),!w&&m&&m(a,r)}),$(this,"_onPointerDown",r=>{const i=r.offsetCenter,n=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=n.result[0]||n.emptyInfo}),this.props={...f6,...t},t=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},t.viewState&&t.initialViewState&&xi.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),KL()==="IE"&&xi.warn("IE 11 is not supported")(),this.viewState=t.initialViewState,t.gl||typeof document<"u"&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new gA({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&p0.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,r,i,n,s,a,o,f;if((t=this.animationLoop)===null||t===void 0||t.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)===null||r===void 0||r.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(n=this.effectManager)===null||n===void 0||n.finalize(),this.effectManager=null,(s=this.deckRenderer)===null||s===void 0||s.finalize(),this.deckRenderer=null,(a=this.deckPicker)===null||a===void 0||a.finalize(),this.deckPicker=null,(o=this.eventManager)===null||o===void 0||o.destroy(),this.eventManager=null,(f=this.tooltip)===null||f===void 0||f.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var m;(m=this.canvas.parentElement)===null||m===void 0||m.removeChild(this.canvas),this.canvas=null}}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&xi.removed("onLayerHover","onHover")(),"onLayerClick"in t&&xi.removed("onLayerClick","onClick")(),t.initialViewState&&!uu(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(t),n=this.layerManager.needsRedraw(t),s=this.effectManager.needsRedraw(t),a=this.deckRenderer.needsRedraw(t);return r=r||i||n||s||a,r}redraw(t){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=t||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return Ys(this.viewManager),this.viewManager.views}getViewports(t){return Ys(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const r=this._pick("pickObject","pickObject Time",t).result;return r.length?r[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const i in t)this.layerManager.resourceManager.add({resourceId:i,data:t[i],forceUpdate:r})}_removeResources(t){for(const r of t)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_pick(t,r,i){Ys(this.deckPicker);const{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(r).timeStart();const s=this.deckPicker[t]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return n.get(r).timeEnd(),s}_createCanvas(t){let r=t.canvas;return typeof r=="string"&&(r=document.getElementById(r),Ys(r)),r||(r=document.createElement("canvas"),r.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(r)),Object.assign(r.style,t.style),r}_setCanvasSize(t){if(!this.canvas)return;const{width:r,height:i}=t;if(r||r===0){const s=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.width=s}if(i||i===0){var n;const s=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((n=t.style)===null||n===void 0?void 0:n.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var t,r;const{canvas:i}=this;if(!i)return;const n=(t=i.clientWidth)!==null&&t!==void 0?t:i.width,s=(r=i.clientHeight)!==null&&r!==void 0?r:i.height;if(n!==this.width||s!==this.height){var a,o;this.width=n,this.height=s,(a=this.viewManager)===null||a===void 0||a.setProps({width:n,height:s}),(o=this.layerManager)===null||o===void 0||o.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:s})}}_createAnimationLoop(t){const{width:r,height:i,gl:n,glOptions:s,debug:a,onError:o,onBeforeRender:f,onAfterRender:m,useDevicePixels:w}=t;return new WU({width:r,height:i,useDevicePixels:w,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,gl:n,onCreateContext:A=>nB({...s,...A,canvas:this.canvas,debug:a,onContextLost:()=>this._onContextLost()}),onInitialize:A=>this._setGLContext(A.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:f,onAfterRender:m,onError:o})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new jA({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:i,emptyInfo:n}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=i.length>0;let s=n,a=!1;for(const o of i){var r;s=o,a=((r=o.layer)===null||r===void 0?void 0:r.onHover(o,t.event))||a}if(!a&&this.props.onHover&&this.props.onHover(s,t.event),this.props.getTooltip&&this.tooltip){const o=this.props.getTooltip(s);this.tooltip.setTooltip(o,s.x,s.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,pA(t,{enable:!0,copyState:!0})),this.tooltip=new FW(this.canvas),dh(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const r=new $B;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new b$(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const n in LC)this.eventManager.on(n,this._onEvent);this.viewManager=new uW({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new cW(t,{deck:this,stats:this.stats,viewport:i,timeline:r}),this.effectManager=new TW,this.deckRenderer=new MW(t),this.deckPicker=new DW(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,r){const{gl:i}=this.layerManager.context;dh(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r}),this.props.onAfterRender({gl:i})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),xi.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const r=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const r=this.animationLoop.stats;t.get("GPU Time").addTime(r.get("GPU Time").lastTiming),t.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:r}=this;t.fps=r.get("frameRate").getHz(),t.setPropsTime=r.get("setProps Time").time,t.updateAttributesTime=r.get("Update Attributes").time,t.framesRedrawn=r.get("Redraw Count").count,t.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,t.pickCount=r.get("Pick Count").count,t.gpuTime=r.get("GPU Time").time,t.cpuTime=r.get("CPU Time").time,t.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=r.get("CPU Time").getAverageTime();const i=hf.get("Memory Usage");t.bufferMemory=i.get("Buffer Memory").count,t.textureMemory=i.get("Texture Memory").count,t.renderbufferMemory=i.get("Renderbuffer Memory").count,t.gpuMemory=i.get("GPU Memory").count}}$(GA,"defaultProps",f6);$(GA,"VERSION",Y7);class d2{constructor(t,r){$(this,"opts",void 0),$(this,"source",void 0),this.opts=r,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),r=this.getAccessor();if(t)return[t,r];const{value:i}=this.source,{size:n}=r;let s=i;if(i&&i.length!==n){s=new Float32Array(n);const a=r.elementOffset||0;for(let o=0;o<n;++o)s[o]=i[a+o]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function x$(e){switch(e){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Ey(e){return e.stride||e.size*e.bytesPerElement}function p6(e,t){t.offset&&xi.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const r=Ey(e),i=t.vertexOffset!==void 0?t.vertexOffset:e.vertexOffset||0,n=t.elementOffset||0,s=i*r+n*e.bytesPerElement+(e.offset||0);return{...t,offset:s,stride:r}}function A$(e,t){const r=p6(e,t);return{high:r,low:{...r,offset:r.offset+e.size*4}}}class S${constructor(t,r,i){$(this,"gl",void 0),$(this,"id",void 0),$(this,"size",void 0),$(this,"settings",void 0),$(this,"value",void 0),$(this,"doublePrecision",void 0),$(this,"_buffer",void 0),$(this,"state",void 0),this.gl=t,this.id=r.id||"",this.size=r.size||1;const n=r.logicalType||r.type,s=n===5130;let{defaultValue:a}=r;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let o;s?o=5126:!n&&r.isIndexed?o=t&&_A(t,ln.ELEMENT_INDEX_UINT32)?5125:5123:o=n||5126;let f=x$(n||o||5126);this.doublePrecision=s,s&&r.fp64===!1&&(f=Float32Array),this.value=null,this.settings={...r,defaultType:f,defaultValue:a,logicalType:n,type:o,size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:t,type:r}=this.settings;this._buffer=new Ki(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:r}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*Ey(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),p0.release(this.state.allocatedValue)}getShaderAttributes(t,r){if(this.doublePrecision){const i={},n=this.value instanceof Float64Array,s=A$(this.getAccessor(),r||{});return i[t]=new d2(this,s.high),i["".concat(t,"64Low")]=n?new d2(this,s.low):new Float32Array(this.size),i}if(r){const i=p6(this.getAccessor(),r);return{[t]:new d2(this,i)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const r=Array.from(this.value);t=[r,r]}else{const{value:r,numInstances:i,size:n}=this,s=i*n;if(r&&s&&r.length>=s){const a=new Array(n).fill(1/0),o=new Array(n).fill(-1/0);for(let f=0;f<s;)for(let m=0;m<n;m++){const w=r[f++];w<a[m]&&(a[m]=w),w>o[m]&&(o[m]=w)}t=[a,o]}}return this.state.bounds=t,t}setData(t){const{state:r}=this;let i;ArrayBuffer.isView(t)?i={value:t}:t instanceof Ki?i={buffer:t}:i=t;const n={...this.settings,...i};if(r.bufferAccessor=n,r.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!r.constant||!this._areValuesEqual(s,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=s}else if(i.buffer){const s=i.buffer;r.externalBuffer=s,r.constant=!1,this.value=i.value||null;const a=i.value instanceof Float64Array;n.type=i.type||s.accessor.type,n.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(a?2:1),n.stride=Ey(n)}else if(i.value){this._checkExternalBuffer(i);let s=i.value;r.externalBuffer=null,r.constant=!1,this.value=s,n.bytesPerElement=s.BYTES_PER_ELEMENT,n.stride=Ey(n);const{buffer:a,byteOffset:o}=this;this.doublePrecision&&s instanceof Float64Array&&(s=l2(s,n));const f=s.byteLength+o+n.stride*2;a.byteLength<f&&a.reallocate(f),a.setAccessor(null),a.subData({data:s,offset:o}),n.type=i.type||a.accessor.type}return!0}updateSubBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const r=this.value,{startOffset:i=0,endOffset:n}=t;this.buffer.subData({data:this.doublePrecision&&r instanceof Float64Array?l2(r,{size:this.size,startIndex:i,endIndex:n}):r.subarray(i,n),offset:i*r.BYTES_PER_ELEMENT+this.byteOffset})}allocate(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:i}=this,n=i.allocatedValue,s=p0.allocate(n,t+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=s;const{buffer:a,byteOffset:o}=this;return a.byteLength<s.byteLength+o&&(a.reallocate(s.byteLength+o),r&&n&&a.subData({data:n instanceof Float64Array?l2(n,this):n,offset:o})),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:r}=t;if(!ArrayBuffer.isView(r))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let n=!1;if(this.doublePrecision&&(n=r.BYTES_PER_ELEMENT<4),n)throw new Error("Attribute ".concat(this.id," does not support ").concat(r.constructor.name));!(r instanceof i)&&this.settings.normalized&&!("normalized"in t)&&xi.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map(r=>(r+128)/255*2-1);case 5122:return new Float32Array(t).map(r=>(r+32768)/65535*2-1);case 5121:return new Float32Array(t).map(r=>r/255);case 5123:return new Float32Array(t).map(r=>r/65535);default:return t}}_normalizeValue(t,r,i){const{defaultValue:n,size:s}=this.settings;if(Number.isFinite(t))return r[i]=t,r;if(!t){let a=s;for(;--a>=0;)r[i+a]=n[a];return r}switch(s){case 4:r[i+3]=Number.isFinite(t[3])?t[3]:n[3];case 3:r[i+2]=Number.isFinite(t[2])?t[2]:n[2];case 2:r[i+1]=Number.isFinite(t[1])?t[1]:n[1];case 1:r[i+0]=Number.isFinite(t[0])?t[0]:n[0];break;default:let a=s;for(;--a>=0;)r[i+a]=Number.isFinite(t[a])?t[a]:n[a]}return r}_areValuesEqual(t,r){if(!t||!r)return!1;const{size:i}=this;for(let n=0;n<i;n++)if(t[n]!==r[n])return!1;return!0}}const QT=[],tP=[];function g6(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,i=QT;const n={index:-1,data:e,target:[]};return e?typeof e[Symbol.iterator]=="function"?i=e:e.length>0&&(tP.length=e.length,i=tP):i=QT,(t>0||Number.isFinite(r))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,r),n.index=t-1),{iterable:i,objectInfo:n}}function m6(e){return e&&e[Symbol.asyncIterator]}function E$(e,t){const{size:r,stride:i,offset:n,startIndices:s,nested:a}=t,o=e.BYTES_PER_ELEMENT,f=i?i/o:r,m=n?n/o:0,w=Math.floor((e.length-m)/f);return(A,P)=>{let{index:I,target:N}=P;if(!s){const z=I*f+m;for(let J=0;J<r;J++)N[J]=e[z+J];return N}const F=s[I],Z=s[I+1]||w;let U;if(a){U=new Array(Z-F);for(let z=F;z<Z;z++){const J=z*f+m;N=new Array(r);for(let nt=0;nt<r;nt++)N[nt]=e[J+nt];U[z-F]=N}}else if(f===r)U=e.subarray(F*r+m,Z*r+m);else{U=new e.constructor((Z-F)*r);let z=0;for(let J=F;J<Z;J++){const nt=J*f+m;for(let mt=0;mt<r;mt++)U[z++]=e[nt+mt]}}return U}}const C$=[],Cy=[[0,1/0]];function T$(e,t){if(e===Cy||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;const r=[],i=e.length;let n=0;for(let s=0;s<i;s++){const a=e[s];a[1]<t[0]?(r.push(a),n=s+1):a[0]>t[1]?r.push(a):t=[Math.min(a[0],t[0]),Math.max(a[1],t[1])]}return r.splice(n,0,t),r}function f2(e){const{source:t,target:r,start:i=0,size:n,getData:s}=e,a=e.end||r.length,o=t.length,f=a-i;if(o>f){r.set(t.subarray(0,f),i);return}if(r.set(t,i),!s)return;let m=o;for(;m<f;){const w=s(m,t);for(let A=0;A<n;A++)r[i+m]=w[A]||0,m++}}function P$(e){let{source:t,target:r,size:i,getData:n,sourceStartIndices:s,targetStartIndices:a}=e;if(!Array.isArray(a))return f2({source:t,target:r,size:i,getData:n}),r;let o=0,f=0;const m=n&&((A,P)=>n(A+f,P)),w=Math.min(s.length,a.length);for(let A=1;A<w;A++){const P=s[A]*i,I=a[A]*i;f2({source:t.subarray(o,P),target:r,start:f,end:I,size:i,getData:m}),o=P,f=I}return f<r.length&&f2({source:[],target:r,start:f,size:i,getData:m}),r}const I$={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function y6(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const r=e.type||"interpolation";return{...I$[r],...t,...e,type:r}}function _6(e,t){const r=t.getBuffer();return r?[r,{divisor:0,size:t.size,normalized:t.settings.normalized}]:t.value}function v6(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(e,'"'))}}function b6(e){e.push(e.shift())}function VA(e,t){const{doublePrecision:r,settings:i,value:n,size:s}=e,a=r&&n instanceof Float64Array?2:1;return(i.noAlloc?n.length:t*s)*a}function w6(e){let{buffer:t,numInstances:r,attribute:i,fromLength:n,fromStartIndices:s,getData:a=z=>z}=e;const o=i.doublePrecision&&i.value instanceof Float64Array?2:1,f=i.size*o,m=i.byteOffset,w=i.startIndices,A=s&&w,P=VA(i,r),I=i.isConstant;if(!A&&n>=P)return;const N=I?i.value:i.getBuffer().getData({srcByteOffset:m});if(i.settings.normalized&&!I){const z=a;a=(J,nt)=>i.normalizeConstant(z(J,nt))}const F=I?(z,J)=>a(N,J):(z,J)=>a(N.subarray(z,z+f),J),Z=t.getData({length:n}),U=new Float32Array(P);P$({source:Z,target:U,sourceStartIndices:s,targetStartIndices:w,size:f,getData:F}),t.byteLength<U.byteLength+m&&t.reallocate(U.byteLength+m),t.subData({data:U,offset:m})}class qA extends S${constructor(t,r){super(t,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Cy}),$(this,"constant",!1),this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=this.state.needsRedraw;return this.state.needsRedraw=r&&!t,r}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:r}=this.settings,i=this.settings.transition,n=Array.isArray(r)?t[r.find(s=>t[s])]:t[r];return y6(n,i)}setNeedsUpdate(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,r=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),r){const{startRow:i=0,endRow:n=1/0}=r;this.state.updateRanges=T$(this.state.updateRanges,[i,n])}else this.state.updateRanges=Cy}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=C$}setNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:r,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(t,r.updateRanges!==Cy),!0):!1}updateBuffer(t){let{numInstances:r,data:i,props:n,context:s}=t;if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:o,noAlloc:f}}=this;let m=!0;if(o){for(const[w,A]of a)o.call(s,this,{data:i,startRow:w,endRow:A,props:n,numInstances:r});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[w,A]of a){const P=Number.isFinite(w)?this.getVertexOffset(w):0,I=Number.isFinite(A)?this.getVertexOffset(A):f||!Number.isFinite(r)?this.value.length:r*this.size;super.updateSubBuffer({startOffset:P,endOffset:I})}this._checkAttributeArray()}else m=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),m}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:r}=this;return t?(this.clearNeedsUpdate(),r.lastExternalBuffer===t||(r.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:i,settings:n}=this;if(!t)return i.binaryValue=null,i.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(i.binaryValue===t)return this.clearNeedsUpdate(),!0;if(i.binaryValue=t,this.setNeedsRedraw(),n.transform||r!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const s=t;Ys(ArrayBuffer.isView(s.value),"invalid ".concat(n.accessor));const a=!!s.size&&s.size!==this.size;return i.binaryAccessor=E$(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:r,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:r}=this;return(r?t<r.length?r[t]:this.numInstances:t)*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},r={};for(const i in t)Object.assign(r,super.getShaderAttributes(i,t[i]));return r}_autoUpdater(t,r){let{data:i,startRow:n,endRow:s,props:a,numInstances:o}=r;if(t.constant)return;const{settings:f,state:m,value:w,size:A,startIndices:P}=t,{accessor:I,transform:N}=f,F=m.binaryAccessor||(typeof I=="function"?I:a[I]);Ys(typeof F=="function",'accessor "'.concat(I,'" is not a function'));let Z=t.getVertexOffset(n);const{iterable:U,objectInfo:z}=g6(i,n,s);for(const J of U){z.index++;let nt=F(J,z);if(N&&(nt=N.call(this,nt)),P){const mt=(z.index<P.length-1?P[z.index+1]:o)-P[z.index];if(nt&&Array.isArray(nt[0])){let Et=Z;for(const bt of nt)t._normalizeValue(bt,w,Et),Et+=A}else nt&&nt.length>A?w.set(nt,Z):(t._normalizeValue(nt,z.target,0),tW({target:w,source:z.target,start:Z,count:mt}));Z+=mt*A}else t._normalizeValue(nt,w,Z),Z+=A}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,r=Math.min(4,this.size);if(t&&t.length>=r){let i=!0;switch(r){case 4:i=i&&Number.isFinite(t[3]);case 3:i=i&&Number.isFinite(t[2]);case 2:i=i&&Number.isFinite(t[1]);case 1:i=i&&Number.isFinite(t[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class M${constructor(t){let{gl:r,attribute:i,timeline:n}=t;$(this,"gl",void 0),$(this,"type","interpolation"),$(this,"attributeInTransition",void 0),$(this,"settings",void 0),$(this,"attribute",void 0),$(this,"transition",void 0),$(this,"currentStartIndices",void 0),$(this,"currentLength",void 0),$(this,"transform",void 0),$(this,"buffers",void 0),this.gl=r,this.transition=new D0(n),this.attribute=i,this.attributeInTransition=new qA(r,i.settings),this.currentStartIndices=i.startIndices,this.currentLength=0,this.transform=B$(r,i);const s={byteLength:0,usage:35050};this.buffers=[new Ki(r,s),new Ki(r,s)]}get inProgress(){return this.transition.inProgress}start(t,r){if(t.duration<=0){this.transition.cancel();return}this.settings=t;const{gl:i,buffers:n,attribute:s}=this;b6(n);const a={numInstances:r,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const o of n)w6({buffer:o,...a});this.currentStartIndices=s.startIndices,this.currentLength=VA(s,r),this.attributeInTransition.setData({buffer:n[1],value:s.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:n[0],aTo:_6(i,s)},feedbackBuffers:{vCurrent:n[1]}})}update(){const t=this.transition.update();if(t){const{duration:r,easing:i}=this.settings,{time:n}=this.transition;let s=n/r;i&&(s=i(s)),this.transform.run({uniforms:{time:s}})}return t}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0}}const L$=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function B$(e,t){const r=v6(t.size);return new BA(e,{vs:L$,defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"]})}class k${constructor(t){let{gl:r,attribute:i,timeline:n}=t;$(this,"gl",void 0),$(this,"type","spring"),$(this,"attributeInTransition",void 0),$(this,"settings",void 0),$(this,"attribute",void 0),$(this,"transition",void 0),$(this,"currentStartIndices",void 0),$(this,"currentLength",void 0),$(this,"texture",void 0),$(this,"framebuffer",void 0),$(this,"transform",void 0),$(this,"buffers",void 0),this.gl=r,this.type="spring",this.transition=new D0(n),this.attribute=i,this.attributeInTransition=new qA(r,{...i.settings,normalized:!1}),this.currentStartIndices=i.startIndices,this.currentLength=0,this.texture=O$(r),this.framebuffer=D$(r,this.texture),this.transform=R$(r,i,this.framebuffer);const s={byteLength:0,usage:35050};this.buffers=[new Ki(r,s),new Ki(r,s),new Ki(r,s)]}get inProgress(){return this.transition.inProgress}start(t,r){const{gl:i,buffers:n,attribute:s}=this,a={numInstances:r,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const o of n)w6({buffer:o,...a});this.settings=t,this.currentStartIndices=s.startIndices,this.currentLength=VA(s,r),this.attributeInTransition.setData({buffer:n[1],value:s.value}),this.transition.start({...t,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:_6(i,s)}})}update(){const{buffers:t,transform:r,framebuffer:i,transition:n}=this;if(!n.update())return!1;const s=this.settings;return r.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),r.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:s.stiffness,damping:s.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),b6(t),this.attributeInTransition.setData({buffer:t[1],value:this.attribute.value}),nv(i)[0]>0||n.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function R$(e,t,r){const i=v6(t.size);return new BA(e,{framebuffer:r,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function O$(e){return new Xa(e,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function D$(e,t){return new ws(e,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:t}})}const N$={interpolation:M$,spring:k$};class F${constructor(t,r){let{id:i,timeline:n}=r;$(this,"id",void 0),$(this,"isSupported",void 0),$(this,"gl",void 0),$(this,"timeline",void 0),$(this,"transitions",void 0),$(this,"needsRedraw",void 0),$(this,"numInstances",void 0),this.id=i,this.gl=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=BA.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update(t){let{attributes:r,transitions:i,numInstances:n}=t;this.numInstances=n||1;for(const s in r){const a=r[s],o=a.getTransitionSetting(i);o&&this._updateAttribute(s,a,o)}for(const s in this.transitions){const a=r[s];(!a||!a.getTransitionSetting(i))&&this._removeTransition(s)}}hasAttribute(t){const r=this.transitions[t];return r&&r.inProgress}getAttributes(){const t={};for(const r in this.transitions){const i=this.transitions[r];i.inProgress&&(t[r]=i.attributeInTransition)}return t}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,r,i){const n=this.transitions[t];let s=!n||n.type!==i.type;if(s){if(!this.isSupported){xi.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();return}n&&this._removeTransition(t);const a=N$[i.type];a?this.transitions[t]=new a({attribute:r,timeline:this.timeline,gl:this.gl}):(xi.error("unsupported transition type '".concat(i.type,"'"))(),s=!1)}(s||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(i,this.numInstances))}}const eP="attributeManager.invalidate",z$="attributeManager.updateStart",j$="attributeManager.updateEnd",U$="attribute.updateStart",G$="attribute.allocate",V$="attribute.updateEnd";class q${constructor(t){let{id:r="attribute-manager",stats:i,timeline:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};$(this,"id",void 0),$(this,"gl",void 0),$(this,"attributes",void 0),$(this,"updateTriggers",void 0),$(this,"needsRedraw",void 0),$(this,"userData",void 0),$(this,"stats",void 0),$(this,"attributeTransitionManager",void 0),$(this,"mergeBoundsMemoized",O0(HH)),this.id=r,this.gl=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new F$(t,{id:"".concat(r,"-transitions"),timeline:n}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(const r of t)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(t,r){const i=this._invalidateTrigger(t,r);wo(eP,this,t,i)}invalidateAll(t){for(const r in this.attributes)this.attributes[r].setNeedsUpdate(r,t);wo(eP,this,"all")}update(t){let{data:r,numInstances:i,startIndices:n=null,transitions:s,props:a={},buffers:o={},context:f={}}=t,m=!1;wo(z$,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const w in this.attributes){const A=this.attributes[w],P=A.settings.accessor;A.startIndices=n,A.numInstances=i,a[w]&&xi.removed("props.".concat(w),"data.attributes.".concat(w))(),A.setExternalBuffer(o[w])||A.setBinaryValue(typeof P=="string"?o[P]:void 0,r.startIndices)||typeof P=="string"&&!o[P]&&A.setConstantValue(a[P])||A.needsUpdate()&&(m=!0,this._updateAttribute({attribute:A,numInstances:i,data:r,props:a,context:f})),this.needsRedraw=this.needsRedraw||A.needsRedraw()}m&&wo(j$,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:s})}updateTransition(){const{attributeTransitionManager:t}=this,r=t.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return this.attributes}getBounds(t){const r=t.map(i=>{var n;return(n=this.attributes[i])===null||n===void 0?void 0:n.getBounds()});return this.mergeBoundsMemoized(r)}getChangedAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:r,attributeTransitionManager:i}=this,n={...i.getAttributes()};for(const s in r){const a=r[s];a.needsRedraw(t)&&!i.hasAttribute(s)&&(n[s]=a)}return n}getShaderAttributes(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t||(t=this.getAttributes());const i={};for(const n in t)r[n]||Object.assign(i,t[n].getShaderAttributes());return i}_add(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(const i in t){const n=t[i];this.attributes[i]=this._createAttribute(i,n,r)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,r,i){const n={...r,id:t,size:r.isIndexed&&1||r.size||1,divisor:i.instanced?1:r.divisor||0};return new qA(this.gl,n)}_mapUpdateTriggersToAttributes(){const t={};for(const r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(i=>{t[i]||(t[i]=[]),t[i].push(r)});this.updateTriggers=t}_invalidateTrigger(t,r){const{attributes:i,updateTriggers:n}=this,s=n[t];return s&&s.forEach(a=>{const o=i[a];o&&o.setNeedsUpdate(o.id,r)}),s}_updateAttribute(t){const{attribute:r,numInstances:i}=t;if(wo(U$,r),r.constant){r.setConstantValue(r.value);return}r.allocate(i)&&wo(G$,r,i),r.updateBuffer(t)&&(this.needsRedraw=!0,wo(V$,r,i))}}class H$ extends D0{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:r,toValue:i,duration:n,easing:s}}=this,a=s(t/n);this._value=w_(r,i,a)}}const rP=1e-5;function iP(e,t,r,i,n){const s=t-e,a=(r-t)*n,o=-s*i;return a+o+s+t}function W$(e,t,r,i,n){if(Array.isArray(r)){const s=[];for(let a=0;a<r.length;a++)s[a]=iP(e[a],t[a],r[a],i,n);return s}return iP(e,t,r,i,n)}function nP(e,t){if(Array.isArray(e)){let r=0;for(let i=0;i<e.length;i++){const n=e[i]-t[i];r+=n*n}return Math.sqrt(r)}return Math.abs(e-t)}class $$ extends D0{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:r,damping:i,stiffness:n}=this.settings,{_prevValue:s=t,_currValue:a=t}=this;let o=W$(s,a,r,i,n);const f=nP(o,r),m=nP(o,a);f<rP&&m<rP&&(o=r,this.end()),this._prevValue=a,this._currValue=o}}const Z$={interpolation:H$,spring:$$};class J${constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,r,i,n){const{transitions:s}=this;if(s.has(t)){const f=s.get(t),{value:m=f.settings.fromValue}=f;r=m,this.remove(t)}if(n=y6(n),!n)return;const a=Z$[n.type];if(!a){xi.error("unsupported transition type '".concat(n.type,"'"))();return}const o=new a(this.timeline);o.start({...n,fromValue:r,toValue:i}),s.set(t,o)}remove(t){const{transitions:r}=this;r.has(t)&&(r.get(t).cancel(),r.delete(t))}update(){const t={};for(const[r,i]of this.transitions)i.update(),t[r]=i.value,i.inProgress||this.remove(r);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function X$(e){const t=e[yd];for(const r in t){const i=t[r],{validate:n}=i;if(n&&!n(e[r],i))throw new Error("Invalid prop ".concat(r,": ").concat(e[r]))}}function K$(e,t){const r=x6({newProps:e,oldProps:t,propTypes:e[yd],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=Q$(e,t);let n=!1;return i||(n=tZ(e,t)),{dataChanged:i,propsChanged:r,updateTriggersChanged:n,extensionsChanged:eZ(e,t),transitionsChanged:Y$(e,t)}}function Y$(e,t){if(!e.transitions)return!1;const r={},i=e[yd];let n=!1;for(const s in e.transitions){const a=i[s],o=a&&a.type;(o==="number"||o==="color"||o==="array")&&bx(e[s],t[s],a)&&(r[s]=!0,n=!0)}return n?r:!1}function x6(e){let{newProps:t,oldProps:r,ignoreProps:i={},propTypes:n={},triggerName:s="props"}=e;if(r===t)return!1;if(typeof t!="object"||t===null||typeof r!="object"||r===null)return"".concat(s," changed shallowly");for(const a of Object.keys(t))if(!(a in i)){if(!(a in r))return"".concat(s,".").concat(a," added");const o=bx(t[a],r[a],n[a]);if(o)return"".concat(s,".").concat(a," ").concat(o)}for(const a of Object.keys(r))if(!(a in i)){if(!(a in t))return"".concat(s,".").concat(a," dropped");if(!Object.hasOwnProperty.call(t,a)){const o=bx(t[a],r[a],n[a]);if(o)return"".concat(s,".").concat(a," ").concat(o)}}return!1}function bx(e,t,r){let i=r&&r.equal;return i&&!i(e,t,r)||!i&&(i=e&&t&&e.equals,i&&!i.call(e,t))?"changed deeply":!i&&t!==e?"changed shallowly":null}function Q$(e,t){if(t===null)return"oldProps is null, initial diff";let r=!1;const{dataComparator:i,_dataDiff:n}=e;return i?i(e.data,t.data)||(r="Data comparator detected a change"):e.data!==t.data&&(r="A new data container was supplied"),r&&n&&(r=n(e.data,t.data)||r),r}function tZ(e,t){if(t===null)return{all:!0};if("all"in e.updateTriggers&&sP(e,t,"all"))return{all:!0};const r={};let i=!1;for(const n in e.updateTriggers)n!=="all"&&sP(e,t,n)&&(r[n]=!0,i=!0);return i?r:!1}function eZ(e,t){if(t===null)return!0;const r=t.extensions,{extensions:i}=e;if(i===r)return!1;if(!r||!i||i.length!==r.length)return!0;for(let n=0;n<i.length;n++)if(!i[n].equals(r[n]))return!0;return!1}function sP(e,t,r){let i=e.updateTriggers[r];i=i??{};let n=t.updateTriggers[r];return n=n??{},x6({oldProps:n,newProps:i,triggerName:r})}const rZ="count(): argument not an object",iZ="count(): argument not a container";function nZ(e){if(!oZ(e))throw new Error(rZ);if(typeof e.count=="function")return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(sZ(e))return Object.keys(e).length;throw new Error(iZ)}function sZ(e){return e!==null&&typeof e=="object"&&e.constructor===Object}function oZ(e){return e!==null&&typeof e=="object"}function aZ(e,t){if(!t)return e;const r={...e,...t};if("defines"in t&&(r.defines={...e.defines,...t.defines}),"modules"in t&&(r.modules=(e.modules||[]).concat(t.modules),t.modules.some(i=>i.name==="project64"))){const i=r.modules.findIndex(n=>n.name==="project32");i>=0&&r.modules.splice(i,1)}if("inject"in t)if(!e.inject)r.inject=t.inject;else{const i={...e.inject};for(const n in t.inject)i[n]=(i[n]||"")+t.inject[n];r.inject=i}return r}const lZ={10241:9987,10240:9729,10242:33071,10243:33071},wx={};function cZ(e,t,r,i){if(r instanceof Xa)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let n=null;r.compressed&&(n={10241:r.data.length>1?9985:9729});const s=new Xa(t,{...r,parameters:{...lZ,...n,...i}});return wx[s.id]=e,s}function uZ(e,t){!t||!(t instanceof Xa)||wx[t.id]===e&&(t.delete(),delete wx[t.id])}const hZ={boolean:{validate(e,t){return!0},equal(e,t,r){return!!e==!!t}},number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},color:{validate(e,t){return t.optional&&!e||xx(e)&&(e.length===3||e.length===4)},equal(e,t,r){return uu(e,t,1)}},accessor:{validate(e,t){const r=P_(e);return r==="function"||r===P_(t.value)},equal(e,t,r){return typeof t=="function"?!0:uu(e,t,1)}},array:{validate(e,t){return t.optional&&!e||xx(e)},equal(e,t,r){const{compare:i}=r,n=Number.isInteger(i)?i:i?1:0;return i?uu(e,t,n):e===t}},object:{equal(e,t,r){if(r.ignore)return!0;const{compare:i}=r,n=Number.isInteger(i)?i:i?1:0;return i?uu(e,t,n):e===t}},function:{validate(e,t){return t.optional&&!e||typeof e=="function"},equal(e,t,r){return!r.compare&&r.ignore!==!1||e===t}},data:{transform:(e,t,r)=>{const{dataTransform:i}=r.props;return i&&e?i(e):e}},image:{transform:(e,t,r)=>{const i=r.context;return!i||!i.gl?null:cZ(r.id,i.gl,e,{...t.parameters,...r.props.textureParameters})},release:(e,t,r)=>{uZ(r.id,e)}}};function dZ(e){const t={},r={},i={};for(const[n,s]of Object.entries(e)){const a=s==null?void 0:s.deprecatedFor;if(a)i[n]=Array.isArray(a)?a:[a];else{const o=fZ(n,s);t[n]=o,r[n]=o.value}}return{propTypes:t,defaultProps:r,deprecatedProps:i}}function fZ(e,t){switch(P_(t)){case"object":return om(e,t);case"array":return om(e,{type:"array",value:t,compare:!1});case"boolean":return om(e,{type:"boolean",value:t});case"number":return om(e,{type:"number",value:t});case"function":return om(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function om(e,t){return"type"in t?{name:e,...hZ[t.type],...t}:"value"in t?{name:e,type:P_(t.value),...t}:{name:e,type:"object",value:t}}function xx(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function P_(e){return xx(e)?"array":e===null?"null":typeof e}function pZ(e,t){let r;for(let s=t.length-1;s>=0;s--){const a=t[s];"extensions"in a&&(r=a.extensions)}const i=Ax(e.constructor,r),n=Object.create(i);n[C_]=e,n[Tf]={},n[od]={};for(let s=0;s<t.length;++s){const a=t[s];for(const o in a)n[o]=a[o]}return Object.freeze(n),n}const gZ="_mergedDefaultProps";function Ax(e,t){let r=gZ;if(t)for(const n of t){const s=n.constructor;s&&(r+=":".concat(s.extensionName||s.name))}return A6(e,r)||(e[r]=mZ(e,t||[]))}function mZ(e,t){if(!e.prototype)return null;const r=Object.getPrototypeOf(e),i=Ax(r),n=A6(e,"defaultProps")||{},s=dZ(n),a=Object.assign(Object.create(null),i,s.defaultProps),o=Object.assign(Object.create(null),i==null?void 0:i[yd],s.propTypes),f=Object.assign(Object.create(null),i==null?void 0:i[u2],s.deprecatedProps);for(const m of t){const w=Ax(m.constructor);w&&(Object.assign(a,w),Object.assign(o,w[yd]),Object.assign(f,w[u2]))}return yZ(a,e),vZ(a,o),_Z(a,f),a[yd]=o,a[u2]=f,t.length===0&&!HA(e,"_propTypes")&&(e._propTypes=o),a}function yZ(e,t){const r=wZ(t);Object.defineProperties(e,{id:{writable:!0,value:r}})}function _Z(e,t){for(const r in t)Object.defineProperty(e,r,{enumerable:!1,set(i){const n="".concat(this.id,": ").concat(r);for(const s of t[r])HA(this,s)||(this[s]=i);xi.deprecated(n,t[r].join("/"))()}})}function vZ(e,t){const r={},i={};for(const n in t){const s=t[n],{name:a,value:o}=s;s.async&&(r[a]=o,i[a]=bZ(a))}e[Vp]=r,e[Tf]={},Object.defineProperties(e,i)}function bZ(e){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||m6(t)?this[Tf][e]=t:this[od][e]=t},get(){if(this[od]){if(e in this[od])return this[od][e]||this[Vp][e];if(e in this[Tf]){const t=this[C_]&&this[C_].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[Vp][e]}}return this[Vp][e]}}}function HA(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function A6(e,t){return HA(e,t)&&e[t]}function wZ(e){const t=e.componentName;return t||xi.warn("".concat(e.name,".componentName not specified"))(),t||e.name}let xZ=0;class WA{constructor(){$(this,"id",void 0),$(this,"props",void 0),$(this,"count",void 0);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.props=pZ(this,r),this.id=this.props.id,this.count=xZ++}clone(t){const{props:r}=this,i={};for(const n in r[Vp])n in r[od]?i[n]=r[od][n]:n in r[Tf]&&(i[n]=r[Tf][n]);return new this.constructor({...r,...i,...t})}}$(WA,"componentName","Component");$(WA,"defaultProps",{});const AZ=Object.freeze({});class SZ{constructor(t){$(this,"component",void 0),$(this,"onAsyncPropUpdated",void 0),$(this,"asyncProps",void 0),$(this,"oldProps",void 0),$(this,"oldAsyncProps",void 0),this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const r=this.asyncProps[t];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||AZ}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const r=this.asyncProps[t];return r&&r.resolvedValue}isAsyncPropLoading(t){if(t){const r=this.asyncProps[t];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(const r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(t,r){this._watchPromise(t,Promise.resolve(r))}setAsyncProps(t){this.component=t[C_]||this.component;const r=t[od]||{},i=t[Tf]||t,n=t[Vp]||{};for(const s in r){const a=r[s];this._createAsyncPropData(s,n[s]),this._updateAsyncProp(s,a),r[s]=this.getAsyncProp(s)}for(const s in i){const a=i[s];this._createAsyncPropData(s,n[s]),this._updateAsyncProp(s,a)}}_fetch(t,r){return null}_onResolve(t,r){}_onError(t,r){}_updateAsyncProp(t,r){if(this._didAsyncInputValueChange(t,r)){if(typeof r=="string"&&(r=this._fetch(t,r)),r instanceof Promise){this._watchPromise(t,r);return}if(m6(r)){this._resolveAsyncIterable(t,r);return}this._setPropValue(t,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,r){const i=this.asyncProps[t];return r===i.resolvedValue||r===i.lastValue?!1:(i.lastValue=r,!0)}_setPropValue(t,r){this._freezeAsyncOldProps();const i=this.asyncProps[t];i&&(r=this._postProcessValue(i,r),i.resolvedValue=r,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(t,r,i){const n=this.asyncProps[t];n&&i>=n.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=r,n.resolvedLoadCount=i,this.onAsyncPropUpdated(t,r))}_watchPromise(t,r){const i=this.asyncProps[t];if(i){i.pendingLoadCount++;const n=i.pendingLoadCount;r.then(s=>{this.component&&(s=this._postProcessValue(i,s),this._setAsyncPropValue(t,s,n),this._onResolve(t,s))}).catch(s=>{this._onError(t,s)})}}async _resolveAsyncIterable(t,r){if(t!=="data"){this._setPropValue(t,r);return}const i=this.asyncProps[t];if(!i)return;i.pendingLoadCount++;const n=i.pendingLoadCount;let s=[],a=0;for await(const o of r){if(!this.component)return;const{dataTransform:f}=this.component.props;f?s=f(o,s):s=s.concat(o),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:a,endRow:s.length}]}),a=s.length,this._setAsyncPropValue(t,s,n)}this._onResolve(t,s)}_postProcessValue(t,r){const i=t.type;return i&&this.component&&(i.release&&i.release(t.resolvedValue,i,this.component),i.transform)?i.transform(r,i,this.component):r}_createAsyncPropData(t,r){if(!this.asyncProps[t]){const i=this.component&&this.component.props[yd];this.asyncProps[t]={type:i&&i[t],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}}class EZ extends SZ{constructor(t){let{attributeManager:r,layer:i}=t;super(i),$(this,"attributeManager",void 0),$(this,"needsRedraw",void 0),$(this,"needsUpdate",void 0),$(this,"subLayers",void 0),$(this,"usesPickingColorCache",void 0),$(this,"hasPickingBuffer",void 0),$(this,"changeFlags",void 0),$(this,"viewport",void 0),$(this,"uniformTransitions",void 0),$(this,"propsInTransition",void 0),this.attributeManager=r,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,r){const i=this.layer,n=i==null?void 0:i.props.fetch;return n?n(r,{propName:t,layer:i}):super._fetch(t,r)}_onResolve(t,r){const i=this.layer;if(i){const n=i.props.onDataLoad;t==="data"&&n&&n(r,{propName:t,layer:i})}}_onError(t,r){const i=this.layer;i&&i.raiseError(r,"loading ".concat(t," of ").concat(this.layer))}}const CZ="layer.changeFlag",TZ="layer.initialize",PZ="layer.update",IZ="layer.finalize",MZ="layer.matched",oP=2**24-1,LZ=Object.freeze([]),BZ=O0(e=>{let{oldViewport:t,viewport:r}=e;return t.equals(r)});let ru=new Uint8ClampedArray(0);const kZ={data:{type:"data",value:LZ,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,t)=>{let{propName:r,layer:i,loaders:n,loadOptions:s,signal:a}=t;const{resourceManager:o}=i.context;if(s=s||i.getLoadOptions(),n=n||i.props.loaders,a){var f;s={...s,fetch:{...(f=s)===null||f===void 0?void 0:f.fetch,signal:a}}}let m=o.contains(e);return!m&&!s&&(o.add({resourceId:e,data:wd(e,n),persistent:!1}),m=!0),m?o.subscribe({resourceId:e,onChange:w=>{var A;return(A=i.internalState)===null||A===void 0?void 0:A.reloadAsyncProp(r,w)},consumerId:i.id,requestId:r}):wd(e,n,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:vi.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:e=>{let{layerIndex:t}=e;return[0,-t*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class xg extends WA{constructor(){super(...arguments),$(this,"internalState",null),$(this,"lifecycle",fp.NO_STATE),$(this,"context",void 0),$(this,"state",void 0),$(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}project(t){Ys(this.internalState);const r=this.internalState.viewport||this.context.viewport,i=n6(t,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,s,a]=i6(i,r.pixelProjectionMatrix);return t.length===2?[n,s]:[n,s,a]}unproject(t){return Ys(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,r){Ys(this.internalState);const i=this.internalState.viewport||this.context.viewport;return KH(t,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(t){for(const r of this.getModels())r.updateModuleSettings(t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===vi.DEFAULT||t===vi.LNGLAT||t===vi.CARTESIAN}onHover(t,r){return this.props.onHover&&this.props.onHover(t,r)||!1}onClick(t,r){return this.props.onClick&&this.props.onClick(t,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return r[0]=t+1&255,r[1]=t+1>>8&255,r[2]=t+1>>8>>8&255,r}decodePickingColor(t){Ys(t instanceof Uint8Array);const[r,i,n]=t;return r+i*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:nZ(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return(t=this.getAttributeManager())===null||t===void 0?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){for(const r of this.props.extensions)t=aZ(t,r.getShaders.call(this,r));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const r=this.getAttributeManager(),{dataChanged:i}=t.changeFlags;if(i&&r)if(Array.isArray(i))for(const n of i)r.invalidateAll(n);else r.invalidateAll();if(r){const{props:n}=t,s=this.internalState.hasPickingBuffer,a=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(o=>o.getNeedsPickingBuffer.call(this,o));if(s!==a){this.internalState.hasPickingBuffer=a;const{pickingColors:o,instancePickingColors:f}=r.attributes,m=o||f;m&&(a&&m.constant&&(m.constant=!1,r.invalidate(m.id)),!m.value&&!a&&(m.constant=!0,m.value=[0,0,0]))}}}finalizeState(t){for(const i of this.getModels())i.delete();const r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const r of this.getModels())r.draw(t)}getPickingInfo(t){let{info:r,mode:i,sourceLayer:n}=t;const{index:s}=r;return s>=0&&Array.isArray(this.props.data)&&(r.object=this.props.data[s]),r}raiseError(t,r){var i,n;if(r&&(t=new Error("".concat(r,": ").concat(t.message),{cause:t})),!((i=(n=this.props).onError)!==null&&i!==void 0&&i.call(n,t))){var s,a;(s=this.context)===null||s===void 0||(a=s.onError)===null||a===void 0||a.call(s,t,this)}}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var t;return((t=this.internalState)===null||t===void 0?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const r=this.internalState.viewport;this.internalState.viewport=t,(!r||!BZ({oldViewport:r,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const r=this.getAttributeManager();r&&(t==="all"?r.invalidateAll():r.invalidate(t))}updateAttributes(t){for(const r of this.getModels())this._setModelAttributes(r,t)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const r=this.props,i=this.getNumInstances(),n=this.getStartIndices();t.update({data:r.data,numInstances:i,startIndices:n,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});const s=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const r=t.update(),i=Object.create(this.props);for(const n in r)Object.defineProperty(i,n,{value:r[n]});return i}return this.props}calculateInstancePickingColors(t,r){let{numInstances:i}=r;if(t.constant)return;const n=Math.floor(ru.length/3);if(this.internalState.usesPickingColorCache=!0,n<i){i>oP&&xi.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),ru=p0.allocate(ru,i,{size:3,copy:!0,maxCount:Math.max(i,oP)});const s=Math.floor(ru.length/3),a=[];for(let o=n;o<s;o++)this.encodePickingColor(o,a),ru[o*3+0]=a[0],ru[o*3+1]=a[1],ru[o*3+2]=a[2]}t.value=ru.subarray(0,i*3)}_setModelAttributes(t,r){const i=this.getAttributeManager(),n=t.userData.excludeAttributes||{},s=i.getShaderAttributes(r,n);t.setAttributes(s)}disablePickingIndex(t){const r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(t);return}const{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,s=i||n,a=s&&r.attributes&&r.attributes[s.id];if(a&&a.value){const o=a.value,f=this.encodePickingColor(t);for(let m=0;m<r.length;m++){const w=s.getVertexOffset(m);o[w]===f[0]&&o[w+1]===f[1]&&o[w+2]===f[2]&&this._disablePickingIndex(m)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,n=r||i;if(!n)return;const s=n.getVertexOffset(t),a=n.getVertexOffset(t+1);n.buffer.subData({data:new Uint8Array(a-s),offset:s})}restorePickingColors(){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,i=t||r;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==ru.buffer&&(i.value=ru.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Ys(!this.internalState),Ys(Number.isFinite(this.props.coordinateSystem)),wo(TZ,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new EZ({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(xi.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new J$(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){wo(MZ,this,this===t);const{state:r,internalState:i}=t;this!==t&&(this.internalState=i,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(wo(PZ,this,t),!t)return;const r=this.props,i=this.context,n=this.internalState,s=i.viewport,a=this._updateUniformTransition();n.propsInTransition=a,i.viewport=n.viewport||s,this.props=a;try{const o=this._getUpdateParams(),f=this.getModels();if(i.gl)this.updateState(o);else try{this.updateState(o)}catch{}for(const w of this.props.extensions)w.updateState.call(this,o,w);const m=this.getModels()[0]!==f[0];this._postUpdate(o,m)}finally{i.viewport=s,this.props=r,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){wo(IZ,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer(t){let{moduleParameters:r=null,uniforms:i={},parameters:n={}}=t;this._updateAttributeTransition();const s=this.props,a=this.context;this.props=this.internalState.propsInTransition||s;const o=this.props.opacity;i.opacity=Math.pow(o,1/2.2);try{r&&this.setModuleParameters(r);const{getPolygonOffset:f}=this.props,m=f&&f(i)||[0,0];dh(a.gl,{polygonOffset:m}),Tc(a.gl,n,()=>{const w={moduleParameters:r,uniforms:i,parameters:n,context:a};for(const A of this.props.extensions)A.draw.call(this,w,A);this.draw(w)})}finally{this.props=s}}getChangeFlags(){var t;return(t=this.internalState)===null||t===void 0?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:r}=this.internalState;for(const n in t)if(t[n]){let s=!1;switch(n){case"dataChanged":const a=t[n],o=r[n];a&&Array.isArray(o)&&(r.dataChanged=Array.isArray(a)?o.concat(a):a,s=!0);default:r[n]||(r[n]=t[n],s=!0)}s&&wo(CZ,this,n,t)}const i=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=i,r.somethingChanged=i||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,r){const i=K$(t,r);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged){var n;this.internalState.uniformTransitions.add(s,r[s],t[s],(n=t.transitions)===null||n===void 0?void 0:n[s])}return this.setChangeFlags(i)}validateProps(){X$(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const r={pickingSelectedColor:t.picked?t.color:null},{highlightColor:i}=this.props;t.picked&&typeof i=="function"&&(r.pickingHighlightColor=i(t)),this.setModuleParameters(r),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new q$(t.gl,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,r){const{props:i,oldProps:n}=t;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:a,highlightedObjectIndex:o,highlightColor:f}=i;if(r||n.autoHighlight!==a||n.highlightedObjectIndex!==o||n.highlightColor!==f){const m={};a||(m.pickingSelectedColor=null),Array.isArray(f)&&(m.pickingHighlightColor=f),(r||o!==n.highlightedObjectIndex)&&(m.pickingSelectedColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setModuleParameters(m)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),n=i?i.getNeedsRedraw(t):!1;if(r=r||n,r)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}$(xg,"defaultProps",kZ);$(xg,"layerName","Layer");const RZ="compositeLayer.renderLayers";class S6 extends xg{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo(t){let{info:r}=t;const{object:i}=r;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(r.object=i.__source.object,r.index=i.__source.index),r}filterSubLayer(t){return!0}shouldRenderSubLayer(t,r){return r&&r.length}getSubLayerClass(t,r){const{_subLayerProps:i}=this.props;return i&&i[t]&&i[t].type||r}getSubLayerRow(t,r,i){return t.__source={parent:this,object:r,index:i},t}getSubLayerAccessor(t){if(typeof t=="function"){const r={index:-1,data:this.props.data,target:[]};return(i,n)=>i&&i.__source?(r.index=i.__source.index,t(i.__source.object,r)):t(i,n)}return t}getSubLayerProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var r;const{opacity:i,pickable:n,visible:s,parameters:a,getPolygonOffset:o,highlightedObjectIndex:f,autoHighlight:m,highlightColor:w,coordinateSystem:A,coordinateOrigin:P,wrapLongitude:I,positionFormat:N,modelMatrix:F,extensions:Z,fetch:U,operation:z,_subLayerProps:J}=this.props,nt={id:"",updateTriggers:{},opacity:i,pickable:n,visible:s,parameters:a,getPolygonOffset:o,highlightedObjectIndex:f,autoHighlight:m,highlightColor:w,coordinateSystem:A,coordinateOrigin:P,wrapLongitude:I,positionFormat:N,modelMatrix:F,extensions:Z,fetch:U,operation:z},mt=J&&t.id&&J[t.id],Et=mt&&mt.updateTriggers,bt=t.id||"sublayer";if(mt){const pt=this.props[yd],zt=t.type?t.type._propTypes:{};for(const Rt in mt){const at=zt[Rt]||pt[Rt];at&&at.type==="accessor"&&(mt[Rt]=this.getSubLayerAccessor(mt[Rt]))}}Object.assign(nt,t,mt),nt.id="".concat(this.props.id,"-").concat(bt),nt.updateTriggers={all:(r=this.props.updateTriggers)===null||r===void 0?void 0:r.all,...t.updateTriggers,...Et};for(const pt of Z){const zt=pt.getSubLayerProps.call(this,pt);zt&&Object.assign(nt,zt,{updateTriggers:Object.assign(nt.updateTriggers,zt.updateTriggers)})}return nt}_updateAutoHighlight(t){for(const r of this.getSubLayers())r.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,r){let i=this.internalState.subLayers;const n=!i||this.needsUpdate();if(n){const s=this.renderLayers();i=sv(s,Boolean),this.internalState.subLayers=i}wo(RZ,this,n,i);for(const s of i)s.parent=this}}$(S6,"layerName","CompositeLayer");const p2=512,OZ=Math.PI/180;function DZ(e){let{map:t,gl:r,deck:i}=e;if(t.__deck)return t.__deck;const n=i==null?void 0:i.props._customRender,s=i==null?void 0:i.props.onLoad,a=FZ({...i==null?void 0:i.props,_customRender:()=>{t.triggerRepaint(),n==null||n("")}});let o;return(!i||i.props.gl===r)&&(Object.assign(a,{gl:r,width:null,height:null,touchAction:"unset",viewState:$A(t)}),i!=null&&i.isInitialized?aP(i,t):a.onLoad=()=>{s==null||s(),aP(o,t)}),i?(o=i,i.setProps(a),i.userData.isExternal=!0):(o=new GA(a),t.on("remove",()=>{NZ(t)})),o.userData.mapboxLayers=new Set,t.__deck=o,t.on("render",()=>{o.isInitialized&&qZ(o,t)}),o}function aP(e,t){const r=()=>{e.isInitialized?HZ(e,t):t.off("move",r)};t.on("move",r)}function NZ(e){var t;(t=e.__deck)===null||t===void 0||t.finalize(),e.__deck=null}function FZ(e){return{...e,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...e.parameters},views:e.views||[new jA({id:"mapbox"})]}}function zZ(e,t){e.userData.mapboxLayers.add(t),ZA(e)}function jZ(e,t){e.userData.mapboxLayers.delete(t),ZA(e)}function UZ(e,t){ZA(e)}function GZ(e,t,r){let{currentViewport:i}=e.userData,n=!1;i||(i=E6(e,t,!0),e.userData.currentViewport=i,n=!0),e.isInitialized&&e._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:s=>{let{layer:a}=s;return r.id===a.id||a.props.operation.includes("terrain")},clearStack:n,clearCanvas:!1})}function $A(e){var t;const{lng:r,lat:i}=e.getCenter(),n={longitude:(r+540)%360-180,latitude:i,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch(),padding:e.getPadding(),repeat:e.getRenderWorldCopies()};return(t=e.getTerrain)!==null&&t!==void 0&&t.call(e)&&VZ(e,n),n}function VZ(e,t){if(e.getFreeCameraOptions){const{position:r}=e.getFreeCameraOptions();if(!r||r.z===void 0)return;const i=e.transform.height,{longitude:n,latitude:s,pitch:a}=t,o=r.x*p2,f=(1-r.y)*p2,m=r.z*p2,w=f0([n,s]),A=o-w[0],P=f-w[1],I=Math.sqrt(A*A+P*P),N=a*OZ,F=1.5*i,Z=N<.001?F*Math.cos(N)/m:F*Math.sin(N)/I;t.zoom=Math.log2(Z);const U=F*Math.cos(N)/Z,z=m-U;t.position=[0,0,z/Sy(s)]}else typeof e.transform.elevation=="number"&&(t.position=[0,0,e.transform.elevation])}function E6(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Cf({id:"mapbox",x:0,y:0,width:e.width,height:e.height,...$A(t),nearZMultiplier:r?.02:.1,nearZ:t.transform._nearZ/t.transform.height,farZ:t.transform._farZ/t.transform.height})}function qZ(e,t){const{mapboxLayers:r,isExternal:i}=e.userData;if(i){const n=Array.from(r,m=>m.id),s=sv(e.props.layers,Boolean).some(m=>m&&!n.includes(m.id));let a=e.getViewports();const o=a.findIndex(m=>m.id==="mapbox"),f=a.length>1||o<0;(s||f)&&(o>=0&&(a=a.slice(),a[o]=E6(e,t,!1)),e._drawLayers("mapbox-repaint",{viewports:a,layerFilter:m=>(!e.props.layerFilter||e.props.layerFilter(m))&&(m.viewport.id!=="mapbox"||!n.includes(m.layer.id)),clearCanvas:!1}))}e.userData.currentViewport=null}function HZ(e,t){e.setProps({viewState:$A(t)}),e.needsRedraw({clearRedrawFlags:!0})}function ZA(e){if(e.userData.isExternal)return;const t=[];e.userData.mapboxLayers.forEach(r=>{const i=r.props.type,n=new i(r.props);t.push(n)}),e.setProps({layers:t})}class WZ{constructor(t){if($(this,"id",void 0),$(this,"type",void 0),$(this,"renderingMode",void 0),$(this,"map",void 0),$(this,"deck",void 0),$(this,"props",void 0),!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}onAdd(t,r){this.map=t,this.deck=DZ({map:t,gl:r,deck:this.props.deck}),zZ(this.deck,this)}onRemove(){this.deck&&jZ(this.deck,this)}setProps(t){Object.assign(this.props,t,{id:this.id}),this.deck&&UZ(this.deck)}render(){GZ(this.deck,this.map,this)}}const $Z=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ZZ=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,C6=[0,0,0,255],T6=[0,0,1],JZ={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:e=>e.position},getNormal:{type:"accessor",value:T6},getColor:{type:"accessor",value:C6},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function XZ(e){const{header:t,attributes:r}=e;!t||!r||(e.length=t.vertexCount,r.POSITION&&(r.instancePositions=r.POSITION),r.NORMAL&&(r.instanceNormals=r.NORMAL),r.COLOR_0&&(r.instanceColors=r.COLOR_0))}class JA extends xg{getShaders(){return super.getShaders({vs:$Z,fs:ZZ,modules:[FA,yq,zA]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:T6},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:C6}})}updateState(t){const{changeFlags:r,props:i}=t;if(super.updateState(t),r.extensionsChanged){var n;const{gl:s}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}r.dataChanged&&XZ(i.data)}draw(t){let{uniforms:r}=t;const{pointSize:i,sizeUnits:n}=this.props;this.state.model.setUniforms(r).setUniforms({sizeUnits:ex[n],radiusPixels:i}).draw()}_getModel(t){const r=[];for(let i=0;i<3;i++){const n=i/3*Math.PI*2;r.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new ug(t,{...this.getShaders(),id:this.props.id,geometry:new jm({drawMode:4,attributes:{positions:new Float32Array(r)}}),isInstanced:!0})}}$(JA,"layerName","PointCloudLayer");$(JA,"defaultProps",JZ);const qa={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new se;new se;const am=new se,lP=new se;class F0{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;$(this,"center",void 0),$(this,"radius",void 0),this.radius=-0,this.center=new se,this.fromCenterRadius(t,r)}fromCenterRadius(t,r){return this.center.from(t),this.radius=r,this}fromCornerPoints(t,r){return r=am.from(r),this.center=new se().from(t).add(r).scale(.5),this.radius=this.center.distance(r),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new F0(this.center,this.radius)}union(t){const r=this.center,i=this.radius,n=t.center,s=t.radius,a=am.copy(n).subtract(r),o=a.magnitude();if(i>=o+s)return this.clone();if(s>=o+i)return t.clone();const f=(i+o+s)*.5;return lP.copy(a).scale((-i+f)/o).add(r),this.center.copy(lP),this.radius=f,this}expand(t){const r=am.from(t).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(t){this.center.transform(t);const r=SV(am,t);return this.radius=Math.max(r[0],Math.max(r[1],r[2]))*this.radius,this}distanceSquaredTo(t){const r=this.distanceTo(t);return r*r}distanceTo(t){const r=am.from(t).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(t){const r=this.center,i=this.radius,n=t.normal.dot(r)+t.distance;return n<-i?qa.OUTSIDE:n<i?qa.INTERSECTING:qa.INSIDE}}const KZ=new se,YZ=new se,H1=new se,W1=new se,$1=new se,QZ=new se,tJ=new se,Hu={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class z0{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];$(this,"center",void 0),$(this,"halfAxes",void 0),this.center=new se().from(t),this.halfAxes=new $n(r)}get halfSize(){const t=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new se(t).len(),new se(r).len(),new se(i).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),n=new se(t).normalize(),s=new se(r).normalize(),a=new se(i).normalize();return new h0().fromMatrix3(new $n([...n,...s,...a]))}fromCenterHalfSizeQuaternion(t,r,i){const n=new h0(i),s=new $n().fromQuaternion(n);return s[0]=s[0]*r[0],s[1]=s[1]*r[0],s[2]=s[2]*r[0],s[3]=s[3]*r[1],s[4]=s[4]*r[1],s[5]=s[5]*r[1],s[6]=s[6]*r[2],s[7]=s[7]*r[2],s[8]=s[8]*r[2],this.center=new se().from(t),this.halfAxes=s,this}clone(){return new z0(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new F0;const r=this.halfAxes,i=r.getColumn(0,H1),n=r.getColumn(1,W1),s=r.getColumn(2,$1),a=KZ.copy(i).add(n).add(s);return t.center.copy(this.center),t.radius=a.magnitude(),t}intersectPlane(t){const r=this.center,i=t.normal,n=this.halfAxes,s=i.x,a=i.y,o=i.z,f=Math.abs(s*n[Hu.COLUMN0ROW0]+a*n[Hu.COLUMN0ROW1]+o*n[Hu.COLUMN0ROW2])+Math.abs(s*n[Hu.COLUMN1ROW0]+a*n[Hu.COLUMN1ROW1]+o*n[Hu.COLUMN1ROW2])+Math.abs(s*n[Hu.COLUMN2ROW0]+a*n[Hu.COLUMN2ROW1]+o*n[Hu.COLUMN2ROW2]),m=i.dot(r)+t.distance;return m<=-f?qa.OUTSIDE:m>=f?qa.INSIDE:qa.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const r=YZ.from(t).subtract(this.center),i=this.halfAxes,n=i.getColumn(0,H1),s=i.getColumn(1,W1),a=i.getColumn(2,$1),o=n.magnitude(),f=s.magnitude(),m=a.magnitude();n.normalize(),s.normalize(),a.normalize();let w=0,A;return A=Math.abs(r.dot(n))-o,A>0&&(w+=A*A),A=Math.abs(r.dot(s))-f,A>0&&(w+=A*A),A=Math.abs(r.dot(a))-m,A>0&&(w+=A*A),w}computePlaneDistances(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const a=this.center,o=this.halfAxes,f=o.getColumn(0,H1),m=o.getColumn(1,W1),w=o.getColumn(2,$1),A=QZ.copy(f).add(m).add(w).add(a),P=tJ.copy(A).subtract(t);let I=r.dot(P);return n=Math.min(I,n),s=Math.max(I,s),A.copy(a).add(f).add(m).subtract(w),P.copy(A).subtract(t),I=r.dot(P),n=Math.min(I,n),s=Math.max(I,s),A.copy(a).add(f).subtract(m).add(w),P.copy(A).subtract(t),I=r.dot(P),n=Math.min(I,n),s=Math.max(I,s),A.copy(a).add(f).subtract(m).subtract(w),P.copy(A).subtract(t),I=r.dot(P),n=Math.min(I,n),s=Math.max(I,s),a.copy(A).subtract(f).add(m).add(w),P.copy(A).subtract(t),I=r.dot(P),n=Math.min(I,n),s=Math.max(I,s),a.copy(A).subtract(f).add(m).subtract(w),P.copy(A).subtract(t),I=r.dot(P),n=Math.min(I,n),s=Math.max(I,s),a.copy(A).subtract(f).subtract(m).add(w),P.copy(A).subtract(t),I=r.dot(P),n=Math.min(I,n),s=Math.max(I,s),a.copy(A).subtract(f).subtract(m).subtract(w),P.copy(A).subtract(t),I=r.dot(P),n=Math.min(I,n),s=Math.max(I,s),i[0]=n,i[1]=s,i}transform(t){this.center.transformAsPoint(t);const r=this.halfAxes.getColumn(0,H1);r.transformAsPoint(t);const i=this.halfAxes.getColumn(1,W1);i.transformAsPoint(t);const n=this.halfAxes.getColumn(2,$1);return n.transformAsPoint(t),this.halfAxes=new $n([...r,...i,...n]),this}getTransform(){throw new Error("not implemented")}}const cP=new se,uP=new se;class wc{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;$(this,"normal",void 0),$(this,"distance",void 0),this.normal=new se,this.distance=-0,this.fromNormalDistance(t,r)}fromNormalDistance(t,r){return xc(Number.isFinite(r)),this.normal.from(t).normalize(),this.distance=r,this}fromPointNormal(t,r){t=cP.from(t),this.normal.from(r).normalize();const i=-this.normal.dot(t);return this.distance=i,this}fromCoefficients(t,r,i,n){return this.normal.set(t,r,i),xc(Pc(this.normal.len(),1)),this.distance=n,this}clone(){return new wc(this.normal,this.distance)}equals(t){return Pc(this.distance,t.distance)&&Pc(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const r=uP.copy(this.normal).transformAsVector(t).normalize(),i=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(i,r)}projectPointOntoPlane(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];t=cP.from(t);const i=this.getPointDistance(t),n=uP.copy(this.normal).scale(i);return t.subtract(n).to(r)}}const hP=[new se([1,0,0]),new se([0,1,0]),new se([0,0,1])],dP=new se,eJ=new se;new wc(new se(1,0,0),0);class Il{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];$(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*hP.length;const r=t.center,i=t.radius;let n=0;for(const s of hP){let a=this.planes[n],o=this.planes[n+1];a||(a=this.planes[n]=new wc),o||(o=this.planes[n+1]=new wc);const f=dP.copy(s).scale(-i).add(r);-s.dot(f),a.fromPointNormal(f,s);const m=dP.copy(s).scale(i).add(r),w=eJ.copy(s).negate();-w.dot(m),o.fromPointNormal(m,w),n+=2}return this}computeVisibility(t){let r=qa.INSIDE;for(const i of this.planes)switch(t.intersectPlane(i)){case qa.OUTSIDE:return qa.OUTSIDE;case qa.INTERSECTING:r=qa.INTERSECTING;break}return r}computeVisibilityWithPlaneMask(t,r){if(xc(Number.isFinite(r),"parentPlaneMask is required."),r===Il.MASK_OUTSIDE||r===Il.MASK_INSIDE)return r;let i=Il.MASK_INSIDE;const n=this.planes;for(let s=0;s<this.planes.length;++s){const a=s<31?1<<s:0;if(s<31&&!(r&a))continue;const o=n[s],f=t.intersectPlane(o);if(f===qa.OUTSIDE)return Il.MASK_OUTSIDE;f===qa.INTERSECTING&&(i|=a)}return i}}$(Il,"MASK_OUTSIDE",4294967295);$(Il,"MASK_INSIDE",0);$(Il,"MASK_INDETERMINATE",2147483647);new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;new se;const iu=new $n,rJ=new $n,iJ=new $n,Z1=new $n,fP=new $n;function nJ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=d0.EPSILON20,i=10;let n=0,s=0;const a=rJ,o=iJ;a.identity(),o.copy(e);const f=r*sJ(o);for(;s<i&&oJ(o)>f;)aJ(o,Z1),fP.copy(Z1).transpose(),o.multiplyRight(Z1),o.multiplyLeft(fP),a.multiplyRight(Z1),++n>2&&(++s,n=0);return t.unitary=a.toTarget(t.unitary),t.diagonal=o.toTarget(t.diagonal),t}function sJ(e){let t=0;for(let r=0;r<9;++r){const i=e[r];t+=i*i}return Math.sqrt(t)}const Sx=[1,0,0],Ex=[2,2,1];function oJ(e){let t=0;for(let r=0;r<3;++r){const i=e[iu.getElementIndex(Ex[r],Sx[r])];t+=2*i*i}return Math.sqrt(t)}function aJ(e,t){const r=d0.EPSILON15;let i=0,n=1;for(let m=0;m<3;++m){const w=Math.abs(e[iu.getElementIndex(Ex[m],Sx[m])]);w>i&&(n=m,i=w)}const s=Sx[n],a=Ex[n];let o=1,f=0;if(Math.abs(e[iu.getElementIndex(a,s)])>r){const m=e[iu.getElementIndex(a,a)],w=e[iu.getElementIndex(s,s)],A=e[iu.getElementIndex(a,s)],P=(m-w)/2/A;let I;P<0?I=-1/(-P+Math.sqrt(1+P*P)):I=1/(P+Math.sqrt(1+P*P)),o=1/Math.sqrt(1+I*I),f=I*o}return $n.IDENTITY.to(t),t[iu.getElementIndex(s,s)]=t[iu.getElementIndex(a,a)]=o,t[iu.getElementIndex(a,s)]=f,t[iu.getElementIndex(s,a)]=-f,t}const $h=new se,lJ=new se,cJ=new se,uJ=new se,hJ=new se,dJ=new $n,fJ={diagonal:new $n,unitary:new $n};function pJ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new z0;if(!e||e.length===0)return t.halfAxes=new $n([0,0,0,0,0,0,0,0,0]),t.center=new se,t;const r=e.length,i=new se(0,0,0);for(const zt of e)i.add(zt);const n=1/r;i.multiplyByScalar(n);let s=0,a=0,o=0,f=0,m=0,w=0;for(const zt of e){const Rt=$h.copy(zt).subtract(i);s+=Rt.x*Rt.x,a+=Rt.x*Rt.y,o+=Rt.x*Rt.z,f+=Rt.y*Rt.y,m+=Rt.y*Rt.z,w+=Rt.z*Rt.z}s*=n,a*=n,o*=n,f*=n,m*=n,w*=n;const A=dJ;A[0]=s,A[1]=a,A[2]=o,A[3]=a,A[4]=f,A[5]=m,A[6]=o,A[7]=m,A[8]=w;const{unitary:P}=nJ(A,fJ),I=t.halfAxes.copy(P);let N=I.getColumn(0,cJ),F=I.getColumn(1,uJ),Z=I.getColumn(2,hJ),U=-Number.MAX_VALUE,z=-Number.MAX_VALUE,J=-Number.MAX_VALUE,nt=Number.MAX_VALUE,mt=Number.MAX_VALUE,Et=Number.MAX_VALUE;for(const zt of e)$h.copy(zt),U=Math.max($h.dot(N),U),z=Math.max($h.dot(F),z),J=Math.max($h.dot(Z),J),nt=Math.min($h.dot(N),nt),mt=Math.min($h.dot(F),mt),Et=Math.min($h.dot(Z),Et);N=N.multiplyByScalar(.5*(nt+U)),F=F.multiplyByScalar(.5*(mt+z)),Z=Z.multiplyByScalar(.5*(Et+J)),t.center.copy(N).add(F).add(Z);const bt=lJ.set(U-nt,z-mt,J-Et).multiplyByScalar(.5),pt=new $n([bt[0],0,0,0,bt[1],0,0,0,bt[2]]);return t.halfAxes.multiplyRight(pt),t}const g2=Math.PI/180,J1=new Float32Array(16),pP=new Float32Array(12);function gP(e,t,r){const i=t[0]*g2,n=t[1]*g2,s=t[2]*g2,a=Math.sin(s),o=Math.sin(i),f=Math.sin(n),m=Math.cos(s),w=Math.cos(i),A=Math.cos(n),P=r[0],I=r[1],N=r[2];e[0]=P*A*w,e[1]=P*f*w,e[2]=P*-o,e[3]=I*(-f*m+A*o*a),e[4]=I*(A*m+f*o*a),e[5]=I*w*a,e[6]=N*(f*a+A*o*m),e[7]=N*(-A*a+f*o*m),e[8]=N*w*m}function mP(e){return e[0]=e[0],e[1]=e[1],e[2]=e[2],e[3]=e[4],e[4]=e[5],e[5]=e[6],e[6]=e[8],e[7]=e[9],e[8]=e[10],e[9]=e[12],e[10]=e[13],e[11]=e[14],e.subarray(0,12)}const P6={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(e,t){let{startRow:r,endRow:i}=t;const{data:n,getOrientation:s,getScale:a,getTranslation:o,getTransformMatrix:f}=this.props,m=Array.isArray(f),w=m&&f.length===16,A=Array.isArray(a),P=Array.isArray(s),I=Array.isArray(o),N=w||!m&&!!f(n[0]);N?e.constant=w:e.constant=P&&A&&I;const F=e.value;if(e.constant){let Z;N?(J1.set(f),Z=mP(J1)):(Z=pP,gP(Z,s,a),Z.set(o,9)),e.value=new Float32Array(Z)}else{let Z=r*e.size;const{iterable:U,objectInfo:z}=g6(n,r,i);for(const J of U){z.index++;let nt;if(N)J1.set(w?f:f(J,z)),nt=mP(J1);else{nt=pP;const mt=P?s:s(J,z),Et=A?a:a(J,z);gP(nt,mt,Et),nt.set(I?o:o(J,z),9)}F[Z++]=nt[0],F[Z++]=nt[1],F[Z++]=nt[2],F[Z++]=nt[3],F[Z++]=nt[4],F[Z++]=nt[5],F[Z++]=nt[6],F[Z++]=nt[7],F[Z++]=nt[8],F[Z++]=nt[9],F[Z++]=nt[10],F[Z++]=nt[11]}}}};function I6(e,t){return t===vi.CARTESIAN||t===vi.METER_OFFSETS||t===vi.DEFAULT&&!e.isGeospatial}const gJ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,mJ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function M6(e){let t=1/0,r=1/0,i=1/0,n=-1/0,s=-1/0,a=-1/0;const o=e.POSITION?e.POSITION.value:[],f=o&&o.length;for(let m=0;m<f;m+=3){const w=o[m],A=o[m+1],P=o[m+2];t=w<t?w:t,r=A<r?A:r,i=P<i?P:i,n=w>n?w:n,s=A>s?A:s,a=P>a?P:a}return[[t,r,i],[n,s,a]]}function yJ(e,t){if(!e)throw new Error(t||"loader assertion failed.")}class Bp{constructor(t,r){$(this,"fields",void 0),$(this,"metadata",void 0),yJ(Array.isArray(t)),_J(t),this.fields=t,this.metadata=r||new Map}compareTo(t){if(this.metadata!==t.metadata||this.fields.length!==t.fields.length)return!1;for(let r=0;r<this.fields.length;++r)if(!this.fields[r].compareTo(t.fields[r]))return!1;return!0}select(){const t=Object.create(null);for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];for(const a of i)t[a]=!0;const s=this.fields.filter(a=>t[a.name]);return new Bp(s,this.metadata)}selectAt(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const n=r.map(s=>this.fields[s]).filter(Boolean);return new Bp(n,this.metadata)}assign(t){let r,i=this.metadata;if(t instanceof Bp){const a=t;r=a.fields,i=yP(yP(new Map,this.metadata),a.metadata)}else r=t;const n=Object.create(null);for(const a of this.fields)n[a.name]=a;for(const a of r)n[a.name]=a;const s=Object.values(n);return new Bp(s,i)}}function _J(e){const t={};for(const r of e)t[r.name]&&console.warn("Schema: duplicated field name",r.name,r),t[r.name]=!0}function yP(e,t){return new Map([...e||new Map,...t||new Map])}class I_{constructor(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;$(this,"name",void 0),$(this,"type",void 0),$(this,"nullable",void 0),$(this,"metadata",void 0),this.name=t,this.type=r,this.nullable=i,this.metadata=n}get typeId(){return this.type&&this.type.typeId}clone(){return new I_(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let qn=function(e){return e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.Float=3]="Float",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct=13]="Struct",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Dictionary=-1]="Dictionary",e[e.Int8=-2]="Int8",e[e.Int16=-3]="Int16",e[e.Int32=-4]="Int32",e[e.Int64=-5]="Int64",e[e.Uint8=-6]="Uint8",e[e.Uint16=-7]="Uint16",e[e.Uint32=-8]="Uint32",e[e.Uint64=-9]="Uint64",e[e.Float16=-10]="Float16",e[e.Float32=-11]="Float32",e[e.Float64=-12]="Float64",e[e.DateDay=-13]="DateDay",e[e.DateMillisecond=-14]="DateMillisecond",e[e.TimestampSecond=-15]="TimestampSecond",e[e.TimestampMillisecond=-16]="TimestampMillisecond",e[e.TimestampMicrosecond=-17]="TimestampMicrosecond",e[e.TimestampNanosecond=-18]="TimestampNanosecond",e[e.TimeSecond=-19]="TimeSecond",e[e.TimeMillisecond=-20]="TimeMillisecond",e[e.TimeMicrosecond=-21]="TimeMicrosecond",e[e.TimeNanosecond=-22]="TimeNanosecond",e[e.DenseUnion=-23]="DenseUnion",e[e.SparseUnion=-24]="SparseUnion",e[e.IntervalDayTime=-25]="IntervalDayTime",e[e.IntervalYearMonth=-26]="IntervalYearMonth",e}({}),L6,B6,k6;class XA{static isNull(t){return t&&t.typeId===qn.Null}static isInt(t){return t&&t.typeId===qn.Int}static isFloat(t){return t&&t.typeId===qn.Float}static isBinary(t){return t&&t.typeId===qn.Binary}static isUtf8(t){return t&&t.typeId===qn.Utf8}static isBool(t){return t&&t.typeId===qn.Bool}static isDecimal(t){return t&&t.typeId===qn.Decimal}static isDate(t){return t&&t.typeId===qn.Date}static isTime(t){return t&&t.typeId===qn.Time}static isTimestamp(t){return t&&t.typeId===qn.Timestamp}static isInterval(t){return t&&t.typeId===qn.Interval}static isList(t){return t&&t.typeId===qn.List}static isStruct(t){return t&&t.typeId===qn.Struct}static isUnion(t){return t&&t.typeId===qn.Union}static isFixedSizeBinary(t){return t&&t.typeId===qn.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===qn.FixedSizeList}static isMap(t){return t&&t.typeId===qn.Map}static isDictionary(t){return t&&t.typeId===qn.Dictionary}get typeId(){return qn.NONE}compareTo(t){return this===t}}L6=Symbol.toStringTag;class Ag extends XA{constructor(t,r){super(),$(this,"isSigned",void 0),$(this,"bitWidth",void 0),this.isSigned=t,this.bitWidth=r}get typeId(){return qn.Int}get[L6](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class vJ extends Ag{constructor(){super(!0,8)}}class bJ extends Ag{constructor(){super(!0,16)}}class wJ extends Ag{constructor(){super(!0,32)}}class xJ extends Ag{constructor(){super(!1,8)}}class AJ extends Ag{constructor(){super(!1,16)}}class SJ extends Ag{constructor(){super(!1,32)}}const R6={HALF:16,SINGLE:32,DOUBLE:64};B6=Symbol.toStringTag;class O6 extends XA{constructor(t){super(),$(this,"precision",void 0),this.precision=t}get typeId(){return qn.Float}get[B6](){return"Float"}toString(){return"Float".concat(this.precision)}}class EJ extends O6{constructor(){super(R6.SINGLE)}}class CJ extends O6{constructor(){super(R6.DOUBLE)}}k6=Symbol.toStringTag;class TJ extends XA{constructor(t,r){super(),$(this,"listSize",void 0),$(this,"children",void 0),this.listSize=t,this.children=[r]}get typeId(){return qn.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[k6](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function PJ(e){switch(e.constructor){case Int8Array:return new vJ;case Uint8Array:return new xJ;case Int16Array:return new bJ;case Uint16Array:return new AJ;case Int32Array:return new wJ;case Uint32Array:return new SJ;case Float32Array:return new EJ;case Float64Array:return new CJ;default:throw new Error("array type not supported")}}function IJ(e,t,r){const i=PJ(t.value),n=r||MJ(t);return new I_(e,new TJ(t.size,new I_("value",i)),!1,n)}function MJ(e){const t=new Map;return"byteOffset"in e&&t.set("byteOffset",e.byteOffset.toString(10)),"byteStride"in e&&t.set("byteStride",e.byteStride.toString(10)),"normalized"in e&&t.set("normalized",e.normalized.toString()),t}function _P(e,t){(e.COLOR_0||e.colors)&&t||(e.colors={constant:!0,value:new Float32Array([1,1,1])}),xi.assert(e.positions||e.POSITION,'no "postions" or "POSITION" attribute in mesh')}function vP(e,t){if(e.attributes)return _P(e.attributes,t),e instanceof jm?e:new jm(e);if(e.positions||e.POSITION)return _P(e,t),new jm({attributes:e});throw Error("Invalid mesh")}const LJ=[0,0,0,255],BJ={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:LJ},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class KA extends xg{constructor(){super(...arguments),$(this,"state",void 0)}getShaders(){const t=!ni(this.context.gl),r={};return _A(this.context.gl,ln.GLSL_DERIVATIVES)&&(r.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:gJ,fs:mJ,modules:[FA,_q,zA],transpileToGLSL100:t,defines:r})}getBounds(){var t;if(this.props._instanced)return super.getBounds();let r=this.state.positionBounds;if(r)return r;const{mesh:i}=this.props;if(!i)return null;if(r=(t=i.header)===null||t===void 0?void 0:t.boundingBox,!r){const{attributes:n}=vP(i,this.props._useMeshColors);n.POSITION=n.POSITION||n.positions,r=M6(n)}return this.state.positionBounds=r,r}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:P6}),this.setState({emptyTexture:new Xa(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:r,oldProps:i,changeFlags:n}=t;if(r.mesh!==i.mesh||n.extensionsChanged){var s;if(this.state.positionBounds=null,(s=this.state.model)===null||s===void 0||s.delete(),r.mesh){this.state.model=this.getModel(r.mesh);const a=r.mesh.attributes||r.mesh;this.setState({hasNormals:!!(a.NORMAL||a.normals)})}this.getAttributeManager().invalidateAll()}r.texture!==i.texture&&this.setTexture(r.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw(t){let{uniforms:r}=t;if(!this.state.model)return;const{viewport:i}=this.context,{sizeScale:n,coordinateSystem:s,_instanced:a}=this.props;this.state.model.setUniforms(r).setUniforms({sizeScale:n,composeModelMatrix:!a||I6(i,s),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.model)&&super.isLoaded}getModel(t){const r=new ug(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:vP(t,this.props._useMeshColors),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:n}=this.state;return r.setUniforms({sampler:i||n,hasTexture:!!i}),r}setTexture(t){const{emptyTexture:r,model:i}=this.state;i&&i.setUniforms({sampler:t||r,hasTexture:!!t})}}$(KA,"defaultProps",BJ);$(KA,"layerName","SimpleMeshLayer");class qp{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:r}=t;this.id=r||fh(this.constructor.name),this.display=!0,this.position=new se,this.rotation=new se,this.scale=new se(1,1,1),this.matrix=new di,this.userData={},this.props={},this._setScenegraphNodeProps(t)}delete(){}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(t){return rr(t.length===3,"setPosition requires vector argument"),this.position=t,this}setRotation(t){return rr(t.length===3,"setRotation requires vector argument"),this.rotation=t,this}setScale(t){return rr(t.length===3,"setScale requires vector argument"),this.scale=t,this}setMatrix(t){!(arguments.length>1&&arguments[1]!==void 0)||arguments[1]?this.matrix.copy(t):this.matrix=t}setMatrixComponents(t){let{position:r,rotation:i,scale:n,update:s=!0}=t;return r&&this.setPosition(r),i&&this.setRotation(i),n&&this.setScale(n),s&&this.updateMatrix(),this}updateMatrix(){const t=this.position,r=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(r),this.matrix.scale(i),this}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:r,rotation:i,scale:n}=t;return r&&this.setPosition(r),i&&this.setRotation(i),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(t,r){rr(t),r=r||this.matrix;const i=new di(t).multiplyRight(r),n=i.invert(),s=n.transpose();return{viewMatrix:t,modelMatrix:r,objectMatrix:r,worldMatrix:i,worldInverseMatrix:n,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class Um extends qp{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t=Array.isArray(t)?{children:t}:t;const{children:r=[]}=t;hr.assert(r.every(i=>i instanceof qp),"every child must an instance of ScenegraphNode"),super(t),this.children=r}add(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(const n of r)Array.isArray(n)?this.add(...n):this.children.push(n);return this}remove(t){const r=this.children,i=r.indexOf(t);return i>-1&&r.splice(i,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(t=>t.delete()),this.removeAll(),super.delete()}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((r,i)=>{let{worldMatrix:n}=i;const s=r.getBounds();if(!s)return;const[a,o]=s,f=new se(a).add(o).divide([2,2,2]);n.transformAsPoint(f,f);const m=new se(o).subtract(a).divide([2,2,2]);n.transformAsVector(m,m);for(let w=0;w<8;w++){const A=new se(w&1?-1:1,w&2?-1:1,w&4?-1:1).multiply(m).add(f);for(let P=0;P<3;P++)t[0][P]=Math.min(t[0][P],A[P]),t[1][P]=Math.max(t[1][P],A[P])}}),Number.isFinite(t[0][0])?t:null}traverse(t){let{worldMatrix:r=new di}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new di(r).multiplyRight(this.matrix);for(const n of this.children)n instanceof Um?n.traverse(t,{worldMatrix:i}):t(n,{worldMatrix:i})}}const kJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},RJ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function bP(e){if(!e._animation){const t=RJ[e.componentType],r=kJ[e.type],i=r*e.count,{buffer:n,byteOffset:s}=e.bufferView.data,a=new t(n,s+(e.byteOffset||0),i);if(r===1)e._animation=Array.from(a);else{const o=[];for(let f=0;f<a.length;f+=r)o.push(Array.from(a.slice(f,f+r)));e._animation=o}}return e._animation}const OJ=new di;function DJ(e,t){if(t.matrix.identity(),e.translation&&t.matrix.translate(e.translation),e.rotation){const r=OJ.fromQuaternion(e.rotation);t.matrix.multiplyRight(r)}e.scale&&t.matrix.scale(e.scale)}const m2=new h0;function NJ(e,t,r,i,n){if(t==="rotation"){m2.slerp({start:r,target:i,ratio:n});for(let s=0;s<m2.length;s++)e[t][s]=m2[s]}else for(let s=0;s<r.length;s++)e[t][s]=n*i[s]+(1-n)*r[s]}function FJ(e,t,r){let{p0:i,outTangent0:n,inTangent1:s,p1:a,tDiff:o,ratio:f}=r;for(let m=0;m<e[t].length;m++){const w=n[m]*o,A=s[m]*o;e[t][m]=(2*Math.pow(f,3)-3*Math.pow(f,2)+1)*i[m]+(Math.pow(f,3)-2*Math.pow(f,2)+f)*w+(-2*Math.pow(f,3)+3*Math.pow(f,2))*a[m]+(Math.pow(f,3)-Math.pow(f,2))*A}}function zJ(e,t,r){for(let i=0;i<r.length;i++)e[t][i]=r[i]}function jJ(e,t,r,i){let{input:n,interpolation:s,output:a}=t;const o=n[n.length-1],f=e%o,m=n.findIndex(I=>I>=f),w=Math.max(0,m-1);if(!Array.isArray(r[i]))switch(i){case"translation":r[i]=[0,0,0];break;case"rotation":r[i]=[0,0,0,1];break;case"scale":r[i]=[1,1,1];break;default:hr.warn("Bad animation path ".concat(i))()}rr(r[i].length===a[w].length);const A=n[w],P=n[m];switch(s){case"STEP":zJ(r,i,a[w]);break;case"LINEAR":if(P>A){const I=(f-A)/(P-A);NJ(r,i,a[w],a[m],I)}break;case"CUBICSPLINE":if(P>A){const I=(f-A)/(P-A),N=P-A,F=a[3*w+1],Z=a[3*w+2],U=a[3*m+0],z=a[3*m+1];FJ(r,i,{p0:F,outTangent0:Z,inTangent1:U,p1:z,tDiff:N,ratio:I})}break;default:hr.warn("Interpolation ".concat(s," not supported"))();break}}class UJ{constructor(t){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,t)}animate(t){if(!this.playing)return;const r=(t/1e3-this.startTime)*this.speed;this.channels.forEach(i=>{let{sampler:n,target:s,path:a}=i;jJ(r,n,s,a),DJ(s,s._node)})}}class GJ{constructor(t){this.animations=t.animations.map((r,i)=>{const n=r.name||"Animation-".concat(i),s=r.samplers.map(o=>{let{input:f,interpolation:m="LINEAR",output:w}=o;return{input:bP(t.accessors[f]),interpolation:m,output:bP(t.accessors[w])}}),a=r.channels.map(o=>{let{sampler:f,target:m}=o;return{sampler:s[f],target:t.nodes[m.node],path:m.path}});return new UJ({name:n,channels:a})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(r=>r.animate(t))}getAnimations(){return this.animations}}class VJ extends qp{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(r),this.onBeforeRender=null,this.AfterRender=null,t instanceof ug?(this.model=t,this._setModelNodeProps(r)):this.model=new ug(t,r),this.bounds=null,this.managedResources=r.managedResources||[]}setProps(t){return super.setProps(t),this._setModelNodeProps(t),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(t=>t.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(t){this.model.setProps(t)}}class D6{constructor(t,r){let{attributes:i,material:n,pbrDebug:s,imageBasedLightingEnvironment:a,lights:o,useTangents:f}=r;this.gl=t,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},_A(t,ln.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],a&&(this.uniforms.u_DiffuseEnvSampler=a.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=a.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=a.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),s&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(i.NORMAL,"HAS_NORMALS"),this.defineIfPresent(i.TANGENT&&f,"HAS_TANGENTS"),this.defineIfPresent(i.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(a,"USE_IBL"),this.defineIfPresent(o,"USE_LIGHTS"),this.defineIfPresent(s,"PBR_DEBUG"),n&&this.parseMaterial(n)}defineIfPresent(t,r){t&&(this.defines[r]=1)}parseTexture(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const n=t.texture&&t.texture.sampler&&t.texture.sampler.parameters||{},s=t.texture.source.image;let a,o={};s.compressed?(a=s,o={[this.gl.TEXTURE_MIN_FILTER]:s.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):a={data:s};const f=new Xa(this.gl,{id:t.name||t.id,parameters:{...n,...o},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...a});this.uniforms[r]=f,this.defineIfPresent(i,i),this.generatedTextures.push(f)}parsePbrMetallicRoughness(t){t.baseColorTexture&&this.parseTexture(t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&this.parseTexture(t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:r=1,roughnessFactor:i=1}=t;this.uniforms.u_MetallicRoughnessValues=[r,i]}parseMaterial(t){if(this.uniforms.pbr_uUnlit=!!t.unlit,t.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(t.pbrMetallicRoughness),t.normalTexture){this.parseTexture(t.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:r=1}=t.normalTexture;this.uniforms.u_NormalScale=r}if(t.occlusionTexture){this.parseTexture(t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:r=1}=t.occlusionTexture;this.uniforms.u_OcclusionStrength=r}if(t.emissiveTexture&&(this.parseTexture(t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode==="MASK"){const{alphaCutoff:r=.5}=t;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=r}else t.alphaMode==="BLEND"&&(hr.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(t=>t.delete())}}const qJ=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,HJ=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function wP(e,t){return ni(e)?`#version 300 es
`.concat(t):t}function WJ(e,t){const{id:r,drawMode:i,vertexCount:n,attributes:s,modelOptions:a}=t,o=new D6(e,t);hr.info(4,"createGLTFModel defines: ",o.defines)();const f=[];f.push(...o.generatedTextures),f.push(...Object.values(s).map(w=>w.buffer));const m=new VJ(e,{id:r,drawMode:i,vertexCount:n,modules:[LA],parameters:o.parameters,vs:wP(e,qJ),fs:wP(e,HJ),managedResources:f,...a,defines:{...o.defines,...a.defines}});return m.setProps({attributes:s}),m.setUniforms(o.uniforms),m}const $J={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ZJ={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class JJ{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.options=Object.assign({},ZJ,r)}instantiate(t){return this.gltf=t,(t.scenes||[]).map(r=>this.createScene(r))}createAnimator(){return Array.isArray(this.gltf.animations)?new GJ(this.gltf):null}createScene(t){const r=(t.nodes||[]).map(i=>this.createNode(i));return new Um({id:t.name||t.id,children:r})}createNode(t){if(!t._node){const r=(t.children||[]).map(n=>this.createNode(n));t.mesh&&r.push(this.createMesh(t.mesh));const i=new Um({id:t.name||t.id,children:r});if(t.matrix)i.setMatrix(t.matrix);else{if(i.matrix.identity(),t.translation&&i.matrix.translate(t.translation),t.rotation){const n=new di().fromQuaternion(t.rotation);i.matrix.multiplyRight(n)}t.scale&&i.matrix.scale(t.scale)}t._node=i}return t._node}createMesh(t){if(!t._mesh){const r=(t.primitives||[]).map((n,s)=>this.createPrimitive(n,s,t)),i=new Um({id:t.name||t.id,children:r});t._mesh=i}return t._mesh}getVertexCount(t){hr.warn("getVertexCount() not found")()}createPrimitive(t,r,i){const n=WJ(this.gl,Object.assign({id:t.name||"".concat(i.name||i.id,"-primitive-").concat(r),drawMode:t.mode||4,vertexCount:t.indices?t.indices.count:this.getVertexCount(t.attributes),attributes:this.createAttributes(t.attributes,t.indices),material:t.material},this.options));return n.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],n}createAttributes(t,r){const i={};return Object.keys(t).forEach(n=>{i[n]=this.createAccessor(t[n],this.createBuffer(t[n],this.gl.ARRAY_BUFFER))}),r&&(i.indices=this.createAccessor(r,this.createBuffer(r,this.gl.ELEMENT_ARRAY_BUFFER))),hr.info(4,"glTF Attributes",{attributes:t,indices:r,generated:i})(),i}createBuffer(t,r){t.bufferView||(t.bufferView={});const{bufferView:i}=t;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[r]||(i.lumaBuffers[r]=new Ki(this.gl,{id:"from-".concat(i.id),data:i.data||t.value,target:r})),i.lumaBuffers[r]}createAccessor(t,r){return new ga({buffer:r,offset:t.byteOffset||0,stride:t.bufferView.byteStride||0,type:t.componentType,size:$J[t.type]})}createSampler(t){return t}needsPOT(){return!1}}function XJ(e,t,r){const i=new JJ(e,r),n=i.instantiate(t),s=i.createAnimator();return{scenes:n,animator:s}}const KJ="3.4.14",YJ="3.4.14",N6="3.4.14",QJ="https://unpkg.com/@loaders.gl/textures@".concat(N6,"/dist/libs/basis_encoder.wasm"),tX="https://unpkg.com/@loaders.gl/textures@".concat(N6,"/dist/libs/basis_encoder.js");let y2;async function xP(e){const t=e.modules||{};return t.basis?t.basis:(y2=y2||eX(e),await y2)}async function eX(e){let t=null,r=null;return[t,r]=await Promise.all([await yf("basis_transcoder.js","textures",e),await yf("basis_transcoder.wasm","textures",e)]),t=t||globalThis.BASIS,await rX(t,r)}function rX(e,t){const r={};return t&&(r.wasmBinary=t),new Promise(i=>{e(r).then(n=>{const{BasisFile:s,initializeBasis:a}=n;a(),i({BasisFile:s})})})}let _2;async function AP(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(_2=_2||iX(e),await _2)}async function iX(e){let t=null,r=null;return[t,r]=await Promise.all([await yf(tX,"textures",e),await yf(QJ,"textures",e)]),t=t||globalThis.BASIS,await nX(t,r)}function nX(e,t){const r={};return t&&(r.wasmBinary=t),new Promise(i=>{e(r).then(n=>{const{BasisFile:s,KTX2File:a,initializeBasis:o,BasisEncoder:f}=n;o(),i({BasisFile:s,KTX2File:a,BasisEncoder:f})})})}const lp={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},sX=["","WEBKIT_","MOZ_"],SP={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let X1=null;function oX(e){if(!X1){e=e||aX()||void 0,X1=new Set;for(const t of sX)for(const r in SP)if(e&&e.getExtension("".concat(t).concat(r))){const i=SP[r];X1.add(i)}}return X1}function aX(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var EP,CP,TP,PP,IP,MP,LP,BP;(function(e){e[e.NONE=0]="NONE",e[e.BASISLZ=1]="BASISLZ",e[e.ZSTD=2]="ZSTD",e[e.ZLIB=3]="ZLIB"})(EP||(EP={})),function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(CP||(CP={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(TP||(TP={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(PP||(PP={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(IP||(IP={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(MP||(MP={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(LP||(LP={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(BP||(BP={}));const za=[171,75,84,88,32,50,48,187,13,10,26,10];function lX(e){const t=new Uint8Array(e);return!(t.byteLength<za.length||t[0]!==za[0]||t[1]!==za[1]||t[2]!==za[2]||t[3]!==za[3]||t[4]!==za[4]||t[5]!==za[5]||t[6]!==za[6]||t[7]!==za[7]||t[8]!==za[8]||t[9]!==za[9]||t[10]!==za[10]||t[11]!==za[11])}const cX={etc1:{basisFormat:0,compressed:!0,format:lp.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:lp.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:lp.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:lp.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:lp.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:lp.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function uX(e,t){if(t.basis.containerFormat==="auto"){if(lX(e)){const i=await AP(t);return kP(i.KTX2File,e,t)}const{BasisFile:r}=await xP(t);return v2(r,e,t)}switch(t.basis.module){case"encoder":const r=await AP(t);switch(t.basis.containerFormat){case"ktx2":return kP(r.KTX2File,e,t);case"basis":default:return v2(r.BasisFile,e,t)}case"transcoder":default:const{BasisFile:i}=await xP(t);return v2(i,e,t)}}function v2(e,t,r){const i=new e(new Uint8Array(t));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const n=i.getNumImages(),s=[];for(let a=0;a<n;a++){const o=i.getNumLevels(a),f=[];for(let m=0;m<o;m++)f.push(hX(i,a,m,r));s.push(f)}return s}finally{i.close(),i.delete()}}function hX(e,t,r,i){const n=e.getImageWidth(t,r),s=e.getImageHeight(t,r),a=e.getHasAlpha(),{compressed:o,format:f,basisFormat:m}=F6(i,a),w=e.getImageTranscodedSizeInBytes(t,r,m),A=new Uint8Array(w);if(!e.transcodeImage(A,t,r,m,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:s,data:A,compressed:o,format:f,hasAlpha:a}}function kP(e,t,r){const i=new e(new Uint8Array(t));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const n=i.getLevels(),s=[];for(let a=0;a<n;a++){s.push(dX(i,a,r));break}return[s]}finally{i.close(),i.delete()}}function dX(e,t,r){const{alphaFlag:i,height:n,width:s}=e.getImageLevelInfo(t,0,0),{compressed:a,format:o,basisFormat:f}=F6(r,i),m=e.getImageTranscodedSizeInBytes(t,0,0,f),w=new Uint8Array(m);if(!e.transcodeImage(w,t,0,0,f,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:n,data:w,compressed:a,levelSize:m,hasAlpha:i,format:o}}function F6(e,t){let r=e&&e.basis&&e.basis.format;return r==="auto"&&(r=z6()),typeof r=="object"&&(r=t?r.alpha:r.noAlpha),r=r.toLowerCase(),cX[r]}function z6(){const e=oX();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}const fX={name:"Basis",id:nh?"basis":"basis-nodejs",module:"textures",version:YJ,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},pX={...fX,parse:uX};function Wa(e,t){if(!e)throw new Error(t||"assert failed: gltf")}function j6(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const r=t.baseUri||t.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url ".concat(e));return r.substr(0,r.lastIndexOf("/")+1)+e}function gX(e,t,r){const i=e.bufferViews[r];Wa(i);const n=i.buffer,s=t[n];Wa(s);const a=(i.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,a,i.byteLength)}const RP=["SCALAR","VEC2","VEC3","VEC4"],mX=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],yX=new Map(mX),_X={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vX={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},bX={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function U6(e){return RP[e-1]||RP[0]}function G6(e){const t=yX.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function YA(e,t){const r=bX[e.componentType],i=_X[e.type],n=vX[e.componentType],s=e.count*i,a=e.count*i*n;return Wa(a>=0&&a<=t.byteLength),{ArrayType:r,length:s,byteLength:a}}function V6(e){let{images:t,bufferViews:r}=e;t=t||[],r=r||[];const i=t.map(a=>a.bufferView);r=r.filter(a=>!i.includes(a));const n=r.reduce((a,o)=>a+o.byteLength,0),s=t.reduce((a,o)=>{const{width:f,height:m}=o.image;return a+f*m},0);return n+Math.ceil(4*s*1.33)}const wX={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class wa{constructor(t){$(this,"gltf",void 0),$(this,"sourceBuffers",void 0),$(this,"byteLength",void 0),this.gltf=t||{json:{...wX},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}getExtension(t){const r=this.getUsedExtensions().find(n=>n===t),i=this.json.extensions||{};return r?i[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find(r=>r===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,r){return(t.extensions||{})[r]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,r){if(typeof r=="object")return r;const i=this.json[t]&&this.json[t][r];if(!i)throw new Error("glTF file error: Could not find ".concat(t,"[").concat(r,"]"));return i}getTypedArrayForBufferView(t){t=this.getBufferView(t);const r=t.buffer,i=this.gltf.buffers[r];Wa(i);const n=(t.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,n,t.byteLength)}getTypedArrayForAccessor(t){t=this.getAccessor(t);const r=this.getBufferView(t.bufferView),i=this.getBuffer(r.buffer).data,{ArrayType:n,length:s}=YA(t,r),a=r.byteOffset+t.byteOffset;return new n(i,a,s)}getTypedArrayForImageData(t){t=this.getAccessor(t);const r=this.getBufferView(t.bufferView),i=this.getBuffer(r.buffer).data,n=r.byteOffset||0;return new Uint8Array(i,n,r.byteLength)}addApplicationData(t,r){return this.json[t]=r,this}addExtraData(t,r){return this.json.extras=this.json.extras||{},this.json.extras[t]=r,this}addObjectExtension(t,r,i){return t.extensions=t.extensions||{},t.extensions[r]=i,this.registerUsedExtension(r),this}setObjectExtension(t,r,i){const n=t.extensions||{};n[r]=i}removeObjectExtension(t,r){const i=t.extensions||{},n=i[r];return delete i[r],n}addExtension(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Wa(r),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=r,this.registerUsedExtension(t),r}addRequiredExtension(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Wa(r),this.addExtension(t,r),this.registerRequiredExtension(t),r}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(r=>r===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(r=>r===t)||this.json.extensionsRequired.push(t)}removeExtension(t){if(!this.getExtension(t))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const r=this.json.extensionsRemoved;r.includes(t)||r.push(t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:r}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:r}),this.json.scenes.length-1}addNode(t){const{meshIndex:r,matrix:i}=t;this.json.nodes=this.json.nodes||[];const n={mesh:r};return i&&(n.matrix=i),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(t){const{attributes:r,indices:i,material:n,mode:s=4}=t,a={primitives:[{attributes:this._addAttributes(r),mode:s}]};if(i){const o=this._addIndices(i);a.primitives[0].indices=o}return Number.isFinite(n)&&(a.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(t){const r={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(t,r){const i=uA(t),n=r||(i==null?void 0:i.mimeType),s={bufferView:this.addBufferView(t),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(t){const r=t.byteLength;Wa(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const i={buffer:0,byteOffset:this.byteLength,byteLength:r};return this.byteLength+=T0(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(t,r){const i={bufferView:t,type:U6(r.size),componentType:r.componentType,count:r.count,max:r.max,min:r.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const i=this.addBufferView(t);let n={min:r.min,max:r.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(t,r.size));const s={size:r.size,componentType:G6(t),count:Math.round(t.length/r.size),min:n.min,max:n.max};return this.addAccessor(i,Object.assign(s,r))}addTexture(t){const{imageIndex:r}=t,i={source:r};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,r;this.gltf.buffers=[];const i=this.byteLength,n=new ArrayBuffer(i),s=new Uint8Array(n);let a=0;for(const o of this.sourceBuffers||[])a=MF(o,s,a);(t=this.json)!==null&&t!==void 0&&(r=t.buffers)!==null&&r!==void 0&&r[0]?this.json.buffers[0].byteLength=i:this.json.buffers=[{byteLength:i}],this.gltf.binary=n,this.sourceBuffers=[n]}_removeStringFromArray(t,r){let i=!0;for(;i;){const n=t.indexOf(r);n>-1?t.splice(n,1):i=!1}}_addAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r={};for(const i in t){const n=t[i],s=this._getGltfAttributeName(i),a=this.addBinaryBuffer(n.value,n);r[s]=a}return r}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,r){const i={min:null,max:null};if(t.length<r)return i;i.min=[],i.max=[];const n=t.subarray(0,r);for(const s of n)i.min.push(s),i.max.push(s);for(let s=r;s<t.length;s+=r)for(let a=0;a<r;a++)i.min[0+a]=Math.min(i.min[0+a],t[s+a]),i.max[0+a]=Math.max(i.max[0+a],t[s+a]);return i}}const xX="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",AX="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",SX=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),EX=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),CX={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},TX={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function PX(e,t,r,i,n){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const a=await IX();BX(a,a.exports[TX[n]],e,t,r,i,a.exports[CX[s||"NONE"]])}let b2;async function IX(){return b2||(b2=MX()),b2}async function MX(){let e=xX;WebAssembly.validate(SX)&&(e=AX,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(LX(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function LX(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;++i){const n=e.charCodeAt(i);t[i]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let r=0;for(let i=0;i<e.length;++i)t[r++]=t[i]<60?EX[t[i]]:(t[i]-60)*64+t[++i];return t.buffer.slice(0,r)}function BX(e,t,r,i,n,s,a){const o=e.exports.sbrk,f=i+3&-4,m=o(f*n),w=o(s.length),A=new Uint8Array(e.exports.memory.buffer);A.set(s,w);const P=t(m,i,n,w,s.length);if(P===0&&a&&a(m,f,n),r.set(A.subarray(m,m+i*n)),o(m-o(0)),P!==0)throw new Error("Malformed buffer data: ".concat(P))}const QA="EXT_meshopt_compression",kX=QA;async function RX(e,t){var r;const i=new wa(e);if(!(t!=null&&(r=t.gltf)!==null&&r!==void 0&&r.decompressMeshes))return;const n=[];for(const s of e.json.bufferViews||[])n.push(OX(i,s));await Promise.all(n),i.removeExtension(QA)}async function OX(e,t){const r=e.getObjectExtension(t,QA);if(r){const{byteOffset:i=0,byteLength:n=0,byteStride:s,count:a,mode:o,filter:f="NONE",buffer:m}=r,w=e.gltf.buffers[m],A=new Uint8Array(w.arrayBuffer,w.byteOffset+i,n),P=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);return await PX(P,a,s,A,o,f),P}return null}const DX=Object.freeze(Object.defineProperty({__proto__:null,decode:RX,name:kX},Symbol.toStringTag,{value:"Module"})),pp="EXT_texture_webp",NX=pp;function FX(e,t){const r=new wa(e);if(!M7("image/webp")){if(r.getRequiredExtensions().includes(pp))throw new Error("gltf: Required extension ".concat(pp," not supported by browser"));return}const{json:i}=r;for(const n of i.textures||[]){const s=r.getObjectExtension(n,pp);s&&(n.source=s.source),r.removeObjectExtension(n,pp)}r.removeExtension(pp)}const zX=Object.freeze(Object.defineProperty({__proto__:null,name:NX,preprocess:FX},Symbol.toStringTag,{value:"Module"})),Ty="KHR_texture_basisu",jX=Ty;function UX(e,t){const r=new wa(e),{json:i}=r;for(const n of i.textures||[]){const s=r.getObjectExtension(n,Ty);s&&(n.source=s.source),r.removeObjectExtension(n,Ty)}r.removeExtension(Ty)}const GX=Object.freeze(Object.defineProperty({__proto__:null,name:jX,preprocess:UX},Symbol.toStringTag,{value:"Module"})),VX="3.4.14",qX={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},HX={name:"Draco",id:nh?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:VX,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:qX};function WX(e,t,r){const i=q6(t.metadata),n=[],s=$X(t.attributes);for(const a in e){const o=e[a],f=OP(a,o,s[a]);n.push(f)}if(r){const a=OP("indices",r);n.push(a)}return new Bp(n,i)}function $X(e){const t={};for(const r in e){const i=e[r];t[i.name||"undefined"]=i}return t}function OP(e,t,r){const i=r?q6(r.metadata):void 0;return IJ(e,t,i)}function q6(e){const t=new Map;for(const r in e)t.set("".concat(r,".string"),JSON.stringify(e[r]));return t}const DP={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},ZX={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},JX=4;class XX{constructor(t){$(this,"draco",void 0),$(this,"decoder",void 0),$(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(r);const n=this.decoder.GetEncodedGeometryType(i),s=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let a;switch(n){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(i,s);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(i,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!s.ptr){const A="DRACO decompression failed: ".concat(a.error_msg());throw new Error(A)}const o=this._getDracoLoaderData(s,n,r),f=this._getMeshData(s,o,r),m=M6(f.attributes),w=WX(f.attributes,o,f.indices);return{loader:"draco",loaderData:o,header:{vertexCount:s.num_points(),boundingBox:m},...f,schema:w}}finally{this.draco.destroy(i),s&&this.draco.destroy(s)}}_getDracoLoaderData(t,r,i){const n=this._getTopLevelMetadata(t),s=this._getDracoAttributes(t,i);return{geometry_type:r,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:n,attributes:s}}_getDracoAttributes(t,r){const i={};for(let n=0;n<t.num_attributes();n++){const s=this.decoder.GetAttribute(t,n),a=this._getAttributeMetadata(t,n);i[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:n,metadata:a};const o=this._getQuantizationTransform(s,r);o&&(i[s.unique_id()].quantization_transform=o);const f=this._getOctahedronTransform(s,r);f&&(i[s.unique_id()].octahedron_transform=f)}return i}_getMeshData(t,r,i){const n=this._getMeshAttributes(r,t,i);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(t,r,i){const n={};for(const s of Object.values(t.attributes)){const a=this._deduceAttributeName(s,i);s.name=a;const{value:o,size:f}=this._getAttributeValues(r,s);n[a]={value:o,size:f,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}return n}_getTriangleListIndices(t){const r=t.num_faces()*3,i=r*JX,n=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(t,i,n),new Uint32Array(this.draco.HEAPF32.buffer,n,r).slice()}finally{this.draco._free(n)}}_getTriangleStripIndices(t){const r=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,r),QX(r)}finally{this.draco.destroy(r)}}_getAttributeValues(t,r){const i=ZX[r.data_type],n=r.num_components,s=t.num_points()*n,a=s*i.BYTES_PER_ELEMENT,o=KX(this.draco,i);let f;const m=this.draco._malloc(a);try{const w=this.decoder.GetAttribute(t,r.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,w,o,a,m),f=new i(this.draco.HEAPF32.buffer,m,s).slice()}finally{this.draco._free(m)}return{value:f,size:n}}_deduceAttributeName(t,r){const i=t.unique_id;for(const[a,o]of Object.entries(r.extraAttributes||{}))if(o===i)return a;const n=t.attribute_type;for(const a in DP)if(this.draco[a]===n)return DP[a];const s=r.attributeNameEntry||"name";return t.metadata[s]?t.metadata[s].string:"CUSTOM_ATTRIBUTE_".concat(i)}_getTopLevelMetadata(t){const r=this.decoder.GetMetadata(t);return this._getDracoMetadata(r)}_getAttributeMetadata(t,r){const i=this.decoder.GetAttributeMetadata(t,r);return this._getDracoMetadata(i)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const r={},i=this.metadataQuerier.NumEntries(t);for(let n=0;n<i;n++){const s=this.metadataQuerier.GetEntryName(t,n);r[s]=this._getDracoMetadataField(t,s)}return r}_getDracoMetadataField(t,r){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,r,i);const n=YX(i);return{int:this.metadataQuerier.GetIntEntry(t,r),string:this.metadataQuerier.GetStringEntry(t,r),double:this.metadataQuerier.GetDoubleEntry(t,r),intArray:n}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(t){const{quantizedAttributes:r=[],octahedronAttributes:i=[]}=t,n=[...r,...i];for(const s of n)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(t,r){const{quantizedAttributes:i=[]}=r,n=t.attribute_type();if(i.map(s=>this.decoder[s]).includes(n)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(t))return{quantization_bits:s.quantization_bits(),range:s.range(),min_values:new Float32Array([1,2,3]).map(a=>s.min_value(a))}}finally{this.draco.destroy(s)}}return null}_getOctahedronTransform(t,r){const{octahedronAttributes:i=[]}=r,n=t.attribute_type();if(i.map(s=>this.decoder[s]).includes(n)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(t))return{quantization_bits:s.quantization_bits()}}finally{this.draco.destroy(s)}}return null}}function KX(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}function YX(e){const t=e.size(),r=new Int32Array(t);for(let i=0;i<t;i++)r[i]=e.GetValue(i);return r}function QX(e){const t=e.size(),r=new Int32Array(t);for(let i=0;i<t;i++)r[i]=e.GetValue(i);return r}const tK="1.5.5",tS="https://www.gstatic.com/draco/versioned/decoders/".concat(tK),eK="".concat(tS,"/draco_decoder.js"),rK="".concat(tS,"/draco_wasm_wrapper.js"),iK="".concat(tS,"/draco_decoder.wasm");let lm;async function nK(e){const t=e.modules||{};return t.draco3d?lm=lm||t.draco3d.createDecoderModule({}).then(r=>({draco:r})):lm=lm||sK(e),await lm}async function sK(e){let t,r;switch(e.draco&&e.draco.decoderType){case"js":t=await yf(eK,"draco",e);break;case"wasm":default:[t,r]=await Promise.all([await yf(rK,"draco",e),await yf(iK,"draco",e)])}return t=t||globalThis.DracoDecoderModule,await oK(t,r)}function oK(e,t){const r={};return t&&(r.wasmBinary=t),new Promise(i=>{e({...r,onModuleLoaded:n=>i({draco:n})})})}const H6={...HX,parse:aK};async function aK(e,t){const{draco:r}=await nK(t),i=new XX(r);try{return i.parseSync(e,t==null?void 0:t.draco)}finally{i.destroy()}}function lK(e){const t={};for(const r in e){const i=e[r];if(r!=="indices"){const n=W6(i);t[r]=n}}return t}function W6(e){const{buffer:t,size:r,count:i}=cK(e);return{value:t,size:r,byteOffset:0,count:i,type:U6(r),componentType:G6(t)}}function cK(e){let t=e,r=1,i=0;return e&&e.value&&(t=e.value,r=e.size||1),t&&(ArrayBuffer.isView(t)||(t=uK(t,Float32Array)),i=t.length/r),{buffer:t,size:r,count:i}}function uK(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return e?Array.isArray(e)?new t(e):r&&!(e instanceof t)?new t(e):e:null}const Pf="KHR_draco_mesh_compression",hK=Pf;function dK(e,t,r){const i=new wa(e);for(const n of $6(i))i.getObjectExtension(n,Pf)}async function fK(e,t,r){var i;if(!(t!=null&&(i=t.gltf)!==null&&i!==void 0&&i.decompressMeshes))return;const n=new wa(e),s=[];for(const a of $6(n))n.getObjectExtension(a,Pf)&&s.push(gK(n,a,t,r));await Promise.all(s),n.removeExtension(Pf)}function pK(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new wa(e);for(const i of r.json.meshes||[])mK(i,t),r.addRequiredExtension(Pf)}async function gK(e,t,r,i){const n=e.getObjectExtension(t,Pf);if(!n)return;const s=e.getTypedArrayForBufferView(n.bufferView),a=eA(s.buffer,s.byteOffset),{parse:o}=i,f={...r};delete f["3d-tiles"];const m=await o(a,H6,f,i),w=lK(m.attributes);for(const[A,P]of Object.entries(w))if(A in t.attributes){const I=t.attributes[A],N=e.getAccessor(I);N!=null&&N.min&&N!==null&&N!==void 0&&N.max&&(P.min=N.min,P.max=N.max)}t.attributes=w,m.indices&&(t.indices=W6(m.indices)),yK(t)}function mK(e,t){var r;let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,n=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const a=n.DracoWriter.encodeSync({attributes:e}),o=s==null||(r=s.parseSync)===null||r===void 0?void 0:r.call(s,{attributes:e}),f=n._addFauxAttributes(o.attributes),m=n.addBufferView(a);return{primitives:[{attributes:f,mode:i,extensions:{[Pf]:{bufferView:m,attributes:f}}}]}}function yK(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*$6(e){for(const t of e.json.meshes||[])for(const r of t.primitives)yield r}const _K=Object.freeze(Object.defineProperty({__proto__:null,decode:fK,encode:pK,name:hK,preprocess:dK},Symbol.toStringTag,{value:"Module"})),vK={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bK={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},eS="KHR_texture_transform",wK=eS,K1=new se,xK=new $n,AK=new $n;async function SK(e,t){if(!new wa(e).getExtension(eS))return;const r=e.json.materials||[];for(let i=0;i<r.length;i++)EK(i,e)}function EK(e,t){var r,i,n;const s=[],a=(r=t.json.materials)===null||r===void 0?void 0:r[e],o=a==null||(i=a.pbrMetallicRoughness)===null||i===void 0?void 0:i.baseColorTexture;o&&cm(t,e,o,s);const f=a==null?void 0:a.emissiveTexture;f&&cm(t,e,f,s);const m=a==null?void 0:a.normalTexture;m&&cm(t,e,m,s);const w=a==null?void 0:a.occlusionTexture;w&&cm(t,e,w,s);const A=a==null||(n=a.pbrMetallicRoughness)===null||n===void 0?void 0:n.metallicRoughnessTexture;A&&cm(t,e,A,s)}function cm(e,t,r,i){const n=CK(r,i);if(!n)return;const s=e.json.meshes||[];for(const a of s)for(const o of a.primitives){const f=o.material;Number.isFinite(f)&&t===f&&TK(e,o,n)}}function CK(e,t){var r;const i=(r=e.extensions)===null||r===void 0?void 0:r[eS],{texCoord:n=0}=e,{texCoord:s=n}=i;if(t.findIndex(a=>{let[o,f]=a;return o===n&&f===s})===-1){const a=MK(i);return n!==s&&(e.texCoord=s),t.push([n,s]),{originalTexCoord:n,texCoord:s,matrix:a}}return null}function TK(e,t,r){const{originalTexCoord:i,texCoord:n,matrix:s}=r,a=t.attributes["TEXCOORD_".concat(i)];if(Number.isFinite(a)){var o;const m=(o=e.json.accessors)===null||o===void 0?void 0:o[a];if(m&&m.bufferView){var f;const w=(f=e.json.bufferViews)===null||f===void 0?void 0:f[m.bufferView];if(w){const{arrayBuffer:A,byteOffset:P}=e.buffers[w.buffer],I=(P||0)+(m.byteOffset||0)+(w.byteOffset||0),{ArrayType:N,length:F}=YA(m,w),Z=bK[m.componentType],U=vK[m.type],z=w.byteStride||Z*U,J=new Float32Array(F);for(let nt=0;nt<m.count;nt++){const mt=new N(A,I+nt*z,2);K1.set(mt[0],mt[1],1),K1.transformByMatrix3(s),J.set([K1[0],K1[1]],nt*U)}i===n?PK(m,w,e.buffers,J):IK(n,m,t,e,J)}}}}function PK(e,t,r,i){e.componentType=5126,r.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),t.buffer=r.length-1,t.byteLength=i.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function IK(e,t,r,i,n){i.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});const s=i.json.bufferViews;if(!s)return;s.push({buffer:i.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});const a=i.json.accessors;a&&(a.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),r.attributes["TEXCOORD_".concat(e)]=a.length-1)}function MK(e){const{offset:t=[0,0],rotation:r=0,scale:i=[1,1]}=e,n=new $n().set(1,0,0,0,1,0,t[0],t[1],1),s=xK.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),a=AK.set(i[0],0,0,0,i[1],0,0,0,1);return n.multiplyRight(s).multiplyRight(a)}const LK=Object.freeze(Object.defineProperty({__proto__:null,decode:SK,name:wK},Symbol.toStringTag,{value:"Module"})),df="KHR_lights_punctual",BK=df;async function kK(e){const t=new wa(e),{json:r}=t,i=t.getExtension(df);i&&(t.json.lights=i.lights,t.removeExtension(df));for(const n of r.nodes||[]){const s=t.getObjectExtension(n,df);s&&(n.light=s.light),t.removeObjectExtension(n,df)}}async function RK(e){const t=new wa(e),{json:r}=t;if(r.lights){const i=t.addExtension(df);Wa(!i.lights),i.lights=r.lights,delete r.lights}if(t.json.lights){for(const i of t.json.lights){const n=i.node;t.addObjectExtension(n,df,i)}delete t.json.lights}}const OK=Object.freeze(Object.defineProperty({__proto__:null,decode:kK,encode:RK,name:BK},Symbol.toStringTag,{value:"Module"})),g0="KHR_materials_unlit",DK=g0;async function NK(e){const t=new wa(e),{json:r}=t;for(const i of r.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),t.removeObjectExtension(i,g0);t.removeExtension(g0)}function FK(e){const t=new wa(e),{json:r}=t;if(t.materials)for(const i of r.materials||[])i.unlit&&(delete i.unlit,t.addObjectExtension(i,g0,{}),t.addExtension(g0))}const zK=Object.freeze(Object.defineProperty({__proto__:null,decode:NK,encode:FK,name:DK},Symbol.toStringTag,{value:"Module"})),Am="KHR_techniques_webgl",jK=Am;async function UK(e){const t=new wa(e),{json:r}=t,i=t.getExtension(Am);if(i){const n=VK(i,t);for(const s of r.materials||[]){const a=t.getObjectExtension(s,Am);a&&(s.technique=Object.assign({},a,n[a.technique]),s.technique.values=qK(s.technique,t)),t.removeObjectExtension(s,Am)}t.removeExtension(Am)}}async function GK(e,t){}function VK(e,t){const{programs:r=[],shaders:i=[],techniques:n=[]}=e,s=new TextDecoder;return i.forEach(a=>{if(Number.isFinite(a.bufferView))a.code=s.decode(t.getTypedArrayForBufferView(a.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(a=>{a.fragmentShader=i[a.fragmentShader],a.vertexShader=i[a.vertexShader]}),n.forEach(a=>{a.program=r[a.program]}),n}function qK(e,t){const r=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(i=>{e.uniforms[i].value&&!(i in r)&&(r[i]=e.uniforms[i].value)}),Object.keys(r).forEach(i=>{typeof r[i]=="object"&&r[i].index!==void 0&&(r[i].texture=t.getTexture(r[i].index))}),r}const HK=Object.freeze(Object.defineProperty({__proto__:null,decode:UK,encode:GK,name:jK},Symbol.toStringTag,{value:"Module"})),Z6="EXT_feature_metadata",WK=Z6;async function $K(e){const t=new wa(e);ZK(t)}function ZK(e){var t;const r=e.getExtension(Z6),i=r==null||(t=r.schema)===null||t===void 0?void 0:t.classes,n=r==null?void 0:r.featureTables;if(r!=null&&r.featureTextures&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),i&&n)for(const s in i){const a=i[s],o=KK(n,s);o&&JK(e,o,a)}}function JK(e,t,r){for(const n in r.properties){var i;const s=r.properties[n],a=t==null||(i=t.properties)===null||i===void 0?void 0:i[n],o=t.count;if(a){const f=XK(e,s,o,a);a.data=f}}}function XK(e,t,r,i){const n=i.bufferView;let s=e.getTypedArrayForBufferView(n);switch(t.type){case"STRING":{const a=i.stringOffsetBufferView,o=e.getTypedArrayForBufferView(a);s=YK(s,o,r);break}}return s}function KK(e,t){for(const r in e){const i=e[r];if(i.class===t)return i}return null}function YK(e,t,r){const i=[],n=new TextDecoder("utf8");let s=0;const a=4;for(let o=0;o<r;o++){const f=t[(o+1)*a]-t[o*a],m=e.subarray(s,f+s),w=n.decode(m);i.push(w),s+=f}return i}const QK=Object.freeze(Object.defineProperty({__proto__:null,decode:$K,name:WK},Symbol.toStringTag,{value:"Module"})),J6=[DX,zX,GX,_K,OK,zK,HK,LK,QK];function tY(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;const i=J6.filter(s=>X6(s.name,t));for(const s of i){var n;(n=s.preprocess)===null||n===void 0||n.call(s,e,t,r)}}async function eY(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;const i=J6.filter(s=>X6(s.name,t));for(const s of i){var n;await((n=s.decode)===null||n===void 0?void 0:n.call(s,e,t,r))}}function X6(e,t){var r;const i=(t==null||(r=t.gltf)===null||r===void 0?void 0:r.excludeExtensions)||{};return!(e in i&&!i[e])}const w2="KHR_binary_glTF";function rY(e){const t=new wa(e),{json:r}=t;for(const i of r.images||[]){const n=t.getObjectExtension(i,w2);n&&Object.assign(i,n),t.removeObjectExtension(i,w2)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,t.removeExtension(w2)}const NP={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},iY={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class nY{constructor(){$(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),$(this,"json",void 0)}normalize(t,r){this.json=t.json;const i=t.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(i.asset.version));return}if(!r.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),rY(t),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const r in NP)this._convertTopLevelObjectToArray(t,r)}_convertTopLevelObjectToArray(t,r){const i=t[r];if(!(!i||Array.isArray(i))){t[r]=[];for(const n in i){const s=i[n];s.id=s.id||n;const a=t[r].length;t[r].push(s),this.idToIndexMap[r][n]=a}}}_convertObjectIdsToArrayIndices(t){for(const r in NP)this._convertIdsToIndices(t,r);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const r of t.textures)this._convertTextureIds(r);for(const r of t.meshes)this._convertMeshIds(r);for(const r of t.nodes)this._convertNodeIds(r);for(const r of t.scenes)this._convertSceneIds(r)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const r of t.primitives){const{attributes:i,indices:n,material:s}=r;for(const a in i)i[a]=this._convertIdToIndex(i[a],"accessor");n&&(r.indices=this._convertIdToIndex(n,"accessor")),s&&(r.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(r=>this._convertIdToIndex(r,"node"))),t.meshes&&(t.meshes=t.meshes.map(r=>this._convertIdToIndex(r,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(r=>this._convertIdToIndex(r,"node")))}_convertIdsToIndices(t,r){t[r]||(console.warn("gltf v1: json doesn't contain attribute ".concat(r)),t[r]=[]);for(const i of t[r])for(const n in i){const s=i[n],a=this._convertIdToIndex(s,n);i[n]=a}}_convertIdToIndex(t,r){const i=iY[r];if(i in this.idToIndexMap){const n=this.idToIndexMap[i][t];if(!Number.isFinite(n))throw new Error("gltf v1: failed to resolve ".concat(r," with id ").concat(t));return n}return t}_updateObjects(t){for(const r of this.json.buffers)delete r.type}_updateMaterial(t){for(const s of t.materials){var r,i,n;s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const a=((r=s.values)===null||r===void 0?void 0:r.tex)||((i=s.values)===null||i===void 0?void 0:i.texture2d_0)||((n=s.values)===null||n===void 0?void 0:n.diffuseTex),o=t.textures.findIndex(f=>f.id===a);o!==-1&&(s.pbrMetallicRoughness.baseColorTexture={index:o})}}}function sY(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new nY().normalize(e,t)}const oY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},aY={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Al={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},lY={magFilter:Al.TEXTURE_MAG_FILTER,minFilter:Al.TEXTURE_MIN_FILTER,wrapS:Al.TEXTURE_WRAP_S,wrapT:Al.TEXTURE_WRAP_T},cY={[Al.TEXTURE_MAG_FILTER]:Al.LINEAR,[Al.TEXTURE_MIN_FILTER]:Al.NEAREST_MIPMAP_LINEAR,[Al.TEXTURE_WRAP_S]:Al.REPEAT,[Al.TEXTURE_WRAP_T]:Al.REPEAT};function uY(e){return aY[e]}function hY(e){return oY[e]}class dY{constructor(){$(this,"baseUri",""),$(this,"json",{}),$(this,"buffers",[]),$(this,"images",[])}postProcess(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:i,buffers:n=[],images:s=[],baseUri:a=""}=t;return Wa(i),this.baseUri=a,this.json=i,this.buffers=n,this.images=s,this._resolveTree(this.json,r),this.json}_resolveTree(t){t.bufferViews&&(t.bufferViews=t.bufferViews.map((r,i)=>this._resolveBufferView(r,i))),t.images&&(t.images=t.images.map((r,i)=>this._resolveImage(r,i))),t.samplers&&(t.samplers=t.samplers.map((r,i)=>this._resolveSampler(r,i))),t.textures&&(t.textures=t.textures.map((r,i)=>this._resolveTexture(r,i))),t.accessors&&(t.accessors=t.accessors.map((r,i)=>this._resolveAccessor(r,i))),t.materials&&(t.materials=t.materials.map((r,i)=>this._resolveMaterial(r,i))),t.meshes&&(t.meshes=t.meshes.map((r,i)=>this._resolveMesh(r,i))),t.nodes&&(t.nodes=t.nodes.map((r,i)=>this._resolveNode(r,i))),t.skins&&(t.skins=t.skins.map((r,i)=>this._resolveSkin(r,i))),t.scenes&&(t.scenes=t.scenes.map((r,i)=>this._resolveScene(r,i))),t.scene!==void 0&&(t.scene=t.scenes[this.json.scene])}getScene(t){return this._get("scenes",t)}getNode(t){return this._get("nodes",t)}getSkin(t){return this._get("skins",t)}getMesh(t){return this._get("meshes",t)}getMaterial(t){return this._get("materials",t)}getAccessor(t){return this._get("accessors",t)}getCamera(t){return null}getTexture(t){return this._get("textures",t)}getSampler(t){return this._get("samplers",t)}getImage(t){return this._get("images",t)}getBufferView(t){return this._get("bufferViews",t)}getBuffer(t){return this._get("buffers",t)}_get(t,r){if(typeof r=="object")return r;const i=this.json[t]&&this.json[t][r];return i||console.warn("glTF file error: Could not find ".concat(t,"[").concat(r,"]")),i}_resolveScene(t,r){return t.id=t.id||"scene-".concat(r),t.nodes=(t.nodes||[]).map(i=>this.getNode(i)),t}_resolveNode(t,r){return t.id=t.id||"node-".concat(r),t.children&&(t.children=t.children.map(i=>this.getNode(i))),t.mesh!==void 0?t.mesh=this.getMesh(t.mesh):t.meshes!==void 0&&t.meshes.length&&(t.mesh=t.meshes.reduce((i,n)=>{const s=this.getMesh(n);return i.id=s.id,i.primitives=i.primitives.concat(s.primitives),i},{primitives:[]})),t.camera!==void 0&&(t.camera=this.getCamera(t.camera)),t.skin!==void 0&&(t.skin=this.getSkin(t.skin)),t}_resolveSkin(t,r){return t.id=t.id||"skin-".concat(r),t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}_resolveMesh(t,r){return t.id=t.id||"mesh-".concat(r),t.primitives&&(t.primitives=t.primitives.map(i=>{i={...i};const n=i.attributes;i.attributes={};for(const s in n)i.attributes[s]=this.getAccessor(n[s]);return i.indices!==void 0&&(i.indices=this.getAccessor(i.indices)),i.material!==void 0&&(i.material=this.getMaterial(i.material)),i})),t}_resolveMaterial(t,r){if(t.id=t.id||"material-".concat(r),t.normalTexture&&(t.normalTexture={...t.normalTexture},t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture={...t.occlustionTexture},t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture={...t.emmisiveTexture},t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.emissiveFactor||(t.emissiveFactor=t.emmisiveTexture?[1,1,1]:[0,0,0]),t.pbrMetallicRoughness){t.pbrMetallicRoughness={...t.pbrMetallicRoughness};const i=t.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return t}_resolveAccessor(t,r){if(t.id=t.id||"accessor-".concat(r),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=uY(t.componentType),t.components=hY(t.type),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){const i=t.bufferView.buffer,{ArrayType:n,byteLength:s}=YA(t,t.bufferView),a=(t.bufferView.byteOffset||0)+(t.byteOffset||0)+i.byteOffset;let o=i.arrayBuffer.slice(a,a+s);t.bufferView.byteStride&&(o=this._getValueFromInterleavedBuffer(i,a,t.bufferView.byteStride,t.bytesPerElement,t.count)),t.value=new n(o)}return t}_getValueFromInterleavedBuffer(t,r,i,n,s){const a=new Uint8Array(s*n);for(let o=0;o<s;o++){const f=r+o*i;a.set(new Uint8Array(t.arrayBuffer.slice(f,f+n)),o*n)}return a.buffer}_resolveTexture(t,r){return t.id=t.id||"texture-".concat(r),t.sampler="sampler"in t?this.getSampler(t.sampler):cY,t.source=this.getImage(t.source),t}_resolveSampler(t,r){t.id=t.id||"sampler-".concat(r),t.parameters={};for(const i in t){const n=this._enumSamplerParameter(i);n!==void 0&&(t.parameters[n]=t[i])}return t}_enumSamplerParameter(t){return lY[t]}_resolveImage(t,r){t.id=t.id||"image-".concat(r),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView));const i=this.images[r];return i&&(t.image=i),t}_resolveBufferView(t,r){const i=t.buffer,n={id:"bufferView-".concat(r),...t,buffer:this.buffers[i]},s=this.buffers[i].arrayBuffer;let a=this.buffers[i].byteOffset||0;return"byteOffset"in t&&(a+=t.byteOffset),n.data=new Uint8Array(s,a,t.byteLength),n}_resolveCamera(t,r){return t.id=t.id||"camera-".concat(r),t.perspective,t.orthographic,t}}function fY(e,t){return new dY().postProcess(e,t)}const FP=1735152710,rS=12,M_=8,pY=1313821514,gY=5130562,mY=0,yY=1,_Y=0,fg=!0;function vY(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}function bY(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=new DataView(e),{magic:n=FP}=r,s=i.getUint32(t,!1);return s===n||s===FP}function wY(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=new DataView(t),n=vY(i,r+0),s=i.getUint32(r+4,fg),a=i.getUint32(r+8,fg);switch(Object.assign(e,{header:{byteOffset:r,byteLength:a,hasBinChunk:!1},type:n,version:s,json:{},binChunks:[]}),r+=rS,e.version){case 1:return xY(e,i,r);case 2:return AY(e,i,r,{});default:throw new Error("Invalid GLB version ".concat(e.version,". Only supports v1 and v2."))}}function xY(e,t,r){sn(e.header.byteLength>rS+M_);const i=t.getUint32(r+0,fg),n=t.getUint32(r+4,fg);return r+=M_,sn(n===_Y),Cx(e,t,r,i),r+=i,r+=Tx(e,t,r,e.header.byteLength),r}function AY(e,t,r,i){return sn(e.header.byteLength>rS+M_),SY(e,t,r,i),r+e.header.byteLength}function SY(e,t,r,i){for(;r+8<=e.header.byteLength;){const n=t.getUint32(r+0,fg),s=t.getUint32(r+4,fg);switch(r+=M_,s){case pY:Cx(e,t,r,n);break;case gY:Tx(e,t,r,n);break;case mY:i.strict||Cx(e,t,r,n);break;case yY:i.strict||Tx(e,t,r,n);break}r+=T0(n,4)}return r}function Cx(e,t,r,i){const n=new Uint8Array(t.buffer,r,i),s=new TextDecoder("utf8").decode(n);return e.json=JSON.parse(s),T0(i,4)}function Tx(e,t,r,i){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:r,byteLength:i,arrayBuffer:t.buffer}),T0(i,4)}async function EY(e,t){var r,i,n,s;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,f=arguments.length>4?arguments[4]:void 0;CY(e,t,a,o),sY(e,{normalize:o==null||(r=o.gltf)===null||r===void 0?void 0:r.normalize}),tY(e,o,f);const m=[];if(o!=null&&(i=o.gltf)!==null&&i!==void 0&&i.loadBuffers&&e.json.buffers&&await TY(e,o,f),o!=null&&(n=o.gltf)!==null&&n!==void 0&&n.loadImages){const A=PY(e,o,f);m.push(A)}const w=eY(e,o,f);return m.push(w),await Promise.all(m),o!=null&&(s=o.gltf)!==null&&s!==void 0&&s.postProcess?fY(e,o):e}function CY(e,t,r,i){if(i.uri&&(e.baseUri=i.uri),t instanceof ArrayBuffer&&!bY(t,r,i)&&(t=new TextDecoder().decode(t)),typeof t=="string")e.json=TF(t);else if(t instanceof ArrayBuffer){const a={};r=wY(a,t,r,i.glb),Wa(a.type==="glTF","Invalid GLB magic string ".concat(a.type)),e._glb=a,e.json=a.json}else Wa(!1,"GLTF: must be ArrayBuffer or string");const n=e.json.buffers||[];if(e.buffers=new Array(n.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:a}=e._glb;e.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}const s=e.json.images||[];e.images=new Array(s.length).fill({})}async function TY(e,t,r){const i=e.json.buffers||[];for(let a=0;a<i.length;++a){const o=i[a];if(o.uri){var n,s;const{fetch:f}=r;Wa(f);const m=j6(o.uri,t),w=await(r==null||(n=r.fetch)===null||n===void 0?void 0:n.call(r,m)),A=await(w==null||(s=w.arrayBuffer)===null||s===void 0?void 0:s.call(w));e.buffers[a]={arrayBuffer:A,byteOffset:0,byteLength:A.byteLength},delete o.uri}else e.buffers[a]===null&&(e.buffers[a]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function PY(e,t,r){const i=IY(e),n=e.json.images||[],s=[];for(const a of i)s.push(MY(e,n[a],a,t,r));return await Promise.all(s)}function IY(e){const t=new Set,r=e.json.textures||[];for(const i of r)i.source!==void 0&&t.add(i.source);return Array.from(t).sort()}async function MY(e,t,r,i,n){const{fetch:s,parse:a}=n;let o;if(t.uri&&!t.hasOwnProperty("bufferView")){const m=j6(t.uri,i);o=await(await s(m)).arrayBuffer(),t.bufferView={data:o}}if(Number.isFinite(t.bufferView)){const m=gX(e.json,e.buffers,t.bufferView);o=eA(m.buffer,m.byteOffset,m.byteLength)}Wa(o,"glTF image has no data");let f=await a(o,[ZL,pX],{mimeType:t.mimeType,basis:i.basis||{format:z6()}},n);f&&f[0]&&(f={compressed:!0,mipmaps:!1,width:f[0].width,height:f[0].height,data:f[0]}),e.images=e.images||[],e.images[r]=f}const m0={name:"glTF",id:"gltf",module:"gltf",version:KJ,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:LY,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function LY(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;t={...m0.options,...t},t.gltf={...m0.options.gltf,...t.gltf};const{byteOffset:i=0}=t;return await EY({},e,i,t,r)}async function BY(e){const t=[];return e.scenes.forEach(r=>{r.traverse(i=>{Object.values(i.model.getUniforms()).forEach(n=>{n.loaded===!1&&t.push(n)})})}),await kY(()=>t.some(r=>!r.loaded))}async function kY(e){for(;e();)await new Promise(t=>requestAnimationFrame(t))}const RY=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,OY=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,K6=[255,255,255,255],DY={scenegraph:{type:"object",value:null,async:!0},getScene:e=>e&&e.scenes?typeof e.scene=="object"?e.scene:e.scenes[e.scene||0]:e,getAnimator:e=>e&&e.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:K6},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[m0]};class iS extends xg{constructor(){super(...arguments),$(this,"state",void 0)}getShaders(){const t=[FA,zA];return this.props._lighting==="pbr"&&t.push(LA),super.getShaders({vs:RY,fs:OY,modules:t})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:K6,transition:!0},instanceModelMatrix:P6})}updateState(t){super.updateState(t);const{props:r,oldProps:i}=t;r.scenegraph!==i.scenegraph?this._updateScenegraph():r._animations!==i._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,r._animations)}finalizeState(t){super.finalizeState(t),this._deleteScenegraph()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.scenegraph)&&super.isLoaded}_updateScenegraph(){const t=this.props,{gl:r}=this.context;let i=null;if(t.scenegraph instanceof qp)i={scenes:[t.scenegraph]};else if(t.scenegraph&&!t.scenegraph.gltf){const o=t.scenegraph,f=XJ(r,o,this._getModelOptions());i={gltf:o,...f},BY(f).then(()=>this.setNeedsRedraw())}else t.scenegraph&&(xi.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),i=t.scenegraph);const n={layer:this,gl:r},s=t.getScene(i,n),a=t.getAnimator(i,n);s instanceof qp?(this._deleteScenegraph(),this._applyAllAttributes(s),this._applyAnimationsProp(s,a,t._animations),this.setState({scenegraph:s,animator:a})):s!==null&&xi.warn("invalid scenegraph:",s)()}_applyAllAttributes(t){if(this.state.attributesAvailable){const r=this.getAttributeManager().getAttributes();t.traverse(i=>{this._setModelAttributes(i.model,r)})}}_applyAnimationsProp(t,r,i){if(!t||!r||!i)return;const n=r.getAnimations();Object.keys(i).sort().forEach(s=>{const a=i[s];if(s==="*")n.forEach(o=>{Object.assign(o,a)});else if(Number.isFinite(Number(s))){const o=Number(s);o>=0&&o<n.length?Object.assign(n[o],a):xi.warn("animation ".concat(s," not found"))()}else{const o=n.find(f=>{let{name:m}=f;return m===s});o?Object.assign(o,a):xi.warn("animation ".concat(s," not found"))()}})}_deleteScenegraph(){const{scenegraph:t}=this.state;t instanceof qp&&t.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let r=null;return t&&(typeof t=="function"?r=t({gl:this.context.gl,layer:this}):r=t),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:r,modelOptions:{isInstanced:!0,transpileToGLSL100:!ni(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(t){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(r=>{this._setModelAttributes(r.model,t)})}draw(t){let{moduleParameters:r=null,parameters:i={},context:n}=t;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(n.timeline.getTime()),this.setNeedsRedraw());const{viewport:s}=this.context,{sizeScale:a,sizeMinPixels:o,sizeMaxPixels:f,opacity:m,coordinateSystem:w}=this.props,A=this.getNumInstances();this.state.scenegraph.traverse((P,I)=>{let{worldMatrix:N}=I;P.model.setInstanceCount(A),P.updateModuleSettings(r),P.draw({parameters:i,uniforms:{sizeScale:a,opacity:m,sizeMinPixels:o,sizeMaxPixels:f,composeModelMatrix:I6(s,w),sceneModelMatrix:N,u_Camera:P.model.getUniforms().project_uCameraPosition}})})}}$(iS,"defaultProps",DY);$(iS,"layerName","ScenegraphLayer");const NY=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,FY=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function zY(e){e.COLOR_0||e.colors||(e.colors={constant:!0,value:new Float32Array([1,1,1])})}const jY={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class nS extends KA{getShaders(){const t=super.getShaders();return t.modules.push(LA),{...t,vs:NY,fs:FY}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const r=this.getAttributeManager();t&&r.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:r,oldProps:i}=t;r.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(r.pbrMaterial)}draw(t){const{featureIds:r}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!r}),super.draw(t))}getModel(t){const{id:r,pbrMaterial:i}=this.props,n=this.parseMaterial(i,t);this.setState({materialParser:n});const s=this.getShaders();return zY(t.attributes),new ug(this.context.gl,{...this.getShaders(),id:r,geometry:t,defines:{...s.defines,...n==null?void 0:n.defines,HAS_UV_REGIONS:t.attributes.uvRegions},parameters:n==null?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:r}=this.state;if(r){const{mesh:i}=this.props,n=this.parseMaterial(t,i);this.setState({materialParser:n}),r.setUniforms(n.uniforms)}}parseMaterial(t,r){var i;const n=!!(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return(i=this.state.materialParser)===null||i===void 0||i.delete(),new D6(this.context.gl,{attributes:{NORMAL:r.attributes.normals,TEXCOORD_0:r.attributes.texCoords},material:{unlit:n,...t},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const r=this.props.featureIds,i=new Uint8ClampedArray(r.length*t.size),n=[];for(let s=0;s<r.length;s++)this.encodePickingColor(r[s],n),i[s*3]=n[0],i[s*3+1]=n[1],i[s*3+2]=n[2];t.value=i}finalizeState(t){var r;super.finalizeState(t),(r=this.state.materialParser)===null||r===void 0||r.delete(),this.setState({materialParser:null})}}$(nS,"layerName","MeshLayer");$(nS,"defaultProps",jY);const UY=6378137,GY=6378137,VY=6356752314245179e-9;function av(e){return e}new se;function qY(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:av;return"longitude"in e?(t[0]=r(e.longitude),t[1]=r(e.latitude),t[2]=e.height):"x"in e?(t[0]=r(e.x),t[1]=r(e.y),t[2]=e.z):(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]),t}function HY(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return qY(e,t,bs._cartographicRadians?av:UG)}function WY(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:av;return"longitude"in t?(t.longitude=r(e[0]),t.latitude=r(e[1]),t.height=e[2]):"x"in t?(t.x=r(e[0]),t.y=r(e[1]),t.z=e[2]):(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]),t}function $Y(e,t){return WY(e,t,bs._cartographicRadians?av:GG)}const cp=new se,ZY=new se,JY=new se;function XY(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:i,oneOverRadiiSquared:n,centerToleranceSquared:s}=t;cp.from(e);const a=cp.x,o=cp.y,f=cp.z,m=i.x,w=i.y,A=i.z,P=a*a*m*m,I=o*o*w*w,N=f*f*A*A,F=P+I+N,Z=Math.sqrt(1/F);if(!Number.isFinite(Z))return;const U=ZY;if(U.copy(e).scale(Z),F<s)return U.to(r);const z=n.x,J=n.y,nt=n.z,mt=JY;mt.set(U.x*z*2,U.y*J*2,U.z*nt*2);let Et=(1-Z)*cp.len()/(.5*mt.len()),bt=0,pt,zt,Rt,at;do{Et-=bt,pt=1/(1+Et*z),zt=1/(1+Et*J),Rt=1/(1+Et*nt);const dt=pt*pt,kt=zt*zt,xt=Rt*Rt,ue=dt*pt,oe=kt*zt,he=xt*Rt;at=P*dt+I*kt+N*xt-1;const Dt=-2*(P*ue*z+I*oe*J+N*he*nt);bt=at/Dt}while(Math.abs(at)>d0.EPSILON12);return cp.scale([pt,zt,Rt]).to(r)}const zP=1e-14,KY=new se,jP={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},x2={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},um={east:new se,north:new se,up:new se,west:new se,south:new se,down:new se},YY=new se,QY=new se,tQ=new se;function UP(e,t,r,i,n,s){const a=jP[t]&&jP[t][r];xc(a&&(!i||i===a));let o,f,m;const w=KY.copy(n);if(Pc(w.x,0,zP)&&Pc(w.y,0,zP)){const A=Math.sign(w.z);o=YY.fromArray(x2[t]),t!=="east"&&t!=="west"&&o.scale(A),f=QY.fromArray(x2[r]),r!=="east"&&r!=="west"&&f.scale(A),m=tQ.fromArray(x2[i]),i!=="east"&&i!=="west"&&m.scale(A)}else{const{up:A,east:P,north:I}=um;P.set(-w.y,w.x,0).normalize(),e.geodeticSurfaceNormal(w,A),I.copy(A).cross(P);const{down:N,west:F,south:Z}=um;N.copy(A).scale(-1),F.copy(P).scale(-1),Z.copy(I).scale(-1),o=um[t],f=um[r],m=um[i]}return s[0]=o.x,s[1]=o.y,s[2]=o.z,s[3]=0,s[4]=f.x,s[5]=f.y,s[6]=f.z,s[7]=0,s[8]=m.x,s[9]=m.y,s[10]=m.z,s[11]=0,s[12]=w.x,s[13]=w.y,s[14]=w.z,s[15]=1,s}const Y1=new se,GP=new se,eQ=new se,fc=new se,rQ=new se,Q1=new se;class Bn{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;$(this,"radii",void 0),$(this,"radiiSquared",void 0),$(this,"radiiToTheFourth",void 0),$(this,"oneOverRadii",void 0),$(this,"oneOverRadiiSquared",void 0),$(this,"minimumRadius",void 0),$(this,"maximumRadius",void 0),$(this,"centerToleranceSquared",d0.EPSILON1),$(this,"squaredXOverSquaredZ",void 0),xc(t>=0),xc(r>=0),xc(i>=0),this.radii=new se(t,r,i),this.radiiSquared=new se(t*t,r*r,i*i),this.radiiToTheFourth=new se(t*t*t*t,r*r*r*r,i*i*i*i),this.oneOverRadii=new se(t===0?0:1/t,r===0?0:1/r,i===0?0:1/i),this.oneOverRadiiSquared=new se(t===0?0:1/(t*t),r===0?0:1/(r*r),i===0?0:1/(i*i)),this.minimumRadius=Math.min(t,r,i),this.maximumRadius=Math.max(t,r,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const i=GP,n=eQ,[,,s]=t;this.geodeticSurfaceNormalCartographic(t,i),n.copy(this.radiiSquared).scale(i);const a=Math.sqrt(i.dot(n));return n.scale(1/a),i.scale(s),n.add(i),n.to(r)}cartesianToCartographic(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];Q1.from(t);const i=this.scaleToGeodeticSurface(Q1,fc);if(!i)return;const n=this.geodeticSurfaceNormal(i,GP),s=rQ;s.copy(Q1).subtract(i);const a=Math.atan2(n.y,n.x),o=Math.asin(n.z),f=Math.sign(CA(s,Q1))*RB(s);return $Y([a,o,f],r)}eastNorthUpToFixedFrame(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new di;return UP(this,"east","north","up",t,r)}localFrameToFixedFrame(t,r,i,n){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new di;return UP(this,t,r,i,n,s)}geocentricSurfaceNormal(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Y1.from(t).normalize().to(r)}geodeticSurfaceNormalCartographic(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const i=HY(t),n=i[0],s=i[1],a=Math.cos(s);return Y1.set(a*Math.cos(n),a*Math.sin(n),Math.sin(s)).normalize(),Y1.to(r)}geodeticSurfaceNormal(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Y1.from(t).scale(this.oneOverRadiiSquared).normalize().to(r)}scaleToGeodeticSurface(t,r){return XY(t,this,r)}scaleToGeocentricSurface(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];fc.from(t);const i=fc.x,n=fc.y,s=fc.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(i*i*a.x+n*n*a.y+s*s*a.z);return fc.multiplyScalar(o).to(r)}transformPositionToScaledSpace(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return fc.from(t).scale(this.oneOverRadii).to(r)}transformPositionFromScaledSpace(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return fc.from(t).scale(this.radii).to(r)}getSurfaceNormalIntersectionWithZAxis(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];xc(Pc(this.radii.x,this.radii.y,d0.EPSILON15)),xc(this.radii.z>0),fc.from(t);const n=fc.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-r))return fc.set(0,0,n).to(i)}}$(Bn,"WGS84",new Bn(UY,GY,VY));function VP(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}class qP{constructor(t,r){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=VP(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(VP()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class iQ{constructor(t){this.id=void 0,this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const r of Object.values(this.stats))t(r)}getTable(){const t={};return this.forEach(r=>{t[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(t){const{name:r,type:i}=t;let n=this.stats[r];return n||(t instanceof qP?n=t:n=new qP(r,i),this.stats[r]=n),n}}class nQ{constructor(t,r,i){$(this,"item",void 0),$(this,"previous",void 0),$(this,"next",void 0),this.item=t,this.previous=r,this.next=i}}class sQ{constructor(){$(this,"head",null),$(this,"tail",null),$(this,"_length",0)}get length(){return this._length}add(t){const r=new nQ(t,this.tail,null);return this.tail?(this.tail.next=r,this.tail=r):(this.head=r,this.tail=r),++this._length,r}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,r){t!==r&&(this.remove(r),this._insert(t,r))}_insert(t,r){const i=t.next;t.next=r,this.tail===t?this.tail=r:i.previous=r,r.next=i,r.previous=t,++this._length}}class oQ{constructor(){$(this,"_list",void 0),$(this,"_sentinel",void 0),$(this,"_trimTiles",void 0),this._list=new sQ,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const r=t._cacheNode;r&&this._list.splice(this._sentinel,r)}add(t,r,i){r._cacheNode||(r._cacheNode=this._list.add(r),i&&i(t,r))}unloadTile(t,r,i){const n=r._cacheNode;n&&(this._list.remove(n),r._cacheNode=null,i&&i(t,r))}unloadTiles(t,r){const i=this._trimTiles;this._trimTiles=!1;const n=this._list,s=t.maximumMemoryUsage*1024*1024,a=this._sentinel;let o=n.head;for(;o!==a&&(t.gpuMemoryUsageInBytes>s||i);){const f=o.item;o=o.next,this.unloadTile(t,f,r)}}trim(){this._trimTiles=!0}}function aQ(e,t){sn(e),sn(t);const{rtcCenter:r,gltfUpAxis:i}=t,{computedTransform:n,boundingVolume:{center:s}}=e;let a=new di(n);switch(r&&a.translate(r),i){case"Z":break;case"Y":const w=new di().rotateX(Math.PI/2);a=a.multiplyRight(w);break;case"X":const A=new di().rotateY(-Math.PI/2);a=a.multiplyRight(A);break}t.isQuantized&&a.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const o=new se(s);t.cartesianModelMatrix=a,t.cartesianOrigin=o;const f=Bn.WGS84.cartesianToCartographic(o,new se),m=Bn.WGS84.eastNorthUpToFixedFrame(o).invert();t.cartographicModelMatrix=m.multiplyRight(a),t.cartographicOrigin=f,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const HP=new se,A2=new se,Px=new Il([new wc,new wc,new wc,new wc,new wc,new wc]);function lQ(e,t){const{cameraDirection:r,cameraUp:i,height:n}=e,{metersPerUnit:s}=e.distanceScales,a=Py(e,e.center),o=Bn.WGS84.eastNorthUpToFixedFrame(a),f=e.unprojectPosition(e.cameraPosition),m=Bn.WGS84.cartographicToCartesian(f,new se),w=new se(o.transformAsVector(new se(r).scale(s))).normalize(),A=new se(o.transformAsVector(new se(i).scale(s))).normalize();uQ(e);const P=e.constructor,{longitude:I,latitude:N,width:F,bearing:Z,zoom:U}=e,z=new P({longitude:I,latitude:N,height:n,width:F,bearing:Z,zoom:U,pitch:0});return{camera:{position:m,direction:w,up:A},viewport:e,topDownViewport:z,height:n,cullingVolume:Px,frameNumber:t,sseDenominator:1.15}}function cQ(e,t,r){if(r===0||e.length<=r)return[e,[]];const i=[],{longitude:n,latitude:s}=t.viewport;for(const[m,w]of e.entries()){const[A,P]=w.header.mbs,I=Math.abs(n-A),N=Math.abs(s-P),F=Math.sqrt(N*N+I*I);i.push([m,F])}const a=i.sort((m,w)=>m[1]-w[1]),o=[];for(let m=0;m<r;m++)o.push(e[a[m][0]]);const f=[];for(let m=r;m<a.length;m++)f.push(e[a[m][0]]);return[o,f]}function uQ(e){const t=e.getFrustumPlanes(),r=WP(t.near,e.cameraPosition),i=Py(e,r),n=Py(e,e.cameraPosition,A2);let s=0;Px.planes[s++].fromPointNormal(i,HP.copy(i).subtract(n));for(const a in t){if(a==="near")continue;const o=t[a],f=WP(o,r,A2),m=Py(e,f,A2);Px.planes[s++].fromPointNormal(m,HP.copy(i).subtract(m))}}function WP(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new se;const i=e.normal.dot(t);return r.copy(e.normal).scale(e.distance-i).add(t),r}function Py(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new se;const i=e.unprojectPosition(t);return Bn.WGS84.cartographicToCartesian(i,r)}const hQ=6378137,dQ=6378137,Ix=6356752314245179e-9,$P=new se;function fQ(e,t){if(e instanceof z0){const{halfAxes:r}=e,i=gQ(r);return Math.log2(Ix/(i+t[2]))}else if(e instanceof F0){const{radius:r}=e;return Math.log2(Ix/(r+t[2]))}else if(e.width&&e.height){const{width:r,height:i}=e,n=Math.log2(hQ/r),s=Math.log2(dQ/i);return(n+s)/2}return 1}function Y6(e,t,r){const i=Bn.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],new se),n=Math.sqrt(Math.pow(i[0]-r[0],2)+Math.pow(i[1]-r[1],2)+Math.pow(i[2]-r[2],2));return Math.log2(Ix/(n+t[2]))}function pQ(e,t,r){const[i,n,s,a]=e;return Y6({xmin:i,xmax:s,ymin:n,ymax:a,zmin:0,zmax:0},t,r)}function gQ(e){e.getColumn(0,$P);const t=e.getColumn(1),r=e.getColumn(2);return $P.add(t).add(r).len()}const ja={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},sh={ADD:1,REPLACE:2},Hp={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},xl={I3S:"I3S",TILES3D:"TILES3D"},lv={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},mQ={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function Q6(e){return e!=null}const xo=new se,Iy=new se,yQ=new se,_Q=new se;function S2(e,t,r){if(sn(e,"3D Tile: boundingVolume must be defined"),e.box)return bQ(e.box,t,r);if(e.region){const[i,n,s,a,o,f]=e.region,m=Bn.WGS84.cartographicToCartesian([th(i),th(a),o],yQ),w=Bn.WGS84.cartographicToCartesian([th(s),th(n),f],_Q),A=new se().addVectors(m,w).multiplyScalar(.5),P=new se().subVectors(m,w).len()/2;return ZP([A[0],A[1],A[2],P],new di)}if(e.sphere)return ZP(e.sphere,t,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function vQ(e,t){if(e.box)return wQ(t);if(e.region){const[r,i,n,s,a,o]=e.region;return[[th(r),th(i),a],[th(n),th(s),o]]}if(e.sphere)return xQ(t);throw new Error("Unkown boundingVolume type")}function bQ(e,t,r){const i=new se(e[0],e[1],e[2]);t.transform(i,i);let n=[];if(e.length===10){const m=e.slice(3,6),w=new h0;w.fromArray(e,6);const A=new se([1,0,0]),P=new se([0,1,0]),I=new se([0,0,1]);A.transformByQuaternion(w),A.scale(m[0]),P.transformByQuaternion(w),P.scale(m[1]),I.transformByQuaternion(w),I.scale(m[2]),n=[...A.toArray(),...P.toArray(),...I.toArray()]}else n=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];const s=t.transformAsVector(n.slice(0,3)),a=t.transformAsVector(n.slice(3,6)),o=t.transformAsVector(n.slice(6,9)),f=new $n([s[0],s[1],s[2],a[0],a[1],a[2],o[0],o[1],o[2]]);return Q6(r)?(r.center=i,r.halfAxes=f,r):new z0(i,f)}function ZP(e,t,r){const i=new se(e[0],e[1],e[2]);t.transform(i,i);const n=t.getScale(Iy),s=Math.max(Math.max(n[0],n[1]),n[2]),a=e[3]*s;return Q6(r)?(r.center=i,r.radius=a,r):new F0(i,a)}function wQ(e){const t=tk(),{halfAxes:r}=e,i=new se(r.getColumn(0)),n=new se(r.getColumn(1)),s=new se(r.getColumn(2));for(let a=0;a<2;a++){for(let o=0;o<2;o++){for(let f=0;f<2;f++)xo.copy(e.center),xo.add(i),xo.add(n),xo.add(s),ek(t,xo),s.negate();n.negate()}i.negate()}return t}function xQ(e){const t=tk(),{center:r,radius:i}=e,n=Bn.WGS84.scaleToGeodeticSurface(r,xo);let s;n?s=Bn.WGS84.geodeticSurfaceNormal(n):s=new se(0,0,1);let a=new se(s[2],-s[1],0);a.len()>0?a.normalize():a=new se(0,1,0);const o=a.clone().cross(s);for(const f of[a,o,s]){Iy.copy(f).scale(i);for(let m=0;m<2;m++)xo.copy(r),xo.add(Iy),ek(t,xo),Iy.negate()}return t}function tk(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function ek(e,t){Bn.WGS84.cartesianToCartographic(t,xo),e[0][0]=Math.min(e[0][0],xo[0]),e[0][1]=Math.min(e[0][1],xo[1]),e[0][2]=Math.min(e[0][2],xo[2]),e[1][0]=Math.max(e[1][0],xo[0]),e[1][1]=Math.max(e[1][1],xo[1]),e[1][2]=Math.max(e[1][2],xo[2])}new se;new se;new di;new se;new se;new se;function AQ(e,t){const r=e*t;return 1-Math.exp(-(r*r))}function SQ(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){const r=e.dynamicScreenSpaceErrorComputedDensity,i=e.dynamicScreenSpaceErrorFactor;return AQ(t,r)*i}return 0}function EQ(e,t,r){const i=e.tileset,n=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,s=r?n:e.lodMetricValue;if(s===0)return 0;const a=Math.max(e._distanceToCamera,1e-7),{height:o,sseDenominator:f}=t,{viewDistanceScale:m}=i.options;let w=s*o*(m||1)/(a*f);return w-=SQ(i,a),w}const E2=new se,JP=new se,Zh=new se,XP=new se,CQ=new se,C2=new di,KP=new di;function TQ(e,t){if(e.lodMetricValue===0||isNaN(e.lodMetricValue))return"DIG";const r=2*rk(e,t);return r<2?"OUT":!e.header.children||r<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}function rk(e,t){const{topDownViewport:r}=t,i=e.header.mbs[1],n=e.header.mbs[0],s=e.header.mbs[2],a=e.header.mbs[3],o=[...e.boundingVolume.center],f=r.unprojectPosition(r.cameraPosition);Bn.WGS84.cartographicToCartesian(f,E2),JP.copy(E2).subtract(o).normalize(),Bn.WGS84.eastNorthUpToFixedFrame(o,C2),KP.copy(C2).invert(),Zh.copy(E2).transform(KP);const m=Math.sqrt(Zh[0]*Zh[0]+Zh[1]*Zh[1]),w=m*m/Zh[2];XP.copy([Zh[0],Zh[1],w]);const A=XP.transform(C2).subtract(o).normalize(),P=JP.cross(A).normalize().scale(a).add(o),I=Bn.WGS84.cartesianToCartographic(P),N=r.project([n,i,s]),F=r.project(I);return CQ.copy(N).subtract(F).magnitude()}function PQ(e){return{assetGltfUpAxis:e.asset&&e.asset.gltfUpAxis||"Y"}}class YP{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;$(this,"_map",new Map),$(this,"_array",void 0),$(this,"_length",void 0),this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return sn(t<this._array.length),this._array[t]}set(t,r){sn(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=r,this._map.set(r,t)}delete(t){const r=this._map.get(t);r>=0&&(this._array.splice(r,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const r=this.length++;this._array[r]=t,this._map.set(t,r)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){sn(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){sn(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const IQ={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class cv{traversalFinished(t){return!0}constructor(t){$(this,"options",void 0),$(this,"root",null),$(this,"selectedTiles",{}),$(this,"requestedTiles",{}),$(this,"emptyTiles",{}),$(this,"lastUpdate",new Date().getTime()),$(this,"updateDebounceTime",1e3),$(this,"_traversalStack",new YP),$(this,"_emptyTraversalStack",new YP),$(this,"_frameNumber",null),this.options={...IQ,...t}}traverse(t,r,i){this.root=t,this.options={...this.options,...i},this.reset(),this.updateTile(t,r),this._frameNumber=r.frameNumber,this.executeTraversal(t,r)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,r){const i=this._traversalStack;for(t._selectionDepth=1,i.push(t);i.length>0;){const s=i.pop();let a=!1;this.canTraverse(s,r)&&(this.updateChildTiles(s,r),a=this.updateAndPushChildren(s,r,i,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const o=s.parent,f=!!(!o||o._shouldRefine),m=!a;s.hasRenderContent?s.refine===sh.ADD?(this.loadTile(s,r),this.selectTile(s,r)):s.refine===sh.REPLACE&&(this.loadTile(s,r),m&&this.selectTile(s,r)):(this.emptyTiles[s.id]=s,this.loadTile(s,r),m&&this.selectTile(s,r)),this.touchTile(s,r),s._shouldRefine=a&&f}const n=new Date().getTime();(this.traversalFinished(r)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(r))}updateChildTiles(t,r){const i=t.children;for(const n of i)this.updateTile(n,r)}updateAndPushChildren(t,r,i,n){const{loadSiblings:s,skipLevelOfDetail:a}=this.options,o=t.children;o.sort(this.compareDistanceToCamera.bind(this));const f=t.refine===sh.REPLACE&&t.hasRenderContent&&!a;let m=!1,w=!0;for(const A of o)if(A._selectionDepth=n,A.isVisibleAndInRequestVolume?(i.find(A)&&i.delete(A),i.push(A),m=!0):(f||s)&&(this.loadTile(A,r),this.touchTile(A,r)),f){let P;if(A._inRequestVolume?A.hasRenderContent?P=A.contentAvailable:P=this.executeEmptyTraversal(A,r):P=!1,w=w&&P,!w)return!1}return m||(w=!1),w}updateTile(t,r){this.updateTileVisibility(t,r)}selectTile(t,r){this.shouldSelectTile(t)&&(t._selectedFrame=r.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,r){this.shouldLoadTile(t)&&(t._requestedFrame=r.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,r){t.tileset._cache.touch(t),t._touchedFrame=r.frameNumber}canTraverse(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return t.hasChildren?t.hasTilesetContent?!t.contentExpired:!n&&!t.isVisibleAndInRequestVolume?!1:this.shouldRefine(t,r,i):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=t._screenSpaceError;return i&&(n=t.getScreenSpaceError(r,!0)),n>this.options.maximumScreenSpaceError}updateTileVisibility(t,r){const i=[];if(this.options.viewportTraversersMap)for(const n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===r.viewport.id&&i.push(n);else i.push(r.viewport.id);t.updateVisibility(r,i)}compareDistanceToCamera(t,r){return t._distanceToCamera-r._distanceToCamera}anyChildrenVisible(t,r){let i=!1;for(const n of t.children)n.updateVisibility(r),i=i||n.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(t,r){let i=!0;const n=this._emptyTraversalStack;for(n.push(t);n.length>0&&i;){const s=n.pop();if(this.updateTile(s,r),s.isVisibleAndInRequestVolume||this.loadTile(s,r),this.touchTile(s,r),!s.hasRenderContent&&this.canTraverse(s,r,!1,!0)){const a=s.children;for(const o of a)n.find(o)&&n.delete(o),n.push(o)}else!s.contentAvailable&&!s.hasEmptyContent&&(i=!1)}return i}}const QP=new se;function MQ(e){return e!=null}class Mx{constructor(t,r,i){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";$(this,"tileset",void 0),$(this,"header",void 0),$(this,"id",void 0),$(this,"url",void 0),$(this,"parent",void 0),$(this,"refine",void 0),$(this,"type",void 0),$(this,"contentUrl",void 0),$(this,"lodMetricType","geometricError"),$(this,"lodMetricValue",0),$(this,"boundingVolume",null),$(this,"content",null),$(this,"contentState",ja.UNLOADED),$(this,"gpuMemoryUsageInBytes",0),$(this,"children",[]),$(this,"depth",0),$(this,"viewportIds",[]),$(this,"transform",new di),$(this,"extensions",null),$(this,"implicitTiling",null),$(this,"userData",{}),$(this,"computedTransform",void 0),$(this,"hasEmptyContent",!1),$(this,"hasTilesetContent",!1),$(this,"traverser",new cv({})),$(this,"_cacheNode",null),$(this,"_frameNumber",null),$(this,"_expireDate",null),$(this,"_expiredContent",null),$(this,"_boundingBox",void 0),$(this,"_distanceToCamera",0),$(this,"_screenSpaceError",0),$(this,"_visibilityPlaneMask",void 0),$(this,"_visible",void 0),$(this,"_contentBoundingVolume",void 0),$(this,"_viewerRequestVolume",void 0),$(this,"_initialTransform",new di),$(this,"_priority",0),$(this,"_selectedFrame",0),$(this,"_requestedFrame",0),$(this,"_selectionDepth",0),$(this,"_touchedFrame",0),$(this,"_centerZDepth",0),$(this,"_shouldRefine",!1),$(this,"_stackLength",0),$(this,"_visitedFrame",0),$(this,"_inRequestVolume",!1),$(this,"_lodJudge",null),this.header=r,this.tileset=t,this.id=n||r.id,this.url=r.url,this.parent=i,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===ja.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===ja.UNLOADED}get contentExpired(){return this.contentState===ja.EXPIRED}get contentFailed(){return this.contentState===ja.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=vQ(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,r){switch(this.tileset.type){case xl.I3S:return rk(this,t);case xl.TILES3D:return EQ(this,t,r);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:r}=t.options,i=this.refine===sh.ADD||r;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===ja.UNLOADED)return-1;const n=this.parent,s=n&&(!i||this._screenSpaceError===0||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,a=t.root?t.root._screenSpaceError:0;return Math.max(a-s,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=ja.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=ja.UNLOADED,!1;try{const r=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,n={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await wd(r,i,n),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=ja.READY,this._onContentLoaded(),!0}catch(r){throw this.contentState=ja.FAILED,r}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=ja.UNLOADED,!0}updateVisibility(t,r){if(this._frameNumber===t.frameNumber)return;const i=this.parent,n=i?i._visibilityPlaneMask:Il.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,n),this._visible=this._visibilityPlaneMask!==Il.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=r}visibility(t,r){const{cullingVolume:i}=t,{boundingVolume:n}=this;return i.computeVisibilityWithPlaneMask(n,r)}contentVisibility(){return!0}distanceToTile(t){const r=this.boundingVolume;return Math.sqrt(Math.max(r.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth(t){let{camera:r}=t;const i=this.boundingVolume;return QP.subVectors(i.center,r.position),r.direction.dot(QP)}insideViewerRequestVolume(t){const r=this._viewerRequestVolume;return!r||r.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(MQ(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=ja.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new di(t.transform):new di;const r=this.parent,i=this.tileset,n=r&&r.computedTransform?r.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new di(n).multiplyRight(this.transform);const s=r&&r._initialTransform?r._initialTransform.clone():new di;this._initialTransform=new di(s).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=ja.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Il.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||sh.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=S2(t.boundingVolume,this.computedTransform,this.boundingVolume);const r=t.content;r&&(r.boundingVolume&&(this._contentBoundingVolume=S2(r.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=S2(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new di).clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return PQ(this.tileset.tileset)}}}class LQ extends cv{compareDistanceToCamera(t,r){return r._distanceToCamera===0&&t._distanceToCamera===0?r._centerZDepth-t._centerZDepth:r._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,r){if(super.updateTileVisibility(t,r),!t.isVisibleAndInRequestVolume)return;const i=t.children.length>0;if(t.hasTilesetContent&&i){const a=t.children[0];this.updateTileVisibility(a,r),t._visible=a._visible;return}if(this.meetsScreenSpaceErrorEarly(t,r)){t._visible=!1;return}const n=t.refine===sh.REPLACE,s=t._optimChildrenWithinParent===mQ.USE_OPTIMIZATION;if(n&&s&&i&&!this.anyChildrenVisible(t,r)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,r){const{parent:i}=t;return!i||i.hasTilesetContent||i.refine!==sh.ADD?!1:!this.shouldRefine(t,r,!0)}}class BQ{constructor(){$(this,"frameNumberMap",new Map)}register(t,r){const i=this.frameNumberMap.get(t)||new Map,n=i.get(r)||0;i.set(r,n+1),this.frameNumberMap.set(t,i)}deregister(t,r){const i=this.frameNumberMap.get(t);if(!i)return;const n=i.get(r)||1;i.set(r,n-1)}isZero(t,r){var i;return(((i=this.frameNumberMap.get(t))===null||i===void 0?void 0:i.get(r))||0)===0}}const T2={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class kQ{constructor(){$(this,"_statusMap",void 0),$(this,"pendingTilesRegister",new BQ),this._statusMap={}}add(t,r,i,n){if(!this._statusMap[r]){const{frameNumber:s,viewport:{id:a}}=n;this._statusMap[r]={request:t,callback:i,key:r,frameState:n,status:T2.REQUESTED},this.pendingTilesRegister.register(a,s),t().then(o=>{this._statusMap[r].status=T2.COMPLETED;const{frameNumber:f,viewport:{id:m}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(m,f),this._statusMap[r].callback(o,n)}).catch(o=>{this._statusMap[r].status=T2.ERROR;const{frameNumber:f,viewport:{id:m}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(m,f),i(o)})}}update(t,r){if(this._statusMap[t]){const{frameNumber:i,viewport:{id:n}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(n,i);const{frameNumber:s,viewport:{id:a}}=r;this.pendingTilesRegister.register(a,s),this._statusMap[t].frameState=r}}find(t){return this._statusMap[t]}hasPendingTiles(t,r){return!this.pendingTilesRegister.isZero(t,r)}}class RQ extends cv{constructor(t){super(t),$(this,"_tileManager",void 0),this._tileManager=new kQ}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,r){return t._lodJudge=TQ(t,r),t._lodJudge==="DIG"}updateChildTiles(t,r){const i=t.header.children||[],n=t.children,s=t.tileset;for(const a of i){const o="".concat(a.id,"-").concat(r.viewport.id),f=n&&n.find(m=>m.id===o);if(f)f&&this.updateTile(f,r);else{let m=()=>this._loadTile(a.id,s);this._tileManager.find(o)?this._tileManager.update(o,r):(s.tileset.nodePages&&(m=()=>s.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(m,o,w=>this._onTileLoad(w,t,o),r))}}return!1}async _loadTile(t,r){const{loader:i}=r,n=r.getTileUrl("".concat(r.url,"/nodes/").concat(t)),s={...r.loadOptions,i3s:{...r.loadOptions.i3s,isTileHeader:!0}};return await wd(n,i,s)}_onTileLoad(t,r,i){const n=new Mx(r.tileset,t,r,i);r.children.push(n);const s=this._tileManager.find(n.id).frameState;this.updateTile(n,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(n,s)}}const OQ={description:"",ellipsoid:Bn.WGS84,modelMatrix:new di,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},ty="Tiles In Tileset(s)",P2="Tiles In Memory",tI="Tiles In View",eI="Tiles To Render",rI="Tiles Loaded",I2="Tiles Loading",iI="Tiles Unloaded",nI="Failed Tile Loads",sI="Points/Vertices",M2="Tile Memory Use";class DQ{constructor(t,r){$(this,"options",void 0),$(this,"loadOptions",void 0),$(this,"type",void 0),$(this,"tileset",void 0),$(this,"loader",void 0),$(this,"url",void 0),$(this,"basePath",void 0),$(this,"modelMatrix",void 0),$(this,"ellipsoid",void 0),$(this,"lodMetricType",void 0),$(this,"lodMetricValue",void 0),$(this,"refine",void 0),$(this,"root",null),$(this,"roots",{}),$(this,"asset",{}),$(this,"description",""),$(this,"properties",void 0),$(this,"extras",null),$(this,"attributions",{}),$(this,"credits",{}),$(this,"stats",void 0),$(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),$(this,"cartographicCenter",null),$(this,"cartesianCenter",null),$(this,"zoom",1),$(this,"boundingVolume",null),$(this,"dynamicScreenSpaceErrorComputedDensity",0),$(this,"maximumMemoryUsage",32),$(this,"gpuMemoryUsageInBytes",0),$(this,"_frameNumber",0),$(this,"_queryParams",{}),$(this,"_extensionsUsed",[]),$(this,"_tiles",{}),$(this,"_pendingCount",0),$(this,"selectedTiles",[]),$(this,"traverseCounter",0),$(this,"geometricError",0),$(this,"lastUpdatedVieports",null),$(this,"_requestedTiles",[]),$(this,"_emptyTiles",[]),$(this,"frameStateData",{}),$(this,"_traverser",void 0),$(this,"_cache",new oQ),$(this,"_requestScheduler",void 0),$(this,"updatePromise",null),$(this,"tilesetInitializationPromise",void 0),this.options={...OQ,...r},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||rA(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new zF({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new iQ({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}setOptions(t){this.options={...this.options,...t}}getTileUrl(t){return t.startsWith("data:")?t:"".concat(t).concat(t.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(r=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),r(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const r=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=r.length;const i=[];for(const n of r){const s=n.id;this._needTraverse(s)?i.push(s):this.traverseCounter--}for(const n of r){const s=n.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!i.includes(s))continue;const a=lQ(n,this._frameNumber);this._traverser.traverse(this.roots[s],a,this.options)}}_needTraverse(t){let r=t;return this.options.viewportTraversersMap&&(r=this.options.viewportTraversersMap[t]),r===t}_onTraversalEnd(t){const r=t.viewport.id;this.frameStateData[r]||(this.frameStateData[r]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[r],n=Object.values(this._traverser.selectedTiles),[s,a]=cQ(n,t,this.options.maximumTilesSelected);i.selectedTiles=s;for(const o of a)o.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const r=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(r.selectedTiles),this._requestedTiles=this._requestedTiles.concat(r._requestedTiles),this._emptyTiles=this._emptyTiles.concat(r._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,r){if(t.length!==r.length)return!0;const i=new Set(t.map(a=>a.id)),n=new Set(r.map(a=>a.id));let s=t.filter(a=>!n.has(a.id)).length>0;return s=s||r.filter(a=>!i.has(a.id)).length>0,s}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,r)=>t._unloadTile(r))}_updateStats(){let t=0,r=0;for(const i of this.selectedTiles)i.contentAvailable&&i.content&&(t++,i.content.pointCount?r+=i.content.pointCount:r+=i.content.vertexCount);this.stats.get(tI).count=this.selectedTiles.length,this.stats.get(eI).count=t,this.stats.get(sI).count=r}async _initializeTileSet(t){this.type===xl.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===xl.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===xl.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const r=this.tileset.fullExtent;if(r){const{xmin:n,xmax:s,ymin:a,ymax:o,zmin:f,zmax:m}=r;this.cartographicCenter=new se(n+(s-n)/2,a+(o-a)/2,f+(m-f)/2),this.cartesianCenter=Bn.WGS84.cartographicToCartesian(this.cartographicCenter,new se),this.zoom=Y6(r,this.cartographicCenter,this.cartesianCenter);return}const i=(t=this.tileset.store)===null||t===void 0?void 0:t.extent;if(i){const[n,s,a,o]=i;this.cartographicCenter=new se(n+(a-n)/2,s+(o-s)/2,0),this.cartesianCenter=Bn.WGS84.cartographicToCartesian(this.cartographicCenter,new se),this.zoom=pQ(i,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new se,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:r}=t.boundingVolume;if(!r){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new se,this.zoom=1;return}r[0]!==0||r[1]!==0||r[2]!==0?this.cartographicCenter=Bn.WGS84.cartesianToCartographic(r,new se):this.cartographicCenter=new se(0,0,-Bn.WGS84.radii[0]),this.cartesianCenter=r,this.zoom=fQ(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(ty),this.stats.get(I2),this.stats.get(P2),this.stats.get(tI),this.stats.get(eI),this.stats.get(rI),this.stats.get(iI),this.stats.get(nI),this.stats.get(sI),this.stats.get(M2,"memory")}_initializeTileHeaders(t,r){const i=new Mx(this,t.root,r);if(r&&(r.children.push(i),i.depth=r.depth+1),this.type===xl.TILES3D){const s=[];for(s.push(i);s.length>0;){const a=s.pop();this.stats.get(ty).incrementCount();const o=a.header.children||[];for(const f of o){var n;const m=new Mx(this,f,a);if((n=m.contentUrl)!==null&&n!==void 0&&n.includes("?session=")){const w=new URL(m.contentUrl).searchParams.get("session");w&&(this._queryParams.session=w)}a.children.push(m),m.depth=a.depth+1,s.push(m)}}}return i}_initializeTraverser(){let t;switch(this.type){case xl.TILES3D:t=LQ;break;case xl.I3S:t=RQ;break;default:t=cv}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let r;try{this._onStartTileLoading(),r=await t.loadContent()}catch(i){this._onTileLoadError(t,i instanceof Error?i:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,r)}}_onTileLoadError(t,r){this.stats.get(nI).incrementCount();const i=r.message||r.toString(),n=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(i)),this.options.onTileError(t,i,n)}_onTileLoad(t,r){if(r){if(this.type===xl.I3S){var i,n;const s=((i=this.tileset)===null||i===void 0||(n=i.nodePagesTile)===null||n===void 0?void 0:n.nodesInNodePages)||0;this.stats.get(ty).reset(),this.stats.get(ty).addCount(s)}t&&t.content&&aQ(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===xl.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===xl.TILES3D){var r;const{extensionsRemoved:i=[]}=((r=t.content)===null||r===void 0?void 0:r.gltf)||{};i.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),i.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),i.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(I2).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(I2).decrementCount()}_addTileToCache(t){this._cache.add(this,t,r=>r._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(rI).incrementCount(),this.stats.get(P2).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(M2).count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(P2).decrementCount(),this.stats.get(iI).incrementCount(),this.stats.get(M2).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const r=t.pop();for(const i of r.children)t.push(i);this._destroyTile(r)}this.root=null}_destroySubtree(t){const r=t,i=[];for(i.push(r);i.length>0;){t=i.pop();for(const n of t.children)i.push(n);t!==r&&this._destroyTile(t)}r.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const r=new URLSearchParams(t.queryString),i=Object.fromEntries(r.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const ik="3.4.14",hm={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function nk(e,t,r){sn(e instanceof ArrayBuffer);const i=new TextDecoder("utf8"),n=new Uint8Array(e,t,r);return i.decode(n)}function NQ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const r=new DataView(e);return"".concat(String.fromCharCode(r.getUint8(t+0))).concat(String.fromCharCode(r.getUint8(t+1))).concat(String.fromCharCode(r.getUint8(t+2))).concat(String.fromCharCode(r.getUint8(t+3)))}const FQ={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},cs={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Ei={...FQ,...cs},L2={[cs.DOUBLE]:Float64Array,[cs.FLOAT]:Float32Array,[cs.UNSIGNED_SHORT]:Uint16Array,[cs.UNSIGNED_INT]:Uint32Array,[cs.UNSIGNED_BYTE]:Uint8Array,[cs.BYTE]:Int8Array,[cs.SHORT]:Int16Array,[cs.INT]:Int32Array},zQ={DOUBLE:cs.DOUBLE,FLOAT:cs.FLOAT,UNSIGNED_SHORT:cs.UNSIGNED_SHORT,UNSIGNED_INT:cs.UNSIGNED_INT,UNSIGNED_BYTE:cs.UNSIGNED_BYTE,BYTE:cs.BYTE,SHORT:cs.SHORT,INT:cs.INT},B2="Failed to convert GL type";class hu{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const r in L2)if(L2[r]===t)return r;throw new Error(B2)}static fromName(t){const r=zQ[t];if(!r)throw new Error(B2);return r}static getArrayType(t){switch(t){case cs.UNSIGNED_SHORT_5_6_5:case cs.UNSIGNED_SHORT_4_4_4_4:case cs.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const r=L2[t];if(!r)throw new Error(B2);return r}}static getByteSize(t){return hu.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!hu.getArrayType(t)}static createTypedArray(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;n===void 0&&(n=(r.byteLength-i)/hu.getByteSize(t));const s=hu.getArrayType(t);return new s(r,i,n)}}function jQ(e,t){if(!e)throw new Error("math.gl assertion failed. ".concat(t))}function UQ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=e>>11&31,i=e>>5&63,n=e&31;return t[0]=r<<3,t[1]=i<<2,t[2]=n<<3,t}new EA;new se;new EA;new EA;function oI(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return eh(e,0,t)/t*2-1}function aI(e){return e<0?-1:1}function GQ(e,t,r,i){if(jQ(i),e<0||e>r||t<0||t>r)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(r));if(i.x=oI(e,r),i.y=oI(t,r),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const n=i.x;i.x=(1-Math.abs(i.y))*aI(n),i.y=(1-Math.abs(n))*aI(i.y)}return i.normalize()}function VQ(e,t,r){return GQ(e,t,255,r)}class sS{constructor(t,r){$(this,"json",void 0),$(this,"buffer",void 0),$(this,"featuresLength",0),$(this,"_cachedTypedArrays",{}),this.json=t,this.buffer=r}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ei.UNSIGNED_INT,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const n=this.json[t];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(t,r,i,1,n.byteOffset):n}getPropertyArray(t,r,i){const n=this.json[t];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(r=hu.fromName(n.componentType)),this._getTypedArrayFromBinary(t,r,i,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(t,r,n)}getProperty(t,r,i,n,s){const a=this.json[t];if(!a)return a;const o=this.getPropertyArray(t,r,i);if(i===1)return o[n];for(let f=0;f<i;++f)s[f]=o[i*n+f];return s}_getTypedArrayFromBinary(t,r,i,n,s){const a=this._cachedTypedArrays;let o=a[t];return o||(o=hu.createTypedArray(r,this.buffer.buffer,this.buffer.byteOffset+s,n*i),a[t]=o),o}_getTypedArrayFromArray(t,r,i){const n=this._cachedTypedArrays;let s=n[t];return s||(s=hu.createTypedArray(r,i),n[t]=s),s}}const qQ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},HQ={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},WQ={SCALAR:(e,t,r)=>{t[r]=e},VEC2:(e,t,r)=>{t[2*r+0]=e[0],t[2*r+1]=e[1]},VEC3:(e,t,r)=>{t[3*r+0]=e[0],t[3*r+1]=e[1],t[3*r+2]=e[2]},VEC4:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT2:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT3:(e,t,r)=>{t[9*r+0]=e[0],t[9*r+1]=e[1],t[9*r+2]=e[2],t[9*r+3]=e[3],t[9*r+4]=e[4],t[9*r+5]=e[5],t[9*r+6]=e[6],t[9*r+7]=e[7],t[9*r+8]=e[8],t[9*r+9]=e[9]},MAT4:(e,t,r)=>{t[16*r+0]=e[0],t[16*r+1]=e[1],t[16*r+2]=e[2],t[16*r+3]=e[3],t[16*r+4]=e[4],t[16*r+5]=e[5],t[16*r+6]=e[6],t[16*r+7]=e[7],t[16*r+8]=e[8],t[16*r+9]=e[9],t[16*r+10]=e[10],t[16*r+11]=e[11],t[16*r+12]=e[12],t[16*r+13]=e[13],t[16*r+14]=e[14],t[16*r+15]=e[15]}};function $Q(e,t,r,i){const{componentType:n}=e;sn(e.componentType);const s=typeof n=="string"?hu.fromName(n):n,a=qQ[e.type],o=HQ[e.type],f=WQ[e.type];return r+=e.byteOffset,{values:hu.createTypedArray(s,t,r,a*i),type:s,size:a,unpacker:o,packer:f}}const lu=e=>e!==void 0;function ZQ(e,t,r){if(!t)return null;let i=e.getExtension("3DTILES_batch_table_hierarchy");const n=t.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=n,i=n),i?JQ(i,r):null}function JQ(e,t){let r,i,n;const s=e.instancesLength,a=e.classes;let o=e.classIds,f=e.parentCounts,m=e.parentIds,w=s;lu(o.byteOffset)&&(o.componentType=defaultValue(o.componentType,GL.UNSIGNED_SHORT),o.type=AttributeType.SCALAR,n=getBinaryAccessor(o),o=n.createArrayBufferView(t.buffer,t.byteOffset+o.byteOffset,s));let A;if(lu(f))for(lu(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,n=getBinaryAccessor(f),f=n.createArrayBufferView(t.buffer,t.byteOffset+f.byteOffset,s)),A=new Uint16Array(s),w=0,r=0;r<s;++r)A[r]=w,w+=f[r];lu(m)&&lu(m.byteOffset)&&(m.componentType=defaultValue(m.componentType,GL.UNSIGNED_SHORT),m.type=AttributeType.SCALAR,n=getBinaryAccessor(m),m=n.createArrayBufferView(t.buffer,t.byteOffset+m.byteOffset,w));const P=a.length;for(r=0;r<P;++r){const Z=a[r].length,U=a[r].instances,z=getBinaryProperties(Z,U,t);a[r].instances=combine(z,U)}const I=new Array(P).fill(0),N=new Uint16Array(s);for(r=0;r<s;++r)i=o[r],N[r]=I[i],++I[i];const F={classes:a,classIds:o,classIndexes:N,parentCounts:f,parentIndexes:A,parentIds:m};return YQ(F),F}function dm(e,t,r){if(!e)return;const i=e.parentCounts;return e.parentIds?r(e,t):i>0?XQ(e,t,r):KQ(e,t,r)}function XQ(e,t,r){const i=e.classIds,n=e.parentCounts,s=e.parentIds,a=e.parentIndexes,o=i.length,f=scratchVisited;f.length=Math.max(f.length,o);const m=++marker,w=scratchStack;for(w.length=0,w.push(t);w.length>0;){if(t=w.pop(),f[t]===m)continue;f[t]=m;const A=r(e,t);if(lu(A))return A;const P=n[t],I=a[t];for(let N=0;N<P;++N){const F=s[I+N];F!==t&&w.push(F)}}return null}function KQ(e,t,r){let i=!0;for(;i;){const n=r(e,t);if(lu(n))return n;const s=e.parentIds[t];i=s!==t,t=s}throw new Error("traverseHierarchySingleParent")}function YQ(e){const t=e.classIds.length;for(let r=0;r<t;++r)sk(e,r,stack)}function sk(e,t,r){const i=e.parentCounts,n=e.parentIds,s=e.parentIndexes,a=e.classIds.length;if(!lu(n))return;assert(t<a,"Parent index ".concat(t," exceeds the total number of instances: ").concat(a)),assert(r.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),r.push(t);const o=lu(i)?i[t]:1,f=lu(i)?s[t]:t;for(let m=0;m<o;++m){const w=n[f+m];w!==t&&sk(e,w,r)}r.pop(t)}function da(e){return e!=null}const ey=(e,t)=>e,QQ={HIERARCHY:!0,extensions:!0,extras:!0};class ok{constructor(t,r,i){var n;let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};$(this,"json",void 0),$(this,"binary",void 0),$(this,"featureCount",void 0),$(this,"_extensions",void 0),$(this,"_properties",void 0),$(this,"_binaryProperties",void 0),$(this,"_hierarchy",void 0),sn(i>=0),this.json=t||{},this.binary=r,this.featureCount=i,this._extensions=((n=this.json)===null||n===void 0?void 0:n.extensions)||{},this._properties={};for(const a in this.json)QQ[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=ZQ(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,r){if(this._checkBatchId(t),sn(typeof r=="string",r),this._hierarchy){const i=dm(this._hierarchy,t,(n,s)=>{const a=n.classIds[s];return n.classes[a].name===r});return da(i)}return!1}isExactClass(t,r){return sn(typeof r=="string",r),this.getExactClassName(t)===r}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const r=this._hierarchy.classIds[t];return this._hierarchy.classes[r].name}}hasProperty(t,r){return this._checkBatchId(t),sn(typeof r=="string",r),da(this._properties[r])||this._hasPropertyInHierarchy(t,r)}getPropertyNames(t,r){this._checkBatchId(t),r=da(r)?r:[],r.length=0;const i=Object.keys(this._properties);return r.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(t,r),r}getProperty(t,r){if(this._checkBatchId(t),sn(typeof r=="string",r),this._binaryProperties){const n=this._binaryProperties[r];if(da(n))return this._getBinaryProperty(n,t)}const i=this._properties[r];if(da(i))return ey(i[t]);if(this._hierarchy){const n=this._getHierarchyProperty(t,r);if(da(n))return n}}setProperty(t,r,i){const n=this.featureCount;if(this._checkBatchId(t),sn(typeof r=="string",r),this._binaryProperties){const a=this._binaryProperties[r];if(a){this._setBinaryProperty(a,t,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,r,i))return;let s=this._properties[r];da(s)||(this._properties[r]=new Array(n),s=this._properties[r]),s[t]=ey(i)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,r){return t.unpack(t.typedArray,r)}_setBinaryProperty(t,r,i){t.pack(i,t.typedArray,r)}_initializeBinaryProperties(){let t=null;for(const r in this._properties){const i=this._properties[r],n=this._initializeBinaryProperty(r,i);n&&(t=t||{},t[r]=n)}return t}_initializeBinaryProperty(t,r){if("byteOffset"in r){const i=r;sn(this.binary,"Property ".concat(t," requires a batch table binary.")),sn(i.type,"Property ".concat(t," requires a type."));const n=$Q(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(t,r){if(!this._hierarchy)return!1;const i=dm(this._hierarchy,t,(n,s)=>{const a=n.classIds[s],o=n.classes[a].instances;return da(o[r])});return da(i)}_getPropertyNamesInHierarchy(t,r){dm(this._hierarchy,t,(i,n)=>{const s=i.classIds[n],a=i.classes[s].instances;for(const o in a)a.hasOwnProperty(o)&&r.indexOf(o)===-1&&r.push(o)})}_getHierarchyProperty(t,r){return dm(this._hierarchy,t,(i,n)=>{const s=i.classIds[n],a=i.classes[s],o=i.classIndexes[n],f=a.instances[r];return da(f)?da(f.typedArray)?this._getBinaryProperty(f,o):ey(f[o]):null})}_setHierarchyProperty(t,r,i,n){const s=dm(this._hierarchy,r,(a,o)=>{const f=a.classIds[o],m=a.classes[f],w=a.classIndexes[o],A=m.instances[i];return da(A)?(sn(o===r,'Inherited property "'.concat(i,'" is read-only.')),da(A.typedArray)?this._setBinaryProperty(A,w,n):A[w]=ey(n),!0):!1});return da(s)}}const k2=4;function uv(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=new DataView(t);if(e.magic=i.getUint32(r,!0),r+=k2,e.version=i.getUint32(r,!0),r+=k2,e.byteLength=i.getUint32(r,!0),r+=k2,e.version!==1)throw new Error("3D Tile Version ".concat(e.version," not supported"));return r}const up=4,lI="b3dm tile in legacy format.";function oS(e,t,r){const i=new DataView(t);let n;e.header=e.header||{};let s=i.getUint32(r,!0);r+=up;let a=i.getUint32(r,!0);r+=up;let o=i.getUint32(r,!0);r+=up;let f=i.getUint32(r,!0);return r+=up,o>=570425344?(r-=up*2,n=s,o=a,f=0,s=0,a=0,console.warn(lI)):f>=570425344&&(r-=up,n=o,o=s,f=a,s=0,a=0,console.warn(lI)),e.header.featureTableJsonByteLength=s,e.header.featureTableBinaryByteLength=a,e.header.batchTableJsonByteLength=o,e.header.batchTableBinaryByteLength=f,e.header.batchLength=n,r}function aS(e,t,r,i){return r=ttt(e,t,r),r=ett(e,t,r),r}function ttt(e,t,r,i){const{featureTableJsonByteLength:n,featureTableBinaryByteLength:s,batchLength:a}=e.header;if(e.featureTableJson={BATCH_LENGTH:a||0},n>0){const o=nk(t,r,n);e.featureTableJson=JSON.parse(o)}return r+=n,e.featureTableBinary=new Uint8Array(t,r,s),r+=s,r}function ett(e,t,r,i){const{batchTableJsonByteLength:n,batchTableBinaryByteLength:s}=e.header;if(n>0){const a=nk(t,r,n);e.batchTableJson=JSON.parse(a),r+=n,s>0&&(e.batchTableBinary=new Uint8Array(t,r,s),e.batchTableBinary=new Uint8Array(e.batchTableBinary),r+=s)}return r}function ak(e,t,r){if(!t&&(!e||!e.batchIds||!r))return null;const{batchIds:i,isRGB565:n,pointCount:s}=e;if(i&&r){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const f=i[o],m=r.getProperty(f,"dimensions").map(w=>w*255);a[o*3]=m[0],a[o*3+1]=m[1],a[o*3+2]=m[2]}return{type:Ei.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}if(n){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const f=UQ(t[o]);a[o*3]=f[0],a[o*3+1]=f[1],a[o*3+2]=f[2]}return{type:Ei.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}return t&&t.length===s*3?{type:Ei.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:Ei.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}const cI=new se;function rtt(e,t){if(!t)return null;if(e.isOctEncoded16P){const r=new Float32Array(e.pointsLength*3);for(let i=0;i<e.pointsLength;i++)VQ(t[i*2],t[i*2+1],cI),cI.toArray(r,i*3);return{type:Ei.FLOAT,size:2,value:r}}return{type:Ei.FLOAT,size:2,value:t}}function itt(e,t,r){return e.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,ntt(e,t)):{type:Ei.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function ntt(e,t){const r=new se,i=new Float32Array(e.pointCount*3);for(let n=0;n<e.pointCount;n++)r.set(t[n*3],t[n*3+1],t[n*3+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(i,n*3);return i}async function stt(e,t,r,i,n){r=uv(e,t,r),r=oS(e,t,r),r=aS(e,t,r),ott(e);const{featureTable:s,batchTable:a}=att(e);return await dtt(e,s,a,i,n),ltt(e,s,i),ctt(e,s,a),utt(e,s),r}function ott(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function att(e){const t=new sS(e.featureTableJson,e.featureTableBinary),r=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=r,e.featuresLength=r,e.pointsLength=r,e.pointCount=r,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",Ei.FLOAT,3);const i=htt(e,t);return{featureTable:t,batchTable:i}}function ltt(e,t,r){if(!e.attributes.positions){if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",Ei.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const i=t.getPropertyArray("POSITION_QUANTIZED",Ei.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Ei.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Ei.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=itt(e,i,r)}}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function ctt(e,t,r){if(!e.attributes.colors){let i=null;t.hasProperty("RGBA")?(i=t.getPropertyArray("RGBA",Ei.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?i=t.getPropertyArray("RGB",Ei.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(i=t.getPropertyArray("RGB565",Ei.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=ak(e,i,r)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",Ei.UNSIGNED_BYTE,4))}function utt(e,t){if(!e.attributes.normals){let r=null;t.hasProperty("NORMAL")?r=t.getPropertyArray("NORMAL",Ei.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(r=t.getPropertyArray("NORMAL_OCT16P",Ei.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=rtt(e,r)}}function htt(e,t){let r=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",Ei.UNSIGNED_SHORT,1),e.batchIds)){const i=t.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:n,batchTableBinary:s}=e;r=new ok(n,s,i)}return r}async function dtt(e,t,r,i,n){let s,a,o;const f=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];f&&(o=f.properties);const m=t.getExtension("3DTILES_draco_point_compression");if(m){a=m.properties;const A=m.byteOffset,P=m.byteLength;if(!a||!Number.isFinite(A)||!P)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=e.featureTableBinary.slice(A,A+P),e.hasPositions=Number.isFinite(a.POSITION),e.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),e.hasNormals=Number.isFinite(a.NORMAL),e.hasBatchIds=Number.isFinite(a.BATCH_ID),e.isTranslucent=Number.isFinite(a.RGBA)}if(!s)return!0;const w={buffer:s,properties:{...a,...o},featureTableProperties:a,batchTableProperties:o,dequantizeInShader:!1};return await ftt(e,w,i,n)}async function ftt(e,t,r,i){const{parse:n}=i,s={...r,draco:{...r.draco,extraAttributes:t.batchTableProperties||{}}};delete s["3d-tiles"];const a=await n(t.buffer,H6,s),o=a.attributes.POSITION&&a.attributes.POSITION.value,f=a.attributes.COLOR_0&&a.attributes.COLOR_0.value,m=a.attributes.NORMAL&&a.attributes.NORMAL.value,w=a.attributes.BATCH_ID&&a.attributes.BATCH_ID.value,A=o&&a.attributes.POSITION.value.quantization,P=m&&a.attributes.NORMAL.value.quantization;if(A){const N=a.POSITION.data.quantization,F=N.range;e.quantizedVolumeScale=new se(F,F,F),e.quantizedVolumeOffset=new se(N.minValues),e.quantizedRange=(1<<N.quantizationBits)-1,e.isQuantizedDraco=!0}P&&(e.octEncodedRange=(1<<a.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);const I={};if(t.batchTableProperties)for(const N of Object.keys(t.batchTableProperties))a.attributes[N]&&a.attributes[N].value&&(I[N.toLowerCase()]=a.attributes[N].value);e.attributes={positions:o,colors:ak(e,f,void 0),normals:m,batchIds:w,...I}}const Lx={URI:0,EMBEDDED:1};function lk(e,t,r,i){e.rotateYtoZ=!0;const n=e.byteOffset+e.byteLength-r;if(n===0)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=i["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=eA(t,r,n),e.gltfByteOffset=0,e.gltfByteLength=n,r%4===0||console.warn("".concat(e.type,": embedded glb is not aligned to a 4-byte boundary.")),e.byteOffset+e.byteLength}async function ck(e,t,r,i){const n=r["3d-tiles"]||{};if(ptt(e,t),n.loadGLTF){const{parse:s,fetch:a}=i;e.gltfUrl&&(e.gltfArrayBuffer=await a(e.gltfUrl,r),e.gltfByteOffset=0),e.gltfArrayBuffer&&(e.gltf=await s(e.gltfArrayBuffer,m0,r,i),e.gpuMemoryUsageInBytes=V6(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength)}}function ptt(e,t,r){switch(t){case Lx.URI:const i=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),n=new TextDecoder().decode(i);e.gltfUrl=n.replace(/[\s\0]+$/,""),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case Lx.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function gtt(e,t,r,i,n){var s;r=mtt(e,t,r,i),await ck(e,Lx.EMBEDDED,i,n);const a=e==null||(s=e.gltf)===null||s===void 0?void 0:s.extensions;return a&&a.CESIUM_RTC&&(e.rtcCenter=a.CESIUM_RTC.center),r}function mtt(e,t,r,i,n){r=uv(e,t,r),r=oS(e,t,r),r=aS(e,t,r),r=lk(e,t,r,i);const s=new sS(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=s.getGlobalProperty("RTC_CENTER",Ei.FLOAT,3),r}async function ytt(e,t,r,i,n){return r=_tt(e,t,r,i),await ck(e,e.gltfFormat,i,n),r}function _tt(e,t,r,i,n){if(r=uv(e,t,r),e.version!==1)throw new Error("Instanced 3D Model version ".concat(e.version," is not supported"));r=oS(e,t,r);const s=new DataView(t);if(e.gltfFormat=s.getUint32(r,!0),r+=4,r=aS(e,t,r),r=lk(e,t,r,i),e.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new sS(e.featureTableJson,e.featureTableBinary),o=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=o,!Number.isFinite(o))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=a.getGlobalProperty("RTC_CENTER",Ei.FLOAT,3);const f=new ok(e.batchTableJson,e.batchTableBinary,o);return vtt(e,a,f,o),r}function vtt(e,t,r,i){const n={instances:new Array(i),batchTable:e._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,s=new se;new se,new se,new se;const a=new $n,o=new h0,f=new se,m={},w=new di,A=[],P=[],I=new se,N=new se;for(let F=0;F<i;F++){let Z;if(t.hasProperty("POSITION"))Z=t.getProperty("POSITION",Ei.FLOAT,3,F,s);else if(t.hasProperty("POSITION_QUANTIZED")){Z=t.getProperty("POSITION_QUANTIZED",Ei.UNSIGNED_SHORT,3,F,s);const Et=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Ei.FLOAT,3,I);if(!Et)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const bt=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Ei.FLOAT,3,N);if(!bt)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const pt=65535;for(let zt=0;zt<3;zt++)Z[zt]=Z[zt]/pt*bt[zt]+Et[zt]}if(!Z)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(s.copy(Z),m.translation=s,e.normalUp=t.getProperty("NORMAL_UP",Ei.FLOAT,3,F,A),e.normalRight=t.getProperty("NORMAL_RIGHT",Ei.FLOAT,3,F,P),e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",Ei.UNSIGNED_SHORT,2,A),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",Ei.UNSIGNED_SHORT,2,P),e.octNormalUp)throw e.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");e.eastNorthUp?(Bn.WGS84.eastNorthUpToFixedFrame(s,w),w.getRotationMatrix3(a)):a.identity()}o.fromMatrix3(a),m.rotation=o,f.set(1,1,1);const U=t.getProperty("SCALE",Ei.FLOAT,1,F);Number.isFinite(U)&&f.multiplyByScalar(U);const z=t.getProperty("SCALE_NON_UNIFORM",Ei.FLOAT,3,F,A);z&&f.scale(z),m.scale=f;let J=t.getProperty("BATCH_ID",Ei.UNSIGNED_SHORT,1,F);J===void 0&&(J=F);const nt=new di().fromQuaternion(m.rotation);w.identity(),w.translate(m.translation),w.multiplyRight(nt),w.scale(m.scale);const mt=w.clone();n[F]={modelMatrix:mt,batchId:J}}e.instances=n}async function btt(e,t,r,i,n,s){r=uv(e,t,r);const a=new DataView(t);for(e.tilesLength=a.getUint32(r,!0),r+=4,e.tiles=[];e.tiles.length<e.tilesLength&&e.byteLength-r>12;){const o={};e.tiles.push(o),r=await s(t,r,i,n,o)}return r}async function wtt(e,t,r,i){e.rotateYtoZ=!0,e.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y";const{parse:n}=i;e.gltf=await n(t,m0,r,i),e.gpuMemoryUsageInBytes=V6(e.gltf)}async function uk(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(n.byteOffset=t,n.type=NQ(e,t),n.type){case hm.COMPOSITE:return await btt(n,e,t,r,i,uk);case hm.BATCHED_3D_MODEL:return await gtt(n,e,t,r,i);case hm.GLTF:return await wtt(n,e,r,i);case hm.INSTANCED_3D_MODEL:return await ytt(n,e,t,r,i);case hm.POINT_CLOUD:return await stt(n,e,t,r,i);default:throw new Error("3DTileLoader: unknown type ".concat(n.type))}}const xtt=1952609651,Att=1;async function Stt(e,t,r){if(new Uint32Array(e.slice(0,4))[0]!==xtt)throw new Error("Wrong subtree file magic number");if(new Uint32Array(e.slice(4,8))[0]!==Att)throw new Error("Wrong subtree file verson, must be 1");const i=uI(e.slice(8,16)),n=new Uint8Array(e,24,i),s=new TextDecoder("utf8").decode(n),a=JSON.parse(s),o=uI(e.slice(16,24));let f=new ArrayBuffer(0);return o&&(f=e.slice(24+i)),"bufferView"in a.tileAvailability&&(a.tileAvailability.explicitBitstream=await R2(a,"tileAvailability",f,r)),"bufferView"in a.contentAvailability&&(a.contentAvailability.explicitBitstream=await R2(a,"contentAvailability",f,r)),"bufferView"in a.childSubtreeAvailability&&(a.childSubtreeAvailability.explicitBitstream=await R2(a,"childSubtreeAvailability",f,r)),a}function Ett(e,t){if(t.startsWith("http")){const n=new URL(e,t);return decodeURI(n.toString())}const r="http://".concat(t),i=new URL(e,r);return"/".concat(i.host).concat(i.pathname)}async function R2(e,t,r,i){const n=e[t].bufferView,s=e.bufferViews[n],a=e.buffers[s.buffer];if(!(i!=null&&i.url)||!i.fetch)throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(a.uri){const o=Ett(a.uri,i==null?void 0:i.url),f=await(await i.fetch(o)).arrayBuffer();return new Uint8Array(f,s.byteOffset,s.byteLength)}return new Uint8Array(r,s.byteOffset,s.byteLength)}function uI(e){const t=new DataView(e),r=t.getUint32(0,!0),i=t.getUint32(4,!0);return r+2**32*i}const hk={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:ik,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:Stt,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Ml=null;try{Ml=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function qi(e,t,r){this.low=e|0,this.high=t|0,this.unsigned=!!r}qi.prototype.__isLong__;Object.defineProperty(qi.prototype,"__isLong__",{value:!0});function Eo(e){return(e&&e.__isLong__)===!0}function hI(e){var t=Math.clz32(e&-e);return e?31-t:t}qi.isLong=Eo;var dI={},fI={};function Rf(e,t){var r,i,n;return t?(e>>>=0,(n=0<=e&&e<256)&&(i=fI[e],i)?i:(r=Pi(e,0,!0),n&&(fI[e]=r),r)):(e|=0,(n=-128<=e&&e<128)&&(i=dI[e],i)?i:(r=Pi(e,e<0?-1:0,!1),n&&(dI[e]=r),r))}qi.fromInt=Rf;function Ll(e,t){if(isNaN(e))return t?rh:Sc;if(t){if(e<0)return rh;if(e>=dk)return gk}else{if(e<=-gI)return ya;if(e+1>=gI)return pk}return e<0?Ll(-e,t).neg():Pi(e%pg|0,e/pg|0,t)}qi.fromNumber=Ll;function Pi(e,t,r){return new qi(e,t,r)}qi.fromBits=Pi;var L_=Math.pow;function lS(e,t,r){if(e.length===0)throw Error("empty string");if(typeof t=="number"?(r=t,t=!1):t=!!t,e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return t?rh:Sc;if(r=r||10,r<2||36<r)throw RangeError("radix");var i;if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return lS(e.substring(1),t,r).neg();for(var n=Ll(L_(r,8)),s=Sc,a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),f=parseInt(e.substring(a,a+o),r);if(o<8){var m=Ll(L_(r,o));s=s.mul(m).add(Ll(f))}else s=s.mul(n),s=s.add(Ll(f))}return s.unsigned=t,s}qi.fromString=lS;function Lc(e,t){return typeof e=="number"?Ll(e,t):typeof e=="string"?lS(e,t):Pi(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}qi.fromValue=Lc;var pI=65536,Ctt=1<<24,pg=pI*pI,dk=pg*pg,gI=dk/2,mI=Rf(Ctt),Sc=Rf(0);qi.ZERO=Sc;var rh=Rf(0,!0);qi.UZERO=rh;var kp=Rf(1);qi.ONE=kp;var fk=Rf(1,!0);qi.UONE=fk;var Bx=Rf(-1);qi.NEG_ONE=Bx;var pk=Pi(-1,2147483647,!1);qi.MAX_VALUE=pk;var gk=Pi(-1,-1,!0);qi.MAX_UNSIGNED_VALUE=gk;var ya=Pi(0,-2147483648,!1);qi.MIN_VALUE=ya;var Ne=qi.prototype;Ne.toInt=function(){return this.unsigned?this.low>>>0:this.low};Ne.toNumber=function(){return this.unsigned?(this.high>>>0)*pg+(this.low>>>0):this.high*pg+(this.low>>>0)};Ne.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ya)){var t=Ll(e),r=this.div(t),i=r.mul(t).sub(this);return r.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var n=Ll(L_(e,6),this.unsigned),s=this,a="";;){var o=s.div(n),f=s.sub(o.mul(n)).toInt()>>>0,m=f.toString(e);if(s=o,s.isZero())return m+a;for(;m.length<6;)m="0"+m;a=""+m+a}};Ne.getHighBits=function(){return this.high};Ne.getHighBitsUnsigned=function(){return this.high>>>0};Ne.getLowBits=function(){return this.low};Ne.getLowBitsUnsigned=function(){return this.low>>>0};Ne.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ya)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};Ne.isZero=function(){return this.high===0&&this.low===0};Ne.eqz=Ne.isZero;Ne.isNegative=function(){return!this.unsigned&&this.high<0};Ne.isPositive=function(){return this.unsigned||this.high>=0};Ne.isOdd=function(){return(this.low&1)===1};Ne.isEven=function(){return(this.low&1)===0};Ne.equals=function(e){return Eo(e)||(e=Lc(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Ne.eq=Ne.equals;Ne.notEquals=function(e){return!this.eq(e)};Ne.neq=Ne.notEquals;Ne.ne=Ne.notEquals;Ne.lessThan=function(e){return this.comp(e)<0};Ne.lt=Ne.lessThan;Ne.lessThanOrEqual=function(e){return this.comp(e)<=0};Ne.lte=Ne.lessThanOrEqual;Ne.le=Ne.lessThanOrEqual;Ne.greaterThan=function(e){return this.comp(e)>0};Ne.gt=Ne.greaterThan;Ne.greaterThanOrEqual=function(e){return this.comp(e)>=0};Ne.gte=Ne.greaterThanOrEqual;Ne.ge=Ne.greaterThanOrEqual;Ne.compare=function(e){if(Eo(e)||(e=Lc(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Ne.comp=Ne.compare;Ne.negate=function(){return!this.unsigned&&this.eq(ya)?ya:this.not().add(kp)};Ne.neg=Ne.negate;Ne.add=function(e){Eo(e)||(e=Lc(e));var t=this.high>>>16,r=this.high&65535,i=this.low>>>16,n=this.low&65535,s=e.high>>>16,a=e.high&65535,o=e.low>>>16,f=e.low&65535,m=0,w=0,A=0,P=0;return P+=n+f,A+=P>>>16,P&=65535,A+=i+o,w+=A>>>16,A&=65535,w+=r+a,m+=w>>>16,w&=65535,m+=t+s,m&=65535,Pi(A<<16|P,m<<16|w,this.unsigned)};Ne.subtract=function(e){return Eo(e)||(e=Lc(e)),this.add(e.neg())};Ne.sub=Ne.subtract;Ne.multiply=function(e){if(this.isZero())return this;if(Eo(e)||(e=Lc(e)),Ml){var t=Ml.mul(this.low,this.high,e.low,e.high);return Pi(t,Ml.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?rh:Sc;if(this.eq(ya))return e.isOdd()?ya:Sc;if(e.eq(ya))return this.isOdd()?ya:Sc;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(mI)&&e.lt(mI))return Ll(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,i=this.high&65535,n=this.low>>>16,s=this.low&65535,a=e.high>>>16,o=e.high&65535,f=e.low>>>16,m=e.low&65535,w=0,A=0,P=0,I=0;return I+=s*m,P+=I>>>16,I&=65535,P+=n*m,A+=P>>>16,P&=65535,P+=s*f,A+=P>>>16,P&=65535,A+=i*m,w+=A>>>16,A&=65535,A+=n*f,w+=A>>>16,A&=65535,A+=s*o,w+=A>>>16,A&=65535,w+=r*m+i*f+n*o+s*a,w&=65535,Pi(P<<16|I,w<<16|A,this.unsigned)};Ne.mul=Ne.multiply;Ne.divide=function(e){if(Eo(e)||(e=Lc(e)),e.isZero())throw Error("division by zero");if(Ml){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ml.div_u:Ml.div_s)(this.low,this.high,e.low,e.high);return Pi(t,Ml.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?rh:Sc;var r,i,n;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return rh;if(e.gt(this.shru(1)))return fk;n=rh}else{if(this.eq(ya)){if(e.eq(kp)||e.eq(Bx))return ya;if(e.eq(ya))return kp;var s=this.shr(1);return r=s.div(e).shl(1),r.eq(Sc)?e.isNegative()?kp:Bx:(i=this.sub(e.mul(r)),n=r.add(i.div(e)),n)}else if(e.eq(ya))return this.unsigned?rh:Sc;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();n=Sc}for(i=this;i.gte(e);){r=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),o=a<=48?1:L_(2,a-48),f=Ll(r),m=f.mul(e);m.isNegative()||m.gt(i);)r-=o,f=Ll(r,this.unsigned),m=f.mul(e);f.isZero()&&(f=kp),n=n.add(f),i=i.sub(m)}return n};Ne.div=Ne.divide;Ne.modulo=function(e){if(Eo(e)||(e=Lc(e)),Ml){var t=(this.unsigned?Ml.rem_u:Ml.rem_s)(this.low,this.high,e.low,e.high);return Pi(t,Ml.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Ne.mod=Ne.modulo;Ne.rem=Ne.modulo;Ne.not=function(){return Pi(~this.low,~this.high,this.unsigned)};Ne.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};Ne.clz=Ne.countLeadingZeros;Ne.countTrailingZeros=function(){return this.low?hI(this.low):hI(this.high)+32};Ne.ctz=Ne.countTrailingZeros;Ne.and=function(e){return Eo(e)||(e=Lc(e)),Pi(this.low&e.low,this.high&e.high,this.unsigned)};Ne.or=function(e){return Eo(e)||(e=Lc(e)),Pi(this.low|e.low,this.high|e.high,this.unsigned)};Ne.xor=function(e){return Eo(e)||(e=Lc(e)),Pi(this.low^e.low,this.high^e.high,this.unsigned)};Ne.shiftLeft=function(e){return Eo(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Pi(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Pi(0,this.low<<e-32,this.unsigned)};Ne.shl=Ne.shiftLeft;Ne.shiftRight=function(e){return Eo(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Pi(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Pi(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Ne.shr=Ne.shiftRight;Ne.shiftRightUnsigned=function(e){return Eo(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Pi(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Pi(this.high,0,this.unsigned):Pi(this.high>>>e-32,0,this.unsigned)};Ne.shru=Ne.shiftRightUnsigned;Ne.shr_u=Ne.shiftRightUnsigned;Ne.rotateLeft=function(e){var t;return Eo(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Pi(this.high,this.low,this.unsigned):e<32?(t=32-e,Pi(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,Pi(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))};Ne.rotl=Ne.rotateLeft;Ne.rotateRight=function(e){var t;return Eo(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Pi(this.high,this.low,this.unsigned):e<32?(t=32-e,Pi(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,Pi(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))};Ne.rotr=Ne.rotateRight;Ne.toSigned=function(){return this.unsigned?Pi(this.low,this.high,!1):this};Ne.toUnsigned=function(){return this.unsigned?this:Pi(this.low,this.high,!0)};Ne.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Ne.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Ne.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};qi.fromBytes=function(e,t,r){return r?qi.fromBytesLE(e,t):qi.fromBytesBE(e,t)};qi.fromBytesLE=function(e,t){return new qi(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};qi.fromBytesBE=function(e,t){return new qi(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const Ttt=16;function mk(e){e==="X"&&(e="");const t=e.padEnd(Ttt,"0");return qi.fromString(t,!0,16)}function Ptt(e){if(e.isZero())return"X";let t=e.countTrailingZeros();const r=t%4;t=(t-r)/4;const i=t;t*=4;const n=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-i-n.length).join("0")+n}function Itt(e,t){const r=Mtt(e).shiftRightUnsigned(2);return e.add(qi.fromNumber(2*t+1-4).multiply(r))}function Mtt(e){return e.and(e.not().add(1))}const Ltt=3,Btt=30,ktt=2*Btt+1,yI=180/Math.PI;function Rtt(e){if(e.length===0)throw new Error("Invalid Hilbert quad key ".concat(e));const t=e.split("/"),r=parseInt(t[0],10),i=t[1],n=i.length;let s=0;const a=[0,0];for(let o=n-1;o>=0;o--){s=n-o;const f=i[o];let m=0,w=0;f==="1"?w=1:f==="2"?(m=1,w=1):f==="3"&&(m=1);const A=Math.pow(2,s-1);Dtt(A,a,m,w),a[0]+=A*m,a[1]+=A*w}if(r%2===1){const o=a[0];a[0]=a[1],a[1]=o}return{face:r,ij:a,level:s}}function Ott(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<Ltt+ktt;)t="0"+t;const r=t.lastIndexOf("1"),i=t.substring(0,3),n=t.substring(3,r),s=n.length/2,a=qi.fromString(i,!0,2).toString(10);let o="";if(s!==0)for(o=qi.fromString(n,!0,2).toString(4);o.length<s;)o="0"+o;return"".concat(a,"/").concat(o)}function yk(e,t,r){const i=1<<t;return[(e[0]+r[0])/i,(e[1]+r[1])/i]}function _I(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function _k(e){return[_I(e[0]),_I(e[1])]}function vk(e,t){let[r,i]=t;switch(e){case 0:return[1,r,i];case 1:return[-r,1,i];case 2:return[-r,-i,1];case 3:return[-1,-i,-r];case 4:return[i,-1,-r];case 5:return[i,r,-1];default:throw new Error("Invalid face")}}function bk(e){let[t,r,i]=e;const n=Math.atan2(i,Math.sqrt(t*t+r*r));return[Math.atan2(r,t)*yI,n*yI]}function Dtt(e,t,r,i){if(i===0){r===1&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const n=t[0];t[0]=t[1],t[1]=n}}function Ntt(e){const t=yk(e.ij,e.level,[.5,.5]),r=_k(t),i=vk(e.face,r);return bk(i)}const Ftt=100;function vI(e){const{face:t,ij:r,level:i}=e,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(Ftt*Math.pow(2,-i))),a=new Float64Array(4*s*2+2);let o=0,f=0;for(let m=0;m<4;m++){const w=n[m].slice(0),A=n[m+1],P=(A[0]-w[0])/s,I=(A[1]-w[1])/s;for(let N=0;N<s;N++){w[0]+=P,w[1]+=I;const F=yk(r,i,w),Z=_k(F),U=vk(t,Z),z=bk(U);Math.abs(z[1])>89.999&&(z[0]=f);const J=z[0]-f;z[0]+=J>180?-360:J<-180?360:0,a[o++]=z[0],a[o++]=z[1],f=z[0]}}return a[o++]=a[0],a[o++]=a[1],a}function cS(e){const t=ztt(e);return Rtt(t)}function ztt(e){if(e.indexOf("/")>0)return e;const t=mk(e);return Ott(t)}function jtt(e){const t=cS(e);return Ntt(t)}function Utt(e){let t;if(e.face===2||e.face===5){let r=null,i=0;for(let n=0;n<4;n++){const s="".concat(e.face,"/").concat(n),a=cS(s),o=vI(a);(typeof r>"u"||r===null)&&(r=new Float64Array(4*o.length)),r.set(o,i),i+=o.length}t=bI(r)}else{const r=vI(e);t=bI(r)}return t}function bI(e){if(e.length%2!==0)throw new Error("Invalid corners");const t=[],r=[];for(let i=0;i<e.length;i+=2)t.push(e[i]),r.push(e[i+1]);return t.sort((i,n)=>i-n),r.sort((i,n)=>i-n),{west:t[0],east:t[t.length-1],north:r[r.length-1],south:r[0]}}function Gtt(e,t){const r=(t==null?void 0:t.minimumHeight)||0,i=(t==null?void 0:t.maximumHeight)||0,n=cS(e),s=Utt(n),a=s.west,o=s.south,f=s.east,m=s.north,w=[];return w.push(new se(a,m,r)),w.push(new se(f,m,r)),w.push(new se(f,o,r)),w.push(new se(a,o,r)),w.push(new se(a,m,i)),w.push(new se(f,m,i)),w.push(new se(f,o,i)),w.push(new se(a,o,i)),w}function wk(e){const t=e.token,r={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},i=Gtt(t,r),n=jtt(t),s=n[0],a=n[1],o=Bn.WGS84.cartographicToCartesian([s,a,r.maximumHeight]),f=new se(o[0],o[1],o[2]);i.push(f);const m=pJ(i);return[...m.center,...m.halfAxes]}const Vtt=4,qtt=8,Htt={QUADTREE:Vtt,OCTREE:qtt};function Wtt(e,t,r){if(e!=null&&e.box){const i=mk(e.s2VolumeInfo.token),n=Itt(i,t),s=Ptt(n),a={...e.s2VolumeInfo};switch(a.token=s,r){case"OCTREE":const o=e.s2VolumeInfo,f=o.maximumHeight-o.minimumHeight,m=f/2,w=o.minimumHeight+f/2;o.minimumHeight=w-m,o.maximumHeight=w+m;break}return{box:wk(a),s2VolumeInfo:a}}}async function xk(e){const{options:t,parentData:r={mortonIndex:0,x:0,y:0,z:0},childIndex:i=0,globalData:n={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:s}=e;let{subtree:a,level:o=0}=e;const{subdivisionScheme:f,subtreeLevels:m,maximumLevel:w,contentUrlTemplate:A,subtreesUriTemplate:P,basePath:I}=t,N={children:[],lodMetricValue:0,contentUrl:""},F=Htt[f],Z=i&1,U=i>>1&1,z=i>>2&1,J=(F**o-1)/(F-1);let nt=Kd(r.mortonIndex,i),mt=J+nt,Et=Kd(r.x,Z),bt=Kd(r.y,U),pt=Kd(r.z,z),zt=!1;o+1>m&&(zt=O2(a.childSubtreeAvailability,nt));const Rt=Kd(n.x,Et),at=Kd(n.y,bt),dt=Kd(n.z,pt),kt=o+n.level;if(zt){const oe="".concat(I,"/").concat(P),he=kx(oe,kt,Rt,at,dt);a=await wd(he,hk),n.mortonIndex=nt,n.x=Et,n.y=bt,n.z=pt,n.level=o,nt=0,mt=0,Et=0,bt=0,pt=0,o=0}if(!O2(a.tileAvailability,mt)||o>w)return N;O2(a.contentAvailability,mt)&&(N.contentUrl=kx(A,kt,Rt,at,dt));const xt=o+1,ue={mortonIndex:nt,x:Et,y:bt,z:pt};for(let oe=0;oe<F;oe++){const he=Wtt(s,oe,f),Dt=await xk({subtree:a,options:t,parentData:ue,childIndex:oe,level:xt,globalData:n,s2VolumeBox:he});if(Dt.contentUrl||Dt.children.length){const Qt=kt+1,ee=$tt(Dt,Qt,{childTileX:Et,childTileY:bt,childTileZ:pt},t,s);N.children.push(ee)}}return N}function O2(e,t){return"constant"in e?!!e.constant:e.explicitBitstream?Xtt(t,e.explicitBitstream):!1}function $tt(e,t,r,i,n){const{basePath:s,refine:a,getRefine:o,lodMetricType:f,getTileType:m,rootLodMetricValue:w,rootBoundingVolume:A}=i,P=e.contentUrl&&e.contentUrl.replace("".concat(s,"/"),""),I=w/2**t,N=n!=null&&n.box?{box:n.box}:A,F=Ztt(t,N,r);return{children:e.children,contentUrl:e.contentUrl,content:{uri:P},id:e.contentUrl,refine:o(a),type:m(e),lodMetricType:f,lodMetricValue:I,geometricError:I,transform:e.transform,boundingVolume:F}}function Ztt(e,t,r){if(t.region){const{childTileX:i,childTileY:n,childTileZ:s}=r,[a,o,f,m,w,A]=t.region,P=2**e,I=(f-a)/P,N=(m-o)/P,F=(A-w)/P,[Z,U]=[a+I*i,a+I*(i+1)],[z,J]=[o+N*n,o+N*(n+1)],[nt,mt]=[w+F*s,w+F*(s+1)];return{region:[Z,z,U,J,nt,mt]}}if(t.box)return t;throw new Error("Unsupported bounding volume type ".concat(t))}function Kd(e,t){return parseInt(e.toString(2)+t.toString(2),2)}function kx(e,t,r,i,n){const s=Jtt({level:t,x:r,y:i,z:n});return e.replace(/{level}|{x}|{y}|{z}/gi,a=>s[a])}function Jtt(e){const t={};for(const r in e)t["{".concat(r,"}")]=e[r];return t}function Xtt(e,t){const r=Math.floor(e/8),i=e%8;return(t[r]>>i&1)===1}function uS(e){if(!e.contentUrl)return Hp.EMPTY;const t=e.contentUrl.split("?")[0].split(".").pop();switch(t){case"pnts":return Hp.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Hp.SCENEGRAPH;default:return t}}function hS(e){switch(e){case"REPLACE":case"replace":return sh.REPLACE;case"ADD":case"add":return sh.ADD;default:return e}}function Rx(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const r=new URL(e,"".concat(t,"/"));return decodeURI(r.toString())}else if(e.startsWith("/"))return e;return"".concat(t,"/").concat(e)}function wI(e,t){if(!e)return null;if(e.content){const r=e.content.uri||e.content.url;e.contentUrl=Rx(r,t.basePath)}return e.id=e.contentUrl,e.lodMetricType=lv.GEOMETRIC_ERROR,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform,e.type=uS(e),e.refine=hS(e.refine),e}async function Ktt(e,t){const r=e.basePath;let i;const n=AI(e==null?void 0:e.root);n&&e.root?i=await xI(e.root,e,n,t):i=wI(e.root,e);const s=[];for(s.push(i);s.length>0;){const a=(s.pop()||{}).children||[];for(let o of a){const f=AI(o);f?o=await xI(o,e,f,t):wI(o,{basePath:r}),s.push(o)}}return i}async function xI(e,t,r,i){var n,s;const a=t.basePath,{subdivisionScheme:o,maximumLevel:f,subtreeLevels:m,subtrees:{uri:w}}=r,A=kx(w,0,0,0,0),P=Rx(A,a),I=await wd(P,hk,i),N=Rx(e.content.uri,a),F=t==null||(n=t.root)===null||n===void 0?void 0:n.refine,Z=e.geometricError,U=(s=e.boundingVolume.extensions)===null||s===void 0?void 0:s["3DTILES_bounding_volume_S2"];if(U){const nt={box:wk(U),s2VolumeInfo:U};e.boundingVolume=nt}const z=e.boundingVolume,J={contentUrlTemplate:N,subtreesUriTemplate:w,subdivisionScheme:o,subtreeLevels:m,maximumLevel:f,refine:F,basePath:a,lodMetricType:lv.GEOMETRIC_ERROR,rootLodMetricValue:Z,rootBoundingVolume:z,getTileType:uS,getRefine:hS};return await Ytt(e,I,J)}async function Ytt(e,t,r){if(!e)return null;e.lodMetricType=lv.GEOMETRIC_ERROR,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform;const{children:i,contentUrl:n}=await xk({subtree:t,options:r,s2VolumeBox:e});return n&&(e.contentUrl=n,e.content={uri:n.replace("".concat(r.basePath,"/"),"")}),e.refine=hS(e.refine),e.type=uS(e),e.children=i,e.id=e.contentUrl,e}function AI(e){var t;return(e==null||(t=e.extensions)===null||t===void 0?void 0:t["3DTILES_implicit_tiling"])||(e==null?void 0:e.implicitTiling)}const dS={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:ik,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:ret,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function Qtt(e){return rA(e.url)}async function tet(e,t,r){const i={content:{featureIds:null}};return await uk(e,0,t,r,i.content),i.content}async function eet(e,t,r){var i;const n=JSON.parse(new TextDecoder().decode(e));return n.loader=t.loader||dS,n.url=r.url,n.queryString=r.queryString,n.basePath=Qtt(n),n.root=await Ktt(n,t),n.type=xl.TILES3D,n.lodMetricType=lv.GEOMETRIC_ERROR,n.lodMetricValue=((i=n.root)===null||i===void 0?void 0:i.lodMetricValue)||0,n}async function ret(e,t,r){const i=t["3d-tiles"]||{};let n;return i.isTileset==="auto"?n=r.url&&r.url.indexOf(".json")!==-1:n=i.isTileset,n?e=await eet(e,t,r):e=await tet(e,t,r),e}const SI=[0],iet={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:dS,onTilesetLoad:{type:"function",value:e=>{}},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:(e,t,r)=>{}},_getMeshColor:{type:"function",value:e=>[255,255,255]}};class fS extends S6{constructor(){super(...arguments),$(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&xi.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var t,r;return!!(!((t=this.state)===null||t===void 0||(r=t.tileset3d)===null||r===void 0)&&r.isLoaded()&&super.isLoaded)}shouldUpdateState(t){let{changeFlags:r}=t;return r.somethingChanged}updateState(t){let{props:r,oldProps:i,changeFlags:n}=t;if(r.data&&r.data!==i.data&&this._loadTileset(r.data),n.viewportChanged){const{activeViewports:s}=this.state;Object.keys(s).length&&(this._updateTileset(s),this.state.lastUpdatedViewports=s,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:s}=this.state;for(const a in s)s[a].needsUpdate=!0}}activateViewport(t){const{activeViewports:r,lastUpdatedViewports:i}=this.state;this.internalState.viewport=t,r[t.id]=t;const n=i==null?void 0:i[t.id];(!n||!t.equals(n))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(t){let{info:r,sourceLayer:i}=t;const n=i&&i.props.tile;return r.picked&&(r.object=n),r.sourceTile=n,r}filterSubLayer(t){let{layer:r,viewport:i}=t;const{tile:n}=r.props,{id:s}=i;return n.selected&&n.viewportIds.includes(s)}_updateAutoHighlight(t){const r=t.sourceTile,i=this.state.layerMap[r==null?void 0:r.id];i&&i.layer&&i.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:r={}}=this.props;let i=this.props.loader||this.props.loaders;Array.isArray(i)&&(i=i[0]);const n={loadOptions:{...r}};let s=t;if(i.preload){const f=await i.preload(t,r);f.url&&(s=f.url),f.headers&&(n.loadOptions.fetch={...n.loadOptions.fetch,headers:f.headers}),Object.assign(n,f)}const a=await wd(s,i,n.loadOptions),o=new DQ(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...n});this.setState({tileset3d:o,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(o)}_onTileLoad(t){const{lastUpdatedViewports:r}=this.state;this.props.onTileLoad(t),this._updateTileset(r),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:r}=this.state,{timeline:i}=this.context,n=Object.keys(t).length;!i||!n||!r||r.selectTiles(Object.values(t)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(t,r){if(!t.content)return null;switch(t.type){case Hp.POINTCLOUD:return this._makePointCloudLayer(t,r);case Hp.SCENEGRAPH:return this._make3DModelLayer(t);case Hp.MESH:return this._makeSimpleMeshLayer(t,r);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(t.content.type))}}_makePointCloudLayer(t,r){const{attributes:i,pointCount:n,constantRGBA:s,cartographicOrigin:a,modelMatrix:o}=t.content,{positions:f,normals:m,colors:w}=i;if(!f)return null;const A=r&&r.props.data||{header:{vertexCount:n},attributes:{POSITION:f,NORMAL:m,COLOR_0:w}},{pointSize:P,getPointColor:I}=this.props,N=this.getSubLayerClass("pointcloud",JA);return new N({pointSize:P},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(t.id),tile:t,data:A,coordinateSystem:vi.METER_OFFSETS,coordinateOrigin:a,modelMatrix:o,getColor:s||I,_offset:0})}_make3DModelLayer(t){const{gltf:r,instances:i,cartographicOrigin:n,modelMatrix:s}=t.content,a=this.getSubLayerClass("scenegraph",iS);return new a({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(t.id),tile:t,data:i||SI,scenegraph:r,coordinateSystem:vi.METER_OFFSETS,coordinateOrigin:n,modelMatrix:s,getTransformMatrix:o=>o.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,r){const i=t.content,{attributes:n,indices:s,modelMatrix:a,cartographicOrigin:o,coordinateSystem:f=vi.METER_OFFSETS,material:m,featureIds:w}=i,{_getMeshColor:A}=this.props,P=r&&r.props.mesh||new jm({drawMode:4,attributes:net(n),indices:s}),I=this.getSubLayerClass("mesh",nS);return new I(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(t.id),tile:t,mesh:P,data:SI,getColor:A(t),pbrMaterial:m,modelMatrix:a,coordinateOrigin:o,coordinateSystem:f,featureIds:w,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:r}=this.state;return t?t.tiles.map(i=>{const n=r[i.id]=r[i.id]||{tile:i};let{layer:s}=n;return i.selected&&(s?n.needsUpdate&&(s=this._getSubLayer(i,s),n.needsUpdate=!1):s=this._getSubLayer(i)),n.layer=s,s}).filter(Boolean):null}}$(fS,"defaultProps",iet);$(fS,"layerName","Tile3DLayer");function net(e){const t={};return t.positions={...e.positions,value:new Float32Array(e.positions.value)},e.normals&&(t.normals=e.normals),e.texCoords&&(t.texCoords=e.texCoords),e.colors&&(t.colors=e.colors),e.uvRegions&&(t.uvRegions=e.uvRegions),t}var set=Object.defineProperty,oet=(e,t,r)=>t in e?set(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Di=(e,t,r)=>(oet(e,typeof t!="symbol"?t+"":t,r),r);class aet{constructor(t){Di(this,"map"),Di(this,"width"),Di(this,"height"),Di(this,"svgCanvas"),Di(this,"xLine"),Di(this,"yLine"),Di(this,"color","#535353"),this.map=t,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var t,r;this.width=(t=this.map)==null?void 0:t.getCanvas().clientWidth,this.height=(r=this.map)==null?void 0:r.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const t=this.width/2,r=this.height/2;this.yLine.setAttribute("x1",`${t}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${t}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${r}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${r}px`)}else console.error("element value is null")}createCanvas(t){if(this.width!==void 0&&this.height!==void 0){const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.style.position="relative",r.setAttribute("width",`${this.width}px`),r.setAttribute("height",`${this.height}px`);const i=this.width/2,n=this.height/2;this.yLine=r.appendChild(this.createLine(i,0,i,this.height,this.color,"2px")),this.xLine=r.appendChild(this.createLine(0,n,this.width,n,this.color,"2px")),t==null||t.appendChild(r),this.svgCanvas=r}}createLine(t,r,i,n,s,a){const o=document.createElementNS("http://www.w3.org/2000/svg","line");return o.setAttribute("x1",t),o.setAttribute("y1",r),o.setAttribute("x2",i),o.setAttribute("y2",n),o.setAttribute("stroke-dasharray","5,5"),o.setAttribute("stroke",s),o.setAttribute("stroke-width",a),o}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}}const Ox={72:72,96:96,200:200,300:300,400:400},Xu={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},Sm={Landscape:"landscape",Portrait:"portrait"},ff={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},gg={in:"in",mm:"mm"};class cet{constructor(t){Di(this,"map"),Di(this,"width"),Di(this,"height"),Di(this,"unit"),Di(this,"svgCanvas"),Di(this,"svgPath");var r,i,n;if(this.map=t,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const s=(r=this.map)==null?void 0:r.getCanvas().clientWidth,a=(i=this.map)==null?void 0:i.getCanvas().clientHeight,o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.style.position="absolute",o.style.top="0px",o.style.left="0px",o.setAttribute("width",`${s}px`),o.setAttribute("height",`${a}px`);const f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("style","fill:#888888;stroke-width:0"),f.setAttribute("fill-opacity","0.5"),o.append(f),(n=this.map)==null||n.getCanvasContainer().appendChild(o),this.svgCanvas=o,this.svgPath=f}mapResize(){this.generateCutOut()}updateArea(t,r){this.width=t,this.height=r,this.unit=gg.mm,this.generateCutOut()}generateCutOut(){var t,r;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const i=this.toPixels(this.width),n=this.toPixels(this.height),s=(t=this.map)==null?void 0:t.getCanvas().clientWidth,a=(r=this.map)==null?void 0:r.getCanvas().clientHeight,o=s/2-i/2,f=o+i,m=a/2-n/2,w=m+n;this.svgCanvas.setAttribute("width",`${s}px`),this.svgCanvas.setAttribute("height",`${a}px`),this.svgPath.setAttribute("d",`M 0 0 L ${s} 0 L ${s} ${a} L 0 ${a} M ${o} ${m} L ${o} ${w} L ${f} ${w} L ${f} ${m}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===gg.mm&&(r/=25.4),r*t}}const EI={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate",LanguageName:"English"},uet={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Générer",LanguageName:"French"},het={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi",LanguageName:"Finish"},det={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflösung",Generate:"Erstellen",LanguageName:"German"},fet={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera",LanguageName:"Swedish"},pet={PageSize:"Tamaño de página",PageOrientation:"Orientación de página",Format:"Formato",DPI:"DPI",Generate:"Generar",LanguageName:"Spanish"},get={PageSize:"Kích thước trang",PageOrientation:"Loại trang",Format:"Định dạng",DPI:"Mật độ điểm ảnh (DPI)",Generate:"Tạo",LanguageName:"Vietnam"},met={PageSize:"Розмір сторінки",PageOrientation:"Орієнтація сторінки",Format:"Формат",DPI:"DPI",Generate:"Згенерувати",LanguageName:"Ukranian"},yet={PageSize:"页面大小",PageOrientation:"页面方向",Format:"格式",DPI:"像素",Generate:"导出",LanguageName:"Chinese simplified"},_et={PageSize:"頁面大小",PageOrientation:"頁面方向",Format:"格式",DPI:"像素",Generate:"導出",LanguageName:"Chinese traditional"},vet={PageSize:"ページサイズ",PageOrientation:"ページ方向",Format:"フォーマット",DPI:"DPI（解像度）",Generate:"出力",LanguageName:"Japanese"},bet=e=>{switch(e){case"de":return det;case"en":return EI;case"fr":return uet;case"fi":return het;case"sv":return fet;case"es":return pet;case"vi":return get;case"uk":return met;case"zhHans":return yet;case"zhHant":return _et;case"ja":return vet;default:return EI}};(function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(i,n,s){r.o(i,n)||Object.defineProperty(i,n,{enumerable:!0,get:s})},r.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},r.t=function(i,n){if(1&n&&(i=r(i)),8&n||4&n&&typeof i=="object"&&i&&i.__esModule)return i;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:i}),2&n&&typeof i!="string")for(var a in i)r.d(s,a,(function(o){return i[o]}).bind(null,a));return s},r.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return r.d(n,"a",n),n},r.o=function(i,n){return Object.prototype.hasOwnProperty.call(i,n)},r.p="",r(r.s=0)})([function(e,t,r){e.exports=r(1)},function(e,t){function r(n,s){for(var a=0;a<s.length;a++){var o=s[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}var i=function(){function n(){(function(o,f){if(!(o instanceof f))throw new TypeError("Cannot call a class as a function")})(this,n),this.options={overlayBackgroundColor:"#666666",overlayOpacity:.6,spinnerIcon:"ball-circus",spinnerColor:"#000",spinnerSize:"3x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetY:0,offsetX:0,lockScroll:!1,containerID:null,spinnerZIndex:99999,overlayZIndex:99998},this.stylesheetBaseURL="https://cdn.jsdelivr.net/npm/load-awesome@1.1.0/css/",this.spinner=null,this.spinnerStylesheetURL=null,this.numberOfEmptyDivForSpinner={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":1,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1}}var s,a;return s=n,(a=[{key:"show",value:function(o){this.setOptions(o),this.addSpinnerStylesheet(),this.generateSpinnerElement(),this.options.lockScroll&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),this.generateAndAddOverlayElement()}},{key:"hide",value:function(){this.options.lockScroll&&(document.body.style.overflow="",document.documentElement.style.overflow="");var o=document.getElementById("loading-overlay-stylesheet");o&&(o.disabled=!0,o.parentNode.removeChild(o),document.getElementById(this.options.overlayIDName).remove(),document.getElementById(this.options.spinnerIDName).remove())}},{key:"setOptions",value:function(o){if(o!==void 0)for(var f in o)this.options[f]=o[f]}},{key:"generateAndAddOverlayElement",value:function(){var o="50%";this.options.offsetX!==0&&(o="calc(50% + "+this.options.offsetX+")");var f="50%";if(this.options.offsetY!==0&&(f="calc(50% + "+this.options.offsetY+")"),this.options.containerID&&document.body.contains(document.getElementById(this.options.containerID))){var m='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: absolute; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,'; z-index: 50; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: absolute; top: ').concat(f,"; left: ").concat(o,'; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: 9999;">').concat(this.spinner,"</div>"),w=document.getElementById(this.options.containerID);return w.style.position="relative",void w.insertAdjacentHTML("beforeend",m)}var A='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: fixed; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,"; z-index: ").concat(this.options.overlayZIndex,'; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: fixed; top: ').concat(f,"; left: ").concat(o,"; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: ").concat(this.options.spinnerZIndex,';">').concat(this.spinner,"</div>");document.body.insertAdjacentHTML("beforeend",A)}},{key:"generateSpinnerElement",value:function(){var o=this,f=Object.keys(this.numberOfEmptyDivForSpinner).find(function(w){return w===o.options.spinnerIcon}),m=this.generateEmptyDivElement(this.numberOfEmptyDivForSpinner[f]);this.spinner='<div style="color: '.concat(this.options.spinnerColor,'" class="la-').concat(this.options.spinnerIcon," la-").concat(this.options.spinnerSize,'">').concat(m,"</div>")}},{key:"addSpinnerStylesheet",value:function(){this.setSpinnerStylesheetURL();var o=document.createElement("link");o.setAttribute("id","loading-overlay-stylesheet"),o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href",this.spinnerStylesheetURL),document.getElementsByTagName("head")[0].appendChild(o)}},{key:"setSpinnerStylesheetURL",value:function(){this.spinnerStylesheetURL=this.stylesheetBaseURL+this.options.spinnerIcon+".min.css"}},{key:"generateEmptyDivElement",value:function(o){for(var f="",m=1;m<=o;m++)f+="<div></div>";return f}}])&&r(s.prototype,a),n}();window.JsLoadingOverlay=new i,e.exports=JsLoadingOverlay}]);function Gi(e){"@babel/helpers - typeof";return Gi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gi(e)}var Jo=Uint8Array,Xo=Uint16Array,y0=Uint32Array,hv=new Jo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),dv=new Jo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Dx=new Jo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ak=function(e,t){for(var r=new Xo(31),i=0;i<31;++i)r[i]=t+=1<<e[i-1];for(var n=new y0(r[30]),i=1;i<30;++i)for(var s=r[i];s<r[i+1];++s)n[s]=s-r[i]<<5|i;return[r,n]},Sk=Ak(hv,2),Ek=Sk[0],Nx=Sk[1];Ek[28]=258,Nx[258]=28;var Ck=Ak(dv,0),wet=Ck[0],CI=Ck[1],Fx=new Xo(32768);for(var yn=0;yn<32768;++yn){var Jh=(yn&43690)>>>1|(yn&21845)<<1;Jh=(Jh&52428)>>>2|(Jh&13107)<<2,Jh=(Jh&61680)>>>4|(Jh&3855)<<4,Fx[yn]=((Jh&65280)>>>8|(Jh&255)<<8)>>>1}var mu=function(e,t,r){for(var i=e.length,n=0,s=new Xo(t);n<i;++n)++s[e[n]-1];var a=new Xo(t);for(n=0;n<t;++n)a[n]=a[n-1]+s[n-1]<<1;var o;if(r){o=new Xo(1<<t);var f=15-t;for(n=0;n<i;++n)if(e[n])for(var m=n<<4|e[n],w=t-e[n],A=a[e[n]-1]++<<w,P=A|(1<<w)-1;A<=P;++A)o[Fx[A]>>>f]=m}else for(o=new Xo(i),n=0;n<i;++n)o[n]=Fx[a[e[n]-1]++]>>>15-e[n];return o},Ad=new Jo(288);for(var yn=0;yn<144;++yn)Ad[yn]=8;for(var yn=144;yn<256;++yn)Ad[yn]=9;for(var yn=256;yn<280;++yn)Ad[yn]=7;for(var yn=280;yn<288;++yn)Ad[yn]=8;var _0=new Jo(32);for(var yn=0;yn<32;++yn)_0[yn]=5;var xet=mu(Ad,9,0),Aet=mu(Ad,9,1),Eet=mu(_0,5,0),Cet=mu(_0,5,1),D2=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},pc=function(e,t,r){var i=t/8>>0;return(e[i]|e[i+1]<<8)>>>(t&7)&r},N2=function(e,t){var r=t/8>>0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>>(t&7)},pS=function(e){return(e/8>>0)+(e&7&&1)},Tk=function(e,t,r){(t==null||t<0)&&(t=0),(r==null||r>e.length)&&(r=e.length);var i=new(e instanceof Xo?Xo:e instanceof y0?y0:Jo)(r-t);return i.set(e.subarray(t,r)),i},Tet=function(e,t,r){var i=e.length,n=!t||r,s=!r||r.i;r||(r={}),t||(t=new Jo(i*3));var a=function(Zt){var Kt=t.length;if(Zt>Kt){var ne=new Jo(Math.max(Kt*2,Zt));ne.set(t),t=ne}},o=r.f||0,f=r.p||0,m=r.b||0,w=r.l,A=r.d,P=r.m,I=r.n,N=i*8;do{if(!w){r.f=o=pc(e,f,1);var F=pc(e,f+1,3);if(f+=3,F)if(F==1)w=Aet,A=Cet,P=9,I=5;else if(F==2){var Z=pc(e,f,31)+257,U=pc(e,f+10,15)+4,z=Z+pc(e,f+5,31)+1;f+=14;for(var J=new Jo(z),nt=new Jo(19),mt=0;mt<U;++mt)nt[Dx[mt]]=pc(e,f+mt*3,7);f+=U*3;var Et=D2(nt),bt=(1<<Et)-1;if(!s&&f+z*(Et+7)>N)break;for(var pt=mu(nt,Et,1),mt=0;mt<z;){var zt=pt[pc(e,f,bt)];f+=zt&15;var Rt=zt>>>4;if(Rt<16)J[mt++]=Rt;else{var at=0,dt=0;for(Rt==16?(dt=3+pc(e,f,3),f+=2,at=J[mt-1]):Rt==17?(dt=3+pc(e,f,7),f+=3):Rt==18&&(dt=11+pc(e,f,127),f+=7);dt--;)J[mt++]=at}}var kt=J.subarray(0,Z),xt=J.subarray(Z);P=D2(kt),I=D2(xt),w=mu(kt,P,1),A=mu(xt,I,1)}else throw"invalid block type";else{var Rt=pS(f)+4,ue=e[Rt-4]|e[Rt-3]<<8,oe=Rt+ue;if(oe>i){if(s)throw"unexpected EOF";break}n&&a(m+ue),t.set(e.subarray(Rt,oe),m),r.b=m+=ue,r.p=f=oe*8;continue}if(f>N)throw"unexpected EOF"}n&&a(m+131072);for(var he=(1<<P)-1,Dt=(1<<I)-1,Qt=P+I+18;s||f+Qt<N;){var at=w[N2(e,f)&he],ee=at>>>4;if(f+=at&15,f>N)throw"unexpected EOF";if(!at)throw"invalid length/literal";if(ee<256)t[m++]=ee;else if(ee==256){w=null;break}else{var xe=ee-254;if(ee>264){var mt=ee-257,it=hv[mt];xe=pc(e,f,(1<<it)-1)+Ek[mt],f+=it}var Tt=A[N2(e,f)&Dt],Lt=Tt>>>4;if(!Tt)throw"invalid distance";f+=Tt&15;var xt=wet[Lt];if(Lt>3){var it=dv[Lt];xt+=N2(e,f)&(1<<it)-1,f+=it}if(f>N)throw"unexpected EOF";n&&a(m+131072);for(var Ut=m+xe;m<Ut;m+=4)t[m]=t[m-xt],t[m+1]=t[m+1-xt],t[m+2]=t[m+2-xt],t[m+3]=t[m+3-xt];m=Ut}}r.l=w,r.p=f,r.b=m,w&&(o=1,r.m=P,r.d=A,r.n=I)}while(!o);return m==t.length?t:Tk(t,0,m)},Wu=function(e,t,r){r<<=t&7;var i=t/8>>0;e[i]|=r,e[i+1]|=r>>>8},fm=function(e,t,r){r<<=t&7;var i=t/8>>0;e[i]|=r,e[i+1]|=r>>>8,e[i+2]|=r>>>16},F2=function(e,t){for(var r=[],i=0;i<e.length;++i)e[i]&&r.push({s:i,f:e[i]});var n=r.length,s=r.slice();if(!n)return[new Jo(0),0];if(n==1){var a=new Jo(r[0].s+1);return a[r[0].s]=1,[a,1]}r.sort(function(mt,Et){return mt.f-Et.f}),r.push({s:-1,f:25001});var o=r[0],f=r[1],m=0,w=1,A=2;for(r[0]={s:-1,f:o.f+f.f,l:o,r:f};w!=n-1;)o=r[r[m].f<r[A].f?m++:A++],f=r[m!=w&&r[m].f<r[A].f?m++:A++],r[w++]={s:-1,f:o.f+f.f,l:o,r:f};for(var P=s[0].s,i=1;i<n;++i)s[i].s>P&&(P=s[i].s);var I=new Xo(P+1),N=zx(r[w-1],I,0);if(N>t){var i=0,F=0,Z=N-t,U=1<<Z;for(s.sort(function(Et,bt){return I[bt.s]-I[Et.s]||Et.f-bt.f});i<n;++i){var z=s[i].s;if(I[z]>t)F+=U-(1<<N-I[z]),I[z]=t;else break}for(F>>>=Z;F>0;){var J=s[i].s;I[J]<t?F-=1<<t-I[J]++-1:++i}for(;i>=0&&F;--i){var nt=s[i].s;I[nt]==t&&(--I[nt],++F)}N=t}return[new Jo(I),N]},zx=function(e,t,r){return e.s==-1?Math.max(zx(e.l,t,r+1),zx(e.r,t,r+1)):t[e.s]=r},TI=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new Xo(++t),i=0,n=e[0],s=1,a=function(f){r[i++]=f},o=1;o<=t;++o)if(e[o]==n&&o!=t)++s;else{if(!n&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(n),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(n);s=1,n=e[o]}return[r.subarray(0,i),t]},pm=function(e,t){for(var r=0,i=0;i<t.length;++i)r+=e[i]*t[i];return r},My=function(e,t,r){var i=r.length,n=pS(t+2);e[n]=i&255,e[n+1]=i>>>8,e[n+2]=e[n]^255,e[n+3]=e[n+1]^255;for(var s=0;s<i;++s)e[n+s+4]=r[s];return(n+4+i)*8},PI=function(e,t,r,i,n,s,a,o,f,m,w){Wu(t,w++,r),++n[256];for(var A=F2(n,15),P=A[0],I=A[1],N=F2(s,15),F=N[0],Z=N[1],U=TI(P),z=U[0],J=U[1],nt=TI(F),mt=nt[0],Et=nt[1],bt=new Xo(19),pt=0;pt<z.length;++pt)bt[z[pt]&31]++;for(var pt=0;pt<mt.length;++pt)bt[mt[pt]&31]++;for(var zt=F2(bt,7),Rt=zt[0],at=zt[1],dt=19;dt>4&&!Rt[Dx[dt-1]];--dt);var kt=m+5<<3,xt=pm(n,Ad)+pm(s,_0)+a,ue=pm(n,P)+pm(s,F)+a+14+3*dt+pm(bt,Rt)+(2*bt[16]+3*bt[17]+7*bt[18]);if(kt<=xt&&kt<=ue)return My(t,w,e.subarray(f,f+m));var oe,he,Dt,Qt;if(Wu(t,w,1+(ue<xt)),w+=2,ue<xt){oe=mu(P,I,0),he=P,Dt=mu(F,Z,0),Qt=F;var ee=mu(Rt,at,0);Wu(t,w,J-257),Wu(t,w+5,Et-1),Wu(t,w+10,dt-4),w+=14;for(var pt=0;pt<dt;++pt)Wu(t,w+3*pt,Rt[Dx[pt]]);w+=3*dt;for(var xe=[z,mt],it=0;it<2;++it)for(var Tt=xe[it],pt=0;pt<Tt.length;++pt){var Lt=Tt[pt]&31;Wu(t,w,ee[Lt]),w+=Rt[Lt],Lt>15&&(Wu(t,w,Tt[pt]>>>5&127),w+=Tt[pt]>>>12)}}else oe=xet,he=Ad,Dt=Eet,Qt=_0;for(var pt=0;pt<o;++pt)if(i[pt]>255){var Lt=i[pt]>>>18&31;fm(t,w,oe[Lt+257]),w+=he[Lt+257],Lt>7&&(Wu(t,w,i[pt]>>>23&31),w+=hv[Lt]);var Ut=i[pt]&31;fm(t,w,Dt[Ut]),w+=Qt[Ut],Ut>3&&(fm(t,w,i[pt]>>>5&8191),w+=dv[Ut])}else fm(t,w,oe[i[pt]]),w+=he[i[pt]];return fm(t,w,oe[256]),w+he[256]},Pet=new y0([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Iet=new Jo(0),Met=function(e,t,r,i,n,s){var a=e.length,o=new Jo(i+a+5*(1+Math.floor(a/7e3))+n),f=o.subarray(i,o.length-n),m=0;if(!t||a<8)for(var w=0;w<=a;w+=65535){var A=w+65535;A<a?m=My(f,m,e.subarray(w,A)):(f[w]=s,m=My(f,m,e.subarray(w,a)))}else{for(var P=Pet[t-1],I=P>>>13,N=P&8191,F=(1<<r)-1,Z=new Xo(32768),U=new Xo(F+1),z=Math.ceil(r/3),J=2*z,nt=function(Xe){return(e[Xe]^e[Xe+1]<<z^e[Xe+2]<<J)&F},mt=new y0(25e3),Et=new Xo(288),bt=new Xo(32),pt=0,zt=0,w=0,Rt=0,at=0,dt=0;w<a;++w){var kt=nt(w),xt=w&32767,ue=U[kt];if(Z[xt]=ue,U[kt]=xt,at<=w){var oe=a-w;if((pt>7e3||Rt>24576)&&oe>423){m=PI(e,f,0,mt,Et,bt,zt,Rt,dt,w-dt,m),Rt=pt=zt=0,dt=w;for(var he=0;he<286;++he)Et[he]=0;for(var he=0;he<30;++he)bt[he]=0}var Dt=2,Qt=0,ee=N,xe=xt-ue&32767;if(oe>2&&kt==nt(w-xe))for(var it=Math.min(I,oe)-1,Tt=Math.min(32767,w),Lt=Math.min(258,oe);xe<=Tt&&--ee&&xt!=ue;){if(e[w+Dt]==e[w+Dt-xe]){for(var Ut=0;Ut<Lt&&e[w+Ut]==e[w+Ut-xe];++Ut);if(Ut>Dt){if(Dt=Ut,Qt=xe,Ut>it)break;for(var Zt=Math.min(xe,Ut-2),Kt=0,he=0;he<Zt;++he){var ne=w-xe+he+32768&32767,re=Z[ne],Se=ne-re+32768&32767;Se>Kt&&(Kt=Se,ue=ne)}}}xt=ue,ue=Z[xt],xe+=xt-ue+32768&32767}if(Qt){mt[Rt++]=268435456|Nx[Dt]<<18|CI[Qt];var Be=Nx[Dt]&31,ze=CI[Qt]&31;zt+=hv[Be]+dv[ze],++Et[257+Be],++bt[ze],at=w+Dt,++pt}else mt[Rt++]=e[w],++Et[e[w]]}}m=PI(e,f,s,mt,Et,bt,zt,Rt,dt,w-dt,m),s||(m=My(f,m,Iet))}return Tk(o,0,i+pS(m)+n)},Let=function(){var e=1,t=0;return{p:function(r){for(var i=e,n=t,s=r.length,a=0;a!=s;){for(var o=Math.min(a+5552,s);a<o;++a)i+=r[a],n+=i;i%=65521,n%=65521}e=i,t=n},d:function(){return(e>>>8<<16|(t&255)<<8|t>>>8)+((e&255)<<23)*2}}},Bet=function(e,t,r,i,n){return Met(e,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):12+t.mem,r,i,!n)},ket=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},Ret=function(e,t){var r=t.level,i=r==0?0:r<6?1:r==9?3:2;e[0]=120,e[1]=i<<6|(i?32-2*i:1)},Oet=function(e){if((e[0]&15)!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(e[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function jx(e,t){t===void 0&&(t={});var r=Let();r.p(e);var i=Bet(e,t,2,4);return Ret(i,t),ket(i,i.length-4,r.d()),i}function Det(e,t){return Tet((Oet(e),e.subarray(2,-4)),t)}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.1 Built on 2022-01-28T15:37:57.791Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Holländer <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var Nr=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function z2(){Nr.console&&typeof Nr.console.log=="function"&&Nr.console.log.apply(Nr.console,arguments)}var nn={log:z2,warn:function(e){Nr.console&&(typeof Nr.console.warn=="function"?Nr.console.warn.apply(Nr.console,arguments):z2.call(null,arguments))},error:function(e){Nr.console&&(typeof Nr.console.error=="function"?Nr.console.error.apply(Nr.console,arguments):z2(e))}};function j2(e,t,r){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){rf(i.response,t,r)},i.onerror=function(){nn.error("could not download file")},i.send()}function II(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function ry(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var Gm,Ux,rf=Nr.saveAs||((typeof window>"u"?"undefined":Gi(window))!=="object"||window!==Nr?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(e,t,r){var i=Nr.URL||Nr.webkitURL,n=document.createElement("a");t=t||e.name||"download",n.download=t,n.rel="noopener",typeof e=="string"?(n.href=e,n.origin!==location.origin?II(n.href)?j2(e,t,r):ry(n,n.target="_blank"):ry(n)):(n.href=i.createObjectURL(e),setTimeout(function(){i.revokeObjectURL(n.href)},4e4),setTimeout(function(){ry(n)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){if(t=t||e.name||"download",typeof e=="string")if(II(e))j2(e,t,r);else{var i=document.createElement("a");i.href=e,i.target="_blank",setTimeout(function(){ry(i)})}else navigator.msSaveOrOpenBlob(function(n,s){return s===void 0?s={autoBom:!1}:Gi(s)!=="object"&&(nn.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}(e,r),t)}:function(e,t,r,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),typeof e=="string")return j2(e,t,r);var n=e.type==="application/octet-stream",s=/constructor/i.test(Nr.HTMLElement)||Nr.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||n&&s)&&(typeof FileReader>"u"?"undefined":Gi(FileReader))==="object"){var o=new FileReader;o.onloadend=function(){var w=o.result;w=a?w:w.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=w:location=w,i=null},o.readAsDataURL(e)}else{var f=Nr.URL||Nr.webkitURL,m=f.createObjectURL(e);i?i.location=m:location.href=m,i=null,setTimeout(function(){f.revokeObjectURL(m)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function Pk(e){var t;e=e||"",this.ok=!1,e.charAt(0)=="#"&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],i=0;i<r.length;i++){var n=r[i].re,s=r[i].process,a=n.exec(e);a&&(t=s(a),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var o=this.r.toString(16),f=this.g.toString(16),m=this.b.toString(16);return o.length==1&&(o="0"+o),f.length==1&&(f="0"+f),m.length==1&&(m="0"+m),"#"+o+f+m}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function U2(e,t){var r=e[0],i=e[1],n=e[2],s=e[3];r=yo(r,i,n,s,t[0],7,-680876936),s=yo(s,r,i,n,t[1],12,-389564586),n=yo(n,s,r,i,t[2],17,606105819),i=yo(i,n,s,r,t[3],22,-1044525330),r=yo(r,i,n,s,t[4],7,-176418897),s=yo(s,r,i,n,t[5],12,1200080426),n=yo(n,s,r,i,t[6],17,-1473231341),i=yo(i,n,s,r,t[7],22,-45705983),r=yo(r,i,n,s,t[8],7,1770035416),s=yo(s,r,i,n,t[9],12,-1958414417),n=yo(n,s,r,i,t[10],17,-42063),i=yo(i,n,s,r,t[11],22,-1990404162),r=yo(r,i,n,s,t[12],7,1804603682),s=yo(s,r,i,n,t[13],12,-40341101),n=yo(n,s,r,i,t[14],17,-1502002290),r=_o(r,i=yo(i,n,s,r,t[15],22,1236535329),n,s,t[1],5,-165796510),s=_o(s,r,i,n,t[6],9,-1069501632),n=_o(n,s,r,i,t[11],14,643717713),i=_o(i,n,s,r,t[0],20,-373897302),r=_o(r,i,n,s,t[5],5,-701558691),s=_o(s,r,i,n,t[10],9,38016083),n=_o(n,s,r,i,t[15],14,-660478335),i=_o(i,n,s,r,t[4],20,-405537848),r=_o(r,i,n,s,t[9],5,568446438),s=_o(s,r,i,n,t[14],9,-1019803690),n=_o(n,s,r,i,t[3],14,-187363961),i=_o(i,n,s,r,t[8],20,1163531501),r=_o(r,i,n,s,t[13],5,-1444681467),s=_o(s,r,i,n,t[2],9,-51403784),n=_o(n,s,r,i,t[7],14,1735328473),r=vo(r,i=_o(i,n,s,r,t[12],20,-1926607734),n,s,t[5],4,-378558),s=vo(s,r,i,n,t[8],11,-2022574463),n=vo(n,s,r,i,t[11],16,1839030562),i=vo(i,n,s,r,t[14],23,-35309556),r=vo(r,i,n,s,t[1],4,-1530992060),s=vo(s,r,i,n,t[4],11,1272893353),n=vo(n,s,r,i,t[7],16,-155497632),i=vo(i,n,s,r,t[10],23,-1094730640),r=vo(r,i,n,s,t[13],4,681279174),s=vo(s,r,i,n,t[0],11,-358537222),n=vo(n,s,r,i,t[3],16,-722521979),i=vo(i,n,s,r,t[6],23,76029189),r=vo(r,i,n,s,t[9],4,-640364487),s=vo(s,r,i,n,t[12],11,-421815835),n=vo(n,s,r,i,t[15],16,530742520),r=bo(r,i=vo(i,n,s,r,t[2],23,-995338651),n,s,t[0],6,-198630844),s=bo(s,r,i,n,t[7],10,1126891415),n=bo(n,s,r,i,t[14],15,-1416354905),i=bo(i,n,s,r,t[5],21,-57434055),r=bo(r,i,n,s,t[12],6,1700485571),s=bo(s,r,i,n,t[3],10,-1894986606),n=bo(n,s,r,i,t[10],15,-1051523),i=bo(i,n,s,r,t[1],21,-2054922799),r=bo(r,i,n,s,t[8],6,1873313359),s=bo(s,r,i,n,t[15],10,-30611744),n=bo(n,s,r,i,t[6],15,-1560198380),i=bo(i,n,s,r,t[13],21,1309151649),r=bo(r,i,n,s,t[4],6,-145523070),s=bo(s,r,i,n,t[11],10,-1120210379),n=bo(n,s,r,i,t[2],15,718787259),i=bo(i,n,s,r,t[9],21,-343485551),e[0]=ad(r,e[0]),e[1]=ad(i,e[1]),e[2]=ad(n,e[2]),e[3]=ad(s,e[3])}function fv(e,t,r,i,n,s){return t=ad(ad(t,e),ad(i,s)),ad(t<<n|t>>>32-n,r)}function yo(e,t,r,i,n,s,a){return fv(t&r|~t&i,e,t,n,s,a)}function _o(e,t,r,i,n,s,a){return fv(t&i|r&~i,e,t,n,s,a)}function vo(e,t,r,i,n,s,a){return fv(t^r^i,e,t,n,s,a)}function bo(e,t,r,i,n,s,a){return fv(r^(t|~i),e,t,n,s,a)}function Ik(e){var t,r=e.length,i=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)U2(i,Net(e.substring(t-64,t)));e=e.substring(t-64);var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)n[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(U2(i,n),t=0;t<16;t++)n[t]=0;return n[14]=8*r,U2(i,n),i}function Net(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}Gm=Nr.atob.bind(Nr),Ux=Nr.btoa.bind(Nr);var MI="0123456789abcdef".split("");function Fet(e){for(var t="",r=0;r<4;r++)t+=MI[e>>8*r+4&15]+MI[e>>8*r&15];return t}function zet(e){return String.fromCharCode((255&e)>>0,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function Gx(e){return Ik(e).map(zet).join("")}var jet=function(e){for(var t=0;t<e.length;t++)e[t]=Fet(e[t]);return e.join("")}(Ik("hello"))!="5d41402abc4b2a76b9719d911017c592";function ad(e,t){if(jet){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}return e+t&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function Vx(e,t){var r,i,n,s;if(e!==r){for(var a=(n=e,s=1+(256/e.length>>0),new Array(s+1).join(n)),o=[],f=0;f<256;f++)o[f]=f;var m=0;for(f=0;f<256;f++){var w=o[f];m=(m+w+a.charCodeAt(f))%256,o[f]=o[m],o[m]=w}r=e,i=o}else o=i;var A=t.length,P=0,I=0,N="";for(f=0;f<A;f++)I=(I+(w=o[P=(P+1)%256]))%256,o[P]=o[I],o[I]=w,a=o[(o[P]+o[I])%256],N+=String.fromCharCode(t.charCodeAt(f)^a);return N}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var LI={print:4,modify:8,copy:16,"annot-forms":32};function gp(e,t,r,i){this.v=1,this.r=2;var n=192;e.forEach(function(o){if(LI.perm!==void 0)throw new Error("Invalid permission: "+o);n+=LI[o]}),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";var s=(t+this.padding).substr(0,32),a=(r+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,a),this.P=-(1+(255^n)),this.encryptionKey=Gx(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(i)).substr(0,5),this.U=Vx(this.encryptionKey,this.padding)}function mp(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",r=e.length,i=0;i<r;i++){var n=e.charCodeAt(i);n<33||n===35||n===37||n===40||n===41||n===47||n===60||n===62||n===91||n===93||n===123||n===125||n>126?t+="#"+("0"+n.toString(16)).slice(-2):t+=e[i]}return t}function BI(e){if(Gi(e)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(r,i,n){if(n=n||!1,typeof r!="string"||typeof i!="function"||typeof n!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(r)||(t[r]={});var s=Math.random().toString(35);return t[r][s]=[i,!!n],s},this.unsubscribe=function(r){for(var i in t)if(t[i][r])return delete t[i][r],Object.keys(t[i]).length===0&&delete t[i],!0;return!1},this.publish=function(r){if(t.hasOwnProperty(r)){var i=Array.prototype.slice.call(arguments,1),n=[];for(var s in t[r]){var a=t[r][s];try{a[0].apply(e,i)}catch(o){Nr.console&&nn.error("jsPDF PubSub Error",o.message,o)}a[1]&&n.push(s)}n.length&&n.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function B_(e){if(!(this instanceof B_))return new B_(e);var t="opacity,stroke-opacity".split(",");for(var r in e)e.hasOwnProperty(r)&&t.indexOf(r)>=0&&(this[r]=e[r]);this.id="",this.objectNumber=-1}function Mk(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function of(e,t,r,i,n){if(!(this instanceof of))return new of(e,t,r,i,n);this.type=e==="axial"?2:3,this.coords=t,this.colors=r,Mk.call(this,i,n)}function Rp(e,t,r,i,n){if(!(this instanceof Rp))return new Rp(e,t,r,i,n);this.boundingBox=e,this.xStep=t,this.yStep=r,this.stream="",this.cloneIndex=0,Mk.call(this,i,n)}function Dr(e){var t,r=typeof arguments[0]=="string"?arguments[0]:"p",i=arguments[1],n=arguments[2],s=arguments[3],a=[],o=1,f=16,m="S",w=null;Gi(e=e||{})==="object"&&(r=e.orientation,i=e.unit||i,n=e.format||n,s=e.compress||e.compressPdf||s,(w=e.encryption||null)!==null&&(w.userPassword=w.userPassword||"",w.ownerPassword=w.ownerPassword||"",w.userPermissions=w.userPermissions||[]),o=typeof e.userUnit=="number"?Math.abs(e.userUnit):1,e.precision!==void 0&&(t=e.precision),e.floatPrecision!==void 0&&(f=e.floatPrecision),m=e.defaultPathOperation||"S"),a=e.filters||(s===!0?["FlateEncode"]:a),i=i||"mm",r=(""+(r||"P")).toLowerCase();var A=e.putOnlyUsedFonts||!1,P={},I={internal:{},__private__:{}};I.__private__.PubSub=BI;var N="1.3",F=I.__private__.getPdfVersion=function(){return N};I.__private__.setPdfVersion=function(D){N=D};var Z={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};I.__private__.getPageFormats=function(){return Z};var U=I.__private__.getPageFormat=function(D){return Z[D]};n=n||"a4";var z={COMPAT:"compat",ADVANCED:"advanced"},J=z.COMPAT;function nt(){this.saveGraphicsState(),Bt(new Ct(Re,0,0,-Re,0,ia()*Re).toString()+" cm"),this.setFontSize(this.getFontSize()/Re),m="n",J=z.ADVANCED}function mt(){this.restoreGraphicsState(),m="S",J=z.COMPAT}var Et=I.__private__.combineFontStyleAndFontWeight=function(D,tt){if(D=="bold"&&tt=="normal"||D=="bold"&&tt==400||D=="normal"&&tt=="italic"||D=="bold"&&tt=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return tt&&(D=tt==400||tt==="normal"?D==="italic"?"italic":"normal":tt!=700&&tt!=="bold"||D!=="normal"?(tt==700?"bold":tt)+""+D:"bold"),D};I.advancedAPI=function(D){var tt=J===z.COMPAT;return tt&&nt.call(this),typeof D!="function"||(D(this),tt&&mt.call(this)),this},I.compatAPI=function(D){var tt=J===z.ADVANCED;return tt&&mt.call(this),typeof D!="function"||(D(this),tt&&nt.call(this)),this},I.isAdvancedAPI=function(){return J===z.ADVANCED};var bt,pt=function(D){if(J!==z.ADVANCED)throw new Error(D+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},zt=I.roundToPrecision=I.__private__.roundToPrecision=function(D,tt){var It=t||tt;if(isNaN(D)||isNaN(It))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return D.toFixed(It).replace(/0+$/,"")};bt=I.hpf=I.__private__.hpf=typeof f=="number"?function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return zt(D,f)}:f==="smart"?function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return zt(D,D>-1&&D<1?16:5)}:function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return zt(D,16)};var Rt=I.f2=I.__private__.f2=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.f2");return zt(D,2)},at=I.__private__.f3=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.f3");return zt(D,3)},dt=I.scale=I.__private__.scale=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.scale");return J===z.COMPAT?D*Re:J===z.ADVANCED?D:void 0},kt=function(D){return J===z.COMPAT?ia()-D:J===z.ADVANCED?D:void 0},xt=function(D){return dt(kt(D))};I.__private__.setPrecision=I.setPrecision=function(D){typeof parseInt(D,10)=="number"&&(t=parseInt(D,10))};var ue,oe="00000000000000000000000000000000",he=I.__private__.getFileId=function(){return oe},Dt=I.__private__.setFileId=function(D){return oe=D!==void 0&&/^[a-fA-F0-9]{32}$/.test(D)?D.toUpperCase():oe.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),w!==null&&(Ti=new gp(w.userPermissions,w.userPassword,w.ownerPassword,oe)),oe};I.setFileId=function(D){return Dt(D),this},I.getFileId=function(){return he()};var Qt=I.__private__.convertDateToPDFDate=function(D){var tt=D.getTimezoneOffset(),It=tt<0?"+":"-",qt=Math.floor(Math.abs(tt/60)),te=Math.abs(tt%60),ie=[It,Lt(qt),"'",Lt(te),"'"].join("");return["D:",D.getFullYear(),Lt(D.getMonth()+1),Lt(D.getDate()),Lt(D.getHours()),Lt(D.getMinutes()),Lt(D.getSeconds()),ie].join("")},ee=I.__private__.convertPDFDateToDate=function(D){var tt=parseInt(D.substr(2,4),10),It=parseInt(D.substr(6,2),10)-1,qt=parseInt(D.substr(8,2),10),te=parseInt(D.substr(10,2),10),ie=parseInt(D.substr(12,2),10),Me=parseInt(D.substr(14,2),10);return new Date(tt,It,qt,te,ie,Me,0)},xe=I.__private__.setCreationDate=function(D){var tt;if(D===void 0&&(D=new Date),D instanceof Date)tt=Qt(D);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(D))throw new Error("Invalid argument passed to jsPDF.setCreationDate");tt=D}return ue=tt},it=I.__private__.getCreationDate=function(D){var tt=ue;return D==="jsDate"&&(tt=ee(ue)),tt};I.setCreationDate=function(D){return xe(D),this},I.getCreationDate=function(D){return it(D)};var Tt,Lt=I.__private__.padd2=function(D){return("0"+parseInt(D)).slice(-2)},Ut=I.__private__.padd2Hex=function(D){return("00"+(D=D.toString())).substr(D.length)},Zt=0,Kt=[],ne=[],re=0,Se=[],Be=[],ze=!1,Ve=ne,Xe=function(){Zt=0,re=0,ne=[],Kt=[],Se=[],sr=He(),Cr=He()};I.__private__.setCustomOutputDestination=function(D){ze=!0,Ve=D};var ge=function(D){ze||(Ve=D)};I.__private__.resetCustomOutputDestination=function(){ze=!1,Ve=ne};var Bt=I.__private__.out=function(D){return D=D.toString(),re+=D.length+1,Ve.push(D),Ve},Xt=I.__private__.write=function(D){return Bt(arguments.length===1?D.toString():Array.prototype.join.call(arguments," "))},ir=I.__private__.getArrayBuffer=function(D){for(var tt=D.length,It=new ArrayBuffer(tt),qt=new Uint8Array(It);tt--;)qt[tt]=D.charCodeAt(tt);return It},Ie=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];I.__private__.getStandardFonts=function(){return Ie};var ve=e.fontSize||16;I.__private__.setFontSize=I.setFontSize=function(D){return ve=J===z.ADVANCED?D/Re:D,this};var Ce,qe=I.__private__.getFontSize=I.getFontSize=function(){return J===z.COMPAT?ve:ve*Re},lr=e.R2L||!1;I.__private__.setR2L=I.setR2L=function(D){return lr=D,this},I.__private__.getR2L=I.getR2L=function(){return lr};var Er,Ir=I.__private__.setZoomMode=function(D){var tt=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(D))Ce=D;else if(isNaN(D)){if(tt.indexOf(D)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+D+'" is not recognized.');Ce=D}else Ce=parseInt(D,10)};I.__private__.getZoomMode=function(){return Ce};var Mr,Wr=I.__private__.setPageMode=function(D){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(D)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+D+'" is not recognized.');Er=D};I.__private__.getPageMode=function(){return Er};var Jr=I.__private__.setLayoutMode=function(D){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(D)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+D+'" is not recognized.');Mr=D};I.__private__.getLayoutMode=function(){return Mr},I.__private__.setDisplayMode=I.setDisplayMode=function(D,tt,It){return Ir(D),Jr(tt),Wr(It),this};var de={title:"",subject:"",author:"",keywords:"",creator:""};I.__private__.getDocumentProperty=function(D){if(Object.keys(de).indexOf(D)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return de[D]},I.__private__.getDocumentProperties=function(){return de},I.__private__.setDocumentProperties=I.setProperties=I.setDocumentProperties=function(D){for(var tt in de)de.hasOwnProperty(tt)&&D[tt]&&(de[tt]=D[tt]);return this},I.__private__.setDocumentProperty=function(D,tt){if(Object.keys(de).indexOf(D)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return de[D]=tt};var Tr,Re,Hi,Pr,Pe,Ye={},tr={},fi=[],Fr={},wr={},bi={},ai={},At=null,Y=0,Q=[],ot=new BI(I),wt=e.hotfixes||[],Nt={},Gt={},Ht=[],Ct=function D(tt,It,qt,te,ie,Me){if(!(this instanceof D))return new D(tt,It,qt,te,ie,Me);isNaN(tt)&&(tt=1),isNaN(It)&&(It=0),isNaN(qt)&&(qt=0),isNaN(te)&&(te=1),isNaN(ie)&&(ie=0),isNaN(Me)&&(Me=0),this._matrix=[tt,It,qt,te,ie,Me]};Object.defineProperty(Ct.prototype,"sx",{get:function(){return this._matrix[0]},set:function(D){this._matrix[0]=D}}),Object.defineProperty(Ct.prototype,"shy",{get:function(){return this._matrix[1]},set:function(D){this._matrix[1]=D}}),Object.defineProperty(Ct.prototype,"shx",{get:function(){return this._matrix[2]},set:function(D){this._matrix[2]=D}}),Object.defineProperty(Ct.prototype,"sy",{get:function(){return this._matrix[3]},set:function(D){this._matrix[3]=D}}),Object.defineProperty(Ct.prototype,"tx",{get:function(){return this._matrix[4]},set:function(D){this._matrix[4]=D}}),Object.defineProperty(Ct.prototype,"ty",{get:function(){return this._matrix[5]},set:function(D){this._matrix[5]=D}}),Object.defineProperty(Ct.prototype,"a",{get:function(){return this._matrix[0]},set:function(D){this._matrix[0]=D}}),Object.defineProperty(Ct.prototype,"b",{get:function(){return this._matrix[1]},set:function(D){this._matrix[1]=D}}),Object.defineProperty(Ct.prototype,"c",{get:function(){return this._matrix[2]},set:function(D){this._matrix[2]=D}}),Object.defineProperty(Ct.prototype,"d",{get:function(){return this._matrix[3]},set:function(D){this._matrix[3]=D}}),Object.defineProperty(Ct.prototype,"e",{get:function(){return this._matrix[4]},set:function(D){this._matrix[4]=D}}),Object.defineProperty(Ct.prototype,"f",{get:function(){return this._matrix[5]},set:function(D){this._matrix[5]=D}}),Object.defineProperty(Ct.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Ct.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Ct.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Ct.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Ct.prototype.join=function(D){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(bt).join(D)},Ct.prototype.multiply=function(D){var tt=D.sx*this.sx+D.shy*this.shx,It=D.sx*this.shy+D.shy*this.sy,qt=D.shx*this.sx+D.sy*this.shx,te=D.shx*this.shy+D.sy*this.sy,ie=D.tx*this.sx+D.ty*this.shx+this.tx,Me=D.tx*this.shy+D.ty*this.sy+this.ty;return new Ct(tt,It,qt,te,ie,Me)},Ct.prototype.decompose=function(){var D=this.sx,tt=this.shy,It=this.shx,qt=this.sy,te=this.tx,ie=this.ty,Me=Math.sqrt(D*D+tt*tt),er=(D/=Me)*It+(tt/=Me)*qt;It-=D*er,qt-=tt*er;var Ar=Math.sqrt(It*It+qt*qt);return er/=Ar,D*(qt/=Ar)<tt*(It/=Ar)&&(D=-D,tt=-tt,er=-er,Me=-Me),{scale:new Ct(Me,0,0,Ar,0,0),translate:new Ct(1,0,0,1,te,ie),rotate:new Ct(D,tt,-tt,D,0,0),skew:new Ct(1,0,er,1,0,0)}},Ct.prototype.toString=function(D){return this.join(" ")},Ct.prototype.inversed=function(){var D=this.sx,tt=this.shy,It=this.shx,qt=this.sy,te=this.tx,ie=this.ty,Me=1/(D*qt-tt*It),er=qt*Me,Ar=-tt*Me,Lr=-It*Me,dr=D*Me;return new Ct(er,Ar,Lr,dr,-er*te-Lr*ie,-Ar*te-dr*ie)},Ct.prototype.applyToPoint=function(D){var tt=D.x*this.sx+D.y*this.shx+this.tx,It=D.x*this.shy+D.y*this.sy+this.ty;return new Fc(tt,It)},Ct.prototype.applyToRectangle=function(D){var tt=this.applyToPoint(D),It=this.applyToPoint(new Fc(D.x+D.w,D.y+D.h));return new ql(tt.x,tt.y,It.x-tt.x,It.y-tt.y)},Ct.prototype.clone=function(){var D=this.sx,tt=this.shy,It=this.shx,qt=this.sy,te=this.tx,ie=this.ty;return new Ct(D,tt,It,qt,te,ie)},I.Matrix=Ct;var Jt=I.matrixMult=function(D,tt){return tt.multiply(D)},ye=new Ct(1,0,0,1,0,0);I.unitMatrix=I.identityMatrix=ye;var fe=function(D,tt){if(!wr[D]){var It=(tt instanceof of?"Sh":"P")+(Object.keys(Fr).length+1).toString(10);tt.id=It,wr[D]=It,Fr[It]=tt,ot.publish("addPattern",tt)}};I.ShadingPattern=of,I.TilingPattern=Rp,I.addShadingPattern=function(D,tt){return pt("addShadingPattern()"),fe(D,tt),this},I.beginTilingPattern=function(D){pt("beginTilingPattern()"),zc(D.boundingBox[0],D.boundingBox[1],D.boundingBox[2]-D.boundingBox[0],D.boundingBox[3]-D.boundingBox[1],D.matrix)},I.endTilingPattern=function(D,tt){pt("endTilingPattern()"),tt.stream=Be[Tt].join(`
`),fe(D,tt),ot.publish("endTilingPattern",tt),Ht.pop().restore()};var ce=I.__private__.newObject=function(){var D=He();return Ze(D,!0),D},He=I.__private__.newObjectDeferred=function(){return Zt++,Kt[Zt]=function(){return re},Zt},Ze=function(D,tt){return tt=typeof tt=="boolean"&&tt,Kt[D]=re,tt&&Bt(D+" 0 obj"),D},xr=I.__private__.newAdditionalObject=function(){var D={objId:He(),content:""};return Se.push(D),D},sr=He(),Cr=He(),zr=I.__private__.decodeColorString=function(D){var tt=D.split(" ");if(tt.length!==2||tt[1]!=="g"&&tt[1]!=="G")tt.length===5&&(tt[4]==="k"||tt[4]==="K")&&(tt=[(1-tt[0])*(1-tt[3]),(1-tt[1])*(1-tt[3]),(1-tt[2])*(1-tt[3]),"r"]);else{var It=parseFloat(tt[0]);tt=[It,It,It,"r"]}for(var qt="#",te=0;te<3;te++)qt+=("0"+Math.floor(255*parseFloat(tt[te])).toString(16)).slice(-2);return qt},$r=I.__private__.encodeColorString=function(D){var tt;typeof D=="string"&&(D={ch1:D});var It=D.ch1,qt=D.ch2,te=D.ch3,ie=D.ch4,Me=D.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof It=="string"&&It.charAt(0)!=="#"){var er=new Pk(It);if(er.ok)It=er.toHex();else if(!/^\d*\.?\d*$/.test(It))throw new Error('Invalid color "'+It+'" passed to jsPDF.encodeColorString.')}if(typeof It=="string"&&/^#[0-9A-Fa-f]{3}$/.test(It)&&(It="#"+It[1]+It[1]+It[2]+It[2]+It[3]+It[3]),typeof It=="string"&&/^#[0-9A-Fa-f]{6}$/.test(It)){var Ar=parseInt(It.substr(1),16);It=Ar>>16&255,qt=Ar>>8&255,te=255&Ar}if(qt===void 0||ie===void 0&&It===qt&&qt===te)if(typeof It=="string")tt=It+" "+Me[0];else switch(D.precision){case 2:tt=Rt(It/255)+" "+Me[0];break;case 3:default:tt=at(It/255)+" "+Me[0]}else if(ie===void 0||Gi(ie)==="object"){if(ie&&!isNaN(ie.a)&&ie.a===0)return tt=["1.","1.","1.",Me[1]].join(" ");if(typeof It=="string")tt=[It,qt,te,Me[1]].join(" ");else switch(D.precision){case 2:tt=[Rt(It/255),Rt(qt/255),Rt(te/255),Me[1]].join(" ");break;default:case 3:tt=[at(It/255),at(qt/255),at(te/255),Me[1]].join(" ")}}else if(typeof It=="string")tt=[It,qt,te,ie,Me[2]].join(" ");else switch(D.precision){case 2:tt=[Rt(It),Rt(qt),Rt(te),Rt(ie),Me[2]].join(" ");break;case 3:default:tt=[at(It),at(qt),at(te),at(ie),Me[2]].join(" ")}return tt},li=I.__private__.getFilters=function(){return a},ur=I.__private__.putStream=function(D){var tt=(D=D||{}).data||"",It=D.filters||li(),qt=D.alreadyAppliedFilters||[],te=D.addLength1||!1,ie=tt.length,Me=D.objectId,er=function(jr){return jr};if(w!==null&&Me===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");w!==null&&(er=Ti.encryptor(Me,0));var Ar={};It===!0&&(It=["FlateEncode"]);var Lr=D.additionalKeyValues||[],dr=(Ar=Dr.API.processDataByFilters!==void 0?Dr.API.processDataByFilters(tt,It):{data:tt,reverseChain:[]}).reverseChain+(Array.isArray(qt)?qt.join(" "):qt.toString());if(Ar.data.length!==0&&(Lr.push({key:"Length",value:Ar.data.length}),te===!0&&Lr.push({key:"Length1",value:ie})),dr.length!=0)if(dr.split("/").length-1==1)Lr.push({key:"Filter",value:dr});else{Lr.push({key:"Filter",value:"["+dr+"]"});for(var si=0;si<Lr.length;si+=1)if(Lr[si].key==="DecodeParms"){for(var fr=[],Qi=0;Qi<Ar.reverseChain.split("/").length-1;Qi+=1)fr.push("null");fr.push(Lr[si].value),Lr[si].value="["+fr.join(" ")+"]"}}Bt("<<");for(var Or=0;Or<Lr.length;Or++)Bt("/"+Lr[Or].key+" "+Lr[Or].value);Bt(">>"),Ar.data.length!==0&&(Bt("stream"),Bt(er(Ar.data)),Bt("endstream"))},Gr=I.__private__.putPage=function(D){var tt=D.number,It=D.data,qt=D.objId,te=D.contentsObjId;Ze(qt,!0),Bt("<</Type /Page"),Bt("/Parent "+D.rootDictionaryObjId+" 0 R"),Bt("/Resources "+D.resourceDictionaryObjId+" 0 R"),Bt("/MediaBox ["+parseFloat(bt(D.mediaBox.bottomLeftX))+" "+parseFloat(bt(D.mediaBox.bottomLeftY))+" "+bt(D.mediaBox.topRightX)+" "+bt(D.mediaBox.topRightY)+"]"),D.cropBox!==null&&Bt("/CropBox ["+bt(D.cropBox.bottomLeftX)+" "+bt(D.cropBox.bottomLeftY)+" "+bt(D.cropBox.topRightX)+" "+bt(D.cropBox.topRightY)+"]"),D.bleedBox!==null&&Bt("/BleedBox ["+bt(D.bleedBox.bottomLeftX)+" "+bt(D.bleedBox.bottomLeftY)+" "+bt(D.bleedBox.topRightX)+" "+bt(D.bleedBox.topRightY)+"]"),D.trimBox!==null&&Bt("/TrimBox ["+bt(D.trimBox.bottomLeftX)+" "+bt(D.trimBox.bottomLeftY)+" "+bt(D.trimBox.topRightX)+" "+bt(D.trimBox.topRightY)+"]"),D.artBox!==null&&Bt("/ArtBox ["+bt(D.artBox.bottomLeftX)+" "+bt(D.artBox.bottomLeftY)+" "+bt(D.artBox.topRightX)+" "+bt(D.artBox.topRightY)+"]"),typeof D.userUnit=="number"&&D.userUnit!==1&&Bt("/UserUnit "+D.userUnit),ot.publish("putPage",{objId:qt,pageContext:Q[tt],pageNumber:tt,page:It}),Bt("/Contents "+te+" 0 R"),Bt(">>"),Bt("endobj");var ie=It.join(`
`);return J===z.ADVANCED&&(ie+=`
Q`),Ze(te,!0),ur({data:ie,filters:li(),objectId:te}),Bt("endobj"),qt},pi=I.__private__.putPages=function(){var D,tt,It=[];for(D=1;D<=Y;D++)Q[D].objId=He(),Q[D].contentsObjId=He();for(D=1;D<=Y;D++)It.push(Gr({number:D,data:Be[D],objId:Q[D].objId,contentsObjId:Q[D].contentsObjId,mediaBox:Q[D].mediaBox,cropBox:Q[D].cropBox,bleedBox:Q[D].bleedBox,trimBox:Q[D].trimBox,artBox:Q[D].artBox,userUnit:Q[D].userUnit,rootDictionaryObjId:sr,resourceDictionaryObjId:Cr}));Ze(sr,!0),Bt("<</Type /Pages");var qt="/Kids [";for(tt=0;tt<Y;tt++)qt+=It[tt]+" 0 R ";Bt(qt+"]"),Bt("/Count "+Y),Bt(">>"),Bt("endobj"),ot.publish("postPutPages")},Ri=function(D){ot.publish("putFont",{font:D,out:Bt,newObject:ce,putStream:ur}),D.isAlreadyPutted!==!0&&(D.objectNumber=ce(),Bt("<<"),Bt("/Type /Font"),Bt("/BaseFont /"+mp(D.postScriptName)),Bt("/Subtype /Type1"),typeof D.encoding=="string"&&Bt("/Encoding /"+D.encoding),Bt("/FirstChar 32"),Bt("/LastChar 255"),Bt(">>"),Bt("endobj"))},Wi=function(){for(var D in Ye)Ye.hasOwnProperty(D)&&(A===!1||A===!0&&P.hasOwnProperty(D))&&Ri(Ye[D])},Ii=function(D){D.objectNumber=ce();var tt=[];tt.push({key:"Type",value:"/XObject"}),tt.push({key:"Subtype",value:"/Form"}),tt.push({key:"BBox",value:"["+[bt(D.x),bt(D.y),bt(D.x+D.width),bt(D.y+D.height)].join(" ")+"]"}),tt.push({key:"Matrix",value:"["+D.matrix.toString()+"]"});var It=D.pages[1].join(`
`);ur({data:It,additionalKeyValues:tt,objectId:D.objectNumber}),Bt("endobj")},Zn=function(){for(var D in Nt)Nt.hasOwnProperty(D)&&Ii(Nt[D])},Nl=function(D,tt){var It,qt=[],te=1/(tt-1);for(It=0;It<1;It+=te)qt.push(It);if(qt.push(1),D[0].offset!=0){var ie={offset:0,color:D[0].color};D.unshift(ie)}if(D[D.length-1].offset!=1){var Me={offset:1,color:D[D.length-1].color};D.push(Me)}for(var er="",Ar=0,Lr=0;Lr<qt.length;Lr++){for(It=qt[Lr];It>D[Ar+1].offset;)Ar++;var dr=D[Ar].offset,si=(It-dr)/(D[Ar+1].offset-dr),fr=D[Ar].color,Qi=D[Ar+1].color;er+=Ut(Math.round((1-si)*fr[0]+si*Qi[0]).toString(16))+Ut(Math.round((1-si)*fr[1]+si*Qi[1]).toString(16))+Ut(Math.round((1-si)*fr[2]+si*Qi[2]).toString(16))}return er.trim()},Qa=function(D,tt){tt||(tt=21);var It=ce(),qt=Nl(D.colors,tt),te=[];te.push({key:"FunctionType",value:"0"}),te.push({key:"Domain",value:"[0.0 1.0]"}),te.push({key:"Size",value:"["+tt+"]"}),te.push({key:"BitsPerSample",value:"8"}),te.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),te.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),ur({data:qt,additionalKeyValues:te,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:It}),Bt("endobj"),D.objectNumber=ce(),Bt("<< /ShadingType "+D.type),Bt("/ColorSpace /DeviceRGB");var ie="/Coords ["+bt(parseFloat(D.coords[0]))+" "+bt(parseFloat(D.coords[1]))+" ";D.type===2?ie+=bt(parseFloat(D.coords[2]))+" "+bt(parseFloat(D.coords[3])):ie+=bt(parseFloat(D.coords[2]))+" "+bt(parseFloat(D.coords[3]))+" "+bt(parseFloat(D.coords[4]))+" "+bt(parseFloat(D.coords[5])),Bt(ie+="]"),D.matrix&&Bt("/Matrix ["+D.matrix.toString()+"]"),Bt("/Function "+It+" 0 R"),Bt("/Extend [true true]"),Bt(">>"),Bt("endobj")},Rr=function(D,tt){var It=He(),qt=ce();tt.push({resourcesOid:It,objectOid:qt}),D.objectNumber=qt;var te=[];te.push({key:"Type",value:"/Pattern"}),te.push({key:"PatternType",value:"1"}),te.push({key:"PaintType",value:"1"}),te.push({key:"TilingType",value:"1"}),te.push({key:"BBox",value:"["+D.boundingBox.map(bt).join(" ")+"]"}),te.push({key:"XStep",value:bt(D.xStep)}),te.push({key:"YStep",value:bt(D.yStep)}),te.push({key:"Resources",value:It+" 0 R"}),D.matrix&&te.push({key:"Matrix",value:"["+D.matrix.toString()+"]"}),ur({data:D.stream,additionalKeyValues:te,objectId:D.objectNumber}),Bt("endobj")},ds=function(D){var tt;for(tt in Fr)Fr.hasOwnProperty(tt)&&(Fr[tt]instanceof of?Qa(Fr[tt]):Fr[tt]instanceof Rp&&Rr(Fr[tt],D))},fs=function(D){for(var tt in D.objectNumber=ce(),Bt("<<"),D)switch(tt){case"opacity":Bt("/ca "+Rt(D[tt]));break;case"stroke-opacity":Bt("/CA "+Rt(D[tt]))}Bt(">>"),Bt("endobj")},Ni=function(){var D;for(D in bi)bi.hasOwnProperty(D)&&fs(bi[D])},$i=function(){for(var D in Bt("/XObject <<"),Nt)Nt.hasOwnProperty(D)&&Nt[D].objectNumber>=0&&Bt("/"+D+" "+Nt[D].objectNumber+" 0 R");ot.publish("putXobjectDict"),Bt(">>")},On=function(){Ti.oid=ce(),Bt("<<"),Bt("/Filter /Standard"),Bt("/V "+Ti.v),Bt("/R "+Ti.r),Bt("/U <"+Ti.toHexString(Ti.U)+">"),Bt("/O <"+Ti.toHexString(Ti.O)+">"),Bt("/P "+Ti.P),Bt(">>"),Bt("endobj")},Fi=function(){for(var D in Bt("/Font <<"),Ye)Ye.hasOwnProperty(D)&&(A===!1||A===!0&&P.hasOwnProperty(D))&&Bt("/"+D+" "+Ye[D].objectNumber+" 0 R");Bt(">>")},Jn=function(){if(Object.keys(Fr).length>0){for(var D in Bt("/Shading <<"),Fr)Fr.hasOwnProperty(D)&&Fr[D]instanceof of&&Fr[D].objectNumber>=0&&Bt("/"+D+" "+Fr[D].objectNumber+" 0 R");ot.publish("putShadingPatternDict"),Bt(">>")}},xs=function(D){if(Object.keys(Fr).length>0){for(var tt in Bt("/Pattern <<"),Fr)Fr.hasOwnProperty(tt)&&Fr[tt]instanceof I.TilingPattern&&Fr[tt].objectNumber>=0&&Fr[tt].objectNumber<D&&Bt("/"+tt+" "+Fr[tt].objectNumber+" 0 R");ot.publish("putTilingPatternDict"),Bt(">>")}},To=function(){if(Object.keys(bi).length>0){var D;for(D in Bt("/ExtGState <<"),bi)bi.hasOwnProperty(D)&&bi[D].objectNumber>=0&&Bt("/"+D+" "+bi[D].objectNumber+" 0 R");ot.publish("putGStateDict"),Bt(">>")}},Sr=function(D){Ze(D.resourcesOid,!0),Bt("<<"),Bt("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),Fi(),Jn(),xs(D.objectOid),To(),$i(),Bt(">>"),Bt("endobj")},js=function(){var D=[];Wi(),Ni(),Zn(),ds(D),ot.publish("putResources"),D.forEach(Sr),Sr({resourcesOid:Cr,objectOid:Number.MAX_SAFE_INTEGER}),ot.publish("postPutResources")},ps=function(){ot.publish("putAdditionalObjects");for(var D=0;D<Se.length;D++){var tt=Se[D];Ze(tt.objId,!0),Bt(tt.content),Bt("endobj")}ot.publish("postPutAdditionalObjects")},gi=function(D){tr[D.fontName]=tr[D.fontName]||{},tr[D.fontName][D.fontStyle]=D.id},eo=function(D,tt,It,qt,te){var ie={id:"F"+(Object.keys(Ye).length+1).toString(10),postScriptName:D,fontName:tt,fontStyle:It,encoding:qt,isStandardFont:te||!1,metadata:{}};return ot.publish("addFont",{font:ie,instance:this}),Ye[ie.id]=ie,gi(ie),ie.id},xn=function(D){for(var tt=0,It=Ie.length;tt<It;tt++){var qt=eo.call(this,D[tt][0],D[tt][1],D[tt][2],Ie[tt][3],!0);A===!1&&(P[qt]=!0);var te=D[tt][0].split("-");gi({id:qt,fontName:te[0],fontStyle:te[1]||""})}ot.publish("addFonts",{fonts:Ye,dictionary:tr})},An=function(D){return D.foo=function(){try{return D.apply(this,arguments)}catch(qt){var tt=qt.stack||"";~tt.indexOf(" at ")&&(tt=tt.split(" at ")[1]);var It="Error in function "+tt.split(`
`)[0].split("<")[0]+": "+qt.message;if(!Nr.console)throw new Error(It);Nr.console.error(It,qt),Nr.alert&&alert(It)}},D.foo.bar=D,D.foo},zi=function(D,tt){var It,qt,te,ie,Me,er,Ar,Lr,dr;if(te=(tt=tt||{}).sourceEncoding||"Unicode",Me=tt.outputEncoding,(tt.autoencode||Me)&&Ye[Tr].metadata&&Ye[Tr].metadata[te]&&Ye[Tr].metadata[te].encoding&&(ie=Ye[Tr].metadata[te].encoding,!Me&&Ye[Tr].encoding&&(Me=Ye[Tr].encoding),!Me&&ie.codePages&&(Me=ie.codePages[0]),typeof Me=="string"&&(Me=ie[Me]),Me)){for(Ar=!1,er=[],It=0,qt=D.length;It<qt;It++)(Lr=Me[D.charCodeAt(It)])?er.push(String.fromCharCode(Lr)):er.push(D[It]),er[It].charCodeAt(0)>>8&&(Ar=!0);D=er.join("")}for(It=D.length;Ar===void 0&&It!==0;)D.charCodeAt(It-1)>>8&&(Ar=!0),It--;if(!Ar)return D;for(er=tt.noBOM?[]:[254,255],It=0,qt=D.length;It<qt;It++){if((dr=(Lr=D.charCodeAt(It))>>8)>>8)throw new Error("Character at position "+It+" of string '"+D+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");er.push(dr),er.push(Lr-(dr<<8))}return String.fromCharCode.apply(void 0,er)},vn=I.__private__.pdfEscape=I.pdfEscape=function(D,tt){return zi(D,tt).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Xr=I.__private__.beginPage=function(D){Be[++Y]=[],Q[Y]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(D[0]),topRightY:Number(D[1])}},Us(Y),ge(Be[Tt])},Po=function(D,tt){var It,qt,te;switch(r=tt||r,typeof D=="string"&&(It=U(D.toLowerCase()),Array.isArray(It)&&(qt=It[0],te=It[1])),Array.isArray(D)&&(qt=D[0]*Re,te=D[1]*Re),isNaN(qt)&&(qt=n[0],te=n[1]),(qt>14400||te>14400)&&(nn.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),qt=Math.min(14400,qt),te=Math.min(14400,te)),n=[qt,te],r.substr(0,1)){case"l":te>qt&&(n=[te,qt]);break;case"p":qt>te&&(n=[te,qt])}Xr(n),Kr(En),Bt(As),xu!==0&&Bt(xu+" J"),Au!==0&&Bt(Au+" j"),ot.publish("addPage",{pageNumber:Y})},Io=function(D){D>0&&D<=Y&&(Be.splice(D,1),Q.splice(D,1),Y--,Tt>Y&&(Tt=Y),this.setPage(Tt))},Us=function(D){D>0&&D<=Y&&(Tt=D)},tl=I.__private__.getNumberOfPages=I.getNumberOfPages=function(){return Be.length-1},st=function(D,tt,It){var qt,te=void 0;return It=It||{},D=D!==void 0?D:Ye[Tr].fontName,tt=tt!==void 0?tt:Ye[Tr].fontStyle,qt=D.toLowerCase(),tr[qt]!==void 0&&tr[qt][tt]!==void 0?te=tr[qt][tt]:tr[D]!==void 0&&tr[D][tt]!==void 0?te=tr[D][tt]:It.disableWarning===!1&&nn.warn("Unable to look up font label for font '"+D+"', '"+tt+"'. Refer to getFontList() for available fonts."),te||It.noFallback||(te=tr.times[tt])==null&&(te=tr.times.normal),te},vt=I.__private__.putInfo=function(){var D=ce(),tt=function(qt){return qt};for(var It in w!==null&&(tt=Ti.encryptor(D,0)),Bt("<<"),Bt("/Producer ("+vn(tt("jsPDF "+Dr.version))+")"),de)de.hasOwnProperty(It)&&de[It]&&Bt("/"+It.substr(0,1).toUpperCase()+It.substr(1)+" ("+vn(tt(de[It]))+")");Bt("/CreationDate ("+vn(tt(ue))+")"),Bt(">>"),Bt("endobj")},jt=I.__private__.putCatalog=function(D){var tt=(D=D||{}).rootDictionaryObjId||sr;switch(ce(),Bt("<<"),Bt("/Type /Catalog"),Bt("/Pages "+tt+" 0 R"),Ce||(Ce="fullwidth"),Ce){case"fullwidth":Bt("/OpenAction [3 0 R /FitH null]");break;case"fullheight":Bt("/OpenAction [3 0 R /FitV null]");break;case"fullpage":Bt("/OpenAction [3 0 R /Fit]");break;case"original":Bt("/OpenAction [3 0 R /XYZ null null 1]");break;default:var It=""+Ce;It.substr(It.length-1)==="%"&&(Ce=parseInt(Ce)/100),typeof Ce=="number"&&Bt("/OpenAction [3 0 R /XYZ null null "+Rt(Ce)+"]")}switch(Mr||(Mr="continuous"),Mr){case"continuous":Bt("/PageLayout /OneColumn");break;case"single":Bt("/PageLayout /SinglePage");break;case"two":case"twoleft":Bt("/PageLayout /TwoColumnLeft");break;case"tworight":Bt("/PageLayout /TwoColumnRight")}Er&&Bt("/PageMode /"+Er),ot.publish("putCatalog"),Bt(">>"),Bt("endobj")},pe=I.__private__.putTrailer=function(){Bt("trailer"),Bt("<<"),Bt("/Size "+(Zt+1)),Bt("/Root "+Zt+" 0 R"),Bt("/Info "+(Zt-1)+" 0 R"),w!==null&&Bt("/Encrypt "+Ti.oid+" 0 R"),Bt("/ID [ <"+oe+"> <"+oe+"> ]"),Bt(">>")},Ee=I.__private__.putHeader=function(){Bt("%PDF-"+N),Bt("%ºß¬à")},yr=I.__private__.putXRef=function(){var D="0000000000";Bt("xref"),Bt("0 "+(Zt+1)),Bt("0000000000 65535 f ");for(var tt=1;tt<=Zt;tt++)typeof Kt[tt]=="function"?Bt((D+Kt[tt]()).slice(-10)+" 00000 n "):Kt[tt]!==void 0?Bt((D+Kt[tt]).slice(-10)+" 00000 n "):Bt("0000000000 00000 n ")},Br=I.__private__.buildDocument=function(){Xe(),ge(ne),ot.publish("buildDocument"),Ee(),pi(),ps(),js(),w!==null&&On(),vt(),jt();var D=re;return yr(),pe(),Bt("startxref"),Bt(""+D),Bt("%%EOF"),ge(Be[Tt]),ne.join(`
`)},mi=I.__private__.getBlob=function(D){return new Blob([ir(D)],{type:"application/pdf"})},Sn=I.output=I.__private__.output=An(function(D,tt){switch(typeof(tt=tt||{})=="string"?tt={filename:tt}:tt.filename=tt.filename||"generated.pdf",D){case void 0:return Br();case"save":I.save(tt.filename);break;case"arraybuffer":return ir(Br());case"blob":return mi(Br());case"bloburi":case"bloburl":if(Nr.URL!==void 0&&typeof Nr.URL.createObjectURL=="function")return Nr.URL&&Nr.URL.createObjectURL(mi(Br()))||void 0;nn.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var It="",qt=Br();try{It=Ux(qt)}catch{It=Ux(unescape(encodeURIComponent(qt)))}return"data:application/pdf;filename="+tt.filename+";base64,"+It;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Nr)==="[object Window]"){var te="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",ie=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';tt.pdfObjectUrl&&(te=tt.pdfObjectUrl,ie="");var Me='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+te+'"'+ie+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(tt)+");<\/script></body></html>",er=Nr.open();return er!==null&&er.document.write(Me),er}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Nr)==="[object Window]"){var Ar='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(tt.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+tt.filename+'" width="500px" height="400px" /></body></html>',Lr=Nr.open();if(Lr!==null){Lr.document.write(Ar);var dr=this;Lr.document.documentElement.querySelector("#pdfViewer").onload=function(){Lr.document.title=tt.filename,Lr.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(dr.output("bloburl"))}}return Lr}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Nr)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var si='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",tt)+'"></iframe></body></html>',fr=Nr.open();if(fr!==null&&(fr.document.write(si),fr.document.title=tt.filename),fr||typeof safari>"u")return fr;break;case"datauri":case"dataurl":return Nr.document.location.href=this.output("datauristring",tt);default:return null}}),un=function(D){return Array.isArray(wt)===!0&&wt.indexOf(D)>-1};switch(i){case"pt":Re=1;break;case"mm":Re=72/25.4;break;case"cm":Re=72/2.54;break;case"in":Re=72;break;case"px":Re=un("px_scaling")==1?.75:96/72;break;case"pc":case"em":Re=12;break;case"ex":Re=6;break;default:if(typeof i!="number")throw new Error("Invalid unit: "+i);Re=i}var Ti=null;xe(),Dt();var _h=function(D){return w!==null?Ti.encryptor(D,0):function(tt){return tt}},Fl=I.__private__.getPageInfo=I.getPageInfo=function(D){if(isNaN(D)||D%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Q[D].objId,pageNumber:D,pageContext:Q[D]}},kr=I.__private__.getPageInfoByObjId=function(D){if(isNaN(D)||D%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var tt in Q)if(Q[tt].objId===D)break;return Fl(tt)},Sa=I.__private__.getCurrentPageInfo=I.getCurrentPageInfo=function(){return{objId:Q[Tt].objId,pageNumber:Tt,pageContext:Q[Tt]}};I.addPage=function(){return Po.apply(this,arguments),this},I.setPage=function(){return Us.apply(this,arguments),ge.call(this,Be[Tt]),this},I.insertPage=function(D){return this.addPage(),this.movePage(Tt,D),this},I.movePage=function(D,tt){var It,qt;if(D>tt){It=Be[D],qt=Q[D];for(var te=D;te>tt;te--)Be[te]=Be[te-1],Q[te]=Q[te-1];Be[tt]=It,Q[tt]=qt,this.setPage(tt)}else if(D<tt){It=Be[D],qt=Q[D];for(var ie=D;ie<tt;ie++)Be[ie]=Be[ie+1],Q[ie]=Q[ie+1];Be[tt]=It,Q[tt]=qt,this.setPage(tt)}return this},I.deletePage=function(){return Io.apply(this,arguments),this},I.__private__.text=I.text=function(D,tt,It,qt,te){var ie,Me,er,Ar,Lr,dr,si,fr,Qi,Or=(qt=qt||{}).scope||this;if(typeof D=="number"&&typeof tt=="number"&&(typeof It=="string"||Array.isArray(It))){var jr=It;It=tt,tt=D,D=jr}if(arguments[3]instanceof Ct?(pt("The transform parameter of text() with a Matrix value"),Qi=te):(er=arguments[4],Ar=arguments[5],Gi(si=arguments[3])==="object"&&si!==null||(typeof er=="string"&&(Ar=er,er=null),typeof si=="string"&&(Ar=si,si=null),typeof si=="number"&&(er=si,si=null),qt={flags:si,angle:er,align:Ar})),isNaN(tt)||isNaN(It)||D==null)throw new Error("Invalid arguments passed to jsPDF.text");if(D.length===0)return Or;var Zi="",Ss=!1,Es=typeof qt.lineHeightFactor=="number"?qt.lineHeightFactor:ea,na=Or.internal.scaleFactor;function Hl(ii){return ii=ii.split("	").join(Array(qt.TabLen||9).join(" ")),vn(ii,si)}function ll(ii){for(var yi,_i=ii.concat(),ji=[],Ma=_i.length;Ma--;)typeof(yi=_i.shift())=="string"?ji.push(yi):Array.isArray(ii)&&(yi.length===1||yi[1]===void 0&&yi[2]===void 0)?ji.push(yi[0]):ji.push([yi[0],yi[1],yi[2]]);return ji}function cl(ii,yi){var _i;if(typeof ii=="string")_i=yi(ii)[0];else if(Array.isArray(ii)){for(var ji,Ma,la=ii.concat(),qc=[],La=la.length;La--;)typeof(ji=la.shift())=="string"?qc.push(yi(ji)[0]):Array.isArray(ji)&&typeof ji[0]=="string"&&(Ma=yi(ji[0],ji[1],ji[2]),qc.push([Ma[0],Ma[1],Ma[2]]));_i=qc}return _i}var Wl=!1,ul=!0;if(typeof D=="string")Wl=!0;else if(Array.isArray(D)){var Uc=D.concat();Me=[];for(var Ta,Xn=Uc.length;Xn--;)(typeof(Ta=Uc.shift())!="string"||Array.isArray(Ta)&&typeof Ta[0]!="string")&&(ul=!1);Wl=ul}if(Wl===!1)throw new Error('Type of text must be string or Array. "'+D+'" is not recognized.');typeof D=="string"&&(D=D.match(/[\r?\n]/)?D.split(/\r\n|\r|\n/g):[D]);var hl=ve/Or.internal.scaleFactor,$l=hl*(Es-1);switch(qt.baseline){case"bottom":It-=$l;break;case"top":It+=hl-$l;break;case"hanging":It+=hl-2*$l;break;case"middle":It+=hl/2-$l}if((dr=qt.maxWidth||0)>0&&(typeof D=="string"?D=Or.splitTextToSize(D,dr):Object.prototype.toString.call(D)==="[object Array]"&&(D=D.reduce(function(ii,yi){return ii.concat(Or.splitTextToSize(yi,dr))},[]))),ie={text:D,x:tt,y:It,options:qt,mutex:{pdfEscape:vn,activeFontKey:Tr,fonts:Ye,activeFontSize:ve}},ot.publish("preProcessText",ie),D=ie.text,er=(qt=ie.options).angle,!(Qi instanceof Ct)&&er&&typeof er=="number"){er*=Math.PI/180,qt.rotationDirection===0&&(er=-er),J===z.ADVANCED&&(er=-er);var Zl=Math.cos(er),dl=Math.sin(er);Qi=new Ct(Zl,dl,-dl,Zl,0,0)}else er&&er instanceof Ct&&(Qi=er);J!==z.ADVANCED||Qi||(Qi=ye),(Lr=qt.charSpace||Nc)!==void 0&&(Zi+=bt(dt(Lr))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(fr=qt.horizontalScale)!==void 0&&(Zi+=bt(100*fr)+` Tz
`),qt.lang;var ls=-1,Md=qt.renderingMode!==void 0?qt.renderingMode:qt.stroke,Gc=Or.internal.getCurrentPageInfo().pageContext;switch(Md){case 0:case!1:case"fill":ls=0;break;case 1:case!0:case"stroke":ls=1;break;case 2:case"fillThenStroke":ls=2;break;case 3:case"invisible":ls=3;break;case 4:case"fillAndAddForClipping":ls=4;break;case 5:case"strokeAndAddPathForClipping":ls=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":ls=6;break;case 7:case"addToPathForClipping":ls=7}var Oi=Gc.usedRenderingMode!==void 0?Gc.usedRenderingMode:-1;ls!==-1?Zi+=ls+` Tr
`:Oi!==-1&&(Zi+=`0 Tr
`),ls!==-1&&(Gc.usedRenderingMode=ls),Ar=qt.align||"left";var Dn,Cn=ve*Es,Eu=Or.internal.pageSize.getWidth(),Vc=Ye[Tr];Lr=qt.charSpace||Nc,dr=qt.maxWidth||0,si=Object.assign({autoencode:!0,noBOM:!0},qt.flags);var Pa=[];if(Object.prototype.toString.call(D)==="[object Array]"){var Tn;Me=ll(D),Ar!=="left"&&(Dn=Me.map(function(ii){return Or.getStringUnitWidth(ii,{font:Vc,charSpace:Lr,fontSize:ve,doKerning:!1})*ve/na}));var Nn,Gs=0;if(Ar==="right"){tt-=Dn[0],D=[],Xn=Me.length;for(var ro=0;ro<Xn;ro++)ro===0?(Nn=Mo(tt),Tn=Lo(It)):(Nn=dt(Gs-Dn[ro]),Tn=-Cn),D.push([Me[ro],Nn,Tn]),Gs=Dn[ro]}else if(Ar==="center"){tt-=Dn[0]/2,D=[],Xn=Me.length;for(var io=0;io<Xn;io++)io===0?(Nn=Mo(tt),Tn=Lo(It)):(Nn=dt((Gs-Dn[io])/2),Tn=-Cn),D.push([Me[io],Nn,Tn]),Gs=Dn[io]}else if(Ar==="left"){D=[],Xn=Me.length;for(var fl=0;fl<Xn;fl++)D.push(Me[fl])}else{if(Ar!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');D=[],Xn=Me.length,dr=dr!==0?dr:Eu;for(var Vs=0;Vs<Xn;Vs++)Tn=Vs===0?Lo(It):-Cn,Nn=Vs===0?Mo(tt):0,Vs<Xn-1?Pa.push(bt(dt((dr-Dn[Vs])/(Me[Vs].split(" ").length-1)))):Pa.push(0),D.push([Me[Vs],Nn,Tn])}}var sa=typeof qt.R2L=="boolean"?qt.R2L:lr;sa===!0&&(D=cl(D,function(ii,yi,_i){return[ii.split("").reverse().join(""),yi,_i]})),ie={text:D,x:tt,y:It,options:qt,mutex:{pdfEscape:vn,activeFontKey:Tr,fonts:Ye,activeFontSize:ve}},ot.publish("postProcessText",ie),D=ie.text,Ss=ie.mutex.isHex||!1;var Ro=Ye[Tr].encoding;Ro!=="WinAnsiEncoding"&&Ro!=="StandardEncoding"||(D=cl(D,function(ii,yi,_i){return[Hl(ii),yi,_i]})),Me=ll(D),D=[];for(var Ia,no,oa,pl=0,aa=1,Oo=Array.isArray(Me[0])?aa:pl,dn="",Cs=function(ii,yi,_i){var ji="";return _i instanceof Ct?(_i=typeof qt.angle=="number"?Jt(_i,new Ct(1,0,0,1,ii,yi)):Jt(new Ct(1,0,0,1,ii,yi),_i),J===z.ADVANCED&&(_i=Jt(new Ct(1,0,0,-1,0,0),_i)),ji=_i.join(" ")+` Tm
`):ji=bt(ii)+" "+bt(yi)+` Td
`,ji},Ts=0;Ts<Me.length;Ts++){switch(dn="",Oo){case aa:oa=(Ss?"<":"(")+Me[Ts][0]+(Ss?">":")"),Ia=parseFloat(Me[Ts][1]),no=parseFloat(Me[Ts][2]);break;case pl:oa=(Ss?"<":"(")+Me[Ts]+(Ss?">":")"),Ia=Mo(tt),no=Lo(It)}Pa!==void 0&&Pa[Ts]!==void 0&&(dn=Pa[Ts]+` Tw
`),Ts===0?D.push(dn+Cs(Ia,no,Qi)+oa):Oo===pl?D.push(dn+oa):Oo===aa&&D.push(dn+Cs(Ia,no,Qi)+oa)}D=Oo===pl?D.join(` Tj
T* `):D.join(` Tj
`),D+=` Tj
`;var Pn=`BT
/`;return Pn+=Tr+" "+ve+` Tf
`,Pn+=bt(ve*Es)+` TL
`,Pn+=nl+`
`,Pn+=Zi,Pn+=D,Bt(Pn+="ET"),P[Tr]=!0,Or};var Rc=I.__private__.clip=I.clip=function(D){return Bt(D==="evenodd"?"W*":"W"),this};I.clipEvenOdd=function(){return Rc("evenodd")},I.__private__.discardPath=I.discardPath=function(){return Bt("n"),this};var on=I.__private__.isValidStyle=function(D){var tt=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(D)!==-1&&(tt=!0),tt};I.__private__.setDefaultPathOperation=I.setDefaultPathOperation=function(D){return on(D)&&(m=D),this};var el=I.__private__.getStyle=I.getStyle=function(D){var tt=m;switch(D){case"D":case"S":tt="S";break;case"F":tt="f";break;case"FD":case"DF":tt="B";break;case"f":case"f*":case"B":case"B*":tt=D}return tt},zl=I.close=function(){return Bt("h"),this};I.stroke=function(){return Bt("S"),this},I.fill=function(D){return ta("f",D),this},I.fillEvenOdd=function(D){return ta("f*",D),this},I.fillStroke=function(D){return ta("B",D),this},I.fillStrokeEvenOdd=function(D){return ta("B*",D),this};var ta=function(D,tt){Gi(tt)==="object"?Ul(tt,D):Bt(D)},Ea=function(D){D===null||J===z.ADVANCED&&D===void 0||(D=el(D),Bt(D))};function jl(D,tt,It,qt,te){var ie=new Rp(tt||this.boundingBox,It||this.xStep,qt||this.yStep,this.gState,te||this.matrix);ie.stream=this.stream;var Me=D+"$$"+this.cloneIndex+++"$$";return fe(Me,ie),ie}var Ul=function(D,tt){var It=wr[D.key],qt=Fr[It];if(qt instanceof of)Bt("q"),Bt(Pd(tt)),qt.gState&&I.setGState(qt.gState),Bt(D.matrix.toString()+" cm"),Bt("/"+It+" sh"),Bt("Q");else if(qt instanceof Rp){var te=new Ct(1,0,0,-1,0,ia());D.matrix&&(te=te.multiply(D.matrix||ye),It=jl.call(qt,D.key,D.boundingBox,D.xStep,D.yStep,te).id),Bt("q"),Bt("/Pattern cs"),Bt("/"+It+" scn"),qt.gState&&I.setGState(qt.gState),Bt(tt),Bt("Q")}},Pd=function(D){switch(D){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},bu=I.moveTo=function(D,tt){return Bt(bt(dt(D))+" "+bt(xt(tt))+" m"),this},rl=I.lineTo=function(D,tt){return Bt(bt(dt(D))+" "+bt(xt(tt))+" l"),this},il=I.curveTo=function(D,tt,It,qt,te,ie){return Bt([bt(dt(D)),bt(xt(tt)),bt(dt(It)),bt(xt(qt)),bt(dt(te)),bt(xt(ie)),"c"].join(" ")),this};I.__private__.line=I.line=function(D,tt,It,qt,te){if(isNaN(D)||isNaN(tt)||isNaN(It)||isNaN(qt)||!on(te))throw new Error("Invalid arguments passed to jsPDF.line");return J===z.COMPAT?this.lines([[It-D,qt-tt]],D,tt,[1,1],te||"S"):this.lines([[It-D,qt-tt]],D,tt,[1,1]).stroke()},I.__private__.lines=I.lines=function(D,tt,It,qt,te,ie){var Me,er,Ar,Lr,dr,si,fr,Qi,Or,jr,Zi,Ss;if(typeof D=="number"&&(Ss=It,It=tt,tt=D,D=Ss),qt=qt||[1,1],ie=ie||!1,isNaN(tt)||isNaN(It)||!Array.isArray(D)||!Array.isArray(qt)||!on(te)||typeof ie!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(bu(tt,It),Me=qt[0],er=qt[1],Lr=D.length,jr=tt,Zi=It,Ar=0;Ar<Lr;Ar++)(dr=D[Ar]).length===2?(jr=dr[0]*Me+jr,Zi=dr[1]*er+Zi,rl(jr,Zi)):(si=dr[0]*Me+jr,fr=dr[1]*er+Zi,Qi=dr[2]*Me+jr,Or=dr[3]*er+Zi,jr=dr[4]*Me+jr,Zi=dr[5]*er+Zi,il(si,fr,Qi,Or,jr,Zi));return ie&&zl(),Ea(te),this},I.path=function(D){for(var tt=0;tt<D.length;tt++){var It=D[tt],qt=It.c;switch(It.op){case"m":bu(qt[0],qt[1]);break;case"l":rl(qt[0],qt[1]);break;case"c":il.apply(this,qt);break;case"h":zl()}}return this},I.__private__.rect=I.rect=function(D,tt,It,qt,te){if(isNaN(D)||isNaN(tt)||isNaN(It)||isNaN(qt)||!on(te))throw new Error("Invalid arguments passed to jsPDF.rect");return J===z.COMPAT&&(qt=-qt),Bt([bt(dt(D)),bt(xt(tt)),bt(dt(It)),bt(dt(qt)),"re"].join(" ")),Ea(te),this},I.__private__.triangle=I.triangle=function(D,tt,It,qt,te,ie,Me){if(isNaN(D)||isNaN(tt)||isNaN(It)||isNaN(qt)||isNaN(te)||isNaN(ie)||!on(Me))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[It-D,qt-tt],[te-It,ie-qt],[D-te,tt-ie]],D,tt,[1,1],Me,!0),this},I.__private__.roundedRect=I.roundedRect=function(D,tt,It,qt,te,ie,Me){if(isNaN(D)||isNaN(tt)||isNaN(It)||isNaN(qt)||isNaN(te)||isNaN(ie)||!on(Me))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var er=4/3*(Math.SQRT2-1);return te=Math.min(te,.5*It),ie=Math.min(ie,.5*qt),this.lines([[It-2*te,0],[te*er,0,te,ie-ie*er,te,ie],[0,qt-2*ie],[0,ie*er,-te*er,ie,-te,ie],[2*te-It,0],[-te*er,0,-te,-ie*er,-te,-ie],[0,2*ie-qt],[0,-ie*er,te*er,-ie,te,-ie]],D+te,tt,[1,1],Me,!0),this},I.__private__.ellipse=I.ellipse=function(D,tt,It,qt,te){if(isNaN(D)||isNaN(tt)||isNaN(It)||isNaN(qt)||!on(te))throw new Error("Invalid arguments passed to jsPDF.ellipse");var ie=4/3*(Math.SQRT2-1)*It,Me=4/3*(Math.SQRT2-1)*qt;return bu(D+It,tt),il(D+It,tt-Me,D+ie,tt-qt,D,tt-qt),il(D-ie,tt-qt,D-It,tt-Me,D-It,tt),il(D-It,tt+Me,D-ie,tt+qt,D,tt+qt),il(D+ie,tt+qt,D+It,tt+Me,D+It,tt),Ea(te),this},I.__private__.circle=I.circle=function(D,tt,It,qt){if(isNaN(D)||isNaN(tt)||isNaN(It)||!on(qt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(D,tt,It,It,qt)},I.setFont=function(D,tt,It){return It&&(tt=Et(tt,It)),Tr=st(D,tt,{disableWarning:!1}),this};var Ca=I.__private__.getFont=I.getFont=function(){return Ye[st.apply(I,arguments)]};I.__private__.getFontList=I.getFontList=function(){var D,tt,It={};for(D in tr)if(tr.hasOwnProperty(D))for(tt in It[D]=[],tr[D])tr[D].hasOwnProperty(tt)&&It[D].push(tt);return It},I.addFont=function(D,tt,It,qt,te){var ie=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&ie.indexOf(arguments[3])!==-1?te=arguments[3]:arguments[3]&&ie.indexOf(arguments[3])==-1&&(It=Et(It,qt)),te=te||"Identity-H",eo.call(this,D,tt,It,te)};var ea,En=e.lineWidth||.200025,hn=I.__private__.getLineWidth=I.getLineWidth=function(){return En},Kr=I.__private__.setLineWidth=I.setLineWidth=function(D){return En=D,Bt(bt(dt(D))+" w"),this};I.__private__.setLineDash=Dr.API.setLineDash=Dr.API.setLineDashPattern=function(D,tt){if(D=D||[],tt=tt||0,isNaN(tt)||!Array.isArray(D))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return D=D.map(function(It){return bt(dt(It))}).join(" "),tt=bt(dt(tt)),Bt("["+D+"] "+tt+" d"),this};var Gl=I.__private__.getLineHeight=I.getLineHeight=function(){return ve*ea};I.__private__.getLineHeight=I.getLineHeight=function(){return ve*ea};var Vl=I.__private__.setLineHeightFactor=I.setLineHeightFactor=function(D){return typeof(D=D||1.15)=="number"&&(ea=D),this},Oc=I.__private__.getLineHeightFactor=I.getLineHeightFactor=function(){return ea};Vl(e.lineHeight);var Mo=I.__private__.getHorizontalCoordinate=function(D){return dt(D)},Lo=I.__private__.getVerticalCoordinate=function(D){return J===z.ADVANCED?D:Q[Tt].mediaBox.topRightY-Q[Tt].mediaBox.bottomLeftY-dt(D)},wu=I.__private__.getHorizontalCoordinateString=I.getHorizontalCoordinateString=function(D){return bt(Mo(D))},ra=I.__private__.getVerticalCoordinateString=I.getVerticalCoordinateString=function(D){return bt(Lo(D))},As=e.strokeColor||"0 G";I.__private__.getStrokeColor=I.getDrawColor=function(){return zr(As)},I.__private__.setStrokeColor=I.setDrawColor=function(D,tt,It,qt){return As=$r({ch1:D,ch2:tt,ch3:It,ch4:qt,pdfColorType:"draw",precision:2}),Bt(As),this};var Dc=e.fillColor||"0 g";I.__private__.getFillColor=I.getFillColor=function(){return zr(Dc)},I.__private__.setFillColor=I.setFillColor=function(D,tt,It,qt){return Dc=$r({ch1:D,ch2:tt,ch3:It,ch4:qt,pdfColorType:"fill",precision:2}),Bt(Dc),this};var nl=e.textColor||"0 g",sl=I.__private__.getTextColor=I.getTextColor=function(){return zr(nl)};I.__private__.setTextColor=I.setTextColor=function(D,tt,It,qt){return nl=$r({ch1:D,ch2:tt,ch3:It,ch4:qt,pdfColorType:"text",precision:3}),this};var Nc=e.charSpace,Id=I.__private__.getCharSpace=I.getCharSpace=function(){return parseFloat(Nc||0)};I.__private__.setCharSpace=I.setCharSpace=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Nc=D,this};var xu=0;I.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},I.__private__.setLineCap=I.setLineCap=function(D){var tt=I.CapJoinStyles[D];if(tt===void 0)throw new Error("Line cap style of '"+D+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return xu=tt,Bt(tt+" J"),this};var Au=0;I.__private__.setLineJoin=I.setLineJoin=function(D){var tt=I.CapJoinStyles[D];if(tt===void 0)throw new Error("Line join style of '"+D+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Au=tt,Bt(tt+" j"),this},I.__private__.setLineMiterLimit=I.__private__.setMiterLimit=I.setLineMiterLimit=I.setMiterLimit=function(D){if(D=D||0,isNaN(D))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return Bt(bt(dt(D))+" M"),this},I.GState=B_,I.setGState=function(D){(D=typeof D=="string"?bi[ai[D]]:vh(null,D)).equals(At)||(Bt("/"+D.id+" gs"),At=D)};var vh=function(D,tt){if(!D||!ai[D]){var It=!1;for(var qt in bi)if(bi.hasOwnProperty(qt)&&bi[qt].equals(tt)){It=!0;break}if(It)tt=bi[qt];else{var te="GS"+(Object.keys(bi).length+1).toString(10);bi[te]=tt,tt.id=te}return D&&(ai[D]=tt.id),ot.publish("addGState",tt),tt}};I.addGState=function(D,tt){return vh(D,tt),this},I.saveGraphicsState=function(){return Bt("q"),fi.push({key:Tr,size:ve,color:nl}),this},I.restoreGraphicsState=function(){Bt("Q");var D=fi.pop();return Tr=D.key,ve=D.size,nl=D.color,At=null,this},I.setCurrentTransformationMatrix=function(D){return Bt(D.toString()+" cm"),this},I.comment=function(D){return Bt("#"+D),this};var Fc=function(D,tt){var It=D||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return It},set:function(ie){isNaN(ie)||(It=parseFloat(ie))}});var qt=tt||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return qt},set:function(ie){isNaN(ie)||(qt=parseFloat(ie))}});var te="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return te},set:function(ie){te=ie.toString()}}),this},ql=function(D,tt,It,qt){Fc.call(this,D,tt),this.type="rect";var te=It||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return te},set:function(Me){isNaN(Me)||(te=parseFloat(Me))}});var ie=qt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return ie},set:function(Me){isNaN(Me)||(ie=parseFloat(Me))}}),this},ol=function(){this.page=Y,this.currentPage=Tt,this.pages=Be.slice(0),this.pagesContext=Q.slice(0),this.x=Hi,this.y=Pr,this.matrix=Pe,this.width=al(Tt),this.height=ia(Tt),this.outputDestination=Ve,this.id="",this.objectNumber=-1};ol.prototype.restore=function(){Y=this.page,Tt=this.currentPage,Q=this.pagesContext,Be=this.pages,Hi=this.x,Pr=this.y,Pe=this.matrix,jc(Tt,this.width),ko(Tt,this.height),Ve=this.outputDestination};var zc=function(D,tt,It,qt,te){Ht.push(new ol),Y=Tt=0,Be=[],Hi=D,Pr=tt,Pe=te,Xr([It,qt])},Su=function(D){if(Gt[D])Ht.pop().restore();else{var tt=new ol,It="Xo"+(Object.keys(Nt).length+1).toString(10);tt.id=It,Gt[D]=It,Nt[It]=tt,ot.publish("addFormObject",tt),Ht.pop().restore()}};for(var Bo in I.beginFormObject=function(D,tt,It,qt,te){return zc(D,tt,It,qt,te),this},I.endFormObject=function(D){return Su(D),this},I.doFormObject=function(D,tt){var It=Nt[Gt[D]];return Bt("q"),Bt(tt.toString()+" cm"),Bt("/"+It.id+" Do"),Bt("Q"),this},I.getFormObject=function(D){var tt=Nt[Gt[D]];return{x:tt.x,y:tt.y,width:tt.width,height:tt.height,matrix:tt.matrix}},I.save=function(D,tt){return D=D||"generated.pdf",(tt=tt||{}).returnPromise=tt.returnPromise||!1,tt.returnPromise===!1?(rf(mi(Br()),D),typeof rf.unload=="function"&&Nr.setTimeout&&setTimeout(rf.unload,911),this):new Promise(function(It,qt){try{var te=rf(mi(Br()),D);typeof rf.unload=="function"&&Nr.setTimeout&&setTimeout(rf.unload,911),It(te)}catch(ie){qt(ie.message)}})},Dr.API)Dr.API.hasOwnProperty(Bo)&&(Bo==="events"&&Dr.API.events.length?function(D,tt){var It,qt,te;for(te=tt.length-1;te!==-1;te--)It=tt[te][0],qt=tt[te][1],D.subscribe.apply(D,[It].concat(typeof qt=="function"?[qt]:qt))}(ot,Dr.API.events):I[Bo]=Dr.API[Bo]);var al=I.getPageWidth=function(D){return(Q[D=D||Tt].mediaBox.topRightX-Q[D].mediaBox.bottomLeftX)/Re},jc=I.setPageWidth=function(D,tt){Q[D].mediaBox.topRightX=tt*Re+Q[D].mediaBox.bottomLeftX},ia=I.getPageHeight=function(D){return(Q[D=D||Tt].mediaBox.topRightY-Q[D].mediaBox.bottomLeftY)/Re},ko=I.setPageHeight=function(D,tt){Q[D].mediaBox.topRightY=tt*Re+Q[D].mediaBox.bottomLeftY};return I.internal={pdfEscape:vn,getStyle:el,getFont:Ca,getFontSize:qe,getCharSpace:Id,getTextColor:sl,getLineHeight:Gl,getLineHeightFactor:Oc,getLineWidth:hn,write:Xt,getHorizontalCoordinate:Mo,getVerticalCoordinate:Lo,getCoordinateString:wu,getVerticalCoordinateString:ra,collections:{},newObject:ce,newAdditionalObject:xr,newObjectDeferred:He,newObjectDeferredBegin:Ze,getFilters:li,putStream:ur,events:ot,scaleFactor:Re,pageSize:{getWidth:function(){return al(Tt)},setWidth:function(D){jc(Tt,D)},getHeight:function(){return ia(Tt)},setHeight:function(D){ko(Tt,D)}},encryptionOptions:w,encryption:Ti,getEncryptor:_h,output:Sn,getNumberOfPages:tl,pages:Be,out:Bt,f2:Rt,f3:at,getPageInfo:Fl,getPageInfoByObjId:kr,getCurrentPageInfo:Sa,getPDFVersion:F,Point:Fc,Rectangle:ql,Matrix:Ct,hasHotfix:un},Object.defineProperty(I.internal.pageSize,"width",{get:function(){return al(Tt)},set:function(D){jc(Tt,D)},enumerable:!0,configurable:!0}),Object.defineProperty(I.internal.pageSize,"height",{get:function(){return ia(Tt)},set:function(D){ko(Tt,D)},enumerable:!0,configurable:!0}),xn.call(I,Ie),Tr="F1",Po(n,r),ot.publish("initialized"),I}gp.prototype.lsbFirstWord=function(e){return String.fromCharCode(e>>0&255,e>>8&255,e>>16&255,e>>24&255)},gp.prototype.toHexString=function(e){return e.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},gp.prototype.hexToBytes=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(String.fromCharCode(parseInt(e.substr(r,2),16)));return t.join("")},gp.prototype.processOwnerPassword=function(e,t){return Vx(Gx(t).substr(0,5),e)},gp.prototype.encryptor=function(e,t){var r=Gx(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(i){return Vx(r,i)}},B_.prototype.equals=function(e){var t,r="id,objectNumber,equals";if(!e||Gi(e)!==Gi(this))return!1;var i=0;for(t in this)if(!(r.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t)||this[t]!==e[t])return!1;i++}for(t in e)e.hasOwnProperty(t)&&r.indexOf(t)<0&&i--;return i===0},Dr.API={events:[]},Dr.version="2.5.1";var Hn=Dr.API,gS=1,Of=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},hp=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Hr=function(e){return e.toFixed(2)},Xh=function(e){return e.toFixed(5)};Hn.__acroform__={};var xa=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},kI=function(e){return e*gS},nu=function(e){var t=new Bk,r=mr.internal.getHeight(e)||0,i=mr.internal.getWidth(e)||0;return t.BBox=[0,0,Number(Hr(i)),Number(Hr(r))],t},Uet=Hn.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|=1<<t},Get=Hn.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&=~(1<<t)},Vet=Hn.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return e&1<<t?1:0},ss=Hn.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Vet(e,t-1)},os=Hn.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Uet(e,t-1)},as=Hn.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Get(e,t-1)},qet=Hn.__acroform__.calculateCoordinates=function(e,t){var r=t.internal.getHorizontalCoordinate,i=t.internal.getVerticalCoordinate,n=e[0],s=e[1],a=e[2],o=e[3],f={};return f.lowerLeft_X=r(n)||0,f.lowerLeft_Y=i(s+o)||0,f.upperRight_X=r(n+a)||0,f.upperRight_Y=i(s)||0,[Number(Hr(f.lowerLeft_X)),Number(Hr(f.lowerLeft_Y)),Number(Hr(f.upperRight_X)),Number(Hr(f.upperRight_Y))]},Het=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],r=e._V||e.DV,i=qx(e,r),n=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+n+" "+Hr(i.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(i.text),t.push("ET"),t.push("Q"),t.push("EMC");var s=nu(e);return s.scope=e.scope,s.stream=t.join(`
`),s}},qx=function(e,t){var r=e.fontSize===0?e.maxFontSize:e.fontSize,i={text:"",fontSize:""},n=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");n=e.multiline?n.map(function(at){return at.split(`
`)}):n.map(function(at){return[at]});var s=r,a=mr.internal.getHeight(e)||0;a=a<0?-a:a;var o=mr.internal.getWidth(e)||0;o=o<0?-o:o;var f=function(at,dt,kt){if(at+1<n.length){var xt=dt+" "+n[at+1][0];return iy(xt,e,kt).width<=o-4}return!1};s++;t:for(;s>0;){t="",s--;var m,w,A=iy("3",e,s).height,P=e.multiline?a-s:(a-A)/2,I=P+=2,N=0,F=0,Z=0;if(s<=0){t=`(...) Tj
`,t+="% Width of Text: "+iy(t,e,s=12).width+", FieldWidth:"+o+`
`;break}for(var U="",z=0,J=0;J<n.length;J++)if(n.hasOwnProperty(J)){var nt=!1;if(n[J].length!==1&&Z!==n[J].length-1){if((A+2)*(z+2)+2>a)continue t;U+=n[J][Z],nt=!0,F=J,J--}else{U=(U+=n[J][Z]+" ").substr(U.length-1)==" "?U.substr(0,U.length-1):U;var mt=parseInt(J),Et=f(mt,U,s),bt=J>=n.length-1;if(Et&&!bt){U+=" ",Z=0;continue}if(Et||bt){if(bt)F=mt;else if(e.multiline&&(A+2)*(z+2)+2>a)continue t}else{if(!e.multiline||(A+2)*(z+2)+2>a)continue t;F=mt}}for(var pt="",zt=N;zt<=F;zt++){var Rt=n[zt];if(e.multiline){if(zt===F){pt+=Rt[Z]+" ",Z=(Z+1)%Rt.length;continue}if(zt===N){pt+=Rt[Rt.length-1]+" ";continue}}pt+=Rt[0]+" "}switch(pt=pt.substr(pt.length-1)==" "?pt.substr(0,pt.length-1):pt,w=iy(pt,e,s).width,e.textAlign){case"right":m=o-w-2;break;case"center":m=(o-w)/2;break;case"left":default:m=2}t+=Hr(m)+" "+Hr(I)+` Td
`,t+="("+Of(pt)+`) Tj
`,t+=-Hr(m)+` 0 Td
`,I=-(s+2),w=0,N=nt?F:F+1,z++,U=""}break}return i.text=t,i.fontSize=s,i},iy=function(e,t,r){var i=t.scope.internal.getFont(t.fontName,t.fontStyle),n=t.scope.getStringUnitWidth(e,{font:i,fontSize:parseFloat(r),charSpace:0})*parseFloat(r);return{height:t.scope.getStringUnitWidth("3",{font:i,fontSize:parseFloat(r),charSpace:0})*parseFloat(r)*1.5,width:n}},Wet={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},$et=function(e,t){var r={type:"reference",object:e};t.internal.getPageInfo(e.page).pageContext.annotations.find(function(i){return i.type===r.type&&i.object===r.object})===void 0&&t.internal.getPageInfo(e.page).pageContext.annotations.push(r)},Zet=function(e,t){for(var r in e)if(e.hasOwnProperty(r)){var i=r,n=e[r];t.internal.newObjectDeferredBegin(n.objId,!0),Gi(n)==="object"&&typeof n.putStream=="function"&&n.putStream(),delete e[i]}},Jet=function(e,t){if(t.scope=e,e.internal!==void 0&&(e.internal.acroformPlugin===void 0||e.internal.acroformPlugin.isInitialized===!1)){if(Bc.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(Wet)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");gS=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new kk,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){(function(r){r.internal.events.unsubscribe(r.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete r.internal.acroformPlugin.acroFormDictionaryRoot._eventID,r.internal.acroformPlugin.printedOut=!0})(e)}),e.internal.events.subscribe("buildDocument",function(){(function(r){r.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var i=r.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in i)if(i.hasOwnProperty(n)){var s=i[n];s.objId=void 0,s.hasAnnotation&&$et(s,r)}})(e)}),e.internal.events.subscribe("putCatalog",function(){(function(r){if(r.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");r.internal.write("/AcroForm "+r.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(e)}),e.internal.events.subscribe("postPutPages",function(r){(function(i,n){var s=!i;for(var a in i||(n.internal.newObjectDeferredBegin(n.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),n.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),i=i||n.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(i.hasOwnProperty(a)){var o=i[a],f=[],m=o.Rect;if(o.Rect&&(o.Rect=qet(o.Rect,n)),n.internal.newObjectDeferredBegin(o.objId,!0),o.DA=mr.createDefaultAppearanceStream(o),Gi(o)==="object"&&typeof o.getKeyValueListForStream=="function"&&(f=o.getKeyValueListForStream()),o.Rect=m,o.hasAppearanceStream&&!o.appearanceStreamContent){var w=Het(o);f.push({key:"AP",value:"<</N "+w+">>"}),n.internal.acroformPlugin.xForms.push(w)}if(o.appearanceStreamContent){var A="";for(var P in o.appearanceStreamContent)if(o.appearanceStreamContent.hasOwnProperty(P)){var I=o.appearanceStreamContent[P];if(A+="/"+P+" ",A+="<<",Object.keys(I).length>=1||Array.isArray(I)){for(var a in I)if(I.hasOwnProperty(a)){var N=I[a];typeof N=="function"&&(N=N.call(n,o)),A+="/"+a+" "+N+" ",n.internal.acroformPlugin.xForms.indexOf(N)>=0||n.internal.acroformPlugin.xForms.push(N)}}else typeof(N=I)=="function"&&(N=N.call(n,o)),A+="/"+a+" "+N,n.internal.acroformPlugin.xForms.indexOf(N)>=0||n.internal.acroformPlugin.xForms.push(N);A+=">>"}f.push({key:"AP",value:`<<
`+A+">>"})}n.internal.putStream({additionalKeyValues:f,objectId:o.objId}),n.internal.out("endobj")}s&&Zet(n.internal.acroformPlugin.xForms,n)})(r,e)}),e.internal.acroformPlugin.isInitialized=!0}},Lk=Hn.__acroform__.arrayToPdfArray=function(e,t,r){var i=function(a){return a};if(Array.isArray(e)){for(var n="[",s=0;s<e.length;s++)switch(s!==0&&(n+=" "),Gi(e[s])){case"boolean":case"number":case"object":n+=e[s].toString();break;case"string":e[s].substr(0,1)!=="/"?(t!==void 0&&r&&(i=r.internal.getEncryptor(t)),n+="("+Of(i(e[s].toString()))+")"):n+=e[s].toString()}return n+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},G2=function(e,t,r){var i=function(n){return n};return t!==void 0&&r&&(i=r.internal.getEncryptor(t)),(e=e||"").toString(),e="("+Of(i(e))+")"},du=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};du.prototype.toString=function(){return this.objId+" 0 R"},du.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},du.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(s){return s!="content"&&s!="appearanceStreamContent"&&s!="scope"&&s!="objId"&&s.substring(0,1)!="_"});for(var r in t)if(Object.getOwnPropertyDescriptor(this,t[r]).configurable===!1){var i=t[r],n=this[i];n&&(Array.isArray(n)?e.push({key:i,value:Lk(n,this.objId,this.scope)}):n instanceof du?(n.scope=this.scope,e.push({key:i,value:n.objId+" 0 R"})):typeof n!="function"&&e.push({key:i,value:n}))}return e};var Bk=function(){du.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(r){e=r.trim()},get:function(){return e||null}})};xa(Bk,du);var kk=function(){du.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var r=function(i){return i};return this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),"("+Of(r(e))+")"}},set:function(r){e=r}})};xa(kk,du);var Bc=function e(){du.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(U){if(isNaN(U))throw new Error('Invalid value "'+U+'" for attribute F supplied.');t=U}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!ss(t,3)},set:function(U){U?this.F=os(t,3):this.F=as(t,3)}});var r=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return r},set:function(U){if(isNaN(U))throw new Error('Invalid value "'+U+'" for attribute Ff supplied.');r=U}});var i=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(i.length!==0)return i},set:function(U){i=U!==void 0?U:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[0])?0:i[0]},set:function(U){i[0]=U}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[1])?0:i[1]},set:function(U){i[1]=U}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[2])?0:i[2]},set:function(U){i[2]=U}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[3])?0:i[3]},set:function(U){i[3]=U}});var n="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return n},set:function(U){switch(U){case"/Btn":case"/Tx":case"/Ch":case"/Sig":n=U;break;default:throw new Error('Invalid value "'+U+'" for attribute FT supplied.')}}});var s=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!s||s.length<1){if(this instanceof k_)return;s="FieldObject"+e.FieldNum++}var U=function(z){return z};return this.scope&&(U=this.scope.internal.getEncryptor(this.objId)),"("+Of(U(s))+")"},set:function(U){s=U.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return s},set:function(U){s=U}});var a="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return a},set:function(U){a=U}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(U){o=U}});var f=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return f},set:function(U){f=U}});var m=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return m===void 0?50/gS:m},set:function(U){m=U}});var w="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return w},set:function(U){w=U}});var A="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!A||this instanceof k_||this instanceof vf))return G2(A,this.objId,this.scope)},set:function(U){U=U.toString(),A=U}});var P=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(P)return this instanceof Ds?P:G2(P,this.objId,this.scope)},set:function(U){U=U.toString(),P=this instanceof Ds?U:U.substr(0,1)==="("?hp(U.substr(1,U.length-2)):hp(U)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ds?hp(P.substr(1,P.length-1)):P},set:function(U){U=U.toString(),P=this instanceof Ds?"/"+U:U}});var I=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(I)return I},set:function(U){this.V=U}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(I)return this instanceof Ds?I:G2(I,this.objId,this.scope)},set:function(U){U=U.toString(),I=this instanceof Ds?U:U.substr(0,1)==="("?hp(U.substr(1,U.length-2)):hp(U)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ds?hp(I.substr(1,I.length-1)):I},set:function(U){U=U.toString(),I=this instanceof Ds?"/"+U:U}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var N,F=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return F},set:function(U){U=!!U,F=U}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(N)return N},set:function(U){N=U}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,1)},set:function(U){U?this.Ff=os(this.Ff,1):this.Ff=as(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,2)},set:function(U){U?this.Ff=os(this.Ff,2):this.Ff=as(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,3)},set:function(U){U?this.Ff=os(this.Ff,3):this.Ff=as(this.Ff,3)}});var Z=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(Z!==null)return Z},set:function(U){if([0,1,2].indexOf(U)===-1)throw new Error('Invalid value "'+U+'" for attribute Q supplied.');Z=U}}),Object.defineProperty(this,"textAlign",{get:function(){var U;switch(Z){case 0:default:U="left";break;case 1:U="center";break;case 2:U="right"}return U},configurable:!0,enumerable:!0,set:function(U){switch(U){case"right":case 2:Z=2;break;case"center":case 1:Z=1;break;case"left":case 0:default:Z=0}}})};xa(Bc,du);var Wp=function(){Bc.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){e=r}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return Lk(t,this.objId,this.scope)},set:function(r){var i,n;n=[],typeof(i=r)=="string"&&(n=function(s,a,o){o||(o=1);for(var f,m=[];f=a.exec(s);)m.push(f[o]);return m}(i,/\((.*?)\)/g)),t=n}}),this.getOptions=function(){return t},this.setOptions=function(r){t=r,this.sort&&t.sort()},this.addOption=function(r){r=(r=r||"").toString(),t.push(r),this.sort&&t.sort()},this.removeOption=function(r,i){for(i=i||!1,r=(r=r||"").toString();t.indexOf(r)!==-1&&(t.splice(t.indexOf(r),1),i!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,18)},set:function(r){r?this.Ff=os(this.Ff,18):this.Ff=as(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,19)},set:function(r){this.combo===!0&&(r?this.Ff=os(this.Ff,19):this.Ff=as(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,20)},set:function(r){r?(this.Ff=os(this.Ff,20),t.sort()):this.Ff=as(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,22)},set:function(r){r?this.Ff=os(this.Ff,22):this.Ff=as(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,23)},set:function(r){r?this.Ff=os(this.Ff,23):this.Ff=as(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,27)},set:function(r){r?this.Ff=os(this.Ff,27):this.Ff=as(this.Ff,27)}}),this.hasAppearanceStream=!1};xa(Wp,Bc);var $p=function(){Wp.call(this),this.fontName="helvetica",this.combo=!1};xa($p,Wp);var Zp=function(){$p.call(this),this.combo=!0};xa(Zp,$p);var Ly=function(){Zp.call(this),this.edit=!0};xa(Ly,Zp);var Ds=function(){Bc.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,15)},set:function(r){r?this.Ff=os(this.Ff,15):this.Ff=as(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,16)},set:function(r){r?this.Ff=os(this.Ff,16):this.Ff=as(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,17)},set:function(r){r?this.Ff=os(this.Ff,17):this.Ff=as(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,26)},set:function(r){r?this.Ff=os(this.Ff,26):this.Ff=as(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(s){return s};if(this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var i,n=[];for(i in n.push("<<"),t)n.push("/"+i+" ("+Of(r(t[i]))+")");return n.push(">>"),n.join(`
`)}},set:function(r){Gi(r)==="object"&&(t=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(r){typeof r=="string"&&(t.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(r){e="/"+r}})};xa(Ds,Bc);var By=function(){Ds.call(this),this.pushButton=!0};xa(By,Ds);var Jp=function(){Ds.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t!==void 0?t:[]}})};xa(Jp,Ds);var k_=function(){var e,t;Bc.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(n){e=n}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(n){t=n}});var r,i={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var n=function(o){return o};this.scope&&(n=this.scope.internal.getEncryptor(this.objId));var s,a=[];for(s in a.push("<<"),i)a.push("/"+s+" ("+Of(n(i[s]))+")");return a.push(">>"),a.join(`
`)},set:function(n){Gi(n)==="object"&&(i=n)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return i.CA||""},set:function(n){typeof n=="string"&&(i.CA=n)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(n){r=n}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(n){r="/"+n}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=mr.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};xa(k_,Bc),Jp.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var r=this.Kids[t];r.appearanceStreamContent=e.createAppearanceStream(r.optionName),r.caption=e.getCA()}},Jp.prototype.createOption=function(e){var t=new k_;return t.Parent=this,t.optionName=e,this.Kids.push(t),Xet.call(this.scope,t),t};var ky=function(){Ds.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=mr.CheckBox.createAppearanceStream()};xa(ky,Ds);var vf=function(){Bc.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,13)},set:function(t){t?this.Ff=os(this.Ff,13):this.Ff=as(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,21)},set:function(t){t?this.Ff=os(this.Ff,21):this.Ff=as(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,23)},set:function(t){t?this.Ff=os(this.Ff,23):this.Ff=as(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,24)},set:function(t){t?this.Ff=os(this.Ff,24):this.Ff=as(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,25)},set:function(t){t?this.Ff=os(this.Ff,25):this.Ff=as(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,26)},set:function(t){t?this.Ff=os(this.Ff,26):this.Ff=as(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};xa(vf,Bc);var Ry=function(){vf.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!ss(this.Ff,14)},set:function(e){e?this.Ff=os(this.Ff,14):this.Ff=as(this.Ff,14)}}),this.password=!0};xa(Ry,vf);var mr={CheckBox:{createAppearanceStream:function(){return{N:{On:mr.CheckBox.YesNormal},D:{On:mr.CheckBox.YesPushDown,Off:mr.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=nu(e);t.scope=e.scope;var r=[],i=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color),s=qx(e,e.caption);return r.push("0.749023 g"),r.push("0 0 "+Hr(mr.internal.getWidth(e))+" "+Hr(mr.internal.getHeight(e))+" re"),r.push("f"),r.push("BMC"),r.push("q"),r.push("0 0 1 rg"),r.push("/"+i+" "+Hr(s.fontSize)+" Tf "+n),r.push("BT"),r.push(s.text),r.push("ET"),r.push("Q"),r.push("EMC"),t.stream=r.join(`
`),t},YesNormal:function(e){var t=nu(e);t.scope=e.scope;var r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,i=e.scope.__private__.encodeColorString(e.color),n=[],s=mr.internal.getHeight(e),a=mr.internal.getWidth(e),o=qx(e,e.caption);return n.push("1 g"),n.push("0 0 "+Hr(a)+" "+Hr(s)+" re"),n.push("f"),n.push("q"),n.push("0 0 1 rg"),n.push("0 0 "+Hr(a-1)+" "+Hr(s-1)+" re"),n.push("W"),n.push("n"),n.push("0 g"),n.push("BT"),n.push("/"+r+" "+Hr(o.fontSize)+" Tf "+i),n.push(o.text),n.push("ET"),n.push("Q"),t.stream=n.join(`
`),t},OffPushDown:function(e){var t=nu(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+Hr(mr.internal.getWidth(e))+" "+Hr(mr.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:mr.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=mr.RadioButton.Circle.YesNormal,t.D[e]=mr.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=nu(e);t.scope=e.scope;var r=[],i=mr.internal.getWidth(e)<=mr.internal.getHeight(e)?mr.internal.getWidth(e)/4:mr.internal.getHeight(e)/4;i=Number((.9*i).toFixed(5));var n=mr.internal.Bezier_C,s=Number((i*n).toFixed(5));return r.push("q"),r.push("1 0 0 1 "+Xh(mr.internal.getWidth(e)/2)+" "+Xh(mr.internal.getHeight(e)/2)+" cm"),r.push(i+" 0 m"),r.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),r.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),r.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),r.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=nu(e);t.scope=e.scope;var r=[],i=mr.internal.getWidth(e)<=mr.internal.getHeight(e)?mr.internal.getWidth(e)/4:mr.internal.getHeight(e)/4;i=Number((.9*i).toFixed(5));var n=Number((2*i).toFixed(5)),s=Number((n*mr.internal.Bezier_C).toFixed(5)),a=Number((i*mr.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+Xh(mr.internal.getWidth(e)/2)+" "+Xh(mr.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),r.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),r.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),r.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),r.push("f"),r.push("Q"),r.push("0 g"),r.push("q"),r.push("1 0 0 1 "+Xh(mr.internal.getWidth(e)/2)+" "+Xh(mr.internal.getHeight(e)/2)+" cm"),r.push(i+" 0 m"),r.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),r.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),r.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),r.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},OffPushDown:function(e){var t=nu(e);t.scope=e.scope;var r=[],i=mr.internal.getWidth(e)<=mr.internal.getHeight(e)?mr.internal.getWidth(e)/4:mr.internal.getHeight(e)/4;i=Number((.9*i).toFixed(5));var n=Number((2*i).toFixed(5)),s=Number((n*mr.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+Xh(mr.internal.getWidth(e)/2)+" "+Xh(mr.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),r.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),r.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),r.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:mr.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=mr.RadioButton.Cross.YesNormal,t.D[e]=mr.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=nu(e);t.scope=e.scope;var r=[],i=mr.internal.calculateCross(e);return r.push("q"),r.push("1 1 "+Hr(mr.internal.getWidth(e)-2)+" "+Hr(mr.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(Hr(i.x1.x)+" "+Hr(i.x1.y)+" m"),r.push(Hr(i.x2.x)+" "+Hr(i.x2.y)+" l"),r.push(Hr(i.x4.x)+" "+Hr(i.x4.y)+" m"),r.push(Hr(i.x3.x)+" "+Hr(i.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=nu(e);t.scope=e.scope;var r=mr.internal.calculateCross(e),i=[];return i.push("0.749023 g"),i.push("0 0 "+Hr(mr.internal.getWidth(e))+" "+Hr(mr.internal.getHeight(e))+" re"),i.push("f"),i.push("q"),i.push("1 1 "+Hr(mr.internal.getWidth(e)-2)+" "+Hr(mr.internal.getHeight(e)-2)+" re"),i.push("W"),i.push("n"),i.push(Hr(r.x1.x)+" "+Hr(r.x1.y)+" m"),i.push(Hr(r.x2.x)+" "+Hr(r.x2.y)+" l"),i.push(Hr(r.x4.x)+" "+Hr(r.x4.y)+" m"),i.push(Hr(r.x3.x)+" "+Hr(r.x3.y)+" l"),i.push("s"),i.push("Q"),t.stream=i.join(`
`),t},OffPushDown:function(e){var t=nu(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+Hr(mr.internal.getWidth(e))+" "+Hr(mr.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+r}};mr.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=mr.internal.getWidth(e),r=mr.internal.getHeight(e),i=Math.min(t,r);return{x1:{x:(t-i)/2,y:(r-i)/2+i},x2:{x:(t-i)/2+i,y:(r-i)/2},x3:{x:(t-i)/2,y:(r-i)/2},x4:{x:(t-i)/2+i,y:(r-i)/2+i}}}},mr.internal.getWidth=function(e){var t=0;return Gi(e)==="object"&&(t=kI(e.Rect[2])),t},mr.internal.getHeight=function(e){var t=0;return Gi(e)==="object"&&(t=kI(e.Rect[3])),t};var Xet=Hn.addField=function(e){if(Jet(this,e),!(e instanceof Bc))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};Hn.AcroFormChoiceField=Wp,Hn.AcroFormListBox=$p,Hn.AcroFormComboBox=Zp,Hn.AcroFormEditBox=Ly,Hn.AcroFormButton=Ds,Hn.AcroFormPushButton=By,Hn.AcroFormRadioButton=Jp,Hn.AcroFormCheckBox=ky,Hn.AcroFormTextField=vf,Hn.AcroFormPasswordField=Ry,Hn.AcroFormAppearance=mr,Hn.AcroForm={ChoiceField:Wp,ListBox:$p,ComboBox:Zp,EditBox:Ly,Button:Ds,PushButton:By,RadioButton:Jp,CheckBox:ky,TextField:vf,PasswordField:Ry,Appearance:mr},Dr.AcroForm={ChoiceField:Wp,ListBox:$p,ComboBox:Zp,EditBox:Ly,Button:Ds,PushButton:By,RadioButton:Jp,CheckBox:ky,TextField:vf,PasswordField:Ry,Appearance:mr};function Rk(e){return e.reduce(function(t,r,i){return t[r]=i,t},{})}(function(e){e.__addimage__={};var t="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},i=e.__addimage__.getImageFileTypeByImageData=function(at,dt){var kt,xt,ue,oe,he,Dt=t;if((dt=dt||t)==="RGBA"||at.data!==void 0&&at.data instanceof Uint8ClampedArray&&"height"in at&&"width"in at)return"RGBA";if(Et(at))for(he in r)for(ue=r[he],kt=0;kt<ue.length;kt+=1){for(oe=!0,xt=0;xt<ue[kt].length;xt+=1)if(ue[kt][xt]!==void 0&&ue[kt][xt]!==at[xt]){oe=!1;break}if(oe===!0){Dt=he;break}}else for(he in r)for(ue=r[he],kt=0;kt<ue.length;kt+=1){for(oe=!0,xt=0;xt<ue[kt].length;xt+=1)if(ue[kt][xt]!==void 0&&ue[kt][xt]!==at.charCodeAt(xt)){oe=!1;break}if(oe===!0){Dt=he;break}}return Dt===t&&dt!==t&&(Dt=dt),Dt},n=function at(dt){for(var kt=this.internal.write,xt=this.internal.putStream,ue=(0,this.internal.getFilters)();ue.indexOf("FlateEncode")!==-1;)ue.splice(ue.indexOf("FlateEncode"),1);dt.objectId=this.internal.newObject();var oe=[];if(oe.push({key:"Type",value:"/XObject"}),oe.push({key:"Subtype",value:"/Image"}),oe.push({key:"Width",value:dt.width}),oe.push({key:"Height",value:dt.height}),dt.colorSpace===Z.INDEXED?oe.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(dt.palette.length/3-1)+" "+("sMask"in dt&&dt.sMask!==void 0?dt.objectId+2:dt.objectId+1)+" 0 R]"}):(oe.push({key:"ColorSpace",value:"/"+dt.colorSpace}),dt.colorSpace===Z.DEVICE_CMYK&&oe.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),oe.push({key:"BitsPerComponent",value:dt.bitsPerComponent}),"decodeParameters"in dt&&dt.decodeParameters!==void 0&&oe.push({key:"DecodeParms",value:"<<"+dt.decodeParameters+">>"}),"transparency"in dt&&Array.isArray(dt.transparency)){for(var he="",Dt=0,Qt=dt.transparency.length;Dt<Qt;Dt++)he+=dt.transparency[Dt]+" "+dt.transparency[Dt]+" ";oe.push({key:"Mask",value:"["+he+"]"})}dt.sMask!==void 0&&oe.push({key:"SMask",value:dt.objectId+1+" 0 R"});var ee=dt.filter!==void 0?["/"+dt.filter]:void 0;if(xt({data:dt.data,additionalKeyValues:oe,alreadyAppliedFilters:ee,objectId:dt.objectId}),kt("endobj"),"sMask"in dt&&dt.sMask!==void 0){var xe="/Predictor "+dt.predictor+" /Colors 1 /BitsPerComponent "+dt.bitsPerComponent+" /Columns "+dt.width,it={width:dt.width,height:dt.height,colorSpace:"DeviceGray",bitsPerComponent:dt.bitsPerComponent,decodeParameters:xe,data:dt.sMask};"filter"in dt&&(it.filter=dt.filter),at.call(this,it)}if(dt.colorSpace===Z.INDEXED){var Tt=this.internal.newObject();xt({data:pt(new Uint8Array(dt.palette)),objectId:Tt}),kt("endobj")}},s=function(){var at=this.internal.collections.addImage_images;for(var dt in at)n.call(this,at[dt])},a=function(){var at,dt=this.internal.collections.addImage_images,kt=this.internal.write;for(var xt in dt)kt("/I"+(at=dt[xt]).index,at.objectId,"0","R")},o=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",s),this.internal.events.subscribe("putXobjectDict",a))},f=function(){var at=this.internal.collections.addImage_images;return o.call(this),at},m=function(){return Object.keys(this.internal.collections.addImage_images).length},w=function(at){return typeof e["process"+at.toUpperCase()]=="function"},A=function(at){return Gi(at)==="object"&&at.nodeType===1},P=function(at,dt){if(at.nodeName==="IMG"&&at.hasAttribute("src")){var kt=""+at.getAttribute("src");if(kt.indexOf("data:image/")===0)return Gm(unescape(kt).split("base64,").pop());var xt=e.loadFile(kt,!0);if(xt!==void 0)return xt}if(at.nodeName==="CANVAS"){if(at.width===0||at.height===0)throw new Error("Given canvas must have data. Canvas width: "+at.width+", height: "+at.height);var ue;switch(dt){case"PNG":ue="image/png";break;case"WEBP":ue="image/webp";break;case"JPEG":case"JPG":default:ue="image/jpeg"}return Gm(at.toDataURL(ue,1).split("base64,").pop())}},I=function(at){var dt=this.internal.collections.addImage_images;if(dt){for(var kt in dt)if(at===dt[kt].alias)return dt[kt]}},N=function(at,dt,kt){return at||dt||(at=-96,dt=-96),at<0&&(at=-1*kt.width*72/at/this.internal.scaleFactor),dt<0&&(dt=-1*kt.height*72/dt/this.internal.scaleFactor),at===0&&(at=dt*kt.width/kt.height),dt===0&&(dt=at*kt.height/kt.width),[at,dt]},F=function(at,dt,kt,xt,ue,oe){var he=N.call(this,kt,xt,ue),Dt=this.internal.getCoordinateString,Qt=this.internal.getVerticalCoordinateString,ee=f.call(this);if(kt=he[0],xt=he[1],ee[ue.index]=ue,oe){oe*=Math.PI/180;var xe=Math.cos(oe),it=Math.sin(oe),Tt=function(Ut){return Ut.toFixed(4)},Lt=[Tt(xe),Tt(it),Tt(-1*it),Tt(xe),0,0,"cm"]}this.internal.write("q"),oe?(this.internal.write([1,"0","0",1,Dt(at),Qt(dt+xt),"cm"].join(" ")),this.internal.write(Lt.join(" ")),this.internal.write([Dt(kt),"0","0",Dt(xt),"0","0","cm"].join(" "))):this.internal.write([Dt(kt),"0","0",Dt(xt),Dt(at),Qt(dt+xt),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+ue.index+" Do"),this.internal.write("Q")},Z=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var U=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},z=e.__addimage__.sHashCode=function(at){var dt,kt,xt=0;if(typeof at=="string")for(kt=at.length,dt=0;dt<kt;dt++)xt=(xt<<5)-xt+at.charCodeAt(dt),xt|=0;else if(Et(at))for(kt=at.byteLength/2,dt=0;dt<kt;dt++)xt=(xt<<5)-xt+at[dt],xt|=0;return xt},J=e.__addimage__.validateStringAsBase64=function(at){(at=at||"").toString().trim();var dt=!0;return at.length===0&&(dt=!1),at.length%4!=0&&(dt=!1),/^[A-Za-z0-9+/]+$/.test(at.substr(0,at.length-2))===!1&&(dt=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(at.substr(-2))===!1&&(dt=!1),dt},nt=e.__addimage__.extractImageFromDataUrl=function(at){var dt=(at=at||"").split("base64,"),kt=null;if(dt.length===2){var xt=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(dt[0]);Array.isArray(xt)&&(kt={mimeType:xt[1],charset:xt[2],data:dt[1]})}return kt},mt=e.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};e.__addimage__.isArrayBuffer=function(at){return mt()&&at instanceof ArrayBuffer};var Et=e.__addimage__.isArrayBufferView=function(at){return mt()&&typeof Uint32Array<"u"&&(at instanceof Int8Array||at instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&at instanceof Uint8ClampedArray||at instanceof Int16Array||at instanceof Uint16Array||at instanceof Int32Array||at instanceof Uint32Array||at instanceof Float32Array||at instanceof Float64Array)},bt=e.__addimage__.binaryStringToUint8Array=function(at){for(var dt=at.length,kt=new Uint8Array(dt),xt=0;xt<dt;xt++)kt[xt]=at.charCodeAt(xt);return kt},pt=e.__addimage__.arrayBufferToBinaryString=function(at){for(var dt="",kt=Et(at)?at:new Uint8Array(at),xt=0;xt<kt.length;xt+=8192)dt+=String.fromCharCode.apply(null,kt.subarray(xt,xt+8192));return dt};e.addImage=function(){var at,dt,kt,xt,ue,oe,he,Dt,Qt;if(typeof arguments[1]=="number"?(dt=t,kt=arguments[1],xt=arguments[2],ue=arguments[3],oe=arguments[4],he=arguments[5],Dt=arguments[6],Qt=arguments[7]):(dt=arguments[1],kt=arguments[2],xt=arguments[3],ue=arguments[4],oe=arguments[5],he=arguments[6],Dt=arguments[7],Qt=arguments[8]),Gi(at=arguments[0])==="object"&&!A(at)&&"imageData"in at){var ee=at;at=ee.imageData,dt=ee.format||dt||t,kt=ee.x||kt||0,xt=ee.y||xt||0,ue=ee.w||ee.width||ue,oe=ee.h||ee.height||oe,he=ee.alias||he,Dt=ee.compression||Dt,Qt=ee.rotation||ee.angle||Qt}var xe=this.internal.getFilters();if(Dt===void 0&&xe.indexOf("FlateEncode")!==-1&&(Dt="SLOW"),isNaN(kt)||isNaN(xt))throw new Error("Invalid coordinates passed to jsPDF.addImage");o.call(this);var it=zt.call(this,at,dt,he,Dt);return F.call(this,kt,xt,ue,oe,it,Qt),this};var zt=function(at,dt,kt,xt){var ue,oe,he;if(typeof at=="string"&&i(at)===t){at=unescape(at);var Dt=Rt(at,!1);(Dt!==""||(Dt=e.loadFile(at,!0))!==void 0)&&(at=Dt)}if(A(at)&&(at=P(at,dt)),dt=i(at,dt),!w(dt))throw new Error("addImage does not support files of type '"+dt+"', please ensure that a plugin for '"+dt+"' support is added.");if(((he=kt)==null||he.length===0)&&(kt=function(Qt){return typeof Qt=="string"||Et(Qt)?z(Qt):Et(Qt.data)?z(Qt.data):null}(at)),(ue=I.call(this,kt))||(mt()&&(at instanceof Uint8Array||dt==="RGBA"||(oe=at,at=bt(at))),ue=this["process"+dt.toUpperCase()](at,m.call(this),kt,function(Qt){return Qt&&typeof Qt=="string"&&(Qt=Qt.toUpperCase()),Qt in e.image_compression?Qt:U.NONE}(xt),oe)),!ue)throw new Error("An unknown error occurred whilst processing the image.");return ue},Rt=e.__addimage__.convertBase64ToBinaryString=function(at,dt){var kt;dt=typeof dt!="boolean"||dt;var xt,ue="";if(typeof at=="string"){xt=(kt=nt(at))!==null?kt.data:at;try{ue=Gm(xt)}catch(oe){if(dt)throw J(xt)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+oe.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return ue};e.getImageProperties=function(at){var dt,kt,xt="";if(A(at)&&(at=P(at)),typeof at=="string"&&i(at)===t&&((xt=Rt(at,!1))===""&&(xt=e.loadFile(at)||""),at=xt),kt=i(at),!w(kt))throw new Error("addImage does not support files of type '"+kt+"', please ensure that a plugin for '"+kt+"' support is added.");if(!mt()||at instanceof Uint8Array||(at=bt(at)),!(dt=this["process"+kt.toUpperCase()](at)))throw new Error("An unknown error occurred whilst processing the image");return dt.fileType=kt,dt}})(Dr.API),function(e){var t=function(r){if(r!==void 0&&r!="")return!0};Dr.API.events.push(["addPage",function(r){this.internal.getPageInfo(r.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(r){for(var i,n,s,a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,f=this.internal.getPageInfoByObjId(r.objId),m=r.pageContext.annotations,w=!1,A=0;A<m.length&&!w;A++)switch((i=m[A]).type){case"link":(t(i.options.url)||t(i.options.pageNumber))&&(w=!0);break;case"reference":case"text":case"freetext":w=!0}if(w!=0){this.internal.write("/Annots [");for(var P=0;P<m.length;P++){i=m[P];var I=this.internal.pdfEscape,N=this.internal.getEncryptor(r.objId);switch(i.type){case"reference":this.internal.write(" "+i.object.objId+" 0 R ");break;case"text":var F=this.internal.newAdditionalObject(),Z=this.internal.newAdditionalObject(),U=this.internal.getEncryptor(F.objId),z=i.title||"Note";s="<</Type /Annot /Subtype /Text "+(n="/Rect ["+a(i.bounds.x)+" "+o(i.bounds.y+i.bounds.h)+" "+a(i.bounds.x+i.bounds.w)+" "+o(i.bounds.y)+"] ")+"/Contents ("+I(U(i.contents))+")",s+=" /Popup "+Z.objId+" 0 R",s+=" /P "+f.objId+" 0 R",s+=" /T ("+I(U(z))+") >>",F.content=s;var J=F.objId+" 0 R";s="<</Type /Annot /Subtype /Popup "+(n="/Rect ["+a(i.bounds.x+30)+" "+o(i.bounds.y+i.bounds.h)+" "+a(i.bounds.x+i.bounds.w+30)+" "+o(i.bounds.y)+"] ")+" /Parent "+J,i.open&&(s+=" /Open true"),s+=" >>",Z.content=s,this.internal.write(F.objId,"0 R",Z.objId,"0 R");break;case"freetext":n="/Rect ["+a(i.bounds.x)+" "+o(i.bounds.y)+" "+a(i.bounds.x+i.bounds.w)+" "+o(i.bounds.y+i.bounds.h)+"] ";var nt=i.color||"#000000";s="<</Type /Annot /Subtype /FreeText "+n+"/Contents ("+I(N(i.contents))+")",s+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+nt+")",s+=" /Border [0 0 0]",s+=" >>",this.internal.write(s);break;case"link":if(i.options.name){var mt=this.annotations._nameMap[i.options.name];i.options.pageNumber=mt.page,i.options.top=mt.y}else i.options.top||(i.options.top=0);if(n="/Rect ["+i.finalBounds.x+" "+i.finalBounds.y+" "+i.finalBounds.w+" "+i.finalBounds.h+"] ",s="",i.options.url)s="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /A <</S /URI /URI ("+I(N(i.options.url))+") >>";else if(i.options.pageNumber)switch(s="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(i.options.pageNumber).objId+" 0 R",i.options.magFactor=i.options.magFactor||"XYZ",i.options.magFactor){case"Fit":s+=" /Fit]";break;case"FitH":s+=" /FitH "+i.options.top+"]";break;case"FitV":i.options.left=i.options.left||0,s+=" /FitV "+i.options.left+"]";break;case"XYZ":default:var Et=o(i.options.top);i.options.left=i.options.left||0,i.options.zoom===void 0&&(i.options.zoom=0),s+=" /XYZ "+i.options.left+" "+Et+" "+i.options.zoom+"]"}s!=""&&(s+=" >>",this.internal.write(s))}}this.internal.write("]")}}]),e.createAnnotation=function(r){var i=this.internal.getCurrentPageInfo();switch(r.type){case"link":this.link(r.bounds.x,r.bounds.y,r.bounds.w,r.bounds.h,r);break;case"text":case"freetext":i.pageContext.annotations.push(r)}},e.link=function(r,i,n,s,a){var o=this.internal.getCurrentPageInfo(),f=this.internal.getCoordinateString,m=this.internal.getVerticalCoordinateString;o.pageContext.annotations.push({finalBounds:{x:f(r),y:m(i),w:f(r+n),h:m(i+s)},options:a,type:"link"})},e.textWithLink=function(r,i,n,s){var a,o,f=this.getTextWidth(r),m=this.internal.getLineHeight()/this.internal.scaleFactor;if(s.maxWidth!==void 0){o=s.maxWidth;var w=this.splitTextToSize(r,o).length;a=Math.ceil(m*w)}else o=f,a=m;return this.text(r,i,n,s),n+=.2*m,s.align==="center"&&(i-=f/2),s.align==="right"&&(i-=f),this.link(i,n-m,o,a,s),f},e.getTextWidth=function(r){var i=this.internal.getFontSize();return this.getStringUnitWidth(r)*i/this.internal.scaleFactor}}(Dr.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},r={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},i={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},n=[1570,1571,1573,1575];e.__arabicParser__={};var s=e.__arabicParser__.isInArabicSubstitutionA=function(F){return t[F.charCodeAt(0)]!==void 0},a=e.__arabicParser__.isArabicLetter=function(F){return typeof F=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(F)},o=e.__arabicParser__.isArabicEndLetter=function(F){return a(F)&&s(F)&&t[F.charCodeAt(0)].length<=2},f=e.__arabicParser__.isArabicAlfLetter=function(F){return a(F)&&n.indexOf(F.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(F){return a(F)&&s(F)&&t[F.charCodeAt(0)].length>=1};var m=e.__arabicParser__.arabicLetterHasFinalForm=function(F){return a(F)&&s(F)&&t[F.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(F){return a(F)&&s(F)&&t[F.charCodeAt(0)].length>=3};var w=e.__arabicParser__.arabicLetterHasMedialForm=function(F){return a(F)&&s(F)&&t[F.charCodeAt(0)].length==4},A=e.__arabicParser__.resolveLigatures=function(F){var Z=0,U=r,z="",J=0;for(Z=0;Z<F.length;Z+=1)U[F.charCodeAt(Z)]!==void 0?(J++,typeof(U=U[F.charCodeAt(Z)])=="number"&&(z+=String.fromCharCode(U),U=r,J=0),Z===F.length-1&&(U=r,z+=F.charAt(Z-(J-1)),Z-=J-1,J=0)):(U=r,z+=F.charAt(Z-J),Z-=J,J=0);return z};e.__arabicParser__.isArabicDiacritic=function(F){return F!==void 0&&i[F.charCodeAt(0)]!==void 0};var P=e.__arabicParser__.getCorrectForm=function(F,Z,U){return a(F)?s(F)===!1?-1:!m(F)||!a(Z)&&!a(U)||!a(U)&&o(Z)||o(F)&&!a(Z)||o(F)&&f(Z)||o(F)&&o(Z)?0:w(F)&&a(Z)&&!o(Z)&&a(U)&&m(U)?3:o(F)||!a(U)?1:2:-1},I=function(F){var Z=0,U=0,z=0,J="",nt="",mt="",Et=(F=F||"").split("\\s+"),bt=[];for(Z=0;Z<Et.length;Z+=1){for(bt.push(""),U=0;U<Et[Z].length;U+=1)J=Et[Z][U],nt=Et[Z][U-1],mt=Et[Z][U+1],a(J)?(z=P(J,nt,mt),bt[Z]+=z!==-1?String.fromCharCode(t[J.charCodeAt(0)][z]):J):bt[Z]+=J;bt[Z]=A(bt[Z])}return bt.join(" ")},N=e.__arabicParser__.processArabic=e.processArabic=function(){var F,Z=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,U=[];if(Array.isArray(Z)){var z=0;for(U=[],z=0;z<Z.length;z+=1)Array.isArray(Z[z])?U.push([I(Z[z][0]),Z[z][1],Z[z][2]]):U.push([I(Z[z])]);F=U}else F=I(Z);return typeof arguments[0]=="string"?F:(arguments[0].text=F,arguments[0])};e.events.push(["preProcessText",N])}(Dr.API),Dr.API.autoPrint=function(e){var t;switch((e=e||{}).variant=e.variant||"non-conform",e.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})}return this},function(e){var t=function(){var r=void 0;Object.defineProperty(this,"pdf",{get:function(){return r},set:function(o){r=o}});var i=150;Object.defineProperty(this,"width",{get:function(){return i},set:function(o){i=isNaN(o)||Number.isInteger(o)===!1||o<0?150:o,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=i+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(o){n=isNaN(o)||Number.isInteger(o)===!1||o<0?300:o,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var s=[];Object.defineProperty(this,"childNodes",{get:function(){return s},set:function(o){s=o}});var a={};Object.defineProperty(this,"style",{get:function(){return a},set:function(o){a=o}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(r,i){var n;if((r=r||"2d")!=="2d")return null;for(n in i)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=i[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(Dr.API),function(e){var t={left:0,top:0,bottom:0,right:0},r=!1,i=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),n.call(this))},n=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var f=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return f},set:function(F){f=F}});var m=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return m},set:function(F){m=F}});var w=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return w},set:function(F){w=F}});var A=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return A},set:function(F){A=F}});var P=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return P},set:function(F){P=F}});var I=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return I},set:function(F){I=F}});var N=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return N},set:function(F){N=F}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(f){return i.call(this),this.internal.__cell__.headerFunction=typeof f=="function"?f:void 0,this},e.getTextDimensions=function(f,m){i.call(this);var w=(m=m||{}).fontSize||this.getFontSize(),A=m.font||this.getFont(),P=m.scaleFactor||this.internal.scaleFactor,I=0,N=0,F=0,Z=this;if(!Array.isArray(f)&&typeof f!="string"){if(typeof f!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");f=String(f)}var U=m.maxWidth;U>0?typeof f=="string"?f=this.splitTextToSize(f,U):Object.prototype.toString.call(f)==="[object Array]"&&(f=f.reduce(function(J,nt){return J.concat(Z.splitTextToSize(nt,U))},[])):f=Array.isArray(f)?f:[f];for(var z=0;z<f.length;z++)I<(F=this.getStringUnitWidth(f[z],{font:A})*w)&&(I=F);return I!==0&&(N=f.length),{w:I/=P,h:Math.max((N*w*this.getLineHeightFactor()-w*(this.getLineHeightFactor()-1))/P,0)}},e.cellAddPage=function(){i.call(this),this.addPage();var f=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new s(f.left,f.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var a=e.cell=function(){var f;f=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),i.call(this);var m=this.internal.__cell__.lastCell,w=this.internal.__cell__.padding,A=this.internal.__cell__.margins||t,P=this.internal.__cell__.tableHeaderRow,I=this.internal.__cell__.printHeaders;return m.lineNumber!==void 0&&(m.lineNumber===f.lineNumber?(f.x=(m.x||0)+(m.width||0),f.y=m.y||0):m.y+m.height+f.height+A.bottom>this.getPageHeight()?(this.cellAddPage(),f.y=A.top,I&&P&&(this.printHeaderRow(f.lineNumber,!0),f.y+=P[0].height)):f.y=m.y+m.height||f.y),f.text[0]!==void 0&&(this.rect(f.x,f.y,f.width,f.height,r===!0?"FD":void 0),f.align==="right"?this.text(f.text,f.x+f.width-w,f.y+w,{align:"right",baseline:"top"}):f.align==="center"?this.text(f.text,f.x+f.width/2,f.y+w,{align:"center",baseline:"top",maxWidth:f.width-w-w}):this.text(f.text,f.x+w,f.y+w,{align:"left",baseline:"top",maxWidth:f.width-w-w})),this.internal.__cell__.lastCell=f,this};e.table=function(f,m,w,A,P){if(i.call(this),!w)throw new Error("No data for PDF table.");var I,N,F,Z,U=[],z=[],J=[],nt={},mt={},Et=[],bt=[],pt=(P=P||{}).autoSize||!1,zt=P.printHeaders!==!1,Rt=P.css&&P.css["font-size"]!==void 0?16*P.css["font-size"]:P.fontSize||12,at=P.margins||Object.assign({width:this.getPageWidth()},t),dt=typeof P.padding=="number"?P.padding:3,kt=P.headerBackgroundColor||"#c8c8c8",xt=P.headerTextColor||"#000";if(n.call(this),this.internal.__cell__.printHeaders=zt,this.internal.__cell__.margins=at,this.internal.__cell__.table_font_size=Rt,this.internal.__cell__.padding=dt,this.internal.__cell__.headerBackgroundColor=kt,this.internal.__cell__.headerTextColor=xt,this.setFontSize(Rt),A==null)z=U=Object.keys(w[0]),J=U.map(function(){return"left"});else if(Array.isArray(A)&&Gi(A[0])==="object")for(U=A.map(function(ee){return ee.name}),z=A.map(function(ee){return ee.prompt||ee.name||""}),J=A.map(function(ee){return ee.align||"left"}),I=0;I<A.length;I+=1)mt[A[I].name]=A[I].width*(19.049976/25.4);else Array.isArray(A)&&typeof A[0]=="string"&&(z=U=A,J=U.map(function(){return"left"}));if(pt||Array.isArray(A)&&typeof A[0]=="string")for(I=0;I<U.length;I+=1){for(nt[Z=U[I]]=w.map(function(ee){return ee[Z]}),this.setFont(void 0,"bold"),Et.push(this.getTextDimensions(z[I],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),N=nt[Z],this.setFont(void 0,"normal"),F=0;F<N.length;F+=1)Et.push(this.getTextDimensions(N[F],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);mt[Z]=Math.max.apply(null,Et)+dt+dt,Et=[]}if(zt){var ue={};for(I=0;I<U.length;I+=1)ue[U[I]]={},ue[U[I]].text=z[I],ue[U[I]].align=J[I];var oe=o.call(this,ue,mt);bt=U.map(function(ee){return new s(f,m,mt[ee],oe,ue[ee].text,void 0,ue[ee].align)}),this.setTableHeaderRow(bt),this.printHeaderRow(1,!1)}var he=A.reduce(function(ee,xe){return ee[xe.name]=xe.align,ee},{});for(I=0;I<w.length;I+=1){"rowStart"in P&&P.rowStart instanceof Function&&P.rowStart({row:I,data:w[I]},this);var Dt=o.call(this,w[I],mt);for(F=0;F<U.length;F+=1){var Qt=w[I][U[F]];"cellStart"in P&&P.cellStart instanceof Function&&P.cellStart({row:I,col:F,data:Qt},this),a.call(this,new s(f,m,mt[U[F]],Dt,Qt,I+2,he[U[F]]))}}return this.internal.__cell__.table_x=f,this.internal.__cell__.table_y=m,this};var o=function(f,m){var w=this.internal.__cell__.padding,A=this.internal.__cell__.table_font_size,P=this.internal.scaleFactor;return Object.keys(f).map(function(I){var N=f[I];return this.splitTextToSize(N.hasOwnProperty("text")?N.text:N,m[I]-w-w)},this).map(function(I){return this.getLineHeightFactor()*I.length*A/P+w+w},this).reduce(function(I,N){return Math.max(I,N)},0)};e.setTableHeaderRow=function(f){i.call(this),this.internal.__cell__.tableHeaderRow=f},e.printHeaderRow=function(f,m){if(i.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var w;if(r=!0,typeof this.internal.__cell__.headerFunction=="function"){var A=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(A[0],A[1],A[2],A[3],void 0,-1)}this.setFont(void 0,"bold");for(var P=[],I=0;I<this.internal.__cell__.tableHeaderRow.length;I+=1){w=this.internal.__cell__.tableHeaderRow[I].clone(),m&&(w.y=this.internal.__cell__.margins.top||0,P.push(w)),w.lineNumber=f;var N=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),a.call(this,w),this.setTextColor(N)}P.length>0&&this.setTableHeaderRow(P),this.setFont(void 0,"normal"),r=!1}}(Dr.API);var Ok={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},Dk=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],Hx=Rk(Dk),Nk=[100,200,300,400,500,600,700,800,900],Ket=Rk(Nk);function Wx(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),r=function(s){return Ok[s=s||"normal"]?s:"normal"}(e.style),i=function(s){if(!s)return 400;if(typeof s=="number")return s>=100&&s<=900&&s%100==0?s:400;if(/^\d00$/.test(s))return parseInt(s);switch(s){case"bold":return 700;case"normal":default:return 400}}(e.weight),n=function(s){return typeof Hx[s=s||"normal"]=="number"?s:"normal"}(e.stretch);return{family:t,style:r,weight:i,stretch:n,src:e.src||[],ref:e.ref||{name:t,style:[n,r,i].join(" ")}}}function RI(e,t,r,i){var n;for(n=r;n>=0&&n<t.length;n+=i)if(e[t[n]])return e[t[n]];for(n=r;n>=0&&n<t.length;n-=i)if(e[t[n]])return e[t[n]]}var Yet={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},OI={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function DI(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function Qet(e,t,r){for(var i=(r=r||{}).defaultFontFamily||"times",n=Object.assign({},Yet,r.genericFontFamilies||{}),s=null,a=null,o=0;o<t.length;++o)if(n[(s=Wx(t[o])).family]&&(s.family=n[s.family]),e.hasOwnProperty(s.family)){a=e[s.family];break}if(!(a=a||e[i]))throw new Error("Could not find a font-family for the rule '"+DI(s)+"' and default family '"+i+"'.");if(a=function(f,m){if(m[f])return m[f];var w=Hx[f],A=w<=Hx.normal?-1:1,P=RI(m,Dk,w,A);if(!P)throw new Error("Could not find a matching font-stretch value for "+f);return P}(s.stretch,a),a=function(f,m){if(m[f])return m[f];for(var w=Ok[f],A=0;A<w.length;++A)if(m[w[A]])return m[w[A]];throw new Error("Could not find a matching font-style for "+f)}(s.style,a),!(a=function(f,m){if(m[f])return m[f];if(f===400&&m[500])return m[500];if(f===500&&m[400])return m[400];var w=Ket[f],A=RI(m,Nk,w,f<400?-1:1);if(!A)throw new Error("Could not find a matching font-weight for value "+f);return A}(s.weight,a)))throw new Error("Failed to resolve a font for the rule '"+DI(s)+"'.");return a}function NI(e){return e.trimLeft()}function trt(e,t){for(var r=0;r<e.length;){if(e.charAt(r)===t)return[e.substring(0,r),e.substring(r+1)];r+=1}return null}function ert(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],e.substring(t[0].length)]}var ny,FI,zI,jI=["times"];(function(e){var t,r,i,n,s,a,o,f,m,w=function(it){return it=it||{},this.isStrokeTransparent=it.isStrokeTransparent||!1,this.strokeOpacity=it.strokeOpacity||1,this.strokeStyle=it.strokeStyle||"#000000",this.fillStyle=it.fillStyle||"#000000",this.isFillTransparent=it.isFillTransparent||!1,this.fillOpacity=it.fillOpacity||1,this.font=it.font||"10px sans-serif",this.textBaseline=it.textBaseline||"alphabetic",this.textAlign=it.textAlign||"left",this.lineWidth=it.lineWidth||1,this.lineJoin=it.lineJoin||"miter",this.lineCap=it.lineCap||"butt",this.path=it.path||[],this.transform=it.transform!==void 0?it.transform.clone():new f,this.globalCompositeOperation=it.globalCompositeOperation||"normal",this.globalAlpha=it.globalAlpha||1,this.clip_path=it.clip_path||[],this.currentPoint=it.currentPoint||new a,this.miterLimit=it.miterLimit||10,this.lastPoint=it.lastPoint||new a,this.lineDashOffset=it.lineDashOffset||0,this.lineDash=it.lineDash||[],this.margin=it.margin||[0,0,0,0],this.prevPageLastElemOffset=it.prevPageLastElemOffset||0,this.ignoreClearRect=typeof it.ignoreClearRect!="boolean"||it.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new A(this),t=this.internal.f2,r=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,n=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,a=this.internal.Point,o=this.internal.Rectangle,f=this.internal.Matrix,m=new w}]);var A=function(it){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Tt=it;Object.defineProperty(this,"pdf",{get:function(){return Tt}});var Lt=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Lt},set:function(ge){Lt=!!ge}});var Ut=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Ut},set:function(ge){Ut=!!ge}});var Zt=0;Object.defineProperty(this,"posX",{get:function(){return Zt},set:function(ge){isNaN(ge)||(Zt=ge)}});var Kt=0;Object.defineProperty(this,"posY",{get:function(){return Kt},set:function(ge){isNaN(ge)||(Kt=ge)}}),Object.defineProperty(this,"margin",{get:function(){return m.margin},set:function(ge){var Bt;typeof ge=="number"?Bt=[ge,ge,ge,ge]:((Bt=new Array(4))[0]=ge[0],Bt[1]=ge.length>=2?ge[1]:Bt[0],Bt[2]=ge.length>=3?ge[2]:Bt[0],Bt[3]=ge.length>=4?ge[3]:Bt[1]),m.margin=Bt}});var ne=!1;Object.defineProperty(this,"autoPaging",{get:function(){return ne},set:function(ge){ne=ge}});var re=0;Object.defineProperty(this,"lastBreak",{get:function(){return re},set:function(ge){re=ge}});var Se=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Se},set:function(ge){Se=ge}}),Object.defineProperty(this,"ctx",{get:function(){return m},set:function(ge){ge instanceof w&&(m=ge)}}),Object.defineProperty(this,"path",{get:function(){return m.path},set:function(ge){m.path=ge}});var Be=[];Object.defineProperty(this,"ctxStack",{get:function(){return Be},set:function(ge){Be=ge}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(ge){var Bt;Bt=P(ge),this.ctx.fillStyle=Bt.style,this.ctx.isFillTransparent=Bt.a===0,this.ctx.fillOpacity=Bt.a,this.pdf.setFillColor(Bt.r,Bt.g,Bt.b,{a:Bt.a}),this.pdf.setTextColor(Bt.r,Bt.g,Bt.b,{a:Bt.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(ge){var Bt=P(ge);this.ctx.strokeStyle=Bt.style,this.ctx.isStrokeTransparent=Bt.a===0,this.ctx.strokeOpacity=Bt.a,Bt.a===0?this.pdf.setDrawColor(255,255,255):(Bt.a,this.pdf.setDrawColor(Bt.r,Bt.g,Bt.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(ge){["butt","round","square"].indexOf(ge)!==-1&&(this.ctx.lineCap=ge,this.pdf.setLineCap(ge))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(ge){isNaN(ge)||(this.ctx.lineWidth=ge,this.pdf.setLineWidth(ge))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(ge){["bevel","round","miter"].indexOf(ge)!==-1&&(this.ctx.lineJoin=ge,this.pdf.setLineJoin(ge))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(ge){isNaN(ge)||(this.ctx.miterLimit=ge,this.pdf.setMiterLimit(ge))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(ge){this.ctx.textBaseline=ge}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(ge){["right","end","center","left","start"].indexOf(ge)!==-1&&(this.ctx.textAlign=ge)}});var ze=null;function Ve(ge,Bt){if(ze===null){var Xt=function(ir){var Ie=[];return Object.keys(ir).forEach(function(ve){ir[ve].forEach(function(Ce){var qe=null;switch(Ce){case"bold":qe={family:ve,weight:"bold"};break;case"italic":qe={family:ve,style:"italic"};break;case"bolditalic":qe={family:ve,weight:"bold",style:"italic"};break;case"":case"normal":qe={family:ve}}qe!==null&&(qe.ref={name:ve,style:Ce},Ie.push(qe))})}),Ie}(ge.getFontList());ze=function(ir){for(var Ie={},ve=0;ve<ir.length;++ve){var Ce=Wx(ir[ve]),qe=Ce.family,lr=Ce.stretch,Er=Ce.style,Ir=Ce.weight;Ie[qe]=Ie[qe]||{},Ie[qe][lr]=Ie[qe][lr]||{},Ie[qe][lr][Er]=Ie[qe][lr][Er]||{},Ie[qe][lr][Er][Ir]=Ce}return Ie}(Xt.concat(Bt))}return ze}var Xe=null;Object.defineProperty(this,"fontFaces",{get:function(){return Xe},set:function(ge){ze=null,Xe=ge}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(ge){var Bt;if(this.ctx.font=ge,(Bt=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(ge))!==null){var Xt=Bt[1],ir=(Bt[2],Bt[3]),Ie=Bt[4],ve=(Bt[5],Bt[6]),Ce=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Ie)[2];Ie=Math.floor(Ce==="px"?parseFloat(Ie)*this.pdf.internal.scaleFactor:Ce==="em"?parseFloat(Ie)*this.pdf.getFontSize():parseFloat(Ie)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Ie);var qe=function(de){var Tr,Re,Hi=[],Pr=de.trim();if(Pr==="")return jI;if(Pr in OI)return[OI[Pr]];for(;Pr!=="";){switch(Re=null,Tr=(Pr=NI(Pr)).charAt(0)){case'"':case"'":Re=trt(Pr.substring(1),Tr);break;default:Re=ert(Pr)}if(Re===null||(Hi.push(Re[0]),(Pr=NI(Re[1]))!==""&&Pr.charAt(0)!==","))return jI;Pr=Pr.replace(/^,/,"")}return Hi}(ve);if(this.fontFaces){var lr=Qet(Ve(this.pdf,this.fontFaces),qe.map(function(de){return{family:de,stretch:"normal",weight:ir,style:Xt}}));this.pdf.setFont(lr.ref.name,lr.ref.style)}else{var Er="";(ir==="bold"||parseInt(ir,10)>=700||Xt==="bold")&&(Er="bold"),Xt==="italic"&&(Er+="italic"),Er.length===0&&(Er="normal");for(var Ir="",Mr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Wr=0;Wr<qe.length;Wr++){if(this.pdf.internal.getFont(qe[Wr],Er,{noFallback:!0,disableWarning:!0})!==void 0){Ir=qe[Wr];break}if(Er==="bolditalic"&&this.pdf.internal.getFont(qe[Wr],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Ir=qe[Wr],Er="bold";else if(this.pdf.internal.getFont(qe[Wr],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Ir=qe[Wr],Er="normal";break}}if(Ir===""){for(var Jr=0;Jr<qe.length;Jr++)if(Mr[qe[Jr]]){Ir=Mr[qe[Jr]];break}}Ir=Ir===""?"Times":Ir,this.pdf.setFont(Ir,Er)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(ge){this.ctx.globalCompositeOperation=ge}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(ge){this.ctx.globalAlpha=ge}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(ge){this.ctx.lineDashOffset=ge,xe.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(ge){this.ctx.lineDash=ge,xe.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(ge){this.ctx.ignoreClearRect=!!ge}})};A.prototype.setLineDash=function(it){this.lineDash=it},A.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},A.prototype.fill=function(){nt.call(this,"fill",!1)},A.prototype.stroke=function(){nt.call(this,"stroke",!1)},A.prototype.beginPath=function(){this.path=[{type:"begin"}]},A.prototype.moveTo=function(it,Tt){if(isNaN(it)||isNaN(Tt))throw nn.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Lt=this.ctx.transform.applyToPoint(new a(it,Tt));this.path.push({type:"mt",x:Lt.x,y:Lt.y}),this.ctx.lastPoint=new a(it,Tt)},A.prototype.closePath=function(){var it=new a(0,0),Tt=0;for(Tt=this.path.length-1;Tt!==-1;Tt--)if(this.path[Tt].type==="begin"&&Gi(this.path[Tt+1])==="object"&&typeof this.path[Tt+1].x=="number"){it=new a(this.path[Tt+1].x,this.path[Tt+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new a(it.x,it.y)},A.prototype.lineTo=function(it,Tt){if(isNaN(it)||isNaN(Tt))throw nn.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Lt=this.ctx.transform.applyToPoint(new a(it,Tt));this.path.push({type:"lt",x:Lt.x,y:Lt.y}),this.ctx.lastPoint=new a(Lt.x,Lt.y)},A.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),nt.call(this,null,!0)},A.prototype.quadraticCurveTo=function(it,Tt,Lt,Ut){if(isNaN(Lt)||isNaN(Ut)||isNaN(it)||isNaN(Tt))throw nn.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var Zt=this.ctx.transform.applyToPoint(new a(Lt,Ut)),Kt=this.ctx.transform.applyToPoint(new a(it,Tt));this.path.push({type:"qct",x1:Kt.x,y1:Kt.y,x:Zt.x,y:Zt.y}),this.ctx.lastPoint=new a(Zt.x,Zt.y)},A.prototype.bezierCurveTo=function(it,Tt,Lt,Ut,Zt,Kt){if(isNaN(Zt)||isNaN(Kt)||isNaN(it)||isNaN(Tt)||isNaN(Lt)||isNaN(Ut))throw nn.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var ne=this.ctx.transform.applyToPoint(new a(Zt,Kt)),re=this.ctx.transform.applyToPoint(new a(it,Tt)),Se=this.ctx.transform.applyToPoint(new a(Lt,Ut));this.path.push({type:"bct",x1:re.x,y1:re.y,x2:Se.x,y2:Se.y,x:ne.x,y:ne.y}),this.ctx.lastPoint=new a(ne.x,ne.y)},A.prototype.arc=function(it,Tt,Lt,Ut,Zt,Kt){if(isNaN(it)||isNaN(Tt)||isNaN(Lt)||isNaN(Ut)||isNaN(Zt))throw nn.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(Kt=!!Kt,!this.ctx.transform.isIdentity){var ne=this.ctx.transform.applyToPoint(new a(it,Tt));it=ne.x,Tt=ne.y;var re=this.ctx.transform.applyToPoint(new a(0,Lt)),Se=this.ctx.transform.applyToPoint(new a(0,0));Lt=Math.sqrt(Math.pow(re.x-Se.x,2)+Math.pow(re.y-Se.y,2))}Math.abs(Zt-Ut)>=2*Math.PI&&(Ut=0,Zt=2*Math.PI),this.path.push({type:"arc",x:it,y:Tt,radius:Lt,startAngle:Ut,endAngle:Zt,counterclockwise:Kt})},A.prototype.arcTo=function(it,Tt,Lt,Ut,Zt){throw new Error("arcTo not implemented.")},A.prototype.rect=function(it,Tt,Lt,Ut){if(isNaN(it)||isNaN(Tt)||isNaN(Lt)||isNaN(Ut))throw nn.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(it,Tt),this.lineTo(it+Lt,Tt),this.lineTo(it+Lt,Tt+Ut),this.lineTo(it,Tt+Ut),this.lineTo(it,Tt),this.lineTo(it+Lt,Tt),this.lineTo(it,Tt)},A.prototype.fillRect=function(it,Tt,Lt,Ut){if(isNaN(it)||isNaN(Tt)||isNaN(Lt)||isNaN(Ut))throw nn.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!I.call(this)){var Zt={};this.lineCap!=="butt"&&(Zt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(Zt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(it,Tt,Lt,Ut),this.fill(),Zt.hasOwnProperty("lineCap")&&(this.lineCap=Zt.lineCap),Zt.hasOwnProperty("lineJoin")&&(this.lineJoin=Zt.lineJoin)}},A.prototype.strokeRect=function(it,Tt,Lt,Ut){if(isNaN(it)||isNaN(Tt)||isNaN(Lt)||isNaN(Ut))throw nn.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");N.call(this)||(this.beginPath(),this.rect(it,Tt,Lt,Ut),this.stroke())},A.prototype.clearRect=function(it,Tt,Lt,Ut){if(isNaN(it)||isNaN(Tt)||isNaN(Lt)||isNaN(Ut))throw nn.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(it,Tt,Lt,Ut))},A.prototype.save=function(it){it=typeof it!="boolean"||it;for(var Tt=this.pdf.internal.getCurrentPageInfo().pageNumber,Lt=0;Lt<this.pdf.internal.getNumberOfPages();Lt++)this.pdf.setPage(Lt+1),this.pdf.internal.out("q");if(this.pdf.setPage(Tt),it){this.ctx.fontSize=this.pdf.internal.getFontSize();var Ut=new w(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Ut}},A.prototype.restore=function(it){it=typeof it!="boolean"||it;for(var Tt=this.pdf.internal.getCurrentPageInfo().pageNumber,Lt=0;Lt<this.pdf.internal.getNumberOfPages();Lt++)this.pdf.setPage(Lt+1),this.pdf.internal.out("Q");this.pdf.setPage(Tt),it&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},A.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var P=function(it){var Tt,Lt,Ut,Zt;if(it.isCanvasGradient===!0&&(it=it.getColor()),!it)return{r:0,g:0,b:0,a:0,style:it};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(it))Tt=0,Lt=0,Ut=0,Zt=0;else{var Kt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(it);if(Kt!==null)Tt=parseInt(Kt[1]),Lt=parseInt(Kt[2]),Ut=parseInt(Kt[3]),Zt=1;else if((Kt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(it))!==null)Tt=parseInt(Kt[1]),Lt=parseInt(Kt[2]),Ut=parseInt(Kt[3]),Zt=parseFloat(Kt[4]);else{if(Zt=1,typeof it=="string"&&it.charAt(0)!=="#"){var ne=new Pk(it);it=ne.ok?ne.toHex():"#000000"}it.length===4?(Tt=it.substring(1,2),Tt+=Tt,Lt=it.substring(2,3),Lt+=Lt,Ut=it.substring(3,4),Ut+=Ut):(Tt=it.substring(1,3),Lt=it.substring(3,5),Ut=it.substring(5,7)),Tt=parseInt(Tt,16),Lt=parseInt(Lt,16),Ut=parseInt(Ut,16)}}return{r:Tt,g:Lt,b:Ut,a:Zt,style:it}},I=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},N=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};A.prototype.fillText=function(it,Tt,Lt,Ut){if(isNaN(Tt)||isNaN(Lt)||typeof it!="string")throw nn.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Ut=isNaN(Ut)?void 0:Ut,!I.call(this)){var Zt=Dt(this.ctx.transform.rotation),Kt=this.ctx.transform.scaleX;dt.call(this,{text:it,x:Tt,y:Lt,scale:Kt,angle:Zt,align:this.textAlign,maxWidth:Ut})}},A.prototype.strokeText=function(it,Tt,Lt,Ut){if(isNaN(Tt)||isNaN(Lt)||typeof it!="string")throw nn.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!N.call(this)){Ut=isNaN(Ut)?void 0:Ut;var Zt=Dt(this.ctx.transform.rotation),Kt=this.ctx.transform.scaleX;dt.call(this,{text:it,x:Tt,y:Lt,scale:Kt,renderingMode:"stroke",angle:Zt,align:this.textAlign,maxWidth:Ut})}},A.prototype.measureText=function(it){if(typeof it!="string")throw nn.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Tt=this.pdf,Lt=this.pdf.internal.scaleFactor,Ut=Tt.internal.getFontSize(),Zt=Tt.getStringUnitWidth(it)*Ut/Tt.internal.scaleFactor,Kt=function(ne){var re=(ne=ne||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return re}}),this};return new Kt({width:Zt*=Math.round(96*Lt/72*1e4)/1e4})},A.prototype.scale=function(it,Tt){if(isNaN(it)||isNaN(Tt))throw nn.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Lt=new f(it,0,0,Tt,0,0);this.ctx.transform=this.ctx.transform.multiply(Lt)},A.prototype.rotate=function(it){if(isNaN(it))throw nn.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Tt=new f(Math.cos(it),Math.sin(it),-Math.sin(it),Math.cos(it),0,0);this.ctx.transform=this.ctx.transform.multiply(Tt)},A.prototype.translate=function(it,Tt){if(isNaN(it)||isNaN(Tt))throw nn.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Lt=new f(1,0,0,1,it,Tt);this.ctx.transform=this.ctx.transform.multiply(Lt)},A.prototype.transform=function(it,Tt,Lt,Ut,Zt,Kt){if(isNaN(it)||isNaN(Tt)||isNaN(Lt)||isNaN(Ut)||isNaN(Zt)||isNaN(Kt))throw nn.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var ne=new f(it,Tt,Lt,Ut,Zt,Kt);this.ctx.transform=this.ctx.transform.multiply(ne)},A.prototype.setTransform=function(it,Tt,Lt,Ut,Zt,Kt){it=isNaN(it)?1:it,Tt=isNaN(Tt)?0:Tt,Lt=isNaN(Lt)?0:Lt,Ut=isNaN(Ut)?1:Ut,Zt=isNaN(Zt)?0:Zt,Kt=isNaN(Kt)?0:Kt,this.ctx.transform=new f(it,Tt,Lt,Ut,Zt,Kt)};var F=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};A.prototype.drawImage=function(it,Tt,Lt,Ut,Zt,Kt,ne,re,Se){var Be=this.pdf.getImageProperties(it),ze=1,Ve=1,Xe=1,ge=1;Ut!==void 0&&re!==void 0&&(Xe=re/Ut,ge=Se/Zt,ze=Be.width/Ut*re/Ut,Ve=Be.height/Zt*Se/Zt),Kt===void 0&&(Kt=Tt,ne=Lt,Tt=0,Lt=0),Ut!==void 0&&re===void 0&&(re=Ut,Se=Zt),Ut===void 0&&re===void 0&&(re=Be.width,Se=Be.height);for(var Bt,Xt=this.ctx.transform.decompose(),ir=Dt(Xt.rotate.shx),Ie=new f,ve=(Ie=(Ie=(Ie=Ie.multiply(Xt.translate)).multiply(Xt.skew)).multiply(Xt.scale)).applyToRectangle(new o(Kt-Tt*Xe,ne-Lt*ge,Ut*ze,Zt*Ve)),Ce=Z.call(this,ve),qe=[],lr=0;lr<Ce.length;lr+=1)qe.indexOf(Ce[lr])===-1&&qe.push(Ce[lr]);if(J(qe),this.autoPaging)for(var Er=qe[0],Ir=qe[qe.length-1],Mr=Er;Mr<Ir+1;Mr++){this.pdf.setPage(Mr);var Wr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Jr=Mr===1?this.posY+this.margin[0]:this.margin[0],de=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Tr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Re=Mr===1?0:de+(Mr-2)*Tr;if(this.ctx.clip_path.length!==0){var Hi=this.path;Bt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=z(Bt,this.posX+this.margin[3],-Re+Jr+this.ctx.prevPageLastElemOffset),mt.call(this,"fill",!0),this.path=Hi}var Pr=JSON.parse(JSON.stringify(ve));Pr=z([Pr],this.posX+this.margin[3],-Re+Jr+this.ctx.prevPageLastElemOffset)[0];var Pe=(Mr>Er||Mr<Ir)&&F.call(this);Pe&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Wr,Tr,null).clip().discardPath()),this.pdf.addImage(it,"JPEG",Pr.x,Pr.y,Pr.w,Pr.h,null,null,ir),Pe&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(it,"JPEG",ve.x,ve.y,ve.w,ve.h,null,null,ir)};var Z=function(it,Tt,Lt){var Ut=[];Tt=Tt||this.pdf.internal.pageSize.width,Lt=Lt||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var Zt=this.posY+this.ctx.prevPageLastElemOffset;switch(it.type){default:case"mt":case"lt":Ut.push(Math.floor((it.y+Zt)/Lt)+1);break;case"arc":Ut.push(Math.floor((it.y+Zt-it.radius)/Lt)+1),Ut.push(Math.floor((it.y+Zt+it.radius)/Lt)+1);break;case"qct":var Kt=Qt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,it.x1,it.y1,it.x,it.y);Ut.push(Math.floor((Kt.y+Zt)/Lt)+1),Ut.push(Math.floor((Kt.y+Kt.h+Zt)/Lt)+1);break;case"bct":var ne=ee(this.ctx.lastPoint.x,this.ctx.lastPoint.y,it.x1,it.y1,it.x2,it.y2,it.x,it.y);Ut.push(Math.floor((ne.y+Zt)/Lt)+1),Ut.push(Math.floor((ne.y+ne.h+Zt)/Lt)+1);break;case"rect":Ut.push(Math.floor((it.y+Zt)/Lt)+1),Ut.push(Math.floor((it.y+it.h+Zt)/Lt)+1)}for(var re=0;re<Ut.length;re+=1)for(;this.pdf.internal.getNumberOfPages()<Ut[re];)U.call(this);return Ut},U=function(){var it=this.fillStyle,Tt=this.strokeStyle,Lt=this.font,Ut=this.lineCap,Zt=this.lineWidth,Kt=this.lineJoin;this.pdf.addPage(),this.fillStyle=it,this.strokeStyle=Tt,this.font=Lt,this.lineCap=Ut,this.lineWidth=Zt,this.lineJoin=Kt},z=function(it,Tt,Lt){for(var Ut=0;Ut<it.length;Ut++)switch(it[Ut].type){case"bct":it[Ut].x2+=Tt,it[Ut].y2+=Lt;case"qct":it[Ut].x1+=Tt,it[Ut].y1+=Lt;case"mt":case"lt":case"arc":default:it[Ut].x+=Tt,it[Ut].y+=Lt}return it},J=function(it){return it.sort(function(Tt,Lt){return Tt-Lt})},nt=function(it,Tt){for(var Lt,Ut,Zt=this.fillStyle,Kt=this.strokeStyle,ne=this.lineCap,re=this.lineWidth,Se=Math.abs(re*this.ctx.transform.scaleX),Be=this.lineJoin,ze=JSON.parse(JSON.stringify(this.path)),Ve=JSON.parse(JSON.stringify(this.path)),Xe=[],ge=0;ge<Ve.length;ge++)if(Ve[ge].x!==void 0)for(var Bt=Z.call(this,Ve[ge]),Xt=0;Xt<Bt.length;Xt+=1)Xe.indexOf(Bt[Xt])===-1&&Xe.push(Bt[Xt]);for(var ir=0;ir<Xe.length;ir++)for(;this.pdf.internal.getNumberOfPages()<Xe[ir];)U.call(this);if(J(Xe),this.autoPaging)for(var Ie=Xe[0],ve=Xe[Xe.length-1],Ce=Ie;Ce<ve+1;Ce++){this.pdf.setPage(Ce),this.fillStyle=Zt,this.strokeStyle=Kt,this.lineCap=ne,this.lineWidth=Se,this.lineJoin=Be;var qe=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],lr=Ce===1?this.posY+this.margin[0]:this.margin[0],Er=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ir=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Mr=Ce===1?0:Er+(Ce-2)*Ir;if(this.ctx.clip_path.length!==0){var Wr=this.path;Lt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=z(Lt,this.posX+this.margin[3],-Mr+lr+this.ctx.prevPageLastElemOffset),mt.call(this,it,!0),this.path=Wr}if(Ut=JSON.parse(JSON.stringify(ze)),this.path=z(Ut,this.posX+this.margin[3],-Mr+lr+this.ctx.prevPageLastElemOffset),Tt===!1||Ce===0){var Jr=(Ce>Ie||Ce<ve)&&F.call(this);Jr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],qe,Ir,null).clip().discardPath()),mt.call(this,it,Tt),Jr&&this.pdf.restoreGraphicsState()}this.lineWidth=re}else this.lineWidth=Se,mt.call(this,it,Tt),this.lineWidth=re;this.path=ze},mt=function(it,Tt){if((it!=="stroke"||Tt||!N.call(this))&&(it==="stroke"||Tt||!I.call(this))){for(var Lt,Ut,Zt=[],Kt=this.path,ne=0;ne<Kt.length;ne++){var re=Kt[ne];switch(re.type){case"begin":Zt.push({begin:!0});break;case"close":Zt.push({close:!0});break;case"mt":Zt.push({start:re,deltas:[],abs:[]});break;case"lt":var Se=Zt.length;if(Kt[ne-1]&&!isNaN(Kt[ne-1].x)&&(Lt=[re.x-Kt[ne-1].x,re.y-Kt[ne-1].y],Se>0)){for(;Se>=0;Se--)if(Zt[Se-1].close!==!0&&Zt[Se-1].begin!==!0){Zt[Se-1].deltas.push(Lt),Zt[Se-1].abs.push(re);break}}break;case"bct":Lt=[re.x1-Kt[ne-1].x,re.y1-Kt[ne-1].y,re.x2-Kt[ne-1].x,re.y2-Kt[ne-1].y,re.x-Kt[ne-1].x,re.y-Kt[ne-1].y],Zt[Zt.length-1].deltas.push(Lt);break;case"qct":var Be=Kt[ne-1].x+2/3*(re.x1-Kt[ne-1].x),ze=Kt[ne-1].y+2/3*(re.y1-Kt[ne-1].y),Ve=re.x+2/3*(re.x1-re.x),Xe=re.y+2/3*(re.y1-re.y),ge=re.x,Bt=re.y;Lt=[Be-Kt[ne-1].x,ze-Kt[ne-1].y,Ve-Kt[ne-1].x,Xe-Kt[ne-1].y,ge-Kt[ne-1].x,Bt-Kt[ne-1].y],Zt[Zt.length-1].deltas.push(Lt);break;case"arc":Zt.push({deltas:[],abs:[],arc:!0}),Array.isArray(Zt[Zt.length-1].abs)&&Zt[Zt.length-1].abs.push(re)}}Ut=Tt?null:it==="stroke"?"stroke":"fill";for(var Xt=!1,ir=0;ir<Zt.length;ir++)if(Zt[ir].arc)for(var Ie=Zt[ir].abs,ve=0;ve<Ie.length;ve++){var Ce=Ie[ve];Ce.type==="arc"?pt.call(this,Ce.x,Ce.y,Ce.radius,Ce.startAngle,Ce.endAngle,Ce.counterclockwise,void 0,Tt,!Xt):kt.call(this,Ce.x,Ce.y),Xt=!0}else if(Zt[ir].close===!0)this.pdf.internal.out("h"),Xt=!1;else if(Zt[ir].begin!==!0){var qe=Zt[ir].start.x,lr=Zt[ir].start.y;xt.call(this,Zt[ir].deltas,qe,lr),Xt=!0}Ut&&zt.call(this,Ut),Tt&&Rt.call(this)}},Et=function(it){var Tt=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Lt=Tt*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return it-Lt;case"top":return it+Tt-Lt;case"hanging":return it+Tt-2*Lt;case"middle":return it+Tt/2-Lt;case"ideographic":return it;case"alphabetic":default:return it}},bt=function(it){return it+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};A.prototype.createLinearGradient=function(){var it=function(){};return it.colorStops=[],it.addColorStop=function(Tt,Lt){this.colorStops.push([Tt,Lt])},it.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},it.isCanvasGradient=!0,it},A.prototype.createPattern=function(){return this.createLinearGradient()},A.prototype.createRadialGradient=function(){return this.createLinearGradient()};var pt=function(it,Tt,Lt,Ut,Zt,Kt,ne,re,Se){for(var Be=oe.call(this,Lt,Ut,Zt,Kt),ze=0;ze<Be.length;ze++){var Ve=Be[ze];ze===0&&(Se?at.call(this,Ve.x1+it,Ve.y1+Tt):kt.call(this,Ve.x1+it,Ve.y1+Tt)),ue.call(this,it,Tt,Ve.x2,Ve.y2,Ve.x3,Ve.y3,Ve.x4,Ve.y4)}re?Rt.call(this):zt.call(this,ne)},zt=function(it){switch(it){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},Rt=function(){this.pdf.clip(),this.pdf.discardPath()},at=function(it,Tt){this.pdf.internal.out(r(it)+" "+i(Tt)+" m")},dt=function(it){var Tt;switch(it.align){case"right":case"end":Tt="right";break;case"center":Tt="center";break;case"left":case"start":default:Tt="left"}var Lt=this.pdf.getTextDimensions(it.text),Ut=Et.call(this,it.y),Zt=bt.call(this,Ut)-Lt.h,Kt=this.ctx.transform.applyToPoint(new a(it.x,Ut)),ne=this.ctx.transform.decompose(),re=new f;re=(re=(re=re.multiply(ne.translate)).multiply(ne.skew)).multiply(ne.scale);for(var Se,Be,ze,Ve=this.ctx.transform.applyToRectangle(new o(it.x,Ut,Lt.w,Lt.h)),Xe=re.applyToRectangle(new o(it.x,Zt,Lt.w,Lt.h)),ge=Z.call(this,Xe),Bt=[],Xt=0;Xt<ge.length;Xt+=1)Bt.indexOf(ge[Xt])===-1&&Bt.push(ge[Xt]);if(J(Bt),this.autoPaging)for(var ir=Bt[0],Ie=Bt[Bt.length-1],ve=ir;ve<Ie+1;ve++){this.pdf.setPage(ve);var Ce=ve===1?this.posY+this.margin[0]:this.margin[0],qe=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],lr=this.pdf.internal.pageSize.height-this.margin[2],Er=lr-this.margin[0],Ir=this.pdf.internal.pageSize.width-this.margin[1],Mr=Ir-this.margin[3],Wr=ve===1?0:qe+(ve-2)*Er;if(this.ctx.clip_path.length!==0){var Jr=this.path;Se=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=z(Se,this.posX+this.margin[3],-1*Wr+Ce),mt.call(this,"fill",!0),this.path=Jr}var de=z([JSON.parse(JSON.stringify(Xe))],this.posX+this.margin[3],-Wr+Ce+this.ctx.prevPageLastElemOffset)[0];it.scale>=.01&&(Be=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Be*it.scale),ze=this.lineWidth,this.lineWidth=ze*it.scale);var Tr=this.autoPaging!=="text";if(Tr||de.y+de.h<=lr){if(Tr||de.y>=Ce&&de.x<=Ir){var Re=Tr?it.text:this.pdf.splitTextToSize(it.text,it.maxWidth||Ir-de.x)[0],Hi=z([JSON.parse(JSON.stringify(Ve))],this.posX+this.margin[3],-Wr+Ce+this.ctx.prevPageLastElemOffset)[0],Pr=Tr&&(ve>ir||ve<Ie)&&F.call(this);Pr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Mr,Er,null).clip().discardPath()),this.pdf.text(Re,Hi.x,Hi.y,{angle:it.angle,align:Tt,renderingMode:it.renderingMode}),Pr&&this.pdf.restoreGraphicsState()}}else de.y<lr&&(this.ctx.prevPageLastElemOffset+=lr-de.y);it.scale>=.01&&(this.pdf.setFontSize(Be),this.lineWidth=ze)}else it.scale>=.01&&(Be=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Be*it.scale),ze=this.lineWidth,this.lineWidth=ze*it.scale),this.pdf.text(it.text,Kt.x+this.posX,Kt.y+this.posY,{angle:it.angle,align:Tt,renderingMode:it.renderingMode,maxWidth:it.maxWidth}),it.scale>=.01&&(this.pdf.setFontSize(Be),this.lineWidth=ze)},kt=function(it,Tt,Lt,Ut){Lt=Lt||0,Ut=Ut||0,this.pdf.internal.out(r(it+Lt)+" "+i(Tt+Ut)+" l")},xt=function(it,Tt,Lt){return this.pdf.lines(it,Tt,Lt,null,null)},ue=function(it,Tt,Lt,Ut,Zt,Kt,ne,re){this.pdf.internal.out([t(n(Lt+it)),t(s(Ut+Tt)),t(n(Zt+it)),t(s(Kt+Tt)),t(n(ne+it)),t(s(re+Tt)),"c"].join(" "))},oe=function(it,Tt,Lt,Ut){for(var Zt=2*Math.PI,Kt=Math.PI/2;Tt>Lt;)Tt-=Zt;var ne=Math.abs(Lt-Tt);ne<Zt&&Ut&&(ne=Zt-ne);for(var re=[],Se=Ut?-1:1,Be=Tt;ne>1e-5;){var ze=Be+Se*Math.min(ne,Kt);re.push(he.call(this,it,Be,ze)),ne-=Math.abs(ze-Be),Be=ze}return re},he=function(it,Tt,Lt){var Ut=(Lt-Tt)/2,Zt=it*Math.cos(Ut),Kt=it*Math.sin(Ut),ne=Zt,re=-Kt,Se=ne*ne+re*re,Be=Se+ne*Zt+re*Kt,ze=4/3*(Math.sqrt(2*Se*Be)-Be)/(ne*Kt-re*Zt),Ve=ne-ze*re,Xe=re+ze*ne,ge=Ve,Bt=-Xe,Xt=Ut+Tt,ir=Math.cos(Xt),Ie=Math.sin(Xt);return{x1:it*Math.cos(Tt),y1:it*Math.sin(Tt),x2:Ve*ir-Xe*Ie,y2:Ve*Ie+Xe*ir,x3:ge*ir-Bt*Ie,y3:ge*Ie+Bt*ir,x4:it*Math.cos(Lt),y4:it*Math.sin(Lt)}},Dt=function(it){return 180*it/Math.PI},Qt=function(it,Tt,Lt,Ut,Zt,Kt){var ne=it+.5*(Lt-it),re=Tt+.5*(Ut-Tt),Se=Zt+.5*(Lt-Zt),Be=Kt+.5*(Ut-Kt),ze=Math.min(it,Zt,ne,Se),Ve=Math.max(it,Zt,ne,Se),Xe=Math.min(Tt,Kt,re,Be),ge=Math.max(Tt,Kt,re,Be);return new o(ze,Xe,Ve-ze,ge-Xe)},ee=function(it,Tt,Lt,Ut,Zt,Kt,ne,re){var Se,Be,ze,Ve,Xe,ge,Bt,Xt,ir,Ie,ve,Ce,qe,lr,Er=Lt-it,Ir=Ut-Tt,Mr=Zt-Lt,Wr=Kt-Ut,Jr=ne-Zt,de=re-Kt;for(Be=0;Be<41;Be++)ir=(Bt=(ze=it+(Se=Be/40)*Er)+Se*((Xe=Lt+Se*Mr)-ze))+Se*(Xe+Se*(Zt+Se*Jr-Xe)-Bt),Ie=(Xt=(Ve=Tt+Se*Ir)+Se*((ge=Ut+Se*Wr)-Ve))+Se*(ge+Se*(Kt+Se*de-ge)-Xt),Be==0?(ve=ir,Ce=Ie,qe=ir,lr=Ie):(ve=Math.min(ve,ir),Ce=Math.min(Ce,Ie),qe=Math.max(qe,ir),lr=Math.max(lr,Ie));return new o(Math.round(ve),Math.round(Ce),Math.round(qe-ve),Math.round(lr-Ce))},xe=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var it,Tt,Lt=(it=this.ctx.lineDash,Tt=this.ctx.lineDashOffset,JSON.stringify({lineDash:it,lineDashOffset:Tt}));this.prevLineDash!==Lt&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Lt)}}})(Dr.API),function(e){var t=function(s){var a,o,f,m,w,A,P,I,N,F;for(o=[],f=0,m=(s+=a="\0\0\0\0".slice(s.length%4||4)).length;m>f;f+=4)(w=(s.charCodeAt(f)<<24)+(s.charCodeAt(f+1)<<16)+(s.charCodeAt(f+2)<<8)+s.charCodeAt(f+3))!==0?(A=(w=((w=((w=((w=(w-(F=w%85))/85)-(N=w%85))/85)-(I=w%85))/85)-(P=w%85))/85)%85,o.push(A+33,P+33,I+33,N+33,F+33)):o.push(122);return function(Z,U){for(var z=U;z>0;z--)Z.pop()}(o,a.length),String.fromCharCode.apply(String,o)+"~>"},r=function(s){var a,o,f,m,w,A=String,P="length",I=255,N="charCodeAt",F="slice",Z="replace";for(s[F](-2),s=s[F](0,-2)[Z](/\s/g,"")[Z]("z","!!!!!"),f=[],m=0,w=(s+=a="uuuuu"[F](s[P]%5||5))[P];w>m;m+=5)o=52200625*(s[N](m)-33)+614125*(s[N](m+1)-33)+7225*(s[N](m+2)-33)+85*(s[N](m+3)-33)+(s[N](m+4)-33),f.push(I&o>>24,I&o>>16,I&o>>8,I&o);return function(U,z){for(var J=z;J>0;J--)U.pop()}(f,a[P]),A.fromCharCode.apply(A,f)},i=function(s){var a=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((s=s.replace(/\s/g,"")).indexOf(">")!==-1&&(s=s.substr(0,s.indexOf(">"))),s.length%2&&(s+="0"),a.test(s)===!1)return"";for(var o="",f=0;f<s.length;f+=2)o+=String.fromCharCode("0x"+(s[f]+s[f+1]));return o},n=function(s){for(var a=new Uint8Array(s.length),o=s.length;o--;)a[o]=s.charCodeAt(o);return s=(a=jx(a)).reduce(function(f,m){return f+String.fromCharCode(m)},"")};e.processDataByFilters=function(s,a){var o=0,f=s||"",m=[];for(typeof(a=a||[])=="string"&&(a=[a]),o=0;o<a.length;o+=1)switch(a[o]){case"ASCII85Decode":case"/ASCII85Decode":f=r(f),m.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":f=t(f),m.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":f=i(f),m.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":f=f.split("").map(function(w){return("0"+w.charCodeAt().toString(16)).slice(-2)}).join("")+">",m.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":f=n(f),m.push("/FlateDecode");break;default:throw new Error('The filter: "'+a[o]+'" is not implemented')}return{data:f,reverseChain:m.reverse().join(" ")}}}(Dr.API),function(e){e.loadFile=function(t,r,i){return function(n,s,a){s=s!==!1,a=typeof a=="function"?a:function(){};var o=void 0;try{o=function(f,m,w){var A=new XMLHttpRequest,P=0,I=function(N){var F=N.length,Z=[],U=String.fromCharCode;for(P=0;P<F;P+=1)Z.push(U(255&N.charCodeAt(P)));return Z.join("")};if(A.open("GET",f,!m),A.overrideMimeType("text/plain; charset=x-user-defined"),m===!1&&(A.onload=function(){A.status===200?w(I(this.responseText)):w(void 0)}),A.send(null),m&&A.status===200)return I(A.responseText)}(n,s,a)}catch{}return o}(t,r,i)},e.loadImageFile=e.loadFile}(Dr.API),function(e){function t(){return(Nr.html2canvas?Promise.resolve(Nr.html2canvas):Gw(()=>import("./html2canvas.esm-DbilGY6A-DB3xAFLF-3bdf569c.js"),[])).catch(function(a){return Promise.reject(new Error("Could not load html2canvas: "+a))}).then(function(a){return a.default?a.default:a})}function r(){return(Nr.DOMPurify?Promise.resolve(Nr.DOMPurify):Gw(()=>import("./purify.es-C-d0AVPf-BZqXIm-R-4bab3ee9.js"),[])).catch(function(a){return Promise.reject(new Error("Could not load dompurify: "+a))}).then(function(a){return a.default?a.default:a})}var i=function(a){var o=Gi(a);return o==="undefined"?"undefined":o==="string"||a instanceof String?"string":o==="number"||a instanceof Number?"number":o==="function"||a instanceof Function?"function":a&&a.constructor===Array?"array":a&&a.nodeType===1?"element":o==="object"?"object":"unknown"},n=function(a,o){var f=document.createElement(a);for(var m in o.className&&(f.className=o.className),o.innerHTML&&o.dompurify&&(f.innerHTML=o.dompurify.sanitize(o.innerHTML)),o.style)f.style[m]=o.style[m];return f},s=function a(o){var f=Object.assign(a.convert(Promise.resolve()),JSON.parse(JSON.stringify(a.template))),m=a.convert(Promise.resolve(),f);return m=(m=m.setProgress(1,a,1,[a])).set(o)};(s.prototype=Object.create(Promise.prototype)).constructor=s,s.convert=function(a,o){return a.__proto__=o||s.prototype,a},s.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},s.prototype.from=function(a,o){return this.then(function(){switch(o=o||function(f){switch(i(f)){case"string":return"string";case"element":return f.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(a)){case"string":return this.then(r).then(function(f){return this.set({src:n("div",{innerHTML:a,dompurify:f})})});case"element":return this.set({src:a});case"canvas":return this.set({canvas:a});case"img":return this.set({img:a});default:return this.error("Unknown source type.")}})},s.prototype.to=function(a){switch(a){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},s.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var a={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},o=function f(m,w){for(var A=m.nodeType===3?document.createTextNode(m.nodeValue):m.cloneNode(!1),P=m.firstChild;P;P=P.nextSibling)w!==!0&&P.nodeType===1&&P.nodeName==="SCRIPT"||A.appendChild(f(P,w));return m.nodeType===1&&(m.nodeName==="CANVAS"?(A.width=m.width,A.height=m.height,A.getContext("2d").drawImage(m,0,0)):m.nodeName!=="TEXTAREA"&&m.nodeName!=="SELECT"||(A.value=m.value),A.addEventListener("load",function(){A.scrollTop=m.scrollTop,A.scrollLeft=m.scrollLeft},!0)),A}(this.prop.src,this.opt.html2canvas.javascriptEnabled);o.tagName==="BODY"&&(a.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=n("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=n("div",{className:"html2pdf__container",style:a}),this.prop.container.appendChild(o),this.prop.container.firstChild.appendChild(n("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},s.prototype.toCanvas=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(t).then(function(o){var f=Object.assign({},this.opt.html2canvas);return delete f.onrendered,o(this.prop.container,f)}).then(function(o){(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toContext2d=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(t).then(function(o){var f=this.opt.jsPDF,m=this.opt.fontFaces,w=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,A=Object.assign({async:!0,allowTaint:!0,scale:w,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete A.onrendered,f.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,f.context2d.posX=this.opt.x,f.context2d.posY=this.opt.y,f.context2d.margin=this.opt.margin,f.context2d.fontFaces=m,m)for(var P=0;P<m.length;++P){var I=m[P],N=I.src.find(function(F){return F.format==="truetype"});N&&f.addFont(N.url,I.ref.name,I.ref.style)}return A.windowHeight=A.windowHeight||0,A.windowHeight=A.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):A.windowHeight,f.context2d.save(!0),o(this.prop.container,A)}).then(function(o){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(o),this.prop.canvas=o,document.body.removeChild(this.prop.overlay)})},s.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var a=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=a})},s.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},s.prototype.output=function(a,o,f){return(f=f||"pdf").toLowerCase()==="img"||f.toLowerCase()==="image"?this.outputImg(a,o):this.outputPdf(a,o)},s.prototype.outputPdf=function(a,o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(a,o)})},s.prototype.outputImg=function(a){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(a){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+a+'" is not supported.'}})},s.prototype.save=function(a){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(a?{filename:a}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},s.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},s.prototype.set=function(a){if(i(a)!=="object")return this;var o=Object.keys(a||{}).map(function(f){if(f in s.template.prop)return function(){this.prop[f]=a[f]};switch(f){case"margin":return this.setMargin.bind(this,a.margin);case"jsPDF":return function(){return this.opt.jsPDF=a.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,a.pageSize);default:return function(){this.opt[f]=a[f]}}},this);return this.then(function(){return this.thenList(o)})},s.prototype.get=function(a,o){return this.then(function(){var f=a in s.template.prop?this.prop[a]:this.opt[a];return o?o(f):f})},s.prototype.setMargin=function(a){return this.then(function(){switch(i(a)){case"number":a=[a,a,a,a];case"array":if(a.length===2&&(a=[a[0],a[1],a[0],a[1]]),a.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=a}).then(this.setPageSize)},s.prototype.setPageSize=function(a){function o(f,m){return Math.floor(f*m/72*96)}return this.then(function(){(a=a||Dr.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(a.inner={width:a.width-this.opt.margin[1]-this.opt.margin[3],height:a.height-this.opt.margin[0]-this.opt.margin[2]},a.inner.px={width:o(a.inner.width,a.k),height:o(a.inner.height,a.k)},a.inner.ratio=a.inner.height/a.inner.width),this.prop.pageSize=a})},s.prototype.setProgress=function(a,o,f,m){return a!=null&&(this.progress.val=a),o!=null&&(this.progress.state=o),f!=null&&(this.progress.n=f),m!=null&&(this.progress.stack=m),this.progress.ratio=this.progress.val/this.progress.state,this},s.prototype.updateProgress=function(a,o,f,m){return this.setProgress(a?this.progress.val+a:null,o||null,f?this.progress.n+f:null,m?this.progress.stack.concat(m):null)},s.prototype.then=function(a,o){var f=this;return this.thenCore(a,o,function(m,w){return f.updateProgress(null,null,1,[m]),Promise.prototype.then.call(this,function(A){return f.updateProgress(null,m),A}).then(m,w).then(function(A){return f.updateProgress(1),A})})},s.prototype.thenCore=function(a,o,f){f=f||Promise.prototype.then,a&&(a=a.bind(this)),o&&(o=o.bind(this));var m=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:s.convert(Object.assign({},this),Promise.prototype),w=f.call(m,a,o);return s.convert(w,this.__proto__)},s.prototype.thenExternal=function(a,o){return Promise.prototype.then.call(this,a,o)},s.prototype.thenList=function(a){var o=this;return a.forEach(function(f){o=o.thenCore(f)}),o},s.prototype.catch=function(a){a&&(a=a.bind(this));var o=Promise.prototype.catch.call(this,a);return s.convert(o,this)},s.prototype.catchExternal=function(a){return Promise.prototype.catch.call(this,a)},s.prototype.error=function(a){return this.then(function(){throw new Error(a)})},s.prototype.using=s.prototype.set,s.prototype.saveAs=s.prototype.save,s.prototype.export=s.prototype.output,s.prototype.run=s.prototype.then,Dr.getPageSize=function(a,o,f){if(Gi(a)==="object"){var m=a;a=m.orientation,o=m.unit||o,f=m.format||f}o=o||"mm",f=f||"a4",a=(""+(a||"P")).toLowerCase();var w,A=(""+f).toLowerCase(),P={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(o){case"pt":w=1;break;case"mm":w=72/25.4;break;case"cm":w=72/2.54;break;case"in":w=72;break;case"px":w=.75;break;case"pc":case"em":w=12;break;case"ex":w=6;break;default:throw"Invalid unit: "+o}var I,N=0,F=0;if(P.hasOwnProperty(A))N=P[A][1]/w,F=P[A][0]/w;else try{N=f[1],F=f[0]}catch{throw new Error("Invalid format: "+f)}if(a==="p"||a==="portrait")a="p",F>N&&(I=F,F=N,N=I);else{if(a!=="l"&&a!=="landscape")throw"Invalid orientation: "+a;a="l",N>F&&(I=F,F=N,N=I)}return{width:F,height:N,unit:o,k:w,orientation:a}},e.html=function(a,o){(o=o||{}).callback=o.callback||function(){},o.html2canvas=o.html2canvas||{},o.html2canvas.canvas=o.html2canvas.canvas||this.canvas,o.jsPDF=o.jsPDF||this,o.fontFaces=o.fontFaces?o.fontFaces.map(Wx):null;var f=new s(o);return o.worker?f:f.from(a).doCallback()}}(Dr.API),Dr.API.addJS=function(e){return zI=e,this.internal.events.subscribe("postPutResources",function(){ny=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(ny+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),FI=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+zI+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){ny!==void 0&&FI!==void 0&&this.internal.out("/Names <</JavaScript "+ny+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var r=this,i=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var n=r.outline.render().split(/\r\n/),s=0;s<n.length;s++){var a=n[s],o=i.exec(a);if(o!=null){var f=o[1];r.internal.newObjectDeferredBegin(f,!1)}r.internal.write(a)}if(this.outline.createNamedDestinations){var m=this.internal.pages.length,w=[];for(s=0;s<m;s++){var A=r.internal.newObject();w.push(A);var P=r.internal.getPageInfo(s+1);r.internal.write("<< /D["+P.objId+" 0 R /XYZ null null null]>> endobj")}var I=r.internal.newObject();for(r.internal.write("<< /Names [ "),s=0;s<w.length;s++)r.internal.write("(page_"+(s+1)+")"+w[s]+" 0 R");r.internal.write(" ] >>","endobj"),t=r.internal.newObject(),r.internal.write("<< /Dests "+I+" 0 R"),r.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var r=this;r.outline={createNamedDestinations:!1,root:{children:[]}},r.outline.add=function(i,n,s){var a={title:n,options:s,children:[]};return i==null&&(i=this.root),i.children.push(a),a},r.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=r,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},r.outline.genIds_r=function(i){i.id=r.internal.newObjectDeferred();for(var n=0;n<i.children.length;n++)this.genIds_r(i.children[n])},r.outline.renderRoot=function(i){this.objStart(i),this.line("/Type /Outlines"),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1]))),this.line("/Count "+this.count_r({count:0},i)),this.objEnd()},r.outline.renderItems=function(i){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,s=0;s<i.children.length;s++){var a=i.children[s];this.objStart(a),this.line("/Title "+this.makeString(a.title)),this.line("/Parent "+this.makeRef(i)),s>0&&this.line("/Prev "+this.makeRef(i.children[s-1])),s<i.children.length-1&&this.line("/Next "+this.makeRef(i.children[s+1])),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1])));var o=this.count=this.count_r({count:0},a);if(o>0&&this.line("/Count "+o),a.options&&a.options.pageNumber){var f=r.internal.getPageInfo(a.options.pageNumber);this.line("/Dest ["+f.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var m=0;m<i.children.length;m++)this.renderItems(i.children[m])},r.outline.line=function(i){this.ctx.val+=i+`\r
`},r.outline.makeRef=function(i){return i.id+" 0 R"},r.outline.makeString=function(i){return"("+r.internal.pdfEscape(i)+")"},r.outline.objStart=function(i){this.ctx.val+=`\r
`+i.id+` 0 obj\r
<<\r
`},r.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},r.outline.count_r=function(i,n){for(var s=0;s<n.children.length;s++)i.count++,this.count_r(i,n.children[s]);return i.count}}])}(Dr.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(r,i,n,s,a,o){var f,m=this.decode.DCT_DECODE,w=null;if(typeof r=="string"||this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r)){switch(r=a||r,r=this.__addimage__.isArrayBuffer(r)?new Uint8Array(r):r,(f=function(A){for(var P,I=256*A.charCodeAt(4)+A.charCodeAt(5),N=A.length,F={width:0,height:0,numcomponents:1},Z=4;Z<N;Z+=2){if(Z+=I,t.indexOf(A.charCodeAt(Z+1))!==-1){P=256*A.charCodeAt(Z+5)+A.charCodeAt(Z+6),F={width:256*A.charCodeAt(Z+7)+A.charCodeAt(Z+8),height:P,numcomponents:A.charCodeAt(Z+9)};break}I=256*A.charCodeAt(Z+2)+A.charCodeAt(Z+3)}return F}(r=this.__addimage__.isArrayBufferView(r)?this.__addimage__.arrayBufferToBinaryString(r):r)).numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}w={data:r,width:f.width,height:f.height,colorSpace:o,bitsPerComponent:8,filter:m,index:i,alias:n}}return w}}(Dr.API);var dp,sy,UI,GI,VI,rrt=function(){var e,t,r;function i(s){var a,o,f,m,w,A,P,I,N,F,Z,U,z,J;for(this.data=s,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},A=null;;){switch(a=this.readUInt32(),N=(function(){var nt,mt;for(mt=[],nt=0;nt<4;++nt)mt.push(String.fromCharCode(this.data[this.pos++]));return mt}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(a);break;case"fcTL":A&&this.animation.frames.push(A),this.pos+=4,A={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},w=this.readUInt16(),m=this.readUInt16()||100,A.delay=1e3*w/m,A.disposeOp=this.data[this.pos++],A.blendOp=this.data[this.pos++],A.data=[];break;case"IDAT":case"fdAT":for(N==="fdAT"&&(this.pos+=4,a-=4),s=(A!=null?A.data:void 0)||this.imgData,U=0;0<=a?U<a:U>a;0<=a?++U:--U)s.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(f=this.palette.length/3,this.transparency.indexed=this.read(a),this.transparency.indexed.length>f)throw new Error("More transparent colors than palette size");if((F=f-this.transparency.indexed.length)>0)for(z=0;0<=F?z<F:z>F;0<=F?++z:--z)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case"tEXt":P=(Z=this.read(a)).indexOf(0),I=String.fromCharCode.apply(String,Z.slice(0,P)),this.text[I]=String.fromCharCode.apply(String,Z.slice(P+1));break;case"IEND":return A&&this.animation.frames.push(A),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(J=this.colorType)===4||J===6,o=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*o,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=a}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}i.prototype.read=function(s){var a,o;for(o=[],a=0;0<=s?a<s:a>s;0<=s?++a:--a)o.push(this.data[this.pos++]);return o},i.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.decodePixels=function(s){var a=this.pixelBitlength/8,o=new Uint8Array(this.width*this.height*a),f=0,m=this;if(s==null&&(s=this.imgData),s.length===0)return new Uint8Array(0);function w(A,P,I,N){var F,Z,U,z,J,nt,mt,Et,bt,pt,zt,Rt,at,dt,kt,xt,ue,oe,he,Dt,Qt,ee=Math.ceil((m.width-A)/I),xe=Math.ceil((m.height-P)/N),it=m.width==ee&&m.height==xe;for(dt=a*ee,Rt=it?o:new Uint8Array(dt*xe),nt=s.length,at=0,Z=0;at<xe&&f<nt;){switch(s[f++]){case 0:for(z=ue=0;ue<dt;z=ue+=1)Rt[Z++]=s[f++];break;case 1:for(z=oe=0;oe<dt;z=oe+=1)F=s[f++],J=z<a?0:Rt[Z-a],Rt[Z++]=(F+J)%256;break;case 2:for(z=he=0;he<dt;z=he+=1)F=s[f++],U=(z-z%a)/a,kt=at&&Rt[(at-1)*dt+U*a+z%a],Rt[Z++]=(kt+F)%256;break;case 3:for(z=Dt=0;Dt<dt;z=Dt+=1)F=s[f++],U=(z-z%a)/a,J=z<a?0:Rt[Z-a],kt=at&&Rt[(at-1)*dt+U*a+z%a],Rt[Z++]=(F+Math.floor((J+kt)/2))%256;break;case 4:for(z=Qt=0;Qt<dt;z=Qt+=1)F=s[f++],U=(z-z%a)/a,J=z<a?0:Rt[Z-a],at===0?kt=xt=0:(kt=Rt[(at-1)*dt+U*a+z%a],xt=U&&Rt[(at-1)*dt+(U-1)*a+z%a]),mt=J+kt-xt,Et=Math.abs(mt-J),pt=Math.abs(mt-kt),zt=Math.abs(mt-xt),bt=Et<=pt&&Et<=zt?J:pt<=zt?kt:xt,Rt[Z++]=(F+bt)%256;break;default:throw new Error("Invalid filter algorithm: "+s[f-1])}if(!it){var Tt=((P+at*N)*m.width+A)*a,Lt=at*dt;for(z=0;z<ee;z+=1){for(var Ut=0;Ut<a;Ut+=1)o[Tt++]=Rt[Lt++];Tt+=(I-1)*a}}at++}}return s=Det(s),m.interlaceMethod==1?(w(0,0,8,8),w(4,0,8,8),w(0,4,4,8),w(2,0,4,4),w(0,2,2,4),w(1,0,2,2),w(0,1,1,2)):w(0,0,1,1),o},i.prototype.decodePalette=function(){var s,a,o,f,m,w,A,P,I;for(o=this.palette,w=this.transparency.indexed||[],m=new Uint8Array((w.length||0)+o.length),f=0,s=0,a=A=0,P=o.length;A<P;a=A+=3)m[f++]=o[a],m[f++]=o[a+1],m[f++]=o[a+2],m[f++]=(I=w[s++])!=null?I:255;return m},i.prototype.copyToImageData=function(s,a){var o,f,m,w,A,P,I,N,F,Z,U;if(f=this.colors,F=null,o=this.hasAlphaChannel,this.palette.length&&(F=(U=this._decodedPalette)!=null?U:this._decodedPalette=this.decodePalette(),f=4,o=!0),N=(m=s.data||s).length,A=F||a,w=P=0,f===1)for(;w<N;)I=F?4*a[w/4]:P,Z=A[I++],m[w++]=Z,m[w++]=Z,m[w++]=Z,m[w++]=o?A[I++]:255,P=I;else for(;w<N;)I=F?4*a[w/4]:P,m[w++]=A[I++],m[w++]=A[I++],m[w++]=A[I++],m[w++]=o?A[I++]:255,P=I},i.prototype.decode=function(){var s;return s=new Uint8Array(this.width*this.height*4),this.copyToImageData(s,this.decodePixels()),s};var n=function(){if(Object.prototype.toString.call(Nr)==="[object Window]"){try{t=Nr.document.createElement("canvas"),r=t.getContext("2d")}catch{return!1}return!0}return!1};return n(),e=function(s){var a;if(n()===!0)return r.width=s.width,r.height=s.height,r.clearRect(0,0,s.width,s.height),r.putImageData(s,0,0),(a=new Image).src=t.toDataURL(),a;throw new Error("This method requires a Browser with Canvas-capability.")},i.prototype.decodeFrames=function(s){var a,o,f,m,w,A,P,I;if(this.animation){for(I=[],o=w=0,A=(P=this.animation.frames).length;w<A;o=++w)a=P[o],f=s.createImageData(a.width,a.height),m=this.decodePixels(new Uint8Array(a.data)),this.copyToImageData(f,m),a.imageData=f,I.push(a.image=e(f));return I}},i.prototype.renderFrame=function(s,a){var o,f,m;return o=(f=this.animation.frames)[a],m=f[a-1],a===0&&s.clearRect(0,0,this.width,this.height),(m!=null?m.disposeOp:void 0)===1?s.clearRect(m.xOffset,m.yOffset,m.width,m.height):(m!=null?m.disposeOp:void 0)===2&&s.putImageData(m.imageData,m.xOffset,m.yOffset),o.blendOp===0&&s.clearRect(o.xOffset,o.yOffset,o.width,o.height),s.drawImage(o.image,o.xOffset,o.yOffset)},i.prototype.animate=function(s){var a,o,f,m,w,A,P=this;return o=0,A=this.animation,m=A.numFrames,f=A.frames,w=A.numPlays,(a=function(){var I,N;if(I=o++%m,N=f[I],P.renderFrame(s,I),m>1&&o/m<w)return P.animation._timeout=setTimeout(a,N.delay)})()},i.prototype.stopAnimation=function(){var s;return clearTimeout((s=this.animation)!=null?s._timeout:void 0)},i.prototype.render=function(s){var a,o;return s._png&&s._png.stopAnimation(),s._png=this,s.width=this.width,s.height=this.height,a=s.getContext("2d"),this.animation?(this.decodeFrames(a),this.animate(a)):(o=a.createImageData(this.width,this.height),this.copyToImageData(o,this.decodePixels()),a.putImageData(o,0,0))},i}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function irt(e){var t=0;if(e[t++]!==71||e[t++]!==73||e[t++]!==70||e[t++]!==56||(e[t++]+1&253)!=56||e[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var r=e[t++]|e[t++]<<8,i=e[t++]|e[t++]<<8,n=e[t++],s=n>>7,a=1<<(7&n)+1;e[t++],e[t++];var o=null,f=null;s&&(o=t,f=a,t+=3*a);var m=!0,w=[],A=0,P=null,I=0,N=null;for(this.width=r,this.height=i;m&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(e[t]!==11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t+=14,N=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((at=e[t++])>=0))throw Error("Invalid block size");if(at===0)break;t+=at}break;case 249:if(e[t++]!==4||e[t+4]!==0)throw new Error("Invalid graphics extension block.");var F=e[t++];A=e[t++]|e[t++]<<8,P=e[t++],!(1&F)&&(P=null),I=F>>2&7,t++;break;case 254:for(;;){if(!((at=e[t++])>=0))throw Error("Invalid block size");if(at===0)break;t+=at}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var Z=e[t++]|e[t++]<<8,U=e[t++]|e[t++]<<8,z=e[t++]|e[t++]<<8,J=e[t++]|e[t++]<<8,nt=e[t++],mt=nt>>6&1,Et=1<<(7&nt)+1,bt=o,pt=f,zt=!1;nt>>7&&(zt=!0,bt=t,pt=Et,t+=3*Et);var Rt=t;for(t++;;){var at;if(!((at=e[t++])>=0))throw Error("Invalid block size");if(at===0)break;t+=at}w.push({x:Z,y:U,width:z,height:J,has_local_palette:zt,palette_offset:bt,palette_size:pt,data_offset:Rt,data_length:t-Rt,transparent_index:P,interlaced:!!mt,delay:A,disposal:I});break;case 59:m=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return w.length},this.loopCount=function(){return N},this.frameInfo=function(dt){if(dt<0||dt>=w.length)throw new Error("Frame index out of range.");return w[dt]},this.decodeAndBlitFrameBGRA=function(dt,kt){var xt=this.frameInfo(dt),ue=xt.width*xt.height,oe=new Uint8Array(ue);qI(e,xt.data_offset,oe,ue);var he=xt.palette_offset,Dt=xt.transparent_index;Dt===null&&(Dt=256);var Qt=xt.width,ee=r-Qt,xe=Qt,it=4*(xt.y*r+xt.x),Tt=4*((xt.y+xt.height)*r+xt.x),Lt=it,Ut=4*ee;xt.interlaced===!0&&(Ut+=4*r*7);for(var Zt=8,Kt=0,ne=oe.length;Kt<ne;++Kt){var re=oe[Kt];if(xe===0&&(xe=Qt,(Lt+=Ut)>=Tt&&(Ut=4*ee+4*r*(Zt-1),Lt=it+(Qt+ee)*(Zt<<1),Zt>>=1)),re===Dt)Lt+=4;else{var Se=e[he+3*re],Be=e[he+3*re+1],ze=e[he+3*re+2];kt[Lt++]=ze,kt[Lt++]=Be,kt[Lt++]=Se,kt[Lt++]=255}--xe}},this.decodeAndBlitFrameRGBA=function(dt,kt){var xt=this.frameInfo(dt),ue=xt.width*xt.height,oe=new Uint8Array(ue);qI(e,xt.data_offset,oe,ue);var he=xt.palette_offset,Dt=xt.transparent_index;Dt===null&&(Dt=256);var Qt=xt.width,ee=r-Qt,xe=Qt,it=4*(xt.y*r+xt.x),Tt=4*((xt.y+xt.height)*r+xt.x),Lt=it,Ut=4*ee;xt.interlaced===!0&&(Ut+=4*r*7);for(var Zt=8,Kt=0,ne=oe.length;Kt<ne;++Kt){var re=oe[Kt];if(xe===0&&(xe=Qt,(Lt+=Ut)>=Tt&&(Ut=4*ee+4*r*(Zt-1),Lt=it+(Qt+ee)*(Zt<<1),Zt>>=1)),re===Dt)Lt+=4;else{var Se=e[he+3*re],Be=e[he+3*re+1],ze=e[he+3*re+2];kt[Lt++]=Se,kt[Lt++]=Be,kt[Lt++]=ze,kt[Lt++]=255}--xe}}}function qI(e,t,r,i){for(var n=e[t++],s=1<<n,a=s+1,o=a+1,f=n+1,m=(1<<f)-1,w=0,A=0,P=0,I=e[t++],N=new Int32Array(4096),F=null;;){for(;w<16&&I!==0;)A|=e[t++]<<w,w+=8,I===1?I=e[t++]:--I;if(w<f)break;var Z=A&m;if(A>>=f,w-=f,Z!==s){if(Z===a)break;for(var U=Z<o?Z:F,z=0,J=U;J>s;)J=N[J]>>8,++z;var nt=J;if(P+z+(U!==Z?1:0)>i)return void nn.log("Warning, gif stream longer than expected.");r[P++]=nt;var mt=P+=z;for(U!==Z&&(r[P++]=nt),J=U;z--;)J=N[J],r[--mt]=255&J,J>>=8;F!==null&&o<4096&&(N[o++]=F<<8|nt,o>=m+1&&f<12&&(++f,m=m<<1|1)),F=Z}else o=a+1,m=(1<<(f=n+1))-1,F=null}return P!==i&&nn.log("Warning, gif stream shorter than expected."),r}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function V2(e){var t,r,i,n,s,a=Math.floor,o=new Array(64),f=new Array(64),m=new Array(64),w=new Array(64),A=new Array(65535),P=new Array(65535),I=new Array(64),N=new Array(64),F=[],Z=0,U=7,z=new Array(64),J=new Array(64),nt=new Array(64),mt=new Array(256),Et=new Array(2048),bt=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],pt=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],zt=[0,1,2,3,4,5,6,7,8,9,10,11],Rt=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],at=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],dt=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],kt=[0,1,2,3,4,5,6,7,8,9,10,11],xt=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],ue=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function oe(it,Tt){for(var Lt=0,Ut=0,Zt=new Array,Kt=1;Kt<=16;Kt++){for(var ne=1;ne<=it[Kt];ne++)Zt[Tt[Ut]]=[],Zt[Tt[Ut]][0]=Lt,Zt[Tt[Ut]][1]=Kt,Ut++,Lt++;Lt*=2}return Zt}function he(it){for(var Tt=it[0],Lt=it[1]-1;Lt>=0;)Tt&1<<Lt&&(Z|=1<<U),Lt--,--U<0&&(Z==255?(Dt(255),Dt(0)):Dt(Z),U=7,Z=0)}function Dt(it){F.push(it)}function Qt(it){Dt(it>>8&255),Dt(255&it)}function ee(it,Tt,Lt,Ut,Zt){for(var Kt,ne=Zt[0],re=Zt[240],Se=function(Ie,ve){var Ce,qe,lr,Er,Ir,Mr,Wr,Jr,de,Tr,Re=0;for(de=0;de<8;++de){Ce=Ie[Re],qe=Ie[Re+1],lr=Ie[Re+2],Er=Ie[Re+3],Ir=Ie[Re+4],Mr=Ie[Re+5],Wr=Ie[Re+6];var Hi=Ce+(Jr=Ie[Re+7]),Pr=Ce-Jr,Pe=qe+Wr,Ye=qe-Wr,tr=lr+Mr,fi=lr-Mr,Fr=Er+Ir,wr=Er-Ir,bi=Hi+Fr,ai=Hi-Fr,At=Pe+tr,Y=Pe-tr;Ie[Re]=bi+At,Ie[Re+4]=bi-At;var Q=.707106781*(Y+ai);Ie[Re+2]=ai+Q,Ie[Re+6]=ai-Q;var ot=.382683433*((bi=wr+fi)-(Y=Ye+Pr)),wt=.5411961*bi+ot,Nt=1.306562965*Y+ot,Gt=.707106781*(At=fi+Ye),Ht=Pr+Gt,Ct=Pr-Gt;Ie[Re+5]=Ct+wt,Ie[Re+3]=Ct-wt,Ie[Re+1]=Ht+Nt,Ie[Re+7]=Ht-Nt,Re+=8}for(Re=0,de=0;de<8;++de){Ce=Ie[Re],qe=Ie[Re+8],lr=Ie[Re+16],Er=Ie[Re+24],Ir=Ie[Re+32],Mr=Ie[Re+40],Wr=Ie[Re+48];var Jt=Ce+(Jr=Ie[Re+56]),ye=Ce-Jr,fe=qe+Wr,ce=qe-Wr,He=lr+Mr,Ze=lr-Mr,xr=Er+Ir,sr=Er-Ir,Cr=Jt+xr,zr=Jt-xr,$r=fe+He,li=fe-He;Ie[Re]=Cr+$r,Ie[Re+32]=Cr-$r;var ur=.707106781*(li+zr);Ie[Re+16]=zr+ur,Ie[Re+48]=zr-ur;var Gr=.382683433*((Cr=sr+Ze)-(li=ce+ye)),pi=.5411961*Cr+Gr,Ri=1.306562965*li+Gr,Wi=.707106781*($r=Ze+ce),Ii=ye+Wi,Zn=ye-Wi;Ie[Re+40]=Zn+pi,Ie[Re+24]=Zn-pi,Ie[Re+8]=Ii+Ri,Ie[Re+56]=Ii-Ri,Re++}for(de=0;de<64;++de)Tr=Ie[de]*ve[de],I[de]=Tr>0?Tr+.5|0:Tr-.5|0;return I}(it,Tt),Be=0;Be<64;++Be)N[bt[Be]]=Se[Be];var ze=N[0]-Lt;Lt=N[0],ze==0?he(Ut[0]):(he(Ut[P[Kt=32767+ze]]),he(A[Kt]));for(var Ve=63;Ve>0&&N[Ve]==0;)Ve--;if(Ve==0)return he(ne),Lt;for(var Xe,ge=1;ge<=Ve;){for(var Bt=ge;N[ge]==0&&ge<=Ve;)++ge;var Xt=ge-Bt;if(Xt>=16){Xe=Xt>>4;for(var ir=1;ir<=Xe;++ir)he(re);Xt&=15}Kt=32767+N[ge],he(Zt[(Xt<<4)+P[Kt]]),he(A[Kt]),ge++}return Ve!=63&&he(ne),Lt}function xe(it){it=Math.min(Math.max(it,1),100),s!=it&&(function(Tt){for(var Lt=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Ut=0;Ut<64;Ut++){var Zt=a((Lt[Ut]*Tt+50)/100);Zt=Math.min(Math.max(Zt,1),255),o[bt[Ut]]=Zt}for(var Kt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ne=0;ne<64;ne++){var re=a((Kt[ne]*Tt+50)/100);re=Math.min(Math.max(re,1),255),f[bt[ne]]=re}for(var Se=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Be=0,ze=0;ze<8;ze++)for(var Ve=0;Ve<8;Ve++)m[Be]=1/(o[bt[Be]]*Se[ze]*Se[Ve]*8),w[Be]=1/(f[bt[Be]]*Se[ze]*Se[Ve]*8),Be++}(it<50?Math.floor(5e3/it):Math.floor(200-2*it)),s=it)}this.encode=function(it,Tt){Tt&&xe(Tt),F=new Array,Z=0,U=7,Qt(65496),Qt(65504),Qt(16),Dt(74),Dt(70),Dt(73),Dt(70),Dt(0),Dt(1),Dt(1),Dt(0),Qt(1),Qt(1),Dt(0),Dt(0),function(){Qt(65499),Qt(132),Dt(0);for(var qe=0;qe<64;qe++)Dt(o[qe]);Dt(1);for(var lr=0;lr<64;lr++)Dt(f[lr])}(),function(qe,lr){Qt(65472),Qt(17),Dt(8),Qt(lr),Qt(qe),Dt(3),Dt(1),Dt(17),Dt(0),Dt(2),Dt(17),Dt(1),Dt(3),Dt(17),Dt(1)}(it.width,it.height),function(){Qt(65476),Qt(418),Dt(0);for(var qe=0;qe<16;qe++)Dt(pt[qe+1]);for(var lr=0;lr<=11;lr++)Dt(zt[lr]);Dt(16);for(var Er=0;Er<16;Er++)Dt(Rt[Er+1]);for(var Ir=0;Ir<=161;Ir++)Dt(at[Ir]);Dt(1);for(var Mr=0;Mr<16;Mr++)Dt(dt[Mr+1]);for(var Wr=0;Wr<=11;Wr++)Dt(kt[Wr]);Dt(17);for(var Jr=0;Jr<16;Jr++)Dt(xt[Jr+1]);for(var de=0;de<=161;de++)Dt(ue[de])}(),Qt(65498),Qt(12),Dt(3),Dt(1),Dt(0),Dt(2),Dt(17),Dt(3),Dt(17),Dt(0),Dt(63),Dt(0);var Lt=0,Ut=0,Zt=0;Z=0,U=7,this.encode.displayName="_encode_";for(var Kt,ne,re,Se,Be,ze,Ve,Xe,ge,Bt=it.data,Xt=it.width,ir=it.height,Ie=4*Xt,ve=0;ve<ir;){for(Kt=0;Kt<Ie;){for(Be=Ie*ve+Kt,Ve=-1,Xe=0,ge=0;ge<64;ge++)ze=Be+(Xe=ge>>3)*Ie+(Ve=4*(7&ge)),ve+Xe>=ir&&(ze-=Ie*(ve+1+Xe-ir)),Kt+Ve>=Ie&&(ze-=Kt+Ve-Ie+4),ne=Bt[ze++],re=Bt[ze++],Se=Bt[ze++],z[ge]=(Et[ne]+Et[re+256>>0]+Et[Se+512>>0]>>16)-128,J[ge]=(Et[ne+768>>0]+Et[re+1024>>0]+Et[Se+1280>>0]>>16)-128,nt[ge]=(Et[ne+1280>>0]+Et[re+1536>>0]+Et[Se+1792>>0]>>16)-128;Lt=ee(z,m,Lt,t,i),Ut=ee(J,w,Ut,r,n),Zt=ee(nt,w,Zt,r,n),Kt+=32}ve+=8}if(U>=0){var Ce=[];Ce[1]=U+1,Ce[0]=(1<<U+1)-1,he(Ce)}return Qt(65497),new Uint8Array(F)},e=e||50,function(){for(var it=String.fromCharCode,Tt=0;Tt<256;Tt++)mt[Tt]=it(Tt)}(),t=oe(pt,zt),r=oe(dt,kt),i=oe(Rt,at),n=oe(xt,ue),function(){for(var it=1,Tt=2,Lt=1;Lt<=15;Lt++){for(var Ut=it;Ut<Tt;Ut++)P[32767+Ut]=Lt,A[32767+Ut]=[],A[32767+Ut][1]=Lt,A[32767+Ut][0]=Ut;for(var Zt=-(Tt-1);Zt<=-it;Zt++)P[32767+Zt]=Lt,A[32767+Zt]=[],A[32767+Zt][1]=Lt,A[32767+Zt][0]=Tt-1+Zt;it<<=1,Tt<<=1}}(),function(){for(var it=0;it<256;it++)Et[it]=19595*it,Et[it+256>>0]=38470*it,Et[it+512>>0]=7471*it+32768,Et[it+768>>0]=-11059*it,Et[it+1024>>0]=-21709*it,Et[it+1280>>0]=32768*it+8421375,Et[it+1536>>0]=-27439*it,Et[it+1792>>0]=-5329*it}(),xe(e)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function gc(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function HI(e){function t(pt){if(!pt)throw Error("assert :P")}function r(pt,zt,Rt){for(var at=0;4>at;at++)if(pt[zt+at]!=Rt.charCodeAt(at))return!0;return!1}function i(pt,zt,Rt,at,dt){for(var kt=0;kt<dt;kt++)pt[zt+kt]=Rt[at+kt]}function n(pt,zt,Rt,at){for(var dt=0;dt<at;dt++)pt[zt+dt]=Rt}function s(pt){return new Int32Array(pt)}function a(pt,zt){for(var Rt=[],at=0;at<pt;at++)Rt.push(new zt);return Rt}function o(pt,zt){var Rt=[];return function at(dt,kt,xt){for(var ue=xt[kt],oe=0;oe<ue&&(dt.push(xt.length>kt+1?[]:new zt),!(xt.length<kt+1));oe++)at(dt[oe],kt+1,xt)}(Rt,0,pt),Rt}var f=function(){var pt=this;function zt(g,b){for(var C=1<<b-1>>>0;g&C;)C>>>=1;return C?(g&C-1)+C:g}function Rt(g,b,C,M,O){t(!(M%C));do g[b+(M-=C)]=O;while(0<M)}function at(g,b,C,M,O){if(t(2328>=O),512>=O)var j=s(512);else if((j=s(O))==null)return 0;return function(G,H,q,X,ct,et){var ht,ft,Mt=H,St=1<<q,gt=s(16),yt=s(16);for(t(ct!=0),t(X!=null),t(G!=null),t(0<q),ft=0;ft<ct;++ft){if(15<X[ft])return 0;++gt[X[ft]]}if(gt[0]==ct)return 0;for(yt[1]=0,ht=1;15>ht;++ht){if(gt[ht]>1<<ht)return 0;yt[ht+1]=yt[ht]+gt[ht]}for(ft=0;ft<ct;++ft)ht=X[ft],0<X[ft]&&(et[yt[ht]++]=ft);if(yt[15]==1)return(X=new dt).g=0,X.value=et[0],Rt(G,Mt,1,St,X),St;var Vt,$t=-1,ae=St-1,le=0,me=1,Le=1,we=1<<q;for(ft=0,ht=1,ct=2;ht<=q;++ht,ct<<=1){if(me+=Le<<=1,0>(Le-=gt[ht]))return 0;for(;0<gt[ht];--gt[ht])(X=new dt).g=ht,X.value=et[ft++],Rt(G,Mt+le,ct,we,X),le=zt(le,ht)}for(ht=q+1,ct=2;15>=ht;++ht,ct<<=1){if(me+=Le<<=1,0>(Le-=gt[ht]))return 0;for(;0<gt[ht];--gt[ht]){if(X=new dt,(le&ae)!=$t){for(Mt+=we,Vt=1<<($t=ht)-q;15>$t&&!(0>=(Vt-=gt[$t]));)++$t,Vt<<=1;St+=we=1<<(Vt=$t-q),G[H+($t=le&ae)].g=Vt+q,G[H+$t].value=Mt-H-$t}X.g=ht-q,X.value=et[ft++],Rt(G,Mt+(le>>q),ct,we,X),le=zt(le,ht)}}return me!=2*yt[15]-1?0:St}(g,b,C,M,O,j)}function dt(){this.value=this.g=0}function kt(){this.value=this.g=0}function xt(){this.G=a(5,dt),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=a(Xn,kt)}function ue(g,b,C,M){t(g!=null),t(b!=null),t(2147483648>M),g.Ca=254,g.I=0,g.b=-8,g.Ka=0,g.oa=b,g.pa=C,g.Jd=b,g.Yc=C+M,g.Zc=4<=M?C+M-4+1:C,Kt(g)}function oe(g,b){for(var C=0;0<b--;)C|=re(g,128)<<b;return C}function he(g,b){var C=oe(g,b);return ne(g)?-C:C}function Dt(g,b,C,M){var O,j=0;for(t(g!=null),t(b!=null),t(4294967288>M),g.Sb=M,g.Ra=0,g.u=0,g.h=0,4<M&&(M=4),O=0;O<M;++O)j+=b[C+O]<<8*O;g.Ra=j,g.bb=M,g.oa=b,g.pa=C}function Qt(g){for(;8<=g.u&&g.bb<g.Sb;)g.Ra>>>=8,g.Ra+=g.oa[g.pa+g.bb]<<Zl-8>>>0,++g.bb,g.u-=8;Lt(g)&&(g.h=1,g.u=0)}function ee(g,b){if(t(0<=b),!g.h&&b<=$l){var C=Tt(g)&hl[b];return g.u+=b,Qt(g),C}return g.h=1,g.u=0}function xe(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function it(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Tt(g){return g.Ra>>>(g.u&Zl-1)>>>0}function Lt(g){return t(g.bb<=g.Sb),g.h||g.bb==g.Sb&&g.u>Zl}function Ut(g,b){g.u=b,g.h=Lt(g)}function Zt(g){g.u>=dl&&(t(g.u>=dl),Qt(g))}function Kt(g){t(g!=null&&g.oa!=null),g.pa<g.Zc?(g.I=(g.oa[g.pa++]|g.I<<8)>>>0,g.b+=8):(t(g!=null&&g.oa!=null),g.pa<g.Yc?(g.b+=8,g.I=g.oa[g.pa++]|g.I<<8):g.Ka?g.b=0:(g.I<<=8,g.b+=8,g.Ka=1))}function ne(g){return oe(g,1)}function re(g,b){var C=g.Ca;0>g.b&&Kt(g);var M=g.b,O=C*b>>>8,j=(g.I>>>M>O)+0;for(j?(C-=O,g.I-=O+1<<M>>>0):C=O+1,M=C,O=0;256<=M;)O+=8,M>>=8;return M=7^O+ls[M],g.b-=M,g.Ca=(C<<M)-1,j}function Se(g,b,C){g[b+0]=C>>24&255,g[b+1]=C>>16&255,g[b+2]=C>>8&255,g[b+3]=C>>0&255}function Be(g,b){return g[b+0]<<0|g[b+1]<<8}function ze(g,b){return Be(g,b)|g[b+2]<<16}function Ve(g,b){return Be(g,b)|Be(g,b+2)<<16}function Xe(g,b){var C=1<<b;return t(g!=null),t(0<b),g.X=s(C),g.X==null?0:(g.Mb=32-b,g.Xa=b,1)}function ge(g,b){t(g!=null),t(b!=null),t(g.Xa==b.Xa),i(b.X,0,g.X,0,1<<b.Xa)}function Bt(){this.X=[],this.Xa=this.Mb=0}function Xt(g,b,C,M){t(C!=null),t(M!=null);var O=C[0],j=M[0];return O==0&&(O=(g*j+b/2)/b),j==0&&(j=(b*O+g/2)/g),0>=O||0>=j?0:(C[0]=O,M[0]=j,1)}function ir(g,b){return g+(1<<b)-1>>>b}function Ie(g,b){return((4278255360&g)+(4278255360&b)>>>0&4278255360)+((16711935&g)+(16711935&b)>>>0&16711935)>>>0}function ve(g,b){pt[b]=function(C,M,O,j,G,H,q){var X;for(X=0;X<G;++X){var ct=pt[g](H[q+X-1],O,j+X);H[q+X]=Ie(C[M+X],ct)}}}function Ce(){this.ud=this.hd=this.jd=0}function qe(g,b){return((4278124286&(g^b))>>>1)+(g&b)>>>0}function lr(g){return 0<=g&&256>g?g:0>g?0:255<g?255:void 0}function Er(g,b){return lr(g+(g-b+.5>>1))}function Ir(g,b,C){return Math.abs(b-C)-Math.abs(g-C)}function Mr(g,b,C,M,O,j,G){for(M=j[G-1],C=0;C<O;++C)j[G+C]=M=Ie(g[b+C],M)}function Wr(g,b,C,M,O){var j;for(j=0;j<C;++j){var G=g[b+j],H=G>>8&255,q=16711935&(q=(q=16711935&G)+((H<<16)+H));M[O+j]=(4278255360&G)+q>>>0}}function Jr(g,b){b.jd=g>>0&255,b.hd=g>>8&255,b.ud=g>>16&255}function de(g,b,C,M,O,j){var G;for(G=0;G<M;++G){var H=b[C+G],q=H>>>8,X=H,ct=255&(ct=(ct=H>>>16)+((g.jd<<24>>24)*(q<<24>>24)>>>5));X=255&(X=(X=X+((g.hd<<24>>24)*(q<<24>>24)>>>5))+((g.ud<<24>>24)*(ct<<24>>24)>>>5)),O[j+G]=(4278255360&H)+(ct<<16)+X}}function Tr(g,b,C,M,O){pt[b]=function(j,G,H,q,X,ct,et,ht,ft){for(q=et;q<ht;++q)for(et=0;et<ft;++et)X[ct++]=O(H[M(j[G++])])},pt[g]=function(j,G,H,q,X,ct,et){var ht=8>>j.b,ft=j.Ea,Mt=j.K[0],St=j.w;if(8>ht)for(j=(1<<j.b)-1,St=(1<<ht)-1;G<H;++G){var gt,yt=0;for(gt=0;gt<ft;++gt)gt&j||(yt=M(q[X++])),ct[et++]=O(Mt[yt&St]),yt>>=ht}else pt["VP8LMapColor"+C](q,X,Mt,St,ct,et,G,H,ft)}}function Re(g,b,C,M,O){for(C=b+C;b<C;){var j=g[b++];M[O++]=j>>16&255,M[O++]=j>>8&255,M[O++]=j>>0&255}}function Hi(g,b,C,M,O){for(C=b+C;b<C;){var j=g[b++];M[O++]=j>>16&255,M[O++]=j>>8&255,M[O++]=j>>0&255,M[O++]=j>>24&255}}function Pr(g,b,C,M,O){for(C=b+C;b<C;){var j=(G=g[b++])>>16&240|G>>12&15,G=G>>0&240|G>>28&15;M[O++]=j,M[O++]=G}}function Pe(g,b,C,M,O){for(C=b+C;b<C;){var j=(G=g[b++])>>16&248|G>>13&7,G=G>>5&224|G>>3&31;M[O++]=j,M[O++]=G}}function Ye(g,b,C,M,O){for(C=b+C;b<C;){var j=g[b++];M[O++]=j>>0&255,M[O++]=j>>8&255,M[O++]=j>>16&255}}function tr(g,b,C,M,O,j){if(j==0)for(C=b+C;b<C;)Se(M,((j=g[b++])[0]>>24|j[1]>>8&65280|j[2]<<8&16711680|j[3]<<24)>>>0),O+=32;else i(M,O,g,b,C)}function fi(g,b){pt[b][0]=pt[g+"0"],pt[b][1]=pt[g+"1"],pt[b][2]=pt[g+"2"],pt[b][3]=pt[g+"3"],pt[b][4]=pt[g+"4"],pt[b][5]=pt[g+"5"],pt[b][6]=pt[g+"6"],pt[b][7]=pt[g+"7"],pt[b][8]=pt[g+"8"],pt[b][9]=pt[g+"9"],pt[b][10]=pt[g+"10"],pt[b][11]=pt[g+"11"],pt[b][12]=pt[g+"12"],pt[b][13]=pt[g+"13"],pt[b][14]=pt[g+"0"],pt[b][15]=pt[g+"0"]}function Fr(g){return g==Mi||g==Ql||g==tc||g==Iu}function wr(){this.eb=[],this.size=this.A=this.fb=0}function bi(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function ai(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new wr,this.f.kb=new bi,this.sd=null}function At(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Y(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Q(g){return alert("todo:WebPSamplerProcessPlane"),g.T}function ot(g,b){var C=g.T,M=b.ba.f.RGBA,O=M.eb,j=M.fb+g.ka*M.A,G=gs[b.ba.S],H=g.y,q=g.O,X=g.f,ct=g.N,et=g.ea,ht=g.W,ft=b.cc,Mt=b.dc,St=b.Mc,gt=b.Nc,yt=g.ka,Vt=g.ka+g.T,$t=g.U,ae=$t+1>>1;for(yt==0?G(H,q,null,null,X,ct,et,ht,X,ct,et,ht,O,j,null,null,$t):(G(b.ec,b.fc,H,q,ft,Mt,St,gt,X,ct,et,ht,O,j-M.A,O,j,$t),++C);yt+2<Vt;yt+=2)ft=X,Mt=ct,St=et,gt=ht,ct+=g.Rc,ht+=g.Rc,j+=2*M.A,G(H,(q+=2*g.fa)-g.fa,H,q,ft,Mt,St,gt,X,ct,et,ht,O,j-M.A,O,j,$t);return q+=g.fa,g.j+Vt<g.o?(i(b.ec,b.fc,H,q,$t),i(b.cc,b.dc,X,ct,ae),i(b.Mc,b.Nc,et,ht,ae),C--):1&Vt||G(H,q,null,null,X,ct,et,ht,X,ct,et,ht,O,j+M.A,null,null,$t),C}function wt(g,b,C){var M=g.F,O=[g.J];if(M!=null){var j=g.U,G=b.ba.S,H=G==Pu||G==tc;b=b.ba.f.RGBA;var q=[0],X=g.ka;q[0]=g.T,g.Kb&&(X==0?--q[0]:(--X,O[0]-=g.width),g.j+g.ka+g.T==g.o&&(q[0]=g.o-g.j-X));var ct=b.eb;X=b.fb+X*b.A,g=La(M,O[0],g.width,j,q,ct,X+(H?0:3),b.A),t(C==q),g&&Fr(G)&&la(ct,X,H,j,q,b.A)}return 0}function Nt(g){var b=g.ma,C=b.ba.S,M=11>C,O=C==Kl||C==Yl||C==Pu||C==Ld||C==12||Fr(C);if(b.memory=null,b.Ib=null,b.Jb=null,b.Nd=null,!ul(b.Oa,g,O?11:12))return 0;if(O&&Fr(C)&&Me(),g.da)alert("todo:use_scaling");else{if(M){if(b.Ib=Q,g.Kb){if(C=g.U+1>>1,b.memory=s(g.U+2*C),b.memory==null)return 0;b.ec=b.memory,b.fc=0,b.cc=b.ec,b.dc=b.fc+g.U,b.Mc=b.cc,b.Nc=b.dc+C,b.Ib=ot,Me()}}else alert("todo:EmitYUV");O&&(b.Jb=wt,M&&te())}if(M&&!Sh){for(g=0;256>g;++g)Fd[g]=89858*(g-128)+ka>>rc,x[g]=-22014*(g-128)+ka,zf[g]=-45773*(g-128),Eh[g]=113618*(g-128)+ka>>rc;for(g=jo;g<$c;++g)b=76283*(g-16)+ka>>rc,c[g-jo]=Es(b,255),d[g-jo]=Es(b+8>>4,15);Sh=1}return 1}function Gt(g){var b=g.ma,C=g.U,M=g.T;return t(!(1&g.ka)),0>=C||0>=M?0:(C=b.Ib(g,b),b.Jb!=null&&b.Jb(g,b,C),b.Dc+=C,1)}function Ht(g){g.ma.memory=null}function Ct(g,b,C,M){return ee(g,8)!=47?0:(b[0]=ee(g,14)+1,C[0]=ee(g,14)+1,M[0]=ee(g,1),ee(g,3)!=0?0:!g.h)}function Jt(g,b){if(4>g)return g+1;var C=g-2>>1;return(2+(1&g)<<C)+ee(b,C)+1}function ye(g,b){return 120<b?b-120:1<=(C=((C=or[b-1])>>4)*g+(8-(15&C)))?C:1;var C}function fe(g,b,C){var M=Tt(C),O=g[b+=255&M].g-8;return 0<O&&(Ut(C,C.u+8),M=Tt(C),b+=g[b].value,b+=M&(1<<O)-1),Ut(C,C.u+g[b].g),g[b].value}function ce(g,b,C){return C.g+=g.g,C.value+=g.value<<b>>>0,t(8>=C.g),g.g}function He(g,b,C){var M=g.xc;return t((b=M==0?0:g.vc[g.md*(C>>M)+(b>>M)])<g.Wb),g.Ya[b]}function Ze(g,b,C,M){var O=g.ab,j=g.c*b,G=g.C;b=G+b;var H=C,q=M;for(M=g.Ta,C=g.Ua;0<O--;){var X=g.gc[O],ct=G,et=b,ht=H,ft=q,Mt=(q=M,H=C,X.Ea);switch(t(ct<et),t(et<=X.nc),X.hc){case 2:Oi(ht,ft,(et-ct)*Mt,q,H);break;case 0:var St=ct,gt=et,yt=q,Vt=H,$t=(we=X).Ea;St==0&&(Md(ht,ft,null,null,1,yt,Vt),Mr(ht,ft+1,0,0,$t-1,yt,Vt+1),ft+=$t,Vt+=$t,++St);for(var ae=1<<we.b,le=ae-1,me=ir($t,we.b),Le=we.K,we=we.w+(St>>we.b)*me;St<gt;){var Ue=Le,Ke=we,Je=1;for(Gc(ht,ft,yt,Vt-$t,1,yt,Vt);Je<$t;){var vr=(Je&~le)+ae;vr>$t&&(vr=$t),(0,Pa[Ue[Ke++]>>8&15])(ht,ft+ +Je,yt,Vt+Je-$t,vr-Je,yt,Vt+Je),Je=vr}ft+=$t,Vt+=$t,++St&le||(we+=me)}et!=X.nc&&i(q,H-Mt,q,H+(et-ct-1)*Mt,Mt);break;case 1:for(Mt=ht,gt=ft,$t=(ht=X.Ea)-(Vt=ht&~(yt=(ft=1<<X.b)-1)),St=ir(ht,X.b),ae=X.K,X=X.w+(ct>>X.b)*St;ct<et;){for(le=ae,me=X,Le=new Ce,we=gt+Vt,Ue=gt+ht;gt<we;)Jr(le[me++],Le),Tn(Le,Mt,gt,ft,q,H),gt+=ft,H+=ft;gt<Ue&&(Jr(le[me++],Le),Tn(Le,Mt,gt,$t,q,H),gt+=$t,H+=$t),++ct&yt||(X+=St)}break;case 3:if(ht==q&&ft==H&&0<X.b){for(gt=q,ht=Mt=H+(et-ct)*Mt-(Vt=(et-ct)*ir(X.Ea,X.b)),ft=q,yt=H,St=[],Vt=($t=Vt)-1;0<=Vt;--Vt)St[Vt]=ft[yt+Vt];for(Vt=$t-1;0<=Vt;--Vt)gt[ht+Vt]=St[Vt];Dn(X,ct,et,q,Mt,q,H)}else Dn(X,ct,et,ht,ft,q,H)}H=M,q=C}q!=C&&i(M,C,H,q,j)}function xr(g,b){var C=g.V,M=g.Ba+g.c*g.C,O=b-g.C;if(t(b<=g.l.o),t(16>=O),0<O){var j=g.l,G=g.Ta,H=g.Ua,q=j.width;if(Ze(g,O,C,M),O=H=[H],t((C=g.C)<(M=b)),t(j.v<j.va),M>j.o&&(M=j.o),C<j.j){var X=j.j-C;C=j.j,O[0]+=X*q}if(C>=M?C=0:(O[0]+=4*j.v,j.ka=C-j.j,j.U=j.va-j.v,j.T=M-C,C=1),C){if(H=H[0],11>(C=g.ca).S){var ct=C.f.RGBA,et=(M=C.S,O=j.U,j=j.T,X=ct.eb,ct.A),ht=j;for(ct=ct.fb+g.Ma*ct.A;0<ht--;){var ft=G,Mt=H,St=O,gt=X,yt=ct;switch(M){case Tu:Nn(ft,Mt,St,gt,yt);break;case Kl:Gs(ft,Mt,St,gt,yt);break;case Mi:Gs(ft,Mt,St,gt,yt),la(gt,yt,0,St,1,0);break;case wh:fl(ft,Mt,St,gt,yt);break;case Yl:tr(ft,Mt,St,gt,yt,1);break;case Ql:tr(ft,Mt,St,gt,yt,1),la(gt,yt,0,St,1,0);break;case Pu:tr(ft,Mt,St,gt,yt,0);break;case tc:tr(ft,Mt,St,gt,yt,0),la(gt,yt,1,St,1,0);break;case Ld:ro(ft,Mt,St,gt,yt);break;case Iu:ro(ft,Mt,St,gt,yt),qc(gt,yt,St,1,0);break;case Ba:io(ft,Mt,St,gt,yt);break;default:t(0)}H+=q,ct+=et}g.Ma+=j}else alert("todo:EmitRescaledRowsYUVA");t(g.Ma<=C.height)}}g.C=b,t(g.C<=g.i)}function sr(g){var b;if(0<g.ua)return 0;for(b=0;b<g.Wb;++b){var C=g.Ya[b].G,M=g.Ya[b].H;if(0<C[1][M[1]+0].g||0<C[2][M[2]+0].g||0<C[3][M[3]+0].g)return 0}return 1}function Cr(g,b,C,M,O,j){if(g.Z!=0){var G=g.qd,H=g.rd;for(t(oo[g.Z]!=null);b<C;++b)oo[g.Z](G,H,M,O,M,O,j),G=M,H=O,O+=j;g.qd=G,g.rd=H}}function zr(g,b){var C=g.l.ma,M=C.Z==0||C.Z==1?g.l.j:g.C;if(M=g.C<M?M:g.C,t(b<=g.l.o),b>M){var O=g.l.width,j=C.ca,G=C.tb+O*M,H=g.V,q=g.Ba+g.c*M,X=g.gc;t(g.ab==1),t(X[0].hc==3),Eu(X[0],M,b,H,q,j,G),Cr(C,M,b,j,G,O)}g.C=g.Ma=b}function $r(g,b,C,M,O,j,G){var H=g.$/M,q=g.$%M,X=g.m,ct=g.s,et=C+g.$,ht=et;O=C+M*O;var ft=C+M*j,Mt=280+ct.ua,St=g.Pb?H:16777216,gt=0<ct.ua?ct.Wa:null,yt=ct.wc,Vt=et<ft?He(ct,q,H):null;t(g.C<j),t(ft<=O);var $t=!1;t:for(;;){for(;$t||et<ft;){var ae=0;if(H>=St){var le=et-C;t((St=g).Pb),St.wd=St.m,St.xd=le,0<St.s.ua&&ge(St.s.Wa,St.s.vb),St=H+xh}if(q&yt||(Vt=He(ct,q,H)),t(Vt!=null),Vt.Qb&&(b[et]=Vt.qb,$t=!0),!$t)if(Zt(X),Vt.jc){ae=X,le=b;var me=et,Le=Vt.pd[Tt(ae)&Xn-1];t(Vt.jc),256>Le.g?(Ut(ae,ae.u+Le.g),le[me]=Le.value,ae=0):(Ut(ae,ae.u+Le.g-256),t(256<=Le.value),ae=Le.value),ae==0&&($t=!0)}else ae=fe(Vt.G[0],Vt.H[0],X);if(X.h)break;if($t||256>ae){if(!$t)if(Vt.nd)b[et]=(Vt.qb|ae<<8)>>>0;else{if(Zt(X),$t=fe(Vt.G[1],Vt.H[1],X),Zt(X),le=fe(Vt.G[2],Vt.H[2],X),me=fe(Vt.G[3],Vt.H[3],X),X.h)break;b[et]=(me<<24|$t<<16|ae<<8|le)>>>0}if($t=!1,++et,++q>=M&&(q=0,++H,G!=null&&H<=j&&!(H%16)&&G(g,H),gt!=null))for(;ht<et;)ae=b[ht++],gt.X[(506832829*ae&4294967295)>>>gt.Mb]=ae}else if(280>ae){if(ae=Jt(ae-256,X),le=fe(Vt.G[4],Vt.H[4],X),Zt(X),le=ye(M,le=Jt(le,X)),X.h)break;if(et-C<le||O-et<ae)break t;for(me=0;me<ae;++me)b[et+me]=b[et+me-le];for(et+=ae,q+=ae;q>=M;)q-=M,++H,G!=null&&H<=j&&!(H%16)&&G(g,H);if(t(et<=O),q&yt&&(Vt=He(ct,q,H)),gt!=null)for(;ht<et;)ae=b[ht++],gt.X[(506832829*ae&4294967295)>>>gt.Mb]=ae}else{if(!(ae<Mt))break t;for($t=ae-280,t(gt!=null);ht<et;)ae=b[ht++],gt.X[(506832829*ae&4294967295)>>>gt.Mb]=ae;ae=et,t(!($t>>>(le=gt).Xa)),b[ae]=le.X[$t],$t=!0}$t||t(X.h==Lt(X))}if(g.Pb&&X.h&&et<O)t(g.m.h),g.a=5,g.m=g.wd,g.$=g.xd,0<g.s.ua&&ge(g.s.vb,g.s.Wa);else{if(X.h)break t;G!=null&&G(g,H>j?j:H),g.a=0,g.$=et-C}return 1}return g.a=3,0}function li(g){t(g!=null),g.vc=null,g.yc=null,g.Ya=null;var b=g.Wa;b!=null&&(b.X=null),g.vb=null,t(g!=null)}function ur(){var g=new Su;return g==null?null:(g.a=0,g.xb=Ah,fi("Predictor","VP8LPredictors"),fi("Predictor","VP8LPredictors_C"),fi("PredictorAdd","VP8LPredictorsAdd"),fi("PredictorAdd","VP8LPredictorsAdd_C"),Oi=Wr,Tn=de,Nn=Re,Gs=Hi,ro=Pr,io=Pe,fl=Ye,pt.VP8LMapColor32b=Cn,pt.VP8LMapColor8b=Vc,g)}function Gr(g,b,C,M,O){var j=1,G=[g],H=[b],q=M.m,X=M.s,ct=null,et=0;t:for(;;){if(C)for(;j&&ee(q,1);){var ht=G,ft=H,Mt=M,St=1,gt=Mt.m,yt=Mt.gc[Mt.ab],Vt=ee(gt,2);if(Mt.Oc&1<<Vt)j=0;else{switch(Mt.Oc|=1<<Vt,yt.hc=Vt,yt.Ea=ht[0],yt.nc=ft[0],yt.K=[null],++Mt.ab,t(4>=Mt.ab),Vt){case 0:case 1:yt.b=ee(gt,3)+2,St=Gr(ir(yt.Ea,yt.b),ir(yt.nc,yt.b),0,Mt,yt.K),yt.K=yt.K[0];break;case 3:var $t,ae=ee(gt,8)+1,le=16<ae?0:4<ae?1:2<ae?2:3;if(ht[0]=ir(yt.Ea,le),yt.b=le,$t=St=Gr(ae,1,0,Mt,yt.K)){var me,Le=ae,we=yt,Ue=1<<(8>>we.b),Ke=s(Ue);if(Ke==null)$t=0;else{var Je=we.K[0],vr=we.w;for(Ke[0]=we.K[0][0],me=1;me<1*Le;++me)Ke[me]=Ie(Je[vr+me],Ke[me-1]);for(;me<4*Ue;++me)Ke[me]=0;we.K[0]=null,we.K[0]=Ke,$t=1}}St=$t;break;case 2:break;default:t(0)}j=St}}if(G=G[0],H=H[0],j&&ee(q,1)&&!(j=1<=(et=ee(q,4))&&11>=et)){M.a=3;break t}var br;if(br=j)e:{var Vr,gr,Ur,ci=M,ui=G,en=H,ti=et,Kn=C,bn=ci.m,Li=ci.s,ei=[null],Zr=1,ri=0,pn=pr[ti];r:for(;;){if(Kn&&ee(bn,1)){var Yr=ee(bn,3)+2,hi=ir(ui,Yr),jn=ir(en,Yr),Ui=hi*jn;if(!Gr(hi,jn,0,ci,ei))break r;for(ei=ei[0],Li.xc=Yr,Vr=0;Vr<Ui;++Vr){var Ai=ei[Vr]>>8&65535;ei[Vr]=Ai,Ai>=Zr&&(Zr=Ai+1)}}if(bn.h)break r;for(gr=0;5>gr;++gr){var Ji=Bd[gr];!gr&&0<ti&&(Ji+=1<<ti),ri<Ji&&(ri=Ji)}var Ch=a(Zr*pn,dt),gl=Zr,ml=a(gl,xt);if(ml==null)var nc=null;else t(65536>=gl),nc=ml;var ao=s(ri);if(nc==null||ao==null||Ch==null){ci.a=1;break r}var Zc=Ch;for(Vr=Ur=0;Vr<Zr;++Vr){var lo=nc[Vr],yl=lo.G,_l=lo.H,Nu=0,Jc=1,jf=0;for(gr=0;5>gr;++gr){Ji=Bd[gr],yl[gr]=Zc,_l[gr]=Ur,!gr&&0<ti&&(Ji+=1<<ti);n:{var zd,Uf=Ji,sc=ci,jd=ao,Ud=Zc,Gf=Ur,Th=0,oc=sc.m,G0=ee(oc,1);if(n(jd,0,0,Uf),G0){var bv=ee(oc,1)+1,Ps=ee(oc,1),Fu=ee(oc,Ps==0?1:8);jd[Fu]=1,bv==2&&(jd[Fu=ee(oc,8)]=1);var Ph=1}else{var Cg=s(19),Ih=ee(oc,4)+4;if(19<Ih){sc.a=3;var Vf=0;break n}for(zd=0;zd<Ih;++zd)Cg[Mu[zd]]=ee(oc,3);var Mh=void 0,Gd=void 0,Tg=sc,V0=Cg,Vd=Uf,q0=jd,qd=0,ac=Tg.m,qf=8,Lh=a(128,dt);i:for(;at(Lh,0,7,V0,19);){if(ee(ac,1)){var Uo=2+2*ee(ac,3);if((Mh=2+ee(ac,Uo))>Vd)break i}else Mh=Vd;for(Gd=0;Gd<Vd&&Mh--;){Zt(ac);var Pg=Lh[0+(127&Tt(ac))];Ut(ac,ac.u+Pg.g);var Bh=Pg.value;if(16>Bh)q0[Gd++]=Bh,Bh!=0&&(qf=Bh);else{var H0=Bh==16,W0=Bh-16,wv=Nf[W0],$0=ee(ac,Df[W0])+wv;if(Gd+$0>Vd)break i;for(var xv=H0?qf:0;0<$0--;)q0[Gd++]=xv}}qd=1;break i}qd||(Tg.a=3),Ph=qd}(Ph=Ph&&!oc.h)&&(Th=at(Ud,Gf,8,jd,Uf)),Ph&&Th!=0?Vf=Th:(sc.a=3,Vf=0)}if(Vf==0)break r;if(Jc&&No[gr]==1&&(Jc=Zc[Ur].g==0),Nu+=Zc[Ur].g,Ur+=Vf,3>=gr){var zu,kh=ao[0];for(zu=1;zu<Ji;++zu)ao[zu]>kh&&(kh=ao[zu]);jf+=kh}}if(lo.nd=Jc,lo.Qb=0,Jc&&(lo.qb=(yl[3][_l[3]+0].value<<24|yl[1][_l[1]+0].value<<16|yl[2][_l[2]+0].value)>>>0,Nu==0&&256>yl[0][_l[0]+0].value&&(lo.Qb=1,lo.qb+=yl[0][_l[0]+0].value<<8)),lo.jc=!lo.Qb&&6>jf,lo.jc){var Hd,Hs=lo;for(Hd=0;Hd<Xn;++Hd){var ua=Hd,Xc=Hs.pd[ua],Hf=Hs.G[0][Hs.H[0]+ua];256<=Hf.value?(Xc.g=Hf.g+256,Xc.value=Hf.value):(Xc.g=0,Xc.value=0,ua>>=ce(Hf,8,Xc),ua>>=ce(Hs.G[1][Hs.H[1]+ua],16,Xc),ua>>=ce(Hs.G[2][Hs.H[2]+ua],0,Xc),ce(Hs.G[3][Hs.H[3]+ua],24,Xc))}}}Li.vc=ei,Li.Wb=Zr,Li.Ya=nc,Li.yc=Ch,br=1;break e}br=0}if(!(j=br)){M.a=3;break t}if(0<et){if(X.ua=1<<et,!Xe(X.Wa,et)){M.a=1,j=0;break t}}else X.ua=0;var Ig=M,Z0=G,Av=H,Mg=Ig.s,Lg=Mg.xc;if(Ig.c=Z0,Ig.i=Av,Mg.md=ir(Z0,Lg),Mg.wc=Lg==0?-1:(1<<Lg)-1,C){M.xb=Od;break t}if((ct=s(G*H))==null){M.a=1,j=0;break t}j=(j=$r(M,ct,0,G,H,H,null))&&!q.h;break t}return j?(O!=null?O[0]=ct:(t(ct==null),t(C)),M.$=0,C||li(X)):li(X),j}function pi(g,b){var C=g.c*g.i,M=C+b+16*b;return t(g.c<=b),g.V=s(M),g.V==null?(g.Ta=null,g.Ua=0,g.a=1,0):(g.Ta=g.V,g.Ua=g.Ba+C+b,1)}function Ri(g,b){var C=g.C,M=b-C,O=g.V,j=g.Ba+g.c*C;for(t(b<=g.l.o);0<M;){var G=16<M?16:M,H=g.l.ma,q=g.l.width,X=q*G,ct=H.ca,et=H.tb+q*C,ht=g.Ta,ft=g.Ua;Ze(g,G,O,j),Hc(ht,ft,ct,et,X),Cr(H,C,C+G,ct,et,q),M-=G,O+=G*g.c,C+=G}t(C==b),g.C=g.Ma=b}function Wi(){this.ub=this.yd=this.td=this.Rb=0}function Ii(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Zn(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function Nl(){this.Yb=function(){var g=[];return function b(C,M,O){for(var j=O[M],G=0;G<j&&(C.push(O.length>M+1?[]:0),!(O.length<M+1));G++)b(C[G],M+1,O)}(g,0,[3,11]),g}()}function Qa(){this.jb=s(3),this.Wc=o([4,8],Nl),this.Xc=o([4,17],Nl)}function Rr(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function ds(){this.ld=this.La=this.dd=this.tc=0}function fs(){this.Na=this.la=0}function Ni(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function $i(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function On(){this.uc=this.M=this.Nb=0,this.wa=Array(new ds),this.Y=0,this.ya=Array(new $i),this.aa=0,this.l=new xs}function Fi(){this.y=s(16),this.f=s(8),this.ea=s(8)}function Jn(){this.cb=this.a=0,this.sc="",this.m=new xe,this.Od=new Wi,this.Kc=new Ii,this.ed=new Rr,this.Qa=new Zn,this.Ic=this.$c=this.Aa=0,this.D=new On,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=a(8,xe),this.ia=0,this.pb=a(4,Ni),this.Pa=new Qa,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Fi),this.Hd=0,this.rb=Array(new fs),this.sb=0,this.wa=Array(new ds),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new $i),this.L=this.aa=0,this.gd=o([4,2],ds),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function xs(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function To(){var g=new Jn;return g!=null&&(g.a=0,g.sc="OK",g.cb=0,g.Xb=0,zn||(zn=gi)),g}function Sr(g,b,C){return g.a==0&&(g.a=b,g.sc=C,g.cb=0),0}function js(g,b,C){return 3<=C&&g[b+0]==157&&g[b+1]==1&&g[b+2]==42}function ps(g,b){if(g==null)return 0;if(g.a=0,g.sc="OK",b==null)return Sr(g,2,"null VP8Io passed to VP8GetHeaders()");var C=b.data,M=b.w,O=b.ha;if(4>O)return Sr(g,7,"Truncated header.");var j=C[M+0]|C[M+1]<<8|C[M+2]<<16,G=g.Od;if(G.Rb=!(1&j),G.td=j>>1&7,G.yd=j>>4&1,G.ub=j>>5,3<G.td)return Sr(g,3,"Incorrect keyframe parameters.");if(!G.yd)return Sr(g,4,"Frame not displayable.");M+=3,O-=3;var H=g.Kc;if(G.Rb){if(7>O)return Sr(g,7,"cannot parse picture header");if(!js(C,M,O))return Sr(g,3,"Bad code word");H.c=16383&(C[M+4]<<8|C[M+3]),H.Td=C[M+4]>>6,H.i=16383&(C[M+6]<<8|C[M+5]),H.Ud=C[M+6]>>6,M+=7,O-=7,g.za=H.c+15>>4,g.Ub=H.i+15>>4,b.width=H.c,b.height=H.i,b.Da=0,b.j=0,b.v=0,b.va=b.width,b.o=b.height,b.da=0,b.ib=b.width,b.hb=b.height,b.U=b.width,b.T=b.height,n((j=g.Pa).jb,0,255,j.jb.length),t((j=g.Qa)!=null),j.Cb=0,j.Bb=0,j.Fb=1,n(j.Zb,0,0,j.Zb.length),n(j.Lb,0,0,j.Lb)}if(G.ub>O)return Sr(g,7,"bad partition length");ue(j=g.m,C,M,G.ub),M+=G.ub,O-=G.ub,G.Rb&&(H.Ld=ne(j),H.Kd=ne(j)),H=g.Qa;var q,X=g.Pa;if(t(j!=null),t(H!=null),H.Cb=ne(j),H.Cb){if(H.Bb=ne(j),ne(j)){for(H.Fb=ne(j),q=0;4>q;++q)H.Zb[q]=ne(j)?he(j,7):0;for(q=0;4>q;++q)H.Lb[q]=ne(j)?he(j,6):0}if(H.Bb)for(q=0;3>q;++q)X.jb[q]=ne(j)?oe(j,8):255}else H.Bb=0;if(j.Ka)return Sr(g,3,"cannot parse segment header");if((H=g.ed).zd=ne(j),H.Tb=oe(j,6),H.wb=oe(j,3),H.Pc=ne(j),H.Pc&&ne(j)){for(X=0;4>X;++X)ne(j)&&(H.vd[X]=he(j,6));for(X=0;4>X;++X)ne(j)&&(H.od[X]=he(j,6))}if(g.L=H.Tb==0?0:H.zd?1:2,j.Ka)return Sr(g,3,"cannot parse filter header");var ct=O;if(O=q=M,M=q+ct,H=ct,g.Xb=(1<<oe(g.m,2))-1,ct<3*(X=g.Xb))C=7;else{for(q+=3*X,H-=3*X,ct=0;ct<X;++ct){var et=C[O+0]|C[O+1]<<8|C[O+2]<<16;et>H&&(et=H),ue(g.Jc[+ct],C,q,et),q+=et,H-=et,O+=3}ue(g.Jc[+X],C,q,H),C=q<M?0:5}if(C!=0)return Sr(g,C,"cannot parse partitions");for(C=oe(q=g.m,7),O=ne(q)?he(q,4):0,M=ne(q)?he(q,4):0,H=ne(q)?he(q,4):0,X=ne(q)?he(q,4):0,q=ne(q)?he(q,4):0,ct=g.Qa,et=0;4>et;++et){if(ct.Cb){var ht=ct.Zb[et];ct.Fb||(ht+=C)}else{if(0<et){g.pb[et]=g.pb[0];continue}ht=C}var ft=g.pb[et];ft.Sc[0]=ec[Es(ht+O,127)],ft.Sc[1]=Lu[Es(ht+0,127)],ft.Eb[0]=2*ec[Es(ht+M,127)],ft.Eb[1]=101581*Lu[Es(ht+H,127)]>>16,8>ft.Eb[1]&&(ft.Eb[1]=8),ft.Qc[0]=ec[Es(ht+X,117)],ft.Qc[1]=Lu[Es(ht+q,127)],ft.lc=ht+q}if(!G.Rb)return Sr(g,4,"Not a key frame.");for(ne(j),G=g.Pa,C=0;4>C;++C){for(O=0;8>O;++O)for(M=0;3>M;++M)for(H=0;11>H;++H)X=re(j,fn[C][O][M][H])?oe(j,8):Bu[C][O][M][H],G.Wc[C][O].Yb[M][H]=X;for(O=0;17>O;++O)G.Xc[C][O]=G.Wc[C][Ff[O]]}return g.kc=ne(j),g.kc&&(g.Bd=oe(j,8)),g.cb=1}function gi(g,b,C,M,O,j,G){var H=b[O].Yb[C];for(C=0;16>O;++O){if(!re(g,H[C+0]))return O;for(;!re(g,H[C+1]);)if(H=b[++O].Yb[0],C=0,O==16)return 16;var q=b[O+1].Yb;if(re(g,H[C+2])){var X=g,ct=0;if(re(X,(ht=H)[(et=C)+3]))if(re(X,ht[et+6])){for(H=0,et=2*(ct=re(X,ht[et+8]))+(ht=re(X,ht[et+9+ct])),ct=0,ht=kd[et];ht[H];++H)ct+=ct+re(X,ht[H]);ct+=3+(8<<et)}else re(X,ht[et+7])?(ct=7+2*re(X,165),ct+=re(X,145)):ct=5+re(X,159);else ct=re(X,ht[et+4])?3+re(X,ht[et+5]):2;H=q[2]}else ct=1,H=q[1];q=G+Fo[O],0>(X=g).b&&Kt(X);var et,ht=X.b,ft=(et=X.Ca>>1)-(X.I>>ht)>>31;--X.b,X.Ca+=ft,X.Ca|=1,X.I-=(et+1&ft)<<ht,j[q]=((ct^ft)-ft)*M[(0<O)+0]}return 16}function eo(g){var b=g.rb[g.sb-1];b.la=0,b.Na=0,n(g.zc,0,0,g.zc.length),g.ja=0}function xn(g,b){if(g==null)return 0;if(b==null)return Sr(g,2,"NULL VP8Io parameter in VP8Decode().");if(!g.cb&&!ps(g,b))return 0;if(t(g.cb),b.ac==null||b.ac(b)){b.ob&&(g.L=0);var C=_[g.L];if(g.L==2?(g.yb=0,g.zb=0):(g.yb=b.v-C>>4,g.zb=b.j-C>>4,0>g.yb&&(g.yb=0),0>g.zb&&(g.zb=0)),g.Va=b.o+15+C>>4,g.Hb=b.va+15+C>>4,g.Hb>g.za&&(g.Hb=g.za),g.Va>g.Ub&&(g.Va=g.Ub),0<g.L){var M=g.ed;for(C=0;4>C;++C){var O;if(g.Qa.Cb){var j=g.Qa.Lb[C];g.Qa.Fb||(j+=M.Tb)}else j=M.Tb;for(O=0;1>=O;++O){var G=g.gd[C][O],H=j;if(M.Pc&&(H+=M.vd[0],O&&(H+=M.od[0])),0<(H=0>H?0:63<H?63:H)){var q=H;0<M.wb&&(q=4<M.wb?q>>2:q>>1)>9-M.wb&&(q=9-M.wb),1>q&&(q=1),G.dd=q,G.tc=2*H+q,G.ld=40<=H?2:15<=H?1:0}else G.tc=0;G.La=O}}}C=0}else Sr(g,6,"Frame setup failed"),C=g.a;if(C=C==0){if(C){g.$c=0,0<g.Aa||(g.Ic=B);t:{C=g.Ic,M=4*(q=g.za);var X=32*q,ct=q+1,et=0<g.L?q*(0<g.Aa?2:1):0,ht=(g.Aa==2?2:1)*q;if((G=M+832+(O=3*(16*C+_[g.L])/2*X)+(j=g.Fa!=null&&0<g.Fa.length?g.Kc.c*g.Kc.i:0))!=G)C=0;else{if(G>g.Vb){if(g.Vb=0,g.Ec=s(G),g.Fc=0,g.Ec==null){C=Sr(g,1,"no memory during frame initialization.");break t}g.Vb=G}G=g.Ec,H=g.Fc,g.Ac=G,g.Bc=H,H+=M,g.Gd=a(X,Fi),g.Hd=0,g.rb=a(ct+1,fs),g.sb=1,g.wa=et?a(et,ds):null,g.Y=0,g.D.Nb=0,g.D.wa=g.wa,g.D.Y=g.Y,0<g.Aa&&(g.D.Y+=q),t(!0),g.oc=G,g.pc=H,H+=832,g.ya=a(ht,$i),g.aa=0,g.D.ya=g.ya,g.D.aa=g.aa,g.Aa==2&&(g.D.aa+=q),g.R=16*q,g.B=8*q,q=(X=_[g.L])*g.R,X=X/2*g.B,g.sa=G,g.ta=H+q,g.qa=g.sa,g.ra=g.ta+16*C*g.R+X,g.Ha=g.qa,g.Ia=g.ra+8*C*g.B+X,g.$c=0,H+=O,g.mb=j?G:null,g.nb=j?H:null,t(H+j<=g.Fc+g.Vb),eo(g),n(g.Ac,g.Bc,0,M),C=1}}if(C){if(b.ka=0,b.y=g.sa,b.O=g.ta,b.f=g.qa,b.N=g.ra,b.ea=g.Ha,b.Vd=g.Ia,b.fa=g.R,b.Rc=g.B,b.F=null,b.J=0,!Xl){for(C=-255;255>=C;++C)Do[255+C]=0>C?-C:C;for(C=-1020;1020>=C;++C)$e[1020+C]=-128>C?-128:127<C?127:C;for(C=-112;112>=C;++C)Cu[112+C]=-16>C?-16:15<C?15:C;for(C=-255;510>=C;++C)Jl[255+C]=0>C?0:255<C?255:C;Xl=1}Vs=vt,sa=Io,Ia=Us,no=tl,oa=st,Ro=Po,pl=Dc,aa=nl,Oo=Id,dn=xu,Cs=sl,Ts=Nc,Pn=Au,ii=vh,yi=Oc,_i=Mo,ji=Lo,Ma=wu,In[0]=on,In[1]=pe,In[2]=Sa,In[3]=Rc,In[4]=el,In[5]=ta,In[6]=zl,In[7]=Ea,In[8]=Ul,In[9]=jl,so[0]=un,so[1]=yr,so[2]=Br,so[3]=mi,so[4]=Ti,so[5]=_h,so[6]=Fl,zo[0]=il,zo[1]=Ee,zo[2]=Pd,zo[3]=bu,zo[4]=ea,zo[5]=Ca,zo[6]=En,C=1}else C=0}C&&(C=function(ft,Mt){for(ft.M=0;ft.M<ft.Va;++ft.M){var St,gt=ft.Jc[ft.M&ft.Xb],yt=ft.m,Vt=ft;for(St=0;St<Vt.za;++St){var $t=yt,ae=Vt,le=ae.Ac,me=ae.Bc+4*St,Le=ae.zc,we=ae.ya[ae.aa+St];if(ae.Qa.Bb?we.$b=re($t,ae.Pa.jb[0])?2+re($t,ae.Pa.jb[2]):re($t,ae.Pa.jb[1]):we.$b=0,ae.kc&&(we.Ad=re($t,ae.Bd)),we.Za=!re($t,145)+0,we.Za){var Ue=we.Ob,Ke=0;for(ae=0;4>ae;++ae){var Je,vr=Le[0+ae];for(Je=0;4>Je;++Je){vr=tn[le[me+Je]][vr];for(var br=Rd[re($t,vr[0])];0<br;)br=Rd[2*br+re($t,vr[br])];vr=-br,le[me+Je]=vr}i(Ue,Ke,le,me,4),Ke+=4,Le[0+ae]=vr}}else vr=re($t,156)?re($t,128)?1:3:re($t,163)?2:0,we.Ob[0]=vr,n(le,me,vr,4),n(Le,0,vr,4);we.Dd=re($t,142)?re($t,114)?re($t,183)?1:3:2:0}if(Vt.m.Ka)return Sr(ft,7,"Premature end-of-partition0 encountered.");for(;ft.ja<ft.za;++ft.ja){if(Vt=gt,$t=(yt=ft).rb[yt.sb-1],le=yt.rb[yt.sb+yt.ja],St=yt.ya[yt.aa+yt.ja],me=yt.kc?St.Ad:0)$t.la=le.la=0,St.Za||($t.Na=le.Na=0),St.Hc=0,St.Gc=0,St.ia=0;else{var Vr,gr;if($t=le,le=Vt,me=yt.Pa.Xc,Le=yt.ya[yt.aa+yt.ja],we=yt.pb[Le.$b],ae=Le.ad,Ue=0,Ke=yt.rb[yt.sb-1],vr=Je=0,n(ae,Ue,0,384),Le.Za)var Ur=0,ci=me[3];else{br=s(16);var ui=$t.Na+Ke.Na;if(ui=zn(le,me[1],ui,we.Eb,0,br,0),$t.Na=Ke.Na=(0<ui)+0,1<ui)Vs(br,0,ae,Ue);else{var en=br[0]+3>>3;for(br=0;256>br;br+=16)ae[Ue+br]=en}Ur=1,ci=me[0]}var ti=15&$t.la,Kn=15&Ke.la;for(br=0;4>br;++br){var bn=1&Kn;for(en=gr=0;4>en;++en)ti=ti>>1|(bn=(ui=zn(le,ci,ui=bn+(1&ti),we.Sc,Ur,ae,Ue))>Ur)<<7,gr=gr<<2|(3<ui?3:1<ui?2:ae[Ue+0]!=0),Ue+=16;ti>>=4,Kn=Kn>>1|bn<<7,Je=(Je<<8|gr)>>>0}for(ci=ti,Ur=Kn>>4,Vr=0;4>Vr;Vr+=2){for(gr=0,ti=$t.la>>4+Vr,Kn=Ke.la>>4+Vr,br=0;2>br;++br){for(bn=1&Kn,en=0;2>en;++en)ui=bn+(1&ti),ti=ti>>1|(bn=0<(ui=zn(le,me[2],ui,we.Qc,0,ae,Ue)))<<3,gr=gr<<2|(3<ui?3:1<ui?2:ae[Ue+0]!=0),Ue+=16;ti>>=2,Kn=Kn>>1|bn<<5}vr|=gr<<4*Vr,ci|=ti<<4<<Vr,Ur|=(240&Kn)<<Vr}$t.la=ci,Ke.la=Ur,Le.Hc=Je,Le.Gc=vr,Le.ia=43690&vr?0:we.ia,me=!(Je|vr)}if(0<yt.L&&(yt.wa[yt.Y+yt.ja]=yt.gd[St.$b][St.Za],yt.wa[yt.Y+yt.ja].La|=!me),Vt.Ka)return Sr(ft,7,"Premature end-of-file encountered.")}if(eo(ft),yt=Mt,Vt=1,St=(gt=ft).D,$t=0<gt.L&&gt.M>=gt.zb&&gt.M<=gt.Va,gt.Aa==0)t:{if(St.M=gt.M,St.uc=$t,cl(gt,St),Vt=1,St=(gr=gt.D).Nb,$t=(vr=_[gt.L])*gt.R,le=vr/2*gt.B,br=16*St*gt.R,en=8*St*gt.B,me=gt.sa,Le=gt.ta-$t+br,we=gt.qa,ae=gt.ra-le+en,Ue=gt.Ha,Ke=gt.Ia-le+en,Kn=(ti=gr.M)==0,Je=ti>=gt.Va-1,gt.Aa==2&&cl(gt,gr),gr.uc)for(bn=(ui=gt).D.M,t(ui.D.uc),gr=ui.yb;gr<ui.Hb;++gr){Ur=gr,ci=bn;var Li=(ei=(Ji=ui).D).Nb;Vr=Ji.R;var ei=ei.wa[ei.Y+Ur],Zr=Ji.sa,ri=Ji.ta+16*Li*Vr+16*Ur,pn=ei.dd,Yr=ei.tc;if(Yr!=0)if(t(3<=Yr),Ji.L==1)0<Ur&&_i(Zr,ri,Vr,Yr+4),ei.La&&Ma(Zr,ri,Vr,Yr),0<ci&&yi(Zr,ri,Vr,Yr+4),ei.La&&ji(Zr,ri,Vr,Yr);else{var hi=Ji.B,jn=Ji.qa,Ui=Ji.ra+8*Li*hi+8*Ur,Ai=Ji.Ha,Ji=Ji.Ia+8*Li*hi+8*Ur;Li=ei.ld,0<Ur&&(aa(Zr,ri,Vr,Yr+4,pn,Li),dn(jn,Ui,Ai,Ji,hi,Yr+4,pn,Li)),ei.La&&(Ts(Zr,ri,Vr,Yr,pn,Li),ii(jn,Ui,Ai,Ji,hi,Yr,pn,Li)),0<ci&&(pl(Zr,ri,Vr,Yr+4,pn,Li),Oo(jn,Ui,Ai,Ji,hi,Yr+4,pn,Li)),ei.La&&(Cs(Zr,ri,Vr,Yr,pn,Li),Pn(jn,Ui,Ai,Ji,hi,Yr,pn,Li))}}if(gt.ia&&alert("todo:DitherRow"),yt.put!=null){if(gr=16*ti,ti=16*(ti+1),Kn?(yt.y=gt.sa,yt.O=gt.ta+br,yt.f=gt.qa,yt.N=gt.ra+en,yt.ea=gt.Ha,yt.W=gt.Ia+en):(gr-=vr,yt.y=me,yt.O=Le,yt.f=we,yt.N=ae,yt.ea=Ue,yt.W=Ke),Je||(ti-=vr),ti>yt.o&&(ti=yt.o),yt.F=null,yt.J=null,gt.Fa!=null&&0<gt.Fa.length&&gr<ti&&(yt.J=ko(gt,yt,gr,ti-gr),yt.F=gt.mb,yt.F==null&&yt.F.length==0)){Vt=Sr(gt,3,"Could not decode alpha data.");break t}gr<yt.j&&(vr=yt.j-gr,gr=yt.j,t(!(1&vr)),yt.O+=gt.R*vr,yt.N+=gt.B*(vr>>1),yt.W+=gt.B*(vr>>1),yt.F!=null&&(yt.J+=yt.width*vr)),gr<ti&&(yt.O+=yt.v,yt.N+=yt.v>>1,yt.W+=yt.v>>1,yt.F!=null&&(yt.J+=yt.v),yt.ka=gr-yt.j,yt.U=yt.va-yt.v,yt.T=ti-gr,Vt=yt.put(yt))}St+1!=gt.Ic||Je||(i(gt.sa,gt.ta-$t,me,Le+16*gt.R,$t),i(gt.qa,gt.ra-le,we,ae+8*gt.B,le),i(gt.Ha,gt.Ia-le,Ue,Ke+8*gt.B,le))}if(!Vt)return Sr(ft,6,"Output aborted.")}return 1}(g,b)),b.bc!=null&&b.bc(b),C&=1}return C?(g.cb=0,C):0}function An(g,b,C,M,O){O=g[b+C+32*M]+(O>>3),g[b+C+32*M]=-256&O?0>O?0:255:O}function zi(g,b,C,M,O,j){An(g,b,0,C,M+O),An(g,b,1,C,M+j),An(g,b,2,C,M-j),An(g,b,3,C,M-O)}function vn(g){return(20091*g>>16)+g}function Xr(g,b,C,M){var O,j=0,G=s(16);for(O=0;4>O;++O){var H=g[b+0]+g[b+8],q=g[b+0]-g[b+8],X=(35468*g[b+4]>>16)-vn(g[b+12]),ct=vn(g[b+4])+(35468*g[b+12]>>16);G[j+0]=H+ct,G[j+1]=q+X,G[j+2]=q-X,G[j+3]=H-ct,j+=4,b++}for(O=j=0;4>O;++O)H=(g=G[j+0]+4)+G[j+8],q=g-G[j+8],X=(35468*G[j+4]>>16)-vn(G[j+12]),An(C,M,0,0,H+(ct=vn(G[j+4])+(35468*G[j+12]>>16))),An(C,M,1,0,q+X),An(C,M,2,0,q-X),An(C,M,3,0,H-ct),j++,M+=32}function Po(g,b,C,M){var O=g[b+0]+4,j=35468*g[b+4]>>16,G=vn(g[b+4]),H=35468*g[b+1]>>16;zi(C,M,0,O+G,g=vn(g[b+1]),H),zi(C,M,1,O+j,g,H),zi(C,M,2,O-j,g,H),zi(C,M,3,O-G,g,H)}function Io(g,b,C,M,O){Xr(g,b,C,M),O&&Xr(g,b+16,C,M+4)}function Us(g,b,C,M){sa(g,b+0,C,M,1),sa(g,b+32,C,M+128,1)}function tl(g,b,C,M){var O;for(g=g[b+0]+4,O=0;4>O;++O)for(b=0;4>b;++b)An(C,M,b,O,g)}function st(g,b,C,M){g[b+0]&&no(g,b+0,C,M),g[b+16]&&no(g,b+16,C,M+4),g[b+32]&&no(g,b+32,C,M+128),g[b+48]&&no(g,b+48,C,M+128+4)}function vt(g,b,C,M){var O,j=s(16);for(O=0;4>O;++O){var G=g[b+0+O]+g[b+12+O],H=g[b+4+O]+g[b+8+O],q=g[b+4+O]-g[b+8+O],X=g[b+0+O]-g[b+12+O];j[0+O]=G+H,j[8+O]=G-H,j[4+O]=X+q,j[12+O]=X-q}for(O=0;4>O;++O)G=(g=j[0+4*O]+3)+j[3+4*O],H=j[1+4*O]+j[2+4*O],q=j[1+4*O]-j[2+4*O],X=g-j[3+4*O],C[M+0]=G+H>>3,C[M+16]=X+q>>3,C[M+32]=G-H>>3,C[M+48]=X-q>>3,M+=64}function jt(g,b,C){var M,O=b-32,j=Fn,G=255-g[O-1];for(M=0;M<C;++M){var H,q=j,X=G+g[b-1];for(H=0;H<C;++H)g[b+H]=q[X+g[O+H]];b+=32}}function pe(g,b){jt(g,b,4)}function Ee(g,b){jt(g,b,8)}function yr(g,b){jt(g,b,16)}function Br(g,b){var C;for(C=0;16>C;++C)i(g,b+32*C,g,b-32,16)}function mi(g,b){var C;for(C=16;0<C;--C)n(g,b,g[b-1],16),b+=32}function Sn(g,b,C){var M;for(M=0;16>M;++M)n(b,C+32*M,g,16)}function un(g,b){var C,M=16;for(C=0;16>C;++C)M+=g[b-1+32*C]+g[b+C-32];Sn(M>>5,g,b)}function Ti(g,b){var C,M=8;for(C=0;16>C;++C)M+=g[b-1+32*C];Sn(M>>4,g,b)}function _h(g,b){var C,M=8;for(C=0;16>C;++C)M+=g[b+C-32];Sn(M>>4,g,b)}function Fl(g,b){Sn(128,g,b)}function kr(g,b,C){return g+2*b+C+2>>2}function Sa(g,b){var C,M=b-32;for(M=new Uint8Array([kr(g[M-1],g[M+0],g[M+1]),kr(g[M+0],g[M+1],g[M+2]),kr(g[M+1],g[M+2],g[M+3]),kr(g[M+2],g[M+3],g[M+4])]),C=0;4>C;++C)i(g,b+32*C,M,0,M.length)}function Rc(g,b){var C=g[b-1],M=g[b-1+32],O=g[b-1+64],j=g[b-1+96];Se(g,b+0,16843009*kr(g[b-1-32],C,M)),Se(g,b+32,16843009*kr(C,M,O)),Se(g,b+64,16843009*kr(M,O,j)),Se(g,b+96,16843009*kr(O,j,j))}function on(g,b){var C,M=4;for(C=0;4>C;++C)M+=g[b+C-32]+g[b-1+32*C];for(M>>=3,C=0;4>C;++C)n(g,b+32*C,M,4)}function el(g,b){var C=g[b-1+0],M=g[b-1+32],O=g[b-1+64],j=g[b-1-32],G=g[b+0-32],H=g[b+1-32],q=g[b+2-32],X=g[b+3-32];g[b+0+96]=kr(M,O,g[b-1+96]),g[b+1+96]=g[b+0+64]=kr(C,M,O),g[b+2+96]=g[b+1+64]=g[b+0+32]=kr(j,C,M),g[b+3+96]=g[b+2+64]=g[b+1+32]=g[b+0+0]=kr(G,j,C),g[b+3+64]=g[b+2+32]=g[b+1+0]=kr(H,G,j),g[b+3+32]=g[b+2+0]=kr(q,H,G),g[b+3+0]=kr(X,q,H)}function zl(g,b){var C=g[b+1-32],M=g[b+2-32],O=g[b+3-32],j=g[b+4-32],G=g[b+5-32],H=g[b+6-32],q=g[b+7-32];g[b+0+0]=kr(g[b+0-32],C,M),g[b+1+0]=g[b+0+32]=kr(C,M,O),g[b+2+0]=g[b+1+32]=g[b+0+64]=kr(M,O,j),g[b+3+0]=g[b+2+32]=g[b+1+64]=g[b+0+96]=kr(O,j,G),g[b+3+32]=g[b+2+64]=g[b+1+96]=kr(j,G,H),g[b+3+64]=g[b+2+96]=kr(G,H,q),g[b+3+96]=kr(H,q,q)}function ta(g,b){var C=g[b-1+0],M=g[b-1+32],O=g[b-1+64],j=g[b-1-32],G=g[b+0-32],H=g[b+1-32],q=g[b+2-32],X=g[b+3-32];g[b+0+0]=g[b+1+64]=j+G+1>>1,g[b+1+0]=g[b+2+64]=G+H+1>>1,g[b+2+0]=g[b+3+64]=H+q+1>>1,g[b+3+0]=q+X+1>>1,g[b+0+96]=kr(O,M,C),g[b+0+64]=kr(M,C,j),g[b+0+32]=g[b+1+96]=kr(C,j,G),g[b+1+32]=g[b+2+96]=kr(j,G,H),g[b+2+32]=g[b+3+96]=kr(G,H,q),g[b+3+32]=kr(H,q,X)}function Ea(g,b){var C=g[b+0-32],M=g[b+1-32],O=g[b+2-32],j=g[b+3-32],G=g[b+4-32],H=g[b+5-32],q=g[b+6-32],X=g[b+7-32];g[b+0+0]=C+M+1>>1,g[b+1+0]=g[b+0+64]=M+O+1>>1,g[b+2+0]=g[b+1+64]=O+j+1>>1,g[b+3+0]=g[b+2+64]=j+G+1>>1,g[b+0+32]=kr(C,M,O),g[b+1+32]=g[b+0+96]=kr(M,O,j),g[b+2+32]=g[b+1+96]=kr(O,j,G),g[b+3+32]=g[b+2+96]=kr(j,G,H),g[b+3+64]=kr(G,H,q),g[b+3+96]=kr(H,q,X)}function jl(g,b){var C=g[b-1+0],M=g[b-1+32],O=g[b-1+64],j=g[b-1+96];g[b+0+0]=C+M+1>>1,g[b+2+0]=g[b+0+32]=M+O+1>>1,g[b+2+32]=g[b+0+64]=O+j+1>>1,g[b+1+0]=kr(C,M,O),g[b+3+0]=g[b+1+32]=kr(M,O,j),g[b+3+32]=g[b+1+64]=kr(O,j,j),g[b+3+64]=g[b+2+64]=g[b+0+96]=g[b+1+96]=g[b+2+96]=g[b+3+96]=j}function Ul(g,b){var C=g[b-1+0],M=g[b-1+32],O=g[b-1+64],j=g[b-1+96],G=g[b-1-32],H=g[b+0-32],q=g[b+1-32],X=g[b+2-32];g[b+0+0]=g[b+2+32]=C+G+1>>1,g[b+0+32]=g[b+2+64]=M+C+1>>1,g[b+0+64]=g[b+2+96]=O+M+1>>1,g[b+0+96]=j+O+1>>1,g[b+3+0]=kr(H,q,X),g[b+2+0]=kr(G,H,q),g[b+1+0]=g[b+3+32]=kr(C,G,H),g[b+1+32]=g[b+3+64]=kr(M,C,G),g[b+1+64]=g[b+3+96]=kr(O,M,C),g[b+1+96]=kr(j,O,M)}function Pd(g,b){var C;for(C=0;8>C;++C)i(g,b+32*C,g,b-32,8)}function bu(g,b){var C;for(C=0;8>C;++C)n(g,b,g[b-1],8),b+=32}function rl(g,b,C){var M;for(M=0;8>M;++M)n(b,C+32*M,g,8)}function il(g,b){var C,M=8;for(C=0;8>C;++C)M+=g[b+C-32]+g[b-1+32*C];rl(M>>4,g,b)}function Ca(g,b){var C,M=4;for(C=0;8>C;++C)M+=g[b+C-32];rl(M>>3,g,b)}function ea(g,b){var C,M=4;for(C=0;8>C;++C)M+=g[b-1+32*C];rl(M>>3,g,b)}function En(g,b){rl(128,g,b)}function hn(g,b,C){var M=g[b-C],O=g[b+0],j=3*(O-M)+bh[1020+g[b-2*C]-g[b+C]],G=Fe[112+(j+4>>3)];g[b-C]=Fn[255+M+Fe[112+(j+3>>3)]],g[b+0]=Fn[255+O-G]}function Kr(g,b,C,M){var O=g[b+0],j=g[b+C];return qs[255+g[b-2*C]-g[b-C]]>M||qs[255+j-O]>M}function Gl(g,b,C,M){return 4*qs[255+g[b-C]-g[b+0]]+qs[255+g[b-2*C]-g[b+C]]<=M}function Vl(g,b,C,M,O){var j=g[b-3*C],G=g[b-2*C],H=g[b-C],q=g[b+0],X=g[b+C],ct=g[b+2*C],et=g[b+3*C];return 4*qs[255+H-q]+qs[255+G-X]>M?0:qs[255+g[b-4*C]-j]<=O&&qs[255+j-G]<=O&&qs[255+G-H]<=O&&qs[255+et-ct]<=O&&qs[255+ct-X]<=O&&qs[255+X-q]<=O}function Oc(g,b,C,M){var O=2*M+1;for(M=0;16>M;++M)Gl(g,b+M,C,O)&&hn(g,b+M,C)}function Mo(g,b,C,M){var O=2*M+1;for(M=0;16>M;++M)Gl(g,b+M*C,1,O)&&hn(g,b+M*C,1)}function Lo(g,b,C,M){var O;for(O=3;0<O;--O)Oc(g,b+=4*C,C,M)}function wu(g,b,C,M){var O;for(O=3;0<O;--O)Mo(g,b+=4,C,M)}function ra(g,b,C,M,O,j,G,H){for(j=2*j+1;0<O--;){if(Vl(g,b,C,j,G))if(Kr(g,b,C,H))hn(g,b,C);else{var q=g,X=b,ct=C,et=q[X-2*ct],ht=q[X-ct],ft=q[X+0],Mt=q[X+ct],St=q[X+2*ct],gt=27*(Vt=bh[1020+3*(ft-ht)+bh[1020+et-Mt]])+63>>7,yt=18*Vt+63>>7,Vt=9*Vt+63>>7;q[X-3*ct]=Fn[255+q[X-3*ct]+Vt],q[X-2*ct]=Fn[255+et+yt],q[X-ct]=Fn[255+ht+gt],q[X+0]=Fn[255+ft-gt],q[X+ct]=Fn[255+Mt-yt],q[X+2*ct]=Fn[255+St-Vt]}b+=M}}function As(g,b,C,M,O,j,G,H){for(j=2*j+1;0<O--;){if(Vl(g,b,C,j,G))if(Kr(g,b,C,H))hn(g,b,C);else{var q=g,X=b,ct=C,et=q[X-ct],ht=q[X+0],ft=q[X+ct],Mt=Fe[112+((St=3*(ht-et))+4>>3)],St=Fe[112+(St+3>>3)],gt=Mt+1>>1;q[X-2*ct]=Fn[255+q[X-2*ct]+gt],q[X-ct]=Fn[255+et+St],q[X+0]=Fn[255+ht-Mt],q[X+ct]=Fn[255+ft-gt]}b+=M}}function Dc(g,b,C,M,O,j){ra(g,b,C,1,16,M,O,j)}function nl(g,b,C,M,O,j){ra(g,b,1,C,16,M,O,j)}function sl(g,b,C,M,O,j){var G;for(G=3;0<G;--G)As(g,b+=4*C,C,1,16,M,O,j)}function Nc(g,b,C,M,O,j){var G;for(G=3;0<G;--G)As(g,b+=4,1,C,16,M,O,j)}function Id(g,b,C,M,O,j,G,H){ra(g,b,O,1,8,j,G,H),ra(C,M,O,1,8,j,G,H)}function xu(g,b,C,M,O,j,G,H){ra(g,b,1,O,8,j,G,H),ra(C,M,1,O,8,j,G,H)}function Au(g,b,C,M,O,j,G,H){As(g,b+4*O,O,1,8,j,G,H),As(C,M+4*O,O,1,8,j,G,H)}function vh(g,b,C,M,O,j,G,H){As(g,b+4,1,O,8,j,G,H),As(C,M+4,1,O,8,j,G,H)}function Fc(){this.ba=new ai,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Y,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function ql(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function ol(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function zc(){this.ua=0,this.Wa=new Bt,this.vb=new Bt,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new xt,this.yc=new dt}function Su(){this.xb=this.a=0,this.l=new xs,this.ca=new ai,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new it,this.Pb=0,this.wd=new it,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new zc,this.ab=0,this.gc=a(4,ol),this.Oc=0}function Bo(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new xs,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function al(g,b,C,M,O,j,G){for(g=g==null?0:g[b+0],b=0;b<G;++b)O[j+b]=g+C[M+b]&255,g=O[j+b]}function jc(g,b,C,M,O,j,G){var H;if(g==null)al(null,null,C,M,O,j,G);else for(H=0;H<G;++H)O[j+H]=g[b+H]+C[M+H]&255}function ia(g,b,C,M,O,j,G){if(g==null)al(null,null,C,M,O,j,G);else{var H,q=g[b+0],X=q,ct=q;for(H=0;H<G;++H)X=ct+(q=g[b+H])-X,ct=C[M+H]+(-256&X?0>X?0:255:X)&255,X=q,O[j+H]=ct}}function ko(g,b,C,M){var O=b.width,j=b.o;if(t(g!=null&&b!=null),0>C||0>=M||C+M>j)return null;if(!g.Cc){if(g.ga==null){var G;if(g.ga=new Bo,(G=g.ga==null)||(G=b.width*b.o,t(g.Gb.length==0),g.Gb=s(G),g.Uc=0,g.Gb==null?G=0:(g.mb=g.Gb,g.nb=g.Uc,g.rc=null,G=1),G=!G),!G){G=g.ga;var H=g.Fa,q=g.P,X=g.qc,ct=g.mb,et=g.nb,ht=q+1,ft=X-1,Mt=G.l;if(t(H!=null&&ct!=null&&b!=null),oo[0]=null,oo[1]=al,oo[2]=jc,oo[3]=ia,G.ca=ct,G.tb=et,G.c=b.width,G.i=b.height,t(0<G.c&&0<G.i),1>=X)b=0;else if(G.$a=H[q+0]>>0&3,G.Z=H[q+0]>>2&3,G.Lc=H[q+0]>>4&3,q=H[q+0]>>6&3,0>G.$a||1<G.$a||4<=G.Z||1<G.Lc||q)b=0;else if(Mt.put=Gt,Mt.ac=Nt,Mt.bc=Ht,Mt.ma=G,Mt.width=b.width,Mt.height=b.height,Mt.Da=b.Da,Mt.v=b.v,Mt.va=b.va,Mt.j=b.j,Mt.o=b.o,G.$a)t:{t(G.$a==1),b=ur();e:for(;;){if(b==null){b=0;break t}if(t(G!=null),G.mc=b,b.c=G.c,b.i=G.i,b.l=G.l,b.l.ma=G,b.l.width=G.c,b.l.height=G.i,b.a=0,Dt(b.m,H,ht,ft),!Gr(G.c,G.i,1,b,null)||(b.ab==1&&b.gc[0].hc==3&&sr(b.s)?(G.ic=1,H=b.c*b.i,b.Ta=null,b.Ua=0,b.V=s(H),b.Ba=0,b.V==null?(b.a=1,b=0):b=1):(G.ic=0,b=pi(b,G.c)),!b))break e;b=1;break t}G.mc=null,b=0}else b=ft>=G.c*G.i;G=!b}if(G)return null;g.ga.Lc!=1?g.Ga=0:M=j-C}t(g.ga!=null),t(C+M<=j);t:{if(b=(H=g.ga).c,j=H.l.o,H.$a==0){if(ht=g.rc,ft=g.Vc,Mt=g.Fa,q=g.P+1+C*b,X=g.mb,ct=g.nb+C*b,t(q<=g.P+g.qc),H.Z!=0)for(t(oo[H.Z]!=null),G=0;G<M;++G)oo[H.Z](ht,ft,Mt,q,X,ct,b),ht=X,ft=ct,ct+=b,q+=b;else for(G=0;G<M;++G)i(X,ct,Mt,q,b),ht=X,ft=ct,ct+=b,q+=b;g.rc=ht,g.Vc=ft}else{if(t(H.mc!=null),b=C+M,t((G=H.mc)!=null),t(b<=G.i),G.C>=b)b=1;else if(H.ic||te(),H.ic){H=G.V,ht=G.Ba,ft=G.c;var St=G.i,gt=(Mt=1,q=G.$/ft,X=G.$%ft,ct=G.m,et=G.s,G.$),yt=ft*St,Vt=ft*b,$t=et.wc,ae=gt<Vt?He(et,X,q):null;t(gt<=yt),t(b<=St),t(sr(et));e:for(;;){for(;!ct.h&&gt<Vt;){if(X&$t||(ae=He(et,X,q)),t(ae!=null),Zt(ct),256>(St=fe(ae.G[0],ae.H[0],ct)))H[ht+gt]=St,++gt,++X>=ft&&(X=0,++q<=b&&!(q%16)&&zr(G,q));else{if(!(280>St)){Mt=0;break e}St=Jt(St-256,ct);var le,me=fe(ae.G[4],ae.H[4],ct);if(Zt(ct),!(gt>=(me=ye(ft,me=Jt(me,ct)))&&yt-gt>=St)){Mt=0;break e}for(le=0;le<St;++le)H[ht+gt+le]=H[ht+gt+le-me];for(gt+=St,X+=St;X>=ft;)X-=ft,++q<=b&&!(q%16)&&zr(G,q);gt<Vt&&X&$t&&(ae=He(et,X,q))}t(ct.h==Lt(ct))}zr(G,q>b?b:q);break e}!Mt||ct.h&&gt<yt?(Mt=0,G.a=ct.h?5:3):G.$=gt,b=Mt}else b=$r(G,G.V,G.Ba,G.c,G.i,b,Ri);if(!b){M=0;break t}}C+M>=j&&(g.Cc=1),M=1}if(!M)return null;if(g.Cc&&((M=g.ga)!=null&&(M.mc=null),g.ga=null,0<g.Ga))return alert("todo:WebPDequantizeLevels"),null}return g.nb+C*O}function D(g,b,C,M,O,j){for(;0<O--;){var G,H=g,q=b+(C?1:0),X=g,ct=b+(C?0:3);for(G=0;G<M;++G){var et=X[ct+4*G];et!=255&&(et*=32897,H[q+4*G+0]=H[q+4*G+0]*et>>23,H[q+4*G+1]=H[q+4*G+1]*et>>23,H[q+4*G+2]=H[q+4*G+2]*et>>23)}b+=j}}function tt(g,b,C,M,O){for(;0<M--;){var j;for(j=0;j<C;++j){var G=g[b+2*j+0],H=15&(X=g[b+2*j+1]),q=4369*H,X=(240&X|X>>4)*q>>16;g[b+2*j+0]=(240&G|G>>4)*q>>16&240|(15&G|G<<4)*q>>16>>4&15,g[b+2*j+1]=240&X|H}b+=O}}function It(g,b,C,M,O,j,G,H){var q,X,ct=255;for(X=0;X<O;++X){for(q=0;q<M;++q){var et=g[b+q];j[G+4*q]=et,ct&=et}b+=C,G+=H}return ct!=255}function qt(g,b,C,M,O){var j;for(j=0;j<O;++j)C[M+j]=g[b+j]>>8}function te(){la=D,qc=tt,La=It,Hc=qt}function ie(g,b,C){pt[g]=function(M,O,j,G,H,q,X,ct,et,ht,ft,Mt,St,gt,yt,Vt,$t){var ae,le=$t-1>>1,me=H[q+0]|X[ct+0]<<16,Le=et[ht+0]|ft[Mt+0]<<16;t(M!=null);var we=3*me+Le+131074>>2;for(b(M[O+0],255&we,we>>16,St,gt),j!=null&&(we=3*Le+me+131074>>2,b(j[G+0],255&we,we>>16,yt,Vt)),ae=1;ae<=le;++ae){var Ue=H[q+ae]|X[ct+ae]<<16,Ke=et[ht+ae]|ft[Mt+ae]<<16,Je=me+Ue+Le+Ke+524296,vr=Je+2*(Ue+Le)>>3;we=vr+me>>1,me=(Je=Je+2*(me+Ke)>>3)+Ue>>1,b(M[O+2*ae-1],255&we,we>>16,St,gt+(2*ae-1)*C),b(M[O+2*ae-0],255&me,me>>16,St,gt+(2*ae-0)*C),j!=null&&(we=Je+Le>>1,me=vr+Ke>>1,b(j[G+2*ae-1],255&we,we>>16,yt,Vt+(2*ae-1)*C),b(j[G+2*ae+0],255&me,me>>16,yt,Vt+(2*ae+0)*C)),me=Ue,Le=Ke}1&$t||(we=3*me+Le+131074>>2,b(M[O+$t-1],255&we,we>>16,St,gt+($t-1)*C),j!=null&&(we=3*Le+me+131074>>2,b(j[G+$t-1],255&we,we>>16,yt,Vt+($t-1)*C)))}}function Me(){gs[Tu]=Dd,gs[Kl]=ca,gs[wh]=Nd,gs[Yl]=ku,gs[Pu]=Wc,gs[Ld]=Ru,gs[Ba]=Ou,gs[Mi]=ca,gs[Ql]=ku,gs[tc]=Wc,gs[Iu]=Ru}function er(g){return g&~ic?0>g?0:255:g>>Du}function Ar(g,b){return er((19077*g>>8)+(26149*b>>8)-14234)}function Lr(g,b,C){return er((19077*g>>8)-(6419*b>>8)-(13320*C>>8)+8708)}function dr(g,b){return er((19077*g>>8)+(33050*b>>8)-17685)}function si(g,b,C,M,O){M[O+0]=Ar(g,C),M[O+1]=Lr(g,b,C),M[O+2]=dr(g,b)}function fr(g,b,C,M,O){M[O+0]=dr(g,b),M[O+1]=Lr(g,b,C),M[O+2]=Ar(g,C)}function Qi(g,b,C,M,O){var j=Lr(g,b,C);b=j<<3&224|dr(g,b)>>3,M[O+0]=248&Ar(g,C)|j>>5,M[O+1]=b}function Or(g,b,C,M,O){var j=240&dr(g,b)|15;M[O+0]=240&Ar(g,C)|Lr(g,b,C)>>4,M[O+1]=j}function jr(g,b,C,M,O){M[O+0]=255,si(g,b,C,M,O+1)}function Zi(g,b,C,M,O){fr(g,b,C,M,O),M[O+3]=255}function Ss(g,b,C,M,O){si(g,b,C,M,O),M[O+3]=255}function Es(g,b){return 0>g?0:g>b?b:g}function na(g,b,C){pt[g]=function(M,O,j,G,H,q,X,ct,et){for(var ht=ct+(-2&et)*C;ct!=ht;)b(M[O+0],j[G+0],H[q+0],X,ct),b(M[O+1],j[G+0],H[q+0],X,ct+C),O+=2,++G,++q,ct+=2*C;1&et&&b(M[O+0],j[G+0],H[q+0],X,ct)}}function Hl(g,b,C){return C==0?g==0?b==0?6:5:b==0?4:0:C}function ll(g,b,C,M,O){switch(g>>>30){case 3:sa(b,C,M,O,0);break;case 2:Ro(b,C,M,O);break;case 1:no(b,C,M,O)}}function cl(g,b){var C,M,O=b.M,j=b.Nb,G=g.oc,H=g.pc+40,q=g.oc,X=g.pc+584,ct=g.oc,et=g.pc+600;for(C=0;16>C;++C)G[H+32*C-1]=129;for(C=0;8>C;++C)q[X+32*C-1]=129,ct[et+32*C-1]=129;for(0<O?G[H-1-32]=q[X-1-32]=ct[et-1-32]=129:(n(G,H-32-1,127,21),n(q,X-32-1,127,9),n(ct,et-32-1,127,9)),M=0;M<g.za;++M){var ht=b.ya[b.aa+M];if(0<M){for(C=-1;16>C;++C)i(G,H+32*C-4,G,H+32*C+12,4);for(C=-1;8>C;++C)i(q,X+32*C-4,q,X+32*C+4,4),i(ct,et+32*C-4,ct,et+32*C+4,4)}var ft=g.Gd,Mt=g.Hd+M,St=ht.ad,gt=ht.Hc;if(0<O&&(i(G,H-32,ft[Mt].y,0,16),i(q,X-32,ft[Mt].f,0,8),i(ct,et-32,ft[Mt].ea,0,8)),ht.Za){var yt=G,Vt=H-32+16;for(0<O&&(M>=g.za-1?n(yt,Vt,ft[Mt].y[15],4):i(yt,Vt,ft[Mt+1].y,0,4)),C=0;4>C;C++)yt[Vt+128+C]=yt[Vt+256+C]=yt[Vt+384+C]=yt[Vt+0+C];for(C=0;16>C;++C,gt<<=2)yt=G,Vt=H+y[C],In[ht.Ob[C]](yt,Vt),ll(gt,St,16*+C,yt,Vt)}else if(yt=Hl(M,O,ht.Ob[0]),so[yt](G,H),gt!=0)for(C=0;16>C;++C,gt<<=2)ll(gt,St,16*+C,G,H+y[C]);for(C=ht.Gc,yt=Hl(M,O,ht.Dd),zo[yt](q,X),zo[yt](ct,et),gt=St,yt=q,Vt=X,255&(ht=C>>0)&&(170&ht?Ia(gt,256,yt,Vt):oa(gt,256,yt,Vt)),ht=ct,gt=et,255&(C>>=8)&&(170&C?Ia(St,320,ht,gt):oa(St,320,ht,gt)),O<g.Ub-1&&(i(ft[Mt].y,0,G,H+480,16),i(ft[Mt].f,0,q,X+224,8),i(ft[Mt].ea,0,ct,et+224,8)),C=8*j*g.B,ft=g.sa,Mt=g.ta+16*M+16*j*g.R,St=g.qa,ht=g.ra+8*M+C,gt=g.Ha,yt=g.Ia+8*M+C,C=0;16>C;++C)i(ft,Mt+C*g.R,G,H+32*C,16);for(C=0;8>C;++C)i(St,ht+C*g.B,q,X+32*C,8),i(gt,yt+C*g.B,ct,et+32*C,8)}}function Wl(g,b,C,M,O,j,G,H,q){var X=[0],ct=[0],et=0,ht=q!=null?q.kd:0,ft=q??new ql;if(g==null||12>C)return 7;ft.data=g,ft.w=b,ft.ha=C,b=[b],C=[C],ft.gb=[ft.gb];t:{var Mt=b,St=C,gt=ft.gb;if(t(g!=null),t(St!=null),t(gt!=null),gt[0]=0,12<=St[0]&&!r(g,Mt[0],"RIFF")){if(r(g,Mt[0]+8,"WEBP")){gt=3;break t}var yt=Ve(g,Mt[0]+4);if(12>yt||4294967286<yt){gt=3;break t}if(ht&&yt>St[0]-8){gt=7;break t}gt[0]=yt,Mt[0]+=12,St[0]-=12}gt=0}if(gt!=0)return gt;for(yt=0<ft.gb[0],C=C[0];;){t:{var Vt=g;St=b,gt=C;var $t=X,ae=ct,le=Mt=[0];if((we=et=[et])[0]=0,8>gt[0])gt=7;else{if(!r(Vt,St[0],"VP8X")){if(Ve(Vt,St[0]+4)!=10){gt=3;break t}if(18>gt[0]){gt=7;break t}var me=Ve(Vt,St[0]+8),Le=1+ze(Vt,St[0]+12);if(2147483648<=Le*(Vt=1+ze(Vt,St[0]+15))){gt=3;break t}le!=null&&(le[0]=me),$t!=null&&($t[0]=Le),ae!=null&&(ae[0]=Vt),St[0]+=18,gt[0]-=18,we[0]=1}gt=0}}if(et=et[0],Mt=Mt[0],gt!=0)return gt;if(St=!!(2&Mt),!yt&&et)return 3;if(j!=null&&(j[0]=!!(16&Mt)),G!=null&&(G[0]=St),H!=null&&(H[0]=0),G=X[0],Mt=ct[0],et&&St&&q==null){gt=0;break}if(4>C){gt=7;break}if(yt&&et||!yt&&!et&&!r(g,b[0],"ALPH")){C=[C],ft.na=[ft.na],ft.P=[ft.P],ft.Sa=[ft.Sa];t:{me=g,gt=b,yt=C;var we=ft.gb;$t=ft.na,ae=ft.P,le=ft.Sa,Le=22,t(me!=null),t(yt!=null),Vt=gt[0];var Ue=yt[0];for(t($t!=null),t(le!=null),$t[0]=null,ae[0]=null,le[0]=0;;){if(gt[0]=Vt,yt[0]=Ue,8>Ue){gt=7;break t}var Ke=Ve(me,Vt+4);if(4294967286<Ke){gt=3;break t}var Je=8+Ke+1&-2;if(Le+=Je,0<we&&Le>we){gt=3;break t}if(!r(me,Vt,"VP8 ")||!r(me,Vt,"VP8L")){gt=0;break t}if(Ue[0]<Je){gt=7;break t}r(me,Vt,"ALPH")||($t[0]=me,ae[0]=Vt+8,le[0]=Ke),Vt+=Je,Ue-=Je}}if(C=C[0],ft.na=ft.na[0],ft.P=ft.P[0],ft.Sa=ft.Sa[0],gt!=0)break}C=[C],ft.Ja=[ft.Ja],ft.xa=[ft.xa];t:if(we=g,gt=b,yt=C,$t=ft.gb[0],ae=ft.Ja,le=ft.xa,me=gt[0],Vt=!r(we,me,"VP8 "),Le=!r(we,me,"VP8L"),t(we!=null),t(yt!=null),t(ae!=null),t(le!=null),8>yt[0])gt=7;else{if(Vt||Le){if(we=Ve(we,me+4),12<=$t&&we>$t-12){gt=3;break t}if(ht&&we>yt[0]-8){gt=7;break t}ae[0]=we,gt[0]+=8,yt[0]-=8,le[0]=Le}else le[0]=5<=yt[0]&&we[me+0]==47&&!(we[me+4]>>5),ae[0]=yt[0];gt=0}if(C=C[0],ft.Ja=ft.Ja[0],ft.xa=ft.xa[0],b=b[0],gt!=0)break;if(4294967286<ft.Ja)return 3;if(H==null||St||(H[0]=ft.xa?2:1),G=[G],Mt=[Mt],ft.xa){if(5>C){gt=7;break}H=G,ht=Mt,St=j,g==null||5>C?g=0:5<=C&&g[b+0]==47&&!(g[b+4]>>5)?(yt=[0],we=[0],$t=[0],Dt(ae=new it,g,b,C),Ct(ae,yt,we,$t)?(H!=null&&(H[0]=yt[0]),ht!=null&&(ht[0]=we[0]),St!=null&&(St[0]=$t[0]),g=1):g=0):g=0}else{if(10>C){gt=7;break}H=Mt,g==null||10>C||!js(g,b+3,C-3)?g=0:(ht=g[b+0]|g[b+1]<<8|g[b+2]<<16,St=16383&(g[b+7]<<8|g[b+6]),g=16383&(g[b+9]<<8|g[b+8]),1&ht||3<(ht>>1&7)||!(ht>>4&1)||ht>>5>=ft.Ja||!St||!g?g=0:(G&&(G[0]=St),H&&(H[0]=g),g=1))}if(!g||(G=G[0],Mt=Mt[0],et&&(X[0]!=G||ct[0]!=Mt)))return 3;q!=null&&(q[0]=ft,q.offset=b-q.w,t(4294967286>b-q.w),t(q.offset==q.ha-C));break}return gt==0||gt==7&&et&&q==null?(j!=null&&(j[0]|=ft.na!=null&&0<ft.na.length),M!=null&&(M[0]=G),O!=null&&(O[0]=Mt),0):gt}function ul(g,b,C){var M=b.width,O=b.height,j=0,G=0,H=M,q=O;if(b.Da=g!=null&&0<g.Da,b.Da&&(H=g.cd,q=g.bd,j=g.v,G=g.j,11>C||(j&=-2,G&=-2),0>j||0>G||0>=H||0>=q||j+H>M||G+q>O))return 0;if(b.v=j,b.j=G,b.va=j+H,b.o=G+q,b.U=H,b.T=q,b.da=g!=null&&0<g.da,b.da){if(!Xt(H,q,C=[g.ib],j=[g.hb]))return 0;b.ib=C[0],b.hb=j[0]}return b.ob=g!=null&&g.ob,b.Kb=g==null||!g.Sd,b.da&&(b.ob=b.ib<3*M/4&&b.hb<3*O/4,b.Kb=0),1}function Uc(g){if(g==null)return 2;if(11>g.S){var b=g.f.RGBA;b.fb+=(g.height-1)*b.A,b.A=-b.A}else b=g.f.kb,g=g.height,b.O+=(g-1)*b.fa,b.fa=-b.fa,b.N+=(g-1>>1)*b.Ab,b.Ab=-b.Ab,b.W+=(g-1>>1)*b.Db,b.Db=-b.Db,b.F!=null&&(b.J+=(g-1)*b.lb,b.lb=-b.lb);return 0}function Ta(g,b,C,M){if(M==null||0>=g||0>=b)return 2;if(C!=null){if(C.Da){var O=C.cd,j=C.bd,G=-2&C.v,H=-2&C.j;if(0>G||0>H||0>=O||0>=j||G+O>g||H+j>b)return 2;g=O,b=j}if(C.da){if(!Xt(g,b,O=[C.ib],j=[C.hb]))return 2;g=O[0],b=j[0]}}M.width=g,M.height=b;t:{var q=M.width,X=M.height;if(g=M.S,0>=q||0>=X||!(g>=Tu&&13>g))g=2;else{if(0>=M.Rd&&M.sd==null){G=j=O=b=0;var ct=(H=q*k[g])*X;if(11>g||(j=(X+1)/2*(b=(q+1)/2),g==12&&(G=(O=q)*X)),(X=s(ct+2*j+G))==null){g=1;break t}M.sd=X,11>g?((q=M.f.RGBA).eb=X,q.fb=0,q.A=H,q.size=ct):((q=M.f.kb).y=X,q.O=0,q.fa=H,q.Fd=ct,q.f=X,q.N=0+ct,q.Ab=b,q.Cd=j,q.ea=X,q.W=0+ct+j,q.Db=b,q.Ed=j,g==12&&(q.F=X,q.J=0+ct+2*j),q.Tc=G,q.lb=O)}if(b=1,O=M.S,j=M.width,G=M.height,O>=Tu&&13>O)if(11>O)g=M.f.RGBA,b&=(H=Math.abs(g.A))*(G-1)+j<=g.size,b&=H>=j*k[O],b&=g.eb!=null;else{g=M.f.kb,H=(j+1)/2,ct=(G+1)/2,q=Math.abs(g.fa),X=Math.abs(g.Ab);var et=Math.abs(g.Db),ht=Math.abs(g.lb),ft=ht*(G-1)+j;b&=q*(G-1)+j<=g.Fd,b&=X*(ct-1)+H<=g.Cd,b=(b&=et*(ct-1)+H<=g.Ed)&q>=j&X>=H&et>=H,b&=g.y!=null,b&=g.f!=null,b&=g.ea!=null,O==12&&(b&=ht>=j,b&=ft<=g.Tc,b&=g.F!=null)}else b=0;g=b?0:2}}return g!=0||C!=null&&C.fd&&(g=Uc(M)),g}var Xn=64,hl=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],$l=24,Zl=32,dl=8,ls=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];ve("Predictor0","PredictorAdd0"),pt.Predictor0=function(){return 4278190080},pt.Predictor1=function(g){return g},pt.Predictor2=function(g,b,C){return b[C+0]},pt.Predictor3=function(g,b,C){return b[C+1]},pt.Predictor4=function(g,b,C){return b[C-1]},pt.Predictor5=function(g,b,C){return qe(qe(g,b[C+1]),b[C+0])},pt.Predictor6=function(g,b,C){return qe(g,b[C-1])},pt.Predictor7=function(g,b,C){return qe(g,b[C+0])},pt.Predictor8=function(g,b,C){return qe(b[C-1],b[C+0])},pt.Predictor9=function(g,b,C){return qe(b[C+0],b[C+1])},pt.Predictor10=function(g,b,C){return qe(qe(g,b[C-1]),qe(b[C+0],b[C+1]))},pt.Predictor11=function(g,b,C){var M=b[C+0];return 0>=Ir(M>>24&255,g>>24&255,(b=b[C-1])>>24&255)+Ir(M>>16&255,g>>16&255,b>>16&255)+Ir(M>>8&255,g>>8&255,b>>8&255)+Ir(255&M,255&g,255&b)?M:g},pt.Predictor12=function(g,b,C){var M=b[C+0];return(lr((g>>24&255)+(M>>24&255)-((b=b[C-1])>>24&255))<<24|lr((g>>16&255)+(M>>16&255)-(b>>16&255))<<16|lr((g>>8&255)+(M>>8&255)-(b>>8&255))<<8|lr((255&g)+(255&M)-(255&b)))>>>0},pt.Predictor13=function(g,b,C){var M=b[C-1];return(Er((g=qe(g,b[C+0]))>>24&255,M>>24&255)<<24|Er(g>>16&255,M>>16&255)<<16|Er(g>>8&255,M>>8&255)<<8|Er(g>>0&255,M>>0&255))>>>0};var Md=pt.PredictorAdd0;pt.PredictorAdd1=Mr,ve("Predictor2","PredictorAdd2"),ve("Predictor3","PredictorAdd3"),ve("Predictor4","PredictorAdd4"),ve("Predictor5","PredictorAdd5"),ve("Predictor6","PredictorAdd6"),ve("Predictor7","PredictorAdd7"),ve("Predictor8","PredictorAdd8"),ve("Predictor9","PredictorAdd9"),ve("Predictor10","PredictorAdd10"),ve("Predictor11","PredictorAdd11"),ve("Predictor12","PredictorAdd12"),ve("Predictor13","PredictorAdd13");var Gc=pt.PredictorAdd2;Tr("ColorIndexInverseTransform","MapARGB","32b",function(g){return g>>8&255},function(g){return g}),Tr("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(g){return g},function(g){return g>>8&255});var Oi,Dn=pt.ColorIndexInverseTransform,Cn=pt.MapARGB,Eu=pt.VP8LColorIndexInverseTransformAlpha,Vc=pt.MapAlpha,Pa=pt.VP8LPredictorsAdd=[];Pa.length=16,(pt.VP8LPredictors=[]).length=16,(pt.VP8LPredictorsAdd_C=[]).length=16,(pt.VP8LPredictors_C=[]).length=16;var Tn,Nn,Gs,ro,io,fl,Vs,sa,Ro,Ia,no,oa,pl,aa,Oo,dn,Cs,Ts,Pn,ii,yi,_i,ji,Ma,la,qc,La,Hc,Do=s(511),$e=s(2041),Cu=s(225),Jl=s(767),Xl=0,bh=$e,Fe=Cu,Fn=Jl,qs=Do,Tu=0,Kl=1,wh=2,Yl=3,Pu=4,Ld=5,Ba=6,Mi=7,Ql=8,tc=9,Iu=10,Df=[2,3,7],Nf=[3,3,11],Bd=[280,256,256,256,40],No=[0,1,1,1,0],Mu=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],or=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],pr=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],xh=8,ec=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Lu=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],zn=null,kd=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Fo=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Rd=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Bu=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],tn=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],fn=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Ff=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],so=[],In=[],zo=[],Od=1,Ah=2,oo=[],gs=[];ie("UpsampleRgbLinePair",si,3),ie("UpsampleBgrLinePair",fr,3),ie("UpsampleRgbaLinePair",Ss,4),ie("UpsampleBgraLinePair",Zi,4),ie("UpsampleArgbLinePair",jr,4),ie("UpsampleRgba4444LinePair",Or,2),ie("UpsampleRgb565LinePair",Qi,2);var Dd=pt.UpsampleRgbLinePair,Nd=pt.UpsampleBgrLinePair,ca=pt.UpsampleRgbaLinePair,ku=pt.UpsampleBgraLinePair,Wc=pt.UpsampleArgbLinePair,Ru=pt.UpsampleRgba4444LinePair,Ou=pt.UpsampleRgb565LinePair,rc=16,ka=1<<rc-1,jo=-227,$c=482,Du=6,ic=(256<<Du)-1,Sh=0,Fd=s(256),Eh=s(256),zf=s(256),x=s(256),c=s($c-jo),d=s($c-jo);na("YuvToRgbRow",si,3),na("YuvToBgrRow",fr,3),na("YuvToRgbaRow",Ss,4),na("YuvToBgraRow",Zi,4),na("YuvToArgbRow",jr,4),na("YuvToRgba4444Row",Or,2),na("YuvToRgb565Row",Qi,2);var y=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],_=[0,2,8],S=[8,7,6,4,4,2,2,2,1,1,1,1],B=1;this.WebPDecodeRGBA=function(g,b,C,M,O){var j=Kl,G=new Fc,H=new ai;G.ba=H,H.S=j,H.width=[H.width],H.height=[H.height];var q=H.width,X=H.height,ct=new At;if(ct==null||g==null)var et=2;else t(ct!=null),et=Wl(g,b,C,ct.width,ct.height,ct.Pd,ct.Qd,ct.format,null);if(et!=0?q=0:(q!=null&&(q[0]=ct.width[0]),X!=null&&(X[0]=ct.height[0]),q=1),q){H.width=H.width[0],H.height=H.height[0],M!=null&&(M[0]=H.width),O!=null&&(O[0]=H.height);t:{if(M=new xs,(O=new ql).data=g,O.w=b,O.ha=C,O.kd=1,b=[0],t(O!=null),((g=Wl(O.data,O.w,O.ha,null,null,null,b,null,O))==0||g==7)&&b[0]&&(g=4),(b=g)==0){if(t(G!=null),M.data=O.data,M.w=O.w+O.offset,M.ha=O.ha-O.offset,M.put=Gt,M.ac=Nt,M.bc=Ht,M.ma=G,O.xa){if((g=ur())==null){G=1;break t}if(function(ht,ft){var Mt=[0],St=[0],gt=[0];e:for(;;){if(ht==null)return 0;if(ft==null)return ht.a=2,0;if(ht.l=ft,ht.a=0,Dt(ht.m,ft.data,ft.w,ft.ha),!Ct(ht.m,Mt,St,gt)){ht.a=3;break e}if(ht.xb=Ah,ft.width=Mt[0],ft.height=St[0],!Gr(Mt[0],St[0],1,ht,null))break e;return 1}return t(ht.a!=0),0}(g,M)){if(M=(b=Ta(M.width,M.height,G.Oa,G.ba))==0){e:{M=g;r:for(;;){if(M==null){M=0;break e}if(t(M.s.yc!=null),t(M.s.Ya!=null),t(0<M.s.Wb),t((C=M.l)!=null),t((O=C.ma)!=null),M.xb!=0){if(M.ca=O.ba,M.tb=O.tb,t(M.ca!=null),!ul(O.Oa,C,Yl)){M.a=2;break r}if(!pi(M,C.width)||C.da)break r;if((C.da||Fr(M.ca.S))&&te(),11>M.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),M.ca.f.kb.F!=null&&te()),M.Pb&&0<M.s.ua&&M.s.vb.X==null&&!Xe(M.s.vb,M.s.Wa.Xa)){M.a=1;break r}M.xb=0}if(!$r(M,M.V,M.Ba,M.c,M.i,C.o,xr))break r;O.Dc=M.Ma,M=1;break e}t(M.a!=0),M=0}M=!M}M&&(b=g.a)}else b=g.a}else{if((g=new To)==null){G=1;break t}if(g.Fa=O.na,g.P=O.P,g.qc=O.Sa,ps(g,M)){if((b=Ta(M.width,M.height,G.Oa,G.ba))==0){if(g.Aa=0,C=G.Oa,t((O=g)!=null),C!=null){if(0<(q=0>(q=C.Md)?0:100<q?255:255*q/100)){for(X=ct=0;4>X;++X)12>(et=O.pb[X]).lc&&(et.ia=q*S[0>et.lc?0:et.lc]>>3),ct|=et.ia;ct&&(alert("todo:VP8InitRandom"),O.ia=1)}O.Ga=C.Id,100<O.Ga?O.Ga=100:0>O.Ga&&(O.Ga=0)}xn(g,M)||(b=g.a)}}else b=g.a}b==0&&G.Oa!=null&&G.Oa.fd&&(b=Uc(G.ba))}G=b}j=G!=0?null:11>j?H.f.RGBA.eb:H.f.kb.y}else j=null;return j};var k=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function m(pt,zt){for(var Rt="",at=0;at<4;at++)Rt+=String.fromCharCode(pt[zt++]);return Rt}function w(pt,zt){return(pt[zt+0]<<0|pt[zt+1]<<8|pt[zt+2]<<16)>>>0}function A(pt,zt){return(pt[zt+0]<<0|pt[zt+1]<<8|pt[zt+2]<<16|pt[zt+3]<<24)>>>0}new f;var P=[0],I=[0],N=[],F=new f,Z=e,U=function(pt,zt){var Rt={},at=0,dt=!1,kt=0,xt=0;if(Rt.frames=[],!function(Tt,Lt,Ut,Zt){for(var Kt=0;Kt<Zt;Kt++)if(Tt[Lt+Kt]!=Ut.charCodeAt(Kt))return!0;return!1}(pt,zt,"RIFF",4)){var ue,oe;for(A(pt,zt+=4),zt+=8;zt<pt.length;){var he=m(pt,zt),Dt=A(pt,zt+=4);zt+=4;var Qt=Dt+(1&Dt);switch(he){case"VP8 ":case"VP8L":Rt.frames[at]===void 0&&(Rt.frames[at]={}),(it=Rt.frames[at]).src_off=dt?xt:zt-8,it.src_size=kt+Dt+8,at++,dt&&(dt=!1,kt=0,xt=0);break;case"VP8X":(it=Rt.header={}).feature_flags=pt[zt];var ee=zt+4;it.canvas_width=1+w(pt,ee),ee+=3,it.canvas_height=1+w(pt,ee),ee+=3;break;case"ALPH":dt=!0,kt=Qt+8,xt=zt-8;break;case"ANIM":(it=Rt.header).bgcolor=A(pt,zt),ee=zt+4,it.loop_count=(ue=pt)[(oe=ee)+0]<<0|ue[oe+1]<<8,ee+=2;break;case"ANMF":var xe,it;(it=Rt.frames[at]={}).offset_x=2*w(pt,zt),zt+=3,it.offset_y=2*w(pt,zt),zt+=3,it.width=1+w(pt,zt),zt+=3,it.height=1+w(pt,zt),zt+=3,it.duration=w(pt,zt),zt+=3,xe=pt[zt++],it.dispose=1&xe,it.blend=xe>>1&1}he!="ANMF"&&(zt+=Qt)}return Rt}}(Z,0);U.response=Z,U.rgbaoutput=!0,U.dataurl=!1;var z=U.header?U.header:null,J=U.frames?U.frames:null;if(z){z.loop_counter=z.loop_count,P=[z.canvas_height],I=[z.canvas_width];for(var nt=0;nt<J.length&&J[nt].blend!=0;nt++);}var mt=J[0],Et=F.WebPDecodeRGBA(Z,mt.src_off,mt.src_size,I,P);mt.rgba=Et,mt.imgwidth=I[0],mt.imgheight=P[0];for(var bt=0;bt<I[0]*P[0]*4;bt++)N[bt]=Et[bt];return this.width=I,this.height=P,this.data=N,this}(function(e){var t=function(){return typeof jx=="function"},r=function(P,I,N,F){var Z=4,U=a;switch(F){case e.image_compression.FAST:Z=1,U=s;break;case e.image_compression.MEDIUM:Z=6,U=o;break;case e.image_compression.SLOW:Z=9,U=f}P=i(P,I,N,U);var z=jx(P,{level:Z});return e.__addimage__.arrayBufferToBinaryString(z)},i=function(P,I,N,F){for(var Z,U,z,J=P.length/I,nt=new Uint8Array(P.length+J),mt=w(),Et=0;Et<J;Et+=1){if(z=Et*I,Z=P.subarray(z,z+I),F)nt.set(F(Z,N,U),z+Et);else{for(var bt,pt=mt.length,zt=[];bt<pt;bt+=1)zt[bt]=mt[bt](Z,N,U);var Rt=A(zt.concat());nt.set(zt[Rt],z+Et)}U=Z}return nt},n=function(P){var I=Array.apply([],P);return I.unshift(0),I},s=function(P,I){var N,F=[],Z=P.length;F[0]=1;for(var U=0;U<Z;U+=1)N=P[U-I]||0,F[U+1]=P[U]-N+256&255;return F},a=function(P,I,N){var F,Z=[],U=P.length;Z[0]=2;for(var z=0;z<U;z+=1)F=N&&N[z]||0,Z[z+1]=P[z]-F+256&255;return Z},o=function(P,I,N){var F,Z,U=[],z=P.length;U[0]=3;for(var J=0;J<z;J+=1)F=P[J-I]||0,Z=N&&N[J]||0,U[J+1]=P[J]+256-(F+Z>>>1)&255;return U},f=function(P,I,N){var F,Z,U,z,J=[],nt=P.length;J[0]=4;for(var mt=0;mt<nt;mt+=1)F=P[mt-I]||0,Z=N&&N[mt]||0,U=N&&N[mt-I]||0,z=m(F,Z,U),J[mt+1]=P[mt]-z+256&255;return J},m=function(P,I,N){if(P===I&&I===N)return P;var F=Math.abs(I-N),Z=Math.abs(P-N),U=Math.abs(P+I-N-N);return F<=Z&&F<=U?P:Z<=U?I:N},w=function(){return[n,s,a,o,f]},A=function(P){var I=P.map(function(N){return N.reduce(function(F,Z){return F+Math.abs(Z)},0)});return I.indexOf(Math.min.apply(null,I))};e.processPNG=function(P,I,N,F){var Z,U,z,J,nt,mt,Et,bt,pt,zt,Rt,at,dt,kt,xt,ue=this.decode.FLATE_DECODE,oe="";if(this.__addimage__.isArrayBuffer(P)&&(P=new Uint8Array(P)),this.__addimage__.isArrayBufferView(P)){if(P=(z=new rrt(P)).imgData,U=z.bits,Z=z.colorSpace,nt=z.colors,[4,6].indexOf(z.colorType)!==-1){if(z.bits===8){pt=(bt=z.pixelBitlength==32?new Uint32Array(z.decodePixels().buffer):z.pixelBitlength==16?new Uint16Array(z.decodePixels().buffer):new Uint8Array(z.decodePixels().buffer)).length,Rt=new Uint8Array(pt*z.colors),zt=new Uint8Array(pt);var he,Dt=z.pixelBitlength-z.bits;for(kt=0,xt=0;kt<pt;kt++){for(dt=bt[kt],he=0;he<Dt;)Rt[xt++]=dt>>>he&255,he+=z.bits;zt[kt]=dt>>>he&255}}if(z.bits===16){pt=(bt=new Uint32Array(z.decodePixels().buffer)).length,Rt=new Uint8Array(pt*(32/z.pixelBitlength)*z.colors),zt=new Uint8Array(pt*(32/z.pixelBitlength)),at=z.colors>1,kt=0,xt=0;for(var Qt=0;kt<pt;)dt=bt[kt++],Rt[xt++]=dt>>>0&255,at&&(Rt[xt++]=dt>>>16&255,dt=bt[kt++],Rt[xt++]=dt>>>0&255),zt[Qt++]=dt>>>16&255;U=8}F!==e.image_compression.NONE&&t()?(P=r(Rt,z.width*z.colors,z.colors,F),Et=r(zt,z.width,1,F)):(P=Rt,Et=zt,ue=void 0)}if(z.colorType===3&&(Z=this.color_spaces.INDEXED,mt=z.palette,z.transparency.indexed)){var ee=z.transparency.indexed,xe=0;for(kt=0,pt=ee.length;kt<pt;++kt)xe+=ee[kt];if((xe/=255)===pt-1&&ee.indexOf(0)!==-1)J=[ee.indexOf(0)];else if(xe!==pt){for(bt=z.decodePixels(),zt=new Uint8Array(bt.length),kt=0,pt=bt.length;kt<pt;kt++)zt[kt]=ee[bt[kt]];Et=r(zt,z.width,1)}}var it=function(Tt){var Lt;switch(Tt){case e.image_compression.FAST:Lt=11;break;case e.image_compression.MEDIUM:Lt=13;break;case e.image_compression.SLOW:Lt=14;break;default:Lt=12}return Lt}(F);return ue===this.decode.FLATE_DECODE&&(oe="/Predictor "+it+" "),oe+="/Colors "+nt+" /BitsPerComponent "+U+" /Columns "+z.width,(this.__addimage__.isArrayBuffer(P)||this.__addimage__.isArrayBufferView(P))&&(P=this.__addimage__.arrayBufferToBinaryString(P)),(Et&&this.__addimage__.isArrayBuffer(Et)||this.__addimage__.isArrayBufferView(Et))&&(Et=this.__addimage__.arrayBufferToBinaryString(Et)),{alias:N,data:P,index:I,filter:ue,decodeParameters:oe,transparency:J,palette:mt,sMask:Et,predictor:it,width:z.width,height:z.height,bitsPerComponent:U,colorSpace:Z}}}})(Dr.API),function(e){e.processGIF89A=function(t,r,i,n){var s=new irt(t),a=s.width,o=s.height,f=[];s.decodeAndBlitFrameRGBA(0,f);var m={data:f,width:a,height:o},w=new V2(100).encode(m,100);return e.processJPEG.call(this,w,r,i,n)},e.processGIF87A=e.processGIF89A}(Dr.API),gc.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:n,green:i,blue:r,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},gc.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(r){nn.log("bit decode error:"+r)}},gc.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),r=t%4;for(e=this.height-1;e>=0;e--){for(var i=this.bottom_up?e:this.height-1-e,n=0;n<t;n++)for(var s=this.datav.getUint8(this.pos++,!0),a=i*this.width*4+8*n*4,o=0;o<8&&8*n+o<this.width;o++){var f=this.palette[s>>7-o&1];this.data[a+4*o]=f.blue,this.data[a+4*o+1]=f.green,this.data[a+4*o+2]=f.red,this.data[a+4*o+3]=255}r!==0&&(this.pos+=4-r)}},gc.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,r=this.height-1;r>=0;r--){for(var i=this.bottom_up?r:this.height-1-r,n=0;n<e;n++){var s=this.datav.getUint8(this.pos++,!0),a=i*this.width*4+2*n*4,o=s>>4,f=15&s,m=this.palette[o];if(this.data[a]=m.blue,this.data[a+1]=m.green,this.data[a+2]=m.red,this.data[a+3]=255,2*n+1>=this.width)break;m=this.palette[f],this.data[a+4]=m.blue,this.data[a+4+1]=m.green,this.data[a+4+2]=m.red,this.data[a+4+3]=255}t!==0&&(this.pos+=4-t)}},gc.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,i=0;i<this.width;i++){var n=this.datav.getUint8(this.pos++,!0),s=r*this.width*4+4*i;if(n<this.palette.length){var a=this.palette[n];this.data[s]=a.red,this.data[s+1]=a.green,this.data[s+2]=a.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}e!==0&&(this.pos+=4-e)}},gc.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var i=this.bottom_up?r:this.height-1-r,n=0;n<this.width;n++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(s&t)/t*255|0,o=(s>>5&t)/t*255|0,f=(s>>10&t)/t*255|0,m=s>>15?255:0,w=i*this.width*4+4*n;this.data[w]=f,this.data[w+1]=o,this.data[w+2]=a,this.data[w+3]=m}this.pos+=e}},gc.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),r=parseInt("111111",2),i=this.height-1;i>=0;i--){for(var n=this.bottom_up?i:this.height-1-i,s=0;s<this.width;s++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&t)/t*255|0,f=(a>>5&r)/r*255|0,m=(a>>11)/t*255|0,w=n*this.width*4+4*s;this.data[w]=m,this.data[w+1]=f,this.data[w+2]=o,this.data[w+3]=255}this.pos+=e}},gc.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var i=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=t*this.width*4+4*r;this.data[a]=s,this.data[a+1]=n,this.data[a+2]=i,this.data[a+3]=255}this.pos+=this.width%4}},gc.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var i=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*r;this.data[o]=s,this.data[o+1]=n,this.data[o+2]=i,this.data[o+3]=a}},gc.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,r,i,n){var s=new gc(t,!1),a=s.width,o=s.height,f={data:s.getData(),width:a,height:o},m=new V2(100).encode(f,100);return e.processJPEG.call(this,m,r,i,n)}}(Dr.API),HI.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,r,i,n){var s=new HI(t),a=s.width,o=s.height,f={data:s.getData(),width:a,height:o},m=new V2(100).encode(f,100);return e.processJPEG.call(this,m,r,i,n)}}(Dr.API),Dr.API.processRGBA=function(e,t,r){for(var i=e.data,n=i.length,s=new Uint8Array(n/4*3),a=new Uint8Array(n/4),o=0,f=0,m=0;m<n;m+=4){var w=i[m],A=i[m+1],P=i[m+2],I=i[m+3];s[o++]=w,s[o++]=A,s[o++]=P,a[f++]=I}var N=this.__addimage__.arrayBufferToBinaryString(s);return{alpha:this.__addimage__.arrayBufferToBinaryString(a),data:N,index:t,alias:r,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},Dr.API.setLanguage=function(e){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]!==void 0&&(this.internal.languageSettings.languageCode=e,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},dp=Dr.API,sy=dp.getCharWidthsArray=function(e,t){var r,i,n=(t=t||{}).font||this.internal.getFont(),s=t.fontSize||this.internal.getFontSize(),a=t.charSpace||this.internal.getCharSpace(),o=t.widths?t.widths:n.metadata.Unicode.widths,f=o.fof?o.fof:1,m=t.kerning?t.kerning:n.metadata.Unicode.kerning,w=m.fof?m.fof:1,A=t.doKerning!==!1,P=0,I=e.length,N=0,F=o[0]||f,Z=[];for(r=0;r<I;r++)i=e.charCodeAt(r),typeof n.metadata.widthOfString=="function"?Z.push((n.metadata.widthOfGlyph(n.metadata.characterToGlyph(i))+a*(1e3/s)||0)/1e3):(P=A&&Gi(m[i])==="object"&&!isNaN(parseInt(m[i][N],10))?m[i][N]/w:0,Z.push((o[i]||F)/f+P)),N=i;return Z},UI=dp.getStringUnitWidth=function(e,t){var r=(t=t||{}).fontSize||this.internal.getFontSize(),i=t.font||this.internal.getFont(),n=t.charSpace||this.internal.getCharSpace();return dp.processArabic&&(e=dp.processArabic(e)),typeof i.metadata.widthOfString=="function"?i.metadata.widthOfString(e,r,n)/r:sy.apply(this,arguments).reduce(function(s,a){return s+a},0)},GI=function(e,t,r,i){for(var n=[],s=0,a=e.length,o=0;s!==a&&o+t[s]<r;)o+=t[s],s++;n.push(e.slice(0,s));var f=s;for(o=0;s!==a;)o+t[s]>i&&(n.push(e.slice(f,s)),o=0,f=s),o+=t[s],s++;return f!==s&&n.push(e.slice(f,s)),n},VI=function(e,t,r){r||(r={});var i,n,s,a,o,f,m,w=[],A=[w],P=r.textIndent||0,I=0,N=0,F=e.split(" "),Z=sy.apply(this,[" ",r])[0];if(f=r.lineIndent===-1?F[0].length+2:r.lineIndent||0){var U=Array(f).join(" "),z=[];F.map(function(nt){(nt=nt.split(/\s*\n/)).length>1?z=z.concat(nt.map(function(mt,Et){return(Et&&mt.length?`
`:"")+mt})):z.push(nt[0])}),F=z,f=UI.apply(this,[U,r])}for(s=0,a=F.length;s<a;s++){var J=0;if(i=F[s],f&&i[0]==`
`&&(i=i.substr(1),J=1),P+I+(N=(n=sy.apply(this,[i,r])).reduce(function(nt,mt){return nt+mt},0))>t||J){if(N>t){for(o=GI.apply(this,[i,n,t-(P+I),t]),w.push(o.shift()),w=[o.pop()];o.length;)A.push([o.shift()]);N=n.slice(i.length-(w[0]?w[0].length:0)).reduce(function(nt,mt){return nt+mt},0)}else w=[i];A.push(w),P=N+f,I=Z}else w.push(i),P+=I+N,I=Z}return m=f?function(nt,mt){return(mt?U:"")+nt.join(" ")}:function(nt){return nt.join(" ")},A.map(m)},dp.splitTextToSize=function(e,t,r){var i,n=(r=r||{}).fontSize||this.internal.getFontSize(),s=(function(w){if(w.widths&&w.kerning)return{widths:w.widths,kerning:w.kerning};var A=this.internal.getFont(w.fontName,w.fontStyle);return A.metadata.Unicode?{widths:A.metadata.Unicode.widths||{0:1},kerning:A.metadata.Unicode.kerning||{}}:{font:A.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,r);i=Array.isArray(e)?e:String(e).split(/\r?\n/);var a=1*this.internal.scaleFactor*t/n;s.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/n:0,s.lineIndent=r.lineIndent;var o,f,m=[];for(o=0,f=i.length;o<f;o++)m=m.concat(VI.apply(this,[i[o],a,s]));return m},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",r={},i={},n=0;n<t.length;n++)r[t[n]]="0123456789abcdef"[n],i["0123456789abcdef"[n]]=t[n];var s=function(A){return"0x"+parseInt(A,10).toString(16)},a=e.__fontmetrics__.compress=function(A){var P,I,N,F,Z=["{"];for(var U in A){if(P=A[U],isNaN(parseInt(U,10))?I="'"+U+"'":(U=parseInt(U,10),I=(I=s(U).slice(2)).slice(0,-1)+i[I.slice(-1)]),typeof P=="number")P<0?(N=s(P).slice(3),F="-"):(N=s(P).slice(2),F=""),N=F+N.slice(0,-1)+i[N.slice(-1)];else{if(Gi(P)!=="object")throw new Error("Don't know what to do with value type "+Gi(P)+".");N=a(P)}Z.push(I+N)}return Z.push("}"),Z.join("")},o=e.__fontmetrics__.uncompress=function(A){if(typeof A!="string")throw new Error("Invalid argument passed to uncompress.");for(var P,I,N,F,Z={},U=1,z=Z,J=[],nt="",mt="",Et=A.length-1,bt=1;bt<Et;bt+=1)(F=A[bt])=="'"?P?(N=P.join(""),P=void 0):P=[]:P?P.push(F):F=="{"?(J.push([z,N]),z={},N=void 0):F=="}"?((I=J.pop())[0][I[1]]=z,N=void 0,z=I[0]):F=="-"?U=-1:N===void 0?r.hasOwnProperty(F)?(nt+=r[F],N=parseInt(nt,16)*U,U=1,nt=""):nt+=F:r.hasOwnProperty(F)?(mt+=r[F],z[N]=parseInt(mt,16)*U,U=1,N=void 0,mt=""):mt+=F;return Z},f={codePages:["WinAnsiEncoding"],WinAnsiEncoding:o("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},m={Unicode:{Courier:f,"Courier-Bold":f,"Courier-BoldOblique":f,"Courier-Oblique":f,Helvetica:f,"Helvetica-Bold":f,"Helvetica-BoldOblique":f,"Helvetica-Oblique":f,"Times-Roman":f,"Times-Bold":f,"Times-BoldItalic":f,"Times-Italic":f}},w={Unicode:{"Courier-Oblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":o("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":o("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:o("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":o("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:o("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":o("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":o("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":o("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":o("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(A){var P=A.font,I=w.Unicode[P.postScriptName];I&&(P.metadata.Unicode={},P.metadata.Unicode.widths=I.widths,P.metadata.Unicode.kerning=I.kerning);var N=m.Unicode[P.postScriptName];N&&(P.metadata.Unicode.encoding=N,P.encoding=N.codePages[0])}])}(Dr.API),function(e){var t=function(r){for(var i=r.length,n=new Uint8Array(i),s=0;s<i;s++)n[s]=r.charCodeAt(s);return n};e.API.events.push(["addFont",function(r){var i=void 0,n=r.font,s=r.instance;if(!n.isStandardFont){if(s===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");if(typeof(i=s.existsFileInVFS(n.postScriptName)===!1?s.loadFile(n.postScriptName):s.getFileFromVFS(n.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");(function(a,o){o=/^\x00\x01\x00\x00/.test(o)?t(o):t(Gm(o)),a.metadata=e.API.TTFFont.open(o),a.metadata.Unicode=a.metadata.Unicode||{encoding:{},kerning:{},widths:[]},a.metadata.glyIdsUsed=[0]})(n,i)}}])}(Dr),function(e){function t(){return(Nr.canvg?Promise.resolve(Nr.canvg):Gw(()=>import("./index.es-BR8y8uSW-DmctbIix-5defb91e.js"),[])).catch(function(r){return Promise.reject(new Error("Could not load canvg: "+r))}).then(function(r){return r.default?r.default:r})}Dr.API.addSvgAsImage=function(r,i,n,s,a,o,f,m){if(isNaN(i)||isNaN(n))throw nn.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(s)||isNaN(a))throw nn.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var w=document.createElement("canvas");w.width=s,w.height=a;var A=w.getContext("2d");A.fillStyle="#fff",A.fillRect(0,0,w.width,w.height);var P={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},I=this;return t().then(function(N){return N.fromString(A,r,P)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(N){return N.render(P)}).then(function(){I.addImage(w.toDataURL("image/jpeg",1),i,n,s,a,f,m)})}}(),Dr.API.putTotalPages=function(e){var t,r=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),r=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),r=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var i=1;i<=this.internal.getNumberOfPages();i++)for(var n=0;n<this.internal.pages[i].length;n++)this.internal.pages[i][n]=this.internal.pages[i][n].replace(t,r);return this},Dr.API.viewerPreferences=function(e,t){var r;e=e||{},t=t||!1;var i,n,s,a={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(a),f=[],m=0,w=0,A=0;function P(N,F){var Z,U=!1;for(Z=0;Z<N.length;Z+=1)N[Z]===F&&(U=!0);return U}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(a)),this.internal.viewerpreferences.isSubscribed=!1),r=this.internal.viewerpreferences.configuration,e==="reset"||t===!0){var I=o.length;for(A=0;A<I;A+=1)r[o[A]].value=r[o[A]].defaultValue,r[o[A]].explicitSet=!1}if(Gi(e)==="object"){for(n in e)if(s=e[n],P(o,n)&&s!==void 0){if(r[n].type==="boolean"&&typeof s=="boolean")r[n].value=s;else if(r[n].type==="name"&&P(r[n].valueSet,s))r[n].value=s;else if(r[n].type==="integer"&&Number.isInteger(s))r[n].value=s;else if(r[n].type==="array"){for(m=0;m<s.length;m+=1)if(i=!0,s[m].length===1&&typeof s[m][0]=="number")f.push(String(s[m]-1));else if(s[m].length>1){for(w=0;w<s[m].length;w+=1)typeof s[m][w]!="number"&&(i=!1);i===!0&&f.push([s[m][0]-1,s[m][1]-1].join(" "))}r[n].value="["+f.join(" ")+"]"}else r[n].value=r[n].defaultValue;r[n].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var N,F=[];for(N in r)r[N].explicitSet===!0&&(r[N].type==="name"?F.push("/"+N+" /"+r[N].value):F.push("/"+N+" "+r[N].value));F.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+F.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=r,this},function(e){var t=function(){var i='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',n=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),s=unescape(encodeURIComponent(i)),a=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),o=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),f=unescape(encodeURIComponent("</x:xmpmeta>")),m=s.length+a.length+o.length+n.length+f.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+m+" >>"),this.internal.write("stream"),this.internal.write(n+s+a+o+f),this.internal.write("endstream"),this.internal.write("endobj")},r=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(i,n){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:i,namespaceuri:n||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",r),this.internal.events.subscribe("postPutResources",t)),this}}(Dr.API),function(e){var t=e.API,r=t.pdfEscape16=function(s,a){for(var o,f=a.metadata.Unicode.widths,m=["","0","00","000","0000"],w=[""],A=0,P=s.length;A<P;++A){if(o=a.metadata.characterToGlyph(s.charCodeAt(A)),a.metadata.glyIdsUsed.push(o),a.metadata.toUnicode[o]=s.charCodeAt(A),f.indexOf(o)==-1&&(f.push(o),f.push([parseInt(a.metadata.widthOfGlyph(o),10)])),o=="0")return w.join("");o=o.toString(16),w.push(m[4-o.length],o)}return w.join("")},i=function(s){var a,o,f,m,w,A,P;for(w=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,f=[],A=0,P=(o=Object.keys(s).sort(function(I,N){return I-N})).length;A<P;A++)a=o[A],f.length>=100&&(w+=`
`+f.length+` beginbfchar
`+f.join(`
`)+`
endbfchar`,f=[]),s[a]!==void 0&&s[a]!==null&&typeof s[a].toString=="function"&&(m=("0000"+s[a].toString(16)).slice(-4),a=("0000"+(+a).toString(16)).slice(-4),f.push("<"+a+"><"+m+">"));return f.length&&(w+=`
`+f.length+` beginbfchar
`+f.join(`
`)+`
endbfchar
`),w+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(s){(function(a){var o=a.font,f=a.out,m=a.newObject,w=a.putStream;if(o.metadata instanceof e.API.TTFFont&&o.encoding==="Identity-H"){for(var A=o.metadata.Unicode.widths,P=o.metadata.subset.encode(o.metadata.glyIdsUsed,1),I="",N=0;N<P.length;N++)I+=String.fromCharCode(P[N]);var F=m();w({data:I,addLength1:!0,objectId:F}),f("endobj");var Z=m();w({data:i(o.metadata.toUnicode),addLength1:!0,objectId:Z}),f("endobj");var U=m();f("<<"),f("/Type /FontDescriptor"),f("/FontName /"+mp(o.fontName)),f("/FontFile2 "+F+" 0 R"),f("/FontBBox "+e.API.PDFObject.convert(o.metadata.bbox)),f("/Flags "+o.metadata.flags),f("/StemV "+o.metadata.stemV),f("/ItalicAngle "+o.metadata.italicAngle),f("/Ascent "+o.metadata.ascender),f("/Descent "+o.metadata.decender),f("/CapHeight "+o.metadata.capHeight),f(">>"),f("endobj");var z=m();f("<<"),f("/Type /Font"),f("/BaseFont /"+mp(o.fontName)),f("/FontDescriptor "+U+" 0 R"),f("/W "+e.API.PDFObject.convert(A)),f("/CIDToGIDMap /Identity"),f("/DW 1000"),f("/Subtype /CIDFontType2"),f("/CIDSystemInfo"),f("<<"),f("/Supplement 0"),f("/Registry (Adobe)"),f("/Ordering ("+o.encoding+")"),f(">>"),f(">>"),f("endobj"),o.objectNumber=m(),f("<<"),f("/Type /Font"),f("/Subtype /Type0"),f("/ToUnicode "+Z+" 0 R"),f("/BaseFont /"+mp(o.fontName)),f("/Encoding /"+o.encoding),f("/DescendantFonts ["+z+" 0 R]"),f(">>"),f("endobj"),o.isAlreadyPutted=!0}})(s)}]),t.events.push(["putFont",function(s){(function(a){var o=a.font,f=a.out,m=a.newObject,w=a.putStream;if(o.metadata instanceof e.API.TTFFont&&o.encoding==="WinAnsiEncoding"){for(var A=o.metadata.rawData,P="",I=0;I<A.length;I++)P+=String.fromCharCode(A[I]);var N=m();w({data:P,addLength1:!0,objectId:N}),f("endobj");var F=m();w({data:i(o.metadata.toUnicode),addLength1:!0,objectId:F}),f("endobj");var Z=m();f("<<"),f("/Descent "+o.metadata.decender),f("/CapHeight "+o.metadata.capHeight),f("/StemV "+o.metadata.stemV),f("/Type /FontDescriptor"),f("/FontFile2 "+N+" 0 R"),f("/Flags 96"),f("/FontBBox "+e.API.PDFObject.convert(o.metadata.bbox)),f("/FontName /"+mp(o.fontName)),f("/ItalicAngle "+o.metadata.italicAngle),f("/Ascent "+o.metadata.ascender),f(">>"),f("endobj"),o.objectNumber=m();for(var U=0;U<o.metadata.hmtx.widths.length;U++)o.metadata.hmtx.widths[U]=parseInt(o.metadata.hmtx.widths[U]*(1e3/o.metadata.head.unitsPerEm));f("<</Subtype/TrueType/Type/Font/ToUnicode "+F+" 0 R/BaseFont/"+mp(o.fontName)+"/FontDescriptor "+Z+" 0 R/Encoding/"+o.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(o.metadata.hmtx.widths)+">>"),f("endobj"),o.isAlreadyPutted=!0}})(s)}]);var n=function(s){var a,o=s.text||"",f=s.x,m=s.y,w=s.options||{},A=s.mutex||{},P=A.pdfEscape,I=A.activeFontKey,N=A.fonts,F=I,Z="",U=0,z="",J=N[F].encoding;if(N[F].encoding!=="Identity-H")return{text:o,x:f,y:m,options:w,mutex:A};for(z=o,F=I,Array.isArray(o)&&(z=o[0]),U=0;U<z.length;U+=1)N[F].metadata.hasOwnProperty("cmap")&&(a=N[F].metadata.cmap.unicode.codeMap[z[U].charCodeAt(0)]),a||z[U].charCodeAt(0)<256&&N[F].metadata.hasOwnProperty("Unicode")?Z+=z[U]:Z+="";var nt="";return parseInt(F.slice(1))<14||J==="WinAnsiEncoding"?nt=P(Z,F).split("").map(function(mt){return mt.charCodeAt(0).toString(16)}).join(""):J==="Identity-H"&&(nt=r(Z,N[F])),A.isHex=!0,{text:nt,x:f,y:m,options:w,mutex:A}};t.events.push(["postProcessText",function(s){var a=s.text||"",o=[],f={text:a,x:s.x,y:s.y,options:s.options,mutex:s.mutex};if(Array.isArray(a)){var m=0;for(m=0;m<a.length;m+=1)Array.isArray(a[m])&&a[m].length===3?o.push([n(Object.assign({},f,{text:a[m][0]})).text,a[m][1],a[m][2]]):o.push(n(Object.assign({},f,{text:a[m]})).text);s.text=o}else s.text=n(Object.assign({},f,{text:a})).text}])}(Dr),function(e){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0},e.addFileToVFS=function(r,i){return t.call(this),this.internal.vFS[r]=i,this},e.getFileFromVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0?this.internal.vFS[r]:null}}(Dr.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(i){var n,s,a,o,f,m,w,A=t,P=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],I=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],N={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},F={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},Z=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],U=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),z=!1,J=0;this.__bidiEngine__={};var nt=function(at){var dt=at.charCodeAt(),kt=dt>>8,xt=F[kt];return xt!==void 0?A[256*xt+(255&dt)]:kt===252||kt===253?"AL":U.test(kt)?"L":kt===8?"R":"N"},mt=function(at){for(var dt,kt=0;kt<at.length;kt++){if((dt=nt(at.charAt(kt)))==="L")return!1;if(dt==="R")return!0}return!1},Et=function(at,dt,kt,xt){var ue,oe,he,Dt,Qt=dt[xt];switch(Qt){case"L":case"R":z=!1;break;case"N":case"AN":break;case"EN":z&&(Qt="AN");break;case"AL":z=!0,Qt="R";break;case"WS":Qt="N";break;case"CS":xt<1||xt+1>=dt.length||(ue=kt[xt-1])!=="EN"&&ue!=="AN"||(oe=dt[xt+1])!=="EN"&&oe!=="AN"?Qt="N":z&&(oe="AN"),Qt=oe===ue?oe:"N";break;case"ES":Qt=(ue=xt>0?kt[xt-1]:"B")==="EN"&&xt+1<dt.length&&dt[xt+1]==="EN"?"EN":"N";break;case"ET":if(xt>0&&kt[xt-1]==="EN"){Qt="EN";break}if(z){Qt="N";break}for(he=xt+1,Dt=dt.length;he<Dt&&dt[he]==="ET";)he++;Qt=he<Dt&&dt[he]==="EN"?"EN":"N";break;case"NSM":if(a&&!o){for(Dt=dt.length,he=xt+1;he<Dt&&dt[he]==="NSM";)he++;if(he<Dt){var ee=at[xt],xe=ee>=1425&&ee<=2303||ee===64286;if(ue=dt[he],xe&&(ue==="R"||ue==="AL")){Qt="R";break}}}Qt=xt<1||(ue=dt[xt-1])==="B"?"N":kt[xt-1];break;case"B":z=!1,n=!0,Qt=J;break;case"S":s=!0,Qt="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":z=!1;break;case"BN":Qt="N"}return Qt},bt=function(at,dt,kt){var xt=at.split("");return kt&&pt(xt,kt,{hiLevel:J}),xt.reverse(),dt&&dt.reverse(),xt.join("")},pt=function(at,dt,kt){var xt,ue,oe,he,Dt,Qt=-1,ee=at.length,xe=0,it=[],Tt=J?I:P,Lt=[];for(z=!1,n=!1,s=!1,ue=0;ue<ee;ue++)Lt[ue]=nt(at[ue]);for(oe=0;oe<ee;oe++){if(Dt=xe,it[oe]=Et(at,Lt,it,oe),xt=240&(xe=Tt[Dt][N[it[oe]]]),xe&=15,dt[oe]=he=Tt[xe][5],xt>0)if(xt===16){for(ue=Qt;ue<oe;ue++)dt[ue]=1;Qt=-1}else Qt=-1;if(Tt[xe][6])Qt===-1&&(Qt=oe);else if(Qt>-1){for(ue=Qt;ue<oe;ue++)dt[ue]=he;Qt=-1}Lt[oe]==="B"&&(dt[oe]=0),kt.hiLevel|=he}s&&function(Ut,Zt,Kt){for(var ne=0;ne<Kt;ne++)if(Ut[ne]==="S"){Zt[ne]=J;for(var re=ne-1;re>=0&&Ut[re]==="WS";re--)Zt[re]=J}}(Lt,dt,ee)},zt=function(at,dt,kt,xt,ue){if(!(ue.hiLevel<at)){if(at===1&&J===1&&!n)return dt.reverse(),void(kt&&kt.reverse());for(var oe,he,Dt,Qt,ee=dt.length,xe=0;xe<ee;){if(xt[xe]>=at){for(Dt=xe+1;Dt<ee&&xt[Dt]>=at;)Dt++;for(Qt=xe,he=Dt-1;Qt<he;Qt++,he--)oe=dt[Qt],dt[Qt]=dt[he],dt[he]=oe,kt&&(oe=kt[Qt],kt[Qt]=kt[he],kt[he]=oe);xe=Dt}xe++}}},Rt=function(at,dt,kt){var xt=at.split(""),ue={hiLevel:J};return kt||(kt=[]),pt(xt,kt,ue),function(oe,he,Dt){if(Dt.hiLevel!==0&&w)for(var Qt,ee=0;ee<oe.length;ee++)he[ee]===1&&(Qt=Z.indexOf(oe[ee]))>=0&&(oe[ee]=Z[Qt+1])}(xt,kt,ue),zt(2,xt,dt,kt,ue),zt(1,xt,dt,kt,ue),xt.join("")};return this.__bidiEngine__.doBidiReorder=function(at,dt,kt){if(function(ue,oe){if(oe)for(var he=0;he<ue.length;he++)oe[he]=he;o===void 0&&(o=mt(ue)),m===void 0&&(m=mt(ue))}(at,dt),a||!f||m)if(a&&f&&o^m)J=o?1:0,at=bt(at,dt,kt);else if(!a&&f&&m)J=o?1:0,at=Rt(at,dt,kt),at=bt(at,dt);else if(!a||o||f||m){if(a&&!f&&o^m)at=bt(at,dt),o?(J=0,at=Rt(at,dt,kt)):(J=1,at=Rt(at,dt,kt),at=bt(at,dt));else if(a&&o&&!f&&m)J=1,at=Rt(at,dt,kt),at=bt(at,dt);else if(!a&&!f&&o^m){var xt=w;o?(J=1,at=Rt(at,dt,kt),J=0,w=!1,at=Rt(at,dt,kt),w=xt):(J=0,at=Rt(at,dt,kt),at=bt(at,dt),J=1,w=!1,at=Rt(at,dt,kt),w=xt,at=bt(at,dt))}}else J=0,at=Rt(at,dt,kt);else J=o?1:0,at=Rt(at,dt,kt);return at},this.__bidiEngine__.setOptions=function(at){at&&(a=at.isInputVisual,f=at.isOutputVisual,o=at.isInputRtl,m=at.isOutputRtl,w=at.isSymmetricSwapping)},this.__bidiEngine__.setOptions(i),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],r=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(i){var n=i.text,s=(i.x,i.y,i.options||{}),a=(i.mutex,s.lang,[]);if(s.isInputVisual=typeof s.isInputVisual!="boolean"||s.isInputVisual,r.setOptions(s),Object.prototype.toString.call(n)==="[object Array]"){var o=0;for(a=[],o=0;o<n.length;o+=1)Object.prototype.toString.call(n[o])==="[object Array]"?a.push([r.doBidiReorder(n[o][0]),n[o][1],n[o][2]]):a.push([r.doBidiReorder(n[o])]);i.text=a}else i.text=r.doBidiReorder(n);r.setOptions({isInputVisual:!0})}])}(Dr),Dr.API.TTFFont=function(){function e(t){var r;if(this.rawData=t,r=this.contents=new Sd(t),this.contents.pos=4,r.readString(4)==="ttcf")throw new Error("TTCF not supported.");r.pos=0,this.parse(),this.subset=new _rt(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new nrt(this.contents),this.head=new ort(this),this.name=new hrt(this),this.cmap=new Fk(this),this.toUnicode={},this.hhea=new art(this),this.maxp=new drt(this),this.hmtx=new frt(this),this.post=new crt(this),this.os2=new lrt(this),this.loca=new yrt(this),this.glyf=new prt(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var t,r,i,n,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var a,o,f,m;for(m=[],a=0,o=(f=this.bbox).length;a<o;a++)t=f[a],m.push(Math.round(t*this.scaleFactor));return m}).call(this),this.stemV=0,this.post.exists?(i=255&(n=this.post.italic_angle),32768&(r=n>>16)&&(r=-(1+(65535^r))),this.italicAngle=+(r+"."+i)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(s=this.familyClass)===1||s===2||s===3||s===4||s===5||s===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(t){var r;return((r=this.cmap.unicode)!=null?r.codeMap[t]:void 0)||0},e.prototype.widthOfGlyph=function(t){var r;return r=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*r},e.prototype.widthOfString=function(t,r,i){var n,s,a,o;for(a=0,s=0,o=(t=""+t).length;0<=o?s<o:s>o;s=0<=o?++s:--s)n=t.charCodeAt(s),a+=this.widthOfGlyph(this.characterToGlyph(n))+i*(1e3/r)||0;return a*(r/1e3)},e.prototype.lineHeight=function(t,r){var i;return r==null&&(r=!1),i=r?this.lineGap:0,(this.ascender+i-this.decender)/1e3*t},e}();var kc,Sd=function(){function e(t){this.data=t??[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(t){return this.data[this.pos++]=t},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},e.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},e.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},e.prototype.readString=function(t){var r,i;for(i=[],r=0;0<=t?r<t:r>t;r=0<=t?++r:--r)i[r]=String.fromCharCode(this.readByte());return i.join("")},e.prototype.writeString=function(t){var r,i,n;for(n=[],r=0,i=t.length;0<=i?r<i:r>i;r=0<=i?++r:--r)n.push(this.writeByte(t.charCodeAt(r)));return n},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(t){return this.writeInt16(t)},e.prototype.readLongLong=function(){var t,r,i,n,s,a,o,f;return t=this.readByte(),r=this.readByte(),i=this.readByte(),n=this.readByte(),s=this.readByte(),a=this.readByte(),o=this.readByte(),f=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^r)+1099511627776*(255^i)+4294967296*(255^n)+16777216*(255^s)+65536*(255^a)+256*(255^o)+(255^f)+1):72057594037927940*t+281474976710656*r+1099511627776*i+4294967296*n+16777216*s+65536*a+256*o+f},e.prototype.writeLongLong=function(t){var r,i;return r=Math.floor(t/4294967296),i=4294967295&t,this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r),this.writeByte(i>>24&255),this.writeByte(i>>16&255),this.writeByte(i>>8&255),this.writeByte(255&i)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(t){return this.writeInt32(t)},e.prototype.read=function(t){var r,i;for(r=[],i=0;0<=t?i<t:i>t;i=0<=t?++i:--i)r.push(this.readByte());return r},e.prototype.write=function(t){var r,i,n,s;for(s=[],i=0,n=t.length;i<n;i++)r=t[i],s.push(this.writeByte(r));return s},e}(),nrt=function(){var e;function t(r){var i,n,s;for(this.scalarType=r.readInt(),this.tableCount=r.readShort(),this.searchRange=r.readShort(),this.entrySelector=r.readShort(),this.rangeShift=r.readShort(),this.tables={},n=0,s=this.tableCount;0<=s?n<s:n>s;n=0<=s?++n:--n)i={tag:r.readString(4),checksum:r.readInt(),offset:r.readInt(),length:r.readInt()},this.tables[i.tag]=i}return t.prototype.encode=function(r){var i,n,s,a,o,f,m,w,A,P,I,N,F;for(F in I=Object.keys(r).length,f=Math.log(2),A=16*Math.floor(Math.log(I)/f),a=Math.floor(A/f),w=16*I-A,(n=new Sd).writeInt(this.scalarType),n.writeShort(I),n.writeShort(A),n.writeShort(a),n.writeShort(w),s=16*I,m=n.pos+s,o=null,N=[],r)for(P=r[F],n.writeString(F),n.writeInt(e(P)),n.writeInt(m),n.writeInt(P.length),N=N.concat(P),F==="head"&&(o=m),m+=P.length;m%4;)N.push(0),m++;return n.write(N),i=2981146554-e(n.data),n.pos=o+8,n.writeUInt32(i),n.data},e=function(r){var i,n,s,a;for(r=zk.call(r);r.length%4;)r.push(0);for(s=new Sd(r),n=0,i=0,a=r.length;i<a;i=i+=4)n+=s.readUInt32();return 4294967295&n},t}(),srt={}.hasOwnProperty,_u=function(e,t){for(var r in t)srt.call(t,r)&&(e[r]=t[r]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};kc=function(){function e(t){var r;this.file=t,r=this.file.directory.tables[this.tag],this.exists=!!r,r&&(this.offset=r.offset,this.length=r.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var ort=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _u(t,kc),t.prototype.tag="head",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.revision=r.readInt(),this.checkSumAdjustment=r.readInt(),this.magicNumber=r.readInt(),this.flags=r.readShort(),this.unitsPerEm=r.readShort(),this.created=r.readLongLong(),this.modified=r.readLongLong(),this.xMin=r.readShort(),this.yMin=r.readShort(),this.xMax=r.readShort(),this.yMax=r.readShort(),this.macStyle=r.readShort(),this.lowestRecPPEM=r.readShort(),this.fontDirectionHint=r.readShort(),this.indexToLocFormat=r.readShort(),this.glyphDataFormat=r.readShort()},t.prototype.encode=function(r){var i;return(i=new Sd).writeInt(this.version),i.writeInt(this.revision),i.writeInt(this.checkSumAdjustment),i.writeInt(this.magicNumber),i.writeShort(this.flags),i.writeShort(this.unitsPerEm),i.writeLongLong(this.created),i.writeLongLong(this.modified),i.writeShort(this.xMin),i.writeShort(this.yMin),i.writeShort(this.xMax),i.writeShort(this.yMax),i.writeShort(this.macStyle),i.writeShort(this.lowestRecPPEM),i.writeShort(this.fontDirectionHint),i.writeShort(r),i.writeShort(this.glyphDataFormat),i.data},t}(),WI=function(){function e(t,r){var i,n,s,a,o,f,m,w,A,P,I,N,F,Z,U,z,J;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=r+t.readInt(),A=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(f=0;f<256;++f)this.codeMap[f]=t.readByte();break;case 4:for(I=t.readUInt16(),P=I/2,t.pos+=6,s=function(){var nt,mt;for(mt=[],f=nt=0;0<=P?nt<P:nt>P;f=0<=P?++nt:--nt)mt.push(t.readUInt16());return mt}(),t.pos+=2,F=function(){var nt,mt;for(mt=[],f=nt=0;0<=P?nt<P:nt>P;f=0<=P?++nt:--nt)mt.push(t.readUInt16());return mt}(),m=function(){var nt,mt;for(mt=[],f=nt=0;0<=P?nt<P:nt>P;f=0<=P?++nt:--nt)mt.push(t.readUInt16());return mt}(),w=function(){var nt,mt;for(mt=[],f=nt=0;0<=P?nt<P:nt>P;f=0<=P?++nt:--nt)mt.push(t.readUInt16());return mt}(),n=(this.length-t.pos+this.offset)/2,o=function(){var nt,mt;for(mt=[],f=nt=0;0<=n?nt<n:nt>n;f=0<=n?++nt:--nt)mt.push(t.readUInt16());return mt}(),f=U=0,J=s.length;U<J;f=++U)for(Z=s[f],i=z=N=F[f];N<=Z?z<=Z:z>=Z;i=N<=Z?++z:--z)w[f]===0?a=i+m[f]:(a=o[w[f]/2+(i-N)-(P-f)]||0)!==0&&(a+=m[f]),this.codeMap[i]=65535&a}t.pos=A}return e.encode=function(t,r){var i,n,s,a,o,f,m,w,A,P,I,N,F,Z,U,z,J,nt,mt,Et,bt,pt,zt,Rt,at,dt,kt,xt,ue,oe,he,Dt,Qt,ee,xe,it,Tt,Lt,Ut,Zt,Kt,ne,re,Se,Be,ze;switch(xt=new Sd,a=Object.keys(t).sort(function(Ve,Xe){return Ve-Xe}),r){case"macroman":for(F=0,Z=function(){var Ve=[];for(N=0;N<256;++N)Ve.push(0);return Ve}(),z={0:0},s={},ue=0,Qt=a.length;ue<Qt;ue++)z[re=t[n=a[ue]]]==null&&(z[re]=++F),s[n]={old:t[n],new:z[t[n]]},Z[n]=z[t[n]];return xt.writeUInt16(1),xt.writeUInt16(0),xt.writeUInt32(12),xt.writeUInt16(0),xt.writeUInt16(262),xt.writeUInt16(0),xt.write(Z),{charMap:s,subtable:xt.data,maxGlyphID:F+1};case"unicode":for(dt=[],A=[],J=0,z={},i={},U=m=null,oe=0,ee=a.length;oe<ee;oe++)z[mt=t[n=a[oe]]]==null&&(z[mt]=++J),i[n]={old:mt,new:z[mt]},o=z[mt]-n,U!=null&&o===m||(U&&A.push(U),dt.push(n),m=o),U=n;for(U&&A.push(U),A.push(65535),dt.push(65535),Rt=2*(zt=dt.length),pt=2*Math.pow(Math.log(zt)/Math.LN2,2),P=Math.log(pt/2)/Math.LN2,bt=2*zt-pt,f=[],Et=[],I=[],N=he=0,xe=dt.length;he<xe;N=++he){if(at=dt[N],w=A[N],at===65535){f.push(0),Et.push(0);break}if(at-(kt=i[at].new)>=32768)for(f.push(0),Et.push(2*(I.length+zt-N)),n=Dt=at;at<=w?Dt<=w:Dt>=w;n=at<=w?++Dt:--Dt)I.push(i[n].new);else f.push(kt-at),Et.push(0)}for(xt.writeUInt16(3),xt.writeUInt16(1),xt.writeUInt32(12),xt.writeUInt16(4),xt.writeUInt16(16+8*zt+2*I.length),xt.writeUInt16(0),xt.writeUInt16(Rt),xt.writeUInt16(pt),xt.writeUInt16(P),xt.writeUInt16(bt),Kt=0,it=A.length;Kt<it;Kt++)n=A[Kt],xt.writeUInt16(n);for(xt.writeUInt16(0),ne=0,Tt=dt.length;ne<Tt;ne++)n=dt[ne],xt.writeUInt16(n);for(Se=0,Lt=f.length;Se<Lt;Se++)o=f[Se],xt.writeUInt16(o);for(Be=0,Ut=Et.length;Be<Ut;Be++)nt=Et[Be],xt.writeUInt16(nt);for(ze=0,Zt=I.length;ze<Zt;ze++)F=I[ze],xt.writeUInt16(F);return{charMap:i,subtable:xt.data,maxGlyphID:J+1}}},e}(),Fk=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _u(t,kc),t.prototype.tag="cmap",t.prototype.parse=function(r){var i,n,s;for(r.pos=this.offset,this.version=r.readUInt16(),s=r.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=s?n<s:n>s;n=0<=s?++n:--n)i=new WI(r,this.offset),this.tables.push(i),i.isUnicode&&this.unicode==null&&(this.unicode=i);return!0},t.encode=function(r,i){var n,s;return i==null&&(i="macroman"),n=WI.encode(r,i),(s=new Sd).writeUInt16(0),s.writeUInt16(1),n.table=s.data.concat(n.subtable),n},t}(),art=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _u(t,kc),t.prototype.tag="hhea",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.ascender=r.readShort(),this.decender=r.readShort(),this.lineGap=r.readShort(),this.advanceWidthMax=r.readShort(),this.minLeftSideBearing=r.readShort(),this.minRightSideBearing=r.readShort(),this.xMaxExtent=r.readShort(),this.caretSlopeRise=r.readShort(),this.caretSlopeRun=r.readShort(),this.caretOffset=r.readShort(),r.pos+=8,this.metricDataFormat=r.readShort(),this.numberOfMetrics=r.readUInt16()},t}(),lrt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _u(t,kc),t.prototype.tag="OS/2",t.prototype.parse=function(r){if(r.pos=this.offset,this.version=r.readUInt16(),this.averageCharWidth=r.readShort(),this.weightClass=r.readUInt16(),this.widthClass=r.readUInt16(),this.type=r.readShort(),this.ySubscriptXSize=r.readShort(),this.ySubscriptYSize=r.readShort(),this.ySubscriptXOffset=r.readShort(),this.ySubscriptYOffset=r.readShort(),this.ySuperscriptXSize=r.readShort(),this.ySuperscriptYSize=r.readShort(),this.ySuperscriptXOffset=r.readShort(),this.ySuperscriptYOffset=r.readShort(),this.yStrikeoutSize=r.readShort(),this.yStrikeoutPosition=r.readShort(),this.familyClass=r.readShort(),this.panose=function(){var i,n;for(n=[],i=0;i<10;++i)n.push(r.readByte());return n}(),this.charRange=function(){var i,n;for(n=[],i=0;i<4;++i)n.push(r.readInt());return n}(),this.vendorID=r.readString(4),this.selection=r.readShort(),this.firstCharIndex=r.readShort(),this.lastCharIndex=r.readShort(),this.version>0&&(this.ascent=r.readShort(),this.descent=r.readShort(),this.lineGap=r.readShort(),this.winAscent=r.readShort(),this.winDescent=r.readShort(),this.codePageRange=function(){var i,n;for(n=[],i=0;i<2;i=++i)n.push(r.readInt());return n}(),this.version>1))return this.xHeight=r.readShort(),this.capHeight=r.readShort(),this.defaultChar=r.readShort(),this.breakChar=r.readShort(),this.maxContext=r.readShort()},t}(),crt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _u(t,kc),t.prototype.tag="post",t.prototype.parse=function(r){var i,n,s;switch(r.pos=this.offset,this.format=r.readInt(),this.italicAngle=r.readInt(),this.underlinePosition=r.readShort(),this.underlineThickness=r.readShort(),this.isFixedPitch=r.readInt(),this.minMemType42=r.readInt(),this.maxMemType42=r.readInt(),this.minMemType1=r.readInt(),this.maxMemType1=r.readInt(),this.format){case 65536:break;case 131072:var a;for(n=r.readUInt16(),this.glyphNameIndex=[],a=0;0<=n?a<n:a>n;a=0<=n?++a:--a)this.glyphNameIndex.push(r.readUInt16());for(this.names=[],s=[];r.pos<this.offset+this.length;)i=r.readByte(),s.push(this.names.push(r.readString(i)));return s;case 151552:return n=r.readUInt16(),this.offsets=r.read(n);case 196608:break;case 262144:return this.map=(function(){var o,f,m;for(m=[],a=o=0,f=this.file.maxp.numGlyphs;0<=f?o<f:o>f;a=0<=f?++o:--o)m.push(r.readUInt32());return m}).call(this)}},t}(),urt=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},hrt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _u(t,kc),t.prototype.tag="name",t.prototype.parse=function(r){var i,n,s,a,o,f,m,w,A,P,I;for(r.pos=this.offset,r.readShort(),i=r.readShort(),f=r.readShort(),n=[],a=0;0<=i?a<i:a>i;a=0<=i?++a:--a)n.push({platformID:r.readShort(),encodingID:r.readShort(),languageID:r.readShort(),nameID:r.readShort(),length:r.readShort(),offset:this.offset+f+r.readShort()});for(m={},a=A=0,P=n.length;A<P;a=++A)s=n[a],r.pos=s.offset,w=r.readString(s.length),o=new urt(w,s),m[I=s.nameID]==null&&(m[I]=[]),m[s.nameID].push(o);this.strings=m,this.copyright=m[0],this.fontFamily=m[1],this.fontSubfamily=m[2],this.uniqueSubfamily=m[3],this.fontName=m[4],this.version=m[5];try{this.postscriptName=m[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=m[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=m[7],this.manufacturer=m[8],this.designer=m[9],this.description=m[10],this.vendorUrl=m[11],this.designerUrl=m[12],this.license=m[13],this.licenseUrl=m[14],this.preferredFamily=m[15],this.preferredSubfamily=m[17],this.compatibleFull=m[18],this.sampleText=m[19]},t}(),drt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _u(t,kc),t.prototype.tag="maxp",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.numGlyphs=r.readUInt16(),this.maxPoints=r.readUInt16(),this.maxContours=r.readUInt16(),this.maxCompositePoints=r.readUInt16(),this.maxComponentContours=r.readUInt16(),this.maxZones=r.readUInt16(),this.maxTwilightPoints=r.readUInt16(),this.maxStorage=r.readUInt16(),this.maxFunctionDefs=r.readUInt16(),this.maxInstructionDefs=r.readUInt16(),this.maxStackElements=r.readUInt16(),this.maxSizeOfInstructions=r.readUInt16(),this.maxComponentElements=r.readUInt16(),this.maxComponentDepth=r.readUInt16()},t}(),frt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _u(t,kc),t.prototype.tag="hmtx",t.prototype.parse=function(r){var i,n,s,a,o,f,m;for(r.pos=this.offset,this.metrics=[],i=0,f=this.file.hhea.numberOfMetrics;0<=f?i<f:i>f;i=0<=f?++i:--i)this.metrics.push({advance:r.readUInt16(),lsb:r.readInt16()});for(s=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var w,A;for(A=[],i=w=0;0<=s?w<s:w>s;i=0<=s?++w:--w)A.push(r.readInt16());return A}(),this.widths=(function(){var w,A,P,I;for(I=[],w=0,A=(P=this.metrics).length;w<A;w++)a=P[w],I.push(a.advance);return I}).call(this),n=this.widths[this.widths.length-1],m=[],i=o=0;0<=s?o<s:o>s;i=0<=s?++o:--o)m.push(this.widths.push(n));return m},t.prototype.forGlyph=function(r){return r in this.metrics?this.metrics[r]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[r-this.metrics.length]}},t}(),zk=[].slice,prt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _u(t,kc),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(r){var i,n,s,a,o,f,m,w,A,P;return r in this.cache?this.cache[r]:(a=this.file.loca,i=this.file.contents,n=a.indexOf(r),(s=a.lengthOf(r))===0?this.cache[r]=null:(i.pos=this.offset+n,o=(f=new Sd(i.read(s))).readShort(),w=f.readShort(),P=f.readShort(),m=f.readShort(),A=f.readShort(),this.cache[r]=o===-1?new mrt(f,w,P,m,A):new grt(f,o,w,P,m,A),this.cache[r]))},t.prototype.encode=function(r,i,n){var s,a,o,f,m;for(o=[],a=[],f=0,m=i.length;f<m;f++)s=r[i[f]],a.push(o.length),s&&(o=o.concat(s.encode(n)));return a.push(o.length),{table:o,offsets:a}},t}(),grt=function(){function e(t,r,i,n,s,a){this.raw=t,this.numberOfContours=r,this.xMin=i,this.yMin=n,this.xMax=s,this.yMax=a,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),mrt=function(){function e(t,r,i,n,s){var a,o;for(this.raw=t,this.xMin=r,this.yMin=i,this.xMax=n,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;o=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&o;)a.pos+=1&o?4:2,128&o?a.pos+=8:64&o?a.pos+=4:8&o&&(a.pos+=2)}return e.prototype.encode=function(){var t,r,i;for(r=new Sd(zk.call(this.raw.data)),t=0,i=this.glyphIDs.length;t<i;++t)r.pos=this.glyphOffsets[t];return r.data},e}(),yrt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _u(t,kc),t.prototype.tag="loca",t.prototype.parse=function(r){var i,n;return r.pos=this.offset,i=this.file.head.indexToLocFormat,this.offsets=i===0?(function(){var s,a;for(a=[],n=0,s=this.length;n<s;n+=2)a.push(2*r.readUInt16());return a}).call(this):(function(){var s,a;for(a=[],n=0,s=this.length;n<s;n+=4)a.push(r.readUInt32());return a}).call(this)},t.prototype.indexOf=function(r){return this.offsets[r]},t.prototype.lengthOf=function(r){return this.offsets[r+1]-this.offsets[r]},t.prototype.encode=function(r,i){for(var n=new Uint32Array(this.offsets.length),s=0,a=0,o=0;o<n.length;++o)if(n[o]=s,a<i.length&&i[a]==o){++a,n[o]=s;var f=this.offsets[o],m=this.offsets[o+1]-f;m>0&&(s+=m)}for(var w=new Array(4*n.length),A=0;A<n.length;++A)w[4*A+3]=255&n[A],w[4*A+2]=(65280&n[A])>>8,w[4*A+1]=(16711680&n[A])>>16,w[4*A]=(4278190080&n[A])>>24;return w},t}(),_rt=function(){function e(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var t,r,i,n,s;for(r in n=this.font.cmap.tables[0].codeMap,t={},s=this.subset)i=s[r],t[r]=n[i];return t},e.prototype.glyphsFor=function(t){var r,i,n,s,a,o,f;for(n={},a=0,o=t.length;a<o;a++)n[s=t[a]]=this.font.glyf.glyphFor(s);for(s in r=[],n)(i=n[s])!=null&&i.compound&&r.push.apply(r,i.glyphIDs);if(r.length>0)for(s in f=this.glyphsFor(r))i=f[s],n[s]=i;return n},e.prototype.encode=function(t,r){var i,n,s,a,o,f,m,w,A,P,I,N,F,Z,U;for(n in i=Fk.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(t),I={0:0},U=i.charMap)I[(f=U[n]).old]=f.new;for(N in P=i.maxGlyphID,a)N in I||(I[N]=P++);return w=function(z){var J,nt;for(J in nt={},z)nt[z[J]]=J;return nt}(I),A=Object.keys(w).sort(function(z,J){return z-J}),F=function(){var z,J,nt;for(nt=[],z=0,J=A.length;z<J;z++)o=A[z],nt.push(w[o]);return nt}(),s=this.font.glyf.encode(a,F,I),m=this.font.loca.encode(s.offsets,F),Z={cmap:this.font.cmap.raw(),glyf:s.table,loca:m,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(r)},this.font.os2.exists&&(Z["OS/2"]=this.font.os2.raw()),this.font.directory.encode(Z)},e}();Dr.API.PDFObject=function(){var e;function t(){}return e=function(r,i){return(Array(i+1).join("0")+r).slice(-i)},t.convert=function(r){var i,n,s,a;if(Array.isArray(r))return"["+function(){var o,f,m;for(m=[],o=0,f=r.length;o<f;o++)i=r[o],m.push(t.convert(i));return m}().join(" ")+"]";if(typeof r=="string")return"/"+r;if(r!=null&&r.isString)return"("+r+")";if(r instanceof Date)return"(D:"+e(r.getUTCFullYear(),4)+e(r.getUTCMonth(),2)+e(r.getUTCDate(),2)+e(r.getUTCHours(),2)+e(r.getUTCMinutes(),2)+e(r.getUTCSeconds(),2)+"Z)";if({}.toString.call(r)==="[object Object]"){for(n in s=["<<"],r)a=r[n],s.push("/"+n+" "+t.convert(a));return s.push(">>"),s.join(`
`)}return""+r},t}();const mS={"circle-radius":8,"circle-color":"red","circle-stroke-width":1,"circle-stroke-color":"black"};class vrt{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ff.A4,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Xu.PNG,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:gg.mm,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:"maplibregl-marker",f=arguments.length>7&&arguments[7]!==void 0?arguments[7]:mS;Di(this,"map"),Di(this,"width"),Di(this,"height"),Di(this,"dpi"),Di(this,"format"),Di(this,"unit"),Di(this,"fileName"),Di(this,"markerClassName"),Di(this,"markerCirclePaint"),this.map=t,this.width=r[0],this.height=r[1],this.dpi=i,this.format=n,this.unit=s,this.fileName=a,this.markerClassName=o,this.markerCirclePaint=f}renderMapPost(t){return t}getMarkers(){return this.map.getCanvasContainer().getElementsByClassName(this.markerClassName)}renderMarkers(t){const r=this.getMarkers();for(let i=0;i<r.length;i++){const n=r.item(i);if(!n)continue;const s=n.getAttribute("style");if(!s)continue;const a=/translate\(([^,]+)px,\s*([^,]+)px\)/,o=s.match(a);if(!o)continue;const f=parseInt(o[1]),m=parseInt(o[2]),w=this.map.unproject([f,m]),A=`point${i}`;t.addSource(A,{type:"geojson",data:{type:"Point",coordinates:[w.lng,w.lat]}}),t.addLayer({id:A,source:A,type:"circle",paint:this.markerCirclePaint})}return t}generate(){const t=this;JsLoadingOverlay.show({overlayBackgroundColor:"#5D5959",overlayOpacity:"0.6",spinnerIcon:"ball-spin",spinnerColor:"#2400FD",spinnerSize:"2x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetX:0,offsetY:0,containerID:null,lockScroll:!1,overlayZIndex:9998,spinnerZIndex:9999});const r=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return t.dpi/96}});const i=document.createElement("div");i.className="hidden-map",document.body.appendChild(i);const n=document.createElement("div");n.style.width=this.toPixels(this.width),n.style.height=this.toPixels(this.height),i.appendChild(n);const s=this.map.getStyle();if(s&&s.sources){const o=s.sources;Object.keys(o).forEach(f=>{const m=o[f];Object.keys(m).forEach(w=>{m[w]||delete m[w]})})}let a=this.getRenderedMap(n,s);a.once("idle",()=>{a=this.renderMapPost(a),this.getMarkers().length===0?this.exportImage(a,i,r):(a=this.renderMarkers(a),a.once("idle",()=>{this.exportImage(a,i,r)}))})}exportImage(t,r,i){var n;const s=t.getCanvas(),a=`${this.fileName}.${this.format}`;switch(this.format){case Xu.PNG:this.toPNG(s,a);break;case Xu.JPEG:this.toJPEG(s,a);break;case Xu.PDF:this.toPDF(t,a);break;case Xu.SVG:this.toSVG(s,a);break;default:console.error(`Invalid file format: ${this.format}`);break}t.remove(),(n=r.parentNode)==null||n.removeChild(r),Object.defineProperty(window,"devicePixelRatio",{get(){return i}}),r.remove(),JsLoadingOverlay.hide()}toPNG(t,r){const i=document.createElement("a");i.href=t.toDataURL(),i.download=r,i.click(),i.remove()}toJPEG(t,r){const i=t.toDataURL("image/jpeg",.85),n=document.createElement("a");n.href=i,n.download=r,n.click(),n.remove()}toPDF(t,r){const i=t.getCanvas(),n=new Dr({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});n.addImage(i.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:s,lat:a}=t.getCenter();n.setProperties({title:t.getStyle().name,subject:`center: [${s}, ${a}], zoom: ${t.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),n.save(r)}toSVG(t,r){const i=t.toDataURL("image/png"),n=Number(this.toPixels(this.width,this.dpi).replace("px","")),s=Number(this.toPixels(this.height,this.dpi).replace("px","")),a=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${n}" 
      height="${s}" 
      viewBox="0 0 ${n} ${s}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${i}" width="${n}" height="${s}"></image>
    </svg>`,o=document.createElement("a");o.href=`data:application/xml,${encodeURIComponent(a)}`,o.download=r,o.click(),o.remove()}toPixels(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===gg.mm&&(r/=25.4),`${r*t}px`}}class brt extends vrt{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ff.A4,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Xu.PNG,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:gg.mm,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:mS;super(t,r,i,n,s,a,"maplibregl-marker",o)}getRenderedMap(t,r){const i=new SL.Map({container:t,style:r,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,attributionControl:!1,transformRequest:this.map._requestManager._transformRequestFn});this.map.getTerrain()&&(i.setMaxPitch(85),i.setPitch(this.map.getPitch()));const n=(this.map.style.imageManager||{}).images||[];return Object.keys(n).forEach(s=>{i.addImage(s,n[s].data)}),i}renderMapPost(t){const r=this.map.getTerrain();return r&&t.setTerrain({source:r.source,exaggeration:r.exaggeration}),t}}class wrt{constructor(t){Di(this,"controlContainer"),Di(this,"exportContainer"),Di(this,"crosshair"),Di(this,"printableArea"),Di(this,"map"),Di(this,"exportButton"),Di(this,"options",{PageSize:ff.A4,PageOrientation:Sm.Landscape,Format:Xu.PDF,DPI:Ox[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(ff),Filename:"map",markerCirclePaint:mS}),Di(this,"MAPLIB_CSS_PREFIX","maplibregl"),t&&(this.options=Object.assign(this.options,t)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){const t=this.options.Local??"en";return bet(t)}onAdd(t){var r;this.map=t,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl`),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-group`),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-list`),this.exportButton=document.createElement("button"),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-icon`),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-control`),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const i=document.createElement("TABLE");i.className="print-table";const n={};(r=this.options.AllowedSizes)==null||r.forEach(w=>{ff[w]&&(n[w]=ff[w])});const s=this.createSelection(n,this.getTranslation().PageSize,"page-size",this.options.PageSize,(w,A)=>JSON.stringify(w[A]));i.appendChild(s);const a=this.createSelection(Sm,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(w,A)=>w[A]);i.appendChild(a);const o=this.createSelection(Xu,this.getTranslation().Format,"format-type",this.options.Format,(w,A)=>w[A]);i.appendChild(o);const f=this.createSelection(Ox,this.getTranslation().DPI,"dpi-type",this.options.DPI,(w,A)=>w[A]);i.appendChild(f),this.exportContainer.appendChild(i);const m=document.createElement("button");return m.type="button",m.textContent=this.getTranslation().Generate,m.classList.add("generate-button"),m.addEventListener("click",()=>{const w=document.getElementById("mapbox-gl-export-page-size"),A=document.getElementById("mapbox-gl-export-page-orientation"),P=document.getElementById("mapbox-gl-export-format-type"),I=document.getElementById("mapbox-gl-export-dpi-type"),N=A.value;let F=JSON.parse(w.value);N===Sm.Portrait&&(F=F.reverse()),this.generateMap(t,F,Number(I.value),P.value,gg.mm,this.options.Filename)}),this.exportContainer.appendChild(m),this.controlContainer}generateMap(t,r,i,n,s,a){new brt(t,r,i,n,s,a,this.options.markerCirclePaint).generate()}createSelection(t,r,i,n,s){const a=document.createElement("label");a.textContent=r;const o=document.createElement("select");o.setAttribute("id",`mapbox-gl-export-${i}`),o.style.width="100%",Object.keys(t).forEach(A=>{const P=document.createElement("option");P.setAttribute("value",s(t,A)),P.appendChild(document.createTextNode(A)),P.setAttribute("name",i),n===t[A]&&(P.selected=!0),o.appendChild(P)}),o.addEventListener("change",()=>{this.updatePrintableArea()});const f=document.createElement("TR"),m=document.createElement("TD"),w=document.createElement("TD");return m.appendChild(a),w.appendChild(o),f.appendChild(m),f.appendChild(w),f}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0),this.map=void 0)}onDocumentClick(t){this.controlContainer&&!this.controlContainer.contains(t.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(t){this.options.Crosshair===!0&&(t===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new aet(this.map),this.crosshair.create()))}togglePrintableArea(t){this.options.PrintableArea===!0&&(t===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new cet(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const t=document.getElementById("mapbox-gl-export-page-size"),r=document.getElementById("mapbox-gl-export-page-orientation").value;let i=JSON.parse(t.value);r===Sm.Portrait&&(i=i.reverse()),this.printableArea.updateArea(i[0],i[1])}}var jk=Art,xrt=Object.prototype.hasOwnProperty;function Art(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var i in r)xrt.call(r,i)&&(e[i]=r[i])}return e}var Uk={exports:{}};(function(e,t){(function(){var r={};e.exports=r,r.simpleFilter=function(i,n){return n.filter(function(s){return r.test(i,s)})},r.test=function(i,n){return r.match(i,n)!==null},r.match=function(i,n,s){s=s||{};var a=0,o=[],f=n.length,m=0,w=0,A=s.pre||"",P=s.post||"",I=s.caseSensitive&&n||n.toLowerCase(),N;i=s.caseSensitive&&i||i.toLowerCase();for(var F=0;F<f;F++)N=n[F],I[F]===i[a]?(N=A+N+P,a+=1,w+=1+w):w=0,m+=w,o[o.length]=N;return a===i.length?(m=I===i?1/0:m,{rendered:o.join(""),score:m}):null},r.filter=function(i,n,s){return!n||n.length===0?[]:typeof i!="string"?n:(s=s||{},n.reduce(function(a,o,f,m){var w=o;s.extract&&(w=s.extract(o));var A=r.match(i,w,s);return A!=null&&(a[a.length]={string:A.rendered,score:A.score,index:f,original:o}),a},[]).sort(function(a,o){var f=o.score-a.score;return f||a.index-o.index}))}})()})(Uk);var Srt=Uk.exports,Aa=function(e){return this.component=e,this.items=[],this.active=e.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};Aa.prototype.show=function(){this.element.style.display="block"};Aa.prototype.hide=function(){this.element.style.display="none"};Aa.prototype.add=function(e){this.items.push(e)};Aa.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0};Aa.prototype.isEmpty=function(){return!this.items.length};Aa.prototype.isVisible=function(){return this.element.style.display==="block"};Aa.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()};Aa.prototype.drawItem=function(e,t){var r=document.createElement("li"),i=document.createElement("a");t&&(r.className+=" active"),i.innerHTML=e.string,r.appendChild(i),this.element.appendChild(r),r.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),r.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,e)}).bind(this))};Aa.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()};Aa.prototype.move=function(e){this.active=e,this.draw()};Aa.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)};Aa.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)};Aa.prototype.drawError=function(e){var t=document.createElement("li");t.innerHTML=e,this.element.appendChild(t),this.show()};var Ert=Aa,Crt=jk,Trt=Srt,Prt=Ert,Co=function(e,t,r){return r=r||{},this.options=Crt({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},r),this.el=e,this.data=t||[],this.list=new Prt(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(i){this.handleKeyUp(i.keyCode,i)}).bind(this),!1),this.el.addEventListener("keydown",(function(i){this.handleKeyDown(i)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(i){this.handlePaste(i)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Co.prototype.handleKeyUp=function(e,t){if(!(e===40||e===38||e===27||e===9)){if(e===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),t.stopPropagation());return}this.handleInputChange(this.el.value)}};Co.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Co.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Co.prototype.handlePaste=function(e){if(e.clipboardData)this.handleInputChange(e.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(e.target.value)},100)}};Co.prototype.handleInputChange=function(e){if(this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(t){for(var r=0;r<t.length&&(this.list.add(t[r]),r!==this.options.limit-1);r++);this.list.draw()}).bind(this))};Co.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Co.prototype.update=function(e){this.data=e,this.handleKeyUp()};Co.prototype.clear=function(){this.data=[],this.list.clear()};Co.prototype.normalize=function(e){return e=e.toLowerCase(),e};Co.prototype.match=function(e,t){return e.indexOf(t)>-1};Co.prototype.value=function(e){if(this.selected=e,this.el.value=this.getItemValue(e||{place_name:this.query}),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")};Co.prototype.getCandidates=function(e){var t={pre:"<strong>",post:"</strong>",extract:(function(i){return this.getItemValue(i)}).bind(this)},r;this.options.filter?(r=Trt.filter(this.query,this.data,t),r=r.map((function(i){return{original:i.original,string:this.render(i.original,i.string)}}).bind(this))):r=this.data.map((function(i){var n=this.render(i);return{original:i,string:n}}).bind(this)),e(r)};Co.prototype.getItemValue=function(e){return e};Co.prototype.render=function(e,t){if(t)return t;for(var r=e.original?this.getItemValue(e.original):this.getItemValue(e),i=this.normalize(r),n=i.lastIndexOf(this.query);n>-1;){var s=n+this.query.length;r=r.slice(0,n)+"<strong>"+r.slice(n,s)+"</strong>"+r.slice(s),n=i.slice(0,n).lastIndexOf(this.query)}return r};Co.prototype.renderError=function(e){this.list.drawError(e)};var Irt=Co,Gk=Irt,Mrt=Gk;typeof window<"u"&&(window.Suggestions=Gk);var Lrt="Expected a function",$I=NaN,Brt="[object Symbol]",krt=/^\s+|\s+$/g,Rrt=/^[-+]0x[0-9a-f]+$/i,Ort=/^0b[01]+$/i,Drt=/^0o[0-7]+$/i,Nrt=parseInt,Frt=typeof Ip=="object"&&Ip&&Ip.Object===Object&&Ip,zrt=typeof self=="object"&&self&&self.Object===Object&&self,jrt=Frt||zrt||Function("return this")(),Urt=Object.prototype,Grt=Urt.toString,Vrt=Math.max,qrt=Math.min,q2=function(){return jrt.Date.now()};function Hrt(e,t,r){var i,n,s,a,o,f,m=0,w=!1,A=!1,P=!0;if(typeof e!="function")throw new TypeError(Lrt);t=ZI(t)||0,$x(r)&&(w=!!r.leading,A="maxWait"in r,s=A?Vrt(ZI(r.maxWait)||0,t):s,P="trailing"in r?!!r.trailing:P);function I(Et){var bt=i,pt=n;return i=n=void 0,m=Et,a=e.apply(pt,bt),a}function N(Et){return m=Et,o=setTimeout(U,t),w?I(Et):a}function F(Et){var bt=Et-f,pt=Et-m,zt=t-bt;return A?qrt(zt,s-pt):zt}function Z(Et){var bt=Et-f,pt=Et-m;return f===void 0||bt>=t||bt<0||A&&pt>=s}function U(){var Et=q2();if(Z(Et))return z(Et);o=setTimeout(U,F(Et))}function z(Et){return o=void 0,P&&i?I(Et):(i=n=void 0,a)}function J(){o!==void 0&&clearTimeout(o),m=0,i=f=n=o=void 0}function nt(){return o===void 0?a:z(q2())}function mt(){var Et=q2(),bt=Z(Et);if(i=arguments,n=this,f=Et,bt){if(o===void 0)return N(f);if(A)return o=setTimeout(U,t),I(f)}return o===void 0&&(o=setTimeout(U,t)),a}return mt.cancel=J,mt.flush=nt,mt}function $x(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function Wrt(e){return!!e&&typeof e=="object"}function $rt(e){return typeof e=="symbol"||Wrt(e)&&Grt.call(e)==Brt}function ZI(e){if(typeof e=="number")return e;if($rt(e))return $I;if($x(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=$x(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(krt,"");var r=Ort.test(e);return r||Drt.test(e)?Nrt(e.slice(2),r?2:8):Rrt.test(e)?$I:+e}var Zrt=Hrt,yS={exports:{}},Xp=typeof Reflect=="object"?Reflect:null,JI=Xp&&typeof Xp.apply=="function"?Xp.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},Oy;Xp&&typeof Xp.ownKeys=="function"?Oy=Xp.ownKeys:Object.getOwnPropertySymbols?Oy=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Oy=function(e){return Object.getOwnPropertyNames(e)};function Jrt(e){console&&console.warn&&console.warn(e)}var Vk=Number.isNaN||function(e){return e!==e};function Yi(){Yi.init.call(this)}yS.exports=Yi;yS.exports.once=Qrt;Yi.EventEmitter=Yi;Yi.prototype._events=void 0;Yi.prototype._eventsCount=0;Yi.prototype._maxListeners=void 0;var XI=10;function pv(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(Yi,"defaultMaxListeners",{enumerable:!0,get:function(){return XI},set:function(e){if(typeof e!="number"||e<0||Vk(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");XI=e}});Yi.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Yi.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Vk(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function qk(e){return e._maxListeners===void 0?Yi.defaultMaxListeners:e._maxListeners}Yi.prototype.getMaxListeners=function(){return qk(this)};Yi.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i=e==="error",n=this._events;if(n!==void 0)i=i&&n.error===void 0;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var o=n[e];if(o===void 0)return!1;if(typeof o=="function")JI(o,this,t);else for(var f=o.length,m=Jk(o,f),r=0;r<f;++r)JI(m[r],this,t);return!0};function Hk(e,t,r,i){var n,s,a;if(pv(r),s=e._events,s===void 0?(s=e._events=Object.create(null),e._eventsCount=0):(s.newListener!==void 0&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),a=s[t]),a===void 0)a=s[t]=r,++e._eventsCount;else if(typeof a=="function"?a=s[t]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),n=qk(e),n>0&&a.length>n&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=t,o.count=a.length,Jrt(o)}return e}Yi.prototype.addListener=function(e,t){return Hk(this,e,t,!1)};Yi.prototype.on=Yi.prototype.addListener;Yi.prototype.prependListener=function(e,t){return Hk(this,e,t,!0)};function Xrt(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Wk(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=Xrt.bind(i);return n.listener=r,i.wrapFn=n,n}Yi.prototype.once=function(e,t){return pv(t),this.on(e,Wk(this,e,t)),this};Yi.prototype.prependOnceListener=function(e,t){return pv(t),this.prependListener(e,Wk(this,e,t)),this};Yi.prototype.removeListener=function(e,t){var r,i,n,s,a;if(pv(t),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){a=r[s].listener,n=s;break}if(n<0)return this;n===0?r.shift():Krt(r,n),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};Yi.prototype.off=Yi.prototype.removeListener;Yi.prototype.removeAllListeners=function(e){var t,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var n=Object.keys(r),s;for(i=0;i<n.length;++i)s=n[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function $k(e,t,r){var i=e._events;if(i===void 0)return[];var n=i[t];return n===void 0?[]:typeof n=="function"?r?[n.listener||n]:[n]:r?Yrt(n):Jk(n,n.length)}Yi.prototype.listeners=function(e){return $k(this,e,!0)};Yi.prototype.rawListeners=function(e){return $k(this,e,!1)};Yi.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):Zk.call(e,t)};Yi.prototype.listenerCount=Zk;function Zk(e){var t=this._events;if(t!==void 0){var r=t[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Yi.prototype.eventNames=function(){return this._eventsCount>0?Oy(this._events):[]};function Jk(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}function Krt(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function Yrt(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function Qrt(e,t){return new Promise(function(r,i){function n(a){e.removeListener(t,s),i(a)}function s(){typeof e.removeListener=="function"&&e.removeListener("error",n),r([].slice.call(arguments))}Xk(e,t,s,{once:!0}),t!=="error"&&tit(e,n,{once:!0})})}function tit(e,t,r){typeof e.on=="function"&&Xk(e,"error",t,r)}function Xk(e,t,r,i){if(typeof e.on=="function")i.once?e.once(t,r):e.on(t,r);else if(typeof e.addEventListener=="function")e.addEventListener(t,function n(s){i.once&&e.removeEventListener(t,n),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var Kk=yS.exports,eit={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},rit={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},iit={placeholder:rit},Yk={exports:{}};(function(e){(function(t,r,i){e.exports?e.exports=i():t[r]=i()})(Ip,"subtag",function(){var t="",r=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function i(f){return f.match(r)||[]}function n(f){return i(f).filter(function(m,w){return m&&w})}function s(f){return f=i(f),{language:f[1]||t,extlang:f[2]||t,script:f[3]||t,region:f[4]||t}}function a(f,m,w){Object.defineProperty(f,m,{value:w,enumerable:!0})}function o(f,m,w){function A(P){return i(P)[f]||t}a(A,"pattern",m),a(s,w,A)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),a(s,"split",n),s})})(Yk);var nit=Yk.exports,sit=Mrt,oit=Zrt,Ua=jk,ait=Kk.EventEmitter,KI=eit,lit=iit,cit=nit;function Qk(e,t){this._eventEmitter=new ait,this.options=Ua({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geocoderApi=e}Qk.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(e){return e.text!==void 0?e.text:e.place_name},render:function(e){if(e.geometry){var t=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--result maplibregl-ctrl-geocoder--result"><svg class="mapboxgl-ctrl-geocoder--result-icon maplibre-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="mapboxgl-ctrl-geocoder--result-title maplibregl-ctrl-geocoder--result-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--result-address maplibregl-ctrl-geocoder--result-address">'+t.splice(1,t.length).join(",")+"</div></div></div>"}else{var r=e.text,i=r.toLowerCase().indexOf(this.query.toLowerCase()),n=this.query.length,s=r.substring(0,i),a=r.substring(i,i+n),o=r.substring(i+n);return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibregl-ctrl-geocoder--suggestion"><svg class="mapboxgl-ctrl-geocoder--suggestion-icon maplibre-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="mapboxgl-ctrl-geocoder--suggestion-info maplibregl-ctrl-geocoder--suggestion-info"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibregl-ctrl-geocoder--suggestion-title">'+s+'<span class="mapboxgl-ctrl-geocoder--suggestion-match maplibregl-ctrl-geocoder--suggestion-match">'+a+"</span>"+o+"</div></div></div>"}},popupRender:function(e){var t=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibre-ctrl-geocoder--suggestion popup-suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibre-ctrl-geocoder--suggestion-title popup-suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address maplibre-ctrl-geocoder--suggestion-address popup-suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},addTo:function(e){function t(i,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var s=i.onAdd();n.appendChild(s)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)t(this,e);else if(typeof e=="string"){var r=document.querySelectorAll(e);if(r.length===0)throw new Error("Element ",e,"not found.");if(r.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,r[0])}else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";var r=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",oit(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);var i=document.createElement("div");i.classList.add("mapboxgl-ctrl-geocoder--pin-right","maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button maplibregl-ctrl-geocoder--button";var n=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(n),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),i.appendChild(this._clearEl),i.appendChild(this._loadingEl),t.appendChild(r),t.appendChild(this._inputEl),t.appendChild(i),this._typeahead=new sit(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),t},createIcon:function(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");if(r.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e+" maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+e),r.setAttribute("viewBox","0 0 18 18"),r.setAttribute("xml:space","preserve"),r.setAttribute("width",18),r.setAttribute("height",18),"innerHTML"in r)r.innerHTML=t;else{var i=document.createElement("div");i.innerHTML="<svg>"+t.valueOf().toString()+"</svg>";var n=i.firstChild,s=n.firstChild;r.appendChild(s)}return r},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(e){var t=(e.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(t)},_onKeyDown:function(e){var t=27,r=9;if(e.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var i=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target,n=i?i.value:"";if(!n)return this.fresh=!0,e.keyCode!==r&&this.clear(e),this._clearEl.style.display="none";if(!(e.metaKey||[r,t,37,39,38,40].indexOf(e.keyCode)!==-1)){if(e.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(i.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(i.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}i.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(i.value)}},_showButton:function(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;if(e&&!e.geometry)e.placeId?this._geocode(e.placeId,!0,!0):this._geocode(e.text,!0);else if(e&&JSON.stringify(e)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var t;if(this._removeResultMarkers(),e.properties&&KI[e.properties.short_code])t=Ua({},this.options.flyTo),this._map&&this._map.fitBounds(KI[e.properties.short_code].bbox,t);else if(e.bbox){var r=e.bbox;t=Ua({},this.options.flyTo),this._map&&this._map.fitBounds([[r[0],r[1]],[r[2],r[3]]],t)}else{var i={zoom:this.options.zoom};t=Ua({},i,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t)}}this.options.marker&&this._maplibregl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:e})}},_getConfigForRequest:function(){var e=["bbox","limit","proximity","countries","types","language","reverseMode"],t=this,r=e.reduce(function(i,n){return t.options[n]&&(["countries","types","language"].indexOf(n)>-1?i[n]=t.options[n].split(/[\s,]+/):i[n]=t.options[n],n==="proximity"&&t.options[n]&&typeof t.options[n].longitude=="number"&&typeof t.options[n].latitude=="number"&&(i[n]=[t.options[n].longitude,t.options[n].latitude])),i},{});return r},_geocode:function(e,t,r){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:e}),this.inputString=e;var i=null,n=this._getConfigForRequest(),s;if(this.options.localGeocoderOnly)s=Promise.resolve();else if(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(e)){var a=e.split(/[\s(,)?]+/).map(function(m){return parseFloat(m,10)}).reverse();n.types&&n.types[0],n=Ua(n,{query:a,limit:1}),"proximity"in n&&delete n.proximity,s=this.geocoderApi.reverseGeocode(n)}else n=Ua(n,{query:e}),this.geocoderApi.getSuggestions?t?this.geocoderApi.searchByPlaceId&&r?s=this.geocoderApi.searchByPlaceId(n):s=this.geocoderApi.forwardGeocode(n):s=this.geocoderApi.getSuggestions(n):s=this.geocoderApi.forwardGeocode(n);var o=[];this.options.localGeocoder&&(o=this.options.localGeocoder(e),o||(o=[]));var f=[];return s.catch((function(m){i=m}).bind(this)).then((function(m){this._loadingEl.style.display="none";var w={};return m?w=m:w={type:"FeatureCollection",features:[]},w.config=n,this.fresh&&(this.fresh=!1),w.features=w.features?o.concat(w.features):o,this.options.externalGeocoder?(f=this.options.externalGeocoder(e,w.features,n)||[],f.then(function(A){return w.features=w.features?A.concat(w.features):A,w},function(){return w})):w}).bind(this)).then((function(m){if(i)throw i;this.options.filter&&m.features.length&&(m.features=m.features.filter(this.options.filter));var w=[];m.suggestions?w=m.suggestions:m.place?w=[m.place]:w=m.features,w.length?(this._clearEl.style.display="block",this._typeahead.update(w),(!this.options.showResultsWhileTyping||t)&&this.options.showResultMarkers&&(m.features.length>0||m.place)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",m)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",m))}).bind(this)).catch((function(m){this._loadingEl.style.display="none",o.length&&this.options.localGeocoder||f.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(o)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:o}),this._eventEmitter.emit("error",{error:m})}).bind(this)),s},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){var t=this;e.relatedTarget&&t._clear(e)},_onQueryResult:function(e){var t=e;if(t.features.length){var r=t.features[0];this._typeahead.selected=r,this._inputEl.value=r.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){var e="<div class='mapbox-gl-geocoder--error maplibre-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(e)},_renderNoResults:function(){var e="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>";this._renderMessage(e)},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],t=cit.language(e),r=lit.placeholder[t];if(r)return r}return"Search"},_fitBoundsForMarkers:function(){if(!(this._typeahead.data.length<1)){var e=this._typeahead.data.filter(function(n){return typeof n!="string"}).slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){var t={padding:100},r=Ua({},t,this.options.flyTo),i=new this._maplibregl.LngLatBounds;e.forEach(function(n){i.extend(n.geometry.coordinates)}),this._map.fitBounds(i.toArray(),r)}return e.length>0&&this._maplibregl&&this._handleResultMarkers(e),this}},setInput:function(e){return this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(e),this},setProximity:function(e){return this.options.proximity=e,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setGeocoderApi:function(e){return this.geocoderApi=e,this},getGeocoderApi:function(){return this.geocoderApi},_handleMarker:function(e){if(this._map){this._removeMarker();var t={color:"#4668F2"},r=Ua({},t,this.options.marker);this.mapMarker=new this._maplibregl.Marker(r);var i;if(this.options.popup){var n={},s=Ua({},n,this.options.popup);i=new this._maplibregl.Popup(s).setHTML(this.options.popupRender(e))}return e.center?(this.mapMarker.setLngLat(e.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(i)):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(i)),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},_handleResultMarkers:function(e){if(this._map){this._removeResultMarkers();var t={color:"#4668F2"},r=Ua({},t,this.options.showResultMarkers);return e.forEach((function(i){if(this.options.showResultMarkers&&this.options.showResultMarkers.element){var n=this.options.showResultMarkers.element.cloneNode(!0);r=Ua(r,{element:n})}var s=new this._maplibregl.Marker(Ua({},r,{element:n})),a;if(this.options.popup){var o={},f=Ua({},o,this.options.popup);a=new this._maplibregl.Popup(f).setHTML(this.options.popupRender(i))}i.center?(s.setLngLat(i.center).addTo(this._map),this.options.popup&&s.setPopup(a)):i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(s.setLngLat(i.geometry.coordinates).addTo(this._map),this.options.popup&&s.setPopup(a)),this.resultMarkers.push(s)}).bind(this)),this}},_removeResultMarkers:function(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(e){e.remove()}),this.resultMarkers=[])},on:function(e,t){return this._eventEmitter.on(e,t),this},off:function(e,t){return this._eventEmitter.removeListener(e,t),this}};var uit=Qk;const hit=K_(uit),dit={limitsUrl:"https://tilemaps.icgc.cat/vt/limits-tilejsonV3.json",geocoder:{peliasUrl1:"https://eines.icgc.cat/geocodificador/autocompletar?text=",peliasUrl2:"&layers=topo1%2Ctopo2%2Caddress&size=5"},mapOptions:{container:"map",center:{0:1.537786,1:41.837539},zoom:7.5,bearing:0,pitch:0,hash:!1,style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",maxZoom:18,maxPitch:85},logoIcgcOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/icgc_logo_color.png",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/icgc_logo_blanc.svg",logoLink:"https://www.icgc.cat",logoTitle:"Institut Cartogràfic i Geològic de Catalunya",logoWidth:100},logoGencatOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/gencat_logo_color.png",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/gencat_logo_blanc.png",logoLink:"https://web.gencat.cat/",logoTitle:"Generalitat de Catalunya",logoWidth:100},map3dOptions:{spaceErrorFactor:2,exaggeration:1,zfactor:48,minZoomRange:15.5,maxZoomRange:22,urlTilesetCities:"https://tilemaps.icgc.cat/vector/3dtiles/ciutats/v1/tilesetV1.0.json",layerIdOrder:"place-isolated",sourceLayerFilterId:"place",minZoomFilter:14,layerId3d:"edificisMapboxLayer",terrainSource:"ICGC5M",style3dName:"orto3d",imageIcon:"https://tilemaps.icgc.cat/cdn/images/stick.png"},baseStyles:[{key:"TOPO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},{key:"ORTO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ORTO3D",url:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ADMIN",url:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},{key:"DARK",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},{key:"LIGHT",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},{key:"GEOLOGY",url:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"}],urlTerrainICGC:[{name:"ICGC5M",url:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},{name:"WORLD30M",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",encoding:"terrarium"}],ortoLayersICGC:[{name:"ortofotoColorProvisional",key:"ortofoto_color_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},{name:"ortofotoColor2022",key:"ortofoto_color_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},{name:"ortofotoColor2021",key:"ortofoto_color_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},{name:"ortofotoColor2020",key:"ortofoto_color_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},{name:"ortofotoColor2019",key:"ortofoto_color_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},{name:"ortofotoColor2018",key:"ortofoto_color_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},{name:"ortofotoColor2017",key:"ortofoto_color_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},{name:"ortofotoColor2016",key:"ortofoto_color_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},{name:"ortofotoColor2015",key:"ortofoto_color_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},{name:"ortofotoColor2014",key:"ortofoto_color_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},{name:"ortofotoColor2013",key:"ortofoto_color_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},{name:"ortofotoColor2012",key:"ortofoto_color_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},{name:"ortofotoColor2011",key:"ortofoto_color_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},{name:"ortofotoColor2010",key:"ortofoto_color_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},{name:"ortofotoColor2009",key:"ortofoto_color_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},{name:"ortofotoColor2008",key:"ortofoto_color_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},{name:"ortofotoColor20062007",key:"ortofoto_color_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},{name:"ortofotoColor20042005",key:"ortofoto_color_2004-2005",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},{name:"ortofotoColor20002003",key:"ortofoto_color_2000-2003",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},{name:"ortofotoBlancINegre1998",key:"ortofoto_blanc_i_negre_1998",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},{name:"ortofotoBlancINegre19941997",key:"ortofoto_blanc_i_negre_1994-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},{name:"ortofotoColor1993",key:"ortofoto_color_1993",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},{name:"ortofotoBlancINegre19831992",key:"ortofoto_blanc_i_negre_1983-1992",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},{name:"ortofotoBlancINegre19701977",key:"ortofoto_blanc_i_negre_1970-1977",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},{name:"ortofotoBlancINegre1956",key:"ortofoto_blanc_i_negre_1956",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},{name:"ortofotoBlancINegre1945",key:"ortofoto_blanc_i_negre_1945",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},{name:"ortofotoColorSerieAnual",key:"ortofoto_color_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},{name:"ortofotoInfraroigProvisional",key:"ortofoto_infraroig_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},{name:"ortofotoInfraroig2022",key:"ortofoto_infraroig_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},{name:"ortofotoInfraroig2021",key:"ortofoto_infraroig_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},{name:"ortofotoInfraroig2020",key:"ortofoto_infraroig_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},{name:"ortofotoInfraroig2019",key:"ortofoto_infraroig_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},{name:"ortofotoInfraroig2018",key:"ortofoto_infraroig_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},{name:"ortofotoInfraroig2017",key:"ortofoto_infraroig_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},{name:"ortofotoInfraroig2016",key:"ortofoto_infraroig_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},{name:"ortofotoInfraroig2015",key:"ortofoto_infraroig_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},{name:"ortofotoInfraroig2014",key:"ortofoto_infraroig_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},{name:"ortofotoInfraroig2013",key:"ortofoto_infraroig_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},{name:"ortofotoInfraroig2012",key:"ortofoto_infraroig_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},{name:"ortofotoInfraroig2011",key:"ortofoto_infraroig_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},{name:"ortofotoInfraroig2010",key:"ortofoto_infraroig_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},{name:"ortofotoInfraroig2009",key:"ortofoto_infraroig_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},{name:"ortofotoInfraroig2008",key:"ortofoto_infraroig_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},{name:"ortofotoInfraroig20062007",key:"ortofoto_infraroig_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},{name:"ortofotoInfraroig19961997",key:"ortofoto_infraroig_1996-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},{name:"ortofotoInfraroigSerieAnual",key:"ortofoto_infraroig_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}],vectorLayersICGC:[{name:"agrupacionsCensals2015",key:"agrupacions_censals_2015"},{name:"agrupacionsCensals2016",key:"agrupacions_censals_2016"},{name:"agrupacionsCensals2017",key:"agrupacions_censals_2017"},{name:"agrupacionsCensals2018",key:"agrupacions_censals_2018"},{name:"agrupacionsCensals2019",key:"agrupacions_censals_2019"},{name:"agrupacionsCensals2020",key:"agrupacions_censals_2020"},{name:"agrupacionsCensals2021",key:"agrupacions_censals_2021"},{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text"},{name:"areesBasiquesPolicials2019",key:"arees_basiques_policials_2019"},{name:"areesBasiquesPolicials2020",key:"arees_basiques_policials_2020"},{name:"areesBasiquesPolicials2022",key:"arees_basiques_policials_2022"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent"},{name:"catalunyaVigent",key:"catalunya_vigent"},{name:"catalunyaVigentText",key:"catalunya_vigent_text"},{name:"comarques2022",key:"comarques_2022"},{name:"comarquesVigent",key:"comarques_vigent"},{name:"comarquesVigentText",key:"comarques_vigent_text"},{name:"districtesCensals2015",key:"districtes_censals_2015"},{name:"districtesCensals2016",key:"districtes_censals_2016"},{name:"districtesCensals2017",key:"districtes_censals_2017"},{name:"districtesCensals2018",key:"districtes_censals_2018"},{name:"districtesCensals2019",key:"districtes_censals_2019"},{name:"districtesCensals2020",key:"districtes_censals_2020"},{name:"districtesCensals2021",key:"districtes_censals_2021"},{name:"districtesCensals2022",key:"districtes_censals_2022"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text"},{name:"municipis2022",key:"municipis_2022"},{name:"municipis2022Text",key:"municipis_2022_text"},{name:"municipisVigent",key:"municipis_vigent"},{name:"municipisVigentText",key:"municipis_vigent_text"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text"},{name:"plaTerritorial2015",key:"pla_territorial_2015"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text"},{name:"provinciesVigent",key:"provincies_vigent"},{name:"provinciesVigentText",key:"provincies_vigent_text"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text"},{name:"seccionsCensals2015",key:"seccions_censals_2015"},{name:"seccionsCensals2016",key:"seccions_censals_2016"},{name:"seccionsCensals2017",key:"seccions_censals_2017"},{name:"seccionsCensals2018",key:"seccions_censals_2018"},{name:"seccionsCensals2019",key:"seccions_censals_2019"},{name:"seccionsCensals2020",key:"seccions_censals_2020"},{name:"seccionsCensals2021",key:"seccions_censals_2021"},{name:"seccionsCensals2022",key:"seccions_censals_2022"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent"},{name:"vegueriesVigent",key:"vegueries_vigent"},{name:"vegueriesVigentText",key:"vegueries_vigent_text"}],vectorLayers:[{key:"cobertes2018",url:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json",legend:"https://tilemaps.icgc.cat/cdn/images/llegendaCobertesSol2018.jpg"}],wmsLayers:[{key:"espaisInteresGeologic",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"gravimetriaBouguer500000",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"cobertesSol2018",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"administratiu",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},{key:"simplificat",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},{key:"cims",layer:"",url:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},{key:"cobertesSol",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}],fgbLayers:[{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},{name:"catalunyaVigent",key:"catalunya_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},{name:"catalunyaVigentText",key:"catalunya_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},{name:"comarquesVigent",key:"comarques_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},{name:"comarquesVigentText",key:"comarques_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},{name:"municipisVigent",key:"municipis_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},{name:"municipisVigentText",key:"municipis_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},{name:"provinciesVigent",key:"provincies_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},{name:"provinciesVigentText",key:"provincies_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},{name:"vegueriesVigent",key:"vegueries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},{name:"vegueriesVigentText",key:"vegueries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}]},fit={TOPO:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard.json",ORTO:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",ORTO3D:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",ADMIN:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",DARK:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json"},pit={ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},git={Orto:{ortofotoColorProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional",ortofotoColor2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022",ortofotoColor2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021",ortofotoColor2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020",ortofotoColor2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019",ortofotoColor2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018",ortofotoColor2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017",ortofotoColor2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016",ortofotoColor2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015",ortofotoColor2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014",ortofotoColor2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013",ortofotoColor2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012",ortofotoColor2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011",ortofotoColor2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010",ortofotoColor2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009",ortofotoColor2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008",ortofotoColor20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007",ortofotoColor20042005:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005",ortofotoColor20002003:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003",ortofotoBlancINegre1998:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998",ortofotoBlancINegre19941997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997",ortofotoColor1993:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993",ortofotoBlancINegre19831992:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992",ortofotoBlancINegre19701977:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977",ortofotoBlancINegre1956:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956",ortofotoBlancINegre1945:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945",ortofotoColorSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual",ortofotoInfraroigProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional",ortofotoInfraroig2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022",ortofotoInfraroig2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021",ortofotoInfraroig2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020",ortofotoInfraroig2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019",ortofotoInfraroig2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018",ortofotoInfraroig2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017",ortofotoInfraroig2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016",ortofotoInfraroig2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015",ortofotoInfraroig2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014",ortofotoInfraroig2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013",ortofotoInfraroig2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012",ortofotoInfraroig2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011",ortofotoInfraroig2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010",ortofotoInfraroig2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009",ortofotoInfraroig2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008",ortofotoInfraroig20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007",ortofotoInfraroig19961997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997",ortofotoInfraroigSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},VectorAdmin:{agrupacionsCensals2015:"agrupacions_censals_2015",agrupacionsCensals2016:"agrupacions_censals_2016",agrupacionsCensals2017:"agrupacions_censals_2017",agrupacionsCensals2018:"agrupacions_censals_2018",agrupacionsCensals2019:"agrupacions_censals_2019",agrupacionsCensals2020:"agrupacions_censals_2020",agrupacionsCensals2021:"agrupacions_censals_2021",agrupacionsCensalsVigent:"agrupacions_censals_vigent",agrupacionsCensalsVigentText:"agrupacions_censals_vigent_text",areesBasiquesPolicials2019:"arees_basiques_policials_2019",areesBasiquesPolicials2020:"arees_basiques_policials_2020",areesBasiquesPolicials2022:"arees_basiques_policials_2022",areesBasiquesPolicialsVigent:"arees_basiques_policials_vigent",areesBasiquesPolicialsVigentText:"arees_basiques_policials_vigent_text",areesBasiquesSalutVigent:"arees_basiques_salut_vigent",areesBasiquesServeisSocialsVigent:"arees_basiques_serveis_socials_vigent",areesBasiquesServeisSocialsVigentText:"arees_basiques_serveis_socials_vigent_text",areesGestioAssistencialVigent:"arees_gestio_assistencial_vigent",areesHidrogeologiquesAquifersVigent:"arees_hidrogeologiques_aquifers_vigent",catalunyaVigent:"catalunya_vigent",catalunyaVigentText:"catalunya_vigent_text",comarques2022:"comarques_2022",comarquesVigent:"comarques_vigent",comarquesVigentText:"comarques_vigent_text",districtesCensals2015:"districtes_censals_2015",districtesCensals2016:"districtes_censals_2016",districtesCensals2017:"districtes_censals_2017",districtesCensals2018:"districtes_censals_2018",districtesCensals2019:"districtes_censals_2019",districtesCensals2020:"districtes_censals_2020",districtesCensals2021:"districtes_censals_2021",districtesCensals2022:"districtes_censals_2022",districtesCensalsVigent:"districtes_censals_vigent",districtesCensalsVigentText:"districtes_censals_vigent_text",incendisForestalsVigent:"incendis_forestals_vigent",incendisForestalsVigentText:"incendis_forestals_vigent_text",municipis2022:"municipis_2022",municipis2022Text:"municipis_2022_text",municipisVigent:"municipis_vigent",municipisVigentText:"municipis_vigent_text",partitsJudicialsVigent:"partits_judicials_vigent",partitsJudicialsVigentText:"partits_judicials_vigent_text",plaTerritorial2015:"pla_territorial_2015",plaTerritorialVigent:"pla_territorial_vigent",plaTerritorialVigentText:"pla_territorial_vigent_text",provinciesVigent:"provincies_vigent",provinciesVigentText:"provincies_vigent_text",regionsPolicialsVigent:"regions_policials_vigent",regionsPolicialsVigentText:"regions_policials_vigent_text",regionsSanitariesVigent:"regions_sanitaries_vigent",regionsSanitariesVigentText:"regions_sanitaries_vigent_text",seccionsCensals2015:"seccions_censals_2015",seccionsCensals2016:"seccions_censals_2016",seccionsCensals2017:"seccions_censals_2017",seccionsCensals2018:"seccions_censals_2018",seccionsCensals2019:"seccions_censals_2019",seccionsCensals2020:"seccions_censals_2020",seccionsCensals2021:"seccions_censals_2021",seccionsCensals2022:"seccions_censals_2022",seccionsCensalsVigent:"seccions_censals_vigent",seccionsCensalsVigentText:"seccions_censals_vigent_text",sectorsSanitarisVigent:"sectors_sanitaris_vigent",vegueriesVigent:"vegueries_vigent",vegueriesVigentText:"vegueries_vigent_text"},FGBAdmin:{agrupacionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb",agrupacionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb",areesBasiquesPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb",areesBasiquesPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb",areesBasiquesSalutVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb",areesBasiquesServeisSocialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb",areesBasiquesServeisSocialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb",areesGestioAssistencialVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb",areesHidrogeologiquesAquifersVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb",catalunyaVigent:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb",catalunyaVigentText:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb",comarquesVigent:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb",comarquesVigentText:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb",districtesCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb",districtesCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb",incendisForestalsVigent:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb",incendisForestalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb",municipisVigent:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb",municipisVigentText:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb",partitsJudicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb",partitsJudicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb",plaTerritorialVigent:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb",plaTerritorialVigentText:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb",provinciesVigent:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb",provinciesVigentText:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb",regionsPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb",regionsPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb",regionsSanitariesVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb",regionsSanitariesVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb",seccionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb",seccionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb",sectorsSanitarisVigent:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb",vegueriesVigent:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb",vegueriesVigentText:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},Vector:{cobertes2018:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"},WMS:{espaisInteresGeologic:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",gravimetriaBouguer500000:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",cobertesSol2018:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",administratiu:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",simplificat:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",cims:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455",cobertesSol:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}},pf={defaultOptions:dit,Styles:fit,Terrains:pit,Layers:git};class mit{constructor(t){this.options=t||{}}onAdd(t){let r=pf.defaultOptions;return this._map=t,this._img1=document.createElement("img"),this._img1.className="maplibregl-ctrl",this._img1.src=this.options.color?r.logoIcgcOptions.logoUrlColor:r.logoIcgcOptions.logoUrlWhite,this._img1.width=r.logoIcgcOptions.logoWidth,this._img1.title=r.logoIcgcOptions.logoTitle,this.link1=document.createElement("a"),this.link1.href=r.logoIcgcOptions.logoLink,this.link1.target="_blank",this.link1.appendChild(this._img1),this._container1=document.createElement("div"),this._container1.className="maplibregl-ctrl",this._container1.style.width=`${r.logoIcgcOptions.logoWidth}px`,this._container1.appendChild(this.link1),this._img2=document.createElement("img"),this._img2.className="maplibregl-ctrl",this._img2.src=this.options.color?r.logoGencatOptions.logoUrlColor:r.logoGencatOptions.logoUrlWhite,this._img2.width=r.logoGencatOptions.logoWidth,this._img2.title=r.logoGencatOptions.logoTitle,this.link2=document.createElement("a"),this.link2.href=r.logoGencatOptions.logoLink,this.link2.target="_blank",this.link2.appendChild(this._img2),this._container2=document.createElement("div"),this._container2.className="maplibregl-ctrl",this._container2.style.width=`${r.logoGencatOptions.logoWidth}px`,this._container2.appendChild(this.link2),this._mainContainer=document.createElement("div"),this._mainContainer.className="divLogos",this._mainContainer.style="display: flex",this._mainContainer.appendChild(this._container1),this._mainContainer.appendChild(this._container2),this._mainContainer}}class yit{constructor(t){this.options=t||{}}onAdd(t){this._map=t,this._img1=document.createElement("img"),this._img1.src=this.options.url,this._img1.width=150,this._img1.title=300,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.legendContainer=document.createElement("div"),this.legendContainer.classList.add("maplibregl-legend-list"),this.legendButton=document.createElement("button"),this.legendButton.classList.add("maplibregl-ctrl-icon"),this.legendButton.classList.add("maplibregl-legend-switcher"),this.legendButton.addEventListener("click",()=>{this.legendButton.style.display="none",this.legendContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.legendButton),this.controlContainer.appendChild(this.legendContainer),this.closeButton=document.createElement("button"),this.closeButton.textContent="x",this.closeButton.classList.add("maplibregl-legend-close-button"),this.closeButton.addEventListener("click",()=>{this.legendButton.style.display="block",this.legendContainer.style.display="none"}),this.legendContainer.appendChild(this.closeButton);const r=document.createElement("label");return r.classList.add("maplibregl-legend-title-label"),r.textContent=this.options.idLayer||"Llegenda",this.legendContainer.appendChild(r),this.legendContainer.appendChild(document.createElement("br")),this.legendContainer.appendChild(this._img1),this.controlContainer}}var Sg=tR.prototype,Zx="WGS 84";function tR(e){e!==void 0&&(Zx=e),this.setEllipsoid(Zx)}Sg.convertLatLngToUtm=function(e,t,r){var i;if(this.status)return"No ecclipsoid data associated with unknown datum: "+Zx;if(!Number.isInteger(r))return"Precision is not integer number.";e=parseFloat(e),t=parseFloat(t);var n=t,s=this.toRadians(e),a=this.toRadians(n);n>=8&&n<=13&&e>54.5&&e<58||e>=56&&e<64&&n>=3&&n<12?i=32:(i=(n+180)/6+1,e>=72&&e<84&&(n>=0&&n<9?i=31:n>=9&&n<21?i=33:n>=21&&n<33?i=35:n>=33&&n<42&&(i=37))),i=parseInt(i);var o=(i-1)*6-180+3,f=this.toRadians(o),m=this.getUtmLetterDesignator(e),w=this.eccSquared/(1-this.eccSquared),A=this.a/Math.sqrt(1-this.eccSquared*Math.sin(s)*Math.sin(s)),P=Math.tan(s)*Math.tan(s),I=w*Math.cos(s)*Math.cos(s),N=Math.cos(s)*(a-f),F=this.a*((1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)*s-(3*this.eccSquared/8+3*this.eccSquared*this.eccSquared/32+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(2*s)+(15*this.eccSquared*this.eccSquared/256+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(4*s)-35*this.eccSquared*this.eccSquared*this.eccSquared/3072*Math.sin(6*s)),Z=parseFloat(.9996*A*(N+(1-P+I)*N*N*N/6+(5-18*P+P*P+72*I-58*w)*N*N*N*N*N/120)+5e5),U=parseFloat(.9996*(F+A*Math.tan(s)*(N*N/2+(5-P+9*I+4*I*I)*N*N*N*N/24+(61-58*P+P*P+600*I-330*w)*N*N*N*N*N*N/720)));return e<0&&(U+=1e7),U=YI(U,r),Z=YI(Z,r),{Easting:Z,Northing:U,ZoneNumber:parseInt(i),ZoneLetter:m}};Sg.convertUtmToLatLng=function(e,t,r,i){var n=(1-Math.sqrt(1-this.eccSquared))/(1+Math.sqrt(1-this.eccSquared)),s=e-5e5,a=t,o=r,f=i;if(e===void 0)return"Please pass the UTMEasting!";if(t===void 0)return"Please pass the UTMNorthing!";if(r===void 0)return"Please pass the UTMZoneNumber!";if(i===void 0)return"Please pass the UTMZoneLetter!";["N","P","Q","R","S","T","U","V","W","X","Y","Z"].indexOf(f)!==-1||(a-=1e7);var m=(o-1)*6-180+3,w=this.eccSquared/(1-this.eccSquared),A=a/.9996,P=A/(this.a*(1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)),I=P+(3*n/2-27*n*n*n/32)*Math.sin(2*P)+(21*n*n/16-55*n*n*n*n/32)*Math.sin(4*P)+151*n*n*n/96*Math.sin(6*P);this.toDegrees(I);var N=this.a/Math.sqrt(1-this.eccSquared*Math.sin(I)*Math.sin(I)),F=Math.tan(I)*Math.tan(I),Z=w*Math.cos(I)*Math.cos(I),U=this.a*(1-this.eccSquared)/Math.pow(1-this.eccSquared*Math.sin(I)*Math.sin(I),1.5),z=s/(N*.9996),J=I-N*Math.tan(I)/U*(z*z/2-(5+3*F+10*Z-4*Z*Z-9*w)*z*z*z*z/24+(61+90*F+298*Z+45*F*F-252*w-3*Z*Z)*z*z*z*z*z*z/720);J=this.toDegrees(J);var nt=(z-(1+2*F+Z)*z*z*z/6+(5-2*Z+28*F-3*Z*Z+8*w+24*F*F)*z*z*z*z*z/120)/Math.cos(I);return nt=m+this.toDegrees(nt),{lat:J,lng:nt}};Sg.getUtmLetterDesignator=function(e){return e=parseFloat(e),84>=e&&e>=72?"X":72>e&&e>=64?"W":64>e&&e>=56?"V":56>e&&e>=48?"U":48>e&&e>=40?"T":40>e&&e>=32?"S":32>e&&e>=24?"R":24>e&&e>=16?"Q":16>e&&e>=8?"P":8>e&&e>=0?"N":0>e&&e>=-8?"M":-8>e&&e>=-16?"L":-16>e&&e>=-24?"K":-24>e&&e>=-32?"J":-32>e&&e>=-40?"H":-40>e&&e>=-48?"G":-48>e&&e>=-56?"F":-56>e&&e>=-64?"E":-64>e&&e>=-72?"D":-72>e&&e>=-80?"C":"Z"};Sg.setEllipsoid=function(e){switch(e){case"Airy":this.a=6377563,this.eccSquared=.00667054;break;case"Australian National":this.a=6378160,this.eccSquared=.006694542;break;case"Bessel 1841":this.a=6377397,this.eccSquared=.006674372;break;case"Bessel 1841 Nambia":this.a=6377484,this.eccSquared=.006674372;break;case"Clarke 1866":this.a=6378206,this.eccSquared=.006768658;break;case"Clarke 1880":this.a=6378249,this.eccSquared=.006803511;break;case"Everest":this.a=6377276,this.eccSquared=.006637847;break;case"Fischer 1960 Mercury":this.a=6378166,this.eccSquared=.006693422;break;case"Fischer 1968":this.a=6378150,this.eccSquared=.006693422;break;case"GRS 1967":this.a=6378160,this.eccSquared=.006694605;break;case"GRS 1980":this.a=6378137,this.eccSquared=.00669438;break;case"Helmert 1906":this.a=6378200,this.eccSquared=.006693422;break;case"Hough":this.a=6378270,this.eccSquared=.00672267;break;case"International":this.a=6378388,this.eccSquared=.00672267;break;case"Krassovsky":this.a=6378245,this.eccSquared=.006693422;break;case"Modified Airy":this.a=6377340,this.eccSquared=.00667054;break;case"Modified Everest":this.a=6377304,this.eccSquared=.006637847;break;case"Modified Fischer 1960":this.a=6378155,this.eccSquared=.006693422;break;case"South American 1969":this.a=6378160,this.eccSquared=.006694542;break;case"WGS 60":this.a=6378165,this.eccSquared=.006693422;break;case"WGS 66":this.a=6378145,this.eccSquared=.006694542;break;case"WGS 72":this.a=6378135,this.eccSquared=.006694318;break;case"ED50":this.a=6378388,this.eccSquared=.00672267;break;case"WGS 84":case"EUREF89":case"ETRS89":this.a=6378137,this.eccSquared=.00669438;break;default:this.status=!0}};Sg.toDegrees=function(e){return e/Math.PI*180};Sg.toRadians=function(e){return e*Math.PI/180};function YI(e,t){var r=Math.pow(10,t);return Math.round(e*r)/r}var _it=tR;const vit=K_(_it);class bit{constructor(t){this.options=t||{},this.options.utm=this.options.hasOwnProperty("utm")?this.options.utm:!0,this.options.lonlat=this.options.hasOwnProperty("lonlat")?this.options.lonlat:!0}onAdd(t){const r=new vit;return this._map=t,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl coordControl",this._container.style.width=`${this.options.width||"225px"}`,this._map.on("mousemove",i=>{const n=i.lngLat.lat,s=i.lngLat.lng;let a="",o="";const f=r.convertLatLngToUtm(n,s,2),m=n>0?"N":"S";this.options.utm&&(a=`ETRS89 UTM ${f.ZoneNumber}${m} X:<b> ${f.Easting}</b> Y:<b> ${f.Northing}</b> <br>`),this.options.lonlat&&(o=`WGS 84 Lon:<b> ${s.toFixed(5)}</b>  Lat:<b> ${n.toFixed(5)}</b>`);const w=`${a}${o}`;this._container.innerHTML=w}),this._container}_lookUTM31(t,r){var i=0,n=0,s=6,a=84;return t>=i&&t<=s&&r>=n&&r<=a}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function eR(e,t){return function(){return e.apply(t,arguments)}}const{toString:wit}=Object.prototype,{getPrototypeOf:_S}=Object,gv=(e=>t=>{const r=wit.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),vu=e=>(e=e.toLowerCase(),t=>gv(t)===e),mv=e=>t=>typeof t===e,{isArray:Eg}=Array,v0=mv("undefined");function xit(e){return e!==null&&!v0(e)&&e.constructor!==null&&!v0(e.constructor)&&Rl(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const rR=vu("ArrayBuffer");function Ait(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&rR(e.buffer),t}const Sit=mv("string"),Rl=mv("function"),iR=mv("number"),yv=e=>e!==null&&typeof e=="object",Eit=e=>e===!0||e===!1,Dy=e=>{if(gv(e)!=="object")return!1;const t=_S(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Cit=vu("Date"),Tit=vu("File"),Pit=vu("Blob"),Iit=vu("FileList"),Mit=e=>yv(e)&&Rl(e.pipe),Lit=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Rl(e.append)&&((t=gv(e))==="formdata"||t==="object"&&Rl(e.toString)&&e.toString()==="[object FormData]"))},Bit=vu("URLSearchParams"),kit=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function j0(e,t){let{allOwnKeys:r=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e===null||typeof e>"u")return;let i,n;if(typeof e!="object"&&(e=[e]),Eg(e))for(i=0,n=e.length;i<n;i++)t.call(null,e[i],i,e);else{const s=r?Object.getOwnPropertyNames(e):Object.keys(e),a=s.length;let o;for(i=0;i<a;i++)o=s[i],t.call(null,e[o],o,e)}}function nR(e,t){t=t.toLowerCase();const r=Object.keys(e);let i=r.length,n;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}const sR=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,oR=e=>!v0(e)&&e!==sR;function Jx(){const{caseless:e}=oR(this)&&this||{},t={},r=(i,n)=>{const s=e&&nR(t,n)||n;Dy(t[s])&&Dy(i)?t[s]=Jx(t[s],i):Dy(i)?t[s]=Jx({},i):Eg(i)?t[s]=i.slice():t[s]=i};for(let i=0,n=arguments.length;i<n;i++)arguments[i]&&j0(arguments[i],r);return t}const Rit=function(e,t,r){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return j0(t,(n,s)=>{r&&Rl(n)?e[s]=eR(n,r):e[s]=n},{allOwnKeys:i}),e},Oit=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),Dit=(e,t,r,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},Nit=(e,t,r,i)=>{let n,s,a;const o={};if(t=t||{},e==null)return t;do{for(n=Object.getOwnPropertyNames(e),s=n.length;s-- >0;)a=n[s],(!i||i(a,e,t))&&!o[a]&&(t[a]=e[a],o[a]=!0);e=r!==!1&&_S(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},Fit=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const i=e.indexOf(t,r);return i!==-1&&i===r},zit=e=>{if(!e)return null;if(Eg(e))return e;let t=e.length;if(!iR(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},jit=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&_S(Uint8Array)),Uit=(e,t)=>{const r=(e&&e[Symbol.iterator]).call(e);let i;for(;(i=r.next())&&!i.done;){const n=i.value;t.call(e,n[0],n[1])}},Git=(e,t)=>{let r;const i=[];for(;(r=e.exec(t))!==null;)i.push(r);return i},Vit=vu("HTMLFormElement"),qit=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,i){return r.toUpperCase()+i}),QI=(e=>{let{hasOwnProperty:t}=e;return(r,i)=>t.call(r,i)})(Object.prototype),Hit=vu("RegExp"),aR=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),i={};j0(r,(n,s)=>{let a;(a=t(n,s,e))!==!1&&(i[s]=a||n)}),Object.defineProperties(e,i)},Wit=e=>{aR(e,(t,r)=>{if(Rl(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const i=e[r];if(Rl(i)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},$it=(e,t)=>{const r={},i=n=>{n.forEach(s=>{r[s]=!0})};return Eg(e)?i(e):i(String(e).split(t)),r},Zit=()=>{},Jit=(e,t)=>(e=+e,Number.isFinite(e)?e:t),H2="abcdefghijklmnopqrstuvwxyz",t4="0123456789",lR={DIGIT:t4,ALPHA:H2,ALPHA_DIGIT:H2+H2.toUpperCase()+t4},Xit=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:lR.ALPHA_DIGIT,r="";const{length:i}=t;for(;e--;)r+=t[Math.random()*i|0];return r};function Kit(e){return!!(e&&Rl(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])}const Yit=e=>{const t=new Array(10),r=(i,n)=>{if(yv(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[n]=i;const s=Eg(i)?[]:{};return j0(i,(a,o)=>{const f=r(a,n+1);!v0(f)&&(s[o]=f)}),t[n]=void 0,s}}return i};return r(e,0)},Qit=vu("AsyncFunction"),tnt=e=>e&&(yv(e)||Rl(e))&&Rl(e.then)&&Rl(e.catch),Ae={isArray:Eg,isArrayBuffer:rR,isBuffer:xit,isFormData:Lit,isArrayBufferView:Ait,isString:Sit,isNumber:iR,isBoolean:Eit,isObject:yv,isPlainObject:Dy,isUndefined:v0,isDate:Cit,isFile:Tit,isBlob:Pit,isRegExp:Hit,isFunction:Rl,isStream:Mit,isURLSearchParams:Bit,isTypedArray:jit,isFileList:Iit,forEach:j0,merge:Jx,extend:Rit,trim:kit,stripBOM:Oit,inherits:Dit,toFlatObject:Nit,kindOf:gv,kindOfTest:vu,endsWith:Fit,toArray:zit,forEachEntry:Uit,matchAll:Git,isHTMLForm:Vit,hasOwnProperty:QI,hasOwnProp:QI,reduceDescriptors:aR,freezeMethods:Wit,toObjectSet:$it,toCamelCase:qit,noop:Zit,toFiniteNumber:Jit,findKey:nR,global:sR,isContextDefined:oR,ALPHABET:lR,generateString:Xit,isSpecCompliantForm:Kit,toJSONObject:Yit,isAsyncFn:Qit,isThenable:tnt};function wi(e,t,r,i,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),i&&(this.request=i),n&&(this.response=n)}Ae.inherits(wi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ae.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const cR=wi.prototype,uR={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{uR[e]={value:e}});Object.defineProperties(wi,uR);Object.defineProperty(cR,"isAxiosError",{value:!0});wi.from=(e,t,r,i,n,s)=>{const a=Object.create(cR);return Ae.toFlatObject(e,a,function(o){return o!==Error.prototype},o=>o!=="isAxiosError"),wi.call(a,e.message,t,r,i,n),a.cause=e,a.name=e.name,s&&Object.assign(a,s),a};const ent=null;function Xx(e){return Ae.isPlainObject(e)||Ae.isArray(e)}function hR(e){return Ae.endsWith(e,"[]")?e.slice(0,-2):e}function e4(e,t,r){return e?e.concat(t).map(function(i,n){return i=hR(i),!r&&n?"["+i+"]":i}).join(r?".":""):t}function rnt(e){return Ae.isArray(e)&&!e.some(Xx)}const int=Ae.toFlatObject(Ae,{},null,function(e){return/^is[A-Z]/.test(e)});function _v(e,t,r){if(!Ae.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=Ae.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(I,N){return!Ae.isUndefined(N[I])});const i=r.metaTokens,n=r.visitor||m,s=r.dots,a=r.indexes,o=(r.Blob||typeof Blob<"u"&&Blob)&&Ae.isSpecCompliantForm(t);if(!Ae.isFunction(n))throw new TypeError("visitor must be a function");function f(I){if(I===null)return"";if(Ae.isDate(I))return I.toISOString();if(!o&&Ae.isBlob(I))throw new wi("Blob is not supported. Use a Buffer instead.");return Ae.isArrayBuffer(I)||Ae.isTypedArray(I)?o&&typeof Blob=="function"?new Blob([I]):Buffer.from(I):I}function m(I,N,F){let Z=I;if(I&&!F&&typeof I=="object"){if(Ae.endsWith(N,"{}"))N=i?N:N.slice(0,-2),I=JSON.stringify(I);else if(Ae.isArray(I)&&rnt(I)||(Ae.isFileList(I)||Ae.endsWith(N,"[]"))&&(Z=Ae.toArray(I)))return N=hR(N),Z.forEach(function(U,z){!(Ae.isUndefined(U)||U===null)&&t.append(a===!0?e4([N],z,s):a===null?N:N+"[]",f(U))}),!1}return Xx(I)?!0:(t.append(e4(F,N,s),f(I)),!1)}const w=[],A=Object.assign(int,{defaultVisitor:m,convertValue:f,isVisitable:Xx});function P(I,N){if(!Ae.isUndefined(I)){if(w.indexOf(I)!==-1)throw Error("Circular reference detected in "+N.join("."));w.push(I),Ae.forEach(I,function(F,Z){(!(Ae.isUndefined(F)||F===null)&&n.call(t,F,Ae.isString(Z)?Z.trim():Z,N,A))===!0&&P(F,N?N.concat(Z):[Z])}),w.pop()}}if(!Ae.isObject(e))throw new TypeError("data must be an object");return P(e),t}function r4(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function vS(e,t){this._pairs=[],e&&_v(e,this,t)}const dR=vS.prototype;dR.append=function(e,t){this._pairs.push([e,t])};dR.toString=function(e){const t=e?function(r){return e.call(this,r,r4)}:r4;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};function nnt(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function fR(e,t,r){if(!t)return e;const i=r&&r.encode||nnt,n=r&&r.serialize;let s;if(n?s=n(t,r):s=Ae.isURLSearchParams(t)?t.toString():new vS(t,r).toString(i),s){const a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}class i4{constructor(){this.handlers=[]}use(t,r,i){return this.handlers.push({fulfilled:t,rejected:r,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Ae.forEach(this.handlers,function(r){r!==null&&t(r)})}}const pR={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},snt=typeof URLSearchParams<"u"?URLSearchParams:vS,ont=typeof FormData<"u"?FormData:null,ant=typeof Blob<"u"?Blob:null,lnt={isBrowser:!0,classes:{URLSearchParams:snt,FormData:ont,Blob:ant},protocols:["http","https","file","blob","url","data"]},gR=typeof window<"u"&&typeof document<"u",cnt=(e=>gR&&["ReactNative","NativeScript","NS"].indexOf(e)<0)(typeof navigator<"u"&&navigator.product),unt=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",hnt=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:gR,hasStandardBrowserEnv:cnt,hasStandardBrowserWebWorkerEnv:unt},Symbol.toStringTag,{value:"Module"})),fu={...hnt,...lnt};function dnt(e,t){return _v(e,new fu.classes.URLSearchParams,Object.assign({visitor:function(r,i,n,s){return fu.isNode&&Ae.isBuffer(r)?(this.append(i,r.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},t))}function fnt(e){return Ae.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function pnt(e){const t={},r=Object.keys(e);let i;const n=r.length;let s;for(i=0;i<n;i++)s=r[i],t[s]=e[s];return t}function mR(e){function t(r,i,n,s){let a=r[s++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),f=s>=r.length;return a=!a&&Ae.isArray(n)?n.length:a,f?(Ae.hasOwnProp(n,a)?n[a]=[n[a],i]:n[a]=i,!o):((!n[a]||!Ae.isObject(n[a]))&&(n[a]=[]),t(r,i,n[a],s)&&Ae.isArray(n[a])&&(n[a]=pnt(n[a])),!o)}if(Ae.isFormData(e)&&Ae.isFunction(e.entries)){const r={};return Ae.forEachEntry(e,(i,n)=>{t(fnt(i),n,r,0)}),r}return null}function gnt(e,t,r){if(Ae.isString(e))try{return(t||JSON.parse)(e),Ae.trim(e)}catch(i){if(i.name!=="SyntaxError")throw i}return(r||JSON.stringify)(e)}const bS={transitional:pR,adapter:["xhr","http"],transformRequest:[function(e,t){const r=t.getContentType()||"",i=r.indexOf("application/json")>-1,n=Ae.isObject(e);if(n&&Ae.isHTMLForm(e)&&(e=new FormData(e)),Ae.isFormData(e))return i?JSON.stringify(mR(e)):e;if(Ae.isArrayBuffer(e)||Ae.isBuffer(e)||Ae.isStream(e)||Ae.isFile(e)||Ae.isBlob(e))return e;if(Ae.isArrayBufferView(e))return e.buffer;if(Ae.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(n){if(r.indexOf("application/x-www-form-urlencoded")>-1)return dnt(e,this.formSerializer).toString();if((s=Ae.isFileList(e))||r.indexOf("multipart/form-data")>-1){const a=this.env&&this.env.FormData;return _v(s?{"files[]":e}:e,a&&new a,this.formSerializer)}}return n||i?(t.setContentType("application/json",!1),gnt(e)):e}],transformResponse:[function(e){const t=this.transitional||bS.transitional,r=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&Ae.isString(e)&&(r&&!this.responseType||i)){const n=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(s){if(n)throw s.name==="SyntaxError"?wi.from(s,wi.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:fu.classes.FormData,Blob:fu.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ae.forEach(["delete","get","head","post","put","patch"],e=>{bS.headers[e]={}});const wS=bS,mnt=Ae.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ynt=e=>{const t={};let r,i,n;return e&&e.split(`
`).forEach(function(s){n=s.indexOf(":"),r=s.substring(0,n).trim().toLowerCase(),i=s.substring(n+1).trim(),!(!r||t[r]&&mnt[r])&&(r==="set-cookie"?t[r]?t[r].push(i):t[r]=[i]:t[r]=t[r]?t[r]+", "+i:i)}),t},n4=Symbol("internals");function gm(e){return e&&String(e).trim().toLowerCase()}function Ny(e){return e===!1||e==null?e:Ae.isArray(e)?e.map(Ny):String(e)}function _nt(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=r.exec(e);)t[i[1]]=i[2];return t}const vnt=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function W2(e,t,r,i,n){if(Ae.isFunction(i))return i.call(this,t,r);if(n&&(t=r),!!Ae.isString(t)){if(Ae.isString(i))return t.indexOf(i)!==-1;if(Ae.isRegExp(i))return i.test(t)}}function bnt(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,i)=>r.toUpperCase()+i)}function wnt(e,t){const r=Ae.toCamelCase(" "+t);["get","set","has"].forEach(i=>{Object.defineProperty(e,i+r,{value:function(n,s,a){return this[i].call(this,t,n,s,a)},configurable:!0})})}class vv{constructor(t){t&&this.set(t)}set(t,r,i){const n=this;function s(o,f,m){const w=gm(f);if(!w)throw new Error("header name must be a non-empty string");const A=Ae.findKey(n,w);(!A||n[A]===void 0||m===!0||m===void 0&&n[A]!==!1)&&(n[A||f]=Ny(o))}const a=(o,f)=>Ae.forEach(o,(m,w)=>s(m,w,f));return Ae.isPlainObject(t)||t instanceof this.constructor?a(t,r):Ae.isString(t)&&(t=t.trim())&&!vnt(t)?a(ynt(t),r):t!=null&&s(r,t,i),this}get(t,r){if(t=gm(t),t){const i=Ae.findKey(this,t);if(i){const n=this[i];if(!r)return n;if(r===!0)return _nt(n);if(Ae.isFunction(r))return r.call(this,n,i);if(Ae.isRegExp(r))return r.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=gm(t),t){const i=Ae.findKey(this,t);return!!(i&&this[i]!==void 0&&(!r||W2(this,this[i],i,r)))}return!1}delete(t,r){const i=this;let n=!1;function s(a){if(a=gm(a),a){const o=Ae.findKey(i,a);o&&(!r||W2(i,i[o],o,r))&&(delete i[o],n=!0)}}return Ae.isArray(t)?t.forEach(s):s(t),n}clear(t){const r=Object.keys(this);let i=r.length,n=!1;for(;i--;){const s=r[i];(!t||W2(this,this[s],s,t,!0))&&(delete this[s],n=!0)}return n}normalize(t){const r=this,i={};return Ae.forEach(this,(n,s)=>{const a=Ae.findKey(i,s);if(a){r[a]=Ny(n),delete r[s];return}const o=t?bnt(s):String(s).trim();o!==s&&delete r[s],r[o]=Ny(n),i[o]=!0}),this}concat(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return this.constructor.concat(this,...r)}toJSON(t){const r=Object.create(null);return Ae.forEach(this,(i,n)=>{i!=null&&i!==!1&&(r[n]=t&&Ae.isArray(i)?i.join(", "):i)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[r,i]=t;return r+": "+i}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const r=new this(t);for(var i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];return n.forEach(a=>r.set(a)),r}static accessor(t){const r=(this[n4]=this[n4]={accessors:{}}).accessors,i=this.prototype;function n(s){const a=gm(s);r[a]||(wnt(i,s),r[a]=!0)}return Ae.isArray(t)?t.forEach(n):n(t),this}}vv.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ae.reduceDescriptors(vv.prototype,(e,t)=>{let{value:r}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(n){this[i]=n}}});Ae.freezeMethods(vv);const oh=vv;function $2(e,t){const r=this||wS,i=t||r,n=oh.from(i.headers);let s=i.data;return Ae.forEach(e,function(a){s=a.call(r,s,n.normalize(),t?t.status:void 0)}),n.normalize(),s}function yR(e){return!!(e&&e.__CANCEL__)}function U0(e,t,r){wi.call(this,e??"canceled",wi.ERR_CANCELED,t,r),this.name="CanceledError"}Ae.inherits(U0,wi,{__CANCEL__:!0});function xnt(e,t,r){const i=r.config.validateStatus;!r.status||!i||i(r.status)?e(r):t(new wi("Request failed with status code "+r.status,[wi.ERR_BAD_REQUEST,wi.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}const Ant=fu.hasStandardBrowserEnv?{write(e,t,r,i,n,s){const a=[e+"="+encodeURIComponent(t)];Ae.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),Ae.isString(i)&&a.push("path="+i),Ae.isString(n)&&a.push("domain="+n),s===!0&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Snt(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Ent(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function _R(e,t){return e&&!Snt(t)?Ent(e,t):t}const Cnt=fu.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let r;function i(n){let s=n;return e&&(t.setAttribute("href",s),s=t.href),t.setAttribute("href",s),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return r=i(window.location.href),function(n){const s=Ae.isString(n)?i(n):n;return s.protocol===r.protocol&&s.host===r.host}}():function(){return function(){return!0}}();function Tnt(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function Pnt(e,t){e=e||10;const r=new Array(e),i=new Array(e);let n=0,s=0,a;return t=t!==void 0?t:1e3,function(o){const f=Date.now(),m=i[s];a||(a=f),r[n]=o,i[n]=f;let w=s,A=0;for(;w!==n;)A+=r[w++],w=w%e;if(n=(n+1)%e,n===s&&(s=(s+1)%e),f-a<t)return;const P=m&&f-m;return P?Math.round(A*1e3/P):void 0}}function s4(e,t){let r=0;const i=Pnt(50,250);return n=>{const s=n.loaded,a=n.lengthComputable?n.total:void 0,o=s-r,f=i(o),m=s<=a;r=s;const w={loaded:s,total:a,progress:a?s/a:void 0,bytes:o,rate:f||void 0,estimated:f&&a&&m?(a-s)/f:void 0,event:n};w[t?"download":"upload"]=!0,e(w)}}const Int=typeof XMLHttpRequest<"u",Mnt=Int&&function(e){return new Promise(function(t,r){let i=e.data;const n=oh.from(e.headers).normalize();let{responseType:s,withXSRFToken:a}=e,o;function f(){e.cancelToken&&e.cancelToken.unsubscribe(o),e.signal&&e.signal.removeEventListener("abort",o)}let m;if(Ae.isFormData(i)){if(fu.hasStandardBrowserEnv||fu.hasStandardBrowserWebWorkerEnv)n.setContentType(!1);else if((m=n.getContentType())!==!1){const[N,...F]=m?m.split(";").map(Z=>Z.trim()).filter(Boolean):[];n.setContentType([N||"multipart/form-data",...F].join("; "))}}let w=new XMLHttpRequest;if(e.auth){const N=e.auth.username||"",F=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";n.set("Authorization","Basic "+btoa(N+":"+F))}const A=_R(e.baseURL,e.url);w.open(e.method.toUpperCase(),fR(A,e.params,e.paramsSerializer),!0),w.timeout=e.timeout;function P(){if(!w)return;const N=oh.from("getAllResponseHeaders"in w&&w.getAllResponseHeaders()),F={data:!s||s==="text"||s==="json"?w.responseText:w.response,status:w.status,statusText:w.statusText,headers:N,config:e,request:w};xnt(function(Z){t(Z),f()},function(Z){r(Z),f()},F),w=null}if("onloadend"in w?w.onloadend=P:w.onreadystatechange=function(){!w||w.readyState!==4||w.status===0&&!(w.responseURL&&w.responseURL.indexOf("file:")===0)||setTimeout(P)},w.onabort=function(){w&&(r(new wi("Request aborted",wi.ECONNABORTED,e,w)),w=null)},w.onerror=function(){r(new wi("Network Error",wi.ERR_NETWORK,e,w)),w=null},w.ontimeout=function(){let N=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const F=e.transitional||pR;e.timeoutErrorMessage&&(N=e.timeoutErrorMessage),r(new wi(N,F.clarifyTimeoutError?wi.ETIMEDOUT:wi.ECONNABORTED,e,w)),w=null},fu.hasStandardBrowserEnv&&(a&&Ae.isFunction(a)&&(a=a(e)),a||a!==!1&&Cnt(A))){const N=e.xsrfHeaderName&&e.xsrfCookieName&&Ant.read(e.xsrfCookieName);N&&n.set(e.xsrfHeaderName,N)}i===void 0&&n.setContentType(null),"setRequestHeader"in w&&Ae.forEach(n.toJSON(),function(N,F){w.setRequestHeader(F,N)}),Ae.isUndefined(e.withCredentials)||(w.withCredentials=!!e.withCredentials),s&&s!=="json"&&(w.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&w.addEventListener("progress",s4(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&w.upload&&w.upload.addEventListener("progress",s4(e.onUploadProgress)),(e.cancelToken||e.signal)&&(o=N=>{w&&(r(!N||N.type?new U0(null,e,w):N),w.abort(),w=null)},e.cancelToken&&e.cancelToken.subscribe(o),e.signal&&(e.signal.aborted?o():e.signal.addEventListener("abort",o)));const I=Tnt(A);if(I&&fu.protocols.indexOf(I)===-1){r(new wi("Unsupported protocol "+I+":",wi.ERR_BAD_REQUEST,e));return}w.send(i||null)})},Kx={http:ent,xhr:Mnt};Ae.forEach(Kx,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const o4=e=>`- ${e}`,Lnt=e=>Ae.isFunction(e)||e===null||e===!1,vR={getAdapter:e=>{e=Ae.isArray(e)?e:[e];const{length:t}=e;let r,i;const n={};for(let s=0;s<t;s++){r=e[s];let a;if(i=r,!Lnt(r)&&(i=Kx[(a=String(r)).toLowerCase()],i===void 0))throw new wi(`Unknown adapter '${a}'`);if(i)break;n[a||"#"+s]=i}if(!i){const s=Object.entries(n).map(o=>{let[f,m]=o;return`adapter ${f} `+(m===!1?"is not supported by the environment":"is not available in the build")});let a=t?s.length>1?`since :
`+s.map(o4).join(`
`):" "+o4(s[0]):"as no adapter specified";throw new wi("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return i},adapters:Kx};function Z2(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new U0(null,e)}function a4(e){return Z2(e),e.headers=oh.from(e.headers),e.data=$2.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),vR.getAdapter(e.adapter||wS.adapter)(e).then(function(t){return Z2(e),t.data=$2.call(e,e.transformResponse,t),t.headers=oh.from(t.headers),t},function(t){return yR(t)||(Z2(e),t&&t.response&&(t.response.data=$2.call(e,e.transformResponse,t.response),t.response.headers=oh.from(t.response.headers))),Promise.reject(t)})}const l4=e=>e instanceof oh?e.toJSON():e;function mg(e,t){t=t||{};const r={};function i(m,w,A){return Ae.isPlainObject(m)&&Ae.isPlainObject(w)?Ae.merge.call({caseless:A},m,w):Ae.isPlainObject(w)?Ae.merge({},w):Ae.isArray(w)?w.slice():w}function n(m,w,A){if(Ae.isUndefined(w)){if(!Ae.isUndefined(m))return i(void 0,m,A)}else return i(m,w,A)}function s(m,w){if(!Ae.isUndefined(w))return i(void 0,w)}function a(m,w){if(Ae.isUndefined(w)){if(!Ae.isUndefined(m))return i(void 0,m)}else return i(void 0,w)}function o(m,w,A){if(A in t)return i(m,w);if(A in e)return i(void 0,m)}const f={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(m,w)=>n(l4(m),l4(w),!0)};return Ae.forEach(Object.keys(Object.assign({},e,t)),function(m){const w=f[m]||n,A=w(e[m],t[m],m);Ae.isUndefined(A)&&w!==o||(r[m]=A)}),r}const bR="1.6.7",xS={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{xS[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const c4={};xS.transitional=function(e,t,r){function i(n,s){return"[Axios v"+bR+"] Transitional option '"+n+"'"+s+(r?". "+r:"")}return(n,s,a)=>{if(e===!1)throw new wi(i(s," has been removed"+(t?" in "+t:"")),wi.ERR_DEPRECATED);return t&&!c4[s]&&(c4[s]=!0,console.warn(i(s," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(n,s,a):!0}};function Bnt(e,t,r){if(typeof e!="object")throw new wi("options must be an object",wi.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let n=i.length;for(;n-- >0;){const s=i[n],a=t[s];if(a){const o=e[s],f=o===void 0||a(o,s,e);if(f!==!0)throw new wi("option "+s+" must be "+f,wi.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new wi("Unknown option "+s,wi.ERR_BAD_OPTION)}}const Yx={assertOptions:Bnt,validators:xS},Kh=Yx.validators;class R_{constructor(t){this.defaults=t,this.interceptors={request:new i4,response:new i4}}async request(t,r){try{return await this._request(t,r)}catch(i){if(i instanceof Error){let n;Error.captureStackTrace?Error.captureStackTrace(n={}):n=new Error;const s=n.stack?n.stack.replace(/^.+\n/,""):"";i.stack?s&&!String(i.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+s):i.stack=s}throw i}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=mg(this.defaults,r);const{transitional:i,paramsSerializer:n,headers:s}=r;i!==void 0&&Yx.assertOptions(i,{silentJSONParsing:Kh.transitional(Kh.boolean),forcedJSONParsing:Kh.transitional(Kh.boolean),clarifyTimeoutError:Kh.transitional(Kh.boolean)},!1),n!=null&&(Ae.isFunction(n)?r.paramsSerializer={serialize:n}:Yx.assertOptions(n,{encode:Kh.function,serialize:Kh.function},!0)),r.method=(r.method||this.defaults.method||"get").toLowerCase();let a=s&&Ae.merge(s.common,s[r.method]);s&&Ae.forEach(["delete","get","head","post","put","patch","common"],N=>{delete s[N]}),r.headers=oh.concat(a,s);const o=[];let f=!0;this.interceptors.request.forEach(function(N){typeof N.runWhen=="function"&&N.runWhen(r)===!1||(f=f&&N.synchronous,o.unshift(N.fulfilled,N.rejected))});const m=[];this.interceptors.response.forEach(function(N){m.push(N.fulfilled,N.rejected)});let w,A=0,P;if(!f){const N=[a4.bind(this),void 0];for(N.unshift.apply(N,o),N.push.apply(N,m),P=N.length,w=Promise.resolve(r);A<P;)w=w.then(N[A++],N[A++]);return w}P=o.length;let I=r;for(A=0;A<P;){const N=o[A++],F=o[A++];try{I=N(I)}catch(Z){F.call(this,Z);break}}try{w=a4.call(this,I)}catch(N){return Promise.reject(N)}for(A=0,P=m.length;A<P;)w=w.then(m[A++],m[A++]);return w}getUri(t){t=mg(this.defaults,t);const r=_R(t.baseURL,t.url);return fR(r,t.params,t.paramsSerializer)}}Ae.forEach(["delete","get","head","options"],function(e){R_.prototype[e]=function(t,r){return this.request(mg(r||{},{method:e,url:t,data:(r||{}).data}))}});Ae.forEach(["post","put","patch"],function(e){function t(r){return function(i,n,s){return this.request(mg(s||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:n}))}}R_.prototype[e]=t(),R_.prototype[e+"Form"]=t(!0)});const Fy=R_;class AS{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(n){r=n});const i=this;this.promise.then(n=>{if(!i._listeners)return;let s=i._listeners.length;for(;s-- >0;)i._listeners[s](n);i._listeners=null}),this.promise.then=n=>{let s;const a=new Promise(o=>{i.subscribe(o),s=o}).then(n);return a.cancel=function(){i.unsubscribe(s)},a},t(function(n,s,a){i.reason||(i.reason=new U0(n,s,a),r(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}static source(){let t;return{token:new AS(function(r){t=r}),cancel:t}}}const knt=AS;function Rnt(e){return function(t){return e.apply(null,t)}}function Ont(e){return Ae.isObject(e)&&e.isAxiosError===!0}const Qx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Qx).forEach(e=>{let[t,r]=e;Qx[r]=t});const Dnt=Qx;function wR(e){const t=new Fy(e),r=eR(Fy.prototype.request,t);return Ae.extend(r,Fy.prototype,t,{allOwnKeys:!0}),Ae.extend(r,t,null,{allOwnKeys:!0}),r.create=function(i){return wR(mg(e,i))},r}const hs=wR(wS);hs.Axios=Fy;hs.CanceledError=U0;hs.CancelToken=knt;hs.isCancel=yR;hs.VERSION=bR;hs.toFormData=_v;hs.AxiosError=wi;hs.Cancel=hs.CanceledError;hs.all=function(e){return Promise.all(e)};hs.spread=Rnt;hs.isAxiosError=Ont;hs.mergeConfig=mg;hs.AxiosHeaders=oh;hs.formToJSON=e=>mR(Ae.isHTMLForm(e)?new FormData(e):e);hs.getAdapter=vR.getAdapter;hs.HttpStatusCode=Dnt;hs.default=hs;const Nnt="https://tilemaps.icgc.cat/cdn/configs/mapicgc-config.json",Fnt=5e3;class xR{static async getConfigICGC(){try{const t=await hs.get(Nnt,{timeout:Fnt});return t.data?t.data:(console.log("Resposta sense dades:",t),pf)}catch(t){return t.response?(console.error("Error de resposta:",t.response.data),console.error("Codi d'estat:",t.response.status)):t.request?console.error("No s'ha rebut resposta del servidor:",t.request):console.error("Error:",t.message),pf}}}const znt={"fill-opacity":["interpolate",["exponential",.5],["zoom"],13.5,1,18,.4],"fill-outline-color":"rgba(0,0, 0, 0)","fill-color":["interpolate",["cubic-bezier",.5,1,1,1],["get","nivell_2"],0,"#ffffff",111,"#ffff00",112,"#ccff33",113,"#af5b15",114,"#808000",115,"#cdcd00",116,"#ffffcc",221,"#33cc33",222,"#66ff33",223,"#689018",224,"#967d5f",225,"#19e61e",226,"#b4ff9b",227,"#aaa500",228,"#c3c3a0",229,"#00ff9b",230,"#ff9632",231,"#282828",232,"#79797a",233,"#f5df78",234,"#3296ff",341,"#ff007d",342,"#ff53cd",343,"#ffa4e2",344,"#ffc8e2",345,"#ffb4b4",346,"#0f3700",347,"#730055",348,"#6200c4",349,"#4a9595",350,"#ff00f0",351,"#adaaca",352,"#ffe6e6",353,"#67629a",354,"#4a466e",355,"#2f2d46",461,"#6f6fff",462,"#0000dc",463,"#000064",464,"#185f94",465,"#12466d",466,"#000080"]},jnt={cobertesSol:znt},Unt="lines",oy="labels";let Yd,mm,Vn,Si,Gnt=class{constructor(e){xR.getConfigICGC().then(t=>{Yd={...t.Styles},Vn={...t.Layers},mm={...t.Terrains},Si={...t.defaultOptions},this.initTheMap(e)}).catch(t=>{console.info("Configuracio per defecte",t),Yd={...pf.Styles},Vn={...pf.Layers},mm={...pf.Terrains},Si={...pf.defaultOptions},this.initTheMap(e)})}initTheMap(e){if(!e)e=Si.mapOptions;else for(const t in Si.mapOptions){let r=[Si.mapOptions.center[0],Si.mapOptions.center[1]];Si.mapOptions.center=r,e.hasOwnProperty(t)||(e[t]=Si.mapOptions[t])}e.maxPitch=85,e.maplibreLogo=!1,e.attributionControl=!1,this.map=new Bs.Map(e),this.map.options=e,this.map.addControl(new Bs.AttributionControl({compact:!0})),this.map.on("load",async()=>{const t=this.map.getStyle().name,r=this.map.options.style;if(window.document.querySelector(".maplibregl-compact-show")){var i=window.document.querySelector(".maplibregl-compact-show");i.classList.remove("maplibregl-compact-show")}this.map.addControl(new mit({color:r.indexOf("orto")===-1,defaultOptions:Si}),"bottom-left"),this._dealOrto3dStyle(t)})}addGeocoderICGC(e){try{e===void 0&&(e="top-right");let t={collapsed:!0,marker:!0,popup:!0,showResultMarkers:!0,maplibregl:Bs,showResultsWhileTyping:!0,minLength:2};const r={forwardGeocode:async n=>{const s=[];try{const a=Si.geocoder.peliasUrl1+encodeURIComponent(n.query)+Si.geocoder.peliasUrl2,o=await(await fetch(a)).json();for(const f of o.features){const m=f.geometry.coordinates,w={type:"Feature",geometry:{type:"Point",coordinates:m},place_name:f.properties.label,properties:f.properties,text:f.properties.label,place_type:["place"],center:m};s.push(w)}}catch(a){console.error(`Failed to forwardGeocode with error: ${a}`)}return{features:s}}};this.map.addControl(new hit(r,t),e);let i=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");i[0].attributes[2].nodeValue="Cerca...",i[0].addEventListener("input",function(n){n.target.value.length>3})}catch(t){console.error(`Error adding ICGC geocoder: ${t.message}`)}}getStyle(){try{return this.map.getStyle()}catch(e){console.error(`Error getting style: ${e.message}`)}}async loadImage(e){try{return this.map.loadImage(e)}catch(t){console.error(`Error getting loadImage: ${t.message}`)}}addImage(e,t){try{return this.map.addImage(e,t)}catch(r){console.error(`Error getting addImage: ${r.message}`)}}getConfigStyles(){try{let e=[];for(const t of Yd)e.push(t.name);return e}catch(e){console.error(`Error retrieving base styles: ${e.message}`)}}getConfigWMSLayers(){try{let e=[];for(const t in Vn.WMS)Vn.WMS.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving WMS layers: ${e.message}`)}}getConfigOrtoLayers(){try{let e=[];for(const t in Vn.Orto)Vn.Orto.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving orto image layers: ${e.message}`)}}getConfigVectorLayers(){try{let e=[];for(const t in Vn.Vector)Vn.Vector.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vector layers: ${e.message}`)}}getConfigVectorAdminLayers(){try{let e=[];for(const t in Vn.VectorAdmin)Vn.VectorAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vectorAdmin layers: ${e.message}`)}}getConfigFGBAdminLayers(){try{let e=[];for(const t in Vn.FGBAdmin)Vn.FGBAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving FGBAdmin layers: ${e.message}`)}}async fetchData(e,t,r){try{(!r||r===void 0)&&(r={type:"line",layout:{visibility:"visible"},paint:{"line-color":"grey","line-width":2},layerPosition:"top"});let i=r.layerPosition;if(e.includes(".fgb"))this.addFGBLayerICGC(e,t,r);else{const n=await(await fetch(e)).json();let s=t,a=this._dealOrderLayer(i),o=n.features[0].geometry.type;o.includes("ine")&&(r!==void 0?this.map.addLayer({id:s,type:"line",source:{type:"geojson",data:n},layout:r.layout||{},paint:r.paint||{}},a):this.map.addLayer({id:s,type:"line",source:{type:"geojson",data:n},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},a)),o.includes("olygon")&&(r!==void 0?this.map.addLayer({id:s,type:"fill",source:{type:"geojson",data:n},layout:r.layout,paint:r.paint},a):this.map.addLayer({id:s,type:"fill",source:{type:"geojson",data:n},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},a)),o.includes("oint")&&(r!==void 0?this.map.addLayer({id:s,type:"circle",source:{type:"geojson",data:n},layout:r.layout,paint:r.paint},a):this.map.addLayer({id:s,type:"circle",source:{type:"geojson",data:n},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},a))}}catch(i){console.error(`Error fetching data: ${i.message}`)}}async fetchDataAndMenu(e,t,r,i){try{let n;i!==null?n=i.layerPosition:n=oy;let s,a=document.getElementById("map");if(document.getElementById("menu-group")?s=document.getElementById("menu-group"):(s=document.createElement("nav"),s.id="menu-group",s.classList.add="filter-group",a.appendChild(s)),s!==null){let o="visible",f=this._dealOrderLayer(n),m;if(e.includes(".fgb")){let A=this._getKeyByUrlFGB(e);A===null&&(A="userFGB");const P=await fetch(e),I={type:"FeatureCollection",features:[]};for await(const F of sC(P.body))I.features.push(F);m=I;let N=t;if(this.map.addSource(N,{type:"geojson",data:I}),e.includes("text"))i!==void 0?this.map.addLayer({id:t,type:"symbol",source:N,layout:i.layout,paint:i.paint},f):this.map.addLayer({id:t,type:"symbol",source:N,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:o,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f);else{let F=t+"Text";this.map.addLayer({id:F,type:"symbol",source:N,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:o,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f)}}else m=await(await fetch(e)).json();if(r!=="all"){const A=document.createElement("div");A.id="titleDivMenu",A.textContent=t,s.appendChild(A);const P=document.createElement("div");P.id="titleDivMenuSub",P.textContent=`📂 ${r}`,s.appendChild(P)}let w;if(i.type?w=i.type:w=m.features[0].geometry.type,r==="all")w.includes("ine")&&(i!==void 0?this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},f)),w.includes("olygon")&&(i!==void 0?this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"fill-color":"#0000FF","fill-opacity":0}},f)),w.includes("oint")&&(i!==void 0?this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},f)),w.includes("ymbol")&&(i!==void 0?this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint},f):this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:m},layout:{visibility:"visible"},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f)),this.addMenuItem(t);else{let A=r;const P={};m.features.forEach(I=>{const N=I.properties[A],F=N+"-userFieldFilter-"+t;N!==null&&(P[F]||(w.includes("ine")&&(i!==void 0?this.map.addLayer({id:F,type:"line",source:{type:"geojson",data:m},layout:i.layout,paint:i.paint,filter:["==",`${A}`,N]},f):this.map.addLayer({id:F,type:"line",source:{type:"geojson",data:m},layout:{visibility:"visible"},filter:["==",`${A}`,N],paint:{"line-color":"black","line-width":2,"line-opacity":1}},f)),w.includes("olygon")&&(i!==void 0?this.map.addLayer({id:F,type:"fill",source:{type:"geojson",data:m},filter:["==",`${A}`,N],layout:i.layout,paint:i.paint},f):this.map.addLayer({id:F,type:"fill",source:{type:"geojson",data:m},layout:{visibility:"visible"},filter:["==",`${A}`,N],paint:{"fill-color":"blue","fill-opacity":.6}},f)),w.includes("oint")&&(i!==void 0?this.map.addLayer({id:F,type:"circle",source:{type:"geojson",data:m},filter:["==",`${A}`,N],layout:i.layout,paint:i.paint},f):this.map.addLayer({id:F,type:"circle",source:{type:"geojson",data:m},layout:{visibility:"visible"},filter:["==",`${A}`,N],paint:{"circle-color":"red","circle-opacity":.85}},f)),P[F]=!0,this.addMenuItem(F)))})}}}catch(n){console.error(`Error fetching data: ${n.message}`)}}on(e,t){setTimeout(()=>{try{this.map.on(e,t)}catch(r){console.error(`Error adding event ON listener: ${r.message}`)}},500)}getSource(e){try{return this.map.getSource(e)}catch(t){console.error(`Error getting source: ${t.message}`)}}addSource(e,t){try{this.map.addSource(e,t)}catch(r){console.error(`Error adding source: ${r.message}`)}}setStyle(e,t){try{t!==void 0?this.map.setStyle(e,t):this.map.setStyle(e),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var r=window.document.querySelector(".maplibregl-compact-show");r.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(r){console.error(`Error setting style: ${r.message}`)}}getLayer(e){try{return this.map.getLayer(e)}catch(t){console.error(`Error getting layer: ${t.message}`)}}setFilter(e,t,r){try{return this.map.setFilter(e,t,r)}catch(i){console.error(`Error setting filter: ${i.message}`)}}jumpTo(e){try{this.map.jumpTo(e)}catch(t){console.error(`Error jumping to ${e}: ${t.message}`)}}setLayoutProperty(e,t,r){try{this.map.setLayoutProperty(e,t,r)}catch(i){console.error(`Error setting layout property: ${i.message}`)}}setPaintProperty(e,t,r){try{this.map.setPaintProperty(e,t,r)}catch(i){console.error(`Error setting paint property: ${i.message}`)}}addControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(e,t)}catch(r){console.error(`Error adding control: ${r.message}`)}}getZoom(){try{return this.map.getZoom()}catch(e){console.error(`Error getting zoom level: ${e.message}`)}}addMouseCoordControl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"bottom-left";try{this.map.addControl(new bit(e),t)}catch(r){console.error(`Error adding mouse coordinate control: ${r.message}`)}}addGeolocateControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new Bs.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),t):this.map.addControl(new Bs.GeolocateControl(e),t)}catch(r){console.error(`Error adding geolocate control: ${r.message}`)}}addFullscreenControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new Bs.FullscreenControl({container:HTMLElement}),t):this.map.addControl(new Bs.FullscreenControl(e),t)}catch(r){console.error(`Error adding fullscreen control: ${r.message}`)}}getBounds(){try{return this.map.getBounds()}catch(e){console.error(`Error getting bounds: ${e.message}`)}}getCenter(){try{return this.map.getCenter()}catch(e){console.error(`Error getting center: ${e.message}`)}}setTerrain(e){try{return this.map.setTerrain(e)}catch(t){console.error(`Error setting terrain: ${t.message}`)}}setLayerZoomRange(e,t,r){try{return this.map.setLayerZoomRange(e,t,r)}catch(i){console.error(`Error setting terrain: ${i.message}`)}}getCanvas(){try{return this.map.getCanvas()}catch(e){console.error(`Error getting canvas: ${e.message}`)}}setCenter(e){try{return this.map.setCenter(e)}catch(t){console.error(`Error setting center: ${t.message}`)}}addLayer(e,t){try{this.map.addLayer(e,t)}catch(r){console.error(`Error adding layer: ${r.message}`)}}addLayerGeoJSON(e,t){try{let r=this._dealOrderLayer(t);this.map.addSource(`${e.id}`,{type:"geojson",data:e.data}),this.map.addLayer({id:`${e.id}-layerIcgcMap`,type:e.layerType,source:`${e.id}`,layout:e.layout,paint:e.paint},r)}catch(r){console.error(`Error adding GeoJSON layer: ${r.message}`)}}addLayerWMS(e,t,r){try{let i=this._dealOrderLayer(r.layerPosition);r?(this.map.addSource(`${t}`,{type:"raster",tiles:[e],tileSize:256},i),this.map.addLayer({id:t,type:"raster",source:t,layout:r.layout,paint:r.paint},i)):(this.map.addSource(`${t}`,{type:"raster",tiles:[e],tileSize:256},i),this.map.addLayer({id:t,type:"raster",source:t,paint:{}},i))}catch(i){console.error(`Error adding WMS layer: ${i.message}`)}}removeControl(e){try{this.map.removeControl(e)}catch(t){console.error(`Error removing control: ${t.message}`)}}removeLayer(e){try{this.map.removeLayer(e)}catch(t){console.error(`Error removing layer: ${t.message}`)}}removeSource(e){try{this.map.removeSource(e)}catch(t){console.error(`Error removing source: ${t.message}`)}}addLogo(e){try{const t=document.createElement("img");t.src=e.url,t.style.height=e.height;const r=document.getElementById("logos"),i=document.createElement("a");i.id=e.id,i.href=e.href,i.target="_blank",i.style.position="relative",i.style.bottom="1px",i.appendChild(t),r.appendChild(i)}catch(t){console.error(`Error adding logo: ${t.message}`)}}addBasemapsICGC(e){try{const t=s=>{this.map.setStyle(s)};let r=document.getElementById("map"),i;i=document.createElement("div"),i.id="basemap-group",i.classList.add="filter-group",r.appendChild(i);const n=document.getElementById("basemap-group");for(const s of e)for(const a of Object.keys(Si.baseStyles)){const o=Si.baseStyles[a];if(s===o.url){const f=document.createElement("div");f.className="basemap-item",f.title=o.key,f.style.backgroundImage=`url('${o.image}')`,n.appendChild(f),f.addEventListener("click",()=>t(o.url))}}}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addBasemaps(e){try{const t=i=>{map.setStyle(i.url)},r=document.getElementById("basemap-group");e.forEach(i=>{const n=document.createElement("div");n.className="basemap-item",n.title=i.label,n.style.backgroundImage=`url('${i.image}')`,r.appendChild(n),n.addEventListener("click",()=>t(i))})}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addFeatureQuery(e,t,r){try{let i;this.map.on("mouseenter",e,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",e,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",n=>{let s=this.map.queryRenderedFeatures(n.point);if(s&&s[0].source.includes(e)){let a=[n.lngLat.lng,n.lngLat.lat];if(t!==void 0&&t.length>0&&t!=="all"){if(t!==null){let o="";t.forEach(f=>{let m=s[0].properties[f];o=o+`<h4>${m}</h4>`}),i=o,map.addPopup(a,i,r)}}else{let o="";for(const f in s[0].properties)o+="<b>"+f+"</b>:"+s[0].properties[f]+"<br>";i=o,map.addPopup(a,i,r)}}})}catch(i){console.error(`Error adding feature query: ${i.message}`)}}addScaleControl(e,t){try{var r=new Bs.ScaleControl(e);this.map.addControl(r,t)}catch(i){console.error(`Error adding scale: ${i.message}`)}}addExportControl(e,t){try{typeof e=="string"&&(t=e,e=void 0),e===void 0&&(e={PageSize:ff.A4,PageOrientation:Sm.Landscape,Format:Xu.PNG,DPI:Ox[300],Crosshair:!0,PrintableArea:!0},t="top-right"),this.map.addControl(new wrt(e),t)}catch(r){console.error(`Error adding export control: ${r.message}`)}}addPopup(e,t){try{new Bs.Popup().setLngLat(e).setHTML(t).addTo(this.map)}catch{}}addMarker(e){try{let t,r;return e.text===void 0?t=new Bs.Marker(e.options).setLngLat(e.coord).addTo(this.map):(r=new Bs.Popup({offset:e.textOffset}).setHTML(e.text),t=new Bs.Marker().setLngLat(e.coord).setPopup(r).addTo(this.map)),t}catch(t){return console.error(`Error adding marker: ${t.message}`),null}}addPopup(e,t,r){try{return r.image===void 0?new Bs.Popup().setLngLat(e).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${r.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
 ${t}
          </div>
          <div class="popupBottomDown">
          </div>
          </div>
        </div>
      `).addTo(this.map):new Bs.Popup().setLngLat(e).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${r.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
          ${t}
          </div>
          <div class="popupBottomDown">
             <img style="  padding: 8px;  width: 50%;" src=${r.image} />
          </div>
          </div>
        </div>
      `).addTo(this.map)}catch(i){return console.error(`Error adding popup: ${i.message}`),null}}addFullScreen(e){try{e===void 0&&(e="top-right"),this.map.addControl(new Bs.FullscreenControl,e)}catch(t){console.error(`Error adding fullscreen control: ${t.message}`)}}addMenuItem(e){try{let t;if(e.includes("-userFieldFilter-")?t=e.split("-userFieldFilter-")[0]:t=e,e.length>0){const r=document.getElementById("menu-group"),i=document.createElement("input");i.type="checkbox",i.id=e,i.checked=!0,r.appendChild(i);const n=document.createElement("label");n.setAttribute("for",e),n.textContent=t,r.appendChild(n),i.addEventListener("change",s=>{this.map.setLayoutProperty(e,"visibility",s.target.checked?"visible":"none")})}}catch(t){console.error(`Error adding menu item: ${t.message}`)}}addLayerTree(e){try{let t=e.features;const r=document.getElementById("filter-group");this.map.addSource(`${e.id}`,{type:e.type,data:t}),t.features.forEach(i=>{const n=i.properties.icon,s=`poi-${n}`;if(!this.map.getLayer(s)){this.map.addLayer({id:s,type:"circle",source:`${e.id}`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",n]},this._firstSymbolLayer());const a=document.createElement("input");a.type="checkbox",a.id=s,a.checked=!0,r.appendChild(a);const o=document.createElement("label");o.setAttribute("for",s),o.textContent=n,r.appendChild(o),a.addEventListener("change",f=>{this.map.setLayoutProperty(s,"visibility",f.target.checked?"visible":"none")})}})}catch(t){console.error(`Error adding layer tree: ${t.message}`)}}createNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new Bs.NavigationControl(e),t)}catch(r){return console.error(`Error creating navigation control: ${r.message}`),null}}addNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new Bs.NavigationControl(e),t)}catch(r){console.error(`Error adding navigation control: ${r.message}`)}}addAttributionControl(e,t){try{this.map.addControl(new Bs.AttributionControl(e),t)}catch(r){console.error(`Error adding attribution control: ${r.message}`)}}addImageLayerICGC(e,t,r){try{let i=null,n,s;r?(s=r,n=r.layerPosition):s={type:"raster",layout:{visibility:"visible"},paint:{"raster-opacity":1},layerPosition:oy},i=this._findImageType(e,Vn.Orto,Vn.VectorAdmin,Vn.WMS,Vn.Vector),i||console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",e,"font-weight: bold; font-style: italic;");let a={id:t,tiles:e};this.addLayerWMS(e,t,s)}catch(i){console.error(`Error adding ICGC image layer: ${i.message}`)}}async addVectorLayerICGC(e,t,r){try{let{type:i="line",layerPosition:n=oy,layoutOptions:s={visibility:"visible"},paintOption:a}=r||{},o=this._dealOrderLayer(n);if(!e){console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",e,"font-weight: bold; font-style: italic;");return}if(e.includes("https")){let f=this._getKeyByUrlVector(e);this.map.addSource(f,{type:"vector",url:e});let m={id:f,type:"fill",source:f,"source-layer":"cobertes",maxzoom:18,layout:r.layout,paint:jnt.cobertesSol};if(f==="cobertes2018"&&this.map.addLayer(m,o),s.visibility==="visible"){let w=this._getLegendByName(f);console.info("legendUrl",w),console.info("sourceName",f),this.addLegend(w,f)}}else{let f=t;this.map.addSource(f,{type:"vector",url:Si.limitsUrl});let m={id:t,type:i,source:f,"source-layer":e,layout:r.layout,paint:r.paint||{}};i==="fill"||i==="polygon"?m.paint=a||{"fill-color":"#0000FF","fill-opacity":0}:i==="line"&&(m.paint=a||{"line-color":"#4832a8","line-opacity":1,"line-width":1}),this.map.addLayer(m,o)}}catch(i){console.error(`Error adding ICGC vector layer: ${i.message}`)}}async addFGBLayerICGC(e,t,r){try{r||(r.layout={visibility:!0},r.paint={"line-color":"#4832a8","line-opacity":1,"line-width":1},r.type="lines",r.layerPosition="labels");let i=this._dealOrderLayer(r.layerPosition);const n=await fetch(e),s={type:"FeatureCollection",features:[]};for await(const o of sC(n.body))s.features.push(o);let a=t;this.map.addSource(a,{type:"geojson",data:s}),e.includes("text")?this.map.addLayer({id:t,type:"symbol",source:a,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:r.layout.visibility,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},i):this.map.addLayer({id:t,type:r.type,source:a,layout:r.layout,paint:r.paint},i)}catch(i){console.error(`Error adding ICGC FGB layer: ${i.message}`)}}addTerrainICGC(e,t){try{let r;for(const n in mm)if(mm.hasOwnProperty(n)){const s=mm[n];s===e&&(r=s)}let i=r;this.getSource("terrainICGC")!==void 0&&(this.getStyle().layers.forEach(n=>{n.source==="terrainICGC"&&this.removeLayer(n.id)}),this.removeSource("terrainICGC")),this.getSource("terrainICGC")===void 0&&(e.includes("terrarium")?this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:512,maxzoom:16})),this.map.setTerrain({source:"terrainICGC",exaggeration:1.5}),t==null||this.map.addControl(new eF({pitch:90,bearing:null,minpitchzoom:null}),t)}catch(r){console.error(`Error adding 3D terrain: ${r.message}`)}}addLegend(e,t){try{this.map.addControl(new yit({url:e,idLayer:t}))}catch(r){console.error(`Error adding legend: ${r.message}`)}}_findImageType(e,t,r,i,n){const s=[t,r,i,n];for(const a of s)for(const[o,f]of Object.entries(a))if(f===e)return o;return null}_getKeyByUrlFGB(e){for(const t in Vn.FGBAdmin)if(Vn.FGBAdmin.hasOwnProperty(t)&&Vn.FGBAdmin[t]===e)return t;return null}_getLegendByName(e){for(const t in Si.vectorLayers){const r=Si.vectorLayers[t];if(r.key===e)return r.legend}return null}_getKeyByUrlVector(e){for(const t in Vn.Vector)if(Vn.Vector.hasOwnProperty(t)&&Vn.Vector[t]===e)return t;return null}async _raiseText3DStyle(){try{const e=await this.map.loadImage(Si.map3dOptions.imageIcon);this.map.addImage("stick",e.data),this.map.getStyle().layers.forEach(t=>{if(t["source-layer"]===Si.map3dOptions.sourceLayerFilterId&&t.minzoom>=Si.map3dOptions.minZoomFilter&&e){const r=t.id;this.map.setLayoutProperty(r,"icon-image","stick"),this.map.setLayoutProperty(r,"text-offset",[0,-9]),this.map.setLayoutProperty(r,"symbol-placement","point"),this.map.setLayoutProperty(r,"symbol-avoid-edges",!1),this.map.setLayoutProperty(r,"text-allow-overlap",!0),this.map.setLayoutProperty(r,"text-ignore-placement",!1),this.map.setLayoutProperty(r,"text-pitch-alignment","auto"),this.map.setLayoutProperty(r,"text-rotation-alignment","auto"),this.map.setLayoutProperty(r,"text-justify","center"),this.map.setLayoutProperty(r,"text-anchor","bottom"),this.map.setLayoutProperty(r,"icon-anchor","bottom"),this.map.setPaintProperty(r,"text-color","#ffffff"),this.map.setPaintProperty(r,"text-halo-color","#000000"),this.map.setPaintProperty(r,"text-halo-width",2)}})}catch(e){return console.error(`Error dealing orto 3D: ${e.message}`),null}}_dealStyleMaps(e){try{if(e&&e.indexOf("icgc.cat")!=-1){for(const t in Yd)if(Yd.hasOwnProperty(t)){const r=Yd[t];if(t===e)return r}return Yd[0]}else return e}catch(t){return console.error(`Error dealing with map styles: ${t.message}`),null}}_dealOrto3dStyle(e){try{if(e=="orto3d"){this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const t=new ZB({intensity:4}),r=new NA({ambientLight:t});this.map.setTerrain({source:Si.map3dOptions.terrainSource,exaggeration:Si.map3dOptions.exaggeration});const i=this._createCitiesMapboxLayer();this.map.getLayer(Si.map3dOptions.layerId3d)||(this.map.addLayer(i,Si.map3dOptions.layerIdOrder),this.map.setLayerZoomRange(Si.map3dOptions.layerId3d,Si.map3dOptions.minZoomRange,Si.map3dOptions.maxZoomRange),i.deck.setProps({effects:[r]}),this._raiseText3DStyle())}else this.map.getLayer(Si.map3dOptions.layerId3d)&&(this.map.removeLayer(Si.map3dOptions.layerId3d),this.map.setTerrain(null))}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_dealOrderLayer(e){return e===oy?this._firstSymbolLayer():e===Unt?this._firstLineLayer():""}_firstSymbolLayer(){try{const e=this.map.getStyle().layers;let t;for(let r=0;r<e.length;r++)if(e[r].type==="symbol"&&e[r].id.indexOf("contour")===-1&&e[r].id.indexOf("water")===-1){console.info(e[r].id),t=e[r].id;break}return t}catch(e){console.error(`Error getting first symbol layer: ${e.message}`)}}_firstLineLayer(){try{const e=this.map.getStyle().layers;let t;for(let r=0;r<e.length;r++)if(e[r].type==="line"){t=e[r].id;break}return t}catch(e){console.error(`Error getting first symbol layer: ${e.message}`)}}_createCitiesMapboxLayer(){try{return new WZ({id:Si.map3dOptions.layerId3d,type:fS,data:Si.map3dOptions.urlTilesetCities,loader:dS,loadOptions:{tileset:{viewDistanceScale:1,updateTransforms:!0,maximumScreenSpaceError:Si.map3dOptions.spaceErrorFactor}},onTilesetLoad:e=>{e.options.maximumScreenSpaceError=Si.map3dOptions.spaceErrorFactor},onTileLoad:e=>{e.content.cartographicOrigin.z-=Si.map3dOptions.zfactor},operation:"terrain+draw"})}catch(e){return console.error(`Error adding MapboxLayer: ${e.message}`),null}}};var Vnt={exports:{}};function qnt(e,t){var r=e.getCenter(),i=e.getZoom(),n=e.getBearing(),s=e.getPitch();t.forEach(function(a){a.jumpTo({center:r,zoom:i,bearing:n,pitch:s})})}function Hnt(){var e,t=arguments.length;if(t===1)e=arguments[0];else{e=[];for(var r=0;r<t;r++)e.push(arguments[r])}var i=[];e.forEach(function(o,f){i[f]=a.bind(null,o,e.filter(function(m,w){return w!==f}))});function n(){e.forEach(function(o,f){o.on("move",i[f])})}function s(){e.forEach(function(o,f){o.off("move",i[f])})}function a(o,f){s(),qnt(o,f),n()}return n(),function(){s(),i=[],e=[]}}var Wnt=Hnt;(function(e){var t=Wnt,r=Kk.EventEmitter;function i(n,s,a,o){if(this.options=o||{},this._mapA=n,this._mapB=s,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new r,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof a=="string"&&document.body.querySelectorAll){var f=document.body.querySelectorAll(a)[0];if(!f)throw new Error("Cannot find element with specified container selector.");f.appendChild(this._controlContainer)}else if(a instanceof Element&&a.appendChild)a.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=s.getContainer().getBoundingClientRect();var m=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(m),this._clearSync=t(n,s),this._onResize=(function(){this._bounds=s.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),s.on("resize",this._onResize),this.options&&this.options.mousemove&&(n.getContainer().addEventListener("mousemove",this._onMove),s.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}i.prototype={_setPointerEvents:function(n){this._controlContainer.style.pointerEvents=n,this._swiper.style.pointerEvents=n},_onDown:function(n){n.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(n){n=Math.min(n,this._horizontal?this._bounds.height:this._bounds.width);var s=this._horizontal?"translate(0, "+n+"px)":"translate("+n+"px, 0)";this._controlContainer.style.transform=s,this._controlContainer.style.WebkitTransform=s;var a=this._horizontal?"rect(0, 999em, "+n+"px, 0)":"rect(0, "+n+"px, "+this._bounds.height+"px, 0)",o=this._horizontal?"rect("+n+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+n+"px)";this._mapA.getContainer().style.clip=a,this._mapB.getContainer().style.clip=o,this.currentPosition=n},_onMove:function(n){this.options&&this.options.mousemove&&this._setPointerEvents(n.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(n)):this._setPosition(this._getX(n))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(n){n=n.touches?n.touches[0]:n;var s=n.clientX-this._bounds.left;return s<0&&(s=0),s>this._bounds.width&&(s=this._bounds.width),s},_getY:function(n){n=n.touches?n.touches[0]:n;var s=n.clientY-this._bounds.top;return s<0&&(s=0),s>this._bounds.height&&(s=this._bounds.height),s},setSlider:function(n){this._setPosition(n)},on:function(n,s){return this._ev.on(n,s),this},fire:function(n,s){return this._ev.emit(n,s),this},off:function(n,s){return this._ev.removeListener(n,s),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var n=this._mapA.getContainer();n&&(n.style.clip=null,n.removeEventListener("mousemove",this._onMove));var s=this._mapB.getContainer();s&&(s.style.clip=null,s.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=i:e.exports=i})(Vnt);function $nt(){const e=af.useRef(null),t=af.useRef(null),[r]=af.useState(10);return af.useEffect(()=>{if(t.current)return;async function i(){const n=await xR.getConfigICGC();t.current=new Gnt({container:e.current,hash:!0,pitch:0,style:n.Styles.TOPO,center:[1.808,41.618],zoom:r})}i()},[1.808,41.618,r]),Kp.jsx("div",{className:"map-container",children:Kp.jsx("div",{ref:e,className:"map"})})}function Znt(){return Kp.jsx("div",{className:"App",children:Kp.jsx($nt,{})})}J2.createRoot(document.getElementById("root")).render(Kp.jsx(f8.StrictMode,{children:Kp.jsx(Znt,{})}));export{Gi as U};
