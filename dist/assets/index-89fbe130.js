(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();function SD(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var wL={exports:{}},H_={},xL={exports:{}},ni={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D0=Symbol.for("react.element"),AD=Symbol.for("react.portal"),ED=Symbol.for("react.fragment"),TD=Symbol.for("react.strict_mode"),CD=Symbol.for("react.profiler"),PD=Symbol.for("react.provider"),ID=Symbol.for("react.context"),LD=Symbol.for("react.forward_ref"),MD=Symbol.for("react.suspense"),BD=Symbol.for("react.memo"),kD=Symbol.for("react.lazy"),nE=Symbol.iterator;function RD(e){return e===null||typeof e!="object"?null:(e=nE&&e[nE]||e["@@iterator"],typeof e=="function"?e:null)}var SL={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},AL=Object.assign,EL={};function Em(e,t,r){this.props=e,this.context=t,this.refs=EL,this.updater=r||SL}Em.prototype.isReactComponent={};Em.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Em.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function TL(){}TL.prototype=Em.prototype;function u5(e,t,r){this.props=e,this.context=t,this.refs=EL,this.updater=r||SL}var h5=u5.prototype=new TL;h5.constructor=u5;AL(h5,Em.prototype);h5.isPureReactComponent=!0;var sE=Array.isArray,CL=Object.prototype.hasOwnProperty,d5={current:null},PL={key:!0,ref:!0,__self:!0,__source:!0};function IL(e,t,r){var i,n={},s=null,c=null;if(t!=null)for(i in t.ref!==void 0&&(c=t.ref),t.key!==void 0&&(s=""+t.key),t)CL.call(t,i)&&!PL.hasOwnProperty(i)&&(n[i]=t[i]);var a=arguments.length-2;if(a===1)n.children=r;else if(1<a){for(var p=Array(a),_=0;_<a;_++)p[_]=arguments[_+2];n.children=p}if(e&&e.defaultProps)for(i in a=e.defaultProps,a)n[i]===void 0&&(n[i]=a[i]);return{$$typeof:D0,type:e,key:s,ref:c,props:n,_owner:d5.current}}function FD(e,t){return{$$typeof:D0,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function p5(e){return typeof e=="object"&&e!==null&&e.$$typeof===D0}function DD(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var oE=/\/+/g;function mb(e,t){return typeof e=="object"&&e!==null&&e.key!=null?DD(""+e.key):t.toString(36)}function vy(e,t,r,i,n){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var c=!1;if(e===null)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case D0:case AD:c=!0}}if(c)return c=e,n=n(c),e=i===""?"."+mb(c,0):i,sE(n)?(r="",e!=null&&(r=e.replace(oE,"$&/")+"/"),vy(n,t,r,"",function(_){return _})):n!=null&&(p5(n)&&(n=FD(n,r+(!n.key||c&&c.key===n.key?"":(""+n.key).replace(oE,"$&/")+"/")+e)),t.push(n)),1;if(c=0,i=i===""?".":i+":",sE(e))for(var a=0;a<e.length;a++){s=e[a];var p=i+mb(s,a);c+=vy(s,t,r,p,n)}else if(p=RD(e),typeof p=="function")for(e=p.call(e),a=0;!(s=e.next()).done;)s=s.value,p=i+mb(s,a++),c+=vy(s,t,r,p,n);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function A1(e,t,r){if(e==null)return e;var i=[],n=0;return vy(e,i,"","",function(s){return t.call(r,s,n++)}),i}function ND(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ta={current:null},by={transition:null},OD={ReactCurrentDispatcher:ta,ReactCurrentBatchConfig:by,ReactCurrentOwner:d5};function LL(){throw Error("act(...) is not supported in production builds of React.")}ni.Children={map:A1,forEach:function(e,t,r){A1(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return A1(e,function(){t++}),t},toArray:function(e){return A1(e,function(t){return t})||[]},only:function(e){if(!p5(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ni.Component=Em;ni.Fragment=ED;ni.Profiler=CD;ni.PureComponent=u5;ni.StrictMode=TD;ni.Suspense=MD;ni.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=OD;ni.act=LL;ni.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=AL({},e.props),n=e.key,s=e.ref,c=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,c=d5.current),t.key!==void 0&&(n=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(p in t)CL.call(t,p)&&!PL.hasOwnProperty(p)&&(i[p]=t[p]===void 0&&a!==void 0?a[p]:t[p])}var p=arguments.length-2;if(p===1)i.children=r;else if(1<p){a=Array(p);for(var _=0;_<p;_++)a[_]=arguments[_+2];i.children=a}return{$$typeof:D0,type:e.type,key:n,ref:s,props:i,_owner:c}};ni.createContext=function(e){return e={$$typeof:ID,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:PD,_context:e},e.Consumer=e};ni.createElement=IL;ni.createFactory=function(e){var t=IL.bind(null,e);return t.type=e,t};ni.createRef=function(){return{current:null}};ni.forwardRef=function(e){return{$$typeof:LD,render:e}};ni.isValidElement=p5;ni.lazy=function(e){return{$$typeof:kD,_payload:{_status:-1,_result:e},_init:ND}};ni.memo=function(e,t){return{$$typeof:BD,type:e,compare:t===void 0?null:t}};ni.startTransition=function(e){var t=by.transition;by.transition={};try{e()}finally{by.transition=t}};ni.unstable_act=LL;ni.useCallback=function(e,t){return ta.current.useCallback(e,t)};ni.useContext=function(e){return ta.current.useContext(e)};ni.useDebugValue=function(){};ni.useDeferredValue=function(e){return ta.current.useDeferredValue(e)};ni.useEffect=function(e,t){return ta.current.useEffect(e,t)};ni.useId=function(){return ta.current.useId()};ni.useImperativeHandle=function(e,t,r){return ta.current.useImperativeHandle(e,t,r)};ni.useInsertionEffect=function(e,t){return ta.current.useInsertionEffect(e,t)};ni.useLayoutEffect=function(e,t){return ta.current.useLayoutEffect(e,t)};ni.useMemo=function(e,t){return ta.current.useMemo(e,t)};ni.useReducer=function(e,t,r){return ta.current.useReducer(e,t,r)};ni.useRef=function(e){return ta.current.useRef(e)};ni.useState=function(e){return ta.current.useState(e)};ni.useSyncExternalStore=function(e,t,r){return ta.current.useSyncExternalStore(e,t,r)};ni.useTransition=function(){return ta.current.useTransition()};ni.version="18.3.1";xL.exports=ni;var up=xL.exports;const zD=SD(up);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jD=up,UD=Symbol.for("react.element"),GD=Symbol.for("react.fragment"),VD=Object.prototype.hasOwnProperty,qD=jD.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,HD={key:!0,ref:!0,__self:!0,__source:!0};function ML(e,t,r){var i,n={},s=null,c=null;r!==void 0&&(s=""+r),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(c=t.ref);for(i in t)VD.call(t,i)&&!HD.hasOwnProperty(i)&&(n[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps,t)n[i]===void 0&&(n[i]=t[i]);return{$$typeof:UD,type:e,key:s,ref:c,props:n,_owner:qD.current}}H_.Fragment=GD;H_.jsx=ML;H_.jsxs=ML;wL.exports=H_;var om=wL.exports,iw={},BL={exports:{}},cl={},kL={exports:{}},RL={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(Ot,Xt){var Wt=Ot.length;Ot.push(Xt);t:for(;0<Wt;){var xe=Wt-1>>>1,it=Ot[xe];if(0<n(it,Xt))Ot[xe]=Xt,Ot[Wt]=it,Wt=xe;else break t}}function r(Ot){return Ot.length===0?null:Ot[0]}function i(Ot){if(Ot.length===0)return null;var Xt=Ot[0],Wt=Ot.pop();if(Wt!==Xt){Ot[0]=Wt;t:for(var xe=0,it=Ot.length,Et=it>>>1;xe<Et;){var Pt=2*(xe+1)-1,jt=Ot[Pt],qt=Pt+1,$t=Ot[qt];if(0>n(jt,Wt))qt<it&&0>n($t,jt)?(Ot[xe]=$t,Ot[qt]=Wt,xe=qt):(Ot[xe]=jt,Ot[Pt]=Wt,xe=Pt);else if(qt<it&&0>n($t,Wt))Ot[xe]=$t,Ot[qt]=Wt,xe=qt;else break t}}return Xt}function n(Ot,Xt){var Wt=Ot.sortIndex-Xt.sortIndex;return Wt!==0?Wt:Ot.id-Xt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var c=Date,a=c.now();e.unstable_now=function(){return c.now()-a}}var p=[],_=[],w=1,S=null,C=3,I=!1,N=!1,F=!1,W=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,z=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function H(Ot){for(var Xt=r(_);Xt!==null;){if(Xt.callback===null)i(_);else if(Xt.startTime<=Ot)i(_),Xt.sortIndex=Xt.expirationTime,t(p,Xt);else break;Xt=r(_)}}function nt(Ot){if(F=!1,H(Ot),!N)if(r(p)!==null)N=!0,ee(yt);else{var Xt=r(_);Xt!==null&&se(nt,Xt.startTime-Ot)}}function yt(Ot,Xt){N=!1,F&&(F=!1,U(mt),mt=-1),I=!0;var Wt=C;try{for(H(Xt),S=r(p);S!==null&&(!(S.expirationTime>Xt)||Ot&&!at());){var xe=S.callback;if(typeof xe=="function"){S.callback=null,C=S.priorityLevel;var it=xe(S.expirationTime<=Xt);Xt=e.unstable_now(),typeof it=="function"?S.callback=it:S===r(p)&&i(p),H(Xt)}else i(p);S=r(p)}if(S!==null)var Et=!0;else{var Pt=r(_);Pt!==null&&se(nt,Pt.startTime-Xt),Et=!1}return Et}finally{S=null,C=Wt,I=!1}}var bt=!1,vt=null,mt=-1,Dt=5,kt=-1;function at(){return!(e.unstable_now()-kt<Dt)}function dt(){if(vt!==null){var Ot=e.unstable_now();kt=Ot;var Xt=!0;try{Xt=vt(!0,Ot)}finally{Xt?It():(bt=!1,vt=null)}}else bt=!1}var It;if(typeof z=="function")It=function(){z(dt)};else if(typeof MessageChannel<"u"){var xt=new MessageChannel,re=xt.port2;xt.port1.onmessage=dt,It=function(){re.postMessage(null)}}else It=function(){W(dt,0)};function ee(Ot){vt=Ot,bt||(bt=!0,It())}function se(Ot,Xt){mt=W(function(){Ot(e.unstable_now())},Xt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Ot){Ot.callback=null},e.unstable_continueExecution=function(){N||I||(N=!0,ee(yt))},e.unstable_forceFrameRate=function(Ot){0>Ot||125<Ot?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Dt=0<Ot?Math.floor(1e3/Ot):5},e.unstable_getCurrentPriorityLevel=function(){return C},e.unstable_getFirstCallbackNode=function(){return r(p)},e.unstable_next=function(Ot){switch(C){case 1:case 2:case 3:var Xt=3;break;default:Xt=C}var Wt=C;C=Xt;try{return Ot()}finally{C=Wt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Ot,Xt){switch(Ot){case 1:case 2:case 3:case 4:case 5:break;default:Ot=3}var Wt=C;C=Ot;try{return Xt()}finally{C=Wt}},e.unstable_scheduleCallback=function(Ot,Xt,Wt){var xe=e.unstable_now();switch(typeof Wt=="object"&&Wt!==null?(Wt=Wt.delay,Wt=typeof Wt=="number"&&0<Wt?xe+Wt:xe):Wt=xe,Ot){case 1:var it=-1;break;case 2:it=250;break;case 5:it=1073741823;break;case 4:it=1e4;break;default:it=5e3}return it=Wt+it,Ot={id:w++,callback:Xt,priorityLevel:Ot,startTime:Wt,expirationTime:it,sortIndex:-1},Wt>xe?(Ot.sortIndex=Wt,t(_,Ot),r(p)===null&&Ot===r(_)&&(F?(U(mt),mt=-1):F=!0,se(nt,Wt-xe))):(Ot.sortIndex=it,t(p,Ot),N||I||(N=!0,ee(yt))),Ot},e.unstable_shouldYield=at,e.unstable_wrapCallback=function(Ot){var Xt=C;return function(){var Wt=C;C=Xt;try{return Ot.apply(this,arguments)}finally{C=Wt}}}})(RL);kL.exports=RL;var $D=kL.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WD=up,al=$D;function ke(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var FL=new Set,s0={};function Fp(e,t){am(e,t),am(e+"Capture",t)}function am(e,t){for(s0[e]=t,e=0;e<t.length;e++)FL.add(t[e])}var fh=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),nw=Object.prototype.hasOwnProperty,XD=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,aE={},lE={};function ZD(e){return nw.call(lE,e)?!0:nw.call(aE,e)?!1:XD.test(e)?lE[e]=!0:(aE[e]=!0,!1)}function YD(e,t,r,i){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function JD(e,t,r,i){if(t===null||typeof t>"u"||YD(e,t,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function ea(e,t,r,i,n,s,c){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=i,this.attributeNamespace=n,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=c}var eo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){eo[e]=new ea(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];eo[t]=new ea(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){eo[e]=new ea(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){eo[e]=new ea(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){eo[e]=new ea(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){eo[e]=new ea(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){eo[e]=new ea(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){eo[e]=new ea(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){eo[e]=new ea(e,5,!1,e.toLowerCase(),null,!1,!1)});var f5=/[\-:]([a-z])/g;function m5(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(f5,m5);eo[t]=new ea(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(f5,m5);eo[t]=new ea(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(f5,m5);eo[t]=new ea(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){eo[e]=new ea(e,1,!1,e.toLowerCase(),null,!1,!1)});eo.xlinkHref=new ea("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){eo[e]=new ea(e,1,!1,e.toLowerCase(),null,!0,!0)});function g5(e,t,r,i){var n=eo.hasOwnProperty(t)?eo[t]:null;(n!==null?n.type!==0:i||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(JD(t,r,n,i)&&(r=null),i||n===null?ZD(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):n.mustUseProperty?e[n.propertyName]=r===null?n.type===3?!1:"":r:(t=n.attributeName,i=n.attributeNamespace,r===null?e.removeAttribute(t):(n=n.type,r=n===3||n===4&&r===!0?"":""+r,i?e.setAttributeNS(i,t,r):e.setAttribute(t,r))))}var xh=WD.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,E1=Symbol.for("react.element"),Tf=Symbol.for("react.portal"),Cf=Symbol.for("react.fragment"),y5=Symbol.for("react.strict_mode"),sw=Symbol.for("react.profiler"),DL=Symbol.for("react.provider"),NL=Symbol.for("react.context"),_5=Symbol.for("react.forward_ref"),ow=Symbol.for("react.suspense"),aw=Symbol.for("react.suspense_list"),v5=Symbol.for("react.memo"),td=Symbol.for("react.lazy"),OL=Symbol.for("react.offscreen"),cE=Symbol.iterator;function ag(e){return e===null||typeof e!="object"?null:(e=cE&&e[cE]||e["@@iterator"],typeof e=="function"?e:null)}var Pn=Object.assign,gb;function kg(e){if(gb===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);gb=t&&t[1]||""}return`
`+gb+e}var yb=!1;function _b(e,t){if(!e||yb)return"";yb=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(_){var i=_}Reflect.construct(e,[],t)}else{try{t.call()}catch(_){i=_}e.call(t.prototype)}else{try{throw Error()}catch(_){i=_}e()}}catch(_){if(_&&i&&typeof _.stack=="string"){for(var n=_.stack.split(`
`),s=i.stack.split(`
`),c=n.length-1,a=s.length-1;1<=c&&0<=a&&n[c]!==s[a];)a--;for(;1<=c&&0<=a;c--,a--)if(n[c]!==s[a]){if(c!==1||a!==1)do if(c--,a--,0>a||n[c]!==s[a]){var p=`
`+n[c].replace(" at new "," at ");return e.displayName&&p.includes("<anonymous>")&&(p=p.replace("<anonymous>",e.displayName)),p}while(1<=c&&0<=a);break}}}finally{yb=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?kg(e):""}function KD(e){switch(e.tag){case 5:return kg(e.type);case 16:return kg("Lazy");case 13:return kg("Suspense");case 19:return kg("SuspenseList");case 0:case 2:case 15:return e=_b(e.type,!1),e;case 11:return e=_b(e.type.render,!1),e;case 1:return e=_b(e.type,!0),e;default:return""}}function lw(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Cf:return"Fragment";case Tf:return"Portal";case sw:return"Profiler";case y5:return"StrictMode";case ow:return"Suspense";case aw:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case NL:return(e.displayName||"Context")+".Consumer";case DL:return(e._context.displayName||"Context")+".Provider";case _5:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case v5:return t=e.displayName||null,t!==null?t:lw(e.type)||"Memo";case td:t=e._payload,e=e._init;try{return lw(e(t))}catch{}}return null}function QD(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return lw(t);case 8:return t===y5?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function bd(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function zL(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function t8(e){var t=zL(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var n=r.get,s=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(c){i=""+c,s.call(this,c)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(c){i=""+c},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function T1(e){e._valueTracker||(e._valueTracker=t8(e))}function jL(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),i="";return e&&(i=zL(e)?e.checked?"true":"false":e.value),e=i,e!==r?(t.setValue(e),!0):!1}function Yy(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function cw(e,t){var r=t.checked;return Pn({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function uE(e,t){var r=t.defaultValue==null?"":t.defaultValue,i=t.checked!=null?t.checked:t.defaultChecked;r=bd(t.value!=null?t.value:r),e._wrapperState={initialChecked:i,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function UL(e,t){t=t.checked,t!=null&&g5(e,"checked",t,!1)}function uw(e,t){UL(e,t);var r=bd(t.value),i=t.type;if(r!=null)i==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(i==="submit"||i==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?hw(e,t.type,r):t.hasOwnProperty("defaultValue")&&hw(e,t.type,bd(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function hE(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!(i!=="submit"&&i!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function hw(e,t,r){(t!=="number"||Yy(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Rg=Array.isArray;function qf(e,t,r,i){if(e=e.options,t){t={};for(var n=0;n<r.length;n++)t["$"+r[n]]=!0;for(r=0;r<e.length;r++)n=t.hasOwnProperty("$"+e[r].value),e[r].selected!==n&&(e[r].selected=n),n&&i&&(e[r].defaultSelected=!0)}else{for(r=""+bd(r),t=null,n=0;n<e.length;n++){if(e[n].value===r){e[n].selected=!0,i&&(e[n].defaultSelected=!0);return}t!==null||e[n].disabled||(t=e[n])}t!==null&&(t.selected=!0)}}function dw(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ke(91));return Pn({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function dE(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(ke(92));if(Rg(r)){if(1<r.length)throw Error(ke(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:bd(r)}}function VL(e,t){var r=bd(t.value),i=bd(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),i!=null&&(e.defaultValue=""+i)}function pE(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function qL(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pw(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?qL(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var C1,HL=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,i,n){MSApp.execUnsafeLocalFunction(function(){return e(t,r,i,n)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(C1=C1||document.createElement("div"),C1.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=C1.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function o0(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Ug={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},e8=["Webkit","ms","Moz","O"];Object.keys(Ug).forEach(function(e){e8.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ug[t]=Ug[e]})});function $L(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Ug.hasOwnProperty(e)&&Ug[e]?(""+t).trim():t+"px"}function WL(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var i=r.indexOf("--")===0,n=$L(r,t[r],i);r==="float"&&(r="cssFloat"),i?e.setProperty(r,n):e[r]=n}}var r8=Pn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fw(e,t){if(t){if(r8[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ke(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ke(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ke(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ke(62))}}function mw(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gw=null;function b5(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var yw=null,Hf=null,$f=null;function fE(e){if(e=z0(e)){if(typeof yw!="function")throw Error(ke(280));var t=e.stateNode;t&&(t=Y_(t),yw(e.stateNode,e.type,t))}}function XL(e){Hf?$f?$f.push(e):$f=[e]:Hf=e}function ZL(){if(Hf){var e=Hf,t=$f;if($f=Hf=null,fE(e),t)for(e=0;e<t.length;e++)fE(t[e])}}function YL(e,t){return e(t)}function JL(){}var vb=!1;function KL(e,t,r){if(vb)return e(t,r);vb=!0;try{return YL(e,t,r)}finally{vb=!1,(Hf!==null||$f!==null)&&(JL(),ZL())}}function a0(e,t){var r=e.stateNode;if(r===null)return null;var i=Y_(r);if(i===null)return null;r=i[t];t:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break t;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(ke(231,t,typeof r));return r}var _w=!1;if(fh)try{var lg={};Object.defineProperty(lg,"passive",{get:function(){_w=!0}}),window.addEventListener("test",lg,lg),window.removeEventListener("test",lg,lg)}catch{_w=!1}function i8(e,t,r,i,n,s,c,a,p){var _=Array.prototype.slice.call(arguments,3);try{t.apply(r,_)}catch(w){this.onError(w)}}var Gg=!1,Jy=null,Ky=!1,vw=null,n8={onError:function(e){Gg=!0,Jy=e}};function s8(e,t,r,i,n,s,c,a,p){Gg=!1,Jy=null,i8.apply(n8,arguments)}function o8(e,t,r,i,n,s,c,a,p){if(s8.apply(this,arguments),Gg){if(Gg){var _=Jy;Gg=!1,Jy=null}else throw Error(ke(198));Ky||(Ky=!0,vw=_)}}function Dp(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function QL(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function mE(e){if(Dp(e)!==e)throw Error(ke(188))}function a8(e){var t=e.alternate;if(!t){if(t=Dp(e),t===null)throw Error(ke(188));return t!==e?null:e}for(var r=e,i=t;;){var n=r.return;if(n===null)break;var s=n.alternate;if(s===null){if(i=n.return,i!==null){r=i;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===r)return mE(n),e;if(s===i)return mE(n),t;s=s.sibling}throw Error(ke(188))}if(r.return!==i.return)r=n,i=s;else{for(var c=!1,a=n.child;a;){if(a===r){c=!0,r=n,i=s;break}if(a===i){c=!0,i=n,r=s;break}a=a.sibling}if(!c){for(a=s.child;a;){if(a===r){c=!0,r=s,i=n;break}if(a===i){c=!0,i=s,r=n;break}a=a.sibling}if(!c)throw Error(ke(189))}}if(r.alternate!==i)throw Error(ke(190))}if(r.tag!==3)throw Error(ke(188));return r.stateNode.current===r?e:t}function t4(e){return e=a8(e),e!==null?e4(e):null}function e4(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=e4(e);if(t!==null)return t;e=e.sibling}return null}var r4=al.unstable_scheduleCallback,gE=al.unstable_cancelCallback,l8=al.unstable_shouldYield,c8=al.unstable_requestPaint,Hn=al.unstable_now,u8=al.unstable_getCurrentPriorityLevel,w5=al.unstable_ImmediatePriority,i4=al.unstable_UserBlockingPriority,Qy=al.unstable_NormalPriority,h8=al.unstable_LowPriority,n4=al.unstable_IdlePriority,$_=null,Au=null;function d8(e){if(Au&&typeof Au.onCommitFiberRoot=="function")try{Au.onCommitFiberRoot($_,e,void 0,(e.current.flags&128)===128)}catch{}}var bc=Math.clz32?Math.clz32:m8,p8=Math.log,f8=Math.LN2;function m8(e){return e>>>=0,e===0?32:31-(p8(e)/f8|0)|0}var P1=64,I1=4194304;function Fg(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function t_(e,t){var r=e.pendingLanes;if(r===0)return 0;var i=0,n=e.suspendedLanes,s=e.pingedLanes,c=r&268435455;if(c!==0){var a=c&~n;a!==0?i=Fg(a):(s&=c,s!==0&&(i=Fg(s)))}else c=r&~n,c!==0?i=Fg(c):s!==0&&(i=Fg(s));if(i===0)return 0;if(t!==0&&t!==i&&!(t&n)&&(n=i&-i,s=t&-t,n>=s||n===16&&(s&4194240)!==0))return t;if(i&4&&(i|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=i;0<t;)r=31-bc(t),n=1<<r,i|=e[r],t&=~n;return i}function g8(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function y8(e,t){for(var r=e.suspendedLanes,i=e.pingedLanes,n=e.expirationTimes,s=e.pendingLanes;0<s;){var c=31-bc(s),a=1<<c,p=n[c];p===-1?(!(a&r)||a&i)&&(n[c]=g8(a,t)):p<=t&&(e.expiredLanes|=a),s&=~a}}function bw(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function s4(){var e=P1;return P1<<=1,!(P1&4194240)&&(P1=64),e}function bb(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function N0(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-bc(t),e[t]=r}function _8(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<r;){var n=31-bc(r),s=1<<n;t[n]=0,i[n]=-1,e[n]=-1,r&=~s}}function x5(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var i=31-bc(r),n=1<<i;n&t|e[i]&t&&(e[i]|=t),r&=~n}}var Gi=0;function o4(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var a4,S5,l4,c4,u4,ww=!1,L1=[],ud=null,hd=null,dd=null,l0=new Map,c0=new Map,id=[],v8="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function yE(e,t){switch(e){case"focusin":case"focusout":ud=null;break;case"dragenter":case"dragleave":hd=null;break;case"mouseover":case"mouseout":dd=null;break;case"pointerover":case"pointerout":l0.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":c0.delete(t.pointerId)}}function cg(e,t,r,i,n,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:r,eventSystemFlags:i,nativeEvent:s,targetContainers:[n]},t!==null&&(t=z0(t),t!==null&&S5(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,n!==null&&t.indexOf(n)===-1&&t.push(n),e)}function b8(e,t,r,i,n){switch(t){case"focusin":return ud=cg(ud,e,t,r,i,n),!0;case"dragenter":return hd=cg(hd,e,t,r,i,n),!0;case"mouseover":return dd=cg(dd,e,t,r,i,n),!0;case"pointerover":var s=n.pointerId;return l0.set(s,cg(l0.get(s)||null,e,t,r,i,n)),!0;case"gotpointercapture":return s=n.pointerId,c0.set(s,cg(c0.get(s)||null,e,t,r,i,n)),!0}return!1}function h4(e){var t=hp(e.target);if(t!==null){var r=Dp(t);if(r!==null){if(t=r.tag,t===13){if(t=QL(r),t!==null){e.blockedOn=t,u4(e.priority,function(){l4(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function wy(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=xw(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var i=new r.constructor(r.type,r);gw=i,r.target.dispatchEvent(i),gw=null}else return t=z0(r),t!==null&&S5(t),e.blockedOn=r,!1;t.shift()}return!0}function _E(e,t,r){wy(e)&&r.delete(t)}function w8(){ww=!1,ud!==null&&wy(ud)&&(ud=null),hd!==null&&wy(hd)&&(hd=null),dd!==null&&wy(dd)&&(dd=null),l0.forEach(_E),c0.forEach(_E)}function ug(e,t){e.blockedOn===t&&(e.blockedOn=null,ww||(ww=!0,al.unstable_scheduleCallback(al.unstable_NormalPriority,w8)))}function u0(e){function t(n){return ug(n,e)}if(0<L1.length){ug(L1[0],e);for(var r=1;r<L1.length;r++){var i=L1[r];i.blockedOn===e&&(i.blockedOn=null)}}for(ud!==null&&ug(ud,e),hd!==null&&ug(hd,e),dd!==null&&ug(dd,e),l0.forEach(t),c0.forEach(t),r=0;r<id.length;r++)i=id[r],i.blockedOn===e&&(i.blockedOn=null);for(;0<id.length&&(r=id[0],r.blockedOn===null);)h4(r),r.blockedOn===null&&id.shift()}var Wf=xh.ReactCurrentBatchConfig,e_=!0;function x8(e,t,r,i){var n=Gi,s=Wf.transition;Wf.transition=null;try{Gi=1,A5(e,t,r,i)}finally{Gi=n,Wf.transition=s}}function S8(e,t,r,i){var n=Gi,s=Wf.transition;Wf.transition=null;try{Gi=4,A5(e,t,r,i)}finally{Gi=n,Wf.transition=s}}function A5(e,t,r,i){if(e_){var n=xw(e,t,r,i);if(n===null)Lb(e,t,i,r_,r),yE(e,i);else if(b8(n,e,t,r,i))i.stopPropagation();else if(yE(e,i),t&4&&-1<v8.indexOf(e)){for(;n!==null;){var s=z0(n);if(s!==null&&a4(s),s=xw(e,t,r,i),s===null&&Lb(e,t,i,r_,r),s===n)break;n=s}n!==null&&i.stopPropagation()}else Lb(e,t,i,null,r)}}var r_=null;function xw(e,t,r,i){if(r_=null,e=b5(i),e=hp(e),e!==null)if(t=Dp(e),t===null)e=null;else if(r=t.tag,r===13){if(e=QL(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return r_=e,null}function d4(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(u8()){case w5:return 1;case i4:return 4;case Qy:case h8:return 16;case n4:return 536870912;default:return 16}default:return 16}}var sd=null,E5=null,xy=null;function p4(){if(xy)return xy;var e,t=E5,r=t.length,i,n="value"in sd?sd.value:sd.textContent,s=n.length;for(e=0;e<r&&t[e]===n[e];e++);var c=r-e;for(i=1;i<=c&&t[r-i]===n[s-i];i++);return xy=n.slice(e,1<i?1-i:void 0)}function Sy(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function M1(){return!0}function vE(){return!1}function ul(e){function t(r,i,n,s,c){this._reactName=r,this._targetInst=n,this.type=i,this.nativeEvent=s,this.target=c,this.currentTarget=null;for(var a in e)e.hasOwnProperty(a)&&(r=e[a],this[a]=r?r(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?M1:vE,this.isPropagationStopped=vE,this}return Pn(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=M1)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=M1)},persist:function(){},isPersistent:M1}),t}var Tm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},T5=ul(Tm),O0=Pn({},Tm,{view:0,detail:0}),A8=ul(O0),wb,xb,hg,W_=Pn({},O0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:C5,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==hg&&(hg&&e.type==="mousemove"?(wb=e.screenX-hg.screenX,xb=e.screenY-hg.screenY):xb=wb=0,hg=e),wb)},movementY:function(e){return"movementY"in e?e.movementY:xb}}),bE=ul(W_),E8=Pn({},W_,{dataTransfer:0}),T8=ul(E8),C8=Pn({},O0,{relatedTarget:0}),Sb=ul(C8),P8=Pn({},Tm,{animationName:0,elapsedTime:0,pseudoElement:0}),I8=ul(P8),L8=Pn({},Tm,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),M8=ul(L8),B8=Pn({},Tm,{data:0}),wE=ul(B8),k8={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},R8={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},F8={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function D8(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=F8[e])?!!t[e]:!1}function C5(){return D8}var N8=Pn({},O0,{key:function(e){if(e.key){var t=k8[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Sy(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?R8[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:C5,charCode:function(e){return e.type==="keypress"?Sy(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Sy(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),O8=ul(N8),z8=Pn({},W_,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),xE=ul(z8),j8=Pn({},O0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:C5}),U8=ul(j8),G8=Pn({},Tm,{propertyName:0,elapsedTime:0,pseudoElement:0}),V8=ul(G8),q8=Pn({},W_,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),H8=ul(q8),$8=[9,13,27,32],P5=fh&&"CompositionEvent"in window,Vg=null;fh&&"documentMode"in document&&(Vg=document.documentMode);var W8=fh&&"TextEvent"in window&&!Vg,f4=fh&&(!P5||Vg&&8<Vg&&11>=Vg),SE=String.fromCharCode(32),AE=!1;function m4(e,t){switch(e){case"keyup":return $8.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function g4(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Pf=!1;function X8(e,t){switch(e){case"compositionend":return g4(t);case"keypress":return t.which!==32?null:(AE=!0,SE);case"textInput":return e=t.data,e===SE&&AE?null:e;default:return null}}function Z8(e,t){if(Pf)return e==="compositionend"||!P5&&m4(e,t)?(e=p4(),xy=E5=sd=null,Pf=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return f4&&t.locale!=="ko"?null:t.data;default:return null}}var Y8={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function EE(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Y8[e.type]:t==="textarea"}function y4(e,t,r,i){XL(i),t=i_(t,"onChange"),0<t.length&&(r=new T5("onChange","change",null,r,i),e.push({event:r,listeners:t}))}var qg=null,h0=null;function J8(e){P4(e,0)}function X_(e){var t=Mf(e);if(jL(t))return e}function K8(e,t){if(e==="change")return t}var _4=!1;if(fh){var Ab;if(fh){var Eb="oninput"in document;if(!Eb){var TE=document.createElement("div");TE.setAttribute("oninput","return;"),Eb=typeof TE.oninput=="function"}Ab=Eb}else Ab=!1;_4=Ab&&(!document.documentMode||9<document.documentMode)}function CE(){qg&&(qg.detachEvent("onpropertychange",v4),h0=qg=null)}function v4(e){if(e.propertyName==="value"&&X_(h0)){var t=[];y4(t,h0,e,b5(e)),KL(J8,t)}}function Q8(e,t,r){e==="focusin"?(CE(),qg=t,h0=r,qg.attachEvent("onpropertychange",v4)):e==="focusout"&&CE()}function tN(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return X_(h0)}function eN(e,t){if(e==="click")return X_(t)}function rN(e,t){if(e==="input"||e==="change")return X_(t)}function iN(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Ac=typeof Object.is=="function"?Object.is:iN;function d0(e,t){if(Ac(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var n=r[i];if(!nw.call(t,n)||!Ac(e[n],t[n]))return!1}return!0}function PE(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function IE(e,t){var r=PE(e);e=0;for(var i;r;){if(r.nodeType===3){if(i=e+r.textContent.length,e<=t&&i>=t)return{node:r,offset:t-e};e=i}t:{for(;r;){if(r.nextSibling){r=r.nextSibling;break t}r=r.parentNode}r=void 0}r=PE(r)}}function b4(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?b4(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function w4(){for(var e=window,t=Yy();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=Yy(e.document)}return t}function I5(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function nN(e){var t=w4(),r=e.focusedElem,i=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&b4(r.ownerDocument.documentElement,r)){if(i!==null&&I5(r)){if(t=i.start,e=i.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var n=r.textContent.length,s=Math.min(i.start,n);i=i.end===void 0?s:Math.min(i.end,n),!e.extend&&s>i&&(n=i,i=s,s=n),n=IE(r,s);var c=IE(r,i);n&&c&&(e.rangeCount!==1||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==c.node||e.focusOffset!==c.offset)&&(t=t.createRange(),t.setStart(n.node,n.offset),e.removeAllRanges(),s>i?(e.addRange(t),e.extend(c.node,c.offset)):(t.setEnd(c.node,c.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var sN=fh&&"documentMode"in document&&11>=document.documentMode,If=null,Sw=null,Hg=null,Aw=!1;function LE(e,t,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Aw||If==null||If!==Yy(i)||(i=If,"selectionStart"in i&&I5(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Hg&&d0(Hg,i)||(Hg=i,i=i_(Sw,"onSelect"),0<i.length&&(t=new T5("onSelect","select",null,t,r),e.push({event:t,listeners:i}),t.target=If)))}function B1(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Lf={animationend:B1("Animation","AnimationEnd"),animationiteration:B1("Animation","AnimationIteration"),animationstart:B1("Animation","AnimationStart"),transitionend:B1("Transition","TransitionEnd")},Tb={},x4={};fh&&(x4=document.createElement("div").style,"AnimationEvent"in window||(delete Lf.animationend.animation,delete Lf.animationiteration.animation,delete Lf.animationstart.animation),"TransitionEvent"in window||delete Lf.transitionend.transition);function Z_(e){if(Tb[e])return Tb[e];if(!Lf[e])return e;var t=Lf[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in x4)return Tb[e]=t[r];return e}var S4=Z_("animationend"),A4=Z_("animationiteration"),E4=Z_("animationstart"),T4=Z_("transitionend"),C4=new Map,ME="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cd(e,t){C4.set(e,t),Fp(t,[e])}for(var Cb=0;Cb<ME.length;Cb++){var Pb=ME[Cb],oN=Pb.toLowerCase(),aN=Pb[0].toUpperCase()+Pb.slice(1);Cd(oN,"on"+aN)}Cd(S4,"onAnimationEnd");Cd(A4,"onAnimationIteration");Cd(E4,"onAnimationStart");Cd("dblclick","onDoubleClick");Cd("focusin","onFocus");Cd("focusout","onBlur");Cd(T4,"onTransitionEnd");am("onMouseEnter",["mouseout","mouseover"]);am("onMouseLeave",["mouseout","mouseover"]);am("onPointerEnter",["pointerout","pointerover"]);am("onPointerLeave",["pointerout","pointerover"]);Fp("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Fp("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Fp("onBeforeInput",["compositionend","keypress","textInput","paste"]);Fp("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Fp("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Fp("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lN=new Set("cancel close invalid load scroll toggle".split(" ").concat(Dg));function BE(e,t,r){var i=e.type||"unknown-event";e.currentTarget=r,o8(i,t,void 0,e),e.currentTarget=null}function P4(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var i=e[r],n=i.event;i=i.listeners;t:{var s=void 0;if(t)for(var c=i.length-1;0<=c;c--){var a=i[c],p=a.instance,_=a.currentTarget;if(a=a.listener,p!==s&&n.isPropagationStopped())break t;BE(n,a,_),s=p}else for(c=0;c<i.length;c++){if(a=i[c],p=a.instance,_=a.currentTarget,a=a.listener,p!==s&&n.isPropagationStopped())break t;BE(n,a,_),s=p}}}if(Ky)throw e=vw,Ky=!1,vw=null,e}function fn(e,t){var r=t[Iw];r===void 0&&(r=t[Iw]=new Set);var i=e+"__bubble";r.has(i)||(I4(t,e,2,!1),r.add(i))}function Ib(e,t,r){var i=0;t&&(i|=4),I4(r,e,i,t)}var k1="_reactListening"+Math.random().toString(36).slice(2);function p0(e){if(!e[k1]){e[k1]=!0,FL.forEach(function(r){r!=="selectionchange"&&(lN.has(r)||Ib(r,!1,e),Ib(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[k1]||(t[k1]=!0,Ib("selectionchange",!1,t))}}function I4(e,t,r,i){switch(d4(t)){case 1:var n=x8;break;case 4:n=S8;break;default:n=A5}r=n.bind(null,t,r,e),n=void 0,!_w||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(n=!0),i?n!==void 0?e.addEventListener(t,r,{capture:!0,passive:n}):e.addEventListener(t,r,!0):n!==void 0?e.addEventListener(t,r,{passive:n}):e.addEventListener(t,r,!1)}function Lb(e,t,r,i,n){var s=i;if(!(t&1)&&!(t&2)&&i!==null)t:for(;;){if(i===null)return;var c=i.tag;if(c===3||c===4){var a=i.stateNode.containerInfo;if(a===n||a.nodeType===8&&a.parentNode===n)break;if(c===4)for(c=i.return;c!==null;){var p=c.tag;if((p===3||p===4)&&(p=c.stateNode.containerInfo,p===n||p.nodeType===8&&p.parentNode===n))return;c=c.return}for(;a!==null;){if(c=hp(a),c===null)return;if(p=c.tag,p===5||p===6){i=s=c;continue t}a=a.parentNode}}i=i.return}KL(function(){var _=s,w=b5(r),S=[];t:{var C=C4.get(e);if(C!==void 0){var I=T5,N=e;switch(e){case"keypress":if(Sy(r)===0)break t;case"keydown":case"keyup":I=O8;break;case"focusin":N="focus",I=Sb;break;case"focusout":N="blur",I=Sb;break;case"beforeblur":case"afterblur":I=Sb;break;case"click":if(r.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":I=bE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":I=T8;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":I=U8;break;case S4:case A4:case E4:I=I8;break;case T4:I=V8;break;case"scroll":I=A8;break;case"wheel":I=H8;break;case"copy":case"cut":case"paste":I=M8;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":I=xE}var F=(t&4)!==0,W=!F&&e==="scroll",U=F?C!==null?C+"Capture":null:C;F=[];for(var z=_,H;z!==null;){H=z;var nt=H.stateNode;if(H.tag===5&&nt!==null&&(H=nt,U!==null&&(nt=a0(z,U),nt!=null&&F.push(f0(z,nt,H)))),W)break;z=z.return}0<F.length&&(C=new I(C,N,null,r,w),S.push({event:C,listeners:F}))}}if(!(t&7)){t:{if(C=e==="mouseover"||e==="pointerover",I=e==="mouseout"||e==="pointerout",C&&r!==gw&&(N=r.relatedTarget||r.fromElement)&&(hp(N)||N[mh]))break t;if((I||C)&&(C=w.window===w?w:(C=w.ownerDocument)?C.defaultView||C.parentWindow:window,I?(N=r.relatedTarget||r.toElement,I=_,N=N?hp(N):null,N!==null&&(W=Dp(N),N!==W||N.tag!==5&&N.tag!==6)&&(N=null)):(I=null,N=_),I!==N)){if(F=bE,nt="onMouseLeave",U="onMouseEnter",z="mouse",(e==="pointerout"||e==="pointerover")&&(F=xE,nt="onPointerLeave",U="onPointerEnter",z="pointer"),W=I==null?C:Mf(I),H=N==null?C:Mf(N),C=new F(nt,z+"leave",I,r,w),C.target=W,C.relatedTarget=H,nt=null,hp(w)===_&&(F=new F(U,z+"enter",N,r,w),F.target=H,F.relatedTarget=W,nt=F),W=nt,I&&N)e:{for(F=I,U=N,z=0,H=F;H;H=uf(H))z++;for(H=0,nt=U;nt;nt=uf(nt))H++;for(;0<z-H;)F=uf(F),z--;for(;0<H-z;)U=uf(U),H--;for(;z--;){if(F===U||U!==null&&F===U.alternate)break e;F=uf(F),U=uf(U)}F=null}else F=null;I!==null&&kE(S,C,I,F,!1),N!==null&&W!==null&&kE(S,W,N,F,!0)}}t:{if(C=_?Mf(_):window,I=C.nodeName&&C.nodeName.toLowerCase(),I==="select"||I==="input"&&C.type==="file")var yt=K8;else if(EE(C))if(_4)yt=rN;else{yt=tN;var bt=Q8}else(I=C.nodeName)&&I.toLowerCase()==="input"&&(C.type==="checkbox"||C.type==="radio")&&(yt=eN);if(yt&&(yt=yt(e,_))){y4(S,yt,r,w);break t}bt&&bt(e,C,_),e==="focusout"&&(bt=C._wrapperState)&&bt.controlled&&C.type==="number"&&hw(C,"number",C.value)}switch(bt=_?Mf(_):window,e){case"focusin":(EE(bt)||bt.contentEditable==="true")&&(If=bt,Sw=_,Hg=null);break;case"focusout":Hg=Sw=If=null;break;case"mousedown":Aw=!0;break;case"contextmenu":case"mouseup":case"dragend":Aw=!1,LE(S,r,w);break;case"selectionchange":if(sN)break;case"keydown":case"keyup":LE(S,r,w)}var vt;if(P5)t:{switch(e){case"compositionstart":var mt="onCompositionStart";break t;case"compositionend":mt="onCompositionEnd";break t;case"compositionupdate":mt="onCompositionUpdate";break t}mt=void 0}else Pf?m4(e,r)&&(mt="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(mt="onCompositionStart");mt&&(f4&&r.locale!=="ko"&&(Pf||mt!=="onCompositionStart"?mt==="onCompositionEnd"&&Pf&&(vt=p4()):(sd=w,E5="value"in sd?sd.value:sd.textContent,Pf=!0)),bt=i_(_,mt),0<bt.length&&(mt=new wE(mt,e,null,r,w),S.push({event:mt,listeners:bt}),vt?mt.data=vt:(vt=g4(r),vt!==null&&(mt.data=vt)))),(vt=W8?X8(e,r):Z8(e,r))&&(_=i_(_,"onBeforeInput"),0<_.length&&(w=new wE("onBeforeInput","beforeinput",null,r,w),S.push({event:w,listeners:_}),w.data=vt))}P4(S,t)})}function f0(e,t,r){return{instance:e,listener:t,currentTarget:r}}function i_(e,t){for(var r=t+"Capture",i=[];e!==null;){var n=e,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=a0(e,r),s!=null&&i.unshift(f0(e,s,n)),s=a0(e,t),s!=null&&i.push(f0(e,s,n))),e=e.return}return i}function uf(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function kE(e,t,r,i,n){for(var s=t._reactName,c=[];r!==null&&r!==i;){var a=r,p=a.alternate,_=a.stateNode;if(p!==null&&p===i)break;a.tag===5&&_!==null&&(a=_,n?(p=a0(r,s),p!=null&&c.unshift(f0(r,p,a))):n||(p=a0(r,s),p!=null&&c.push(f0(r,p,a)))),r=r.return}c.length!==0&&e.push({event:t,listeners:c})}var cN=/\r\n?/g,uN=/\u0000|\uFFFD/g;function RE(e){return(typeof e=="string"?e:""+e).replace(cN,`
`).replace(uN,"")}function R1(e,t,r){if(t=RE(t),RE(e)!==t&&r)throw Error(ke(425))}function n_(){}var Ew=null,Tw=null;function Cw(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Pw=typeof setTimeout=="function"?setTimeout:void 0,hN=typeof clearTimeout=="function"?clearTimeout:void 0,FE=typeof Promise=="function"?Promise:void 0,dN=typeof queueMicrotask=="function"?queueMicrotask:typeof FE<"u"?function(e){return FE.resolve(null).then(e).catch(pN)}:Pw;function pN(e){setTimeout(function(){throw e})}function Mb(e,t){var r=t,i=0;do{var n=r.nextSibling;if(e.removeChild(r),n&&n.nodeType===8)if(r=n.data,r==="/$"){if(i===0){e.removeChild(n),u0(t);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=n}while(r);u0(t)}function pd(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function DE(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Cm=Math.random().toString(36).slice(2),yu="__reactFiber$"+Cm,m0="__reactProps$"+Cm,mh="__reactContainer$"+Cm,Iw="__reactEvents$"+Cm,fN="__reactListeners$"+Cm,mN="__reactHandles$"+Cm;function hp(e){var t=e[yu];if(t)return t;for(var r=e.parentNode;r;){if(t=r[mh]||r[yu]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=DE(e);e!==null;){if(r=e[yu])return r;e=DE(e)}return t}e=r,r=e.parentNode}return null}function z0(e){return e=e[yu]||e[mh],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Mf(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ke(33))}function Y_(e){return e[m0]||null}var Lw=[],Bf=-1;function Pd(e){return{current:e}}function gn(e){0>Bf||(e.current=Lw[Bf],Lw[Bf]=null,Bf--)}function sn(e,t){Bf++,Lw[Bf]=e.current,e.current=t}var wd={},Io=Pd(wd),Sa=Pd(!1),Ep=wd;function lm(e,t){var r=e.type.contextTypes;if(!r)return wd;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in r)n[s]=t[s];return i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=n),n}function Aa(e){return e=e.childContextTypes,e!=null}function s_(){gn(Sa),gn(Io)}function NE(e,t,r){if(Io.current!==wd)throw Error(ke(168));sn(Io,t),sn(Sa,r)}function L4(e,t,r){var i=e.stateNode;if(t=t.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var n in i)if(!(n in t))throw Error(ke(108,QD(e)||"Unknown",n));return Pn({},r,i)}function o_(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||wd,Ep=Io.current,sn(Io,e),sn(Sa,Sa.current),!0}function OE(e,t,r){var i=e.stateNode;if(!i)throw Error(ke(169));r?(e=L4(e,t,Ep),i.__reactInternalMemoizedMergedChildContext=e,gn(Sa),gn(Io),sn(Io,e)):gn(Sa),sn(Sa,r)}var rh=null,J_=!1,Bb=!1;function M4(e){rh===null?rh=[e]:rh.push(e)}function gN(e){J_=!0,M4(e)}function Id(){if(!Bb&&rh!==null){Bb=!0;var e=0,t=Gi;try{var r=rh;for(Gi=1;e<r.length;e++){var i=r[e];do i=i(!0);while(i!==null)}rh=null,J_=!1}catch(n){throw rh!==null&&(rh=rh.slice(e+1)),r4(w5,Id),n}finally{Gi=t,Bb=!1}}return null}var kf=[],Rf=0,a_=null,l_=0,Rl=[],Fl=0,Tp=null,sh=1,oh="";function ip(e,t){kf[Rf++]=l_,kf[Rf++]=a_,a_=e,l_=t}function B4(e,t,r){Rl[Fl++]=sh,Rl[Fl++]=oh,Rl[Fl++]=Tp,Tp=e;var i=sh;e=oh;var n=32-bc(i)-1;i&=~(1<<n),r+=1;var s=32-bc(t)+n;if(30<s){var c=n-n%5;s=(i&(1<<c)-1).toString(32),i>>=c,n-=c,sh=1<<32-bc(t)+n|r<<n|i,oh=s+e}else sh=1<<s|r<<n|i,oh=e}function L5(e){e.return!==null&&(ip(e,1),B4(e,1,0))}function M5(e){for(;e===a_;)a_=kf[--Rf],kf[Rf]=null,l_=kf[--Rf],kf[Rf]=null;for(;e===Tp;)Tp=Rl[--Fl],Rl[Fl]=null,oh=Rl[--Fl],Rl[Fl]=null,sh=Rl[--Fl],Rl[Fl]=null}var nl=null,rl=null,vn=!1,mc=null;function k4(e,t){var r=Dl(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function zE(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,nl=e,rl=pd(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,nl=e,rl=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Tp!==null?{id:sh,overflow:oh}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Dl(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,nl=e,rl=null,!0):!1;default:return!1}}function Mw(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Bw(e){if(vn){var t=rl;if(t){var r=t;if(!zE(e,t)){if(Mw(e))throw Error(ke(418));t=pd(r.nextSibling);var i=nl;t&&zE(e,t)?k4(i,r):(e.flags=e.flags&-4097|2,vn=!1,nl=e)}}else{if(Mw(e))throw Error(ke(418));e.flags=e.flags&-4097|2,vn=!1,nl=e}}}function jE(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;nl=e}function F1(e){if(e!==nl)return!1;if(!vn)return jE(e),vn=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Cw(e.type,e.memoizedProps)),t&&(t=rl)){if(Mw(e))throw R4(),Error(ke(418));for(;t;)k4(e,t),t=pd(t.nextSibling)}if(jE(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ke(317));t:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){rl=pd(e.nextSibling);break t}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}rl=null}}else rl=nl?pd(e.stateNode.nextSibling):null;return!0}function R4(){for(var e=rl;e;)e=pd(e.nextSibling)}function cm(){rl=nl=null,vn=!1}function B5(e){mc===null?mc=[e]:mc.push(e)}var yN=xh.ReactCurrentBatchConfig;function dg(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(ke(309));var i=r.stateNode}if(!i)throw Error(ke(147,e));var n=i,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(c){var a=n.refs;c===null?delete a[s]:a[s]=c},t._stringRef=s,t)}if(typeof e!="string")throw Error(ke(284));if(!r._owner)throw Error(ke(290,e))}return e}function D1(e,t){throw e=Object.prototype.toString.call(t),Error(ke(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function UE(e){var t=e._init;return t(e._payload)}function F4(e){function t(U,z){if(e){var H=U.deletions;H===null?(U.deletions=[z],U.flags|=16):H.push(z)}}function r(U,z){if(!e)return null;for(;z!==null;)t(U,z),z=z.sibling;return null}function i(U,z){for(U=new Map;z!==null;)z.key!==null?U.set(z.key,z):U.set(z.index,z),z=z.sibling;return U}function n(U,z){return U=yd(U,z),U.index=0,U.sibling=null,U}function s(U,z,H){return U.index=H,e?(H=U.alternate,H!==null?(H=H.index,H<z?(U.flags|=2,z):H):(U.flags|=2,z)):(U.flags|=1048576,z)}function c(U){return e&&U.alternate===null&&(U.flags|=2),U}function a(U,z,H,nt){return z===null||z.tag!==6?(z=zb(H,U.mode,nt),z.return=U,z):(z=n(z,H),z.return=U,z)}function p(U,z,H,nt){var yt=H.type;return yt===Cf?w(U,z,H.props.children,nt,H.key):z!==null&&(z.elementType===yt||typeof yt=="object"&&yt!==null&&yt.$$typeof===td&&UE(yt)===z.type)?(nt=n(z,H.props),nt.ref=dg(U,z,H),nt.return=U,nt):(nt=Ly(H.type,H.key,H.props,null,U.mode,nt),nt.ref=dg(U,z,H),nt.return=U,nt)}function _(U,z,H,nt){return z===null||z.tag!==4||z.stateNode.containerInfo!==H.containerInfo||z.stateNode.implementation!==H.implementation?(z=jb(H,U.mode,nt),z.return=U,z):(z=n(z,H.children||[]),z.return=U,z)}function w(U,z,H,nt,yt){return z===null||z.tag!==7?(z=bp(H,U.mode,nt,yt),z.return=U,z):(z=n(z,H),z.return=U,z)}function S(U,z,H){if(typeof z=="string"&&z!==""||typeof z=="number")return z=zb(""+z,U.mode,H),z.return=U,z;if(typeof z=="object"&&z!==null){switch(z.$$typeof){case E1:return H=Ly(z.type,z.key,z.props,null,U.mode,H),H.ref=dg(U,null,z),H.return=U,H;case Tf:return z=jb(z,U.mode,H),z.return=U,z;case td:var nt=z._init;return S(U,nt(z._payload),H)}if(Rg(z)||ag(z))return z=bp(z,U.mode,H,null),z.return=U,z;D1(U,z)}return null}function C(U,z,H,nt){var yt=z!==null?z.key:null;if(typeof H=="string"&&H!==""||typeof H=="number")return yt!==null?null:a(U,z,""+H,nt);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case E1:return H.key===yt?p(U,z,H,nt):null;case Tf:return H.key===yt?_(U,z,H,nt):null;case td:return yt=H._init,C(U,z,yt(H._payload),nt)}if(Rg(H)||ag(H))return yt!==null?null:w(U,z,H,nt,null);D1(U,H)}return null}function I(U,z,H,nt,yt){if(typeof nt=="string"&&nt!==""||typeof nt=="number")return U=U.get(H)||null,a(z,U,""+nt,yt);if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case E1:return U=U.get(nt.key===null?H:nt.key)||null,p(z,U,nt,yt);case Tf:return U=U.get(nt.key===null?H:nt.key)||null,_(z,U,nt,yt);case td:var bt=nt._init;return I(U,z,H,bt(nt._payload),yt)}if(Rg(nt)||ag(nt))return U=U.get(H)||null,w(z,U,nt,yt,null);D1(z,nt)}return null}function N(U,z,H,nt){for(var yt=null,bt=null,vt=z,mt=z=0,Dt=null;vt!==null&&mt<H.length;mt++){vt.index>mt?(Dt=vt,vt=null):Dt=vt.sibling;var kt=C(U,vt,H[mt],nt);if(kt===null){vt===null&&(vt=Dt);break}e&&vt&&kt.alternate===null&&t(U,vt),z=s(kt,z,mt),bt===null?yt=kt:bt.sibling=kt,bt=kt,vt=Dt}if(mt===H.length)return r(U,vt),vn&&ip(U,mt),yt;if(vt===null){for(;mt<H.length;mt++)vt=S(U,H[mt],nt),vt!==null&&(z=s(vt,z,mt),bt===null?yt=vt:bt.sibling=vt,bt=vt);return vn&&ip(U,mt),yt}for(vt=i(U,vt);mt<H.length;mt++)Dt=I(vt,U,mt,H[mt],nt),Dt!==null&&(e&&Dt.alternate!==null&&vt.delete(Dt.key===null?mt:Dt.key),z=s(Dt,z,mt),bt===null?yt=Dt:bt.sibling=Dt,bt=Dt);return e&&vt.forEach(function(at){return t(U,at)}),vn&&ip(U,mt),yt}function F(U,z,H,nt){var yt=ag(H);if(typeof yt!="function")throw Error(ke(150));if(H=yt.call(H),H==null)throw Error(ke(151));for(var bt=yt=null,vt=z,mt=z=0,Dt=null,kt=H.next();vt!==null&&!kt.done;mt++,kt=H.next()){vt.index>mt?(Dt=vt,vt=null):Dt=vt.sibling;var at=C(U,vt,kt.value,nt);if(at===null){vt===null&&(vt=Dt);break}e&&vt&&at.alternate===null&&t(U,vt),z=s(at,z,mt),bt===null?yt=at:bt.sibling=at,bt=at,vt=Dt}if(kt.done)return r(U,vt),vn&&ip(U,mt),yt;if(vt===null){for(;!kt.done;mt++,kt=H.next())kt=S(U,kt.value,nt),kt!==null&&(z=s(kt,z,mt),bt===null?yt=kt:bt.sibling=kt,bt=kt);return vn&&ip(U,mt),yt}for(vt=i(U,vt);!kt.done;mt++,kt=H.next())kt=I(vt,U,mt,kt.value,nt),kt!==null&&(e&&kt.alternate!==null&&vt.delete(kt.key===null?mt:kt.key),z=s(kt,z,mt),bt===null?yt=kt:bt.sibling=kt,bt=kt);return e&&vt.forEach(function(dt){return t(U,dt)}),vn&&ip(U,mt),yt}function W(U,z,H,nt){if(typeof H=="object"&&H!==null&&H.type===Cf&&H.key===null&&(H=H.props.children),typeof H=="object"&&H!==null){switch(H.$$typeof){case E1:t:{for(var yt=H.key,bt=z;bt!==null;){if(bt.key===yt){if(yt=H.type,yt===Cf){if(bt.tag===7){r(U,bt.sibling),z=n(bt,H.props.children),z.return=U,U=z;break t}}else if(bt.elementType===yt||typeof yt=="object"&&yt!==null&&yt.$$typeof===td&&UE(yt)===bt.type){r(U,bt.sibling),z=n(bt,H.props),z.ref=dg(U,bt,H),z.return=U,U=z;break t}r(U,bt);break}else t(U,bt);bt=bt.sibling}H.type===Cf?(z=bp(H.props.children,U.mode,nt,H.key),z.return=U,U=z):(nt=Ly(H.type,H.key,H.props,null,U.mode,nt),nt.ref=dg(U,z,H),nt.return=U,U=nt)}return c(U);case Tf:t:{for(bt=H.key;z!==null;){if(z.key===bt)if(z.tag===4&&z.stateNode.containerInfo===H.containerInfo&&z.stateNode.implementation===H.implementation){r(U,z.sibling),z=n(z,H.children||[]),z.return=U,U=z;break t}else{r(U,z);break}else t(U,z);z=z.sibling}z=jb(H,U.mode,nt),z.return=U,U=z}return c(U);case td:return bt=H._init,W(U,z,bt(H._payload),nt)}if(Rg(H))return N(U,z,H,nt);if(ag(H))return F(U,z,H,nt);D1(U,H)}return typeof H=="string"&&H!==""||typeof H=="number"?(H=""+H,z!==null&&z.tag===6?(r(U,z.sibling),z=n(z,H),z.return=U,U=z):(r(U,z),z=zb(H,U.mode,nt),z.return=U,U=z),c(U)):r(U,z)}return W}var um=F4(!0),D4=F4(!1),c_=Pd(null),u_=null,Ff=null,k5=null;function R5(){k5=Ff=u_=null}function F5(e){var t=c_.current;gn(c_),e._currentValue=t}function kw(e,t,r){for(;e!==null;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===r)break;e=e.return}}function Xf(e,t){u_=e,k5=Ff=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(ba=!0),e.firstContext=null)}function Gl(e){var t=e._currentValue;if(k5!==e)if(e={context:e,memoizedValue:t,next:null},Ff===null){if(u_===null)throw Error(ke(308));Ff=e,u_.dependencies={lanes:0,firstContext:e}}else Ff=Ff.next=e;return t}var dp=null;function D5(e){dp===null?dp=[e]:dp.push(e)}function N4(e,t,r,i){var n=t.interleaved;return n===null?(r.next=r,D5(t)):(r.next=n.next,n.next=r),t.interleaved=r,gh(e,i)}function gh(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var ed=!1;function N5(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function O4(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function hh(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function fd(e,t,r){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,gi&2){var n=i.pending;return n===null?t.next=t:(t.next=n.next,n.next=t),i.pending=t,gh(e,r)}return n=i.interleaved,n===null?(t.next=t,D5(i)):(t.next=n.next,n.next=t),i.interleaved=t,gh(e,r)}function Ay(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,x5(e,r)}}function GE(e,t){var r=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var n=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var c={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?n=s=c:s=s.next=c,r=r.next}while(r!==null);s===null?n=s=t:s=s.next=t}else n=s=t;r={baseState:i.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:i.shared,effects:i.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function h_(e,t,r,i){var n=e.updateQueue;ed=!1;var s=n.firstBaseUpdate,c=n.lastBaseUpdate,a=n.shared.pending;if(a!==null){n.shared.pending=null;var p=a,_=p.next;p.next=null,c===null?s=_:c.next=_,c=p;var w=e.alternate;w!==null&&(w=w.updateQueue,a=w.lastBaseUpdate,a!==c&&(a===null?w.firstBaseUpdate=_:a.next=_,w.lastBaseUpdate=p))}if(s!==null){var S=n.baseState;c=0,w=_=p=null,a=s;do{var C=a.lane,I=a.eventTime;if((i&C)===C){w!==null&&(w=w.next={eventTime:I,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});t:{var N=e,F=a;switch(C=t,I=r,F.tag){case 1:if(N=F.payload,typeof N=="function"){S=N.call(I,S,C);break t}S=N;break t;case 3:N.flags=N.flags&-65537|128;case 0:if(N=F.payload,C=typeof N=="function"?N.call(I,S,C):N,C==null)break t;S=Pn({},S,C);break t;case 2:ed=!0}}a.callback!==null&&a.lane!==0&&(e.flags|=64,C=n.effects,C===null?n.effects=[a]:C.push(a))}else I={eventTime:I,lane:C,tag:a.tag,payload:a.payload,callback:a.callback,next:null},w===null?(_=w=I,p=S):w=w.next=I,c|=C;if(a=a.next,a===null){if(a=n.shared.pending,a===null)break;C=a,a=C.next,C.next=null,n.lastBaseUpdate=C,n.shared.pending=null}}while(1);if(w===null&&(p=S),n.baseState=p,n.firstBaseUpdate=_,n.lastBaseUpdate=w,t=n.shared.interleaved,t!==null){n=t;do c|=n.lane,n=n.next;while(n!==t)}else s===null&&(n.shared.lanes=0);Pp|=c,e.lanes=c,e.memoizedState=S}}function VE(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var i=e[t],n=i.callback;if(n!==null){if(i.callback=null,i=r,typeof n!="function")throw Error(ke(191,n));n.call(i)}}}var j0={},Eu=Pd(j0),g0=Pd(j0),y0=Pd(j0);function pp(e){if(e===j0)throw Error(ke(174));return e}function O5(e,t){switch(sn(y0,t),sn(g0,e),sn(Eu,j0),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:pw(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=pw(t,e)}gn(Eu),sn(Eu,t)}function hm(){gn(Eu),gn(g0),gn(y0)}function z4(e){pp(y0.current);var t=pp(Eu.current),r=pw(t,e.type);t!==r&&(sn(g0,e),sn(Eu,r))}function z5(e){g0.current===e&&(gn(Eu),gn(g0))}var En=Pd(0);function d_(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var kb=[];function j5(){for(var e=0;e<kb.length;e++)kb[e]._workInProgressVersionPrimary=null;kb.length=0}var Ey=xh.ReactCurrentDispatcher,Rb=xh.ReactCurrentBatchConfig,Cp=0,Cn=null,bs=null,Fs=null,p_=!1,$g=!1,_0=0,_N=0;function _o(){throw Error(ke(321))}function U5(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Ac(e[r],t[r]))return!1;return!0}function G5(e,t,r,i,n,s){if(Cp=s,Cn=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Ey.current=e===null||e.memoizedState===null?xN:SN,e=r(i,n),$g){s=0;do{if($g=!1,_0=0,25<=s)throw Error(ke(301));s+=1,Fs=bs=null,t.updateQueue=null,Ey.current=AN,e=r(i,n)}while($g)}if(Ey.current=f_,t=bs!==null&&bs.next!==null,Cp=0,Fs=bs=Cn=null,p_=!1,t)throw Error(ke(300));return e}function V5(){var e=_0!==0;return _0=0,e}function gu(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Fs===null?Cn.memoizedState=Fs=e:Fs=Fs.next=e,Fs}function Vl(){if(bs===null){var e=Cn.alternate;e=e!==null?e.memoizedState:null}else e=bs.next;var t=Fs===null?Cn.memoizedState:Fs.next;if(t!==null)Fs=t,bs=e;else{if(e===null)throw Error(ke(310));bs=e,e={memoizedState:bs.memoizedState,baseState:bs.baseState,baseQueue:bs.baseQueue,queue:bs.queue,next:null},Fs===null?Cn.memoizedState=Fs=e:Fs=Fs.next=e}return Fs}function v0(e,t){return typeof t=="function"?t(e):t}function Fb(e){var t=Vl(),r=t.queue;if(r===null)throw Error(ke(311));r.lastRenderedReducer=e;var i=bs,n=i.baseQueue,s=r.pending;if(s!==null){if(n!==null){var c=n.next;n.next=s.next,s.next=c}i.baseQueue=n=s,r.pending=null}if(n!==null){s=n.next,i=i.baseState;var a=c=null,p=null,_=s;do{var w=_.lane;if((Cp&w)===w)p!==null&&(p=p.next={lane:0,action:_.action,hasEagerState:_.hasEagerState,eagerState:_.eagerState,next:null}),i=_.hasEagerState?_.eagerState:e(i,_.action);else{var S={lane:w,action:_.action,hasEagerState:_.hasEagerState,eagerState:_.eagerState,next:null};p===null?(a=p=S,c=i):p=p.next=S,Cn.lanes|=w,Pp|=w}_=_.next}while(_!==null&&_!==s);p===null?c=i:p.next=a,Ac(i,t.memoizedState)||(ba=!0),t.memoizedState=i,t.baseState=c,t.baseQueue=p,r.lastRenderedState=i}if(e=r.interleaved,e!==null){n=e;do s=n.lane,Cn.lanes|=s,Pp|=s,n=n.next;while(n!==e)}else n===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function Db(e){var t=Vl(),r=t.queue;if(r===null)throw Error(ke(311));r.lastRenderedReducer=e;var i=r.dispatch,n=r.pending,s=t.memoizedState;if(n!==null){r.pending=null;var c=n=n.next;do s=e(s,c.action),c=c.next;while(c!==n);Ac(s,t.memoizedState)||(ba=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),r.lastRenderedState=s}return[s,i]}function j4(){}function U4(e,t){var r=Cn,i=Vl(),n=t(),s=!Ac(i.memoizedState,n);if(s&&(i.memoizedState=n,ba=!0),i=i.queue,q5(q4.bind(null,r,i,e),[e]),i.getSnapshot!==t||s||Fs!==null&&Fs.memoizedState.tag&1){if(r.flags|=2048,b0(9,V4.bind(null,r,i,n,t),void 0,null),zs===null)throw Error(ke(349));Cp&30||G4(r,t,n)}return n}function G4(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Cn.updateQueue,t===null?(t={lastEffect:null,stores:null},Cn.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function V4(e,t,r,i){t.value=r,t.getSnapshot=i,H4(t)&&$4(e)}function q4(e,t,r){return r(function(){H4(t)&&$4(e)})}function H4(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Ac(e,r)}catch{return!0}}function $4(e){var t=gh(e,1);t!==null&&wc(t,e,1,-1)}function qE(e){var t=gu();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:v0,lastRenderedState:e},t.queue=e,e=e.dispatch=wN.bind(null,Cn,e),[t.memoizedState,e]}function b0(e,t,r,i){return e={tag:e,create:t,destroy:r,deps:i,next:null},t=Cn.updateQueue,t===null?(t={lastEffect:null,stores:null},Cn.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(i=r.next,r.next=e,e.next=i,t.lastEffect=e)),e}function W4(){return Vl().memoizedState}function Ty(e,t,r,i){var n=gu();Cn.flags|=e,n.memoizedState=b0(1|t,r,void 0,i===void 0?null:i)}function K_(e,t,r,i){var n=Vl();i=i===void 0?null:i;var s=void 0;if(bs!==null){var c=bs.memoizedState;if(s=c.destroy,i!==null&&U5(i,c.deps)){n.memoizedState=b0(t,r,s,i);return}}Cn.flags|=e,n.memoizedState=b0(1|t,r,s,i)}function HE(e,t){return Ty(8390656,8,e,t)}function q5(e,t){return K_(2048,8,e,t)}function X4(e,t){return K_(4,2,e,t)}function Z4(e,t){return K_(4,4,e,t)}function Y4(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function J4(e,t,r){return r=r!=null?r.concat([e]):null,K_(4,4,Y4.bind(null,t,e),r)}function H5(){}function K4(e,t){var r=Vl();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&U5(t,i[1])?i[0]:(r.memoizedState=[e,t],e)}function Q4(e,t){var r=Vl();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&U5(t,i[1])?i[0]:(e=e(),r.memoizedState=[e,t],e)}function tM(e,t,r){return Cp&21?(Ac(r,t)||(r=s4(),Cn.lanes|=r,Pp|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,ba=!0),e.memoizedState=r)}function vN(e,t){var r=Gi;Gi=r!==0&&4>r?r:4,e(!0);var i=Rb.transition;Rb.transition={};try{e(!1),t()}finally{Gi=r,Rb.transition=i}}function eM(){return Vl().memoizedState}function bN(e,t,r){var i=gd(e);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},rM(e))iM(t,r);else if(r=N4(e,t,r,i),r!==null){var n=Qo();wc(r,e,i,n),nM(r,t,i)}}function wN(e,t,r){var i=gd(e),n={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(rM(e))iM(t,n);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var c=t.lastRenderedState,a=s(c,r);if(n.hasEagerState=!0,n.eagerState=a,Ac(a,c)){var p=t.interleaved;p===null?(n.next=n,D5(t)):(n.next=p.next,p.next=n),t.interleaved=n;return}}catch{}finally{}r=N4(e,t,n,i),r!==null&&(n=Qo(),wc(r,e,i,n),nM(r,t,i))}}function rM(e){var t=e.alternate;return e===Cn||t!==null&&t===Cn}function iM(e,t){$g=p_=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function nM(e,t,r){if(r&4194240){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,x5(e,r)}}var f_={readContext:Gl,useCallback:_o,useContext:_o,useEffect:_o,useImperativeHandle:_o,useInsertionEffect:_o,useLayoutEffect:_o,useMemo:_o,useReducer:_o,useRef:_o,useState:_o,useDebugValue:_o,useDeferredValue:_o,useTransition:_o,useMutableSource:_o,useSyncExternalStore:_o,useId:_o,unstable_isNewReconciler:!1},xN={readContext:Gl,useCallback:function(e,t){return gu().memoizedState=[e,t===void 0?null:t],e},useContext:Gl,useEffect:HE,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,Ty(4194308,4,Y4.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Ty(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ty(4,2,e,t)},useMemo:function(e,t){var r=gu();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var i=gu();return t=r!==void 0?r(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=bN.bind(null,Cn,e),[i.memoizedState,e]},useRef:function(e){var t=gu();return e={current:e},t.memoizedState=e},useState:qE,useDebugValue:H5,useDeferredValue:function(e){return gu().memoizedState=e},useTransition:function(){var e=qE(!1),t=e[0];return e=vN.bind(null,e[1]),gu().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var i=Cn,n=gu();if(vn){if(r===void 0)throw Error(ke(407));r=r()}else{if(r=t(),zs===null)throw Error(ke(349));Cp&30||G4(i,t,r)}n.memoizedState=r;var s={value:r,getSnapshot:t};return n.queue=s,HE(q4.bind(null,i,s,e),[e]),i.flags|=2048,b0(9,V4.bind(null,i,s,r,t),void 0,null),r},useId:function(){var e=gu(),t=zs.identifierPrefix;if(vn){var r=oh,i=sh;r=(i&~(1<<32-bc(i)-1)).toString(32)+r,t=":"+t+"R"+r,r=_0++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=_N++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},SN={readContext:Gl,useCallback:K4,useContext:Gl,useEffect:q5,useImperativeHandle:J4,useInsertionEffect:X4,useLayoutEffect:Z4,useMemo:Q4,useReducer:Fb,useRef:W4,useState:function(){return Fb(v0)},useDebugValue:H5,useDeferredValue:function(e){var t=Vl();return tM(t,bs.memoizedState,e)},useTransition:function(){var e=Fb(v0)[0],t=Vl().memoizedState;return[e,t]},useMutableSource:j4,useSyncExternalStore:U4,useId:eM,unstable_isNewReconciler:!1},AN={readContext:Gl,useCallback:K4,useContext:Gl,useEffect:q5,useImperativeHandle:J4,useInsertionEffect:X4,useLayoutEffect:Z4,useMemo:Q4,useReducer:Db,useRef:W4,useState:function(){return Db(v0)},useDebugValue:H5,useDeferredValue:function(e){var t=Vl();return bs===null?t.memoizedState=e:tM(t,bs.memoizedState,e)},useTransition:function(){var e=Db(v0)[0],t=Vl().memoizedState;return[e,t]},useMutableSource:j4,useSyncExternalStore:U4,useId:eM,unstable_isNewReconciler:!1};function hc(e,t){if(e&&e.defaultProps){t=Pn({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function Rw(e,t,r,i){t=e.memoizedState,r=r(i,t),r=r==null?t:Pn({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Q_={isMounted:function(e){return(e=e._reactInternals)?Dp(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var i=Qo(),n=gd(e),s=hh(i,n);s.payload=t,r!=null&&(s.callback=r),t=fd(e,s,n),t!==null&&(wc(t,e,n,i),Ay(t,e,n))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var i=Qo(),n=gd(e),s=hh(i,n);s.tag=1,s.payload=t,r!=null&&(s.callback=r),t=fd(e,s,n),t!==null&&(wc(t,e,n,i),Ay(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Qo(),i=gd(e),n=hh(r,i);n.tag=2,t!=null&&(n.callback=t),t=fd(e,n,i),t!==null&&(wc(t,e,i,r),Ay(t,e,i))}};function $E(e,t,r,i,n,s,c){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,s,c):t.prototype&&t.prototype.isPureReactComponent?!d0(r,i)||!d0(n,s):!0}function sM(e,t,r){var i=!1,n=wd,s=t.contextType;return typeof s=="object"&&s!==null?s=Gl(s):(n=Aa(t)?Ep:Io.current,i=t.contextTypes,s=(i=i!=null)?lm(e,n):wd),t=new t(r,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Q_,e.stateNode=t,t._reactInternals=e,i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=s),t}function WE(e,t,r,i){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,i),t.state!==e&&Q_.enqueueReplaceState(t,t.state,null)}function Fw(e,t,r,i){var n=e.stateNode;n.props=r,n.state=e.memoizedState,n.refs={},N5(e);var s=t.contextType;typeof s=="object"&&s!==null?n.context=Gl(s):(s=Aa(t)?Ep:Io.current,n.context=lm(e,s)),n.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(Rw(e,t,s,r),n.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(t=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),t!==n.state&&Q_.enqueueReplaceState(n,n.state,null),h_(e,r,n,i),n.state=e.memoizedState),typeof n.componentDidMount=="function"&&(e.flags|=4194308)}function dm(e,t){try{var r="",i=t;do r+=KD(i),i=i.return;while(i);var n=r}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:n,digest:null}}function Nb(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function Dw(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var EN=typeof WeakMap=="function"?WeakMap:Map;function oM(e,t,r){r=hh(-1,r),r.tag=3,r.payload={element:null};var i=t.value;return r.callback=function(){g_||(g_=!0,$w=i),Dw(e,t)},r}function aM(e,t,r){r=hh(-1,r),r.tag=3;var i=e.type.getDerivedStateFromError;if(typeof i=="function"){var n=t.value;r.payload=function(){return i(n)},r.callback=function(){Dw(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){Dw(e,t),typeof i!="function"&&(md===null?md=new Set([this]):md.add(this));var c=t.stack;this.componentDidCatch(t.value,{componentStack:c!==null?c:""})}),r}function XE(e,t,r){var i=e.pingCache;if(i===null){i=e.pingCache=new EN;var n=new Set;i.set(t,n)}else n=i.get(t),n===void 0&&(n=new Set,i.set(t,n));n.has(r)||(n.add(r),e=zN.bind(null,e,t,r),t.then(e,e))}function ZE(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function YE(e,t,r,i,n){return e.mode&1?(e.flags|=65536,e.lanes=n,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=hh(-1,1),t.tag=2,fd(r,t,1))),r.lanes|=1),e)}var TN=xh.ReactCurrentOwner,ba=!1;function Zo(e,t,r,i){t.child=e===null?D4(t,null,r,i):um(t,e.child,r,i)}function JE(e,t,r,i,n){r=r.render;var s=t.ref;return Xf(t,n),i=G5(e,t,r,i,s,n),r=V5(),e!==null&&!ba?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,yh(e,t,n)):(vn&&r&&L5(t),t.flags|=1,Zo(e,t,i,n),t.child)}function KE(e,t,r,i,n){if(e===null){var s=r.type;return typeof s=="function"&&!Q5(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=s,lM(e,t,s,i,n)):(e=Ly(r.type,null,i,t,t.mode,n),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&n)){var c=s.memoizedProps;if(r=r.compare,r=r!==null?r:d0,r(c,i)&&e.ref===t.ref)return yh(e,t,n)}return t.flags|=1,e=yd(s,i),e.ref=t.ref,e.return=t,t.child=e}function lM(e,t,r,i,n){if(e!==null){var s=e.memoizedProps;if(d0(s,i)&&e.ref===t.ref)if(ba=!1,t.pendingProps=i=s,(e.lanes&n)!==0)e.flags&131072&&(ba=!0);else return t.lanes=e.lanes,yh(e,t,n)}return Nw(e,t,r,i,n)}function cM(e,t,r){var i=t.pendingProps,n=i.children,s=e!==null?e.memoizedState:null;if(i.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},sn(Nf,tl),tl|=r;else{if(!(r&1073741824))return e=s!==null?s.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,sn(Nf,tl),tl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:r,sn(Nf,tl),tl|=i}else s!==null?(i=s.baseLanes|r,t.memoizedState=null):i=r,sn(Nf,tl),tl|=i;return Zo(e,t,n,r),t.child}function uM(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function Nw(e,t,r,i,n){var s=Aa(r)?Ep:Io.current;return s=lm(t,s),Xf(t,n),r=G5(e,t,r,i,s,n),i=V5(),e!==null&&!ba?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,yh(e,t,n)):(vn&&i&&L5(t),t.flags|=1,Zo(e,t,r,n),t.child)}function QE(e,t,r,i,n){if(Aa(r)){var s=!0;o_(t)}else s=!1;if(Xf(t,n),t.stateNode===null)Cy(e,t),sM(t,r,i),Fw(t,r,i,n),i=!0;else if(e===null){var c=t.stateNode,a=t.memoizedProps;c.props=a;var p=c.context,_=r.contextType;typeof _=="object"&&_!==null?_=Gl(_):(_=Aa(r)?Ep:Io.current,_=lm(t,_));var w=r.getDerivedStateFromProps,S=typeof w=="function"||typeof c.getSnapshotBeforeUpdate=="function";S||typeof c.UNSAFE_componentWillReceiveProps!="function"&&typeof c.componentWillReceiveProps!="function"||(a!==i||p!==_)&&WE(t,c,i,_),ed=!1;var C=t.memoizedState;c.state=C,h_(t,i,c,n),p=t.memoizedState,a!==i||C!==p||Sa.current||ed?(typeof w=="function"&&(Rw(t,r,w,i),p=t.memoizedState),(a=ed||$E(t,r,a,i,C,p,_))?(S||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount()),typeof c.componentDidMount=="function"&&(t.flags|=4194308)):(typeof c.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=p),c.props=i,c.state=p,c.context=_,i=a):(typeof c.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{c=t.stateNode,O4(e,t),a=t.memoizedProps,_=t.type===t.elementType?a:hc(t.type,a),c.props=_,S=t.pendingProps,C=c.context,p=r.contextType,typeof p=="object"&&p!==null?p=Gl(p):(p=Aa(r)?Ep:Io.current,p=lm(t,p));var I=r.getDerivedStateFromProps;(w=typeof I=="function"||typeof c.getSnapshotBeforeUpdate=="function")||typeof c.UNSAFE_componentWillReceiveProps!="function"&&typeof c.componentWillReceiveProps!="function"||(a!==S||C!==p)&&WE(t,c,i,p),ed=!1,C=t.memoizedState,c.state=C,h_(t,i,c,n);var N=t.memoizedState;a!==S||C!==N||Sa.current||ed?(typeof I=="function"&&(Rw(t,r,I,i),N=t.memoizedState),(_=ed||$E(t,r,_,i,C,N,p)||!1)?(w||typeof c.UNSAFE_componentWillUpdate!="function"&&typeof c.componentWillUpdate!="function"||(typeof c.componentWillUpdate=="function"&&c.componentWillUpdate(i,N,p),typeof c.UNSAFE_componentWillUpdate=="function"&&c.UNSAFE_componentWillUpdate(i,N,p)),typeof c.componentDidUpdate=="function"&&(t.flags|=4),typeof c.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof c.componentDidUpdate!="function"||a===e.memoizedProps&&C===e.memoizedState||(t.flags|=4),typeof c.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&C===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=N),c.props=i,c.state=N,c.context=p,i=_):(typeof c.componentDidUpdate!="function"||a===e.memoizedProps&&C===e.memoizedState||(t.flags|=4),typeof c.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&C===e.memoizedState||(t.flags|=1024),i=!1)}return Ow(e,t,r,i,s,n)}function Ow(e,t,r,i,n,s){uM(e,t);var c=(t.flags&128)!==0;if(!i&&!c)return n&&OE(t,r,!1),yh(e,t,s);i=t.stateNode,TN.current=t;var a=c&&typeof r.getDerivedStateFromError!="function"?null:i.render();return t.flags|=1,e!==null&&c?(t.child=um(t,e.child,null,s),t.child=um(t,null,a,s)):Zo(e,t,a,s),t.memoizedState=i.state,n&&OE(t,r,!0),t.child}function hM(e){var t=e.stateNode;t.pendingContext?NE(e,t.pendingContext,t.pendingContext!==t.context):t.context&&NE(e,t.context,!1),O5(e,t.containerInfo)}function tT(e,t,r,i,n){return cm(),B5(n),t.flags|=256,Zo(e,t,r,i),t.child}var zw={dehydrated:null,treeContext:null,retryLane:0};function jw(e){return{baseLanes:e,cachePool:null,transitions:null}}function dM(e,t,r){var i=t.pendingProps,n=En.current,s=!1,c=(t.flags&128)!==0,a;if((a=c)||(a=e!==null&&e.memoizedState===null?!1:(n&2)!==0),a?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(n|=1),sn(En,n&1),e===null)return Bw(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(c=i.children,e=i.fallback,s?(i=t.mode,s=t.child,c={mode:"hidden",children:c},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=c):s=rv(c,i,0,null),e=bp(e,i,r,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=jw(r),t.memoizedState=zw,e):$5(t,c));if(n=e.memoizedState,n!==null&&(a=n.dehydrated,a!==null))return CN(e,t,c,i,a,n,r);if(s){s=i.fallback,c=t.mode,n=e.child,a=n.sibling;var p={mode:"hidden",children:i.children};return!(c&1)&&t.child!==n?(i=t.child,i.childLanes=0,i.pendingProps=p,t.deletions=null):(i=yd(n,p),i.subtreeFlags=n.subtreeFlags&14680064),a!==null?s=yd(a,s):(s=bp(s,c,r,null),s.flags|=2),s.return=t,i.return=t,i.sibling=s,t.child=i,i=s,s=t.child,c=e.child.memoizedState,c=c===null?jw(r):{baseLanes:c.baseLanes|r,cachePool:null,transitions:c.transitions},s.memoizedState=c,s.childLanes=e.childLanes&~r,t.memoizedState=zw,i}return s=e.child,e=s.sibling,i=yd(s,{mode:"visible",children:i.children}),!(t.mode&1)&&(i.lanes=r),i.return=t,i.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=i,t.memoizedState=null,i}function $5(e,t){return t=rv({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function N1(e,t,r,i){return i!==null&&B5(i),um(t,e.child,null,r),e=$5(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function CN(e,t,r,i,n,s,c){if(r)return t.flags&256?(t.flags&=-257,i=Nb(Error(ke(422))),N1(e,t,c,i)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=i.fallback,n=t.mode,i=rv({mode:"visible",children:i.children},n,0,null),s=bp(s,n,c,null),s.flags|=2,i.return=t,s.return=t,i.sibling=s,t.child=i,t.mode&1&&um(t,e.child,null,c),t.child.memoizedState=jw(c),t.memoizedState=zw,s);if(!(t.mode&1))return N1(e,t,c,null);if(n.data==="$!"){if(i=n.nextSibling&&n.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(ke(419)),i=Nb(s,i,void 0),N1(e,t,c,i)}if(a=(c&e.childLanes)!==0,ba||a){if(i=zs,i!==null){switch(c&-c){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(i.suspendedLanes|c)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,gh(e,n),wc(i,e,n,-1))}return K5(),i=Nb(Error(ke(421))),N1(e,t,c,i)}return n.data==="$?"?(t.flags|=128,t.child=e.child,t=jN.bind(null,e),n._reactRetry=t,null):(e=s.treeContext,rl=pd(n.nextSibling),nl=t,vn=!0,mc=null,e!==null&&(Rl[Fl++]=sh,Rl[Fl++]=oh,Rl[Fl++]=Tp,sh=e.id,oh=e.overflow,Tp=t),t=$5(t,i.children),t.flags|=4096,t)}function eT(e,t,r){e.lanes|=t;var i=e.alternate;i!==null&&(i.lanes|=t),kw(e.return,t,r)}function Ob(e,t,r,i,n){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:n}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=r,s.tailMode=n)}function pM(e,t,r){var i=t.pendingProps,n=i.revealOrder,s=i.tail;if(Zo(e,t,i.children,r),i=En.current,i&2)i=i&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)t:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&eT(e,r,t);else if(e.tag===19)eT(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break t;for(;e.sibling===null;){if(e.return===null||e.return===t)break t;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(sn(En,i),!(t.mode&1))t.memoizedState=null;else switch(n){case"forwards":for(r=t.child,n=null;r!==null;)e=r.alternate,e!==null&&d_(e)===null&&(n=r),r=r.sibling;r=n,r===null?(n=t.child,t.child=null):(n=r.sibling,r.sibling=null),Ob(t,!1,n,r,s);break;case"backwards":for(r=null,n=t.child,t.child=null;n!==null;){if(e=n.alternate,e!==null&&d_(e)===null){t.child=n;break}e=n.sibling,n.sibling=r,r=n,n=e}Ob(t,!0,r,null,s);break;case"together":Ob(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Cy(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function yh(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Pp|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(ke(153));if(t.child!==null){for(e=t.child,r=yd(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=yd(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function PN(e,t,r){switch(t.tag){case 3:hM(t),cm();break;case 5:z4(t);break;case 1:Aa(t.type)&&o_(t);break;case 4:O5(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,n=t.memoizedProps.value;sn(c_,i._currentValue),i._currentValue=n;break;case 13:if(i=t.memoizedState,i!==null)return i.dehydrated!==null?(sn(En,En.current&1),t.flags|=128,null):r&t.child.childLanes?dM(e,t,r):(sn(En,En.current&1),e=yh(e,t,r),e!==null?e.sibling:null);sn(En,En.current&1);break;case 19:if(i=(r&t.childLanes)!==0,e.flags&128){if(i)return pM(e,t,r);t.flags|=128}if(n=t.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),sn(En,En.current),i)break;return null;case 22:case 23:return t.lanes=0,cM(e,t,r)}return yh(e,t,r)}var fM,Uw,mM,gM;fM=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};Uw=function(){};mM=function(e,t,r,i){var n=e.memoizedProps;if(n!==i){e=t.stateNode,pp(Eu.current);var s=null;switch(r){case"input":n=cw(e,n),i=cw(e,i),s=[];break;case"select":n=Pn({},n,{value:void 0}),i=Pn({},i,{value:void 0}),s=[];break;case"textarea":n=dw(e,n),i=dw(e,i),s=[];break;default:typeof n.onClick!="function"&&typeof i.onClick=="function"&&(e.onclick=n_)}fw(r,i);var c;r=null;for(_ in n)if(!i.hasOwnProperty(_)&&n.hasOwnProperty(_)&&n[_]!=null)if(_==="style"){var a=n[_];for(c in a)a.hasOwnProperty(c)&&(r||(r={}),r[c]="")}else _!=="dangerouslySetInnerHTML"&&_!=="children"&&_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(s0.hasOwnProperty(_)?s||(s=[]):(s=s||[]).push(_,null));for(_ in i){var p=i[_];if(a=n!=null?n[_]:void 0,i.hasOwnProperty(_)&&p!==a&&(p!=null||a!=null))if(_==="style")if(a){for(c in a)!a.hasOwnProperty(c)||p&&p.hasOwnProperty(c)||(r||(r={}),r[c]="");for(c in p)p.hasOwnProperty(c)&&a[c]!==p[c]&&(r||(r={}),r[c]=p[c])}else r||(s||(s=[]),s.push(_,r)),r=p;else _==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,a=a?a.__html:void 0,p!=null&&a!==p&&(s=s||[]).push(_,p)):_==="children"?typeof p!="string"&&typeof p!="number"||(s=s||[]).push(_,""+p):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&(s0.hasOwnProperty(_)?(p!=null&&_==="onScroll"&&fn("scroll",e),s||a===p||(s=[])):(s=s||[]).push(_,p))}r&&(s=s||[]).push("style",r);var _=s;(t.updateQueue=_)&&(t.flags|=4)}};gM=function(e,t,r,i){r!==i&&(t.flags|=4)};function pg(e,t){if(!vn)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function vo(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,i=0;if(t)for(var n=e.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags&14680064,i|=n.flags&14680064,n.return=e,n=n.sibling;else for(n=e.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags,i|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=i,e.childLanes=r,t}function IN(e,t,r){var i=t.pendingProps;switch(M5(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return vo(t),null;case 1:return Aa(t.type)&&s_(),vo(t),null;case 3:return i=t.stateNode,hm(),gn(Sa),gn(Io),j5(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(F1(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,mc!==null&&(Zw(mc),mc=null))),Uw(e,t),vo(t),null;case 5:z5(t);var n=pp(y0.current);if(r=t.type,e!==null&&t.stateNode!=null)mM(e,t,r,i,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(t.stateNode===null)throw Error(ke(166));return vo(t),null}if(e=pp(Eu.current),F1(t)){i=t.stateNode,r=t.type;var s=t.memoizedProps;switch(i[yu]=t,i[m0]=s,e=(t.mode&1)!==0,r){case"dialog":fn("cancel",i),fn("close",i);break;case"iframe":case"object":case"embed":fn("load",i);break;case"video":case"audio":for(n=0;n<Dg.length;n++)fn(Dg[n],i);break;case"source":fn("error",i);break;case"img":case"image":case"link":fn("error",i),fn("load",i);break;case"details":fn("toggle",i);break;case"input":uE(i,s),fn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},fn("invalid",i);break;case"textarea":dE(i,s),fn("invalid",i)}fw(r,s),n=null;for(var c in s)if(s.hasOwnProperty(c)){var a=s[c];c==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&R1(i.textContent,a,e),n=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&R1(i.textContent,a,e),n=["children",""+a]):s0.hasOwnProperty(c)&&a!=null&&c==="onScroll"&&fn("scroll",i)}switch(r){case"input":T1(i),hE(i,s,!0);break;case"textarea":T1(i),pE(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=n_)}i=n,t.updateQueue=i,i!==null&&(t.flags|=4)}else{c=n.nodeType===9?n:n.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=qL(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=c.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof i.is=="string"?e=c.createElement(r,{is:i.is}):(e=c.createElement(r),r==="select"&&(c=e,i.multiple?c.multiple=!0:i.size&&(c.size=i.size))):e=c.createElementNS(e,r),e[yu]=t,e[m0]=i,fM(e,t,!1,!1),t.stateNode=e;t:{switch(c=mw(r,i),r){case"dialog":fn("cancel",e),fn("close",e),n=i;break;case"iframe":case"object":case"embed":fn("load",e),n=i;break;case"video":case"audio":for(n=0;n<Dg.length;n++)fn(Dg[n],e);n=i;break;case"source":fn("error",e),n=i;break;case"img":case"image":case"link":fn("error",e),fn("load",e),n=i;break;case"details":fn("toggle",e),n=i;break;case"input":uE(e,i),n=cw(e,i),fn("invalid",e);break;case"option":n=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},n=Pn({},i,{value:void 0}),fn("invalid",e);break;case"textarea":dE(e,i),n=dw(e,i),fn("invalid",e);break;default:n=i}fw(r,n),a=n;for(s in a)if(a.hasOwnProperty(s)){var p=a[s];s==="style"?WL(e,p):s==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,p!=null&&HL(e,p)):s==="children"?typeof p=="string"?(r!=="textarea"||p!=="")&&o0(e,p):typeof p=="number"&&o0(e,""+p):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(s0.hasOwnProperty(s)?p!=null&&s==="onScroll"&&fn("scroll",e):p!=null&&g5(e,s,p,c))}switch(r){case"input":T1(e),hE(e,i,!1);break;case"textarea":T1(e),pE(e);break;case"option":i.value!=null&&e.setAttribute("value",""+bd(i.value));break;case"select":e.multiple=!!i.multiple,s=i.value,s!=null?qf(e,!!i.multiple,s,!1):i.defaultValue!=null&&qf(e,!!i.multiple,i.defaultValue,!0);break;default:typeof n.onClick=="function"&&(e.onclick=n_)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break t;case"img":i=!0;break t;default:i=!1}}i&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return vo(t),null;case 6:if(e&&t.stateNode!=null)gM(e,t,e.memoizedProps,i);else{if(typeof i!="string"&&t.stateNode===null)throw Error(ke(166));if(r=pp(y0.current),pp(Eu.current),F1(t)){if(i=t.stateNode,r=t.memoizedProps,i[yu]=t,(s=i.nodeValue!==r)&&(e=nl,e!==null))switch(e.tag){case 3:R1(i.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&R1(i.nodeValue,r,(e.mode&1)!==0)}s&&(t.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[yu]=t,t.stateNode=i}return vo(t),null;case 13:if(gn(En),i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(vn&&rl!==null&&t.mode&1&&!(t.flags&128))R4(),cm(),t.flags|=98560,s=!1;else if(s=F1(t),i!==null&&i.dehydrated!==null){if(e===null){if(!s)throw Error(ke(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ke(317));s[yu]=t}else cm(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;vo(t),s=!1}else mc!==null&&(Zw(mc),mc=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(i=i!==null,i!==(e!==null&&e.memoizedState!==null)&&i&&(t.child.flags|=8192,t.mode&1&&(e===null||En.current&1?ws===0&&(ws=3):K5())),t.updateQueue!==null&&(t.flags|=4),vo(t),null);case 4:return hm(),Uw(e,t),e===null&&p0(t.stateNode.containerInfo),vo(t),null;case 10:return F5(t.type._context),vo(t),null;case 17:return Aa(t.type)&&s_(),vo(t),null;case 19:if(gn(En),s=t.memoizedState,s===null)return vo(t),null;if(i=(t.flags&128)!==0,c=s.rendering,c===null)if(i)pg(s,!1);else{if(ws!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(c=d_(e),c!==null){for(t.flags|=128,pg(s,!1),i=c.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=r,r=t.child;r!==null;)s=r,e=i,s.flags&=14680066,c=s.alternate,c===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,e=c.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return sn(En,En.current&1|2),t.child}e=e.sibling}s.tail!==null&&Hn()>pm&&(t.flags|=128,i=!0,pg(s,!1),t.lanes=4194304)}else{if(!i)if(e=d_(c),e!==null){if(t.flags|=128,i=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),pg(s,!0),s.tail===null&&s.tailMode==="hidden"&&!c.alternate&&!vn)return vo(t),null}else 2*Hn()-s.renderingStartTime>pm&&r!==1073741824&&(t.flags|=128,i=!0,pg(s,!1),t.lanes=4194304);s.isBackwards?(c.sibling=t.child,t.child=c):(r=s.last,r!==null?r.sibling=c:t.child=c,s.last=c)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Hn(),t.sibling=null,r=En.current,sn(En,i?r&1|2:r&1),t):(vo(t),null);case 22:case 23:return J5(),i=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==i&&(t.flags|=8192),i&&t.mode&1?tl&1073741824&&(vo(t),t.subtreeFlags&6&&(t.flags|=8192)):vo(t),null;case 24:return null;case 25:return null}throw Error(ke(156,t.tag))}function LN(e,t){switch(M5(t),t.tag){case 1:return Aa(t.type)&&s_(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return hm(),gn(Sa),gn(Io),j5(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return z5(t),null;case 13:if(gn(En),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ke(340));cm()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return gn(En),null;case 4:return hm(),null;case 10:return F5(t.type._context),null;case 22:case 23:return J5(),null;case 24:return null;default:return null}}var O1=!1,Co=!1,MN=typeof WeakSet=="function"?WeakSet:Set,lr=null;function Df(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){zn(e,t,i)}else r.current=null}function Gw(e,t,r){try{r()}catch(i){zn(e,t,i)}}var rT=!1;function BN(e,t){if(Ew=e_,e=w4(),I5(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else t:{r=(r=e.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var n=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break t}var c=0,a=-1,p=-1,_=0,w=0,S=e,C=null;e:for(;;){for(var I;S!==r||n!==0&&S.nodeType!==3||(a=c+n),S!==s||i!==0&&S.nodeType!==3||(p=c+i),S.nodeType===3&&(c+=S.nodeValue.length),(I=S.firstChild)!==null;)C=S,S=I;for(;;){if(S===e)break e;if(C===r&&++_===n&&(a=c),C===s&&++w===i&&(p=c),(I=S.nextSibling)!==null)break;S=C,C=S.parentNode}S=I}r=a===-1||p===-1?null:{start:a,end:p}}else r=null}r=r||{start:0,end:0}}else r=null;for(Tw={focusedElem:e,selectionRange:r},e_=!1,lr=t;lr!==null;)if(t=lr,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,lr=e;else for(;lr!==null;){t=lr;try{var N=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(N!==null){var F=N.memoizedProps,W=N.memoizedState,U=t.stateNode,z=U.getSnapshotBeforeUpdate(t.elementType===t.type?F:hc(t.type,F),W);U.__reactInternalSnapshotBeforeUpdate=z}break;case 3:var H=t.stateNode.containerInfo;H.nodeType===1?H.textContent="":H.nodeType===9&&H.documentElement&&H.removeChild(H.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ke(163))}}catch(nt){zn(t,t.return,nt)}if(e=t.sibling,e!==null){e.return=t.return,lr=e;break}lr=t.return}return N=rT,rT=!1,N}function Wg(e,t,r){var i=t.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var n=i=i.next;do{if((n.tag&e)===e){var s=n.destroy;n.destroy=void 0,s!==void 0&&Gw(t,r,s)}n=n.next}while(n!==i)}}function tv(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var i=r.create;r.destroy=i()}r=r.next}while(r!==t)}}function Vw(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function yM(e){var t=e.alternate;t!==null&&(e.alternate=null,yM(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[yu],delete t[m0],delete t[Iw],delete t[fN],delete t[mN])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function _M(e){return e.tag===5||e.tag===3||e.tag===4}function iT(e){t:for(;;){for(;e.sibling===null;){if(e.return===null||_M(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue t;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function qw(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=n_));else if(i!==4&&(e=e.child,e!==null))for(qw(e,t,r),e=e.sibling;e!==null;)qw(e,t,r),e=e.sibling}function Hw(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(i!==4&&(e=e.child,e!==null))for(Hw(e,t,r),e=e.sibling;e!==null;)Hw(e,t,r),e=e.sibling}var Ks=null,pc=!1;function Vh(e,t,r){for(r=r.child;r!==null;)vM(e,t,r),r=r.sibling}function vM(e,t,r){if(Au&&typeof Au.onCommitFiberUnmount=="function")try{Au.onCommitFiberUnmount($_,r)}catch{}switch(r.tag){case 5:Co||Df(r,t);case 6:var i=Ks,n=pc;Ks=null,Vh(e,t,r),Ks=i,pc=n,Ks!==null&&(pc?(e=Ks,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Ks.removeChild(r.stateNode));break;case 18:Ks!==null&&(pc?(e=Ks,r=r.stateNode,e.nodeType===8?Mb(e.parentNode,r):e.nodeType===1&&Mb(e,r),u0(e)):Mb(Ks,r.stateNode));break;case 4:i=Ks,n=pc,Ks=r.stateNode.containerInfo,pc=!0,Vh(e,t,r),Ks=i,pc=n;break;case 0:case 11:case 14:case 15:if(!Co&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){n=i=i.next;do{var s=n,c=s.destroy;s=s.tag,c!==void 0&&(s&2||s&4)&&Gw(r,t,c),n=n.next}while(n!==i)}Vh(e,t,r);break;case 1:if(!Co&&(Df(r,t),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(a){zn(r,t,a)}Vh(e,t,r);break;case 21:Vh(e,t,r);break;case 22:r.mode&1?(Co=(i=Co)||r.memoizedState!==null,Vh(e,t,r),Co=i):Vh(e,t,r);break;default:Vh(e,t,r)}}function nT(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new MN),t.forEach(function(i){var n=UN.bind(null,e,i);r.has(i)||(r.add(i),i.then(n,n))})}}function ac(e,t){var r=t.deletions;if(r!==null)for(var i=0;i<r.length;i++){var n=r[i];try{var s=e,c=t,a=c;t:for(;a!==null;){switch(a.tag){case 5:Ks=a.stateNode,pc=!1;break t;case 3:Ks=a.stateNode.containerInfo,pc=!0;break t;case 4:Ks=a.stateNode.containerInfo,pc=!0;break t}a=a.return}if(Ks===null)throw Error(ke(160));vM(s,c,n),Ks=null,pc=!1;var p=n.alternate;p!==null&&(p.return=null),n.return=null}catch(_){zn(n,t,_)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)bM(t,e),t=t.sibling}function bM(e,t){var r=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ac(t,e),cu(e),i&4){try{Wg(3,e,e.return),tv(3,e)}catch(F){zn(e,e.return,F)}try{Wg(5,e,e.return)}catch(F){zn(e,e.return,F)}}break;case 1:ac(t,e),cu(e),i&512&&r!==null&&Df(r,r.return);break;case 5:if(ac(t,e),cu(e),i&512&&r!==null&&Df(r,r.return),e.flags&32){var n=e.stateNode;try{o0(n,"")}catch(F){zn(e,e.return,F)}}if(i&4&&(n=e.stateNode,n!=null)){var s=e.memoizedProps,c=r!==null?r.memoizedProps:s,a=e.type,p=e.updateQueue;if(e.updateQueue=null,p!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&UL(n,s),mw(a,c);var _=mw(a,s);for(c=0;c<p.length;c+=2){var w=p[c],S=p[c+1];w==="style"?WL(n,S):w==="dangerouslySetInnerHTML"?HL(n,S):w==="children"?o0(n,S):g5(n,w,S,_)}switch(a){case"input":uw(n,s);break;case"textarea":VL(n,s);break;case"select":var C=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var I=s.value;I!=null?qf(n,!!s.multiple,I,!1):C!==!!s.multiple&&(s.defaultValue!=null?qf(n,!!s.multiple,s.defaultValue,!0):qf(n,!!s.multiple,s.multiple?[]:"",!1))}n[m0]=s}catch(F){zn(e,e.return,F)}}break;case 6:if(ac(t,e),cu(e),i&4){if(e.stateNode===null)throw Error(ke(162));n=e.stateNode,s=e.memoizedProps;try{n.nodeValue=s}catch(F){zn(e,e.return,F)}}break;case 3:if(ac(t,e),cu(e),i&4&&r!==null&&r.memoizedState.isDehydrated)try{u0(t.containerInfo)}catch(F){zn(e,e.return,F)}break;case 4:ac(t,e),cu(e);break;case 13:ac(t,e),cu(e),n=e.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(Z5=Hn())),i&4&&nT(e);break;case 22:if(w=r!==null&&r.memoizedState!==null,e.mode&1?(Co=(_=Co)||w,ac(t,e),Co=_):ac(t,e),cu(e),i&8192){if(_=e.memoizedState!==null,(e.stateNode.isHidden=_)&&!w&&e.mode&1)for(lr=e,w=e.child;w!==null;){for(S=lr=w;lr!==null;){switch(C=lr,I=C.child,C.tag){case 0:case 11:case 14:case 15:Wg(4,C,C.return);break;case 1:Df(C,C.return);var N=C.stateNode;if(typeof N.componentWillUnmount=="function"){i=C,r=C.return;try{t=i,N.props=t.memoizedProps,N.state=t.memoizedState,N.componentWillUnmount()}catch(F){zn(i,r,F)}}break;case 5:Df(C,C.return);break;case 22:if(C.memoizedState!==null){oT(S);continue}}I!==null?(I.return=C,lr=I):oT(S)}w=w.sibling}t:for(w=null,S=e;;){if(S.tag===5){if(w===null){w=S;try{n=S.stateNode,_?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=S.stateNode,p=S.memoizedProps.style,c=p!=null&&p.hasOwnProperty("display")?p.display:null,a.style.display=$L("display",c))}catch(F){zn(e,e.return,F)}}}else if(S.tag===6){if(w===null)try{S.stateNode.nodeValue=_?"":S.memoizedProps}catch(F){zn(e,e.return,F)}}else if((S.tag!==22&&S.tag!==23||S.memoizedState===null||S===e)&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===e)break t;for(;S.sibling===null;){if(S.return===null||S.return===e)break t;w===S&&(w=null),S=S.return}w===S&&(w=null),S.sibling.return=S.return,S=S.sibling}}break;case 19:ac(t,e),cu(e),i&4&&nT(e);break;case 21:break;default:ac(t,e),cu(e)}}function cu(e){var t=e.flags;if(t&2){try{t:{for(var r=e.return;r!==null;){if(_M(r)){var i=r;break t}r=r.return}throw Error(ke(160))}switch(i.tag){case 5:var n=i.stateNode;i.flags&32&&(o0(n,""),i.flags&=-33);var s=iT(e);Hw(e,s,n);break;case 3:case 4:var c=i.stateNode.containerInfo,a=iT(e);qw(e,a,c);break;default:throw Error(ke(161))}}catch(p){zn(e,e.return,p)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function kN(e,t,r){lr=e,wM(e)}function wM(e,t,r){for(var i=(e.mode&1)!==0;lr!==null;){var n=lr,s=n.child;if(n.tag===22&&i){var c=n.memoizedState!==null||O1;if(!c){var a=n.alternate,p=a!==null&&a.memoizedState!==null||Co;a=O1;var _=Co;if(O1=c,(Co=p)&&!_)for(lr=n;lr!==null;)c=lr,p=c.child,c.tag===22&&c.memoizedState!==null?aT(n):p!==null?(p.return=c,lr=p):aT(n);for(;s!==null;)lr=s,wM(s),s=s.sibling;lr=n,O1=a,Co=_}sT(e)}else n.subtreeFlags&8772&&s!==null?(s.return=n,lr=s):sT(e)}}function sT(e){for(;lr!==null;){var t=lr;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Co||tv(5,t);break;case 1:var i=t.stateNode;if(t.flags&4&&!Co)if(r===null)i.componentDidMount();else{var n=t.elementType===t.type?r.memoizedProps:hc(t.type,r.memoizedProps);i.componentDidUpdate(n,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&VE(t,s,i);break;case 3:var c=t.updateQueue;if(c!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}VE(t,c,r)}break;case 5:var a=t.stateNode;if(r===null&&t.flags&4){r=a;var p=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":p.autoFocus&&r.focus();break;case"img":p.src&&(r.src=p.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var _=t.alternate;if(_!==null){var w=_.memoizedState;if(w!==null){var S=w.dehydrated;S!==null&&u0(S)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ke(163))}Co||t.flags&512&&Vw(t)}catch(C){zn(t,t.return,C)}}if(t===e){lr=null;break}if(r=t.sibling,r!==null){r.return=t.return,lr=r;break}lr=t.return}}function oT(e){for(;lr!==null;){var t=lr;if(t===e){lr=null;break}var r=t.sibling;if(r!==null){r.return=t.return,lr=r;break}lr=t.return}}function aT(e){for(;lr!==null;){var t=lr;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{tv(4,t)}catch(p){zn(t,r,p)}break;case 1:var i=t.stateNode;if(typeof i.componentDidMount=="function"){var n=t.return;try{i.componentDidMount()}catch(p){zn(t,n,p)}}var s=t.return;try{Vw(t)}catch(p){zn(t,s,p)}break;case 5:var c=t.return;try{Vw(t)}catch(p){zn(t,c,p)}}}catch(p){zn(t,t.return,p)}if(t===e){lr=null;break}var a=t.sibling;if(a!==null){a.return=t.return,lr=a;break}lr=t.return}}var RN=Math.ceil,m_=xh.ReactCurrentDispatcher,W5=xh.ReactCurrentOwner,jl=xh.ReactCurrentBatchConfig,gi=0,zs=null,os=null,to=0,tl=0,Nf=Pd(0),ws=0,w0=null,Pp=0,ev=0,X5=0,Xg=null,_a=null,Z5=0,pm=1/0,eh=null,g_=!1,$w=null,md=null,z1=!1,od=null,y_=0,Zg=0,Ww=null,Py=-1,Iy=0;function Qo(){return gi&6?Hn():Py!==-1?Py:Py=Hn()}function gd(e){return e.mode&1?gi&2&&to!==0?to&-to:yN.transition!==null?(Iy===0&&(Iy=s4()),Iy):(e=Gi,e!==0||(e=window.event,e=e===void 0?16:d4(e.type)),e):1}function wc(e,t,r,i){if(50<Zg)throw Zg=0,Ww=null,Error(ke(185));N0(e,r,i),(!(gi&2)||e!==zs)&&(e===zs&&(!(gi&2)&&(ev|=r),ws===4&&nd(e,to)),Ea(e,i),r===1&&gi===0&&!(t.mode&1)&&(pm=Hn()+500,J_&&Id()))}function Ea(e,t){var r=e.callbackNode;y8(e,t);var i=t_(e,e===zs?to:0);if(i===0)r!==null&&gE(r),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(r!=null&&gE(r),t===1)e.tag===0?gN(lT.bind(null,e)):M4(lT.bind(null,e)),dN(function(){!(gi&6)&&Id()}),r=null;else{switch(o4(i)){case 1:r=w5;break;case 4:r=i4;break;case 16:r=Qy;break;case 536870912:r=n4;break;default:r=Qy}r=IM(r,xM.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function xM(e,t){if(Py=-1,Iy=0,gi&6)throw Error(ke(327));var r=e.callbackNode;if(Zf()&&e.callbackNode!==r)return null;var i=t_(e,e===zs?to:0);if(i===0)return null;if(i&30||i&e.expiredLanes||t)t=__(e,i);else{t=i;var n=gi;gi|=2;var s=AM();(zs!==e||to!==t)&&(eh=null,pm=Hn()+500,vp(e,t));do try{NN();break}catch(a){SM(e,a)}while(1);R5(),m_.current=s,gi=n,os!==null?t=0:(zs=null,to=0,t=ws)}if(t!==0){if(t===2&&(n=bw(e),n!==0&&(i=n,t=Xw(e,n))),t===1)throw r=w0,vp(e,0),nd(e,i),Ea(e,Hn()),r;if(t===6)nd(e,i);else{if(n=e.current.alternate,!(i&30)&&!FN(n)&&(t=__(e,i),t===2&&(s=bw(e),s!==0&&(i=s,t=Xw(e,s))),t===1))throw r=w0,vp(e,0),nd(e,i),Ea(e,Hn()),r;switch(e.finishedWork=n,e.finishedLanes=i,t){case 0:case 1:throw Error(ke(345));case 2:np(e,_a,eh);break;case 3:if(nd(e,i),(i&130023424)===i&&(t=Z5+500-Hn(),10<t)){if(t_(e,0)!==0)break;if(n=e.suspendedLanes,(n&i)!==i){Qo(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=Pw(np.bind(null,e,_a,eh),t);break}np(e,_a,eh);break;case 4:if(nd(e,i),(i&4194240)===i)break;for(t=e.eventTimes,n=-1;0<i;){var c=31-bc(i);s=1<<c,c=t[c],c>n&&(n=c),i&=~s}if(i=n,i=Hn()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*RN(i/1960))-i,10<i){e.timeoutHandle=Pw(np.bind(null,e,_a,eh),i);break}np(e,_a,eh);break;case 5:np(e,_a,eh);break;default:throw Error(ke(329))}}}return Ea(e,Hn()),e.callbackNode===r?xM.bind(null,e):null}function Xw(e,t){var r=Xg;return e.current.memoizedState.isDehydrated&&(vp(e,t).flags|=256),e=__(e,t),e!==2&&(t=_a,_a=r,t!==null&&Zw(t)),e}function Zw(e){_a===null?_a=e:_a.push.apply(_a,e)}function FN(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var n=r[i],s=n.getSnapshot;n=n.value;try{if(!Ac(s(),n))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function nd(e,t){for(t&=~X5,t&=~ev,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-bc(t),i=1<<r;e[r]=-1,t&=~i}}function lT(e){if(gi&6)throw Error(ke(327));Zf();var t=t_(e,0);if(!(t&1))return Ea(e,Hn()),null;var r=__(e,t);if(e.tag!==0&&r===2){var i=bw(e);i!==0&&(t=i,r=Xw(e,i))}if(r===1)throw r=w0,vp(e,0),nd(e,t),Ea(e,Hn()),r;if(r===6)throw Error(ke(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,np(e,_a,eh),Ea(e,Hn()),null}function Y5(e,t){var r=gi;gi|=1;try{return e(t)}finally{gi=r,gi===0&&(pm=Hn()+500,J_&&Id())}}function Ip(e){od!==null&&od.tag===0&&!(gi&6)&&Zf();var t=gi;gi|=1;var r=jl.transition,i=Gi;try{if(jl.transition=null,Gi=1,e)return e()}finally{Gi=i,jl.transition=r,gi=t,!(gi&6)&&Id()}}function J5(){tl=Nf.current,gn(Nf)}function vp(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,hN(r)),os!==null)for(r=os.return;r!==null;){var i=r;switch(M5(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&s_();break;case 3:hm(),gn(Sa),gn(Io),j5();break;case 5:z5(i);break;case 4:hm();break;case 13:gn(En);break;case 19:gn(En);break;case 10:F5(i.type._context);break;case 22:case 23:J5()}r=r.return}if(zs=e,os=e=yd(e.current,null),to=tl=t,ws=0,w0=null,X5=ev=Pp=0,_a=Xg=null,dp!==null){for(t=0;t<dp.length;t++)if(r=dp[t],i=r.interleaved,i!==null){r.interleaved=null;var n=i.next,s=r.pending;if(s!==null){var c=s.next;s.next=n,i.next=c}r.pending=i}dp=null}return e}function SM(e,t){do{var r=os;try{if(R5(),Ey.current=f_,p_){for(var i=Cn.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}p_=!1}if(Cp=0,Fs=bs=Cn=null,$g=!1,_0=0,W5.current=null,r===null||r.return===null){ws=1,w0=t,os=null;break}t:{var s=e,c=r.return,a=r,p=t;if(t=to,a.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){var _=p,w=a,S=w.tag;if(!(w.mode&1)&&(S===0||S===11||S===15)){var C=w.alternate;C?(w.updateQueue=C.updateQueue,w.memoizedState=C.memoizedState,w.lanes=C.lanes):(w.updateQueue=null,w.memoizedState=null)}var I=ZE(c);if(I!==null){I.flags&=-257,YE(I,c,a,s,t),I.mode&1&&XE(s,_,t),t=I,p=_;var N=t.updateQueue;if(N===null){var F=new Set;F.add(p),t.updateQueue=F}else N.add(p);break t}else{if(!(t&1)){XE(s,_,t),K5();break t}p=Error(ke(426))}}else if(vn&&a.mode&1){var W=ZE(c);if(W!==null){!(W.flags&65536)&&(W.flags|=256),YE(W,c,a,s,t),B5(dm(p,a));break t}}s=p=dm(p,a),ws!==4&&(ws=2),Xg===null?Xg=[s]:Xg.push(s),s=c;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var U=oM(s,p,t);GE(s,U);break t;case 1:a=p;var z=s.type,H=s.stateNode;if(!(s.flags&128)&&(typeof z.getDerivedStateFromError=="function"||H!==null&&typeof H.componentDidCatch=="function"&&(md===null||!md.has(H)))){s.flags|=65536,t&=-t,s.lanes|=t;var nt=aM(s,a,t);GE(s,nt);break t}}s=s.return}while(s!==null)}TM(r)}catch(yt){t=yt,os===r&&r!==null&&(os=r=r.return);continue}break}while(1)}function AM(){var e=m_.current;return m_.current=f_,e===null?f_:e}function K5(){(ws===0||ws===3||ws===2)&&(ws=4),zs===null||!(Pp&268435455)&&!(ev&268435455)||nd(zs,to)}function __(e,t){var r=gi;gi|=2;var i=AM();(zs!==e||to!==t)&&(eh=null,vp(e,t));do try{DN();break}catch(n){SM(e,n)}while(1);if(R5(),gi=r,m_.current=i,os!==null)throw Error(ke(261));return zs=null,to=0,ws}function DN(){for(;os!==null;)EM(os)}function NN(){for(;os!==null&&!l8();)EM(os)}function EM(e){var t=PM(e.alternate,e,tl);e.memoizedProps=e.pendingProps,t===null?TM(e):os=t,W5.current=null}function TM(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=LN(r,t),r!==null){r.flags&=32767,os=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{ws=6,os=null;return}}else if(r=IN(r,t,tl),r!==null){os=r;return}if(t=t.sibling,t!==null){os=t;return}os=t=e}while(t!==null);ws===0&&(ws=5)}function np(e,t,r){var i=Gi,n=jl.transition;try{jl.transition=null,Gi=1,ON(e,t,r,i)}finally{jl.transition=n,Gi=i}return null}function ON(e,t,r,i){do Zf();while(od!==null);if(gi&6)throw Error(ke(327));r=e.finishedWork;var n=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(ke(177));e.callbackNode=null,e.callbackPriority=0;var s=r.lanes|r.childLanes;if(_8(e,s),e===zs&&(os=zs=null,to=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||z1||(z1=!0,IM(Qy,function(){return Zf(),null})),s=(r.flags&15990)!==0,r.subtreeFlags&15990||s){s=jl.transition,jl.transition=null;var c=Gi;Gi=1;var a=gi;gi|=4,W5.current=null,BN(e,r),bM(r,e),nN(Tw),e_=!!Ew,Tw=Ew=null,e.current=r,kN(r),c8(),gi=a,Gi=c,jl.transition=s}else e.current=r;if(z1&&(z1=!1,od=e,y_=n),s=e.pendingLanes,s===0&&(md=null),d8(r.stateNode),Ea(e,Hn()),t!==null)for(i=e.onRecoverableError,r=0;r<t.length;r++)n=t[r],i(n.value,{componentStack:n.stack,digest:n.digest});if(g_)throw g_=!1,e=$w,$w=null,e;return y_&1&&e.tag!==0&&Zf(),s=e.pendingLanes,s&1?e===Ww?Zg++:(Zg=0,Ww=e):Zg=0,Id(),null}function Zf(){if(od!==null){var e=o4(y_),t=jl.transition,r=Gi;try{if(jl.transition=null,Gi=16>e?16:e,od===null)var i=!1;else{if(e=od,od=null,y_=0,gi&6)throw Error(ke(331));var n=gi;for(gi|=4,lr=e.current;lr!==null;){var s=lr,c=s.child;if(lr.flags&16){var a=s.deletions;if(a!==null){for(var p=0;p<a.length;p++){var _=a[p];for(lr=_;lr!==null;){var w=lr;switch(w.tag){case 0:case 11:case 15:Wg(8,w,s)}var S=w.child;if(S!==null)S.return=w,lr=S;else for(;lr!==null;){w=lr;var C=w.sibling,I=w.return;if(yM(w),w===_){lr=null;break}if(C!==null){C.return=I,lr=C;break}lr=I}}}var N=s.alternate;if(N!==null){var F=N.child;if(F!==null){N.child=null;do{var W=F.sibling;F.sibling=null,F=W}while(F!==null)}}lr=s}}if(s.subtreeFlags&2064&&c!==null)c.return=s,lr=c;else t:for(;lr!==null;){if(s=lr,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Wg(9,s,s.return)}var U=s.sibling;if(U!==null){U.return=s.return,lr=U;break t}lr=s.return}}var z=e.current;for(lr=z;lr!==null;){c=lr;var H=c.child;if(c.subtreeFlags&2064&&H!==null)H.return=c,lr=H;else t:for(c=z;lr!==null;){if(a=lr,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:tv(9,a)}}catch(yt){zn(a,a.return,yt)}if(a===c){lr=null;break t}var nt=a.sibling;if(nt!==null){nt.return=a.return,lr=nt;break t}lr=a.return}}if(gi=n,Id(),Au&&typeof Au.onPostCommitFiberRoot=="function")try{Au.onPostCommitFiberRoot($_,e)}catch{}i=!0}return i}finally{Gi=r,jl.transition=t}}return!1}function cT(e,t,r){t=dm(r,t),t=oM(e,t,1),e=fd(e,t,1),t=Qo(),e!==null&&(N0(e,1,t),Ea(e,t))}function zn(e,t,r){if(e.tag===3)cT(e,e,r);else for(;t!==null;){if(t.tag===3){cT(t,e,r);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(md===null||!md.has(i))){e=dm(r,e),e=aM(t,e,1),t=fd(t,e,1),e=Qo(),t!==null&&(N0(t,1,e),Ea(t,e));break}}t=t.return}}function zN(e,t,r){var i=e.pingCache;i!==null&&i.delete(t),t=Qo(),e.pingedLanes|=e.suspendedLanes&r,zs===e&&(to&r)===r&&(ws===4||ws===3&&(to&130023424)===to&&500>Hn()-Z5?vp(e,0):X5|=r),Ea(e,t)}function CM(e,t){t===0&&(e.mode&1?(t=I1,I1<<=1,!(I1&130023424)&&(I1=4194304)):t=1);var r=Qo();e=gh(e,t),e!==null&&(N0(e,t,r),Ea(e,r))}function jN(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),CM(e,r)}function UN(e,t){var r=0;switch(e.tag){case 13:var i=e.stateNode,n=e.memoizedState;n!==null&&(r=n.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(ke(314))}i!==null&&i.delete(t),CM(e,r)}var PM;PM=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Sa.current)ba=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return ba=!1,PN(e,t,r);ba=!!(e.flags&131072)}else ba=!1,vn&&t.flags&1048576&&B4(t,l_,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Cy(e,t),e=t.pendingProps;var n=lm(t,Io.current);Xf(t,r),n=G5(null,t,i,e,n,r);var s=V5();return t.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Aa(i)?(s=!0,o_(t)):s=!1,t.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,N5(t),n.updater=Q_,t.stateNode=n,n._reactInternals=t,Fw(t,i,e,r),t=Ow(null,t,i,!0,s,r)):(t.tag=0,vn&&s&&L5(t),Zo(null,t,n,r),t=t.child),t;case 16:i=t.elementType;t:{switch(Cy(e,t),e=t.pendingProps,n=i._init,i=n(i._payload),t.type=i,n=t.tag=VN(i),e=hc(i,e),n){case 0:t=Nw(null,t,i,e,r);break t;case 1:t=QE(null,t,i,e,r);break t;case 11:t=JE(null,t,i,e,r);break t;case 14:t=KE(null,t,i,hc(i.type,e),r);break t}throw Error(ke(306,i,""))}return t;case 0:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:hc(i,n),Nw(e,t,i,n,r);case 1:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:hc(i,n),QE(e,t,i,n,r);case 3:t:{if(hM(t),e===null)throw Error(ke(387));i=t.pendingProps,s=t.memoizedState,n=s.element,O4(e,t),h_(t,i,null,r);var c=t.memoizedState;if(i=c.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:c.cache,pendingSuspenseBoundaries:c.pendingSuspenseBoundaries,transitions:c.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){n=dm(Error(ke(423)),t),t=tT(e,t,i,r,n);break t}else if(i!==n){n=dm(Error(ke(424)),t),t=tT(e,t,i,r,n);break t}else for(rl=pd(t.stateNode.containerInfo.firstChild),nl=t,vn=!0,mc=null,r=D4(t,null,i,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(cm(),i===n){t=yh(e,t,r);break t}Zo(e,t,i,r)}t=t.child}return t;case 5:return z4(t),e===null&&Bw(t),i=t.type,n=t.pendingProps,s=e!==null?e.memoizedProps:null,c=n.children,Cw(i,n)?c=null:s!==null&&Cw(i,s)&&(t.flags|=32),uM(e,t),Zo(e,t,c,r),t.child;case 6:return e===null&&Bw(t),null;case 13:return dM(e,t,r);case 4:return O5(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=um(t,null,i,r):Zo(e,t,i,r),t.child;case 11:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:hc(i,n),JE(e,t,i,n,r);case 7:return Zo(e,t,t.pendingProps,r),t.child;case 8:return Zo(e,t,t.pendingProps.children,r),t.child;case 12:return Zo(e,t,t.pendingProps.children,r),t.child;case 10:t:{if(i=t.type._context,n=t.pendingProps,s=t.memoizedProps,c=n.value,sn(c_,i._currentValue),i._currentValue=c,s!==null)if(Ac(s.value,c)){if(s.children===n.children&&!Sa.current){t=yh(e,t,r);break t}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var a=s.dependencies;if(a!==null){c=s.child;for(var p=a.firstContext;p!==null;){if(p.context===i){if(s.tag===1){p=hh(-1,r&-r),p.tag=2;var _=s.updateQueue;if(_!==null){_=_.shared;var w=_.pending;w===null?p.next=p:(p.next=w.next,w.next=p),_.pending=p}}s.lanes|=r,p=s.alternate,p!==null&&(p.lanes|=r),kw(s.return,r,t),a.lanes|=r;break}p=p.next}}else if(s.tag===10)c=s.type===t.type?null:s.child;else if(s.tag===18){if(c=s.return,c===null)throw Error(ke(341));c.lanes|=r,a=c.alternate,a!==null&&(a.lanes|=r),kw(c,r,t),c=s.sibling}else c=s.child;if(c!==null)c.return=s;else for(c=s;c!==null;){if(c===t){c=null;break}if(s=c.sibling,s!==null){s.return=c.return,c=s;break}c=c.return}s=c}Zo(e,t,n.children,r),t=t.child}return t;case 9:return n=t.type,i=t.pendingProps.children,Xf(t,r),n=Gl(n),i=i(n),t.flags|=1,Zo(e,t,i,r),t.child;case 14:return i=t.type,n=hc(i,t.pendingProps),n=hc(i.type,n),KE(e,t,i,n,r);case 15:return lM(e,t,t.type,t.pendingProps,r);case 17:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:hc(i,n),Cy(e,t),t.tag=1,Aa(i)?(e=!0,o_(t)):e=!1,Xf(t,r),sM(t,i,n),Fw(t,i,n,r),Ow(null,t,i,!0,e,r);case 19:return pM(e,t,r);case 22:return cM(e,t,r)}throw Error(ke(156,t.tag))};function IM(e,t){return r4(e,t)}function GN(e,t,r,i){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dl(e,t,r,i){return new GN(e,t,r,i)}function Q5(e){return e=e.prototype,!(!e||!e.isReactComponent)}function VN(e){if(typeof e=="function")return Q5(e)?1:0;if(e!=null){if(e=e.$$typeof,e===_5)return 11;if(e===v5)return 14}return 2}function yd(e,t){var r=e.alternate;return r===null?(r=Dl(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Ly(e,t,r,i,n,s){var c=2;if(i=e,typeof e=="function")Q5(e)&&(c=1);else if(typeof e=="string")c=5;else t:switch(e){case Cf:return bp(r.children,n,s,t);case y5:c=8,n|=8;break;case sw:return e=Dl(12,r,t,n|2),e.elementType=sw,e.lanes=s,e;case ow:return e=Dl(13,r,t,n),e.elementType=ow,e.lanes=s,e;case aw:return e=Dl(19,r,t,n),e.elementType=aw,e.lanes=s,e;case OL:return rv(r,n,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case DL:c=10;break t;case NL:c=9;break t;case _5:c=11;break t;case v5:c=14;break t;case td:c=16,i=null;break t}throw Error(ke(130,e==null?e:typeof e,""))}return t=Dl(c,r,t,n),t.elementType=e,t.type=i,t.lanes=s,t}function bp(e,t,r,i){return e=Dl(7,e,i,t),e.lanes=r,e}function rv(e,t,r,i){return e=Dl(22,e,i,t),e.elementType=OL,e.lanes=r,e.stateNode={isHidden:!1},e}function zb(e,t,r){return e=Dl(6,e,null,t),e.lanes=r,e}function jb(e,t,r){return t=Dl(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function qN(e,t,r,i,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=bb(0),this.expirationTimes=bb(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bb(0),this.identifierPrefix=i,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function tS(e,t,r,i,n,s,c,a,p){return e=new qN(e,t,r,a,p),t===1?(t=1,s===!0&&(t|=8)):t=0,s=Dl(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},N5(s),e}function HN(e,t,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Tf,key:i==null?null:""+i,children:e,containerInfo:t,implementation:r}}function LM(e){if(!e)return wd;e=e._reactInternals;t:{if(Dp(e)!==e||e.tag!==1)throw Error(ke(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break t;case 1:if(Aa(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break t}}t=t.return}while(t!==null);throw Error(ke(171))}if(e.tag===1){var r=e.type;if(Aa(r))return L4(e,r,t)}return t}function MM(e,t,r,i,n,s,c,a,p){return e=tS(r,i,!0,e,n,s,c,a,p),e.context=LM(null),r=e.current,i=Qo(),n=gd(r),s=hh(i,n),s.callback=t??null,fd(r,s,n),e.current.lanes=n,N0(e,n,i),Ea(e,i),e}function iv(e,t,r,i){var n=t.current,s=Qo(),c=gd(n);return r=LM(r),t.context===null?t.context=r:t.pendingContext=r,t=hh(s,c),t.payload={element:e},i=i===void 0?null:i,i!==null&&(t.callback=i),e=fd(n,t,c),e!==null&&(wc(e,n,c,s),Ay(e,n,c)),c}function v_(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function uT(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function eS(e,t){uT(e,t),(e=e.alternate)&&uT(e,t)}function $N(){return null}var BM=typeof reportError=="function"?reportError:function(e){console.error(e)};function rS(e){this._internalRoot=e}nv.prototype.render=rS.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ke(409));iv(e,t,null,null)};nv.prototype.unmount=rS.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Ip(function(){iv(null,e,null,null)}),t[mh]=null}};function nv(e){this._internalRoot=e}nv.prototype.unstable_scheduleHydration=function(e){if(e){var t=c4();e={blockedOn:null,target:e,priority:t};for(var r=0;r<id.length&&t!==0&&t<id[r].priority;r++);id.splice(r,0,e),r===0&&h4(e)}};function iS(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function sv(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function hT(){}function WN(e,t,r,i,n){if(n){if(typeof i=="function"){var s=i;i=function(){var _=v_(c);s.call(_)}}var c=MM(t,i,e,0,null,!1,!1,"",hT);return e._reactRootContainer=c,e[mh]=c.current,p0(e.nodeType===8?e.parentNode:e),Ip(),c}for(;n=e.lastChild;)e.removeChild(n);if(typeof i=="function"){var a=i;i=function(){var _=v_(p);a.call(_)}}var p=tS(e,0,!1,null,null,!1,!1,"",hT);return e._reactRootContainer=p,e[mh]=p.current,p0(e.nodeType===8?e.parentNode:e),Ip(function(){iv(t,p,r,i)}),p}function ov(e,t,r,i,n){var s=r._reactRootContainer;if(s){var c=s;if(typeof n=="function"){var a=n;n=function(){var p=v_(c);a.call(p)}}iv(t,c,e,n)}else c=WN(r,t,e,n,i);return v_(c)}a4=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Fg(t.pendingLanes);r!==0&&(x5(t,r|1),Ea(t,Hn()),!(gi&6)&&(pm=Hn()+500,Id()))}break;case 13:Ip(function(){var i=gh(e,1);if(i!==null){var n=Qo();wc(i,e,1,n)}}),eS(e,1)}};S5=function(e){if(e.tag===13){var t=gh(e,134217728);if(t!==null){var r=Qo();wc(t,e,134217728,r)}eS(e,134217728)}};l4=function(e){if(e.tag===13){var t=gd(e),r=gh(e,t);if(r!==null){var i=Qo();wc(r,e,t,i)}eS(e,t)}};c4=function(){return Gi};u4=function(e,t){var r=Gi;try{return Gi=e,t()}finally{Gi=r}};yw=function(e,t,r){switch(t){case"input":if(uw(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var i=r[t];if(i!==e&&i.form===e.form){var n=Y_(i);if(!n)throw Error(ke(90));jL(i),uw(i,n)}}}break;case"textarea":VL(e,r);break;case"select":t=r.value,t!=null&&qf(e,!!r.multiple,t,!1)}};YL=Y5;JL=Ip;var XN={usingClientEntryPoint:!1,Events:[z0,Mf,Y_,XL,ZL,Y5]},fg={findFiberByHostInstance:hp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ZN={bundleType:fg.bundleType,version:fg.version,rendererPackageName:fg.rendererPackageName,rendererConfig:fg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:xh.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=t4(e),e===null?null:e.stateNode},findFiberByHostInstance:fg.findFiberByHostInstance||$N,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var j1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!j1.isDisabled&&j1.supportsFiber)try{$_=j1.inject(ZN),Au=j1}catch{}}cl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XN;cl.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!iS(t))throw Error(ke(200));return HN(e,t,null,r)};cl.createRoot=function(e,t){if(!iS(e))throw Error(ke(299));var r=!1,i="",n=BM;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(n=t.onRecoverableError)),t=tS(e,1,!1,null,null,r,!1,i,n),e[mh]=t.current,p0(e.nodeType===8?e.parentNode:e),new rS(t)};cl.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ke(188)):(e=Object.keys(e).join(","),Error(ke(268,e)));return e=t4(t),e=e===null?null:e.stateNode,e};cl.flushSync=function(e){return Ip(e)};cl.hydrate=function(e,t,r){if(!sv(t))throw Error(ke(200));return ov(null,e,t,!0,r)};cl.hydrateRoot=function(e,t,r){if(!iS(e))throw Error(ke(405));var i=r!=null&&r.hydratedSources||null,n=!1,s="",c=BM;if(r!=null&&(r.unstable_strictMode===!0&&(n=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(c=r.onRecoverableError)),t=MM(t,null,e,1,r??null,n,!1,s,c),e[mh]=t.current,p0(e),i)for(e=0;e<i.length;e++)r=i[e],n=r._getVersion,n=n(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,n]:t.mutableSourceEagerHydrationData.push(r,n);return new nv(t)};cl.render=function(e,t,r){if(!sv(t))throw Error(ke(200));return ov(null,e,t,!1,r)};cl.unmountComponentAtNode=function(e){if(!sv(e))throw Error(ke(40));return e._reactRootContainer?(Ip(function(){ov(null,null,e,!1,function(){e._reactRootContainer=null,e[mh]=null})}),!0):!1};cl.unstable_batchedUpdates=Y5;cl.unstable_renderSubtreeIntoContainer=function(e,t,r,i){if(!sv(r))throw Error(ke(200));if(e==null||e._reactInternals===void 0)throw Error(ke(38));return ov(e,t,r,!1,i)};cl.version="18.3.1-next-f1338f8080-20240426";function kM(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(kM)}catch(e){console.error(e)}}kM(),BL.exports=cl;var YN=BL.exports,dT=YN;iw.createRoot=dT.createRoot,iw.hydrateRoot=dT.hydrateRoot;const JN="modulepreload",KN=function(e){return"/basic-mapicgc-gl-js-viewer-react/dist/"+e},pT={},Yw=function(t,r,i){if(!r||r.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(r.map(s=>{if(s=KN(s),s in pT)return;pT[s]=!0;const c=s.endsWith(".css"),a=c?'[rel="stylesheet"]':"";if(!!i)for(let w=n.length-1;w>=0;w--){const S=n[w];if(S.href===s&&(!c||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const _=document.createElement("link");if(_.rel=c?"stylesheet":JN,c||(_.as="script",_.crossOrigin=""),_.href=s,document.head.appendChild(_),c)return new Promise((w,S)=>{_.addEventListener("load",w),_.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t()).catch(s=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=s,window.dispatchEvent(c),!c.defaultPrevented)throw s})};function QN(e,t){for(var r=0;r<t.length;r++){const i=t[r];if(typeof i!="string"&&!Array.isArray(i)){for(const n in i)if(n!=="default"&&!(n in e)){const s=Object.getOwnPropertyDescriptor(i,n);s&&Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:()=>i[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}var Of=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function av(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var RM={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(Of,function(){var r={},i={};function n(c,a,p){if(i[c]=p,c==="index"){var _="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",w={};return i.shared(w),i.index(r,w),typeof window<"u"&&r.setWorkerUrl(window.URL.createObjectURL(new Blob([_],{type:"text/javascript"}))),r}}n("shared",["exports"],function(c){function a(u,l,d,f){return new(d||(d=Promise))(function(b,x){function T(O){try{k(f.next(O))}catch(V){x(V)}}function L(O){try{k(f.throw(O))}catch(V){x(V)}}function k(O){var V;O.done?b(O.value):(V=O.value,V instanceof d?V:new d(function($){$(V)})).then(T,L)}k((f=f.apply(u,l||[])).next())})}function p(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}typeof SuppressedError=="function"&&SuppressedError;var _=w;function w(u,l){this.x=u,this.y=l}w.prototype={clone:function(){return new w(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,l){return this.clone()._rotateAround(u,l)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var l=u.x-this.x,d=u.y-this.y;return l*l+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,l){return Math.atan2(this.x*l-this.y*u,this.x*u+this.y*l)},_matMult:function(u){var l=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=l,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var l=Math.cos(u),d=Math.sin(u),f=d*this.x+l*this.y;return this.x=l*this.x-d*this.y,this.y=f,this},_rotateAround:function(u,l){var d=Math.cos(u),f=Math.sin(u),b=l.y+f*(this.x-l.x)+d*(this.y-l.y);return this.x=l.x+d*(this.x-l.x)-f*(this.y-l.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},w.convert=function(u){return u instanceof w?u:Array.isArray(u)?new w(u[0],u[1]):u};var S=p(_),C=I;function I(u,l,d,f){this.cx=3*u,this.bx=3*(d-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(f-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=l,this.p2x=d,this.p2y=f}I.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,l){if(l===void 0&&(l=1e-6),u<0)return 0;if(u>1)return 1;for(var d=u,f=0;f<8;f++){var b=this.sampleCurveX(d)-u;if(Math.abs(b)<l)return d;var x=this.sampleCurveDerivativeX(d);if(Math.abs(x)<1e-6)break;d-=b/x}var T=0,L=1;for(d=u,f=0;f<20&&(b=this.sampleCurveX(d),!(Math.abs(b-u)<l));f++)u>b?T=d:L=d,d=.5*(L-T)+T;return d},solve:function(u,l){return this.sampleCurveY(this.solveCurveX(u,l))}};var N=p(C);let F,W;function U(){return F==null&&(F=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),F}function z(){if(W==null&&(W=!1,U())){const u=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(u){for(let d=0;d<5*5;d++){const f=4*d;u.fillStyle=`rgb(${f},${f+1},${f+2})`,u.fillRect(d%5,Math.floor(d/5),1,1)}const l=u.getImageData(0,0,5,5).data;for(let d=0;d<5*5*4;d++)if(d%4!=3&&l[d]!==d){W=!0;break}}}return W||!1}function H(u,l,d,f){const b=new N(u,l,d,f);return x=>b.solve(x)}const nt=H(.25,.1,.25,1);function yt(u,l,d){return Math.min(d,Math.max(l,u))}function bt(u,l,d){const f=d-l,b=((u-l)%f+f)%f+l;return b===l?d:b}function vt(u){for(var l=arguments.length,d=new Array(l>1?l-1:0),f=1;f<l;f++)d[f-1]=arguments[f];for(const b of d)for(const x in b)u[x]=b[x];return u}let mt=1;function Dt(u,l,d){const f={};for(const b in u)f[b]=l.call(this,u[b],b,u);return f}function kt(u,l,d){const f={};for(const b in u)l.call(this,u[b],b,u)&&(f[b]=u[b]);return f}function at(u){return Array.isArray(u)?u.map(at):typeof u=="object"&&u?Dt(u,at):u}const dt={};function It(u){dt[u]||(typeof console<"u"&&console.warn(u),dt[u]=!0)}function xt(u,l,d){return(d.y-u.y)*(l.x-u.x)>(l.y-u.y)*(d.x-u.x)}function re(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let ee=null;function se(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const Ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Xt(u,l,d,f,b){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const x=new VideoFrame(u,{timestamp:0});try{const T=x==null?void 0:x.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const L=T.startsWith("BGR"),k=new Uint8ClampedArray(f*b*4);if(yield x.copyTo(k,function(O,V,$,K,et){const lt=4*Math.max(-V,0),ft=(Math.max(0,$)-$)*K*4+lt,Tt=4*K,Mt=Math.max(0,V),Jt=Math.max(0,$);return{rect:{x:Mt,y:Jt,width:Math.min(O.width,V+K)-Mt,height:Math.min(O.height,$+et)-Jt},layout:[{offset:ft,stride:Tt}]}}(u,l,d,f,b)),L)for(let O=0;O<k.length;O+=4){const V=k[O];k[O]=k[O+2],k[O+2]=V}return k}finally{x.close()}})}let Wt,xe;const it="AbortError";function Et(){return new Error(it)}const Pt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function jt(u){return Pt.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const qt="global-dispatcher";class $t extends Error{constructor(l,d,f,b){super(`AJAXError: ${d} (${l}): ${f}`),this.status=l,this.statusText=d,this.url=f,this.body=b}}const Qt=()=>re(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Kt=function(u,l){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const f=jt(u.url);if(f)return f(u,l);if(re(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:qt},l)}if(!(/^file:/.test(d=u.url)||/^file:/.test(Qt())&&!/^\w+:/.test(d))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,b){return a(this,void 0,void 0,function*(){const x=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:Qt(),signal:b.signal});f.type!=="json"||x.headers.has("Accept")||x.headers.set("Accept","application/json");const T=yield fetch(x);if(!T.ok){const O=yield T.blob();throw new $t(T.status,T.statusText,f.url,O)}let L;L=f.type==="arrayBuffer"||f.type==="image"?T.arrayBuffer():f.type==="json"?T.json():T.text();const k=yield L;if(b.signal.aborted)throw Et();return{data:k,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}})}(u,l);if(re(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:qt},l)}var d;return function(f,b){return new Promise((x,T)=>{var L;const k=new XMLHttpRequest;k.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(k.responseType="arraybuffer");for(const O in f.headers)k.setRequestHeader(O,f.headers[O]);f.type==="json"&&(k.responseType="text",!((L=f.headers)===null||L===void 0)&&L.Accept||k.setRequestHeader("Accept","application/json")),k.withCredentials=f.credentials==="include",k.onerror=()=>{T(new Error(k.statusText))},k.onload=()=>{if(!b.signal.aborted)if((k.status>=200&&k.status<300||k.status===0)&&k.response!==null){let O=k.response;if(f.type==="json")try{O=JSON.parse(k.response)}catch(V){return void T(V)}x({data:O,cacheControl:k.getResponseHeader("Cache-Control"),expires:k.getResponseHeader("Expires")})}else{const O=new Blob([k.response],{type:k.getResponseHeader("Content-Type")});T(new $t(k.status,k.statusText,f.url,O))}},b.signal.addEventListener("abort",()=>{k.abort(),T(Et())}),k.send(f.body)})}(u,l)};function Ee(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const l=new URL(u),d=window.location;return l.protocol===d.protocol&&l.host===d.host}function Me(u,l,d){d[u]&&d[u].indexOf(l)!==-1||(d[u]=d[u]||[],d[u].push(l))}function De(u,l,d){if(d&&d[u]){const f=d[u].indexOf(l);f!==-1&&d[u].splice(f,1)}}class ze{constructor(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};vt(this,d),this.type=l}}class or extends ze{constructor(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",vt({error:l},d))}}class le{on(l,d){return this._listeners=this._listeners||{},Me(l,d,this._listeners),this}off(l,d){return De(l,d,this._listeners),De(l,d,this._oneTimeListeners),this}once(l,d){return d?(this._oneTimeListeners=this._oneTimeListeners||{},Me(l,d,this._oneTimeListeners),this):new Promise(f=>this.once(l,f))}fire(l,d){typeof l=="string"&&(l=new ze(l,d||{}));const f=l.type;if(this.listens(f)){l.target=this;const b=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const L of b)L.call(this,l);const x=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const L of x)De(f,L,this._oneTimeListeners),L.call(this,l);const T=this._eventedParent;T&&(vt(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(l))}else l instanceof or&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,d){return this._eventedParent=l,this._eventedParentData=d,this}}var st={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const mr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Qe(u,l){const d={};for(const f in u)f!=="ref"&&(d[f]=u[f]);return mr.forEach(f=>{f in l&&(d[f]=l[f])}),d}function de(u,l){if(Array.isArray(u)){if(!Array.isArray(l)||u.length!==l.length)return!1;for(let d=0;d<u.length;d++)if(!de(u[d],l[d]))return!1;return!0}if(typeof u=="object"&&u!==null&&l!==null){if(typeof l!="object"||Object.keys(u).length!==Object.keys(l).length)return!1;for(const d in u)if(!de(u[d],l[d]))return!1;return!0}return u===l}function Te(u,l){u.push(l)}function Be(u,l,d){Te(d,{command:"addSource",args:[u,l[u]]})}function Ne(u,l,d){Te(l,{command:"removeSource",args:[u]}),d[u]=!0}function rr(u,l,d,f){Ne(u,d,f),Be(u,l,d)}function Er(u,l,d){let f;for(f in u[d])if(Object.prototype.hasOwnProperty.call(u[d],f)&&f!=="data"&&!de(u[d][f],l[d][f]))return!1;for(f in l[d])if(Object.prototype.hasOwnProperty.call(l[d],f)&&f!=="data"&&!de(u[d][f],l[d][f]))return!1;return!0}function wr(u,l,d,f,b,x){u=u||{},l=l||{};for(const T in u)Object.prototype.hasOwnProperty.call(u,T)&&(de(u[T],l[T])||d.push({command:x,args:[f,T,l[T],b]}));for(const T in l)Object.prototype.hasOwnProperty.call(l,T)&&!Object.prototype.hasOwnProperty.call(u,T)&&(de(u[T],l[T])||d.push({command:x,args:[f,T,l[T],b]}))}function Fr(u){return u.id}function Ur(u,l){return u[l.id]=l,u}class me{constructor(l,d,f,b){this.message=(l?`${l}: `:"")+f,b&&(this.identifier=b),d!=null&&d.__line__&&(this.line=d.__line__)}}function hr(u){for(var l=arguments.length,d=new Array(l>1?l-1:0),f=1;f<l;f++)d[f-1]=arguments[f];for(const b of d)for(const x in b)u[x]=b[x];return u}class xr extends Error{constructor(l,d){super(d),this.message=d,this.key=l}}class Fe{constructor(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=l,this.bindings={};for(const[f,b]of d)this.bindings[f]=b}concat(l){return new Fe(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}const wi={kind:"null"},ge={kind:"number"},br={kind:"string"},Ge={kind:"boolean"},Hr={kind:"color"},Qi={kind:"object"},je={kind:"value"},In={kind:"collator"},si={kind:"formatted"},on={kind:"padding"},an={kind:"resolvedImage"},At={kind:"variableAnchorOffsetCollection"};function J(u,l){return{kind:"array",itemType:u,N:l}}function Q(u){if(u.kind==="array"){const l=Q(u.itemType);return typeof u.N=="number"?`array<${l}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${l}>`}return u.kind}const ut=[wi,ge,br,Ge,Hr,si,Qi,J(je),on,an,At];function wt(u,l){if(l.kind==="error")return null;if(u.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!wt(u.itemType,l.itemType))&&(typeof u.N!="number"||u.N===l.N))return null}else{if(u.kind===l.kind)return null;if(u.kind==="value"){for(const d of ut)if(!wt(d,l))return null}}return`Expected ${Q(u)} but found ${Q(l)} instead.`}function Nt(u,l){return l.some(d=>d.kind===u.kind)}function Vt(u,l){return l.some(d=>d==="null"?u===null:d==="array"?Array.isArray(u):d==="object"?u&&!Array.isArray(u)&&typeof u=="object":d===typeof u)}function Ft(u,l){return u.kind==="array"&&l.kind==="array"?u.itemType.kind===l.itemType.kind&&typeof u.N=="number":u.kind===l.kind}const Lt=.96422,ne=.82521,ue=4/29,Zt=6/29,be=3*Zt*Zt,We=Zt*Zt*Zt,Ke=Math.PI/180,Br=180/Math.PI;function tr(u){return(u%=360)<0&&(u+=360),u}function Ir(u){let[l,d,f,b]=u,x,T;const L=oi((.2225045*(l=Sr(l))+.7168786*(d=Sr(d))+.0606169*(f=Sr(f)))/1);l===d&&d===f?x=T=L:(x=oi((.4360747*l+.3850649*d+.1430804*f)/Lt),T=oi((.0139322*l+.0971045*d+.7141733*f)/ne));const k=116*L-16;return[k<0?0:k,500*(x-L),200*(L-T),b]}function Sr(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function oi(u){return u>We?Math.pow(u,1/3):u/be+ue}function Wr(u){let[l,d,f,b]=u,x=(l+16)/116,T=isNaN(d)?x:x+d/500,L=isNaN(f)?x:x-f/200;return x=1*Nr(x),T=Lt*Nr(T),L=ne*Nr(L),[dr(3.1338561*T-1.6168667*x-.4906146*L),dr(-.9787684*T+1.9161415*x+.033454*L),dr(.0719453*T-.2289914*x+1.4052427*L),b]}function dr(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function Nr(u){return u>Zt?u*u*u:be*(u-ue)}function ei(u){return parseInt(u.padEnd(2,u),16)/255}function yi(u,l){return Pi(l?u/100:u,0,1)}function Pi(u,l,d){return Math.min(Math.max(l,u),d)}function tn(u){return!u.some(Number.isNaN)}const Bo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Jr{constructor(l,d,f){let b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=l,this.g=d,this.b=f,this.a=b,x||(this.r*=b,this.g*=b,this.b*=b,b||this.overwriteGetter("rgb",[l,d,f,b]))}static parse(l){if(l instanceof Jr)return l;if(typeof l!="string")return;const d=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const b=Bo[f];if(b){const[T,L,k]=b;return[T/255,L/255,k/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const T=f.length<6?1:2;let L=1;return[ei(f.slice(L,L+=T)),ei(f.slice(L,L+=T)),ei(f.slice(L,L+=T)),ei(f.slice(L,L+T)||"ff")]}if(f.startsWith("rgb")){const T=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[L,k,O,V,$,K,et,lt,ft,Tt,Mt,Jt]=T,Gt=[V||" ",et||" ",Tt].join("");if(Gt==="  "||Gt==="  /"||Gt===",,"||Gt===",,,"){const Ht=[O,K,ft].join(""),ae=Ht==="%%%"?100:Ht===""?255:0;if(ae){const Ce=[Pi(+k/ae,0,1),Pi(+$/ae,0,1),Pi(+lt/ae,0,1),Mt?yi(+Mt,Jt):1];if(tn(Ce))return Ce}}return}}const x=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[T,L,k,O,V,$,K,et,lt]=x,ft=[k||" ",V||" ",K].join("");if(ft==="  "||ft==="  /"||ft===",,"||ft===",,,"){const Tt=[+L,Pi(+O,0,100),Pi(+$,0,100),et?yi(+et,lt):1];if(tn(Tt))return function(Mt){let[Jt,Gt,Ht,ae]=Mt;function Ce(Ve){const yr=(Ve+Jt/30)%12,Ue=Gt*Math.min(Ht,1-Ht);return Ht-Ue*Math.max(-1,Math.min(yr-3,9-yr,1))}return Jt=tr(Jt),Gt/=100,Ht/=100,[Ce(0),Ce(8),Ce(4),ae]}(Tt)}}}(l);return d?new Jr(...d,!1):void 0}get rgb(){const{r:l,g:d,b:f,a:b}=this,x=b||1/0;return this.overwriteGetter("rgb",[l/x,d/x,f/x,b])}get hcl(){return this.overwriteGetter("hcl",function(l){const[d,f,b,x]=Ir(l),T=Math.sqrt(f*f+b*b);return[Math.round(1e4*T)?tr(Math.atan2(b,f)*Br):NaN,T,d,x]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ir(this.rgb))}overwriteGetter(l,d){return Object.defineProperty(this,l,{value:d}),d}toString(){const[l,d,f,b]=this.rgb;return`rgba(${[l,d,f].map(x=>Math.round(255*x)).join(",")},${b})`}}Jr.black=new Jr(0,0,0,1),Jr.white=new Jr(1,1,1,1),Jr.transparent=new Jr(0,0,0,0),Jr.red=new Jr(1,0,0,1);class Ln{constructor(l,d,f){this.sensitivity=l?d?"variant":"case":d?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,d){return this.collator.compare(l,d)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ls{constructor(l,d,f,b,x){this.text=l,this.image=d,this.scale=f,this.fontStack=b,this.textColor=x}}class ki{constructor(l){this.sections=l}static fromString(l){return new ki([new ls(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof ki?l:ki.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}}class Ri{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Ri)return l;if(typeof l=="number")return new Ri([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(const d of l)if(typeof d!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new Ri(l)}}toString(){return JSON.stringify(this.values)}}const ko=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Fi{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Fi)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let d=0;d<l.length;d+=2){const f=l[d],b=l[d+1];if(typeof f!="string"||!ko.has(f)||!Array.isArray(b)||b.length!==2||typeof b[0]!="number"||typeof b[1]!="number")return}return new Fi(l)}}toString(){return JSON.stringify(this.values)}}class Ii{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new Ii({name:l,available:!1}):null}}function Ro(u,l,d,f){return typeof u=="number"&&u>=0&&u<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof d=="number"&&d>=0&&d<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[u,l,d,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[u,l,d,f]:[u,l,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function cs(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof Jr||u instanceof Ln||u instanceof ki||u instanceof Ri||u instanceof Fi||u instanceof Ii)return!0;if(Array.isArray(u)){for(const l of u)if(!cs(l))return!1;return!0}if(typeof u=="object"){for(const l in u)if(!cs(u[l]))return!1;return!0}return!1}function xi(u){if(u===null)return wi;if(typeof u=="string")return br;if(typeof u=="boolean")return Ge;if(typeof u=="number")return ge;if(u instanceof Jr)return Hr;if(u instanceof Ln)return In;if(u instanceof ki)return si;if(u instanceof Ri)return on;if(u instanceof Fi)return At;if(u instanceof Ii)return an;if(Array.isArray(u)){const l=u.length;let d;for(const f of u){const b=xi(f);if(d){if(d===b)continue;d=je;break}d=b}return J(d||je,l)}return Qi}function Kr(u){const l=typeof u;return u===null?"":l==="string"||l==="number"||l==="boolean"?String(u):u instanceof Jr||u instanceof ki||u instanceof Ri||u instanceof Fi||u instanceof Ii?u.toString():JSON.stringify(u)}class bn{constructor(l,d){this.type=l,this.value=d}static parse(l,d){if(l.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!cs(l[1]))return d.error("invalid value");const f=l[1];let b=xi(f);const x=d.expectedType;return b.kind!=="array"||b.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(b=x),new bn(b,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class _i{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}const Fo={string:br,number:ge,boolean:Ge,object:Qi};class wn{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let f,b=1;const x=l[0];if(x==="array"){let L,k;if(l.length>2){const O=l[1];if(typeof O!="string"||!(O in Fo)||O==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);L=Fo[O],b++}else L=je;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return d.error('The length argument to "array" must be a positive integer literal',2);k=l[2],b++}f=J(L,k)}else{if(!Fo[x])throw new Error(`Types doesn't contain name = ${x}`);f=Fo[x]}const T=[];for(;b<l.length;b++){const L=d.parse(l[b],b,je);if(!L)return null;T.push(L)}return new wn(f,T)}evaluate(l){for(let d=0;d<this.args.length;d++){const f=this.args[d].evaluate(l);if(!wt(this.type,xi(f)))return f;if(d===this.args.length-1)throw new _i(`Expected value to be of type ${Q(this.type)}, but found ${Q(xi(f))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const La={"to-boolean":Ge,"to-color":Hr,"to-number":ge,"to-string":br};class Li{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");const f=l[0];if(!La[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&l.length!==2)return d.error("Expected one argument.");const b=La[f],x=[];for(let T=1;T<l.length;T++){const L=d.parse(l[T],T,je);if(!L)return null;x.push(L)}return new Li(b,x)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let d,f;for(const b of this.args){if(d=b.evaluate(l),f=null,d instanceof Jr)return d;if(typeof d=="string"){const x=l.parseColor(d);if(x)return x}else if(Array.isArray(d)&&(f=d.length<3||d.length>4?`Invalid rbga value ${JSON.stringify(d)}: expected an array containing either three or four numeric values.`:Ro(d[0],d[1],d[2],d[3]),!f))return new Jr(d[0]/255,d[1]/255,d[2]/255,d[3])}throw new _i(f||`Could not parse color from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"padding":{let d;for(const f of this.args){d=f.evaluate(l);const b=Ri.parse(d);if(b)return b}throw new _i(`Could not parse padding from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"variableAnchorOffsetCollection":{let d;for(const f of this.args){d=f.evaluate(l);const b=Fi.parse(d);if(b)return b}throw new _i(`Could not parse variableAnchorOffsetCollection from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"number":{let d=null;for(const f of this.args){if(d=f.evaluate(l),d===null)return 0;const b=Number(d);if(!isNaN(b))return b}throw new _i(`Could not convert ${JSON.stringify(d)} to number.`)}case"formatted":return ki.fromString(Kr(this.args[0].evaluate(l)));case"resolvedImage":return Ii.fromString(Kr(this.args[0].evaluate(l)));default:return Kr(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const us=["Unknown","Point","LineString","Polygon"];class xn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?us[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let d=this._parseColorCache[l];return d||(d=this._parseColorCache[l]=Jr.parse(l)),d}}class As{constructor(l,d){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],b=arguments.length>3?arguments[3]:void 0,x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Fe,T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=l,this.path=f,this.key=f.map(L=>`[${L}]`).join(""),this.scope=x,this.errors=T,this.expectedType=b,this._isConstant=d}parse(l,d,f,b){let x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return d?this.concat(d,f,b)._parse(l,x):this._parse(l,x)}_parse(l,d){function f(b,x,T){return T==="assert"?new wn(x,[b]):T==="coerce"?new Li(x,[b]):b}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const b=l[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[b];if(x){let T=x.parse(l,this);if(!T)return null;if(this.expectedType){const L=this.expectedType,k=T.type;if(L.kind!=="string"&&L.kind!=="number"&&L.kind!=="boolean"&&L.kind!=="object"&&L.kind!=="array"||k.kind!=="value")if(L.kind!=="color"&&L.kind!=="formatted"&&L.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string")if(L.kind!=="padding"||k.kind!=="value"&&k.kind!=="number"&&k.kind!=="array")if(L.kind!=="variableAnchorOffsetCollection"||k.kind!=="value"&&k.kind!=="array"){if(this.checkSubtype(L,k))return null}else T=f(T,L,d.typeAnnotation||"coerce");else T=f(T,L,d.typeAnnotation||"coerce");else T=f(T,L,d.typeAnnotation||"coerce");else T=f(T,L,d.typeAnnotation||"assert")}if(!(T instanceof bn)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const L=new xn;try{T=new bn(T.type,T.evaluate(L))}catch(k){return this.error(k.message),null}}return T}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,d,f){const b=typeof l=="number"?this.path.concat(l):this.path,x=f?this.scope.concat(f):this.scope;return new As(this.registry,this._isConstant,b,d||null,x,this.errors)}error(l){for(var d=arguments.length,f=new Array(d>1?d-1:0),b=1;b<d;b++)f[b-1]=arguments[b];const x=`${this.key}${f.map(T=>`[${T}]`).join("")}`;this.errors.push(new xr(x,l))}checkSubtype(l,d){const f=wt(l,d);return f&&this.error(f),f}}class hs{constructor(l,d){this.type=d.type,this.bindings=[].concat(l),this.result=d}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const d of this.bindings)l(d[1]);l(this.result)}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const f=[];for(let x=1;x<l.length-1;x+=2){const T=l[x];if(typeof T!="string")return d.error(`Expected string, but found ${typeof T} instead.`,x);if(/[^a-zA-Z0-9_]/.test(T))return d.error("Variable names must contain only alphanumeric characters or '_'.",x);const L=d.parse(l[x+1],x+1);if(!L)return null;f.push([T,L])}const b=d.parse(l[l.length-1],l.length-1,d.expectedType,f);return b?new hs(f,b):null}outputDefined(){return this.result.outputDefined()}}class Xr{constructor(l,d){this.type=d.type,this.name=l,this.boundExpression=d}static parse(l,d){if(l.length!==2||typeof l[1]!="string")return d.error("'var' expression requires exactly one string literal argument.");const f=l[1];return d.scope.has(f)?new Xr(f,d.scope.get(f)):d.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class hl{constructor(l,d,f){this.type=l,this.index=d,this.input=f}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const f=d.parse(l[1],1,ge),b=d.parse(l[2],2,J(d.expectedType||je));return f&&b?new hl(b.type.itemType,f,b):null}evaluate(l){const d=this.index.evaluate(l),f=this.input.evaluate(l);if(d<0)throw new _i(`Array index out of bounds: ${d} < 0.`);if(d>=f.length)throw new _i(`Array index out of bounds: ${d} > ${f.length-1}.`);if(d!==Math.floor(d))throw new _i(`Array index must be an integer, but found ${d} instead.`);return f[d]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class ql{constructor(l,d){this.type=Ge,this.needle=l,this.haystack=d}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const f=d.parse(l[1],1,je),b=d.parse(l[2],2,je);return f&&b?Nt(f.type,[Ge,br,ge,wi,je])?new ql(f,b):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${Q(f.type)} instead`):null}evaluate(l){const d=this.needle.evaluate(l),f=this.haystack.evaluate(l);if(!f)return!1;if(!Vt(d,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${Q(xi(d))} instead.`);if(!Vt(f,["string","array"]))throw new _i(`Expected second argument to be of type array or string, but found ${Q(xi(f))} instead.`);return f.indexOf(d)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class ot{constructor(l,d,f){this.type=ge,this.needle=l,this.haystack=d,this.fromIndex=f}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const f=d.parse(l[1],1,je),b=d.parse(l[2],2,je);if(!f||!b)return null;if(!Nt(f.type,[Ge,br,ge,wi,je]))return d.error(`Expected first argument to be of type boolean, string, number or null, but found ${Q(f.type)} instead`);if(l.length===4){const x=d.parse(l[3],3,ge);return x?new ot(f,b,x):null}return new ot(f,b)}evaluate(l){const d=this.needle.evaluate(l),f=this.haystack.evaluate(l);if(!Vt(d,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${Q(xi(d))} instead.`);let b;if(this.fromIndex&&(b=this.fromIndex.evaluate(l)),Vt(f,["string"])){const x=f.indexOf(d,b);return x===-1?-1:[...f.slice(0,x)].length}if(Vt(f,["array"]))return f.indexOf(d,b);throw new _i(`Expected second argument to be of type array or string, but found ${Q(xi(f))} instead.`)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class _t{constructor(l,d,f,b,x,T){this.inputType=l,this.type=d,this.input=f,this.cases=b,this.outputs=x,this.otherwise=T}static parse(l,d){if(l.length<5)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return d.error("Expected an even number of arguments.");let f,b;d.expectedType&&d.expectedType.kind!=="value"&&(b=d.expectedType);const x={},T=[];for(let O=2;O<l.length-1;O+=2){let V=l[O];const $=l[O+1];Array.isArray(V)||(V=[V]);const K=d.concat(O);if(V.length===0)return K.error("Expected at least one branch label.");for(const lt of V){if(typeof lt!="number"&&typeof lt!="string")return K.error("Branch labels must be numbers or strings.");if(typeof lt=="number"&&Math.abs(lt)>Number.MAX_SAFE_INTEGER)return K.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof lt=="number"&&Math.floor(lt)!==lt)return K.error("Numeric branch labels must be integer values.");if(f){if(K.checkSubtype(f,xi(lt)))return null}else f=xi(lt);if(x[String(lt)]!==void 0)return K.error("Branch labels must be unique.");x[String(lt)]=T.length}const et=d.parse($,O,b);if(!et)return null;b=b||et.type,T.push(et)}const L=d.parse(l[1],1,je);if(!L)return null;const k=d.parse(l[l.length-1],l.length-1,b);return k?L.type.kind!=="value"&&d.concat(1).checkSubtype(f,L.type)?null:new _t(f,b,L,x,T,k):null}evaluate(l){const d=this.input.evaluate(l);return(xi(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}}class zt{constructor(l,d,f){this.type=l,this.branches=d,this.otherwise=f}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return d.error("Expected an odd number of arguments.");let f;d.expectedType&&d.expectedType.kind!=="value"&&(f=d.expectedType);const b=[];for(let T=1;T<l.length-1;T+=2){const L=d.parse(l[T],T,Ge);if(!L)return null;const k=d.parse(l[T+1],T+1,f);if(!k)return null;b.push([L,k]),f=f||k.type}const x=d.parse(l[l.length-1],l.length-1,f);if(!x)return null;if(!f)throw new Error("Can't infer output type");return new zt(f,b,x)}evaluate(l){for(const[d,f]of this.branches)if(d.evaluate(l))return f.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[d,f]of this.branches)l(d),l(f);l(this.otherwise)}outputDefined(){return this.branches.every(l=>{let[d,f]=l;return f.outputDefined()})&&this.otherwise.outputDefined()}}class oe{constructor(l,d,f,b){this.type=l,this.input=d,this.beginIndex=f,this.endIndex=b}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const f=d.parse(l[1],1,je),b=d.parse(l[2],2,ge);if(!f||!b)return null;if(!Nt(f.type,[J(je),br,je]))return d.error(`Expected first argument to be of type array or string, but found ${Q(f.type)} instead`);if(l.length===4){const x=d.parse(l[3],3,ge);return x?new oe(f.type,f,b,x):null}return new oe(f.type,f,b)}evaluate(l){const d=this.input.evaluate(l),f=this.beginIndex.evaluate(l);let b;if(this.endIndex&&(b=this.endIndex.evaluate(l)),Vt(d,["string"]))return[...d].slice(f,b).join("");if(Vt(d,["array"]))return d.slice(f,b);throw new _i(`Expected first argument to be of type array or string, but found ${Q(xi(d))} instead.`)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function Ae(u,l){const d=u.length-1;let f,b,x=0,T=d,L=0;for(;x<=T;)if(L=Math.floor((x+T)/2),f=u[L],b=u[L+1],f<=l){if(L===d||l<b)return L;x=L+1}else{if(!(f>l))throw new _i("Input is not a number.");T=L-1}return 0}class ar{constructor(l,d,f){this.type=l,this.input=d,this.labels=[],this.outputs=[];for(const[b,x]of f)this.labels.push(b),this.outputs.push(x)}static parse(l,d){if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");const f=d.parse(l[1],1,ge);if(!f)return null;const b=[];let x=null;d.expectedType&&d.expectedType.kind!=="value"&&(x=d.expectedType);for(let T=1;T<l.length;T+=2){const L=T===1?-1/0:l[T],k=l[T+1],O=T,V=T+1;if(typeof L!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(b.length&&b[b.length-1][0]>=L)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const $=d.parse(k,V,x);if(!$)return null;x=x||$.type,b.push([L,$])}return new ar(x,f,b)}evaluate(l){const d=this.labels,f=this.outputs;if(d.length===1)return f[0].evaluate(l);const b=this.input.evaluate(l);if(b<=d[0])return f[0].evaluate(l);const x=d.length;return b>=d[x-1]?f[x-1].evaluate(l):f[Ae(d,b)].evaluate(l)}eachChild(l){l(this.input);for(const d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function Lr(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var di=Sn;function Sn(u,l,d,f){this.cx=3*u,this.bx=3*(d-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(f-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=l,this.p2x=d,this.p2y=f}Sn.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,l){if(l===void 0&&(l=1e-6),u<0)return 0;if(u>1)return 1;for(var d=u,f=0;f<8;f++){var b=this.sampleCurveX(d)-u;if(Math.abs(b)<l)return d;var x=this.sampleCurveDerivativeX(d);if(Math.abs(x)<1e-6)break;d-=b/x}var T=0,L=1;for(d=u,f=0;f<20&&(b=this.sampleCurveX(d),!(Math.abs(b-u)<l));f++)u>b?T=d:L=d,d=.5*(L-T)+T;return d},solve:function(u,l){return this.sampleCurveY(this.solveCurveX(u,l))}};var Mn=Lr(di);function ii(u,l,d){return u+d*(l-u)}function Hl(u,l,d){return u.map((f,b)=>ii(f,l[b],d))}const Un={number:ii,color:function(u,l,d){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[f,b,x,T]=Hl(u.rgb,l.rgb,d);return new Jr(f,b,x,T,!1)}case"hcl":{const[f,b,x,T]=u.hcl,[L,k,O,V]=l.hcl;let $,K;if(isNaN(f)||isNaN(L))isNaN(f)?isNaN(L)?$=NaN:($=L,x!==1&&x!==0||(K=k)):($=f,O!==1&&O!==0||(K=b));else{let Mt=L-f;L>f&&Mt>180?Mt-=360:L<f&&f-L>180&&(Mt+=360),$=f+d*Mt}const[et,lt,ft,Tt]=function(Mt){let[Jt,Gt,Ht,ae]=Mt;return Jt=isNaN(Jt)?0:Jt*Ke,Wr([Ht,Math.cos(Jt)*Gt,Math.sin(Jt)*Gt,ae])}([$,K??ii(b,k,d),ii(x,O,d),ii(T,V,d)]);return new Jr(et,lt,ft,Tt,!1)}case"lab":{const[f,b,x,T]=Wr(Hl(u.lab,l.lab,d));return new Jr(f,b,x,T,!1)}}},array:Hl,padding:function(u,l,d){return new Ri(Hl(u.values,l.values,d))},variableAnchorOffsetCollection:function(u,l,d){const f=u.values,b=l.values;if(f.length!==b.length)throw new _i(`Cannot interpolate values of different length. from: ${u.toString()}, to: ${l.toString()}`);const x=[];for(let T=0;T<f.length;T+=2){if(f[T]!==b[T])throw new _i(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${f[T]}, to[${T}]: ${b[T]}`);x.push(f[T]);const[L,k]=f[T+1],[O,V]=b[T+1];x.push([ii(L,O,d),ii(k,V,d)])}return new Fi(x)}};class pr{constructor(l,d,f,b,x){this.type=l,this.operator=d,this.interpolation=f,this.input=b,this.labels=[],this.outputs=[];for(const[T,L]of x)this.labels.push(T),this.outputs.push(L)}static interpolationFactor(l,d,f,b){let x=0;if(l.name==="exponential")x=Lc(d,l.base,f,b);else if(l.name==="linear")x=Lc(d,1,f,b);else if(l.name==="cubic-bezier"){const T=l.controlPoints;x=new Mn(T[0],T[1],T[2],T[3]).solve(Lc(d,1,f,b))}return x}static parse(l,d){let[f,b,x,...T]=l;if(!Array.isArray(b)||b.length===0)return d.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){const O=b[1];if(typeof O!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:O}}else{if(b[0]!=="cubic-bezier")return d.error(`Unknown interpolation type ${String(b[0])}`,1,0);{const O=b.slice(1);if(O.length!==4||O.some(V=>typeof V!="number"||V<0||V>1))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:O}}}if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");if(x=d.parse(x,2,ge),!x)return null;const L=[];let k=null;f==="interpolate-hcl"||f==="interpolate-lab"?k=Hr:d.expectedType&&d.expectedType.kind!=="value"&&(k=d.expectedType);for(let O=0;O<T.length;O+=2){const V=T[O],$=T[O+1],K=O+3,et=O+4;if(typeof V!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',K);if(L.length&&L[L.length-1][0]>=V)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',K);const lt=d.parse($,et,k);if(!lt)return null;k=k||lt.type,L.push([V,lt])}return Ft(k,ge)||Ft(k,Hr)||Ft(k,on)||Ft(k,At)||Ft(k,J(ge))?new pr(k,f,b,x,L):d.error(`Type ${Q(k)} is not interpolatable.`)}evaluate(l){const d=this.labels,f=this.outputs;if(d.length===1)return f[0].evaluate(l);const b=this.input.evaluate(l);if(b<=d[0])return f[0].evaluate(l);const x=d.length;if(b>=d[x-1])return f[x-1].evaluate(l);const T=Ae(d,b),L=pr.interpolationFactor(this.interpolation,b,d[T],d[T+1]),k=f[T].evaluate(l),O=f[T+1].evaluate(l);switch(this.operator){case"interpolate":return Un[this.type.kind](k,O,L);case"interpolate-hcl":return Un.color(k,O,L,"hcl");case"interpolate-lab":return Un.color(k,O,L,"lab")}}eachChild(l){l(this.input);for(const d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function Lc(u,l,d,f){const b=f-d,x=u-d;return b===0?0:l===1?x/b:(Math.pow(l,x)-1)/(Math.pow(l,b)-1)}class Mc{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expectected at least one argument.");let f=null;const b=d.expectedType;b&&b.kind!=="value"&&(f=b);const x=[];for(const L of l.slice(1)){const k=d.parse(L,1+x.length,f,void 0,{typeAnnotation:"omit"});if(!k)return null;f=f||k.type,x.push(k)}if(!f)throw new Error("No output type");const T=b&&x.some(L=>wt(b,L.type));return new Mc(T?je:f,x)}evaluate(l){let d,f=null,b=0;for(const x of this.args)if(b++,f=x.evaluate(l),f&&f instanceof Ii&&!f.available&&(d||(d=f.name),f=null,b===this.args.length&&(f=d)),f!==null)break;return f}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}function js(u,l){return u==="=="||u==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function Iu(u,l,d,f){return f.compare(l,d)===0}function Ma(u,l,d){const f=u!=="=="&&u!=="!=";return class FM{constructor(x,T,L){this.type=Ge,this.lhs=x,this.rhs=T,this.collator=L,this.hasUntypedArgument=x.type.kind==="value"||T.type.kind==="value"}static parse(x,T){if(x.length!==3&&x.length!==4)return T.error("Expected two or three arguments.");const L=x[0];let k=T.parse(x[1],1,je);if(!k)return null;if(!js(L,k.type))return T.concat(1).error(`"${L}" comparisons are not supported for type '${Q(k.type)}'.`);let O=T.parse(x[2],2,je);if(!O)return null;if(!js(L,O.type))return T.concat(2).error(`"${L}" comparisons are not supported for type '${Q(O.type)}'.`);if(k.type.kind!==O.type.kind&&k.type.kind!=="value"&&O.type.kind!=="value")return T.error(`Cannot compare types '${Q(k.type)}' and '${Q(O.type)}'.`);f&&(k.type.kind==="value"&&O.type.kind!=="value"?k=new wn(O.type,[k]):k.type.kind!=="value"&&O.type.kind==="value"&&(O=new wn(k.type,[O])));let V=null;if(x.length===4){if(k.type.kind!=="string"&&O.type.kind!=="string"&&k.type.kind!=="value"&&O.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(V=T.parse(x[3],3,In),!V)return null}return new FM(k,O,V)}evaluate(x){const T=this.lhs.evaluate(x),L=this.rhs.evaluate(x);if(f&&this.hasUntypedArgument){const k=xi(T),O=xi(L);if(k.kind!==O.kind||k.kind!=="string"&&k.kind!=="number")throw new _i(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${k.kind}, ${O.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const k=xi(T),O=xi(L);if(k.kind!=="string"||O.kind!=="string")return l(x,T,L)}return this.collator?d(x,T,L,this.collator.evaluate(x)):l(x,T,L)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const Bc=Ma("==",function(u,l,d){return l===d},Iu),kc=Ma("!=",function(u,l,d){return l!==d},function(u,l,d,f){return!Iu(0,l,d,f)}),Eh=Ma("<",function(u,l,d){return l<d},function(u,l,d,f){return f.compare(l,d)<0}),Ld=Ma(">",function(u,l,d){return l>d},function(u,l,d,f){return f.compare(l,d)>0}),Md=Ma("<=",function(u,l,d){return l<=d},function(u,l,d,f){return f.compare(l,d)<=0}),Rc=Ma(">=",function(u,l,d){return l>=d},function(u,l,d,f){return f.compare(l,d)>=0});class Do{constructor(l,d,f){this.type=In,this.locale=f,this.caseSensitive=l,this.diacriticSensitive=d}static parse(l,d){if(l.length!==2)return d.error("Expected one argument.");const f=l[1];if(typeof f!="object"||Array.isArray(f))return d.error("Collator options argument must be an object.");const b=d.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Ge);if(!b)return null;const x=d.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Ge);if(!x)return null;let T=null;return f.locale&&(T=d.parse(f.locale,1,br),!T)?null:new Do(b,x,T)}evaluate(l){return new Ln(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}class ra{constructor(l,d,f,b,x){this.type=br,this.number=l,this.locale=d,this.currency=f,this.minFractionDigits=b,this.maxFractionDigits=x}static parse(l,d){if(l.length!==3)return d.error("Expected two arguments.");const f=d.parse(l[1],1,ge);if(!f)return null;const b=l[2];if(typeof b!="object"||Array.isArray(b))return d.error("NumberFormat options argument must be an object.");let x=null;if(b.locale&&(x=d.parse(b.locale,1,br),!x))return null;let T=null;if(b.currency&&(T=d.parse(b.currency,1,br),!T))return null;let L=null;if(b["min-fraction-digits"]&&(L=d.parse(b["min-fraction-digits"],1,ge),!L))return null;let k=null;return b["max-fraction-digits"]&&(k=d.parse(b["max-fraction-digits"],1,ge),!k)?null:new ra(f,x,T,L,k)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class Fc{constructor(l){this.type=si,this.sections=l}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");const f=l[1];if(!Array.isArray(f)&&typeof f=="object")return d.error("First argument must be an image or text section.");const b=[];let x=!1;for(let T=1;T<=l.length-1;++T){const L=l[T];if(x&&typeof L=="object"&&!Array.isArray(L)){x=!1;let k=null;if(L["font-scale"]&&(k=d.parse(L["font-scale"],1,ge),!k))return null;let O=null;if(L["text-font"]&&(O=d.parse(L["text-font"],1,J(br)),!O))return null;let V=null;if(L["text-color"]&&(V=d.parse(L["text-color"],1,Hr),!V))return null;const $=b[b.length-1];$.scale=k,$.font=O,$.textColor=V}else{const k=d.parse(l[T],1,je);if(!k)return null;const O=k.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,b.push({content:k,scale:null,font:null,textColor:null})}}return new Fc(b)}evaluate(l){return new ki(this.sections.map(d=>{const f=d.content.evaluate(l);return xi(f)===an?new ls("",f,null,null,null):new ls(Kr(f),null,d.scale?d.scale.evaluate(l):null,d.font?d.font.evaluate(l).join(","):null,d.textColor?d.textColor.evaluate(l):null)}))}eachChild(l){for(const d of this.sections)l(d.content),d.scale&&l(d.scale),d.font&&l(d.font),d.textColor&&l(d.textColor)}outputDefined(){return!1}}class Ba{constructor(l){this.type=an,this.input=l}static parse(l,d){if(l.length!==2)return d.error("Expected two arguments.");const f=d.parse(l[1],1,br);return f?new Ba(f):d.error("No image name provided.")}evaluate(l){const d=this.input.evaluate(l),f=Ii.fromString(d);return f&&l.availableImages&&(f.available=l.availableImages.indexOf(d)>-1),f}eachChild(l){l(this.input)}outputDefined(){return!1}}class $l{constructor(l){this.type=ge,this.input=l}static parse(l,d){if(l.length!==2)return d.error(`Expected 1 argument, but found ${l.length-1} instead.`);const f=d.parse(l[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${Q(f.type)} instead.`):new $l(f):null}evaluate(l){const d=this.input.evaluate(l);if(typeof d=="string")return[...d].length;if(Array.isArray(d))return d.length;throw new _i(`Expected value to be of type string or array, but found ${Q(xi(d))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}const ds=8192;function Th(u,l){const d=(180+u[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,b=Math.pow(2,l.z);return[Math.round(d*b*ds),Math.round(f*b*ds)]}function Dc(u,l){const d=Math.pow(2,l.z);return[(b=(u[0]/ds+l.x)/d,360*b-180),(f=(u[1]/ds+l.y)/d,360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90)];var f,b}function ia(u,l){u[0]=Math.min(u[0],l[0]),u[1]=Math.min(u[1],l[1]),u[2]=Math.max(u[2],l[0]),u[3]=Math.max(u[3],l[1])}function No(u,l){return!(u[0]<=l[0]||u[2]>=l[2]||u[1]<=l[1]||u[3]>=l[3])}function Gr(u,l,d){const f=u[0]-l[0],b=u[1]-l[1],x=u[0]-d[0],T=u[1]-d[1];return f*T-x*b==0&&f*x<=0&&b*T<=0}function Oo(u,l,d,f){return(b=[f[0]-d[0],f[1]-d[1]])[0]*(x=[l[0]-u[0],l[1]-u[1]])[1]-b[1]*x[0]!=0&&!(!Ch(u,l,d,f)||!Ch(d,f,u,l));var b,x}function Bd(u,l,d){for(const f of d)for(let b=0;b<f.length-1;++b)if(Oo(u,l,f[b],f[b+1]))return!0;return!1}function Us(u,l){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,f=!1;for(const L of l)for(let k=0;k<L.length-1;k++){if(Gr(u,L[k],L[k+1]))return d;(x=L[k])[1]>(b=u)[1]!=(T=L[k+1])[1]>b[1]&&b[0]<(T[0]-x[0])*(b[1]-x[1])/(T[1]-x[1])+x[0]&&(f=!f)}var b,x,T;return f}function zo(u,l){for(const d of l)if(Us(u,d))return!0;return!1}function Nc(u,l){for(const d of u)if(!Us(d,l))return!1;for(let d=0;d<u.length-1;++d)if(Bd(u[d],u[d+1],l))return!1;return!0}function Wl(u,l){for(const d of l)if(Nc(u,d))return!0;return!1}function Ch(u,l,d,f){const b=f[0]-d[0],x=f[1]-d[1],T=(u[0]-d[0])*x-b*(u[1]-d[1]),L=(l[0]-d[0])*x-b*(l[1]-d[1]);return T>0&&L<0||T<0&&L>0}function dl(u,l,d){const f=[];for(let b=0;b<u.length;b++){const x=[];for(let T=0;T<u[b].length;T++){const L=Th(u[b][T],d);ia(l,L),x.push(L)}f.push(x)}return f}function Ph(u,l,d){const f=[];for(let b=0;b<u.length;b++){const x=dl(u[b],l,d);f.push(x)}return f}function Oc(u,l,d,f){if(u[0]<d[0]||u[0]>d[2]){const b=.5*f;let x=u[0]-d[0]>b?-f:d[0]-u[0]>b?f:0;x===0&&(x=u[0]-d[2]>b?-f:d[2]-u[0]>b?f:0),u[0]+=x}ia(l,u)}function zc(u,l,d,f){const b=Math.pow(2,f.z)*ds,x=[f.x*ds,f.y*ds],T=[];for(const L of u)for(const k of L){const O=[k.x+x[0],k.y+x[1]];Oc(O,l,d,b),T.push(O)}return T}function Lu(u,l,d,f){const b=Math.pow(2,f.z)*ds,x=[f.x*ds,f.y*ds],T=[];for(const k of u){const O=[];for(const V of k){const $=[V.x+x[0],V.y+x[1]];ia(l,$),O.push($)}T.push(O)}if(l[2]-l[0]<=b/2){(L=l)[0]=L[1]=1/0,L[2]=L[3]=-1/0;for(const k of T)for(const O of k)Oc(O,l,d,b)}var L;return T}class ro{constructor(l,d){this.type=Ge,this.geojson=l,this.geometries=d}static parse(l,d){if(l.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(cs(l[1])){const f=l[1];if(f.type==="FeatureCollection"){const b=[];for(const x of f.features){const{type:T,coordinates:L}=x.geometry;T==="Polygon"&&b.push(L),T==="MultiPolygon"&&b.push(...L)}if(b.length)return new ro(f,{type:"MultiPolygon",coordinates:b})}else if(f.type==="Feature"){const b=f.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new ro(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new ro(f,f)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(d,f){const b=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],T=d.canonicalID();if(f.type==="Polygon"){const L=dl(f.coordinates,x,T),k=zc(d.geometry(),b,x,T);if(!No(b,x))return!1;for(const O of k)if(!Us(O,L))return!1}if(f.type==="MultiPolygon"){const L=Ph(f.coordinates,x,T),k=zc(d.geometry(),b,x,T);if(!No(b,x))return!1;for(const O of k)if(!zo(O,L))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(d,f){const b=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],T=d.canonicalID();if(f.type==="Polygon"){const L=dl(f.coordinates,x,T),k=Lu(d.geometry(),b,x,T);if(!No(b,x))return!1;for(const O of k)if(!Nc(O,L))return!1}if(f.type==="MultiPolygon"){const L=Ph(f.coordinates,x,T),k=Lu(d.geometry(),b,x,T);if(!No(b,x))return!1;for(const O of k)if(!Wl(O,L))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let jc=class{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(d,f)=>d<f?-1:d>f?1:0;if(this.data=u,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(u){this.data.push(u),this._up(this.length++)}pop(){if(this.length===0)return;const u=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:l,compare:d}=this,f=l[u];for(;u>0;){const b=u-1>>1,x=l[b];if(d(f,x)>=0)break;l[u]=x,u=b}l[u]=f}_down(u){const{data:l,compare:d}=this,f=this.length>>1,b=l[u];for(;u<f;){let x=1+(u<<1);const T=x+1;if(T<this.length&&d(l[T],l[x])<0&&(x=T),d(l[x],b)>=0)break;l[u]=l[x],u=x}l[u]=b}};function Mu(u,l,d,f,b){Bu(u,l,d,f||u.length-1,b||Uc)}function Bu(u,l,d,f,b){for(;f>d;){if(f-d>600){var x=f-d+1,T=l-d+1,L=Math.log(x),k=.5*Math.exp(2*L/3),O=.5*Math.sqrt(L*k*(x-k)/x)*(T-x/2<0?-1:1);Bu(u,l,Math.max(d,Math.floor(l-T*k/x+O)),Math.min(f,Math.floor(l+(x-T)*k/x+O)),b)}var V=u[l],$=d,K=f;for(Xl(u,d,l),b(u[f],V)>0&&Xl(u,d,f);$<K;){for(Xl(u,$,K),$++,K--;b(u[$],V)<0;)$++;for(;b(u[K],V)>0;)K--}b(u[d],V)===0?Xl(u,d,K):Xl(u,++K,f),K<=l&&(d=K+1),l<=K&&(f=K-1)}}function Xl(u,l,d){var f=u[l];u[l]=u[d],u[d]=f}function Uc(u,l){return u<l?-1:u>l?1:0}function na(u,l){if(u.length<=1)return[u];const d=[];let f,b;for(const x of u){const T=pl(x);T!==0&&(x.area=Math.abs(T),b===void 0&&(b=T<0),b===T<0?(f&&d.push(f),f=[x]):f.push(x))}if(f&&d.push(f),l>1)for(let x=0;x<d.length;x++)d[x].length<=l||(Mu(d[x],l,1,d[x].length-1,ku),d[x]=d[x].slice(0,l));return d}function ku(u,l){return l.area-u.area}function pl(u){let l=0;for(let d,f,b=0,x=u.length,T=x-1;b<x;T=b++)d=u[b],f=u[T],l+=(f.x-d.x)*(d.y+f.y);return l}const Gc=1/298.257223563,R=Gc*(2-Gc),rt=Math.PI/180;class Ct{constructor(l){const d=6378.137*rt*1e3,f=Math.cos(l*rt),b=1/(1-R*(1-f*f)),x=Math.sqrt(b);this.kx=d*x*f,this.ky=d*x*b*(1-R)}distance(l,d){const f=this.wrap(l[0]-d[0])*this.kx,b=(l[1]-d[1])*this.ky;return Math.sqrt(f*f+b*b)}pointOnLine(l,d){let f,b,x,T,L=1/0;for(let k=0;k<l.length-1;k++){let O=l[k][0],V=l[k][1],$=this.wrap(l[k+1][0]-O)*this.kx,K=(l[k+1][1]-V)*this.ky,et=0;$===0&&K===0||(et=(this.wrap(d[0]-O)*this.kx*$+(d[1]-V)*this.ky*K)/($*$+K*K),et>1?(O=l[k+1][0],V=l[k+1][1]):et>0&&(O+=$/this.kx*et,V+=K/this.ky*et)),$=this.wrap(d[0]-O)*this.kx,K=(d[1]-V)*this.ky;const lt=$*$+K*K;lt<L&&(L=lt,f=O,b=V,x=k,T=et)}return{point:[f,b],index:x,t:Math.max(0,Math.min(1,T))}}wrap(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}}function Ut(u,l){return l[0]-u[0]}function Yt(u){return u[1]-u[0]+1}function ce(u,l){return u[1]>=u[0]&&u[1]<l}function Le(u,l){if(u[0]>u[1])return[null,null];const d=Yt(u);if(l){if(d===2)return[u,null];const b=Math.floor(d/2);return[[u[0],u[0]+b],[u[0]+b,u[1]]]}if(d===1)return[u,null];const f=Math.floor(d/2)-1;return[[u[0],u[0]+f],[u[0]+f+1,u[1]]]}function $e(u,l){if(!ce(l,u.length))return[1/0,1/0,-1/0,-1/0];const d=[1/0,1/0,-1/0,-1/0];for(let f=l[0];f<=l[1];++f)ia(d,u[f]);return d}function _r(u){const l=[1/0,1/0,-1/0,-1/0];for(const d of u)for(const f of d)ia(l,f);return l}function Mr(u){return u[0]!==-1/0&&u[1]!==-1/0&&u[2]!==1/0&&u[3]!==1/0}function Or(u,l,d){if(!Mr(u)||!Mr(l))return NaN;let f=0,b=0;return u[2]<l[0]&&(f=l[0]-u[2]),u[0]>l[2]&&(f=u[0]-l[2]),u[1]>l[3]&&(b=u[1]-l[3]),u[3]<l[1]&&(b=l[1]-u[3]),d.distance([0,0],[f,b])}function Vr(u,l,d){const f=d.pointOnLine(l,u);return d.distance(u,f.point)}function Di(u,l,d,f,b){const x=Math.min(Vr(u,[d,f],b),Vr(l,[d,f],b)),T=Math.min(Vr(d,[u,l],b),Vr(f,[u,l],b));return Math.min(x,T)}function ln(u,l,d,f,b){if(!ce(l,u.length)||!ce(f,d.length))return 1/0;let x=1/0;for(let T=l[0];T<l[1];++T){const L=u[T],k=u[T+1];for(let O=f[0];O<f[1];++O){const V=d[O],$=d[O+1];if(Oo(L,k,V,$))return 0;x=Math.min(x,Di(L,k,V,$,b))}}return x}function zr(u,l,d,f,b){if(!ce(l,u.length)||!ce(f,d.length))return NaN;let x=1/0;for(let T=l[0];T<=l[1];++T)for(let L=f[0];L<=f[1];++L)if(x=Math.min(x,b.distance(u[T],d[L])),x===0)return x;return x}function Zn(u,l,d){if(Us(u,l,!0))return 0;let f=1/0;for(const b of l){const x=b[0],T=b[b.length-1];if(x!==T&&(f=Math.min(f,Vr(u,[T,x],d)),f===0))return f;const L=d.pointOnLine(b,u);if(f=Math.min(f,d.distance(u,L.point)),f===0)return f}return f}function fr(u,l,d,f){if(!ce(l,u.length))return NaN;for(let x=l[0];x<=l[1];++x)if(Us(u[x],d,!0))return 0;let b=1/0;for(let x=l[0];x<l[1];++x){const T=u[x],L=u[x+1];for(const k of d)for(let O=0,V=k.length,$=V-1;O<V;$=O++){const K=k[$],et=k[O];if(Oo(T,L,K,et))return 0;b=Math.min(b,Di(T,L,K,et,f))}}return b}function Es(u,l){for(const d of u)for(const f of d)if(Us(f,l,!0))return!0;return!1}function Zr(u,l,d){let f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/0;const b=_r(u),x=_r(l);if(f!==1/0&&Or(b,x,d)>=f)return f;if(No(b,x)){if(Es(u,l))return 0}else if(Es(l,u))return 0;let T=1/0;for(const L of u)for(let k=0,O=L.length,V=O-1;k<O;V=k++){const $=L[V],K=L[k];for(const et of l)for(let lt=0,ft=et.length,Tt=ft-1;lt<ft;Tt=lt++){const Mt=et[Tt],Jt=et[lt];if(Oo($,K,Mt,Jt))return 0;T=Math.min(T,Di($,K,Mt,Jt,d))}}return T}function Qr(u,l,d,f,b,x){if(!x)return;const T=Or($e(f,x),b,d);T<l&&u.push([T,x,[0,0]])}function sa(u,l,d,f,b,x,T){if(!x||!T)return;const L=Or($e(f,x),$e(b,T),d);L<l&&u.push([L,x,T])}function ka(u,l,d,f){let b=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1/0,x=Math.min(f.distance(u[0],d[0][0]),b);if(x===0)return x;const T=new jc([[0,[0,u.length-1],[0,0]]],Ut),L=_r(d);for(;T.length>0;){const k=T.pop();if(k[0]>=x)continue;const O=k[1],V=l?50:100;if(Yt(O)<=V){if(!ce(O,u.length))return NaN;if(l){const $=fr(u,O,d,f);if(isNaN($)||$===0)return $;x=Math.min(x,$)}else for(let $=O[0];$<=O[1];++$){const K=Zn(u[$],d,f);if(x=Math.min(x,K),x===0)return 0}}else{const $=Le(O,l);Qr(T,x,f,u,L,$[0]),Qr(T,x,f,u,L,$[1])}}return x}function Ra(u,l,d,f,b){let x=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,T=Math.min(x,b.distance(u[0],d[0]));if(T===0)return T;const L=new jc([[0,[0,u.length-1],[0,d.length-1]]],Ut);for(;L.length>0;){const k=L.pop();if(k[0]>=T)continue;const O=k[1],V=k[2],$=l?50:100,K=f?50:100;if(Yt(O)<=$&&Yt(V)<=K){if(!ce(O,u.length)&&ce(V,d.length))return NaN;let et;if(l&&f)et=ln(u,O,d,V,b),T=Math.min(T,et);else if(l&&!f){const lt=u.slice(O[0],O[1]+1);for(let ft=V[0];ft<=V[1];++ft)if(et=Vr(d[ft],lt,b),T=Math.min(T,et),T===0)return T}else if(!l&&f){const lt=d.slice(V[0],V[1]+1);for(let ft=O[0];ft<=O[1];++ft)if(et=Vr(u[ft],lt,b),T=Math.min(T,et),T===0)return T}else et=zr(u,O,d,V,b),T=Math.min(T,et)}else{const et=Le(O,l),lt=Le(V,f);sa(L,T,b,u,d,et[0],lt[0]),sa(L,T,b,u,d,et[0],lt[1]),sa(L,T,b,u,d,et[1],lt[0]),sa(L,T,b,u,d,et[1],lt[1])}}return T}function fl(u){return u.type==="MultiPolygon"?u.coordinates.map(l=>({type:"Polygon",coordinates:l})):u.type==="MultiLineString"?u.coordinates.map(l=>({type:"LineString",coordinates:l})):u.type==="MultiPoint"?u.coordinates.map(l=>({type:"Point",coordinates:l})):[u]}class jo{constructor(l,d){this.type=ge,this.geojson=l,this.geometries=d}static parse(l,d){if(l.length!==2)return d.error(`'distance' expression requires exactly one argument, but found ${l.length-1} instead.`);if(cs(l[1])){const f=l[1];if(f.type==="FeatureCollection")return new jo(f,f.features.map(b=>fl(b.geometry)).flat());if(f.type==="Feature")return new jo(f,fl(f.geometry));if("type"in f&&"coordinates"in f)return new jo(f,fl(f))}return d.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(d,f){const b=d.geometry(),x=b.flat().map(k=>Dc([k.x,k.y],d.canonical));if(b.length===0)return NaN;const T=new Ct(x[0][1]);let L=1/0;for(const k of f){switch(k.type){case"Point":L=Math.min(L,Ra(x,!1,[k.coordinates],!1,T,L));break;case"LineString":L=Math.min(L,Ra(x,!1,k.coordinates,!0,T,L));break;case"Polygon":L=Math.min(L,ka(x,!1,k.coordinates,T,L))}if(L===0)return L}return L}(l,this.geometries);if(l.geometryType()==="LineString")return function(d,f){const b=d.geometry(),x=b.flat().map(k=>Dc([k.x,k.y],d.canonical));if(b.length===0)return NaN;const T=new Ct(x[0][1]);let L=1/0;for(const k of f){switch(k.type){case"Point":L=Math.min(L,Ra(x,!0,[k.coordinates],!1,T,L));break;case"LineString":L=Math.min(L,Ra(x,!0,k.coordinates,!0,T,L));break;case"Polygon":L=Math.min(L,ka(x,!0,k.coordinates,T,L))}if(L===0)return L}return L}(l,this.geometries);if(l.geometryType()==="Polygon")return function(d,f){const b=d.geometry();if(b.length===0||b[0].length===0)return NaN;const x=na(b,0).map(k=>k.map(O=>O.map(V=>Dc([V.x,V.y],d.canonical)))),T=new Ct(x[0][0][0][1]);let L=1/0;for(const k of f)for(const O of x){switch(k.type){case"Point":L=Math.min(L,ka([k.coordinates],!1,O,T,L));break;case"LineString":L=Math.min(L,ka(k.coordinates,!0,O,T,L));break;case"Polygon":L=Math.min(L,Zr(O,k.coordinates,T,L))}if(L===0)return L}return L}(l,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const oa={"==":Bc,"!=":kc,">":Ld,"<":Eh,">=":Rc,"<=":Md,array:wn,at:hl,boolean:wn,case:zt,coalesce:Mc,collator:Do,format:Fc,image:Ba,in:ql,"index-of":ot,interpolate:pr,"interpolate-hcl":pr,"interpolate-lab":pr,length:$l,let:hs,literal:bn,match:_t,number:wn,"number-format":ra,object:wn,slice:oe,step:ar,string:wn,"to-boolean":Li,"to-color":Li,"to-number":Li,"to-string":Li,var:Xr,within:ro,distance:jo};class Gn{constructor(l,d,f,b){this.name=l,this.type=d,this._evaluate=f,this.args=b}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,d){const f=l[0],b=Gn.definitions[f];if(!b)return d.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(b)?b[0]:b.type,T=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,L=T.filter(O=>{let[V]=O;return!Array.isArray(V)||V.length===l.length-1});let k=null;for(const[O,V]of L){k=new As(d.registry,Fa,d.path,null,d.scope);const $=[];let K=!1;for(let et=1;et<l.length;et++){const lt=l[et],ft=Array.isArray(O)?O[et-1]:O.type,Tt=k.parse(lt,1+$.length,ft);if(!Tt){K=!0;break}$.push(Tt)}if(!K)if(Array.isArray(O)&&O.length!==$.length)k.error(`Expected ${O.length} arguments, but found ${$.length} instead.`);else{for(let et=0;et<$.length;et++){const lt=Array.isArray(O)?O[et]:O.type,ft=$[et];k.concat(et+1).checkSubtype(lt,ft.type)}if(k.errors.length===0)return new Gn(f,x,V,$)}}if(L.length===1)d.errors.push(...k.errors);else{const O=(L.length?L:T).map($=>{let[K]=$;return et=K,Array.isArray(et)?`(${et.map(Q).join(", ")})`:`(${Q(et.type)}...)`;var et}).join(" | "),V=[];for(let $=1;$<l.length;$++){const K=d.parse(l[$],1+V.length);if(!K)return null;V.push(Q(K.type))}d.error(`Expected arguments of type ${O}, but found (${V.join(", ")}) instead.`)}return null}static register(l,d){Gn.definitions=d;for(const f in d)l[f]=Gn}}function Yn(u,l){let[d,f,b,x]=l;d=d.evaluate(u),f=f.evaluate(u),b=b.evaluate(u);const T=x?x.evaluate(u):1,L=Ro(d,f,b,T);if(L)throw new _i(L);return new Jr(d/255,f/255,b/255,T,!1)}function ml(u,l){return u in l}function gl(u,l){const d=l[u];return d===void 0?null:d}function io(u){return{type:u}}function Fa(u){if(u instanceof Xr)return Fa(u.boundExpression);if(u instanceof Gn&&u.name==="error"||u instanceof Do||u instanceof ro||u instanceof jo)return!1;const l=u instanceof Li||u instanceof wn;let d=!0;return u.eachChild(f=>{d=l?d&&Fa(f):d&&f instanceof bn}),!!d&&Bn(u)&&Da(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Bn(u){if(u instanceof Gn&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof ro||u instanceof jo)return!1;let l=!0;return u.eachChild(d=>{l&&!Bn(d)&&(l=!1)}),l}function yl(u){if(u instanceof Gn&&u.name==="feature-state")return!1;let l=!0;return u.eachChild(d=>{l&&!yl(d)&&(l=!1)}),l}function Da(u,l){if(u instanceof Gn&&l.indexOf(u.name)>=0)return!1;let d=!0;return u.eachChild(f=>{d&&!Da(f,l)&&(d=!1)}),d}function Zl(u){return{result:"success",value:u}}function Jn(u){return{result:"error",value:u}}function aa(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function Ih(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function Ru(u){return!!u.expression&&u.expression.interpolated}function jr(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function ps(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function Uo(u){return u}function Na(u,l){const d=l.type==="color",f=u.stops&&typeof u.stops[0][0]=="object",b=f||!(f||u.property!==void 0),x=u.type||(Ru(l)?"exponential":"interval");if(d||l.type==="padding"){const V=d?Jr.parse:Ri.parse;(u=hr({},u)).stops&&(u.stops=u.stops.map($=>[$[0],V($[1])])),u.default=V(u.default?u.default:l.default)}if(u.colorSpace&&(T=u.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var T;let L,k,O;if(x==="exponential")L=no;else if(x==="interval")L=Oa;else if(x==="categorical"){L=la,k=Object.create(null);for(const V of u.stops)k[V[0]]=V[1];O=typeof u.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);L=Yl}if(f){const V={},$=[];for(let lt=0;lt<u.stops.length;lt++){const ft=u.stops[lt],Tt=ft[0].zoom;V[Tt]===void 0&&(V[Tt]={zoom:Tt,type:u.type,property:u.property,default:u.default,stops:[]},$.push(Tt)),V[Tt].stops.push([ft[0].value,ft[1]])}const K=[];for(const lt of $)K.push([V[lt].zoom,Na(V[lt],l)]);const et={name:"linear"};return{kind:"composite",interpolationType:et,interpolationFactor:pr.interpolationFactor.bind(void 0,et),zoomStops:K.map(lt=>lt[0]),evaluate:(lt,ft)=>{let{zoom:Tt}=lt;return no({stops:K,base:u.base},l,Tt).evaluate(Tt,ft)}}}if(b){const V=x==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:V,interpolationFactor:pr.interpolationFactor.bind(void 0,V),zoomStops:u.stops.map($=>$[0]),evaluate:$=>{let{zoom:K}=$;return L(u,l,K,k,O)}}}return{kind:"source",evaluate(V,$){const K=$&&$.properties?$.properties[u.property]:void 0;return K===void 0?fs(u.default,l.default):L(u,l,K,k,O)}}}function fs(u,l,d){return u!==void 0?u:l!==void 0?l:d!==void 0?d:void 0}function la(u,l,d,f,b){return fs(typeof d===b?f[d]:void 0,u.default,l.default)}function Oa(u,l,d){if(jr(d)!=="number")return fs(u.default,l.default);const f=u.stops.length;if(f===1||d<=u.stops[0][0])return u.stops[0][1];if(d>=u.stops[f-1][0])return u.stops[f-1][1];const b=Ae(u.stops.map(x=>x[0]),d);return u.stops[b][1]}function no(u,l,d){const f=u.base!==void 0?u.base:1;if(jr(d)!=="number")return fs(u.default,l.default);const b=u.stops.length;if(b===1||d<=u.stops[0][0])return u.stops[0][1];if(d>=u.stops[b-1][0])return u.stops[b-1][1];const x=Ae(u.stops.map(V=>V[0]),d),T=function(V,$,K,et){const lt=et-K,ft=V-K;return lt===0?0:$===1?ft/lt:(Math.pow($,ft)-1)/(Math.pow($,lt)-1)}(d,f,u.stops[x][0],u.stops[x+1][0]),L=u.stops[x][1],k=u.stops[x+1][1],O=Un[l.type]||Uo;return typeof L.evaluate=="function"?{evaluate(){for(var V=arguments.length,$=new Array(V),K=0;K<V;K++)$[K]=arguments[K];const et=L.evaluate.apply(void 0,$),lt=k.evaluate.apply(void 0,$);if(et!==void 0&&lt!==void 0)return O(et,lt,T,u.colorSpace)}}:O(L,k,T,u.colorSpace)}function Yl(u,l,d){switch(l.type){case"color":d=Jr.parse(d);break;case"formatted":d=ki.fromString(d.toString());break;case"resolvedImage":d=Ii.fromString(d.toString());break;case"padding":d=Ri.parse(d);break;default:jr(d)===l.type||l.type==="enum"&&l.values[d]||(d=void 0)}return fs(d,u.default,l.default)}Gn.register(oa,{error:[{kind:"error"},[br],(u,l)=>{let[d]=l;throw new _i(d.evaluate(u))}],typeof:[br,[je],(u,l)=>{let[d]=l;return Q(xi(d.evaluate(u)))}],"to-rgba":[J(ge,4),[Hr],(u,l)=>{let[d]=l;const[f,b,x,T]=d.evaluate(u).rgb;return[255*f,255*b,255*x,T]}],rgb:[Hr,[ge,ge,ge],Yn],rgba:[Hr,[ge,ge,ge,ge],Yn],has:{type:Ge,overloads:[[[br],(u,l)=>{let[d]=l;return ml(d.evaluate(u),u.properties())}],[[br,Qi],(u,l)=>{let[d,f]=l;return ml(d.evaluate(u),f.evaluate(u))}]]},get:{type:je,overloads:[[[br],(u,l)=>{let[d]=l;return gl(d.evaluate(u),u.properties())}],[[br,Qi],(u,l)=>{let[d,f]=l;return gl(d.evaluate(u),f.evaluate(u))}]]},"feature-state":[je,[br],(u,l)=>{let[d]=l;return gl(d.evaluate(u),u.featureState||{})}],properties:[Qi,[],u=>u.properties()],"geometry-type":[br,[],u=>u.geometryType()],id:[je,[],u=>u.id()],zoom:[ge,[],u=>u.globals.zoom],"heatmap-density":[ge,[],u=>u.globals.heatmapDensity||0],"line-progress":[ge,[],u=>u.globals.lineProgress||0],accumulated:[je,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[ge,io(ge),(u,l)=>{let d=0;for(const f of l)d+=f.evaluate(u);return d}],"*":[ge,io(ge),(u,l)=>{let d=1;for(const f of l)d*=f.evaluate(u);return d}],"-":{type:ge,overloads:[[[ge,ge],(u,l)=>{let[d,f]=l;return d.evaluate(u)-f.evaluate(u)}],[[ge],(u,l)=>{let[d]=l;return-d.evaluate(u)}]]},"/":[ge,[ge,ge],(u,l)=>{let[d,f]=l;return d.evaluate(u)/f.evaluate(u)}],"%":[ge,[ge,ge],(u,l)=>{let[d,f]=l;return d.evaluate(u)%f.evaluate(u)}],ln2:[ge,[],()=>Math.LN2],pi:[ge,[],()=>Math.PI],e:[ge,[],()=>Math.E],"^":[ge,[ge,ge],(u,l)=>{let[d,f]=l;return Math.pow(d.evaluate(u),f.evaluate(u))}],sqrt:[ge,[ge],(u,l)=>{let[d]=l;return Math.sqrt(d.evaluate(u))}],log10:[ge,[ge],(u,l)=>{let[d]=l;return Math.log(d.evaluate(u))/Math.LN10}],ln:[ge,[ge],(u,l)=>{let[d]=l;return Math.log(d.evaluate(u))}],log2:[ge,[ge],(u,l)=>{let[d]=l;return Math.log(d.evaluate(u))/Math.LN2}],sin:[ge,[ge],(u,l)=>{let[d]=l;return Math.sin(d.evaluate(u))}],cos:[ge,[ge],(u,l)=>{let[d]=l;return Math.cos(d.evaluate(u))}],tan:[ge,[ge],(u,l)=>{let[d]=l;return Math.tan(d.evaluate(u))}],asin:[ge,[ge],(u,l)=>{let[d]=l;return Math.asin(d.evaluate(u))}],acos:[ge,[ge],(u,l)=>{let[d]=l;return Math.acos(d.evaluate(u))}],atan:[ge,[ge],(u,l)=>{let[d]=l;return Math.atan(d.evaluate(u))}],min:[ge,io(ge),(u,l)=>Math.min(...l.map(d=>d.evaluate(u)))],max:[ge,io(ge),(u,l)=>Math.max(...l.map(d=>d.evaluate(u)))],abs:[ge,[ge],(u,l)=>{let[d]=l;return Math.abs(d.evaluate(u))}],round:[ge,[ge],(u,l)=>{let[d]=l;const f=d.evaluate(u);return f<0?-Math.round(-f):Math.round(f)}],floor:[ge,[ge],(u,l)=>{let[d]=l;return Math.floor(d.evaluate(u))}],ceil:[ge,[ge],(u,l)=>{let[d]=l;return Math.ceil(d.evaluate(u))}],"filter-==":[Ge,[br,je],(u,l)=>{let[d,f]=l;return u.properties()[d.value]===f.value}],"filter-id-==":[Ge,[je],(u,l)=>{let[d]=l;return u.id()===d.value}],"filter-type-==":[Ge,[br],(u,l)=>{let[d]=l;return u.geometryType()===d.value}],"filter-<":[Ge,[br,je],(u,l)=>{let[d,f]=l;const b=u.properties()[d.value],x=f.value;return typeof b==typeof x&&b<x}],"filter-id-<":[Ge,[je],(u,l)=>{let[d]=l;const f=u.id(),b=d.value;return typeof f==typeof b&&f<b}],"filter->":[Ge,[br,je],(u,l)=>{let[d,f]=l;const b=u.properties()[d.value],x=f.value;return typeof b==typeof x&&b>x}],"filter-id->":[Ge,[je],(u,l)=>{let[d]=l;const f=u.id(),b=d.value;return typeof f==typeof b&&f>b}],"filter-<=":[Ge,[br,je],(u,l)=>{let[d,f]=l;const b=u.properties()[d.value],x=f.value;return typeof b==typeof x&&b<=x}],"filter-id-<=":[Ge,[je],(u,l)=>{let[d]=l;const f=u.id(),b=d.value;return typeof f==typeof b&&f<=b}],"filter->=":[Ge,[br,je],(u,l)=>{let[d,f]=l;const b=u.properties()[d.value],x=f.value;return typeof b==typeof x&&b>=x}],"filter-id->=":[Ge,[je],(u,l)=>{let[d]=l;const f=u.id(),b=d.value;return typeof f==typeof b&&f>=b}],"filter-has":[Ge,[je],(u,l)=>{let[d]=l;return d.value in u.properties()}],"filter-has-id":[Ge,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[Ge,[J(br)],(u,l)=>{let[d]=l;return d.value.indexOf(u.geometryType())>=0}],"filter-id-in":[Ge,[J(je)],(u,l)=>{let[d]=l;return d.value.indexOf(u.id())>=0}],"filter-in-small":[Ge,[br,J(je)],(u,l)=>{let[d,f]=l;return f.value.indexOf(u.properties()[d.value])>=0}],"filter-in-large":[Ge,[br,J(je)],(u,l)=>{let[d,f]=l;return function(b,x,T,L){for(;T<=L;){const k=T+L>>1;if(x[k]===b)return!0;x[k]>b?L=k-1:T=k+1}return!1}(u.properties()[d.value],f.value,0,f.value.length-1)}],all:{type:Ge,overloads:[[[Ge,Ge],(u,l)=>{let[d,f]=l;return d.evaluate(u)&&f.evaluate(u)}],[io(Ge),(u,l)=>{for(const d of l)if(!d.evaluate(u))return!1;return!0}]]},any:{type:Ge,overloads:[[[Ge,Ge],(u,l)=>{let[d,f]=l;return d.evaluate(u)||f.evaluate(u)}],[io(Ge),(u,l)=>{for(const d of l)if(d.evaluate(u))return!0;return!1}]]},"!":[Ge,[Ge],(u,l)=>{let[d]=l;return!d.evaluate(u)}],"is-supported-script":[Ge,[br],(u,l)=>{let[d]=l;const f=u.globals&&u.globals.isSupportedScript;return!f||f(d.evaluate(u))}],upcase:[br,[br],(u,l)=>{let[d]=l;return d.evaluate(u).toUpperCase()}],downcase:[br,[br],(u,l)=>{let[d]=l;return d.evaluate(u).toLowerCase()}],concat:[br,io(je),(u,l)=>l.map(d=>Kr(d.evaluate(u))).join("")],"resolved-locale":[br,[In],(u,l)=>{let[d]=l;return d.evaluate(u).resolvedLocale()}]});class _l{constructor(l,d){var f;this.expression=l,this._warningHistory={},this._evaluator=new xn,this._defaultValue=d?(f=d).type==="color"&&ps(f.default)?new Jr(0,0,0,0):f.type==="color"?Jr.parse(f.default)||null:f.type==="padding"?Ri.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?Fi.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=d&&d.type==="enum"?d.values:null}evaluateWithoutErrorHandling(l,d,f,b,x,T){return this._evaluator.globals=l,this._evaluator.feature=d,this._evaluator.featureState=f,this._evaluator.canonical=b,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(l,d,f,b,x,T){this._evaluator.globals=l,this._evaluator.feature=d||null,this._evaluator.featureState=f||null,this._evaluator.canonical=b,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=T||null;try{const L=this.expression.evaluate(this._evaluator);if(L==null||typeof L=="number"&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new _i(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}}}function Go(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in oa}function Kn(u,l){const d=new As(oa,Fa,[],l?function(b){const x={color:Hr,string:br,number:ge,enum:br,boolean:Ge,formatted:si,padding:on,resolvedImage:an,variableAnchorOffsetCollection:At};return b.type==="array"?J(x[b.value]||je,b.length):x[b.type]}(l):void 0),f=d.parse(u,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Zl(new _l(f,l)):Jn(d.errors)}class Ts{constructor(l,d){this.kind=l,this._styleExpression=d,this.isStateDependent=l!=="constant"&&!yl(d.expression)}evaluateWithoutErrorHandling(l,d,f,b,x,T){return this._styleExpression.evaluateWithoutErrorHandling(l,d,f,b,x,T)}evaluate(l,d,f,b,x,T){return this._styleExpression.evaluate(l,d,f,b,x,T)}}class so{constructor(l,d,f,b){this.kind=l,this.zoomStops=f,this._styleExpression=d,this.isStateDependent=l!=="camera"&&!yl(d.expression),this.interpolationType=b}evaluateWithoutErrorHandling(l,d,f,b,x,T){return this._styleExpression.evaluateWithoutErrorHandling(l,d,f,b,x,T)}evaluate(l,d,f,b,x,T){return this._styleExpression.evaluate(l,d,f,b,x,T)}interpolationFactor(l,d,f){return this.interpolationType?pr.interpolationFactor(this.interpolationType,l,d,f):0}}function vl(u,l){const d=Kn(u,l);if(d.result==="error")return d;const f=d.value.expression,b=Bn(f);if(!b&&!aa(l))return Jn([new xr("","data expressions not supported")]);const x=Da(f,["zoom"]);if(!x&&!Ih(l))return Jn([new xr("","zoom expressions not supported")]);const T=ao(f);return T||x?T instanceof xr?Jn([T]):T instanceof pr&&!Ru(l)?Jn([new xr("",'"interpolate" expressions cannot be used with this property')]):Zl(T?new so(b?"camera":"composite",d.value,T.labels,T instanceof pr?T.interpolation:void 0):new Ts(b?"constant":"source",d.value)):Jn([new xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class oo{constructor(l,d){this._parameters=l,this._specification=d,hr(this,Na(this._parameters,this._specification))}static deserialize(l){return new oo(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function ao(u){let l=null;if(u instanceof hs)l=ao(u.result);else if(u instanceof Mc){for(const d of u.args)if(l=ao(d),l)break}else(u instanceof ar||u instanceof pr)&&u.input instanceof Gn&&u.input.name==="zoom"&&(l=u);return l instanceof xr||u.eachChild(d=>{const f=ao(d);f instanceof xr?l=f:!l&&f?l=new xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&f&&l!==f&&(l=new xr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}function bl(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const l of u.slice(1))if(!bl(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}const ms={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Vo(u){if(u==null)return{filter:()=>!0,needGeometry:!1};bl(u)||(u=qi(u));const l=Kn(u,ms);if(l.result==="error")throw new Error(l.value.map(d=>`${d.key}: ${d.message}`).join(", "));return{filter:(d,f,b)=>l.value.evaluate(d,f,{},b),needGeometry:Si(u)}}function Mi(u,l){return u<l?-1:u>l?1:0}function Si(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let l=1;l<u.length;l++)if(Si(u[l]))return!0;return!1}function qi(u){if(!u)return!0;const l=u[0];return u.length<=1?l!=="any":l==="=="?cn(u[1],u[2],"=="):l==="!="?un(cn(u[1],u[2],"==")):l==="<"||l===">"||l==="<="||l===">="?cn(u[1],u[2],l):l==="any"?(d=u.slice(1),["any"].concat(d.map(qi))):l==="all"?["all"].concat(u.slice(1).map(qi)):l==="none"?["all"].concat(u.slice(1).map(qi).map(un)):l==="in"?Gs(u[1],u.slice(2)):l==="!in"?un(Gs(u[1],u.slice(2))):l==="has"?lo(u[1]):l!=="!has"||un(lo(u[1]));var d}function cn(u,l,d){switch(u){case"$type":return[`filter-type-${d}`,l];case"$id":return[`filter-id-${d}`,l];default:return[`filter-${d}`,u,l]}}function Gs(u,l){if(l.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(d=>typeof d!=typeof l[0])?["filter-in-large",u,["literal",l.sort(Mi)]]:["filter-in-small",u,["literal",l]]}}function lo(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function un(u){return["!",u]}function ca(u){const l=typeof u;if(l==="number"||l==="boolean"||l==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let b="[";for(const x of u)b+=`${ca(x)},`;return`${b}]`}const d=Object.keys(u).sort();let f="{";for(let b=0;b<d.length;b++)f+=`${JSON.stringify(d[b])}:${ca(u[d[b]])},`;return`${f}}`}function kd(u){let l="";for(const d of mr)l+=`/${ca(u[d])}`;return l}function Rd(u){const l=u.value;return l?[new me(u.key,l,"constants have been deprecated as of v8")]:[]}function Zi(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function co(u){if(Array.isArray(u))return u.map(co);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const l={};for(const d in u)l[d]=co(u[d]);return l}return Zi(u)}function Cs(u){const l=u.key,d=u.value,f=u.valueSpec||{},b=u.objectElementValidators||{},x=u.style,T=u.styleSpec,L=u.validateSpec;let k=[];const O=jr(d);if(O!=="object")return[new me(l,d,`object expected, ${O} found`)];for(const V in d){const $=V.split(".")[0],K=f[$]||f["*"];let et;if(b[$])et=b[$];else if(f[$])et=L;else if(b["*"])et=b["*"];else{if(!f["*"]){k.push(new me(l,d[V],`unknown property "${V}"`));continue}et=L}k=k.concat(et({key:(l&&`${l}.`)+V,value:d[V],valueSpec:K,style:x,styleSpec:T,object:d,objectKey:V,validateSpec:L},d))}for(const V in f)b[V]||f[V].required&&f[V].default===void 0&&d[V]===void 0&&k.push(new me(l,d,`missing required property "${V}"`));return k}function Vc(u){const l=u.value,d=u.valueSpec,f=u.style,b=u.styleSpec,x=u.key,T=u.arrayElementValidator||u.validateSpec;if(jr(l)!=="array")return[new me(x,l,`array expected, ${jr(l)} found`)];if(d.length&&l.length!==d.length)return[new me(x,l,`array length ${d.length} expected, length ${l.length} found`)];if(d["min-length"]&&l.length<d["min-length"])return[new me(x,l,`array length at least ${d["min-length"]} expected, length ${l.length} found`)];let L={type:d.value,values:d.values};b.$version<7&&(L.function=d.function),jr(d.value)==="object"&&(L=d.value);let k=[];for(let O=0;O<l.length;O++)k=k.concat(T({array:l,arrayIndex:O,value:l[O],valueSpec:L,validateSpec:u.validateSpec,style:f,styleSpec:b,key:`${x}[${O}]`}));return k}function Fu(u){const l=u.key,d=u.value,f=u.valueSpec;let b=jr(d);return b==="number"&&d!=d&&(b="NaN"),b!=="number"?[new me(l,d,`number expected, ${b} found`)]:"minimum"in f&&d<f.minimum?[new me(l,d,`${d} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&d>f.maximum?[new me(l,d,`${d} is greater than the maximum value ${f.maximum}`)]:[]}function Jl(u){const l=u.valueSpec,d=Zi(u.value.type);let f,b,x,T={};const L=d!=="categorical"&&u.value.property===void 0,k=!L,O=jr(u.value.stops)==="array"&&jr(u.value.stops[0])==="array"&&jr(u.value.stops[0][0])==="object",V=Cs({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(et){if(d==="identity")return[new me(et.key,et.value,'identity function may not have a "stops" property')];let lt=[];const ft=et.value;return lt=lt.concat(Vc({key:et.key,value:ft,valueSpec:et.valueSpec,validateSpec:et.validateSpec,style:et.style,styleSpec:et.styleSpec,arrayElementValidator:$})),jr(ft)==="array"&&ft.length===0&&lt.push(new me(et.key,ft,"array must have at least one stop")),lt},default:function(et){return et.validateSpec({key:et.key,value:et.value,valueSpec:l,validateSpec:et.validateSpec,style:et.style,styleSpec:et.styleSpec})}}});return d==="identity"&&L&&V.push(new me(u.key,u.value,'missing required property "property"')),d==="identity"||u.value.stops||V.push(new me(u.key,u.value,'missing required property "stops"')),d==="exponential"&&u.valueSpec.expression&&!Ru(u.valueSpec)&&V.push(new me(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(k&&!aa(u.valueSpec)?V.push(new me(u.key,u.value,"property functions not supported")):L&&!Ih(u.valueSpec)&&V.push(new me(u.key,u.value,"zoom functions not supported"))),d!=="categorical"&&!O||u.value.property!==void 0||V.push(new me(u.key,u.value,'"property" property is required')),V;function $(et){let lt=[];const ft=et.value,Tt=et.key;if(jr(ft)!=="array")return[new me(Tt,ft,`array expected, ${jr(ft)} found`)];if(ft.length!==2)return[new me(Tt,ft,`array length 2 expected, length ${ft.length} found`)];if(O){if(jr(ft[0])!=="object")return[new me(Tt,ft,`object expected, ${jr(ft[0])} found`)];if(ft[0].zoom===void 0)return[new me(Tt,ft,"object stop key must have zoom")];if(ft[0].value===void 0)return[new me(Tt,ft,"object stop key must have value")];if(x&&x>Zi(ft[0].zoom))return[new me(Tt,ft[0].zoom,"stop zoom values must appear in ascending order")];Zi(ft[0].zoom)!==x&&(x=Zi(ft[0].zoom),b=void 0,T={}),lt=lt.concat(Cs({key:`${Tt}[0]`,value:ft[0],valueSpec:{zoom:{}},validateSpec:et.validateSpec,style:et.style,styleSpec:et.styleSpec,objectElementValidators:{zoom:Fu,value:K}}))}else lt=lt.concat(K({key:`${Tt}[0]`,value:ft[0],valueSpec:{},validateSpec:et.validateSpec,style:et.style,styleSpec:et.styleSpec},ft));return Go(co(ft[1]))?lt.concat([new me(`${Tt}[1]`,ft[1],"expressions are not allowed in function stops.")]):lt.concat(et.validateSpec({key:`${Tt}[1]`,value:ft[1],valueSpec:l,validateSpec:et.validateSpec,style:et.style,styleSpec:et.styleSpec}))}function K(et,lt){const ft=jr(et.value),Tt=Zi(et.value),Mt=et.value!==null?et.value:lt;if(f){if(ft!==f)return[new me(et.key,Mt,`${ft} stop domain type must match previous stop domain type ${f}`)]}else f=ft;if(ft!=="number"&&ft!=="string"&&ft!=="boolean")return[new me(et.key,Mt,"stop domain value must be a number, string, or boolean")];if(ft!=="number"&&d!=="categorical"){let Jt=`number expected, ${ft} found`;return aa(l)&&d===void 0&&(Jt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new me(et.key,Mt,Jt)]}return d!=="categorical"||ft!=="number"||isFinite(Tt)&&Math.floor(Tt)===Tt?d!=="categorical"&&ft==="number"&&b!==void 0&&Tt<b?[new me(et.key,Mt,"stop domain values must appear in ascending order")]:(b=Tt,d==="categorical"&&Tt in T?[new me(et.key,Mt,"stop domain values must be unique")]:(T[Tt]=!0,[])):[new me(et.key,Mt,`integer expected, found ${Tt}`)]}}function kn(u){const l=(u.expressionContext==="property"?vl:Kn)(co(u.value),u.valueSpec);if(l.result==="error")return l.value.map(f=>new me(`${u.key}${f.key}`,u.value,f.message));const d=l.value.expression||l.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!d.outputDefined())return[new me(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!yl(d))return[new me(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!yl(d))return[new me(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!Da(d,["zoom","feature-state"]))return[new me(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!Bn(d))return[new me(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function yn(u){const l=u.key,d=u.value,f=u.valueSpec,b=[];return Array.isArray(f.values)?f.values.indexOf(Zi(d))===-1&&b.push(new me(l,d,`expected one of [${f.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(f.values).indexOf(Zi(d))===-1&&b.push(new me(l,d,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(d)} found`)),b}function qc(u){return bl(co(u.value))?kn(hr({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Kl(u)}function Kl(u){const l=u.value,d=u.key;if(jr(l)!=="array")return[new me(d,l,`array expected, ${jr(l)} found`)];const f=u.styleSpec;let b,x=[];if(l.length<1)return[new me(d,l,"filter array must have at least 1 element")];switch(x=x.concat(yn({key:`${d}[0]`,value:l[0],valueSpec:f.filter_operator,style:u.style,styleSpec:u.styleSpec})),Zi(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&Zi(l[1])==="$type"&&x.push(new me(d,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&x.push(new me(d,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(b=jr(l[1]),b!=="string"&&x.push(new me(`${d}[1]`,l[1],`string expected, ${b} found`)));for(let T=2;T<l.length;T++)b=jr(l[T]),Zi(l[1])==="$type"?x=x.concat(yn({key:`${d}[${T}]`,value:l[T],valueSpec:f.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&x.push(new me(`${d}[${T}]`,l[T],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let T=1;T<l.length;T++)x=x.concat(Kl({key:`${d}[${T}]`,value:l[T],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=jr(l[1]),l.length!==2?x.push(new me(d,l,`filter array for "${l[0]}" operator must have 2 elements`)):b!=="string"&&x.push(new me(`${d}[1]`,l[1],`string expected, ${b} found`))}return x}function Lh(u,l){const d=u.key,f=u.validateSpec,b=u.style,x=u.styleSpec,T=u.value,L=u.objectKey,k=x[`${l}_${u.layerType}`];if(!k)return[];const O=L.match(/^(.*)-transition$/);if(l==="paint"&&O&&k[O[1]]&&k[O[1]].transition)return f({key:d,value:T,valueSpec:x.transition,style:b,styleSpec:x});const V=u.valueSpec||k[L];if(!V)return[new me(d,T,`unknown property "${L}"`)];let $;if(jr(T)==="string"&&aa(V)&&!V.tokens&&($=/^{([^}]+)}$/.exec(T)))return[new me(d,T,`"${L}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify($[1])} }\`.`)];const K=[];return u.layerType==="symbol"&&(L==="text-field"&&b&&!b.glyphs&&K.push(new me(d,T,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&ps(co(T))&&Zi(T.type)==="identity"&&K.push(new me(d,T,'"text-font" does not support identity functions'))),K.concat(f({key:u.key,value:T,valueSpec:V,style:b,styleSpec:x,expressionContext:"property",propertyType:l,propertyKey:L}))}function Ql(u){return Lh(u,"paint")}function Hc(u){return Lh(u,"layout")}function Du(u){let l=[];const d=u.value,f=u.key,b=u.style,x=u.styleSpec;d.type||d.ref||l.push(new me(f,d,'either "type" or "ref" is required'));let T=Zi(d.type);const L=Zi(d.ref);if(d.id){const k=Zi(d.id);for(let O=0;O<u.arrayIndex;O++){const V=b.layers[O];Zi(V.id)===k&&l.push(new me(f,d.id,`duplicate layer id "${d.id}", previously used at line ${V.id.__line__}`))}}if("ref"in d){let k;["type","source","source-layer","filter","layout"].forEach(O=>{O in d&&l.push(new me(f,d[O],`"${O}" is prohibited for ref layers`))}),b.layers.forEach(O=>{Zi(O.id)===L&&(k=O)}),k?k.ref?l.push(new me(f,d.ref,"ref cannot reference another ref layer")):T=Zi(k.type):l.push(new me(f,d.ref,`ref layer "${L}" not found`))}else if(T!=="background")if(d.source){const k=b.sources&&b.sources[d.source],O=k&&Zi(k.type);k?O==="vector"&&T==="raster"?l.push(new me(f,d.source,`layer "${d.id}" requires a raster source`)):O!=="raster-dem"&&T==="hillshade"?l.push(new me(f,d.source,`layer "${d.id}" requires a raster-dem source`)):O==="raster"&&T!=="raster"?l.push(new me(f,d.source,`layer "${d.id}" requires a vector source`)):O!=="vector"||d["source-layer"]?O==="raster-dem"&&T!=="hillshade"?l.push(new me(f,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="line"||!d.paint||!d.paint["line-gradient"]||O==="geojson"&&k.lineMetrics||l.push(new me(f,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new me(f,d,`layer "${d.id}" must specify a "source-layer"`)):l.push(new me(f,d.source,`source "${d.source}" not found`))}else l.push(new me(f,d,'missing required property "source"'));return l=l.concat(Cs({key:f,value:d,valueSpec:x.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${f}.type`,value:d.type,valueSpec:x.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:d,objectKey:"type"}),filter:qc,layout:k=>Cs({layer:d,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":O=>Hc(hr({layerType:T},O))}}),paint:k=>Cs({layer:d,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":O=>Ql(hr({layerType:T},O))}})}})),l}function wl(u){const l=u.value,d=u.key,f=jr(l);return f!=="string"?[new me(d,l,`string expected, ${f} found`)]:[]}const $c={promoteId:function(u){let{key:l,value:d}=u;if(jr(d)==="string")return wl({key:l,value:d});{const f=[];for(const b in d)f.push(...wl({key:`${l}.${b}`,value:d[b]}));return f}}};function tc(u){const l=u.value,d=u.key,f=u.styleSpec,b=u.style,x=u.validateSpec;if(!l.type)return[new me(d,l,'"type" is required')];const T=Zi(l.type);let L;switch(T){case"vector":case"raster":return L=Cs({key:d,value:l,valueSpec:f[`source_${T.replace("-","_")}`],style:u.style,styleSpec:f,objectElementValidators:$c,validateSpec:x}),L;case"raster-dem":return L=function(k){var O;const V=(O=k.sourceName)!==null&&O!==void 0?O:"",$=k.value,K=k.styleSpec,et=K.source_raster_dem,lt=k.style;let ft=[];const Tt=jr($);if($===void 0)return ft;if(Tt!=="object")return ft.push(new me("source_raster_dem",$,`object expected, ${Tt} found`)),ft;const Mt=Zi($.encoding)==="custom",Jt=["redFactor","greenFactor","blueFactor","baseShift"],Gt=k.value.encoding?`"${k.value.encoding}"`:"Default";for(const Ht in $)!Mt&&Jt.includes(Ht)?ft.push(new me(Ht,$[Ht],`In "${V}": "${Ht}" is only valid when "encoding" is set to "custom". ${Gt} encoding found`)):et[Ht]?ft=ft.concat(k.validateSpec({key:Ht,value:$[Ht],valueSpec:et[Ht],validateSpec:k.validateSpec,style:lt,styleSpec:K})):ft.push(new me(Ht,$[Ht],`unknown property "${Ht}"`));return ft}({sourceName:d,value:l,style:u.style,styleSpec:f,validateSpec:x}),L;case"geojson":if(L=Cs({key:d,value:l,valueSpec:f.source_geojson,style:b,styleSpec:f,validateSpec:x,objectElementValidators:$c}),l.cluster)for(const k in l.clusterProperties){const[O,V]=l.clusterProperties[k],$=typeof O=="string"?[O,["accumulated"],["get",k]]:O;L.push(...kn({key:`${d}.${k}.map`,value:V,validateSpec:x,expressionContext:"cluster-map"})),L.push(...kn({key:`${d}.${k}.reduce`,value:$,validateSpec:x,expressionContext:"cluster-reduce"}))}return L;case"video":return Cs({key:d,value:l,valueSpec:f.source_video,style:b,validateSpec:x,styleSpec:f});case"image":return Cs({key:d,value:l,valueSpec:f.source_image,style:b,validateSpec:x,styleSpec:f});case"canvas":return[new me(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yn({key:`${d}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,validateSpec:x,styleSpec:f})}}function Wc(u){const l=u.value,d=u.styleSpec,f=d.light,b=u.style;let x=[];const T=jr(l);if(l===void 0)return x;if(T!=="object")return x=x.concat([new me("light",l,`object expected, ${T} found`)]),x;for(const L in l){const k=L.match(/^(.*)-transition$/);x=x.concat(k&&f[k[1]]&&f[k[1]].transition?u.validateSpec({key:L,value:l[L],valueSpec:d.transition,validateSpec:u.validateSpec,style:b,styleSpec:d}):f[L]?u.validateSpec({key:L,value:l[L],valueSpec:f[L],validateSpec:u.validateSpec,style:b,styleSpec:d}):[new me(L,l[L],`unknown property "${L}"`)])}return x}function Nu(u){const l=u.value,d=u.styleSpec,f=d.sky,b=u.style,x=jr(l);if(l===void 0)return[];if(x!=="object")return[new me("sky",l,`object expected, ${x} found`)];let T=[];for(const L in l)T=T.concat(f[L]?u.validateSpec({key:L,value:l[L],valueSpec:f[L],style:b,styleSpec:d}):[new me(L,l[L],`unknown property "${L}"`)]);return T}function Fd(u){const l=u.value,d=u.styleSpec,f=d.terrain,b=u.style;let x=[];const T=jr(l);if(l===void 0)return x;if(T!=="object")return x=x.concat([new me("terrain",l,`object expected, ${T} found`)]),x;for(const L in l)x=x.concat(f[L]?u.validateSpec({key:L,value:l[L],valueSpec:f[L],validateSpec:u.validateSpec,style:b,styleSpec:d}):[new me(L,l[L],`unknown property "${L}"`)]);return x}function Dd(u){let l=[];const d=u.value,f=u.key;if(Array.isArray(d)){const b=[],x=[];for(const T in d)d[T].id&&b.includes(d[T].id)&&l.push(new me(f,d,`all the sprites' ids must be unique, but ${d[T].id} is duplicated`)),b.push(d[T].id),d[T].url&&x.includes(d[T].url)&&l.push(new me(f,d,`all the sprites' URLs must be unique, but ${d[T].url} is duplicated`)),x.push(d[T].url),l=l.concat(Cs({key:`${f}[${T}]`,value:d[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return l}return wl({key:f,value:d})}const Ou={"*":()=>[],array:Vc,boolean:function(u){const l=u.value,d=u.key,f=jr(l);return f!=="boolean"?[new me(d,l,`boolean expected, ${f} found`)]:[]},number:Fu,color:function(u){const l=u.key,d=u.value,f=jr(d);return f!=="string"?[new me(l,d,`color expected, ${f} found`)]:Jr.parse(String(d))?[]:[new me(l,d,`color expected, "${d}" found`)]},constants:Rd,enum:yn,filter:qc,function:Jl,layer:Du,object:Cs,source:tc,light:Wc,sky:Nu,terrain:Fd,projection:function(u){const l=u.value,d=u.styleSpec,f=d.projection,b=u.style,x=jr(l);if(l===void 0)return[];if(x!=="object")return[new me("projection",l,`object expected, ${x} found`)];let T=[];for(const L in l)T=T.concat(f[L]?u.validateSpec({key:L,value:l[L],valueSpec:f[L],style:b,styleSpec:d}):[new me(L,l[L],`unknown property "${L}"`)]);return T},string:wl,formatted:function(u){return wl(u).length===0?[]:kn(u)},resolvedImage:function(u){return wl(u).length===0?[]:kn(u)},padding:function(u){const l=u.key,d=u.value;if(jr(d)==="array"){if(d.length<1||d.length>4)return[new me(l,d,`padding requires 1 to 4 values; ${d.length} values found`)];const f={type:"number"};let b=[];for(let x=0;x<d.length;x++)b=b.concat(u.validateSpec({key:`${l}[${x}]`,value:d[x],validateSpec:u.validateSpec,valueSpec:f}));return b}return Fu({key:l,value:d,valueSpec:{}})},variableAnchorOffsetCollection:function(u){const l=u.key,d=u.value,f=jr(d),b=u.styleSpec;if(f!=="array"||d.length<1||d.length%2!=0)return[new me(l,d,"variableAnchorOffsetCollection requires a non-empty array of even length")];let x=[];for(let T=0;T<d.length;T+=2)x=x.concat(yn({key:`${l}[${T}]`,value:d[T],valueSpec:b.layout_symbol["text-anchor"]})),x=x.concat(Vc({key:`${l}[${T+1}]`,value:d[T+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:b}));return x},sprite:Dd};function Xc(u){const l=u.value,d=u.valueSpec,f=u.styleSpec;return u.validateSpec=Xc,d.expression&&ps(Zi(l))?Jl(u):d.expression&&Go(co(l))?kn(u):d.type&&Ou[d.type]?Ou[d.type](u):Cs(hr({},u,{valueSpec:d.type?f[d.type]:d}))}function Gp(u){const l=u.value,d=u.key,f=wl(u);return f.length||(l.indexOf("{fontstack}")===-1&&f.push(new me(d,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&f.push(new me(d,l,'"glyphs" url must include a "{range}" token'))),f}function uo(u){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:st,d=[];return d=d.concat(Xc({key:"",value:u,valueSpec:l.$root,styleSpec:l,style:u,validateSpec:Xc,objectElementValidators:{glyphs:Gp,"*":()=>[]}})),u.constants&&(d=d.concat(Rd({key:"constants",value:u.constants,style:u,styleSpec:l,validateSpec:Xc}))),Nd(d)}function ua(u){return function(l){return u({...l,validateSpec:Xc})}}function Nd(u){return[].concat(u).sort((l,d)=>l.line-d.line)}function Vs(u){return function(){for(var l=arguments.length,d=new Array(l),f=0;f<l;f++)d[f]=arguments[f];return Nd(u.apply(this,d))}}uo.source=Vs(ua(tc)),uo.sprite=Vs(ua(Dd)),uo.glyphs=Vs(ua(Gp)),uo.light=Vs(ua(Wc)),uo.sky=Vs(ua(Nu)),uo.terrain=Vs(ua(Fd)),uo.layer=Vs(ua(Du)),uo.filter=Vs(ua(qc)),uo.paintProperty=Vs(ua(Ql)),uo.layoutProperty=Vs(ua(Hc));const za=uo,zu=za.light,Fm=za.sky,Vp=za.paintProperty,Od=za.layoutProperty;function zd(u,l){let d=!1;if(l&&l.length)for(const f of l)u.fire(new or(new Error(f.message))),d=!0;return d}class Zc{constructor(l,d,f){const b=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;const T=new Int32Array(this.arrayBuffer);l=T[0],this.d=(d=T[1])+2*(f=T[2]);for(let k=0;k<this.d*this.d;k++){const O=T[3+k],V=T[3+k+1];b.push(O===V?null:T.subarray(O,V))}const L=T[3+b.length+1];this.keys=T.subarray(T[3+b.length],L),this.bboxes=T.subarray(L),this.insert=this._insertReadonly}else{this.d=d+2*f;for(let T=0;T<this.d*this.d;T++)b.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=l,this.padding=f,this.scale=d/l,this.uid=0;const x=f/d*l;this.min=-x,this.max=l+x}insert(l,d,f,b,x){this._forEachCell(d,f,b,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(d),this.bboxes.push(f),this.bboxes.push(b),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,d,f,b,x,T){this.cells[x].push(T)}query(l,d,f,b,x){const T=this.min,L=this.max;if(l<=T&&d<=T&&L<=f&&L<=b&&!x)return Array.prototype.slice.call(this.keys);{const k=[];return this._forEachCell(l,d,f,b,this._queryCell,k,{},x),k}}_queryCell(l,d,f,b,x,T,L,k){const O=this.cells[x];if(O!==null){const V=this.keys,$=this.bboxes;for(let K=0;K<O.length;K++){const et=O[K];if(L[et]===void 0){const lt=4*et;(k?k($[lt+0],$[lt+1],$[lt+2],$[lt+3]):l<=$[lt+2]&&d<=$[lt+3]&&f>=$[lt+0]&&b>=$[lt+1])?(L[et]=!0,T.push(V[et])):L[et]=!1}}}}_forEachCell(l,d,f,b,x,T,L,k){const O=this._convertToCellCoord(l),V=this._convertToCellCoord(d),$=this._convertToCellCoord(f),K=this._convertToCellCoord(b);for(let et=O;et<=$;et++)for(let lt=V;lt<=K;lt++){const ft=this.d*lt+et;if((!k||k(this._convertFromCellCoord(et),this._convertFromCellCoord(lt),this._convertFromCellCoord(et+1),this._convertFromCellCoord(lt+1)))&&x.call(this,l,d,f,b,ft,T,L,k))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const l=this.cells,d=3+this.cells.length+1+1;let f=0;for(let T=0;T<this.cells.length;T++)f+=this.cells[T].length;const b=new Int32Array(d+f+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let x=d;for(let T=0;T<l.length;T++){const L=l[T];b[3+T]=x,b.set(L,x),x+=L.length}return b[3+l.length]=x,b.set(this.keys,x),x+=this.keys.length,b[3+l.length+1]=x,b.set(this.bboxes,x),x+=this.bboxes.length,b.buffer}static serialize(l,d){const f=l.toArrayBuffer();return d&&d.push(f),{buffer:f}}static deserialize(l){return new Zc(l.buffer)}}const ho={};function qe(u,l){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(ho[u])throw new Error(`${u} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:u,writeable:!1}),ho[u]={klass:l,omit:d.omit||[],shallow:d.shallow||[]}}qe("Object",Object),qe("TransferableGridIndex",Zc),qe("Color",Jr),qe("Error",Error),qe("AJAXError",$t),qe("ResolvedImage",Ii),qe("StylePropertyFunction",oo),qe("StyleExpression",_l,{omit:["_evaluator"]}),qe("ZoomDependentExpression",so),qe("ZoomConstantExpression",Ts),qe("CompoundExpression",Gn,{omit:["_evaluate"]});for(const u in oa)oa[u]._classRegistryKey||qe(`Expression_${u}`,oa[u]);function qo(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function qs(u){return u.$name||u.constructor._classRegistryKey}function ha(u){return!function(l){if(l===null||typeof l!="object")return!1;const d=qs(l);return!(!d||d==="Object")}(u)&&(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||qo(u)||se(u)||ArrayBuffer.isView(u)||u instanceof ImageData)}function Yc(u,l){if(ha(u))return(qo(u)||se(u))&&l&&l.push(u),ArrayBuffer.isView(u)&&l&&l.push(u.buffer),u instanceof ImageData&&l&&l.push(u.data.buffer),u;if(Array.isArray(u)){const x=[];for(const T of u)x.push(Yc(T,l));return x}if(typeof u!="object")throw new Error("can't serialize object of type "+typeof u);const d=qs(u);if(!d)throw new Error(`can't serialize object of unregistered class ${u.constructor.name}`);if(!ho[d])throw new Error(`${d} is not registered.`);const{klass:f}=ho[d],b=f.serialize?f.serialize(u,l):{};if(f.serialize){if(l&&b===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in u){if(!u.hasOwnProperty(x)||ho[d].omit.indexOf(x)>=0)continue;const T=u[x];b[x]=ho[d].shallow.indexOf(x)>=0?T:Yc(T,l)}u instanceof Error&&(b.message=u.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(b.$name=d),b}function ec(u){if(ha(u))return u;if(Array.isArray(u))return u.map(ec);if(typeof u!="object")throw new Error("can't deserialize object of type "+typeof u);const l=qs(u)||"Object";if(!ho[l])throw new Error(`can't deserialize unregistered class ${l}`);const{klass:d}=ho[l];if(!d)throw new Error(`can't deserialize unregistered class ${l}`);if(d.deserialize)return d.deserialize(u);const f=Object.create(d.prototype);for(const b of Object.keys(u)){if(b==="$name")continue;const x=u[b];f[b]=ho[l].shallow.indexOf(b)>=0?x:ec(x)}return f}class da{constructor(){this.first=!0}update(l,d){const f=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=d):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=d),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=f,!0))}}const Pr={"Latin-1 Supplement":u=>u>=128&&u<=255,"Hangul Jamo":u=>u>=4352&&u<=4607,Khmer:u=>u>=6016&&u<=6143,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Katakana:u=>u>=12448&&u<=12543,Kanbun:u=>u>=12688&&u<=12703,"CJK Strokes":u=>u>=12736&&u<=12783,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"Private Use Area":u=>u>=57344&&u<=63743,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function jd(u){for(const l of u)if(Gd(l.charCodeAt(0)))return!0;return!1}function Dm(u){for(const l of u)if(!rc(l.charCodeAt(0)))return!1;return!0}function Mh(u){const l=u.map(d=>{try{return new RegExp(`\\p{sc=${d}}`,"u").source}catch{return null}}).filter(d=>d);return new RegExp(l.join("|"),"u")}const qp=Mh(["Arab","Dupl","Mong","Ougr","Syrc"]);function rc(u){return!qp.test(String.fromCodePoint(u))}const Ud=Mh(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Gd(u){return!(u!==746&&u!==747&&(u<4352||!(Pr["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Pr["CJK Compatibility"](u)||Pr["CJK Strokes"](u)||!(!Pr["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||Pr["Enclosed CJK Letters and Months"](u)||Pr["Ideographic Description Characters"](u)||Pr.Kanbun(u)||Pr.Katakana(u)&&u!==12540||!(!Pr["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!Pr["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Pr["Vertical Forms"](u)||Pr["Yijing Hexagram Symbols"](u)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(u))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(u))||Ud.test(String.fromCodePoint(u)))))}function ju(u){return!(Gd(u)||function(l){return!!(Pr["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||Pr["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||Pr["Letterlike Symbols"](l)||Pr["Number Forms"](l)||Pr["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||Pr["Control Pictures"](l)&&l!==9251||Pr["Optical Character Recognition"](l)||Pr["Enclosed Alphanumerics"](l)||Pr["Geometric Shapes"](l)||Pr["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||Pr["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Pr["CJK Symbols and Punctuation"](l)||Pr.Katakana(l)||Pr["Private Use Area"](l)||Pr["CJK Compatibility Forms"](l)||Pr["Small Form Variants"](l)||Pr["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(u))}const Bh=Mh(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ic(u){return Bh.test(String.fromCodePoint(u))}function Vd(u,l){return!(!l&&ic(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Pr.Khmer(u))}function Hp(u){for(const l of u)if(ic(l.charCodeAt(0)))return!0;return!1}const Hs=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ai{constructor(l,d){this.zoom=l,d?(this.now=d.now,this.fadeDuration=d.fadeDuration,this.zoomHistory=d.zoomHistory,this.transition=d.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new da,this.transition={})}isSupportedScript(l){return function(d,f){for(const b of d)if(!Vd(b.charCodeAt(0),f))return!1;return!0}(l,Hs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const l=this.zoom,d=l-Math.floor(l),f=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:d+(1-d)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*d}}}class Jc{constructor(l,d){this.property=l,this.value=d,this.expression=function(f,b){if(ps(f))return new oo(f,b);if(Go(f)){const x=vl(f,b);if(x.result==="error")throw new Error(x.value.map(T=>`${T.key}: ${T.message}`).join(", "));return x.value}{let x=f;return b.type==="color"&&typeof f=="string"?x=Jr.parse(f):b.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(x=Fi.parse(f)):x=Ri.parse(f),{kind:"constant",evaluate:()=>x}}}(d===void 0?l.specification.default:d,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,d,f){return this.property.possiblyEvaluate(this,l,d,f)}}class kh{constructor(l){this.property=l,this.value=new Jc(l,void 0)}transitioned(l,d){return new $p(this.property,this.value,d,vt({},l.transition,this.transition),l.now)}untransitioned(){return new $p(this.property,this.value,null,{},0)}}class Rh{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return at(this._values[l].value.value)}setValue(l,d){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new kh(this._values[l].property)),this._values[l].value=new Jc(this._values[l].property,d===null?void 0:at(d))}getTransition(l){return at(this._values[l].transition)}setTransition(l,d){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new kh(this._values[l].property)),this._values[l].transition=at(d)||void 0}serialize(){const l={};for(const d of Object.keys(this._values)){const f=this.getValue(d);f!==void 0&&(l[d]=f);const b=this.getTransition(d);b!==void 0&&(l[`${d}-transition`]=b)}return l}transitioned(l,d){const f=new Uu(this._properties);for(const b of Object.keys(this._values))f._values[b]=this._values[b].transitioned(l,d._values[b]);return f}untransitioned(){const l=new Uu(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].untransitioned();return l}}class $p{constructor(l,d,f,b,x){this.property=l,this.value=d,this.begin=x+b.delay||0,this.end=this.begin+b.duration||0,l.specification.transition&&(b.delay||b.duration)&&(this.prior=f)}possiblyEvaluate(l,d,f){const b=l.now||0,x=this.value.possiblyEvaluate(l,d,f),T=this.prior;if(T){if(b>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(b<this.begin)return T.possiblyEvaluate(l,d,f);{const L=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(l,d,f),x,function(k){if(k<=0)return 0;if(k>=1)return 1;const O=k*k,V=O*k;return 4*(k<.5?V:3*(k-O)+V-.75)}(L))}}return x}}class Uu{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,d,f){const b=new xl(this._properties);for(const x of Object.keys(this._values))b._values[x]=this._values[x].possiblyEvaluate(l,d,f);return b}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class Gu{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}hasValue(l){return this._values[l].value!==void 0}getValue(l){return at(this._values[l].value)}setValue(l,d){this._values[l]=new Jc(this._values[l].property,d===null?void 0:at(d))}serialize(){const l={};for(const d of Object.keys(this._values)){const f=this.getValue(d);f!==void 0&&(l[d]=f)}return l}possiblyEvaluate(l,d,f){const b=new xl(this._properties);for(const x of Object.keys(this._values))b._values[x]=this._values[x].possiblyEvaluate(l,d,f);return b}}class Ho{constructor(l,d,f){this.property=l,this.value=d,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,d,f,b){return this.property.evaluate(this.value,this.parameters,l,d,f,b)}}class xl{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class Je{constructor(l){this.specification=l}possiblyEvaluate(l,d){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(d)}interpolate(l,d,f){const b=Un[this.specification.type];return b?b(l,d,f):l}}class gr{constructor(l,d){this.specification=l,this.overrides=d}possiblyEvaluate(l,d,f,b){return new Ho(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(d,null,{},f,b)}:l.expression,d)}interpolate(l,d,f){if(l.value.kind!=="constant"||d.value.kind!=="constant")return l;if(l.value.value===void 0||d.value.value===void 0)return new Ho(this,{kind:"constant",value:void 0},l.parameters);const b=Un[this.specification.type];if(b){const x=b(l.value.value,d.value.value,f);return new Ho(this,{kind:"constant",value:x},l.parameters)}return l}evaluate(l,d,f,b,x,T){return l.kind==="constant"?l.value:l.evaluate(d,f,b,x,T)}}class Vu extends gr{possiblyEvaluate(l,d,f,b){if(l.value===void 0)return new Ho(this,{kind:"constant",value:void 0},d);if(l.expression.kind==="constant"){const x=l.expression.evaluate(d,null,{},f,b),T=l.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,L=this._calculate(T,T,T,d);return new Ho(this,{kind:"constant",value:L},d)}if(l.expression.kind==="camera"){const x=this._calculate(l.expression.evaluate({zoom:d.zoom-1}),l.expression.evaluate({zoom:d.zoom}),l.expression.evaluate({zoom:d.zoom+1}),d);return new Ho(this,{kind:"constant",value:x},d)}return new Ho(this,l.expression,d)}evaluate(l,d,f,b,x,T){if(l.kind==="source"){const L=l.evaluate(d,f,b,x,T);return this._calculate(L,L,L,d)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(d.zoom)-1},f,b),l.evaluate({zoom:Math.floor(d.zoom)},f,b),l.evaluate({zoom:Math.floor(d.zoom)+1},f,b),d):l.value}_calculate(l,d,f,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:f,to:d}}interpolate(l){return l}}class A{constructor(l){this.specification=l}possiblyEvaluate(l,d,f,b){if(l.value!==void 0){if(l.expression.kind==="constant"){const x=l.expression.evaluate(d,null,{},f,b);return this._calculate(x,x,x,d)}return this._calculate(l.expression.evaluate(new Ai(Math.floor(d.zoom-1),d)),l.expression.evaluate(new Ai(Math.floor(d.zoom),d)),l.expression.evaluate(new Ai(Math.floor(d.zoom+1),d)),d)}}_calculate(l,d,f,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:f,to:d}}interpolate(l){return l}}class M{constructor(l){this.specification=l}possiblyEvaluate(l,d,f,b){return!!l.expression.evaluate(d,null,{},f,b)}interpolate(){return!1}}class g{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const d in l){const f=l[d];f.specification.overridable&&this.overridableProperties.push(d);const b=this.defaultPropertyValues[d]=new Jc(f,void 0),x=this.defaultTransitionablePropertyValues[d]=new kh(f);this.defaultTransitioningPropertyValues[d]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=b.possiblyEvaluate({})}}}qe("DataDrivenProperty",gr),qe("DataConstantProperty",Je),qe("CrossFadedDataDrivenProperty",Vu),qe("CrossFadedProperty",A),qe("ColorRampProperty",M);const o="-transition";class h extends le{constructor(l,d){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),d.layout&&(this._unevaluatedLayout=new Gu(d.layout)),d.paint)){this._transitionablePaint=new Rh(d.paint);for(const f in l.paint)this.setPaintProperty(f,l.paint[f],{validate:!1});for(const f in l.layout)this.setLayoutProperty(f,l.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xl(d.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,d){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};d!=null&&this._validate(Od,`layers.${this.id}.layout.${l}`,l,d,f)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,d):this.visibility=d)}getPaintProperty(l){return l.endsWith(o)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,d){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(d!=null&&this._validate(Vp,`layers.${this.id}.paint.${l}`,l,d,f))return!1;if(l.endsWith(o))return this._transitionablePaint.setTransition(l.slice(0,-11),d||void 0),!1;{const b=this._transitionablePaint._values[l],x=b.property.specification["property-type"]==="cross-faded-data-driven",T=b.value.isDataDriven(),L=b.value;this._transitionablePaint.setValue(l,d),this._handleSpecialPaintPropertyUpdate(l);const k=this._transitionablePaint._values[l].value;return k.isDataDriven()||T||x||this._handleOverridablePaintPropertyUpdate(l,L,k)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,d,f){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,d){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,d)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),kt(l,(d,f)=>!(d===void 0||f==="layout"&&!Object.keys(d).length||f==="paint"&&!Object.keys(d).length))}_validate(l,d,f,b){let x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!x||x.validate!==!1)&&zd(this,l.call(za,{key:d,layerType:this.type,objectKey:f,value:b,styleSpec:st,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const d=this.paint.get(l);if(d instanceof Ho&&aa(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1}}const m={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class y{constructor(l,d){this._structArray=l,this._pos1=d*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class v{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,d){return l._trim(),d&&(l.isTransferred=!0,d.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const d=Object.create(this.prototype);return d.arrayBuffer=l.arrayBuffer,d.length=l.length,d.capacity=l.arrayBuffer.byteLength/d.bytesPerElement,d._refreshViews(),d}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const d=this.uint8;this._refreshViews(),d&&this.uint8.set(d)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function E(u){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,d=0,f=0;return{members:u.map(b=>{const x=m[b.type].BYTES_PER_ELEMENT,T=d=P(d,Math.max(l,x)),L=b.components||1;return f=Math.max(f,x),d+=x*L,{name:b.name,type:b.type,components:L,offset:T}}),size:P(d,Math.max(f,l)),alignment:l}}function P(u,l){return Math.ceil(u/l)*l}class B extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d){const f=this.length;return this.resize(f+1),this.emplace(f,l,d)}emplace(l,d,f){const b=2*l;return this.int16[b+0]=d,this.int16[b+1]=f,l}}B.prototype.bytesPerElement=4,qe("StructArrayLayout2i4",B);class D extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,f){const b=this.length;return this.resize(b+1),this.emplace(b,l,d,f)}emplace(l,d,f,b){const x=3*l;return this.int16[x+0]=d,this.int16[x+1]=f,this.int16[x+2]=b,l}}D.prototype.bytesPerElement=6,qe("StructArrayLayout3i6",D);class G extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,f,b){const x=this.length;return this.resize(x+1),this.emplace(x,l,d,f,b)}emplace(l,d,f,b,x){const T=4*l;return this.int16[T+0]=d,this.int16[T+1]=f,this.int16[T+2]=b,this.int16[T+3]=x,l}}G.prototype.bytesPerElement=8,qe("StructArrayLayout4i8",G);class j extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,f,b,x,T){const L=this.length;return this.resize(L+1),this.emplace(L,l,d,f,b,x,T)}emplace(l,d,f,b,x,T,L){const k=6*l;return this.int16[k+0]=d,this.int16[k+1]=f,this.int16[k+2]=b,this.int16[k+3]=x,this.int16[k+4]=T,this.int16[k+5]=L,l}}j.prototype.bytesPerElement=12,qe("StructArrayLayout2i4i12",j);class Z extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,f,b,x,T){const L=this.length;return this.resize(L+1),this.emplace(L,l,d,f,b,x,T)}emplace(l,d,f,b,x,T,L){const k=4*l,O=8*l;return this.int16[k+0]=d,this.int16[k+1]=f,this.uint8[O+4]=b,this.uint8[O+5]=x,this.uint8[O+6]=T,this.uint8[O+7]=L,l}}Z.prototype.bytesPerElement=8,qe("StructArrayLayout2i4ub8",Z);class Y extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d){const f=this.length;return this.resize(f+1),this.emplace(f,l,d)}emplace(l,d,f){const b=2*l;return this.float32[b+0]=d,this.float32[b+1]=f,l}}Y.prototype.bytesPerElement=8,qe("StructArrayLayout2f8",Y);class X extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,f,b,x,T,L,k,O,V){const $=this.length;return this.resize($+1),this.emplace($,l,d,f,b,x,T,L,k,O,V)}emplace(l,d,f,b,x,T,L,k,O,V,$){const K=10*l;return this.uint16[K+0]=d,this.uint16[K+1]=f,this.uint16[K+2]=b,this.uint16[K+3]=x,this.uint16[K+4]=T,this.uint16[K+5]=L,this.uint16[K+6]=k,this.uint16[K+7]=O,this.uint16[K+8]=V,this.uint16[K+9]=$,l}}X.prototype.bytesPerElement=20,qe("StructArrayLayout10ui20",X);class tt extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,f,b,x,T,L,k,O,V,$,K){const et=this.length;return this.resize(et+1),this.emplace(et,l,d,f,b,x,T,L,k,O,V,$,K)}emplace(l,d,f,b,x,T,L,k,O,V,$,K,et){const lt=12*l;return this.int16[lt+0]=d,this.int16[lt+1]=f,this.int16[lt+2]=b,this.int16[lt+3]=x,this.uint16[lt+4]=T,this.uint16[lt+5]=L,this.uint16[lt+6]=k,this.uint16[lt+7]=O,this.int16[lt+8]=V,this.int16[lt+9]=$,this.int16[lt+10]=K,this.int16[lt+11]=et,l}}tt.prototype.bytesPerElement=24,qe("StructArrayLayout4i4ui4i24",tt);class ct extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,f){const b=this.length;return this.resize(b+1),this.emplace(b,l,d,f)}emplace(l,d,f,b){const x=3*l;return this.float32[x+0]=d,this.float32[x+1]=f,this.float32[x+2]=b,l}}ct.prototype.bytesPerElement=12,qe("StructArrayLayout3f12",ct);class ht extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint32[1*l+0]=d,l}}ht.prototype.bytesPerElement=4,qe("StructArrayLayout1ul4",ht);class gt extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,f,b,x,T,L,k,O){const V=this.length;return this.resize(V+1),this.emplace(V,l,d,f,b,x,T,L,k,O)}emplace(l,d,f,b,x,T,L,k,O,V){const $=10*l,K=5*l;return this.int16[$+0]=d,this.int16[$+1]=f,this.int16[$+2]=b,this.int16[$+3]=x,this.int16[$+4]=T,this.int16[$+5]=L,this.uint32[K+3]=k,this.uint16[$+8]=O,this.uint16[$+9]=V,l}}gt.prototype.bytesPerElement=20,qe("StructArrayLayout6i1ul2ui20",gt);class pt extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,f,b,x,T){const L=this.length;return this.resize(L+1),this.emplace(L,l,d,f,b,x,T)}emplace(l,d,f,b,x,T,L){const k=6*l;return this.int16[k+0]=d,this.int16[k+1]=f,this.int16[k+2]=b,this.int16[k+3]=x,this.int16[k+4]=T,this.int16[k+5]=L,l}}pt.prototype.bytesPerElement=12,qe("StructArrayLayout2i2i2i12",pt);class St extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,f,b,x){const T=this.length;return this.resize(T+1),this.emplace(T,l,d,f,b,x)}emplace(l,d,f,b,x,T){const L=4*l,k=8*l;return this.float32[L+0]=d,this.float32[L+1]=f,this.float32[L+2]=b,this.int16[k+6]=x,this.int16[k+7]=T,l}}St.prototype.bytesPerElement=16,qe("StructArrayLayout2f1f2i16",St);class Rt extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,f,b,x,T){const L=this.length;return this.resize(L+1),this.emplace(L,l,d,f,b,x,T)}emplace(l,d,f,b,x,T,L){const k=16*l,O=4*l,V=8*l;return this.uint8[k+0]=d,this.uint8[k+1]=f,this.float32[O+1]=b,this.float32[O+2]=x,this.int16[V+6]=T,this.int16[V+7]=L,l}}Rt.prototype.bytesPerElement=16,qe("StructArrayLayout2ub2f2i16",Rt);class Bt extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,f){const b=this.length;return this.resize(b+1),this.emplace(b,l,d,f)}emplace(l,d,f,b){const x=3*l;return this.uint16[x+0]=d,this.uint16[x+1]=f,this.uint16[x+2]=b,l}}Bt.prototype.bytesPerElement=6,qe("StructArrayLayout3ui6",Bt);class ie extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,f,b,x,T,L,k,O,V,$,K,et,lt,ft,Tt,Mt){const Jt=this.length;return this.resize(Jt+1),this.emplace(Jt,l,d,f,b,x,T,L,k,O,V,$,K,et,lt,ft,Tt,Mt)}emplace(l,d,f,b,x,T,L,k,O,V,$,K,et,lt,ft,Tt,Mt,Jt){const Gt=24*l,Ht=12*l,ae=48*l;return this.int16[Gt+0]=d,this.int16[Gt+1]=f,this.uint16[Gt+2]=b,this.uint16[Gt+3]=x,this.uint32[Ht+2]=T,this.uint32[Ht+3]=L,this.uint32[Ht+4]=k,this.uint16[Gt+10]=O,this.uint16[Gt+11]=V,this.uint16[Gt+12]=$,this.float32[Ht+7]=K,this.float32[Ht+8]=et,this.uint8[ae+36]=lt,this.uint8[ae+37]=ft,this.uint8[ae+38]=Tt,this.uint32[Ht+10]=Mt,this.int16[Gt+22]=Jt,l}}ie.prototype.bytesPerElement=48,qe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ie);class pe extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,f,b,x,T,L,k,O,V,$,K,et,lt,ft,Tt,Mt,Jt,Gt,Ht,ae,Ce,Ve,yr,Ue,Oe,nr,Xe){const He=this.length;return this.resize(He+1),this.emplace(He,l,d,f,b,x,T,L,k,O,V,$,K,et,lt,ft,Tt,Mt,Jt,Gt,Ht,ae,Ce,Ve,yr,Ue,Oe,nr,Xe)}emplace(l,d,f,b,x,T,L,k,O,V,$,K,et,lt,ft,Tt,Mt,Jt,Gt,Ht,ae,Ce,Ve,yr,Ue,Oe,nr,Xe,He){const fe=32*l,sr=16*l;return this.int16[fe+0]=d,this.int16[fe+1]=f,this.int16[fe+2]=b,this.int16[fe+3]=x,this.int16[fe+4]=T,this.int16[fe+5]=L,this.int16[fe+6]=k,this.int16[fe+7]=O,this.uint16[fe+8]=V,this.uint16[fe+9]=$,this.uint16[fe+10]=K,this.uint16[fe+11]=et,this.uint16[fe+12]=lt,this.uint16[fe+13]=ft,this.uint16[fe+14]=Tt,this.uint16[fe+15]=Mt,this.uint16[fe+16]=Jt,this.uint16[fe+17]=Gt,this.uint16[fe+18]=Ht,this.uint16[fe+19]=ae,this.uint16[fe+20]=Ce,this.uint16[fe+21]=Ve,this.uint16[fe+22]=yr,this.uint32[sr+12]=Ue,this.float32[sr+13]=Oe,this.float32[sr+14]=nr,this.uint16[fe+30]=Xe,this.uint16[fe+31]=He,l}}pe.prototype.bytesPerElement=64,qe("StructArrayLayout8i15ui1ul2f2ui64",pe);class ye extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.float32[1*l+0]=d,l}}ye.prototype.bytesPerElement=4,qe("StructArrayLayout1f4",ye);class we extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,f){const b=this.length;return this.resize(b+1),this.emplace(b,l,d,f)}emplace(l,d,f,b){const x=3*l;return this.uint16[6*l+0]=d,this.float32[x+1]=f,this.float32[x+2]=b,l}}we.prototype.bytesPerElement=12,qe("StructArrayLayout1ui2f12",we);class ve extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,f){const b=this.length;return this.resize(b+1),this.emplace(b,l,d,f)}emplace(l,d,f,b){const x=4*l;return this.uint32[2*l+0]=d,this.uint16[x+2]=f,this.uint16[x+3]=b,l}}ve.prototype.bytesPerElement=8,qe("StructArrayLayout1ul2ui8",ve);class _e extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d){const f=this.length;return this.resize(f+1),this.emplace(f,l,d)}emplace(l,d,f){const b=2*l;return this.uint16[b+0]=d,this.uint16[b+1]=f,l}}_e.prototype.bytesPerElement=4,qe("StructArrayLayout2ui4",_e);class Se extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint16[1*l+0]=d,l}}Se.prototype.bytesPerElement=2,qe("StructArrayLayout1ui2",Se);class Ye extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,f,b){const x=this.length;return this.resize(x+1),this.emplace(x,l,d,f,b)}emplace(l,d,f,b,x){const T=4*l;return this.float32[T+0]=d,this.float32[T+1]=f,this.float32[T+2]=b,this.float32[T+3]=x,l}}Ye.prototype.bytesPerElement=16,qe("StructArrayLayout4f16",Ye);class Pe extends y{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new S(this.anchorPointX,this.anchorPointY)}}Pe.prototype.size=20;class Ie extends gt{get(l){return new Pe(this,l)}}qe("CollisionBoxArray",Ie);class ir extends y{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ir.prototype.size=48;class Ar extends ie{get(l){return new ir(this,l)}}qe("PlacedSymbolArray",Ar);class vr extends y{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}vr.prototype.size=64;class Tr extends pe{get(l){return new vr(this,l)}}qe("SymbolInstanceArray",Tr);class Dr extends ye{getoffsetX(l){return this.float32[1*l+0]}}qe("GlyphOffsetArray",Dr);class ai extends D{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}qe("SymbolLineVertexArray",ai);class Ni extends y{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ni.prototype.size=12;class ti extends we{get(l){return new Ni(this,l)}}qe("TextAnchorOffsetArray",ti);class Yi extends y{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Yi.prototype.size=8;class li extends ve{get(l){return new Yi(this,l)}}qe("FeatureIndexArray",li);class Hi extends B{}class hn extends B{}class gs extends B{}class $s extends j{}class Oi extends Z{}class Sl extends Y{}class Ws extends X{}class qu extends tt{}class Kc extends ct{}class Qn extends ht{}class ys extends pt{}class Rn extends Rt{}class ts extends Bt{}class en extends _e{}const Vn=E([{name:"a_pos",components:2,type:"Int16"}],4),{members:es}=Vn;class $r{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=l}prepareSegment(l,d,f,b){let x=this.segments[this.segments.length-1];return l>$r.MAX_VERTEX_ARRAY_LENGTH&&It(`Max vertices per segment is ${$r.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!x||x.vertexLength+l>$r.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==b)&&(x={vertexOffset:d.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},b!==void 0&&(x.sortKey=b),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const l of this.segments)for(const d in l.vaos)l.vaos[d].destroy()}static simpleSegment(l,d,f,b){return new $r([{vertexOffset:l,primitiveOffset:d,vertexLength:f,primitiveLength:b,vaos:{},sortKey:0}])}}function pa(u,l){return 256*(u=yt(Math.floor(u),0,255))+yt(Math.floor(l),0,255)}$r.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qe("SegmentVector",$r);const Al=E([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ja={exports:{}},Qc={exports:{}};Qc.exports=function(u,l){var d,f,b,x,T,L,k,O;for(f=u.length-(d=3&u.length),b=l,T=3432918353,L=461845907,O=0;O<f;)k=255&u.charCodeAt(O)|(255&u.charCodeAt(++O))<<8|(255&u.charCodeAt(++O))<<16|(255&u.charCodeAt(++O))<<24,++O,b=27492+(65535&(x=5*(65535&(b=(b^=k=(65535&(k=(k=(65535&k)*T+(((k>>>16)*T&65535)<<16)&4294967295)<<15|k>>>17))*L+(((k>>>16)*L&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(k=0,d){case 3:k^=(255&u.charCodeAt(O+2))<<16;case 2:k^=(255&u.charCodeAt(O+1))<<8;case 1:b^=k=(65535&(k=(k=(65535&(k^=255&u.charCodeAt(O)))*T+(((k>>>16)*T&65535)<<16)&4294967295)<<15|k>>>17))*L+(((k>>>16)*L&65535)<<16)&4294967295}return b^=u.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0};var Nm=Qc.exports,Wp={exports:{}};Wp.exports=function(u,l){for(var d,f=u.length,b=l^f,x=0;f>=4;)d=1540483477*(65535&(d=255&u.charCodeAt(x)|(255&u.charCodeAt(++x))<<8|(255&u.charCodeAt(++x))<<16|(255&u.charCodeAt(++x))<<24))+((1540483477*(d>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),f-=4,++x;switch(f){case 3:b^=(255&u.charCodeAt(x+2))<<16;case 2:b^=(255&u.charCodeAt(x+1))<<8;case 1:b=1540483477*(65535&(b^=255&u.charCodeAt(x)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0};var fa=Nm,Ua=Wp.exports;ja.exports=fa,ja.exports.murmur3=fa,ja.exports.murmur2=Ua;var Fh=p(ja.exports);class Hu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,d,f,b){this.ids.push(Dh(l)),this.positions.push(d,f,b)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const d=Dh(l);let f=0,b=this.ids.length-1;for(;f<b;){const T=f+b>>1;this.ids[T]>=d?b=T:f=T+1}const x=[];for(;this.ids[f]===d;)x.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return x}static serialize(l,d){const f=new Float64Array(l.ids),b=new Uint32Array(l.positions);return $u(f,b,0,f.length-1),d&&d.push(f.buffer,b.buffer),{ids:f,positions:b}}static deserialize(l){const d=new Hu;return d.ids=l.ids,d.positions=l.positions,d.indexed=!0,d}}function Dh(u){const l=+u;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:Fh(String(u))}function $u(u,l,d,f){for(;d<f;){const b=u[d+f>>1];let x=d-1,T=f+1;for(;;){do x++;while(u[x]<b);do T--;while(u[T]>b);if(x>=T)break;Ga(u,x,T),Ga(l,3*x,3*T),Ga(l,3*x+1,3*T+1),Ga(l,3*x+2,3*T+2)}T-d<f-T?($u(u,l,d,T),d=T+1):($u(u,l,T+1,f),f=T)}}function Ga(u,l,d){const f=u[l];u[l]=u[d],u[d]=f}qe("FeaturePositionMap",Hu);class tu{constructor(l,d){this.gl=l.gl,this.location=d}}class qd extends tu{constructor(l,d){super(l,d),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Hd extends tu{constructor(l,d){super(l,d),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class Xp extends tu{constructor(l,d){super(l,d),this.current=Jr.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}const $d=new Float32Array(16);function Zp(u){return[pa(255*u.r,255*u.g),pa(255*u.b,255*u.a)]}class Wd{constructor(l,d,f){this.value=l,this.uniformNames=d.map(b=>`u_${b}`),this.type=f}setUniform(l,d,f){l.set(f.constantOr(this.value))}getBinding(l,d,f){return this.type==="color"?new Xp(l,d):new qd(l,d)}}class nc{constructor(l,d){this.uniformNames=d.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,d){this.pixelRatioFrom=d.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=d.tlbr,this.patternTo=l.tlbr}setUniform(l,d,f,b){const x=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&l.set(x)}getBinding(l,d,f){return f.substr(0,9)==="u_pattern"?new Hd(l,d):new qd(l,d)}}class El{constructor(l,d,f,b){this.expression=l,this.type=f,this.maxValue=0,this.paintVertexAttributes=d.map(x=>({name:`a_${x}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(l,d,f,b,x){const T=this.paintVertexArray.length,L=this.expression.evaluate(new Ai(0),d,{},b,[],x);this.paintVertexArray.resize(l),this._setPaintValue(T,l,L)}updatePaintArray(l,d,f,b){const x=this.expression.evaluate({zoom:0},f,b);this._setPaintValue(l,d,x)}_setPaintValue(l,d,f){if(this.type==="color"){const b=Zp(f);for(let x=l;x<d;x++)this.paintVertexArray.emplace(x,b[0],b[1])}else{for(let b=l;b<d;b++)this.paintVertexArray.emplace(b,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class $o{constructor(l,d,f,b,x,T){this.expression=l,this.uniformNames=d.map(L=>`u_${L}_t`),this.type=f,this.useIntegerZoom=b,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=d.map(L=>({name:`a_${L}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(l,d,f,b,x){const T=this.expression.evaluate(new Ai(this.zoom),d,{},b,[],x),L=this.expression.evaluate(new Ai(this.zoom+1),d,{},b,[],x),k=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(k,l,T,L)}updatePaintArray(l,d,f,b){const x=this.expression.evaluate({zoom:this.zoom},f,b),T=this.expression.evaluate({zoom:this.zoom+1},f,b);this._setPaintValue(l,d,x,T)}_setPaintValue(l,d,f,b){if(this.type==="color"){const x=Zp(f),T=Zp(b);for(let L=l;L<d;L++)this.paintVertexArray.emplace(L,x[0],x[1],T[0],T[1])}else{for(let x=l;x<d;x++)this.paintVertexArray.emplace(x,f,b);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(b))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,d){const f=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,b=yt(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);l.set(b)}getBinding(l,d,f){return new qd(l,d)}}class Xs{constructor(l,d,f,b,x,T){this.expression=l,this.type=d,this.useIntegerZoom=f,this.zoom=b,this.layerId=T,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(l,d,f){const b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(b,l,d.patterns&&d.patterns[this.layerId],f)}updatePaintArray(l,d,f,b,x){this._setPaintValues(l,d,f.patterns&&f.patterns[this.layerId],x)}_setPaintValues(l,d,f,b){if(!b||!f)return;const{min:x,mid:T,max:L}=f,k=b[x],O=b[T],V=b[L];if(k&&O&&V)for(let $=l;$<d;$++)this.zoomInPaintVertexArray.emplace($,O.tl[0],O.tl[1],O.br[0],O.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],O.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace($,O.tl[0],O.tl[1],O.br[0],O.br[1],V.tl[0],V.tl[1],V.br[0],V.br[1],O.pixelRatio,V.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,Al.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,Al.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Om{constructor(l,d,f){this.binders={},this._buffers=[];const b=[];for(const x in l.paint._values){if(!f(x))continue;const T=l.paint.get(x);if(!(T instanceof Ho&&aa(T.property.specification)))continue;const L=Mv(x,l.type),k=T.value,O=T.property.specification.type,V=T.property.useIntegerZoom,$=T.property.specification["property-type"],K=$==="cross-faded"||$==="cross-faded-data-driven";if(k.kind==="constant")this.binders[x]=K?new nc(k.value,L):new Wd(k.value,L,O),b.push(`/u_${x}`);else if(k.kind==="source"||K){const et=zm(x,O,"source");this.binders[x]=K?new Xs(k,O,V,d,et,l.id):new El(k,L,O,et),b.push(`/a_${x}`)}else{const et=zm(x,O,"composite");this.binders[x]=new $o(k,L,O,V,d,et),b.push(`/z_${x}`)}}this.cacheKey=b.sort().join("")}getMaxValue(l){const d=this.binders[l];return d instanceof El||d instanceof $o?d.maxValue:0}populatePaintArrays(l,d,f,b,x){for(const T in this.binders){const L=this.binders[T];(L instanceof El||L instanceof $o||L instanceof Xs)&&L.populatePaintArray(l,d,f,b,x)}}setConstantPatternPositions(l,d){for(const f in this.binders){const b=this.binders[f];b instanceof nc&&b.setConstantPatternPositions(l,d)}}updatePaintArrays(l,d,f,b,x){let T=!1;for(const L in l){const k=d.getPositions(L);for(const O of k){const V=f.feature(O.index);for(const $ in this.binders){const K=this.binders[$];if((K instanceof El||K instanceof $o||K instanceof Xs)&&K.expression.isStateDependent===!0){const et=b.paint.get($);K.expression=et.value,K.updatePaintArray(O.start,O.end,V,l[L],x),T=!0}}}}return T}defines(){const l=[];for(const d in this.binders){const f=this.binders[d];(f instanceof Wd||f instanceof nc)&&l.push(...f.uniformNames.map(b=>`#define HAS_UNIFORM_${b}`))}return l}getBinderAttributes(){const l=[];for(const d in this.binders){const f=this.binders[d];if(f instanceof El||f instanceof $o)for(let b=0;b<f.paintVertexAttributes.length;b++)l.push(f.paintVertexAttributes[b].name);else if(f instanceof Xs)for(let b=0;b<Al.members.length;b++)l.push(Al.members[b].name)}return l}getBinderUniforms(){const l=[];for(const d in this.binders){const f=this.binders[d];if(f instanceof Wd||f instanceof nc||f instanceof $o)for(const b of f.uniformNames)l.push(b)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,d){const f=[];for(const b in this.binders){const x=this.binders[b];if(x instanceof Wd||x instanceof nc||x instanceof $o){for(const T of x.uniformNames)if(d[T]){const L=x.getBinding(l,d[T],T);f.push({name:T,property:b,binding:L})}}}return f}setUniforms(l,d,f,b){for(const{name:x,property:T,binding:L}of d)this.binders[T].setUniform(L,b,f.get(T),x)}updatePaintBuffers(l){this._buffers=[];for(const d in this.binders){const f=this.binders[d];if(l&&f instanceof Xs){const b=l.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(f instanceof El||f instanceof $o)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(l){for(const d in this.binders){const f=this.binders[d];(f instanceof El||f instanceof $o||f instanceof Xs)&&f.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const d=this.binders[l];(d instanceof El||d instanceof $o||d instanceof Xs)&&d.destroy()}}}class eu{constructor(l,d){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const b of l)this.programConfigurations[b.id]=new Om(b,d,f);this.needsUpload=!1,this._featureMap=new Hu,this._bufferOffset=0}populatePaintArrays(l,d,f,b,x,T){for(const L in this.programConfigurations)this.programConfigurations[L].populatePaintArrays(l,d,b,x,T);d.id!==void 0&&this._featureMap.add(d.id,f,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,d,f,b){for(const x of f)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(l,this._featureMap,d,x,b)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const d in this.programConfigurations)this.programConfigurations[d].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}function Mv(u,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${l}-`,"").replace(/-/g,"_")]}function zm(u,l,d){const f={color:{source:Y,composite:Ye},number:{source:ye,composite:Y}},b=function(x){return{"line-pattern":{source:Ws,composite:Ws},"fill-pattern":{source:Ws,composite:Ws},"fill-extrusion-pattern":{source:Ws,composite:Ws}}[x]}(u);return b&&b[d]||f[l][d]}qe("ConstantBinder",Wd),qe("CrossFadedConstantBinder",nc),qe("SourceExpressionBinder",El),qe("CrossFadedCompositeBinder",Xs),qe("CompositeExpressionBinder",$o),qe("ProgramConfiguration",Om,{omit:["_buffers"]}),qe("ProgramConfigurationSet",eu);const zi=8192,jm=Math.pow(2,14)-1,Um=-jm-1;function Wu(u){const l=zi/u.extent,d=u.loadGeometry();for(let f=0;f<d.length;f++){const b=d[f];for(let x=0;x<b.length;x++){const T=b[x],L=Math.round(T.x*l),k=Math.round(T.y*l);T.x=yt(L,Um,jm),T.y=yt(k,Um,jm),(L<T.x||L>T.x+1||k<T.y||k>T.y+1)&&It("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return d}function ru(u,l){return{type:u.type,id:u.id,properties:u.properties,geometry:l?Wu(u):[]}}function Yp(u,l,d,f,b){u.emplaceBack(2*l+(f+1)/2,2*d+(b+1)/2)}class Xu{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new hn,this.indexArray=new ts,this.segments=new $r,this.programConfigurations=new eu(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,f){const b=this.layers[0],x=[];let T=null,L=!1;b.type==="circle"&&(T=b.layout.get("circle-sort-key"),L=!T.isConstant());for(const{feature:k,id:O,index:V,sourceLayerIndex:$}of l){const K=this.layers[0]._featureFilter.needGeometry,et=ru(k,K);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),et,f))continue;const lt=L?T.evaluate(et,{},f):void 0,ft={id:O,properties:k.properties,type:k.type,sourceLayerIndex:$,index:V,geometry:K?et.geometry:Wu(k),patterns:{},sortKey:lt};x.push(ft)}L&&x.sort((k,O)=>k.sortKey-O.sortKey);for(const k of x){const{geometry:O,index:V,sourceLayerIndex:$}=k,K=l[V].feature;this.addFeature(k,O,V,f),d.featureIndex.insert(K,O,V,$,this.index)}}update(l,d,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,es),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,d,f,b){for(const x of d)for(const T of x){const L=T.x,k=T.y;if(L<0||L>=zi||k<0||k>=zi)continue;const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),V=O.vertexLength;Yp(this.layoutVertexArray,L,k,-1,-1),Yp(this.layoutVertexArray,L,k,1,-1),Yp(this.layoutVertexArray,L,k,1,1),Yp(this.layoutVertexArray,L,k,-1,1),this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+3,V+2),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,f,{},b)}}function Jp(u,l){for(let d=0;d<u.length;d++)if(nu(l,u[d]))return!0;for(let d=0;d<l.length;d++)if(nu(u,l[d]))return!0;return!!Cl(u,l)}function Kp(u,l,d){return!!nu(u,l)||!!Xd(l,u,d)}function Tl(u,l){if(u.length===1)return s1(l,u[0]);for(let d=0;d<l.length;d++){const f=l[d];for(let b=0;b<f.length;b++)if(nu(u,f[b]))return!0}for(let d=0;d<u.length;d++)if(s1(l,u[d]))return!0;for(let d=0;d<l.length;d++)if(Cl(u,l[d]))return!0;return!1}function iu(u,l,d){if(u.length>1){if(Cl(u,l))return!0;for(let f=0;f<l.length;f++)if(Xd(l[f],u,d))return!0}for(let f=0;f<u.length;f++)if(Xd(u[f],l,d))return!0;return!1}function Cl(u,l){if(u.length===0||l.length===0)return!1;for(let d=0;d<u.length-1;d++){const f=u[d],b=u[d+1];for(let x=0;x<l.length-1;x++)if(Qp(f,b,l[x],l[x+1]))return!0}return!1}function Qp(u,l,d,f){return xt(u,d,f)!==xt(l,d,f)&&xt(u,l,d)!==xt(u,l,f)}function Xd(u,l,d){const f=d*d;if(l.length===1)return u.distSqr(l[0])<f;for(let b=1;b<l.length;b++)if(Gm(u,l[b-1],l[b])<f)return!0;return!1}function Gm(u,l,d){const f=l.distSqr(d);if(f===0)return u.distSqr(l);const b=((u.x-l.x)*(d.x-l.x)+(u.y-l.y)*(d.y-l.y))/f;return u.distSqr(b<0?l:b>1?d:d.sub(l)._mult(b)._add(l))}function s1(u,l){let d,f,b,x=!1;for(let T=0;T<u.length;T++){d=u[T];for(let L=0,k=d.length-1;L<d.length;k=L++)f=d[L],b=d[k],f.y>l.y!=b.y>l.y&&l.x<(b.x-f.x)*(l.y-f.y)/(b.y-f.y)+f.x&&(x=!x)}return x}function nu(u,l){let d=!1;for(let f=0,b=u.length-1;f<u.length;b=f++){const x=u[f],T=u[b];x.y>l.y!=T.y>l.y&&l.x<(T.x-x.x)*(l.y-x.y)/(T.y-x.y)+x.x&&(d=!d)}return d}function Vm(u,l,d){const f=d[0],b=d[2];if(u.x<f.x&&l.x<f.x||u.x>b.x&&l.x>b.x||u.y<f.y&&l.y<f.y||u.y>b.y&&l.y>b.y)return!1;const x=xt(u,l,d[0]);return x!==xt(u,l,d[1])||x!==xt(u,l,d[2])||x!==xt(u,l,d[3])}function qm(u,l,d){const f=l.paint.get(u).value;return f.kind==="constant"?f.value:d.programConfigurations.get(l.id).getMaxValue(u)}function o1(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function a1(u,l,d,f,b){if(!l[0]&&!l[1])return u;const x=S.convert(l)._mult(b);d==="viewport"&&x._rotate(-f);const T=[];for(let L=0;L<u.length;L++)T.push(u[L].sub(x));return T}let L3,M3;qe("CircleBucket",Xu,{omit:["layers"]});var DR={get paint(){return M3=M3||new g({"circle-radius":new gr(st.paint_circle["circle-radius"]),"circle-color":new gr(st.paint_circle["circle-color"]),"circle-blur":new gr(st.paint_circle["circle-blur"]),"circle-opacity":new gr(st.paint_circle["circle-opacity"]),"circle-translate":new Je(st.paint_circle["circle-translate"]),"circle-translate-anchor":new Je(st.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Je(st.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Je(st.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new gr(st.paint_circle["circle-stroke-width"]),"circle-stroke-color":new gr(st.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new gr(st.paint_circle["circle-stroke-opacity"])})},get layout(){return L3=L3||new g({"circle-sort-key":new gr(st.layout_circle["circle-sort-key"])})}},po=1e-6,tf=typeof Float32Array<"u"?Float32Array:Array;function Bv(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function B3(u,l,d){var f=l[0],b=l[1],x=l[2],T=l[3],L=l[4],k=l[5],O=l[6],V=l[7],$=l[8],K=l[9],et=l[10],lt=l[11],ft=l[12],Tt=l[13],Mt=l[14],Jt=l[15],Gt=d[0],Ht=d[1],ae=d[2],Ce=d[3];return u[0]=Gt*f+Ht*L+ae*$+Ce*ft,u[1]=Gt*b+Ht*k+ae*K+Ce*Tt,u[2]=Gt*x+Ht*O+ae*et+Ce*Mt,u[3]=Gt*T+Ht*V+ae*lt+Ce*Jt,u[4]=(Gt=d[4])*f+(Ht=d[5])*L+(ae=d[6])*$+(Ce=d[7])*ft,u[5]=Gt*b+Ht*k+ae*K+Ce*Tt,u[6]=Gt*x+Ht*O+ae*et+Ce*Mt,u[7]=Gt*T+Ht*V+ae*lt+Ce*Jt,u[8]=(Gt=d[8])*f+(Ht=d[9])*L+(ae=d[10])*$+(Ce=d[11])*ft,u[9]=Gt*b+Ht*k+ae*K+Ce*Tt,u[10]=Gt*x+Ht*O+ae*et+Ce*Mt,u[11]=Gt*T+Ht*V+ae*lt+Ce*Jt,u[12]=(Gt=d[12])*f+(Ht=d[13])*L+(ae=d[14])*$+(Ce=d[15])*ft,u[13]=Gt*b+Ht*k+ae*K+Ce*Tt,u[14]=Gt*x+Ht*O+ae*et+Ce*Mt,u[15]=Gt*T+Ht*V+ae*lt+Ce*Jt,u}Math.hypot||(Math.hypot=function(){for(var u=0,l=arguments.length;l--;)u+=arguments[l]*arguments[l];return Math.sqrt(u)});var Hm,NR=B3;function l1(u,l,d){var f=l[0],b=l[1],x=l[2],T=l[3];return u[0]=d[0]*f+d[4]*b+d[8]*x+d[12]*T,u[1]=d[1]*f+d[5]*b+d[9]*x+d[13]*T,u[2]=d[2]*f+d[6]*b+d[10]*x+d[14]*T,u[3]=d[3]*f+d[7]*b+d[11]*x+d[15]*T,u}Hm=new tf(4),tf!=Float32Array&&(Hm[0]=0,Hm[1]=0,Hm[2]=0,Hm[3]=0);class OR extends h{constructor(l){super(l,DR)}createBucket(l){return new Xu(l)}queryRadius(l){const d=l;return qm("circle-radius",this,d)+qm("circle-stroke-width",this,d)+o1(this.paint.get("circle-translate"))}queryIntersectsFeature(l,d,f,b,x,T,L,k){const O=a1(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,L),V=this.paint.get("circle-radius").evaluate(d,f)+this.paint.get("circle-stroke-width").evaluate(d,f),$=this.paint.get("circle-pitch-alignment")==="map",K=$?O:function(lt,ft){return lt.map(Tt=>k3(Tt,ft))}(O,k),et=$?V*L:V;for(const lt of b)for(const ft of lt){const Tt=$?ft:k3(ft,k);let Mt=et;const Jt=l1([],[ft.x,ft.y,0,1],k);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Mt*=Jt[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Mt*=T.cameraToCenterDistance/Jt[3]),Kp(K,Tt,Mt))return!0}return!1}}function k3(u,l){const d=l1([],[u.x,u.y,0,1],l);return new S(d[0]/d[3],d[1]/d[3])}class R3 extends Xu{}let F3;qe("HeatmapBucket",R3,{omit:["layers"]});var zR={get paint(){return F3=F3||new g({"heatmap-radius":new gr(st.paint_heatmap["heatmap-radius"]),"heatmap-weight":new gr(st.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Je(st.paint_heatmap["heatmap-intensity"]),"heatmap-color":new M(st.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Je(st.paint_heatmap["heatmap-opacity"])})}};function kv(u,l,d,f){let{width:b,height:x}=l;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==b*x*d)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${b*x*d}`)}else f=new Uint8Array(b*x*d);return u.width=b,u.height=x,u.data=f,u}function D3(u,l,d){let{width:f,height:b}=l;if(f===u.width&&b===u.height)return;const x=kv({},{width:f,height:b},d);Rv(u,x,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,f),height:Math.min(u.height,b)},d),u.width=f,u.height=b,u.data=x.data}function Rv(u,l,d,f,b,x){if(b.width===0||b.height===0)return l;if(b.width>u.width||b.height>u.height||d.x>u.width-b.width||d.y>u.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>l.width||b.height>l.height||f.x>l.width-b.width||f.y>l.height-b.height)throw new RangeError("out of range destination coordinates for image copy");const T=u.data,L=l.data;if(T===L)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<b.height;k++){const O=((d.y+k)*u.width+d.x)*x,V=((f.y+k)*l.width+f.x)*x;for(let $=0;$<b.width*x;$++)L[V+$]=T[O+$]}return l}class $m{constructor(l,d){kv(this,l,1,d)}resize(l){D3(this,l,1)}clone(){return new $m({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,f,b,x){Rv(l,d,f,b,x,1)}}class Va{constructor(l,d){kv(this,l,4,d)}resize(l){D3(this,l,4)}replace(l,d){d?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new Va({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,f,b,x){Rv(l,d,f,b,x,4)}}function N3(u){const l={},d=u.resolution||256,f=u.clips?u.clips.length:1,b=u.image||new Va({width:d,height:f});if(Math.log(d)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${d}`);const x=(T,L,k)=>{l[u.evaluationKey]=k;const O=u.expression.evaluate(l);b.data[T+L+0]=Math.floor(255*O.r/O.a),b.data[T+L+1]=Math.floor(255*O.g/O.a),b.data[T+L+2]=Math.floor(255*O.b/O.a),b.data[T+L+3]=Math.floor(255*O.a)};if(u.clips)for(let T=0,L=0;T<f;++T,L+=4*d)for(let k=0,O=0;k<d;k++,O+=4){const V=k/(d-1),{start:$,end:K}=u.clips[T];x(L,O,$*(1-V)+K*V)}else for(let T=0,L=0;T<d;T++,L+=4)x(0,L,T/(d-1));return b}qe("AlphaImage",$m),qe("RGBAImage",Va);const Fv="big-fb";class jR extends h{createBucket(l){return new R3(l)}constructor(l){super(l,zR),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=N3({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Fv)&&this.heatmapFbos.delete(Fv)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let O3;var UR={get paint(){return O3=O3||new g({"hillshade-illumination-direction":new Je(st.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Je(st.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Je(st.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Je(st.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Je(st.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Je(st.paint_hillshade["hillshade-accent-color"])})}};class GR extends h{constructor(l){super(l,UR)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const VR=E([{name:"a_pos",components:2,type:"Int16"}],4),{members:qR}=VR;function z3(u,l){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:2;const f=l&&l.length,b=f?l[0]*d:u.length;let x=j3(u,0,b,d,!0);const T=[];if(!x||x.next===x.prev)return T;let L,k,O;if(f&&(x=function(V,$,K,et){const lt=[];for(let ft=0,Tt=$.length;ft<Tt;ft++){const Mt=j3(V,$[ft]*et,ft<Tt-1?$[ft+1]*et:V.length,et,!1);Mt===Mt.next&&(Mt.steiner=!0),lt.push(KR(Mt))}lt.sort(ZR);for(let ft=0;ft<lt.length;ft++)K=YR(lt[ft],K);return K}(u,l,x,d)),u.length>80*d){L=1/0,k=1/0;let V=-1/0,$=-1/0;for(let K=d;K<b;K+=d){const et=u[K],lt=u[K+1];et<L&&(L=et),lt<k&&(k=lt),et>V&&(V=et),lt>$&&($=lt)}O=Math.max(V-L,$-k),O=O!==0?32767/O:0}return Wm(x,T,d,L,k,O,0),T}function j3(u,l,d,f,b){let x;if(b===function(T,L,k,O){let V=0;for(let $=L,K=k-O;$<k;$+=O)V+=(T[K]-T[$])*(T[$+1]+T[K+1]),K=$;return V}(u,l,d,f)>0)for(let T=l;T<d;T+=f)x=V3(T/f|0,u[T],u[T+1],x);else for(let T=d-f;T>=l;T-=f)x=V3(T/f|0,u[T],u[T+1],x);return x&&c1(x,x.next)&&(Zm(x),x=x.next),x}function Zd(u,l){if(!u)return u;l||(l=u);let d,f=u;do if(d=!1,f.steiner||!c1(f,f.next)&&An(f.prev,f,f.next)!==0)f=f.next;else{if(Zm(f),f=l=f.prev,f===f.next)break;d=!0}while(d||f!==l);return l}function Wm(u,l,d,f,b,x,T){if(!u)return;!T&&x&&function(k,O,V,$){let K=k;do K.z===0&&(K.z=Dv(K.x,K.y,O,V,$)),K.prevZ=K.prev,K.nextZ=K.next,K=K.next;while(K!==k);K.prevZ.nextZ=null,K.prevZ=null,function(et){let lt,ft=1;do{let Tt,Mt=et;et=null;let Jt=null;for(lt=0;Mt;){lt++;let Gt=Mt,Ht=0;for(let Ce=0;Ce<ft&&(Ht++,Gt=Gt.nextZ,Gt);Ce++);let ae=ft;for(;Ht>0||ae>0&&Gt;)Ht!==0&&(ae===0||!Gt||Mt.z<=Gt.z)?(Tt=Mt,Mt=Mt.nextZ,Ht--):(Tt=Gt,Gt=Gt.nextZ,ae--),Jt?Jt.nextZ=Tt:et=Tt,Tt.prevZ=Jt,Jt=Tt;Mt=Gt}Jt.nextZ=null,ft*=2}while(lt>1)}(K)}(u,f,b,x);let L=u;for(;u.prev!==u.next;){const k=u.prev,O=u.next;if(x?$R(u,f,b,x):HR(u))l.push(k.i,u.i,O.i),Zm(u),u=O.next,L=O.next;else if((u=O)===L){T?T===1?Wm(u=WR(Zd(u),l),l,d,f,b,x,2):T===2&&XR(u,l,d,f,b,x):Wm(Zd(u),l,d,f,b,x,1);break}}}function HR(u){const l=u.prev,d=u,f=u.next;if(An(l,d,f)>=0)return!1;const b=l.x,x=d.x,T=f.x,L=l.y,k=d.y,O=f.y,V=b<x?b<T?b:T:x<T?x:T,$=L<k?L<O?L:O:k<O?k:O,K=b>x?b>T?b:T:x>T?x:T,et=L>k?L>O?L:O:k>O?k:O;let lt=f.next;for(;lt!==l;){if(lt.x>=V&&lt.x<=K&&lt.y>=$&&lt.y<=et&&ef(b,L,x,k,T,O,lt.x,lt.y)&&An(lt.prev,lt,lt.next)>=0)return!1;lt=lt.next}return!0}function $R(u,l,d,f){const b=u.prev,x=u,T=u.next;if(An(b,x,T)>=0)return!1;const L=b.x,k=x.x,O=T.x,V=b.y,$=x.y,K=T.y,et=L<k?L<O?L:O:k<O?k:O,lt=V<$?V<K?V:K:$<K?$:K,ft=L>k?L>O?L:O:k>O?k:O,Tt=V>$?V>K?V:K:$>K?$:K,Mt=Dv(et,lt,l,d,f),Jt=Dv(ft,Tt,l,d,f);let Gt=u.prevZ,Ht=u.nextZ;for(;Gt&&Gt.z>=Mt&&Ht&&Ht.z<=Jt;){if(Gt.x>=et&&Gt.x<=ft&&Gt.y>=lt&&Gt.y<=Tt&&Gt!==b&&Gt!==T&&ef(L,V,k,$,O,K,Gt.x,Gt.y)&&An(Gt.prev,Gt,Gt.next)>=0||(Gt=Gt.prevZ,Ht.x>=et&&Ht.x<=ft&&Ht.y>=lt&&Ht.y<=Tt&&Ht!==b&&Ht!==T&&ef(L,V,k,$,O,K,Ht.x,Ht.y)&&An(Ht.prev,Ht,Ht.next)>=0))return!1;Ht=Ht.nextZ}for(;Gt&&Gt.z>=Mt;){if(Gt.x>=et&&Gt.x<=ft&&Gt.y>=lt&&Gt.y<=Tt&&Gt!==b&&Gt!==T&&ef(L,V,k,$,O,K,Gt.x,Gt.y)&&An(Gt.prev,Gt,Gt.next)>=0)return!1;Gt=Gt.prevZ}for(;Ht&&Ht.z<=Jt;){if(Ht.x>=et&&Ht.x<=ft&&Ht.y>=lt&&Ht.y<=Tt&&Ht!==b&&Ht!==T&&ef(L,V,k,$,O,K,Ht.x,Ht.y)&&An(Ht.prev,Ht,Ht.next)>=0)return!1;Ht=Ht.nextZ}return!0}function WR(u,l){let d=u;do{const f=d.prev,b=d.next.next;!c1(f,b)&&U3(f,d,d.next,b)&&Xm(f,b)&&Xm(b,f)&&(l.push(f.i,d.i,b.i),Zm(d),Zm(d.next),d=u=b),d=d.next}while(d!==u);return Zd(d)}function XR(u,l,d,f,b,x){let T=u;do{let L=T.next.next;for(;L!==T.prev;){if(T.i!==L.i&&QR(T,L)){let k=G3(T,L);return T=Zd(T,T.next),k=Zd(k,k.next),Wm(T,l,d,f,b,x,0),void Wm(k,l,d,f,b,x,0)}L=L.next}T=T.next}while(T!==u)}function ZR(u,l){return u.x-l.x}function YR(u,l){const d=function(b,x){let T=x;const L=b.x,k=b.y;let O,V=-1/0;do{if(k<=T.y&&k>=T.next.y&&T.next.y!==T.y){const ft=T.x+(k-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(ft<=L&&ft>V&&(V=ft,O=T.x<T.next.x?T:T.next,ft===L))return O}T=T.next}while(T!==x);if(!O)return null;const $=O,K=O.x,et=O.y;let lt=1/0;T=O;do{if(L>=T.x&&T.x>=K&&L!==T.x&&ef(k<et?L:V,k,K,et,k<et?V:L,k,T.x,T.y)){const ft=Math.abs(k-T.y)/(L-T.x);Xm(T,b)&&(ft<lt||ft===lt&&(T.x>O.x||T.x===O.x&&JR(O,T)))&&(O=T,lt=ft)}T=T.next}while(T!==$);return O}(u,l);if(!d)return l;const f=G3(d,u);return Zd(f,f.next),Zd(d,d.next)}function JR(u,l){return An(u.prev,u,l.prev)<0&&An(l.next,u,u.next)<0}function Dv(u,l,d,f,b){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-d)*b|0)|u<<8))|u<<4))|u<<2))|u<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-f)*b|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function KR(u){let l=u,d=u;do(l.x<d.x||l.x===d.x&&l.y<d.y)&&(d=l),l=l.next;while(l!==u);return d}function ef(u,l,d,f,b,x,T,L){return(b-T)*(l-L)>=(u-T)*(x-L)&&(u-T)*(f-L)>=(d-T)*(l-L)&&(d-T)*(x-L)>=(b-T)*(f-L)}function QR(u,l){return u.next.i!==l.i&&u.prev.i!==l.i&&!function(d,f){let b=d;do{if(b.i!==d.i&&b.next.i!==d.i&&b.i!==f.i&&b.next.i!==f.i&&U3(b,b.next,d,f))return!0;b=b.next}while(b!==d);return!1}(u,l)&&(Xm(u,l)&&Xm(l,u)&&function(d,f){let b=d,x=!1;const T=(d.x+f.x)/2,L=(d.y+f.y)/2;do b.y>L!=b.next.y>L&&b.next.y!==b.y&&T<(b.next.x-b.x)*(L-b.y)/(b.next.y-b.y)+b.x&&(x=!x),b=b.next;while(b!==d);return x}(u,l)&&(An(u.prev,u,l.prev)||An(u,l.prev,l))||c1(u,l)&&An(u.prev,u,u.next)>0&&An(l.prev,l,l.next)>0)}function An(u,l,d){return(l.y-u.y)*(d.x-l.x)-(l.x-u.x)*(d.y-l.y)}function c1(u,l){return u.x===l.x&&u.y===l.y}function U3(u,l,d,f){const b=h1(An(u,l,d)),x=h1(An(u,l,f)),T=h1(An(d,f,u)),L=h1(An(d,f,l));return b!==x&&T!==L||!(b!==0||!u1(u,d,l))||!(x!==0||!u1(u,f,l))||!(T!==0||!u1(d,u,f))||!(L!==0||!u1(d,l,f))}function u1(u,l,d){return l.x<=Math.max(u.x,d.x)&&l.x>=Math.min(u.x,d.x)&&l.y<=Math.max(u.y,d.y)&&l.y>=Math.min(u.y,d.y)}function h1(u){return u>0?1:u<0?-1:0}function Xm(u,l){return An(u.prev,u,u.next)<0?An(u,l,u.next)>=0&&An(u,u.prev,l)>=0:An(u,l,u.prev)<0||An(u,u.next,l)<0}function G3(u,l){const d=Nv(u.i,u.x,u.y),f=Nv(l.i,l.x,l.y),b=u.next,x=l.prev;return u.next=l,l.prev=u,d.next=b,b.prev=d,f.next=d,d.prev=f,x.next=f,f.prev=x,f}function V3(u,l,d,f){const b=Nv(u,l,d);return f?(b.next=f.next,b.prev=f,f.next.prev=b,f.next=b):(b.prev=b,b.next=b),b}function Zm(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function Nv(u,l,d){return{i:u,x:l,y:d,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Ov(u,l,d){const f=d.patternDependencies;let b=!1;for(const x of l){const T=x.paint.get(`${u}-pattern`);T.isConstant()||(b=!0);const L=T.constantOr(null);L&&(b=!0,f[L.to]=!0,f[L.from]=!0)}return b}function zv(u,l,d,f,b){const x=b.patternDependencies;for(const T of l){const L=T.paint.get(`${u}-pattern`).value;if(L.kind!=="constant"){let k=L.evaluate({zoom:f-1},d,{},b.availableImages),O=L.evaluate({zoom:f},d,{},b.availableImages),V=L.evaluate({zoom:f+1},d,{},b.availableImages);k=k&&k.name?k.name:k,O=O&&O.name?O.name:O,V=V&&V.name?V.name:V,x[k]=!0,x[O]=!0,x[V]=!0,d.patterns[T.id]={min:k,mid:O,max:V}}}return d}class jv{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new gs,this.indexArray=new ts,this.indexArray2=new en,this.programConfigurations=new eu(l.layers,l.zoom),this.segments=new $r,this.segments2=new $r,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,f){this.hasPattern=Ov("fill",this.layers,d);const b=this.layers[0].layout.get("fill-sort-key"),x=!b.isConstant(),T=[];for(const{feature:L,id:k,index:O,sourceLayerIndex:V}of l){const $=this.layers[0]._featureFilter.needGeometry,K=ru(L,$);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),K,f))continue;const et=x?b.evaluate(K,{},f,d.availableImages):void 0,lt={id:k,properties:L.properties,type:L.type,sourceLayerIndex:V,index:O,geometry:$?K.geometry:Wu(L),patterns:{},sortKey:et};T.push(lt)}x&&T.sort((L,k)=>L.sortKey-k.sortKey);for(const L of T){const{geometry:k,index:O,sourceLayerIndex:V}=L;if(this.hasPattern){const $=zv("fill",this.layers,L,this.zoom,d);this.patternFeatures.push($)}else this.addFeature(L,k,O,f,{});d.featureIndex.insert(l[O].feature,k,O,V,this.index)}}update(l,d,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,f)}addFeatures(l,d,f){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,d,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,qR),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,d,f,b,x){for(const T of na(d,500)){let L=0;for(const et of T)L+=et.length;const k=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),O=k.vertexLength,V=[],$=[];for(const et of T){if(et.length===0)continue;et!==T[0]&&$.push(V.length/2);const lt=this.segments2.prepareSegment(et.length,this.layoutVertexArray,this.indexArray2),ft=lt.vertexLength;this.layoutVertexArray.emplaceBack(et[0].x,et[0].y),this.indexArray2.emplaceBack(ft+et.length-1,ft),V.push(et[0].x),V.push(et[0].y);for(let Tt=1;Tt<et.length;Tt++)this.layoutVertexArray.emplaceBack(et[Tt].x,et[Tt].y),this.indexArray2.emplaceBack(ft+Tt-1,ft+Tt),V.push(et[Tt].x),V.push(et[Tt].y);lt.vertexLength+=et.length,lt.primitiveLength+=et.length}const K=z3(V,$);for(let et=0;et<K.length;et+=3)this.indexArray.emplaceBack(O+K[et],O+K[et+1],O+K[et+2]);k.vertexLength+=L,k.primitiveLength+=K.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,f,x,b)}}let q3,H3;qe("FillBucket",jv,{omit:["layers","patternFeatures"]});var tF={get paint(){return H3=H3||new g({"fill-antialias":new Je(st.paint_fill["fill-antialias"]),"fill-opacity":new gr(st.paint_fill["fill-opacity"]),"fill-color":new gr(st.paint_fill["fill-color"]),"fill-outline-color":new gr(st.paint_fill["fill-outline-color"]),"fill-translate":new Je(st.paint_fill["fill-translate"]),"fill-translate-anchor":new Je(st.paint_fill["fill-translate-anchor"]),"fill-pattern":new Vu(st.paint_fill["fill-pattern"])})},get layout(){return q3=q3||new g({"fill-sort-key":new gr(st.layout_fill["fill-sort-key"])})}};class eF extends h{constructor(l){super(l,tF)}recalculate(l,d){super.recalculate(l,d);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new jv(l)}queryRadius(){return o1(this.paint.get("fill-translate"))}queryIntersectsFeature(l,d,f,b,x,T,L){return Tl(a1(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,L),b)}isTileClipped(){return!0}}const rF=E([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),iF=E([{name:"a_centroid",components:2,type:"Int16"}],4),{members:nF}=rF;var Nh={},sF=_,$3=rf;function rf(u,l,d,f,b){this.properties={},this.extent=d,this.type=0,this._pbf=u,this._geometry=-1,this._keys=f,this._values=b,u.readFields(oF,this,l)}function oF(u,l,d){u==1?l.id=d.readVarint():u==2?function(f,b){for(var x=f.readVarint()+f.pos;f.pos<x;){var T=b._keys[f.readVarint()],L=b._values[f.readVarint()];b.properties[T]=L}}(d,l):u==3?l.type=d.readVarint():u==4&&(l._geometry=d.pos)}function aF(u){for(var l,d,f=0,b=0,x=u.length,T=x-1;b<x;T=b++)f+=((d=u[T]).x-(l=u[b]).x)*(l.y+d.y);return f}rf.types=["Unknown","Point","LineString","Polygon"],rf.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var l,d=u.readVarint()+u.pos,f=1,b=0,x=0,T=0,L=[];u.pos<d;){if(b<=0){var k=u.readVarint();f=7&k,b=k>>3}if(b--,f===1||f===2)x+=u.readSVarint(),T+=u.readSVarint(),f===1&&(l&&L.push(l),l=[]),l.push(new sF(x,T));else{if(f!==7)throw new Error("unknown command "+f);l&&l.push(l[0].clone())}}return l&&L.push(l),L},rf.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var l=u.readVarint()+u.pos,d=1,f=0,b=0,x=0,T=1/0,L=-1/0,k=1/0,O=-1/0;u.pos<l;){if(f<=0){var V=u.readVarint();d=7&V,f=V>>3}if(f--,d===1||d===2)(b+=u.readSVarint())<T&&(T=b),b>L&&(L=b),(x+=u.readSVarint())<k&&(k=x),x>O&&(O=x);else if(d!==7)throw new Error("unknown command "+d)}return[T,k,L,O]},rf.prototype.toGeoJSON=function(u,l,d){var f,b,x=this.extent*Math.pow(2,d),T=this.extent*u,L=this.extent*l,k=this.loadGeometry(),O=rf.types[this.type];function V(et){for(var lt=0;lt<et.length;lt++){var ft=et[lt];et[lt]=[360*(ft.x+T)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(ft.y+L)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var $=[];for(f=0;f<k.length;f++)$[f]=k[f][0];V(k=$);break;case 2:for(f=0;f<k.length;f++)V(k[f]);break;case 3:for(k=function(et){var lt=et.length;if(lt<=1)return[et];for(var ft,Tt,Mt=[],Jt=0;Jt<lt;Jt++){var Gt=aF(et[Jt]);Gt!==0&&(Tt===void 0&&(Tt=Gt<0),Tt===Gt<0?(ft&&Mt.push(ft),ft=[et[Jt]]):ft.push(et[Jt]))}return ft&&Mt.push(ft),Mt}(k),f=0;f<k.length;f++)for(b=0;b<k[f].length;b++)V(k[f][b])}k.length===1?k=k[0]:O="Multi"+O;var K={type:"Feature",geometry:{type:O,coordinates:k},properties:this.properties};return"id"in this&&(K.id=this.id),K};var lF=$3,W3=X3;function X3(u,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(cF,this,l),this.length=this._features.length}function cF(u,l,d){u===15?l.version=d.readVarint():u===1?l.name=d.readString():u===5?l.extent=d.readVarint():u===2?l._features.push(d.pos):u===3?l._keys.push(d.readString()):u===4&&l._values.push(function(f){for(var b=null,x=f.readVarint()+f.pos;f.pos<x;){var T=f.readVarint()>>3;b=T===1?f.readString():T===2?f.readFloat():T===3?f.readDouble():T===4?f.readVarint64():T===5?f.readVarint():T===6?f.readSVarint():T===7?f.readBoolean():null}return b}(d))}X3.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var l=this._pbf.readVarint()+this._pbf.pos;return new lF(this._pbf,l,this.extent,this._keys,this._values)};var uF=W3;function hF(u,l,d){if(u===3){var f=new uF(d,d.readVarint()+d.pos);f.length&&(l[f.name]=f)}}Nh.VectorTile=function(u,l){this.layers=u.readFields(hF,{},l)},Nh.VectorTileFeature=$3,Nh.VectorTileLayer=W3;const dF=Nh.VectorTileFeature.types,Uv=Math.pow(2,13);function Ym(u,l,d,f,b,x,T,L){u.emplaceBack(l,d,2*Math.floor(f*Uv)+T,b*Uv*2,x*Uv*2,Math.round(L))}class Gv{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new $s,this.centroidVertexArray=new Hi,this.indexArray=new ts,this.programConfigurations=new eu(l.layers,l.zoom),this.segments=new $r,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,f){this.features=[],this.hasPattern=Ov("fill-extrusion",this.layers,d);for(const{feature:b,id:x,index:T,sourceLayerIndex:L}of l){const k=this.layers[0]._featureFilter.needGeometry,O=ru(b,k);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),O,f))continue;const V={id:x,sourceLayerIndex:L,index:T,geometry:k?O.geometry:Wu(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(zv("fill-extrusion",this.layers,V,this.zoom,d)):this.addFeature(V,V.geometry,T,f,{}),d.featureIndex.insert(b,V.geometry,T,L,this.index,!0)}}addFeatures(l,d,f){for(const b of this.features){const{geometry:x}=b;this.addFeature(b,x,b.index,d,f)}}update(l,d,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,nF),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,iF.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,d,f,b,x){for(const T of na(d,500)){const L={x:0,y:0,vertexCount:0};let k=0;for(const lt of T)k+=lt.length;let O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const lt of T){if(lt.length===0||fF(lt))continue;let ft=0;for(let Tt=0;Tt<lt.length;Tt++){const Mt=lt[Tt];if(Tt>=1){const Jt=lt[Tt-1];if(!pF(Mt,Jt)){O.vertexLength+4>$r.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Gt=Mt.sub(Jt)._perp()._unit(),Ht=Jt.dist(Mt);ft+Ht>32768&&(ft=0),Ym(this.layoutVertexArray,Mt.x,Mt.y,Gt.x,Gt.y,0,0,ft),Ym(this.layoutVertexArray,Mt.x,Mt.y,Gt.x,Gt.y,0,1,ft),L.x+=2*Mt.x,L.y+=2*Mt.y,L.vertexCount+=2,ft+=Ht,Ym(this.layoutVertexArray,Jt.x,Jt.y,Gt.x,Gt.y,0,0,ft),Ym(this.layoutVertexArray,Jt.x,Jt.y,Gt.x,Gt.y,0,1,ft),L.x+=2*Jt.x,L.y+=2*Jt.y,L.vertexCount+=2;const ae=O.vertexLength;this.indexArray.emplaceBack(ae,ae+2,ae+1),this.indexArray.emplaceBack(ae+1,ae+2,ae+3),O.vertexLength+=4,O.primitiveLength+=2}}}}if(O.vertexLength+k>$r.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),dF[l.type]!=="Polygon")continue;const V=[],$=[],K=O.vertexLength;for(const lt of T)if(lt.length!==0){lt!==T[0]&&$.push(V.length/2);for(let ft=0;ft<lt.length;ft++){const Tt=lt[ft];Ym(this.layoutVertexArray,Tt.x,Tt.y,0,0,1,1,0),L.x+=Tt.x,L.y+=Tt.y,L.vertexCount+=1,V.push(Tt.x),V.push(Tt.y)}}const et=z3(V,$);for(let lt=0;lt<et.length;lt+=3)this.indexArray.emplaceBack(K+et[lt],K+et[lt+2],K+et[lt+1]);O.primitiveLength+=et.length/3,O.vertexLength+=k;for(let lt=0;lt<L.vertexCount;lt++){const ft=Math.floor(L.x/L.vertexCount),Tt=Math.floor(L.y/L.vertexCount);this.centroidVertexArray.emplaceBack(ft,Tt)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,f,x,b)}}function pF(u,l){return u.x===l.x&&(u.x<0||u.x>zi)||u.y===l.y&&(u.y<0||u.y>zi)}function fF(u){return u.every(l=>l.x<0)||u.every(l=>l.x>zi)||u.every(l=>l.y<0)||u.every(l=>l.y>zi)}let Z3;qe("FillExtrusionBucket",Gv,{omit:["layers","features"]});var mF={get paint(){return Z3=Z3||new g({"fill-extrusion-opacity":new Je(st["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new gr(st["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Je(st["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Je(st["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Vu(st["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new gr(st["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new gr(st["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Je(st["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class gF extends h{constructor(l){super(l,mF)}createBucket(l){return new Gv(l)}queryRadius(){return o1(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(l,d,f,b,x,T,L,k){const O=a1(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,L),V=this.paint.get("fill-extrusion-height").evaluate(d,f),$=this.paint.get("fill-extrusion-base").evaluate(d,f),K=function(lt,ft,Tt,Mt){const Jt=[];for(const Gt of lt){const Ht=[Gt.x,Gt.y,0,1];l1(Ht,Ht,ft),Jt.push(new S(Ht[0]/Ht[3],Ht[1]/Ht[3]))}return Jt}(O,k),et=function(lt,ft,Tt,Mt){const Jt=[],Gt=[],Ht=Mt[8]*ft,ae=Mt[9]*ft,Ce=Mt[10]*ft,Ve=Mt[11]*ft,yr=Mt[8]*Tt,Ue=Mt[9]*Tt,Oe=Mt[10]*Tt,nr=Mt[11]*Tt;for(const Xe of lt){const He=[],fe=[];for(const sr of Xe){const er=sr.x,Cr=sr.y,Bi=Mt[0]*er+Mt[4]*Cr+Mt[12],Ti=Mt[1]*er+Mt[5]*Cr+Mt[13],rs=Mt[2]*er+Mt[6]*Cr+Mt[14],Pl=Mt[3]*er+Mt[7]*Cr+Mt[15],Is=rs+Ce,is=Pl+Ve,fo=Bi+yr,mo=Ti+Ue,go=rs+Oe,_n=Pl+nr,ns=new S((Bi+Ht)/is,(Ti+ae)/is);ns.z=Is/is,He.push(ns);const Zs=new S(fo/_n,mo/_n);Zs.z=go/_n,fe.push(Zs)}Jt.push(He),Gt.push(fe)}return[Jt,Gt]}(b,$,V,k);return function(lt,ft,Tt){let Mt=1/0;Tl(Tt,ft)&&(Mt=Y3(Tt,ft[0]));for(let Jt=0;Jt<ft.length;Jt++){const Gt=ft[Jt],Ht=lt[Jt];for(let ae=0;ae<Gt.length-1;ae++){const Ce=Gt[ae],Ve=[Ce,Gt[ae+1],Ht[ae+1],Ht[ae],Ce];Jp(Tt,Ve)&&(Mt=Math.min(Mt,Y3(Tt,Ve)))}}return Mt!==1/0&&Mt}(et[0],et[1],K)}}function Jm(u,l){return u.x*l.x+u.y*l.y}function Y3(u,l){if(u.length===1){let d=0;const f=l[d++];let b;for(;!b||f.equals(b);)if(b=l[d++],!b)return 1/0;for(;d<l.length;d++){const x=l[d],T=u[0],L=b.sub(f),k=x.sub(f),O=T.sub(f),V=Jm(L,L),$=Jm(L,k),K=Jm(k,k),et=Jm(O,L),lt=Jm(O,k),ft=V*K-$*$,Tt=(K*et-$*lt)/ft,Mt=(V*lt-$*et)/ft,Jt=f.z*(1-Tt-Mt)+b.z*Tt+x.z*Mt;if(isFinite(Jt))return Jt}return 1/0}{let d=1/0;for(const f of l)d=Math.min(d,f.z);return d}}const yF=E([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:_F}=yF,vF=E([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:bF}=vF,wF=Nh.VectorTileFeature.types,xF=Math.cos(Math.PI/180*37.5),J3=Math.pow(2,14)/.5;class Vv{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(d=>{this.gradients[d.id]={}}),this.layoutVertexArray=new Oi,this.layoutVertexArray2=new Sl,this.indexArray=new ts,this.programConfigurations=new eu(l.layers,l.zoom),this.segments=new $r,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,f){this.hasPattern=Ov("line",this.layers,d);const b=this.layers[0].layout.get("line-sort-key"),x=!b.isConstant(),T=[];for(const{feature:L,id:k,index:O,sourceLayerIndex:V}of l){const $=this.layers[0]._featureFilter.needGeometry,K=ru(L,$);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),K,f))continue;const et=x?b.evaluate(K,{},f):void 0,lt={id:k,properties:L.properties,type:L.type,sourceLayerIndex:V,index:O,geometry:$?K.geometry:Wu(L),patterns:{},sortKey:et};T.push(lt)}x&&T.sort((L,k)=>L.sortKey-k.sortKey);for(const L of T){const{geometry:k,index:O,sourceLayerIndex:V}=L;if(this.hasPattern){const $=zv("line",this.layers,L,this.zoom,d);this.patternFeatures.push($)}else this.addFeature(L,k,O,f,{});d.featureIndex.insert(l[O].feature,k,O,V,this.index)}}update(l,d,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,f)}addFeatures(l,d,f){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,d,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,bF)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,_F),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,d,f,b,x){const T=this.layers[0].layout,L=T.get("line-join").evaluate(l,{}),k=T.get("line-cap"),O=T.get("line-miter-limit"),V=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const $ of d)this.addLine($,l,L,k,O,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,f,x,b)}addLine(l,d,f,b,x,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Mt=0;Mt<l.length-1;Mt++)this.totalDistance+=l[Mt].dist(l[Mt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const L=wF[d.type]==="Polygon";let k=l.length;for(;k>=2&&l[k-1].equals(l[k-2]);)k--;let O=0;for(;O<k-1&&l[O].equals(l[O+1]);)O++;if(k<(L?3:2))return;f==="bevel"&&(x=1.05);const V=this.overscaling<=16?15*zi/(512*this.overscaling):0,$=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let K,et,lt,ft,Tt;this.e1=this.e2=-1,L&&(K=l[k-2],Tt=l[O].sub(K)._unit()._perp());for(let Mt=O;Mt<k;Mt++){if(lt=Mt===k-1?L?l[O+1]:void 0:l[Mt+1],lt&&l[Mt].equals(lt))continue;Tt&&(ft=Tt),K&&(et=K),K=l[Mt],Tt=lt?lt.sub(K)._unit()._perp():ft,ft=ft||Tt;let Jt=ft.add(Tt);Jt.x===0&&Jt.y===0||Jt._unit();const Gt=ft.x*Tt.x+ft.y*Tt.y,Ht=Jt.x*Tt.x+Jt.y*Tt.y,ae=Ht!==0?1/Ht:1/0,Ce=2*Math.sqrt(2-2*Ht),Ve=Ht<xF&&et&&lt,yr=ft.x*Tt.y-ft.y*Tt.x>0;if(Ve&&Mt>O){const nr=K.dist(et);if(nr>2*V){const Xe=K.sub(K.sub(et)._mult(V/nr)._round());this.updateDistance(et,Xe),this.addCurrentVertex(Xe,ft,0,0,$),et=Xe}}const Ue=et&&lt;let Oe=Ue?f:L?"butt":b;if(Ue&&Oe==="round"&&(ae<T?Oe="miter":ae<=2&&(Oe="fakeround")),Oe==="miter"&&ae>x&&(Oe="bevel"),Oe==="bevel"&&(ae>2&&(Oe="flipbevel"),ae<x&&(Oe="miter")),et&&this.updateDistance(et,K),Oe==="miter")Jt._mult(ae),this.addCurrentVertex(K,Jt,0,0,$);else if(Oe==="flipbevel"){if(ae>100)Jt=Tt.mult(-1);else{const nr=ae*ft.add(Tt).mag()/ft.sub(Tt).mag();Jt._perp()._mult(nr*(yr?-1:1))}this.addCurrentVertex(K,Jt,0,0,$),this.addCurrentVertex(K,Jt.mult(-1),0,0,$)}else if(Oe==="bevel"||Oe==="fakeround"){const nr=-Math.sqrt(ae*ae-1),Xe=yr?nr:0,He=yr?0:nr;if(et&&this.addCurrentVertex(K,ft,Xe,He,$),Oe==="fakeround"){const fe=Math.round(180*Ce/Math.PI/20);for(let sr=1;sr<fe;sr++){let er=sr/fe;if(er!==.5){const Bi=er-.5;er+=er*Bi*(er-1)*((1.0904+Gt*(Gt*(3.55645-1.43519*Gt)-3.2452))*Bi*Bi+(.848013+Gt*(.215638*Gt-1.06021)))}const Cr=Tt.sub(ft)._mult(er)._add(ft)._unit()._mult(yr?-1:1);this.addHalfVertex(K,Cr.x,Cr.y,!1,yr,0,$)}}lt&&this.addCurrentVertex(K,Tt,-Xe,-He,$)}else if(Oe==="butt")this.addCurrentVertex(K,Jt,0,0,$);else if(Oe==="square"){const nr=et?1:-1;this.addCurrentVertex(K,Jt,nr,nr,$)}else Oe==="round"&&(et&&(this.addCurrentVertex(K,ft,0,0,$),this.addCurrentVertex(K,ft,1,1,$,!0)),lt&&(this.addCurrentVertex(K,Tt,-1,-1,$,!0),this.addCurrentVertex(K,Tt,0,0,$)));if(Ve&&Mt<k-1){const nr=K.dist(lt);if(nr>2*V){const Xe=K.add(lt.sub(K)._mult(V/nr)._round());this.updateDistance(K,Xe),this.addCurrentVertex(Xe,Tt,0,0,$),K=Xe}}}}addCurrentVertex(l,d,f,b,x){let T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const L=d.y*b-d.x,k=-d.y-d.x*b;this.addHalfVertex(l,d.x+d.y*f,d.y-d.x*f,T,!1,f,x),this.addHalfVertex(l,L,k,T,!0,-b,x),this.distance>J3/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,d,f,b,x,T))}addHalfVertex(l,d,f,b,x,T,L){let{x:k,y:O}=l;const V=.5*(this.lineClips?this.scaledDistance*(J3-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((k<<1)+(b?1:0),(O<<1)+(x?1:0),Math.round(63*d)+128,Math.round(63*f)+128,1+(T===0?0:T<0?-1:1)|(63&V)<<2,V>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const $=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,$),L.primitiveLength++),x?this.e2=$:this.e1=$}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,d){this.distance+=l.dist(d),this.updateScaledDistance()}}let K3,Q3;qe("LineBucket",Vv,{omit:["layers","patternFeatures"]});var tA={get paint(){return Q3=Q3||new g({"line-opacity":new gr(st.paint_line["line-opacity"]),"line-color":new gr(st.paint_line["line-color"]),"line-translate":new Je(st.paint_line["line-translate"]),"line-translate-anchor":new Je(st.paint_line["line-translate-anchor"]),"line-width":new gr(st.paint_line["line-width"]),"line-gap-width":new gr(st.paint_line["line-gap-width"]),"line-offset":new gr(st.paint_line["line-offset"]),"line-blur":new gr(st.paint_line["line-blur"]),"line-dasharray":new A(st.paint_line["line-dasharray"]),"line-pattern":new Vu(st.paint_line["line-pattern"]),"line-gradient":new M(st.paint_line["line-gradient"])})},get layout(){return K3=K3||new g({"line-cap":new Je(st.layout_line["line-cap"]),"line-join":new gr(st.layout_line["line-join"]),"line-miter-limit":new Je(st.layout_line["line-miter-limit"]),"line-round-limit":new Je(st.layout_line["line-round-limit"]),"line-sort-key":new gr(st.layout_line["line-sort-key"])})}};class SF extends gr{possiblyEvaluate(l,d){return d=new Ai(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),super.possiblyEvaluate(l,d)}evaluate(l,d,f,b){return d=vt({},d,{zoom:Math.floor(d.zoom)}),super.evaluate(l,d,f,b)}}let d1;class AF extends h{constructor(l){super(l,tA),this.gradientVersion=0,d1||(d1=new SF(tA.paint.properties["line-width"].specification),d1.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const d=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(d)&&d._styleExpression.expression instanceof ar,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,d){super.recalculate(l,d),this.paint._values["line-floorwidth"]=d1.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new Vv(l)}queryRadius(l){const d=l,f=eA(qm("line-width",this,d),qm("line-gap-width",this,d)),b=qm("line-offset",this,d);return f/2+Math.abs(b)+o1(this.paint.get("line-translate"))}queryIntersectsFeature(l,d,f,b,x,T,L){const k=a1(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,L),O=L/2*eA(this.paint.get("line-width").evaluate(d,f),this.paint.get("line-gap-width").evaluate(d,f)),V=this.paint.get("line-offset").evaluate(d,f);return V&&(b=function($,K){const et=[];for(let lt=0;lt<$.length;lt++){const ft=$[lt],Tt=[];for(let Mt=0;Mt<ft.length;Mt++){const Jt=ft[Mt-1],Gt=ft[Mt],Ht=ft[Mt+1],ae=Mt===0?new S(0,0):Gt.sub(Jt)._unit()._perp(),Ce=Mt===ft.length-1?new S(0,0):Ht.sub(Gt)._unit()._perp(),Ve=ae._add(Ce)._unit(),yr=Ve.x*Ce.x+Ve.y*Ce.y;yr!==0&&Ve._mult(1/yr),Tt.push(Ve._mult(K)._add(Gt))}et.push(Tt)}return et}(b,V*L)),function($,K,et){for(let lt=0;lt<K.length;lt++){const ft=K[lt];if($.length>=3){for(let Tt=0;Tt<ft.length;Tt++)if(nu($,ft[Tt]))return!0}if(iu($,ft,et))return!0}return!1}(k,b,O)}isTileClipped(){return!0}}function eA(u,l){return l>0?l+2*u:u}const EF=E([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),TF=E([{name:"a_projected_pos",components:3,type:"Float32"}],4);E([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const CF=E([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);E([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const rA=E([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),PF=E([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function IF(u,l,d){return u.sections.forEach(f=>{f.text=function(b,x,T){const L=x.layout.get("text-transform").evaluate(T,{});return L==="uppercase"?b=b.toLocaleUpperCase():L==="lowercase"&&(b=b.toLocaleLowerCase()),Hs.applyArabicShaping&&(b=Hs.applyArabicShaping(b)),b}(f.text,l,d)}),u}E([{name:"triangle",components:3,type:"Uint16"}]),E([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),E([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),E([{type:"Float32",name:"offsetX"}]),E([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),E([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Km={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var qn=24,iA=Ei,nA=function(u,l,d,f,b){var x,T,L=8*b-f-1,k=(1<<L)-1,O=k>>1,V=-7,$=b-1,K=-1,et=u[l+$];for($+=K,x=et&(1<<-V)-1,et>>=-V,V+=L;V>0;x=256*x+u[l+$],$+=K,V-=8);for(T=x&(1<<-V)-1,x>>=-V,V+=f;V>0;T=256*T+u[l+$],$+=K,V-=8);if(x===0)x=1-O;else{if(x===k)return T?NaN:1/0*(et?-1:1);T+=Math.pow(2,f),x-=O}return(et?-1:1)*T*Math.pow(2,x-f)},sA=function(u,l,d,f,b,x){var T,L,k,O=8*x-b-1,V=(1<<O)-1,$=V>>1,K=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,et=0,lt=1,ft=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(L=isNaN(l)?1:0,T=V):(T=Math.floor(Math.log(l)/Math.LN2),l*(k=Math.pow(2,-T))<1&&(T--,k*=2),(l+=T+$>=1?K/k:K*Math.pow(2,1-$))*k>=2&&(T++,k/=2),T+$>=V?(L=0,T=V):T+$>=1?(L=(l*k-1)*Math.pow(2,b),T+=$):(L=l*Math.pow(2,$-1)*Math.pow(2,b),T=0));b>=8;u[d+et]=255&L,et+=lt,L/=256,b-=8);for(T=T<<b|L,O+=b;O>0;u[d+et]=255&T,et+=lt,T/=256,O-=8);u[d+et-lt]|=128*ft};function Ei(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}Ei.Varint=0,Ei.Fixed64=1,Ei.Bytes=2,Ei.Fixed32=5;var qv=4294967296,oA=1/qv,aA=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Zu(u){return u.type===Ei.Bytes?u.readVarint()+u.pos:u.pos+1}function LF(u,l,d){return d?4294967296*l+(u>>>0):4294967296*(l>>>0)+(u>>>0)}function lA(u,l,d){var f=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));d.realloc(f);for(var b=d.pos-1;b>=u;b--)d.buf[b+f]=d.buf[b]}function MF(u,l){for(var d=0;d<u.length;d++)l.writeVarint(u[d])}function BF(u,l){for(var d=0;d<u.length;d++)l.writeSVarint(u[d])}function kF(u,l){for(var d=0;d<u.length;d++)l.writeFloat(u[d])}function RF(u,l){for(var d=0;d<u.length;d++)l.writeDouble(u[d])}function FF(u,l){for(var d=0;d<u.length;d++)l.writeBoolean(u[d])}function DF(u,l){for(var d=0;d<u.length;d++)l.writeFixed32(u[d])}function NF(u,l){for(var d=0;d<u.length;d++)l.writeSFixed32(u[d])}function OF(u,l){for(var d=0;d<u.length;d++)l.writeFixed64(u[d])}function zF(u,l){for(var d=0;d<u.length;d++)l.writeSFixed64(u[d])}function p1(u,l){return(u[l]|u[l+1]<<8|u[l+2]<<16)+16777216*u[l+3]}function nf(u,l,d){u[d]=l,u[d+1]=l>>>8,u[d+2]=l>>>16,u[d+3]=l>>>24}function cA(u,l){return(u[l]|u[l+1]<<8|u[l+2]<<16)+(u[l+3]<<24)}Ei.prototype={destroy:function(){this.buf=null},readFields:function(u,l,d){for(d=d||this.length;this.pos<d;){var f=this.readVarint(),b=f>>3,x=this.pos;this.type=7&f,u(b,l,this),this.pos===x&&this.skip(f)}return l},readMessage:function(u,l){return this.readFields(u,l,this.readVarint()+this.pos)},readFixed32:function(){var u=p1(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=cA(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=p1(this.buf,this.pos)+p1(this.buf,this.pos+4)*qv;return this.pos+=8,u},readSFixed64:function(){var u=p1(this.buf,this.pos)+cA(this.buf,this.pos+4)*qv;return this.pos+=8,u},readFloat:function(){var u=nA(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=nA(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var l,d,f=this.buf;return l=127&(d=f[this.pos++]),d<128?l:(l|=(127&(d=f[this.pos++]))<<7,d<128?l:(l|=(127&(d=f[this.pos++]))<<14,d<128?l:(l|=(127&(d=f[this.pos++]))<<21,d<128?l:function(b,x,T){var L,k,O=T.buf;if(L=(112&(k=O[T.pos++]))>>4,k<128||(L|=(127&(k=O[T.pos++]))<<3,k<128)||(L|=(127&(k=O[T.pos++]))<<10,k<128)||(L|=(127&(k=O[T.pos++]))<<17,k<128)||(L|=(127&(k=O[T.pos++]))<<24,k<128)||(L|=(1&(k=O[T.pos++]))<<31,k<128))return LF(b,L,x);throw new Error("Expected varint not more than 10 bytes")}(l|=(15&(d=f[this.pos]))<<28,u,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,l=this.pos;return this.pos=u,u-l>=12&&aA?function(d,f,b){return aA.decode(d.subarray(f,b))}(this.buf,l,u):function(d,f,b){for(var x="",T=f;T<b;){var L,k,O,V=d[T],$=null,K=V>239?4:V>223?3:V>191?2:1;if(T+K>b)break;K===1?V<128&&($=V):K===2?(192&(L=d[T+1]))==128&&($=(31&V)<<6|63&L)<=127&&($=null):K===3?(k=d[T+2],(192&(L=d[T+1]))==128&&(192&k)==128&&(($=(15&V)<<12|(63&L)<<6|63&k)<=2047||$>=55296&&$<=57343)&&($=null)):K===4&&(k=d[T+2],O=d[T+3],(192&(L=d[T+1]))==128&&(192&k)==128&&(192&O)==128&&(($=(15&V)<<18|(63&L)<<12|(63&k)<<6|63&O)<=65535||$>=1114112)&&($=null)),$===null?($=65533,K=1):$>65535&&($-=65536,x+=String.fromCharCode($>>>10&1023|55296),$=56320|1023&$),x+=String.fromCharCode($),T+=K}return x}(this.buf,l,u)},readBytes:function(){var u=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,u);return this.pos=u,l},readPackedVarint:function(u,l){if(this.type!==Ei.Bytes)return u.push(this.readVarint(l));var d=Zu(this);for(u=u||[];this.pos<d;)u.push(this.readVarint(l));return u},readPackedSVarint:function(u){if(this.type!==Ei.Bytes)return u.push(this.readSVarint());var l=Zu(this);for(u=u||[];this.pos<l;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==Ei.Bytes)return u.push(this.readBoolean());var l=Zu(this);for(u=u||[];this.pos<l;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==Ei.Bytes)return u.push(this.readFloat());var l=Zu(this);for(u=u||[];this.pos<l;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==Ei.Bytes)return u.push(this.readDouble());var l=Zu(this);for(u=u||[];this.pos<l;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==Ei.Bytes)return u.push(this.readFixed32());var l=Zu(this);for(u=u||[];this.pos<l;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==Ei.Bytes)return u.push(this.readSFixed32());var l=Zu(this);for(u=u||[];this.pos<l;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==Ei.Bytes)return u.push(this.readFixed64());var l=Zu(this);for(u=u||[];this.pos<l;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==Ei.Bytes)return u.push(this.readSFixed64());var l=Zu(this);for(u=u||[];this.pos<l;)u.push(this.readSFixed64());return u},skip:function(u){var l=7&u;if(l===Ei.Varint)for(;this.buf[this.pos++]>127;);else if(l===Ei.Bytes)this.pos=this.readVarint()+this.pos;else if(l===Ei.Fixed32)this.pos+=4;else{if(l!==Ei.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(u,l){this.writeVarint(u<<3|l)},realloc:function(u){for(var l=this.length||16;l<this.pos+u;)l*=2;if(l!==this.length){var d=new Uint8Array(l);d.set(this.buf),this.buf=d,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),nf(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),nf(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),nf(this.buf,-1&u,this.pos),nf(this.buf,Math.floor(u*oA),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),nf(this.buf,-1&u,this.pos),nf(this.buf,Math.floor(u*oA),this.pos+4),this.pos+=8},writeVarint:function(u){(u=+u||0)>268435455||u<0?function(l,d){var f,b;if(l>=0?(f=l%4294967296|0,b=l/4294967296|0):(b=~(-l/4294967296),4294967295^(f=~(-l%4294967296))?f=f+1|0:(f=0,b=b+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");d.realloc(10),function(x,T,L){L.buf[L.pos++]=127&x|128,x>>>=7,L.buf[L.pos++]=127&x|128,x>>>=7,L.buf[L.pos++]=127&x|128,x>>>=7,L.buf[L.pos++]=127&x|128,L.buf[L.pos]=127&(x>>>=7)}(f,0,d),function(x,T){var L=(7&x)<<4;T.buf[T.pos++]|=L|((x>>>=3)?128:0),x&&(T.buf[T.pos++]=127&x|((x>>>=7)?128:0),x&&(T.buf[T.pos++]=127&x|((x>>>=7)?128:0),x&&(T.buf[T.pos++]=127&x|((x>>>=7)?128:0),x&&(T.buf[T.pos++]=127&x|((x>>>=7)?128:0),x&&(T.buf[T.pos++]=127&x)))))}(b,d)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(u){u=String(u),this.realloc(4*u.length),this.pos++;var l=this.pos;this.pos=function(f,b,x){for(var T,L,k=0;k<b.length;k++){if((T=b.charCodeAt(k))>55295&&T<57344){if(!L){T>56319||k+1===b.length?(f[x++]=239,f[x++]=191,f[x++]=189):L=T;continue}if(T<56320){f[x++]=239,f[x++]=191,f[x++]=189,L=T;continue}T=L-55296<<10|T-56320|65536,L=null}else L&&(f[x++]=239,f[x++]=191,f[x++]=189,L=null);T<128?f[x++]=T:(T<2048?f[x++]=T>>6|192:(T<65536?f[x++]=T>>12|224:(f[x++]=T>>18|240,f[x++]=T>>12&63|128),f[x++]=T>>6&63|128),f[x++]=63&T|128)}return x}(this.buf,u,this.pos);var d=this.pos-l;d>=128&&lA(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeFloat:function(u){this.realloc(4),sA(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),sA(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var l=u.length;this.writeVarint(l),this.realloc(l);for(var d=0;d<l;d++)this.buf[this.pos++]=u[d]},writeRawMessage:function(u,l){this.pos++;var d=this.pos;u(l,this);var f=this.pos-d;f>=128&&lA(d,f,this),this.pos=d-1,this.writeVarint(f),this.pos+=f},writeMessage:function(u,l,d){this.writeTag(u,Ei.Bytes),this.writeRawMessage(l,d)},writePackedVarint:function(u,l){l.length&&this.writeMessage(u,MF,l)},writePackedSVarint:function(u,l){l.length&&this.writeMessage(u,BF,l)},writePackedBoolean:function(u,l){l.length&&this.writeMessage(u,FF,l)},writePackedFloat:function(u,l){l.length&&this.writeMessage(u,kF,l)},writePackedDouble:function(u,l){l.length&&this.writeMessage(u,RF,l)},writePackedFixed32:function(u,l){l.length&&this.writeMessage(u,DF,l)},writePackedSFixed32:function(u,l){l.length&&this.writeMessage(u,NF,l)},writePackedFixed64:function(u,l){l.length&&this.writeMessage(u,OF,l)},writePackedSFixed64:function(u,l){l.length&&this.writeMessage(u,zF,l)},writeBytesField:function(u,l){this.writeTag(u,Ei.Bytes),this.writeBytes(l)},writeFixed32Field:function(u,l){this.writeTag(u,Ei.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(u,l){this.writeTag(u,Ei.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(u,l){this.writeTag(u,Ei.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(u,l){this.writeTag(u,Ei.Fixed64),this.writeSFixed64(l)},writeVarintField:function(u,l){this.writeTag(u,Ei.Varint),this.writeVarint(l)},writeSVarintField:function(u,l){this.writeTag(u,Ei.Varint),this.writeSVarint(l)},writeStringField:function(u,l){this.writeTag(u,Ei.Bytes),this.writeString(l)},writeFloatField:function(u,l){this.writeTag(u,Ei.Fixed32),this.writeFloat(l)},writeDoubleField:function(u,l){this.writeTag(u,Ei.Fixed64),this.writeDouble(l)},writeBooleanField:function(u,l){this.writeVarintField(u,!!l)}};var Hv=p(iA);const $v=3;function jF(u,l,d){u===1&&d.readMessage(UF,l)}function UF(u,l,d){if(u===3){const{id:f,bitmap:b,width:x,height:T,left:L,top:k,advance:O}=d.readMessage(GF,{});l.push({id:f,bitmap:new $m({width:x+2*$v,height:T+2*$v},b),metrics:{width:x,height:T,left:L,top:k,advance:O}})}}function GF(u,l,d){u===1?l.id=d.readVarint():u===2?l.bitmap=d.readBytes():u===3?l.width=d.readVarint():u===4?l.height=d.readVarint():u===5?l.left=d.readSVarint():u===6?l.top=d.readSVarint():u===7&&(l.advance=d.readVarint())}const uA=$v;function hA(u){let l=0,d=0;for(const T of u)l+=T.w*T.h,d=Math.max(d,T.w);u.sort((T,L)=>L.h-T.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),d),h:1/0}];let b=0,x=0;for(const T of u)for(let L=f.length-1;L>=0;L--){const k=f[L];if(!(T.w>k.w||T.h>k.h)){if(T.x=k.x,T.y=k.y,x=Math.max(x,T.y+T.h),b=Math.max(b,T.x+T.w),T.w===k.w&&T.h===k.h){const O=f.pop();L<f.length&&(f[L]=O)}else T.h===k.h?(k.x+=T.w,k.w-=T.w):T.w===k.w?(k.y+=T.h,k.h-=T.h):(f.push({x:k.x+T.w,y:k.y,w:k.w-T.w,h:T.h}),k.y+=T.h,k.h-=T.h);break}}return{w:b,h:x,fill:l/(b*x)||0}}const Wo=1;class Wv{constructor(l,d){let{pixelRatio:f,version:b,stretchX:x,stretchY:T,content:L,textFitWidth:k,textFitHeight:O}=d;this.paddedRect=l,this.pixelRatio=f,this.stretchX=x,this.stretchY=T,this.content=L,this.version=b,this.textFitWidth=k,this.textFitHeight=O}get tl(){return[this.paddedRect.x+Wo,this.paddedRect.y+Wo]}get br(){return[this.paddedRect.x+this.paddedRect.w-Wo,this.paddedRect.y+this.paddedRect.h-Wo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Wo)/this.pixelRatio,(this.paddedRect.h-2*Wo)/this.pixelRatio]}}class dA{constructor(l,d){const f={},b={};this.haveRenderCallbacks=[];const x=[];this.addImages(l,f,x),this.addImages(d,b,x);const{w:T,h:L}=hA(x),k=new Va({width:T||1,height:L||1});for(const O in l){const V=l[O],$=f[O].paddedRect;Va.copy(V.data,k,{x:0,y:0},{x:$.x+Wo,y:$.y+Wo},V.data)}for(const O in d){const V=d[O],$=b[O].paddedRect,K=$.x+Wo,et=$.y+Wo,lt=V.data.width,ft=V.data.height;Va.copy(V.data,k,{x:0,y:0},{x:K,y:et},V.data),Va.copy(V.data,k,{x:0,y:ft-1},{x:K,y:et-1},{width:lt,height:1}),Va.copy(V.data,k,{x:0,y:0},{x:K,y:et+ft},{width:lt,height:1}),Va.copy(V.data,k,{x:lt-1,y:0},{x:K-1,y:et},{width:1,height:ft}),Va.copy(V.data,k,{x:0,y:0},{x:K+lt,y:et},{width:1,height:ft})}this.image=k,this.iconPositions=f,this.patternPositions=b}addImages(l,d,f){for(const b in l){const x=l[b],T={x:0,y:0,w:x.data.width+2*Wo,h:x.data.height+2*Wo};f.push(T),d[b]=new Wv(T,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(l,d){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in l.updatedImages)this.patchUpdatedImage(this.iconPositions[f],l.getImage(f),d),this.patchUpdatedImage(this.patternPositions[f],l.getImage(f),d)}patchUpdatedImage(l,d,f){if(!l||!d||l.version===d.version)return;l.version=d.version;const[b,x]=l.tl;f.update(d.data,void 0,{x:b,y:x})}}var Oh;qe("ImagePosition",Wv),qe("ImageAtlas",dA),c.ah=void 0,(Oh=c.ah||(c.ah={}))[Oh.none=0]="none",Oh[Oh.horizontal=1]="horizontal",Oh[Oh.vertical=2]="vertical",Oh[Oh.horizontalOnly=3]="horizontalOnly";const Qm=-17;class tg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(l,d){const f=new tg;return f.scale=l||1,f.fontStack=d,f}static forImage(l){const d=new tg;return d.imageName=l,d}}class sf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,d){const f=new sf;for(let b=0;b<l.sections.length;b++){const x=l.sections[b];x.image?f.addImageSection(x):f.addTextSection(x,d)}return f}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=function(l){let d="";for(let f=0;f<l.length;f++){const b=l.charCodeAt(f+1)||null,x=l.charCodeAt(f-1)||null;d+=b&&ju(b)&&!Km[l[f+1]]||x&&ju(x)&&!Km[l[f-1]]||!Km[l[f]]?l[f]:Km[l[f]]}return d}(this.text)}trim(){let l=0;for(let f=0;f<this.text.length&&m1[this.text.charCodeAt(f)];f++)l++;let d=this.text.length;for(let f=this.text.length-1;f>=0&&f>=l&&m1[this.text.charCodeAt(f)];f--)d--;this.text=this.text.substring(l,d),this.sectionIndex=this.sectionIndex.slice(l,d)}substring(l,d){const f=new sf;return f.text=this.text.substring(l,d),f.sectionIndex=this.sectionIndex.slice(l,d),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,d)=>Math.max(l,this.sections[d].scale),0)}addTextSection(l,d){this.text+=l.text,this.sections.push(tg.forText(l.scale,l.fontStack||d));const f=this.sections.length-1;for(let b=0;b<l.text.length;++b)this.sectionIndex.push(f)}addImageSection(l){const d=l.image?l.image.name:"";if(d.length===0)return void It("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(tg.forImage(d)),this.sectionIndex.push(this.sections.length-1)):It("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function f1(u,l,d,f,b,x,T,L,k,O,V,$,K,et,lt){const ft=sf.fromFeature(u,b);let Tt;$===c.ah.vertical&&ft.verticalizePunctuation();const{processBidirectionalText:Mt,processStyledBidirectionalText:Jt}=Hs;if(Mt&&ft.sections.length===1){Tt=[];const ae=Mt(ft.toString(),Xv(ft,O,x,l,f,et));for(const Ce of ae){const Ve=new sf;Ve.text=Ce,Ve.sections=ft.sections;for(let yr=0;yr<Ce.length;yr++)Ve.sectionIndex.push(0);Tt.push(Ve)}}else if(Jt){Tt=[];const ae=Jt(ft.text,ft.sectionIndex,Xv(ft,O,x,l,f,et));for(const Ce of ae){const Ve=new sf;Ve.text=Ce[0],Ve.sectionIndex=Ce[1],Ve.sections=ft.sections,Tt.push(Ve)}}else Tt=function(ae,Ce){const Ve=[],yr=ae.text;let Ue=0;for(const Oe of Ce)Ve.push(ae.substring(Ue,Oe)),Ue=Oe;return Ue<yr.length&&Ve.push(ae.substring(Ue,yr.length)),Ve}(ft,Xv(ft,O,x,l,f,et));const Gt=[],Ht={positionedLines:Gt,text:ft.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:$,iconsInText:!1,verticalizable:!1};return function(ae,Ce,Ve,yr,Ue,Oe,nr,Xe,He,fe,sr,er){let Cr=0,Bi=Qm,Ti=0,rs=0;const Pl=Xe==="right"?1:Xe==="left"?0:.5;let Is=0;for(const _n of Ue){_n.trim();const ns=_n.getMaxScale(),Zs=(ns-1)*qn,Ls={positionedGlyphs:[],lineOffset:0};ae.positionedLines[Is]=Ls;const yo=Ls.positionedGlyphs;let Ms=0;if(!_n.length()){Bi+=Oe,++Is;continue}for(let Xo=0;Xo<_n.length();Xo++){const ci=_n.getSection(Xo),ji=_n.getSectionIndex(Xo),$i=_n.getCharCode(Xo);let ma=0,dn=null,cf=null,ou=null,au=qn;const Il=!(He===c.ah.horizontal||!sr&&!Gd($i)||sr&&(m1[$i]||(is=$i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(is)))));if(ci.imageName){const $a=yr[ci.imageName];if(!$a)continue;ou=ci.imageName,ae.iconsInText=ae.iconsInText||!0,cf=$a.paddedRect;const _s=$a.displaySize;ci.scale=ci.scale*qn/er,dn={width:_s[0],height:_s[1],left:Wo,top:-uA,advance:Il?_s[1]:_s[0]},ma=Zs+(qn-_s[1]*ci.scale),au=dn.advance;const Yu=Il?_s[0]*ci.scale-qn*ns:_s[1]*ci.scale-qn*ns;Yu>0&&Yu>Ms&&(Ms=Yu)}else{const $a=Ve[ci.fontStack],_s=$a&&$a[$i];if(_s&&_s.rect)cf=_s.rect,dn=_s.metrics;else{const Yu=Ce[ci.fontStack],og=Yu&&Yu[$i];if(!og)continue;dn=og.metrics}ma=(ns-ci.scale)*qn}Il?(ae.verticalizable=!0,yo.push({glyph:$i,imageName:ou,x:Cr,y:Bi+ma,vertical:Il,scale:ci.scale,fontStack:ci.fontStack,sectionIndex:ji,metrics:dn,rect:cf}),Cr+=au*ci.scale+fe):(yo.push({glyph:$i,imageName:ou,x:Cr,y:Bi+ma,vertical:Il,scale:ci.scale,fontStack:ci.fontStack,sectionIndex:ji,metrics:dn,rect:cf}),Cr+=dn.advance*ci.scale+fe)}yo.length!==0&&(Ti=Math.max(Cr-fe,Ti),$F(yo,0,yo.length-1,Pl,Ms)),Cr=0;const Ha=Oe*ns+Ms;Ls.lineOffset=Math.max(Ms,Zs),Bi+=Ha,rs=Math.max(Ha,rs),++Is}var is;const fo=Bi-Qm,{horizontalAlign:mo,verticalAlign:go}=Zv(nr);(function(_n,ns,Zs,Ls,yo,Ms,Ha,Xo,ci){const ji=(ns-Zs)*yo;let $i=0;$i=Ms!==Ha?-Xo*Ls-Qm:(-Ls*ci+.5)*Ha;for(const ma of _n)for(const dn of ma.positionedGlyphs)dn.x+=ji,dn.y+=$i})(ae.positionedLines,Pl,mo,go,Ti,rs,Oe,fo,Ue.length),ae.top+=-go*fo,ae.bottom=ae.top+fo,ae.left+=-mo*Ti,ae.right=ae.left+Ti}(Ht,l,d,f,Tt,T,L,k,$,O,K,lt),!function(ae){for(const Ce of ae)if(Ce.positionedGlyphs.length!==0)return!1;return!0}(Gt)&&Ht}const m1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},VF={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},qF={40:!0};function pA(u,l,d,f,b,x){if(l.imageName){const T=f[l.imageName];return T?T.displaySize[0]*l.scale*qn/x+b:0}{const T=d[l.fontStack],L=T&&T[u];return L?L.metrics.advance*l.scale+b:0}}function fA(u,l,d,f){const b=Math.pow(u-l,2);return f?u<l?b/2:2*b:b+Math.abs(d)*d}function HF(u,l,d){let f=0;return u===10&&(f-=1e4),d&&(f+=150),u!==40&&u!==65288||(f+=50),l!==41&&l!==65289||(f+=50),f}function mA(u,l,d,f,b,x){let T=null,L=fA(l,d,b,x);for(const k of f){const O=fA(l-k.x,d,b,x)+k.badness;O<=L&&(T=k,L=O)}return{index:u,x:l,priorBreak:T,badness:L}}function gA(u){return u?gA(u.priorBreak).concat(u.index):[]}function Xv(u,l,d,f,b,x){if(!u)return[];const T=[],L=function($,K,et,lt,ft,Tt){let Mt=0;for(let Jt=0;Jt<$.length();Jt++){const Gt=$.getSection(Jt);Mt+=pA($.getCharCode(Jt),Gt,lt,ft,K,Tt)}return Mt/Math.max(1,Math.ceil(Mt/et))}(u,l,d,f,b,x),k=u.text.indexOf("")>=0;let O=0;for(let $=0;$<u.length();$++){const K=u.getSection($),et=u.getCharCode($);if(m1[et]||(O+=pA(et,K,f,b,l,x)),$<u.length()-1){const lt=!((V=et)<11904)&&(!!Pr["CJK Compatibility Forms"](V)||!!Pr["CJK Compatibility"](V)||!!Pr["CJK Strokes"](V)||!!Pr["CJK Symbols and Punctuation"](V)||!!Pr["Enclosed CJK Letters and Months"](V)||!!Pr["Halfwidth and Fullwidth Forms"](V)||!!Pr["Ideographic Description Characters"](V)||!!Pr["Vertical Forms"](V)||Ud.test(String.fromCodePoint(V)));(VF[et]||lt||K.imageName||$!==u.length()-2&&qF[u.getCharCode($+1)])&&T.push(mA($+1,O,L,T,HF(et,u.getCharCode($+1),lt&&k),!1))}}var V;return gA(mA(u.length(),O,L,T,0,!0))}function Zv(u){let l=.5,d=.5;switch(u){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":d=1;break;case"top":case"top-right":case"top-left":d=0}return{horizontalAlign:l,verticalAlign:d}}function $F(u,l,d,f,b){if(!f&&!b)return;const x=u[d],T=(u[d].x+x.metrics.advance*x.scale)*f;for(let L=l;L<=d;L++)u[L].x-=T,u[L].y+=b}function WF(u,l,d){const{horizontalAlign:f,verticalAlign:b}=Zv(d),x=l[0]-u.displaySize[0]*f,T=l[1]-u.displaySize[1]*b;return{image:u,top:T,bottom:T+u.displaySize[1],left:x,right:x+u.displaySize[0]}}function yA(u){var l,d;let f=u.left,b=u.top,x=u.right-f,T=u.bottom-b;const L=(l=u.image.textFitWidth)!==null&&l!==void 0?l:"stretchOrShrink",k=(d=u.image.textFitHeight)!==null&&d!==void 0?d:"stretchOrShrink",O=(u.image.content[2]-u.image.content[0])/(u.image.content[3]-u.image.content[1]);if(k==="proportional"){if(L==="stretchOnly"&&x/T<O||L==="proportional"){const V=Math.ceil(T*O);f*=V/x,x=V}}else if(L==="proportional"&&k==="stretchOnly"&&O!==0&&x/T>O){const V=Math.ceil(x/O);b*=V/T,T=V}return{x1:f,y1:b,x2:f+x,y2:b+T}}function _A(u,l,d,f,b,x){const T=u.image;let L;if(T.content){const Tt=T.content,Mt=T.pixelRatio||1;L=[Tt[0]/Mt,Tt[1]/Mt,T.displaySize[0]-Tt[2]/Mt,T.displaySize[1]-Tt[3]/Mt]}const k=l.left*x,O=l.right*x;let V,$,K,et;d==="width"||d==="both"?(et=b[0]+k-f[3],$=b[0]+O+f[1]):(et=b[0]+(k+O-T.displaySize[0])/2,$=et+T.displaySize[0]);const lt=l.top*x,ft=l.bottom*x;return d==="height"||d==="both"?(V=b[1]+lt-f[0],K=b[1]+ft+f[2]):(V=b[1]+(lt+ft-T.displaySize[1])/2,K=V+T.displaySize[1]),{image:T,top:V,right:$,bottom:K,left:et,collisionPadding:L}}const eg=255,su=128,zh=eg*su;function vA(u,l){const{expression:d}=l;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new Ai(u+1))};if(d.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:b}=d;let x=0;for(;x<f.length&&f[x]<=u;)x++;x=Math.max(0,x-1);let T=x;for(;T<f.length&&f[T]<u+1;)T++;T=Math.min(f.length-1,T);const L=f[x],k=f[T];return d.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:k,interpolationType:b}:{kind:"camera",minZoom:L,maxZoom:k,minSize:d.evaluate(new Ai(L)),maxSize:d.evaluate(new Ai(k)),interpolationType:b}}}function Yv(u,l,d){let f="never";const b=u.get(l);return b?f=b:u.get(d)&&(f="always"),f}const XF=Nh.VectorTileFeature.types,ZF=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function g1(u,l,d,f,b,x,T,L,k,O,V,$,K){const et=L?Math.min(zh,Math.round(L[0])):0,lt=L?Math.min(zh,Math.round(L[1])):0;u.emplaceBack(l,d,Math.round(32*f),Math.round(32*b),x,T,(et<<1)+(k?1:0),lt,16*O,16*V,256*$,256*K)}function Jv(u,l,d){u.emplaceBack(l.x,l.y,d),u.emplaceBack(l.x,l.y,d),u.emplaceBack(l.x,l.y,d),u.emplaceBack(l.x,l.y,d)}function YF(u){for(const l of u.sections)if(Hp(l.text))return!0;return!1}class Kv{constructor(l){this.layoutVertexArray=new qu,this.indexArray=new ts,this.programConfigurations=l,this.segments=new $r,this.dynamicLayoutVertexArray=new Kc,this.opacityVertexArray=new Qn,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ar}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,d,f,b){this.isEmpty()||(f&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,EF.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,d),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,TF.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,ZF,!0),this.opacityVertexBuffer.itemSize=1),(f||b)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}qe("SymbolBuffers",Kv);class Qv{constructor(l,d,f){this.layoutVertexArray=new l,this.layoutAttributes=d,this.indexArray=new f,this.segments=new $r,this.collisionVertexArray=new Rn}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,CF.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}qe("CollisionBuffers",Qv);class of{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(T=>T.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Bv([]),this.placementViewportMatrix=Bv([]);const d=this.layers[0]._unevaluatedLayout._values;this.textSizeData=vA(this.zoom,d["text-size"]),this.iconSizeData=vA(this.zoom,d["icon-size"]);const f=this.layers[0].layout,b=f.get("symbol-sort-key"),x=f.get("symbol-z-order");this.canOverlap=Yv(f,"text-overlap","text-allow-overlap")!=="never"||Yv(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!b.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(T=>c.ah[T])),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=l.sourceID}createArrays(){this.text=new Kv(new eu(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new Kv(new eu(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new Dr,this.lineVertexArray=new ai,this.symbolInstances=new Tr,this.textAnchorOffsets=new ti}calculateGlyphDependencies(l,d,f,b,x){for(let T=0;T<l.length;T++)if(d[l.charCodeAt(T)]=!0,(f||b)&&x){const L=Km[l.charAt(T)];L&&(d[L.charCodeAt(0)]=!0)}}populate(l,d,f){const b=this.layers[0],x=b.layout,T=x.get("text-font"),L=x.get("text-field"),k=x.get("icon-image"),O=(L.value.kind!=="constant"||L.value.value instanceof ki&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),V=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,$=x.get("symbol-sort-key");if(this.features=[],!O&&!V)return;const K=d.iconDependencies,et=d.glyphDependencies,lt=d.availableImages,ft=new Ai(this.zoom);for(const{feature:Tt,id:Mt,index:Jt,sourceLayerIndex:Gt}of l){const Ht=b._featureFilter.needGeometry,ae=ru(Tt,Ht);if(!b._featureFilter.filter(ft,ae,f))continue;let Ce,Ve;if(Ht||(ae.geometry=Wu(Tt)),O){const Ue=b.getValueAndResolveTokens("text-field",ae,f,lt),Oe=ki.factory(Ue),nr=this.hasRTLText=this.hasRTLText||YF(Oe);(!nr||Hs.getRTLTextPluginStatus()==="unavailable"||nr&&Hs.isParsed())&&(Ce=IF(Oe,b,ae))}if(V){const Ue=b.getValueAndResolveTokens("icon-image",ae,f,lt);Ve=Ue instanceof Ii?Ue:Ii.fromString(Ue)}if(!Ce&&!Ve)continue;const yr=this.sortFeaturesByKey?$.evaluate(ae,{},f):void 0;if(this.features.push({id:Mt,text:Ce,icon:Ve,index:Jt,sourceLayerIndex:Gt,geometry:ae.geometry,properties:Tt.properties,type:XF[Tt.type],sortKey:yr}),Ve&&(K[Ve.name]=!0),Ce){const Ue=T.evaluate(ae,{},f).join(","),Oe=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ah.vertical)>=0;for(const nr of Ce.sections)if(nr.image)K[nr.image.name]=!0;else{const Xe=jd(Ce.toString()),He=nr.fontStack||Ue,fe=et[He]=et[He]||{};this.calculateGlyphDependencies(nr.text,fe,Oe,this.allowVerticalPlacement,Xe)}}}x.get("symbol-placement")==="line"&&(this.features=function(Tt){const Mt={},Jt={},Gt=[];let Ht=0;function ae(Ue){Gt.push(Tt[Ue]),Ht++}function Ce(Ue,Oe,nr){const Xe=Jt[Ue];return delete Jt[Ue],Jt[Oe]=Xe,Gt[Xe].geometry[0].pop(),Gt[Xe].geometry[0]=Gt[Xe].geometry[0].concat(nr[0]),Xe}function Ve(Ue,Oe,nr){const Xe=Mt[Oe];return delete Mt[Oe],Mt[Ue]=Xe,Gt[Xe].geometry[0].shift(),Gt[Xe].geometry[0]=nr[0].concat(Gt[Xe].geometry[0]),Xe}function yr(Ue,Oe,nr){const Xe=nr?Oe[0][Oe[0].length-1]:Oe[0][0];return`${Ue}:${Xe.x}:${Xe.y}`}for(let Ue=0;Ue<Tt.length;Ue++){const Oe=Tt[Ue],nr=Oe.geometry,Xe=Oe.text?Oe.text.toString():null;if(!Xe){ae(Ue);continue}const He=yr(Xe,nr),fe=yr(Xe,nr,!0);if(He in Jt&&fe in Mt&&Jt[He]!==Mt[fe]){const sr=Ve(He,fe,nr),er=Ce(He,fe,Gt[sr].geometry);delete Mt[He],delete Jt[fe],Jt[yr(Xe,Gt[er].geometry,!0)]=er,Gt[sr].geometry=null}else He in Jt?Ce(He,fe,nr):fe in Mt?Ve(He,fe,nr):(ae(Ue),Mt[He]=Ht-1,Jt[fe]=Ht-1)}return Gt.filter(Ue=>Ue.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Tt,Mt)=>Tt.sortKey-Mt.sortKey)}update(l,d,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,d,this.layers,f),this.icon.programConfigurations.updatePaintArrays(l,d,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,d){const f=this.lineVertexArray.length;if(l.segment!==void 0){let b=l.dist(d[l.segment+1]),x=l.dist(d[l.segment]);const T={};for(let L=l.segment+1;L<d.length;L++)T[L]={x:d[L].x,y:d[L].y,tileUnitDistanceFromAnchor:b},L<d.length-1&&(b+=d[L+1].dist(d[L]));for(let L=l.segment||0;L>=0;L--)T[L]={x:d[L].x,y:d[L].y,tileUnitDistanceFromAnchor:x},L>0&&(x+=d[L-1].dist(d[L]));for(let L=0;L<d.length;L++){const k=T[L];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(l,d,f,b,x,T,L,k,O,V,$,K){const et=l.indexArray,lt=l.layoutVertexArray,ft=l.segments.prepareSegment(4*d.length,lt,et,this.canOverlap?T.sortKey:void 0),Tt=this.glyphOffsetArray.length,Mt=ft.vertexLength,Jt=this.allowVerticalPlacement&&L===c.ah.vertical?Math.PI/2:0,Gt=T.text&&T.text.sections;for(let Ht=0;Ht<d.length;Ht++){const{tl:ae,tr:Ce,bl:Ve,br:yr,tex:Ue,pixelOffsetTL:Oe,pixelOffsetBR:nr,minFontScaleX:Xe,minFontScaleY:He,glyphOffset:fe,isSDF:sr,sectionIndex:er}=d[Ht],Cr=ft.vertexLength,Bi=fe[1];g1(lt,k.x,k.y,ae.x,Bi+ae.y,Ue.x,Ue.y,f,sr,Oe.x,Oe.y,Xe,He),g1(lt,k.x,k.y,Ce.x,Bi+Ce.y,Ue.x+Ue.w,Ue.y,f,sr,nr.x,Oe.y,Xe,He),g1(lt,k.x,k.y,Ve.x,Bi+Ve.y,Ue.x,Ue.y+Ue.h,f,sr,Oe.x,nr.y,Xe,He),g1(lt,k.x,k.y,yr.x,Bi+yr.y,Ue.x+Ue.w,Ue.y+Ue.h,f,sr,nr.x,nr.y,Xe,He),Jv(l.dynamicLayoutVertexArray,k,Jt),et.emplaceBack(Cr,Cr+1,Cr+2),et.emplaceBack(Cr+1,Cr+2,Cr+3),ft.vertexLength+=4,ft.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(fe[0]),Ht!==d.length-1&&er===d[Ht+1].sectionIndex||l.programConfigurations.populatePaintArrays(lt.length,T,T.index,{},K,Gt&&Gt[er])}l.placedSymbolArray.emplaceBack(k.x,k.y,Tt,this.glyphOffsetArray.length-Tt,Mt,O,V,k.segment,f?f[0]:0,f?f[1]:0,b[0],b[1],L,0,!1,0,$)}_addCollisionDebugVertex(l,d,f,b,x,T){return d.emplaceBack(0,0),l.emplaceBack(f.x,f.y,b,x,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(l,d,f,b,x,T,L){const k=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),O=k.vertexLength,V=x.layoutVertexArray,$=x.collisionVertexArray,K=L.anchorX,et=L.anchorY;this._addCollisionDebugVertex(V,$,T,K,et,new S(l,d)),this._addCollisionDebugVertex(V,$,T,K,et,new S(f,d)),this._addCollisionDebugVertex(V,$,T,K,et,new S(f,b)),this._addCollisionDebugVertex(V,$,T,K,et,new S(l,b)),k.vertexLength+=4;const lt=x.indexArray;lt.emplaceBack(O,O+1),lt.emplaceBack(O+1,O+2),lt.emplaceBack(O+2,O+3),lt.emplaceBack(O+3,O),k.primitiveLength+=4}addDebugCollisionBoxes(l,d,f,b){for(let x=l;x<d;x++){const T=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,b?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Qv(ys,rA.members,en),this.iconCollisionBox=new Qv(ys,rA.members,en);for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);this.addDebugCollisionBoxes(d.textBoxStartIndex,d.textBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.iconBoxStartIndex,d.iconBoxEndIndex,d,!1),this.addDebugCollisionBoxes(d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d,!1)}}_deserializeCollisionBoxesForSymbol(l,d,f,b,x,T,L,k,O){const V={};for(let $=d;$<f;$++){const K=l.get($);V.textBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},V.textFeatureIndex=K.featureIndex;break}for(let $=b;$<x;$++){const K=l.get($);V.verticalTextBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},V.verticalTextFeatureIndex=K.featureIndex;break}for(let $=T;$<L;$++){const K=l.get($);V.iconBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},V.iconFeatureIndex=K.featureIndex;break}for(let $=k;$<O;$++){const K=l.get($);V.verticalIconBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},V.verticalIconFeatureIndex=K.featureIndex;break}return V}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,d){const f=l.placedSymbolArray.get(d),b=f.vertexStartIndex+4*f.numGlyphs;for(let x=f.vertexStartIndex;x<b;x+=4)l.indexArray.emplaceBack(x,x+1,x+2),l.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const d=Math.sin(l),f=Math.cos(l),b=[],x=[],T=[];for(let L=0;L<this.symbolInstances.length;++L){T.push(L);const k=this.symbolInstances.get(L);b.push(0|Math.round(d*k.anchorX+f*k.anchorY)),x.push(k.featureIndex)}return T.sort((L,k)=>b[L]-b[k]||x[k]-x[L]),T}addToSortKeyRanges(l,d){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===d?f.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:d,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const d of this.symbolInstanceIndexes){const f=this.symbolInstances.get(d);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((b,x,T)=>{b>=0&&T.indexOf(b)===x&&this.addIndicesForPlacedSymbol(this.text,b)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let bA,wA;qe("SymbolBucket",of,{omit:["layers","collisionBoxArray","features","compareText"]}),of.MAX_GLYPHS=65535,of.addDynamicAttributes=Jv;var tb={get paint(){return wA=wA||new g({"icon-opacity":new gr(st.paint_symbol["icon-opacity"]),"icon-color":new gr(st.paint_symbol["icon-color"]),"icon-halo-color":new gr(st.paint_symbol["icon-halo-color"]),"icon-halo-width":new gr(st.paint_symbol["icon-halo-width"]),"icon-halo-blur":new gr(st.paint_symbol["icon-halo-blur"]),"icon-translate":new Je(st.paint_symbol["icon-translate"]),"icon-translate-anchor":new Je(st.paint_symbol["icon-translate-anchor"]),"text-opacity":new gr(st.paint_symbol["text-opacity"]),"text-color":new gr(st.paint_symbol["text-color"],{runtimeType:Hr,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new gr(st.paint_symbol["text-halo-color"]),"text-halo-width":new gr(st.paint_symbol["text-halo-width"]),"text-halo-blur":new gr(st.paint_symbol["text-halo-blur"]),"text-translate":new Je(st.paint_symbol["text-translate"]),"text-translate-anchor":new Je(st.paint_symbol["text-translate-anchor"])})},get layout(){return bA=bA||new g({"symbol-placement":new Je(st.layout_symbol["symbol-placement"]),"symbol-spacing":new Je(st.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Je(st.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new gr(st.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Je(st.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Je(st.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Je(st.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Je(st.layout_symbol["icon-ignore-placement"]),"icon-optional":new Je(st.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Je(st.layout_symbol["icon-rotation-alignment"]),"icon-size":new gr(st.layout_symbol["icon-size"]),"icon-text-fit":new Je(st.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Je(st.layout_symbol["icon-text-fit-padding"]),"icon-image":new gr(st.layout_symbol["icon-image"]),"icon-rotate":new gr(st.layout_symbol["icon-rotate"]),"icon-padding":new gr(st.layout_symbol["icon-padding"]),"icon-keep-upright":new Je(st.layout_symbol["icon-keep-upright"]),"icon-offset":new gr(st.layout_symbol["icon-offset"]),"icon-anchor":new gr(st.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Je(st.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Je(st.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Je(st.layout_symbol["text-rotation-alignment"]),"text-field":new gr(st.layout_symbol["text-field"]),"text-font":new gr(st.layout_symbol["text-font"]),"text-size":new gr(st.layout_symbol["text-size"]),"text-max-width":new gr(st.layout_symbol["text-max-width"]),"text-line-height":new Je(st.layout_symbol["text-line-height"]),"text-letter-spacing":new gr(st.layout_symbol["text-letter-spacing"]),"text-justify":new gr(st.layout_symbol["text-justify"]),"text-radial-offset":new gr(st.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Je(st.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new gr(st.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new gr(st.layout_symbol["text-anchor"]),"text-max-angle":new Je(st.layout_symbol["text-max-angle"]),"text-writing-mode":new Je(st.layout_symbol["text-writing-mode"]),"text-rotate":new gr(st.layout_symbol["text-rotate"]),"text-padding":new Je(st.layout_symbol["text-padding"]),"text-keep-upright":new Je(st.layout_symbol["text-keep-upright"]),"text-transform":new gr(st.layout_symbol["text-transform"]),"text-offset":new gr(st.layout_symbol["text-offset"]),"text-allow-overlap":new Je(st.layout_symbol["text-allow-overlap"]),"text-overlap":new Je(st.layout_symbol["text-overlap"]),"text-ignore-placement":new Je(st.layout_symbol["text-ignore-placement"]),"text-optional":new Je(st.layout_symbol["text-optional"])})}};class xA{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:wi,this.defaultValue=l}evaluate(l){if(l.formattedSection){const d=this.defaultValue.property.overrides;if(d&&d.hasOverride(l.formattedSection))return d.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qe("FormatSectionOverride",xA,{omit:["defaultValue"]});class y1 extends h{constructor(l){super(l,tb)}recalculate(l,d){if(super.recalculate(l,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const b=[];for(const x of f)b.indexOf(x)<0&&b.push(x);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,d,f,b){const x=this.layout.get(l).evaluate(d,{},f,b),T=this._unevaluatedLayout._values[l];return T.isDataDriven()||Go(T.value)||!x?x:function(L,k){return k.replace(/{([^{}]+)}/g,(O,V)=>L&&V in L?String(L[V]):"")}(d.properties,x)}createBucket(l){return new of(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const l of tb.paint.overridableProperties){if(!y1.hasPaintOverride(this.layout,l))continue;const d=this.paint.get(l),f=new xA(d),b=new _l(f,d.property.specification);let x=null;x=d.value.kind==="constant"||d.value.kind==="source"?new Ts("source",b):new so("composite",b,d.value.zoomStops),this.paint._values[l]=new Ho(d.property,x,d.parameters)}}_handleOverridablePaintPropertyUpdate(l,d,f){return!(!this.layout||d.isDataDriven()||f.isDataDriven())&&y1.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,d){const f=l.get("text-field"),b=tb.paint.properties[d];let x=!1;const T=L=>{for(const k of L)if(b.overrides&&b.overrides.hasOverride(k))return void(x=!0)};if(f.value.kind==="constant"&&f.value.value instanceof ki)T(f.value.value.sections);else if(f.value.kind==="source"){const L=O=>{x||(O instanceof bn&&xi(O.value)===si?T(O.value.sections):O instanceof Fc?T(O.sections):O.eachChild(L))},k=f.value;k._styleExpression&&L(k._styleExpression.expression)}return x}}let SA;var JF={get paint(){return SA=SA||new g({"background-color":new Je(st.paint_background["background-color"]),"background-pattern":new A(st.paint_background["background-pattern"]),"background-opacity":new Je(st.paint_background["background-opacity"])})}};class KF extends h{constructor(l){super(l,JF)}}let AA;var QF={get paint(){return AA=AA||new g({"raster-opacity":new Je(st.paint_raster["raster-opacity"]),"raster-hue-rotate":new Je(st.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Je(st.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Je(st.paint_raster["raster-brightness-max"]),"raster-saturation":new Je(st.paint_raster["raster-saturation"]),"raster-contrast":new Je(st.paint_raster["raster-contrast"]),"raster-resampling":new Je(st.paint_raster["raster-resampling"]),"raster-fade-duration":new Je(st.paint_raster["raster-fade-duration"])})}};class tD extends h{constructor(l){super(l,QF)}}class eD extends h{constructor(l){super(l,{}),this.onAdd=d=>{this.implementation.onAdd&&this.implementation.onAdd(d,d.painter.context.gl)},this.onRemove=d=>{this.implementation.onRemove&&this.implementation.onRemove(d,d.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class rD{constructor(l){this._methodToThrottle=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const eb=63710088e-1;class jh{constructor(l,d){if(isNaN(l)||isNaN(d))throw new Error(`Invalid LngLat object: (${l}, ${d})`);if(this.lng=+l,this.lat=+d,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new jh(bt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const d=Math.PI/180,f=this.lat*d,b=l.lat*d,x=Math.sin(f)*Math.sin(b)+Math.cos(f)*Math.cos(b)*Math.cos((l.lng-this.lng)*d);return eb*Math.acos(Math.min(x,1))}static convert(l){if(l instanceof jh)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new jh(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new jh(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const EA=2*Math.PI*eb;function TA(u){return EA*Math.cos(u*Math.PI/180)}function CA(u){return(180+u)/360}function PA(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function IA(u,l){return u/TA(l)}function rb(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}class rg{constructor(l,d){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+l,this.y=+d,this.z=+f}static fromLngLat(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const f=jh.convert(l);return new rg(CA(f.lng),PA(f.lat),IA(d,f.lat))}toLngLat(){return new jh(360*this.x-180,rb(this.y))}toAltitude(){return this.z*TA(rb(this.y))}meterInMercatorCoordinateUnits(){return 1/EA*(l=rb(this.y),1/Math.cos(l*Math.PI/180));var l}}function LA(u,l,d){var f=2*Math.PI*6378137/256/Math.pow(2,d);return[u*f-2*Math.PI*6378137/2,l*f-2*Math.PI*6378137/2]}class ib{constructor(l,d,f){if(!function(b,x,T){return!(b<0||b>25||T<0||T>=Math.pow(2,b)||x<0||x>=Math.pow(2,b))}(l,d,f))throw new Error(`x=${d}, y=${f}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=d,this.y=f,this.key=ig(0,l,l,d,f)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,d,f){const b=(T=this.y,L=this.z,k=LA(256*(x=this.x),256*(T=Math.pow(2,L)-T-1),L),O=LA(256*(x+1),256*(T+1),L),k[0]+","+k[1]+","+O[0]+","+O[1]);var x,T,L,k,O;const V=function($,K,et){let lt,ft="";for(let Tt=$;Tt>0;Tt--)lt=1<<Tt-1,ft+=(K&lt?1:0)+(et&lt?2:0);return ft}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,d>1?"@2x":"").replace(/{quadkey}/g,V).replace(/{bbox-epsg-3857}/g,b)}isChildOf(l){const d=this.z-l.z;return d>0&&l.x===this.x>>d&&l.y===this.y>>d}getTilePoint(l){const d=Math.pow(2,this.z);return new S((l.x*d-this.x)*zi,(l.y*d-this.y)*zi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class MA{constructor(l,d){this.wrap=l,this.canonical=d,this.key=ig(l,d.z,d.z,d.x,d.y)}}class qa{constructor(l,d,f,b,x){if(l<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${f}`);this.overscaledZ=l,this.wrap=d,this.canonical=new ib(f,+b,+x),this.key=ig(d,l,f,b,x)}clone(){return new qa(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-l;return l>this.canonical.z?new qa(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qa(l,this.wrap,l,this.canonical.x>>d,this.canonical.y>>d)}calculateScaledKey(l,d){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-l;return l>this.canonical.z?ig(this.wrap*+d,l,this.canonical.z,this.canonical.x,this.canonical.y):ig(this.wrap*+d,l,l,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(l){if(l.wrap!==this.wrap)return!1;const d=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>d&&l.canonical.y===this.canonical.y>>d}children(l){if(this.overscaledZ>=l)return[new qa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const d=this.canonical.z+1,f=2*this.canonical.x,b=2*this.canonical.y;return[new qa(d,this.wrap,d,f,b),new qa(d,this.wrap,d,f+1,b),new qa(d,this.wrap,d,f,b+1),new qa(d,this.wrap,d,f+1,b+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new qa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new qa(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new MA(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new rg(l.x-this.wrap,l.y))}}function ig(u,l,d,f,b){(u*=2)<0&&(u=-1*u-1);const x=1<<d;return(x*x*u+x*b+f).toString(36)+d.toString(36)+l.toString(36)}qe("CanonicalTileID",ib),qe("OverscaledTileID",qa,{omit:["posMatrix"]});class BA{constructor(l,d,f){let b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,L=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=l,d.height!==d.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void It(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=d.height;const k=this.dim=d.height-2;switch(this.data=new Uint32Array(d.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=x,this.blueFactor=T,this.baseShift=L;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let O=0;O<k;O++)this.data[this._idx(-1,O)]=this.data[this._idx(0,O)],this.data[this._idx(k,O)]=this.data[this._idx(k-1,O)],this.data[this._idx(O,-1)]=this.data[this._idx(O,0)],this.data[this._idx(O,k)]=this.data[this._idx(O,k-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(k,-1)]=this.data[this._idx(k-1,0)],this.data[this._idx(-1,k)]=this.data[this._idx(0,k-1)],this.data[this._idx(k,k)]=this.data[this._idx(k-1,k-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let O=0;O<k;O++)for(let V=0;V<k;V++){const $=this.get(O,V);$>this.max&&(this.max=$),$<this.min&&(this.min=$)}}get(l,d){const f=new Uint8Array(this.data.buffer),b=4*this._idx(l,d);return this.unpack(f[b],f[b+1],f[b+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,d){if(l<-1||l>=this.dim+1||d<-1||d>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(d+1)*this.stride+(l+1)}unpack(l,d,f){return l*this.redFactor+d*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new Va({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,d,f){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let b=d*this.dim,x=d*this.dim+this.dim,T=f*this.dim,L=f*this.dim+this.dim;switch(d){case-1:b=x-1;break;case 1:x=b+1}switch(f){case-1:T=L-1;break;case 1:L=T+1}const k=-d*this.dim,O=-f*this.dim;for(let V=T;V<L;V++)for(let $=b;$<x;$++)this.data[this._idx($,V)]=l.data[this._idx($+k,V+O)]}}qe("DEMData",BA);class kA{constructor(l){this._stringToNumber={},this._numberToString=[];for(let d=0;d<l.length;d++){const f=l[d];this._stringToNumber[f]=d,this._numberToString[d]=f}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class RA{constructor(l,d,f,b,x){this.type="Feature",this._vectorTileFeature=l,l._z=d,l._x=f,l._y=b,this.properties=l.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={geometry:this.geometry};for(const d in this)d!=="_geometry"&&d!=="_vectorTileFeature"&&(l[d]=this[d]);return l}}class FA{constructor(l,d){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new Zc(zi,16,0),this.grid3D=new Zc(zi,16,0),this.featureIndexArray=new li,this.promoteId=d}insert(l,d,f,b,x,T){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,b,x);const k=T?this.grid3D:this.grid;for(let O=0;O<d.length;O++){const V=d[O],$=[1/0,1/0,-1/0,-1/0];for(let K=0;K<V.length;K++){const et=V[K];$[0]=Math.min($[0],et.x),$[1]=Math.min($[1],et.y),$[2]=Math.max($[2],et.x),$[3]=Math.max($[3],et.y)}$[0]<zi&&$[1]<zi&&$[2]>=0&&$[3]>=0&&k.insert(L,$[0],$[1],$[2],$[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Nh.VectorTile(new Hv(this.rawTileData)).layers,this.sourceLayerCoder=new kA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,d,f,b){this.loadVTLayers();const x=l.params||{},T=zi/l.tileSize/l.scale,L=Vo(x.filter),k=l.queryGeometry,O=l.queryPadding*T,V=NA(k),$=this.grid.query(V.minX-O,V.minY-O,V.maxX+O,V.maxY+O),K=NA(l.cameraQueryGeometry),et=this.grid3D.query(K.minX-O,K.minY-O,K.maxX+O,K.maxY+O,(Tt,Mt,Jt,Gt)=>function(Ht,ae,Ce,Ve,yr){for(const Oe of Ht)if(ae<=Oe.x&&Ce<=Oe.y&&Ve>=Oe.x&&yr>=Oe.y)return!0;const Ue=[new S(ae,Ce),new S(ae,yr),new S(Ve,yr),new S(Ve,Ce)];if(Ht.length>2){for(const Oe of Ue)if(nu(Ht,Oe))return!0}for(let Oe=0;Oe<Ht.length-1;Oe++)if(Vm(Ht[Oe],Ht[Oe+1],Ue))return!0;return!1}(l.cameraQueryGeometry,Tt-O,Mt-O,Jt+O,Gt+O));for(const Tt of et)$.push(Tt);$.sort(iD);const lt={};let ft;for(let Tt=0;Tt<$.length;Tt++){const Mt=$[Tt];if(Mt===ft)continue;ft=Mt;const Jt=this.featureIndexArray.get(Mt);let Gt=null;this.loadMatchingFeature(lt,Jt.bucketIndex,Jt.sourceLayerIndex,Jt.featureIndex,L,x.layers,x.availableImages,d,f,b,(Ht,ae,Ce)=>(Gt||(Gt=Wu(Ht)),ae.queryIntersectsFeature(k,Ht,Ce,Gt,this.z,l.transform,T,l.pixelPosMatrix)))}return lt}loadMatchingFeature(l,d,f,b,x,T,L,k,O,V,$){const K=this.bucketLayerIDs[d];if(T&&!function(Tt,Mt){for(let Jt=0;Jt<Tt.length;Jt++)if(Mt.indexOf(Tt[Jt])>=0)return!0;return!1}(T,K))return;const et=this.sourceLayerCoder.decode(f),lt=this.vtLayers[et].feature(b);if(x.needGeometry){const Tt=ru(lt,!0);if(!x.filter(new Ai(this.tileID.overscaledZ),Tt,this.tileID.canonical))return}else if(!x.filter(new Ai(this.tileID.overscaledZ),lt))return;const ft=this.getId(lt,et);for(let Tt=0;Tt<K.length;Tt++){const Mt=K[Tt];if(T&&T.indexOf(Mt)<0)continue;const Jt=k[Mt];if(!Jt)continue;let Gt={};ft&&V&&(Gt=V.getState(Jt.sourceLayer||"_geojsonTileLayer",ft));const Ht=vt({},O[Mt]);Ht.paint=DA(Ht.paint,Jt.paint,lt,Gt,L),Ht.layout=DA(Ht.layout,Jt.layout,lt,Gt,L);const ae=!$||$(lt,Jt,Gt);if(!ae)continue;const Ce=new RA(lt,this.z,this.x,this.y,ft);Ce.layer=Ht;let Ve=l[Mt];Ve===void 0&&(Ve=l[Mt]=[]),Ve.push({featureIndex:b,feature:Ce,intersectionZ:ae})}}lookupSymbolFeatures(l,d,f,b,x,T,L,k){const O={};this.loadVTLayers();const V=Vo(x);for(const $ of l)this.loadMatchingFeature(O,f,b,$,V,T,L,k,d);return O}hasLayer(l){for(const d of this.bucketLayerIDs)for(const f of d)if(l===f)return!0;return!1}getId(l,d){let f=l.id;return this.promoteId&&(f=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[d]],typeof f=="boolean"&&(f=Number(f))),f}}function DA(u,l,d,f,b){return Dt(u,(x,T)=>{const L=l instanceof xl?l.get(T):null;return L&&L.evaluate?L.evaluate(d,f,b):L})}function NA(u){let l=1/0,d=1/0,f=-1/0,b=-1/0;for(const x of u)l=Math.min(l,x.x),d=Math.min(d,x.y),f=Math.max(f,x.x),b=Math.max(b,x.y);return{minX:l,minY:d,maxX:f,maxY:b}}function iD(u,l){return l-u}function OA(u,l,d,f,b){const x=[];for(let T=0;T<u.length;T++){const L=u[T];let k;for(let O=0;O<L.length-1;O++){let V=L[O],$=L[O+1];V.x<l&&$.x<l||(V.x<l?V=new S(l,V.y+(l-V.x)/($.x-V.x)*($.y-V.y))._round():$.x<l&&($=new S(l,V.y+(l-V.x)/($.x-V.x)*($.y-V.y))._round()),V.y<d&&$.y<d||(V.y<d?V=new S(V.x+(d-V.y)/($.y-V.y)*($.x-V.x),d)._round():$.y<d&&($=new S(V.x+(d-V.y)/($.y-V.y)*($.x-V.x),d)._round()),V.x>=f&&$.x>=f||(V.x>=f?V=new S(f,V.y+(f-V.x)/($.x-V.x)*($.y-V.y))._round():$.x>=f&&($=new S(f,V.y+(f-V.x)/($.x-V.x)*($.y-V.y))._round()),V.y>=b&&$.y>=b||(V.y>=b?V=new S(V.x+(b-V.y)/($.y-V.y)*($.x-V.x),b)._round():$.y>=b&&($=new S(V.x+(b-V.y)/($.y-V.y)*($.x-V.x),b)._round()),k&&V.equals(k[k.length-1])||(k=[V],x.push(k)),k.push($)))))}}return x}qe("FeatureIndex",FA,{omit:["rawTileData","sourceLayerCoder"]});class Uh extends S{constructor(l,d,f,b){super(l,d),this.angle=f,b!==void 0&&(this.segment=b)}clone(){return new Uh(this.x,this.y,this.angle,this.segment)}}function zA(u,l,d,f,b){if(l.segment===void 0||d===0)return!0;let x=l,T=l.segment+1,L=0;for(;L>-d/2;){if(T--,T<0)return!1;L-=u[T].dist(x),x=u[T]}L+=u[T].dist(u[T+1]),T++;const k=[];let O=0;for(;L<d/2;){const V=u[T],$=u[T+1];if(!$)return!1;let K=u[T-1].angleTo(V)-V.angleTo($);for(K=Math.abs((K+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:L,angleDelta:K}),O+=K;L-k[0].distance>f;)O-=k.shift().angleDelta;if(O>b)return!1;T++,L+=V.dist($)}return!0}function jA(u){let l=0;for(let d=0;d<u.length-1;d++)l+=u[d].dist(u[d+1]);return l}function UA(u,l,d){return u?.6*l*d:0}function GA(u,l){return Math.max(u?u.right-u.left:0,l?l.right-l.left:0)}function nD(u,l,d,f,b,x){const T=UA(d,b,x),L=GA(d,f)*x;let k=0;const O=jA(u)/2;for(let V=0;V<u.length-1;V++){const $=u[V],K=u[V+1],et=$.dist(K);if(k+et>O){const lt=(O-k)/et,ft=Un.number($.x,K.x,lt),Tt=Un.number($.y,K.y,lt),Mt=new Uh(ft,Tt,K.angleTo($),V);return Mt._round(),!T||zA(u,Mt,L,T,l)?Mt:void 0}k+=et}}function sD(u,l,d,f,b,x,T,L,k){const O=UA(f,x,T),V=GA(f,b),$=V*T,K=u[0].x===0||u[0].x===k||u[0].y===0||u[0].y===k;return l-$<l/4&&(l=$+l/4),VA(u,K?l/2*L%l:(V/2+2*x)*T*L%l,l,O,d,$,K,!1,k)}function VA(u,l,d,f,b,x,T,L,k){const O=x/2,V=jA(u);let $=0,K=l-d,et=[];for(let lt=0;lt<u.length-1;lt++){const ft=u[lt],Tt=u[lt+1],Mt=ft.dist(Tt),Jt=Tt.angleTo(ft);for(;K+d<$+Mt;){K+=d;const Gt=(K-$)/Mt,Ht=Un.number(ft.x,Tt.x,Gt),ae=Un.number(ft.y,Tt.y,Gt);if(Ht>=0&&Ht<k&&ae>=0&&ae<k&&K-O>=0&&K+O<=V){const Ce=new Uh(Ht,ae,Jt,lt);Ce._round(),f&&!zA(u,Ce,x,f,b)||et.push(Ce)}}$+=Mt}return L||et.length||T||(et=VA(u,$/2,d,f,b,x,T,!0,k)),et}qe("Anchor",Uh);const af=Wo;function qA(u,l,d,f){const b=[],x=u.image,T=x.pixelRatio,L=x.paddedRect.w-2*af,k=x.paddedRect.h-2*af;let O={x1:u.left,y1:u.top,x2:u.right,y2:u.bottom};const V=x.stretchX||[[0,L]],$=x.stretchY||[[0,k]],K=(fe,sr)=>fe+sr[1]-sr[0],et=V.reduce(K,0),lt=$.reduce(K,0),ft=L-et,Tt=k-lt;let Mt=0,Jt=et,Gt=0,Ht=lt,ae=0,Ce=ft,Ve=0,yr=Tt;if(x.content&&f){const fe=x.content,sr=fe[2]-fe[0],er=fe[3]-fe[1];(x.textFitWidth||x.textFitHeight)&&(O=yA(u)),Mt=_1(V,0,fe[0]),Gt=_1($,0,fe[1]),Jt=_1(V,fe[0],fe[2]),Ht=_1($,fe[1],fe[3]),ae=fe[0]-Mt,Ve=fe[1]-Gt,Ce=sr-Jt,yr=er-Ht}const Ue=O.x1,Oe=O.y1,nr=O.x2-Ue,Xe=O.y2-Oe,He=(fe,sr,er,Cr)=>{const Bi=v1(fe.stretch-Mt,Jt,nr,Ue),Ti=b1(fe.fixed-ae,Ce,fe.stretch,et),rs=v1(sr.stretch-Gt,Ht,Xe,Oe),Pl=b1(sr.fixed-Ve,yr,sr.stretch,lt),Is=v1(er.stretch-Mt,Jt,nr,Ue),is=b1(er.fixed-ae,Ce,er.stretch,et),fo=v1(Cr.stretch-Gt,Ht,Xe,Oe),mo=b1(Cr.fixed-Ve,yr,Cr.stretch,lt),go=new S(Bi,rs),_n=new S(Is,rs),ns=new S(Is,fo),Zs=new S(Bi,fo),Ls=new S(Ti/T,Pl/T),yo=new S(is/T,mo/T),Ms=l*Math.PI/180;if(Ms){const ci=Math.sin(Ms),ji=Math.cos(Ms),$i=[ji,-ci,ci,ji];go._matMult($i),_n._matMult($i),Zs._matMult($i),ns._matMult($i)}const Ha=fe.stretch+fe.fixed,Xo=sr.stretch+sr.fixed;return{tl:go,tr:_n,bl:Zs,br:ns,tex:{x:x.paddedRect.x+af+Ha,y:x.paddedRect.y+af+Xo,w:er.stretch+er.fixed-Ha,h:Cr.stretch+Cr.fixed-Xo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ls,pixelOffsetBR:yo,minFontScaleX:Ce/T/nr,minFontScaleY:yr/T/Xe,isSDF:d}};if(f&&(x.stretchX||x.stretchY)){const fe=HA(V,ft,et),sr=HA($,Tt,lt);for(let er=0;er<fe.length-1;er++){const Cr=fe[er],Bi=fe[er+1];for(let Ti=0;Ti<sr.length-1;Ti++)b.push(He(Cr,sr[Ti],Bi,sr[Ti+1]))}}else b.push(He({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:k+1}));return b}function _1(u,l,d){let f=0;for(const b of u)f+=Math.max(l,Math.min(d,b[1]))-Math.max(l,Math.min(d,b[0]));return f}function HA(u,l,d){const f=[{fixed:-af,stretch:0}];for(const[b,x]of u){const T=f[f.length-1];f.push({fixed:b-T.stretch,stretch:T.stretch}),f.push({fixed:b-T.stretch,stretch:T.stretch+(x-b)})}return f.push({fixed:l+af,stretch:d}),f}function v1(u,l,d,f){return u/l*d+f}function b1(u,l,d,f){return u-l*d/f}class w1{constructor(l,d,f,b,x,T,L,k,O,V){var $;if(this.boxStartIndex=l.length,O){let K=T.top,et=T.bottom;const lt=T.collisionPadding;lt&&(K-=lt[1],et+=lt[3]);let ft=et-K;ft>0&&(ft=Math.max(10,ft),this.circleDiameter=ft)}else{const K=!(($=T.image)===null||$===void 0)&&$.content&&(T.image.textFitWidth||T.image.textFitHeight)?yA(T):{x1:T.left,y1:T.top,x2:T.right,y2:T.bottom};K.y1=K.y1*L-k[0],K.y2=K.y2*L+k[2],K.x1=K.x1*L-k[3],K.x2=K.x2*L+k[1];const et=T.collisionPadding;if(et&&(K.x1-=et[0]*L,K.y1-=et[1]*L,K.x2+=et[2]*L,K.y2+=et[3]*L),V){const lt=new S(K.x1,K.y1),ft=new S(K.x2,K.y1),Tt=new S(K.x1,K.y2),Mt=new S(K.x2,K.y2),Jt=V*Math.PI/180;lt._rotate(Jt),ft._rotate(Jt),Tt._rotate(Jt),Mt._rotate(Jt),K.x1=Math.min(lt.x,ft.x,Tt.x,Mt.x),K.x2=Math.max(lt.x,ft.x,Tt.x,Mt.x),K.y1=Math.min(lt.y,ft.y,Tt.y,Mt.y),K.y2=Math.max(lt.y,ft.y,Tt.y,Mt.y)}l.emplaceBack(d.x,d.y,K.x1,K.y1,K.x2,K.y2,f,b,x)}this.boxEndIndex=l.length}}class oD{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(f,b)=>f<b?-1:f>b?1:0;if(this.data=l,this.length=this.data.length,this.compare=d,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],d=this.data.pop();return--this.length>0&&(this.data[0]=d,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:d,compare:f}=this,b=d[l];for(;l>0;){const x=l-1>>1,T=d[x];if(f(b,T)>=0)break;d[l]=T,l=x}d[l]=b}_down(l){const{data:d,compare:f}=this,b=this.length>>1,x=d[l];for(;l<b;){let T=1+(l<<1);const L=T+1;if(L<this.length&&f(d[L],d[T])<0&&(T=L),f(d[T],x)>=0)break;d[l]=d[T],l=T}d[l]=x}}function aD(u){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,f=1/0,b=1/0,x=-1/0,T=-1/0;const L=u[0];for(let et=0;et<L.length;et++){const lt=L[et];(!et||lt.x<f)&&(f=lt.x),(!et||lt.y<b)&&(b=lt.y),(!et||lt.x>x)&&(x=lt.x),(!et||lt.y>T)&&(T=lt.y)}const k=Math.min(x-f,T-b);let O=k/2;const V=new oD([],lD);if(k===0)return new S(f,b);for(let et=f;et<x;et+=k)for(let lt=b;lt<T;lt+=k)V.push(new lf(et+O,lt+O,O,u));let $=function(et){let lt=0,ft=0,Tt=0;const Mt=et[0];for(let Jt=0,Gt=Mt.length,Ht=Gt-1;Jt<Gt;Ht=Jt++){const ae=Mt[Jt],Ce=Mt[Ht],Ve=ae.x*Ce.y-Ce.x*ae.y;ft+=(ae.x+Ce.x)*Ve,Tt+=(ae.y+Ce.y)*Ve,lt+=3*Ve}return new lf(ft/lt,Tt/lt,0,et)}(u),K=V.length;for(;V.length;){const et=V.pop();(et.d>$.d||!$.d)&&($=et,d&&console.log("found best %d after %d probes",Math.round(1e4*et.d)/1e4,K)),et.max-$.d<=l||(O=et.h/2,V.push(new lf(et.p.x-O,et.p.y-O,O,u)),V.push(new lf(et.p.x+O,et.p.y-O,O,u)),V.push(new lf(et.p.x-O,et.p.y+O,O,u)),V.push(new lf(et.p.x+O,et.p.y+O,O,u)),K+=4)}return d&&(console.log(`num probes: ${K}`),console.log(`best distance: ${$.d}`)),$.p}function lD(u,l){return l.max-u.max}function lf(u,l,d,f){this.p=new S(u,l),this.h=d,this.d=function(b,x){let T=!1,L=1/0;for(let k=0;k<x.length;k++){const O=x[k];for(let V=0,$=O.length,K=$-1;V<$;K=V++){const et=O[V],lt=O[K];et.y>b.y!=lt.y>b.y&&b.x<(lt.x-et.x)*(b.y-et.y)/(lt.y-et.y)+et.x&&(T=!T),L=Math.min(L,Gm(b,et,lt))}}return(T?1:-1)*Math.sqrt(L)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var Ps;c.aq=void 0,(Ps=c.aq||(c.aq={}))[Ps.center=1]="center",Ps[Ps.left=2]="left",Ps[Ps.right=3]="right",Ps[Ps.top=4]="top",Ps[Ps.bottom=5]="bottom",Ps[Ps["top-left"]=6]="top-left",Ps[Ps["top-right"]=7]="top-right",Ps[Ps["bottom-left"]=8]="bottom-left",Ps[Ps["bottom-right"]=9]="bottom-right";const Gh=7,nb=Number.POSITIVE_INFINITY;function $A(u,l){return l[1]!==nb?function(d,f,b){let x=0,T=0;switch(f=Math.abs(f),b=Math.abs(b),d){case"top-right":case"top-left":case"top":T=b-Gh;break;case"bottom-right":case"bottom-left":case"bottom":T=-b+Gh}switch(d){case"top-right":case"bottom-right":case"right":x=-f;break;case"top-left":case"bottom-left":case"left":x=f}return[x,T]}(u,l[0],l[1]):function(d,f){let b=0,x=0;f<0&&(f=0);const T=f/Math.SQRT2;switch(d){case"top-right":case"top-left":x=T-Gh;break;case"bottom-right":case"bottom-left":x=-T+Gh;break;case"bottom":x=-f+Gh;break;case"top":x=f-Gh}switch(d){case"top-right":case"bottom-right":b=-T;break;case"top-left":case"bottom-left":b=T;break;case"left":b=f;break;case"right":b=-f}return[b,x]}(u,l[0])}function WA(u,l,d){var f;const b=u.layout,x=(f=b.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(l,{},d);if(x){const L=x.values,k=[];for(let O=0;O<L.length;O+=2){const V=k[O]=L[O],$=L[O+1].map(K=>K*qn);V.startsWith("top")?$[1]-=Gh:V.startsWith("bottom")&&($[1]+=Gh),k[O+1]=$}return new Fi(k)}const T=b.get("text-variable-anchor");if(T){let L;L=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[b.get("text-radial-offset").evaluate(l,{},d)*qn,nb]:b.get("text-offset").evaluate(l,{},d).map(O=>O*qn);const k=[];for(const O of T)k.push(O,$A(O,L));return new Fi(k)}return null}function sb(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function cD(u,l,d,f,b,x,T,L,k,O,V){let $=x.textMaxSize.evaluate(l,{});$===void 0&&($=T);const K=u.layers[0].layout,et=K.get("icon-offset").evaluate(l,{},V),lt=ZA(d.horizontal),ft=T/24,Tt=u.tilePixelRatio*ft,Mt=u.tilePixelRatio*$/24,Jt=u.tilePixelRatio*L,Gt=u.tilePixelRatio*K.get("symbol-spacing"),Ht=K.get("text-padding")*u.tilePixelRatio,ae=function(fe,sr,er){let Cr=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const Bi=fe.get("icon-padding").evaluate(sr,{},er),Ti=Bi&&Bi.values;return[Ti[0]*Cr,Ti[1]*Cr,Ti[2]*Cr,Ti[3]*Cr]}(K,l,V,u.tilePixelRatio),Ce=K.get("text-max-angle")/180*Math.PI,Ve=K.get("text-rotation-alignment")!=="viewport"&&K.get("symbol-placement")!=="point",yr=K.get("icon-rotation-alignment")==="map"&&K.get("symbol-placement")!=="point",Ue=K.get("symbol-placement"),Oe=Gt/2,nr=K.get("icon-text-fit");let Xe;f&&nr!=="none"&&(u.allowVerticalPlacement&&d.vertical&&(Xe=_A(f,d.vertical,nr,K.get("icon-text-fit-padding"),et,ft)),lt&&(f=_A(f,lt,nr,K.get("icon-text-fit-padding"),et,ft)));const He=(fe,sr)=>{sr.x<0||sr.x>=zi||sr.y<0||sr.y>=zi||function(er,Cr,Bi,Ti,rs,Pl,Is,is,fo,mo,go,_n,ns,Zs,Ls,yo,Ms,Ha,Xo,ci,ji,$i,ma,dn,cf){const ou=er.addToLineVertexArray(Cr,Bi);let au,Il,$a,_s,Yu=0,og=0,QA=0,tE=0,pb=-1,fb=-1;const Ju={};let eE=Fh("");if(er.allowVerticalPlacement&&Ti.vertical){const Ys=is.layout.get("text-rotate").evaluate(ji,{},dn)+90;$a=new w1(fo,Cr,mo,go,_n,Ti.vertical,ns,Zs,Ls,Ys),Is&&(_s=new w1(fo,Cr,mo,go,_n,Is,Ms,Ha,Ls,Ys))}if(rs){const Ys=is.layout.get("icon-rotate").evaluate(ji,{}),Wa=is.layout.get("icon-text-fit")!=="none",Yd=qA(rs,Ys,ma,Wa),oc=Is?qA(Is,Ys,ma,Wa):void 0;Il=new w1(fo,Cr,mo,go,_n,rs,Ms,Ha,!1,Ys),Yu=4*Yd.length;const Jd=er.iconSizeData;let lu=null;Jd.kind==="source"?(lu=[su*is.layout.get("icon-size").evaluate(ji,{})],lu[0]>zh&&It(`${er.layerIds[0]}: Value for "icon-size" is >= ${eg}. Reduce your "icon-size".`)):Jd.kind==="composite"&&(lu=[su*$i.compositeIconSizes[0].evaluate(ji,{},dn),su*$i.compositeIconSizes[1].evaluate(ji,{},dn)],(lu[0]>zh||lu[1]>zh)&&It(`${er.layerIds[0]}: Value for "icon-size" is >= ${eg}. Reduce your "icon-size".`)),er.addSymbols(er.icon,Yd,lu,ci,Xo,ji,c.ah.none,Cr,ou.lineStartIndex,ou.lineLength,-1,dn),pb=er.icon.placedSymbolArray.length-1,oc&&(og=4*oc.length,er.addSymbols(er.icon,oc,lu,ci,Xo,ji,c.ah.vertical,Cr,ou.lineStartIndex,ou.lineLength,-1,dn),fb=er.icon.placedSymbolArray.length-1)}const rE=Object.keys(Ti.horizontal);for(const Ys of rE){const Wa=Ti.horizontal[Ys];if(!au){eE=Fh(Wa.text);const oc=is.layout.get("text-rotate").evaluate(ji,{},dn);au=new w1(fo,Cr,mo,go,_n,Wa,ns,Zs,Ls,oc)}const Yd=Wa.positionedLines.length===1;if(QA+=XA(er,Cr,Wa,Pl,is,Ls,ji,yo,ou,Ti.vertical?c.ah.horizontal:c.ah.horizontalOnly,Yd?rE:[Ys],Ju,pb,$i,dn),Yd)break}Ti.vertical&&(tE+=XA(er,Cr,Ti.vertical,Pl,is,Ls,ji,yo,ou,c.ah.vertical,["vertical"],Ju,fb,$i,dn));const dD=au?au.boxStartIndex:er.collisionBoxArray.length,pD=au?au.boxEndIndex:er.collisionBoxArray.length,fD=$a?$a.boxStartIndex:er.collisionBoxArray.length,mD=$a?$a.boxEndIndex:er.collisionBoxArray.length,gD=Il?Il.boxStartIndex:er.collisionBoxArray.length,yD=Il?Il.boxEndIndex:er.collisionBoxArray.length,_D=_s?_s.boxStartIndex:er.collisionBoxArray.length,vD=_s?_s.boxEndIndex:er.collisionBoxArray.length;let sc=-1;const S1=(Ys,Wa)=>Ys&&Ys.circleDiameter?Math.max(Ys.circleDiameter,Wa):Wa;sc=S1(au,sc),sc=S1($a,sc),sc=S1(Il,sc),sc=S1(_s,sc);const iE=sc>-1?1:0;iE&&(sc*=cf/qn),er.glyphOffsetArray.length>=of.MAX_GLYPHS&&It("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ji.sortKey!==void 0&&er.addToSortKeyRanges(er.symbolInstances.length,ji.sortKey);const bD=WA(is,ji,dn),[wD,xD]=function(Ys,Wa){const Yd=Ys.length,oc=Wa==null?void 0:Wa.values;if((oc==null?void 0:oc.length)>0)for(let Jd=0;Jd<oc.length;Jd+=2){const lu=oc[Jd+1];Ys.emplaceBack(c.aq[oc[Jd]],lu[0],lu[1])}return[Yd,Ys.length]}(er.textAnchorOffsets,bD);er.symbolInstances.emplaceBack(Cr.x,Cr.y,Ju.right>=0?Ju.right:-1,Ju.center>=0?Ju.center:-1,Ju.left>=0?Ju.left:-1,Ju.vertical||-1,pb,fb,eE,dD,pD,fD,mD,gD,yD,_D,vD,mo,QA,tE,Yu,og,iE,0,ns,sc,wD,xD)}(u,sr,fe,d,f,b,Xe,u.layers[0],u.collisionBoxArray,l.index,l.sourceLayerIndex,u.index,Tt,[Ht,Ht,Ht,Ht],Ve,k,Jt,ae,yr,et,l,x,O,V,T)};if(Ue==="line")for(const fe of OA(l.geometry,0,0,zi,zi)){const sr=sD(fe,Gt,Ce,d.vertical||lt,f,24,Mt,u.overscaling,zi);for(const er of sr)lt&&uD(u,lt.text,Oe,er)||He(fe,er)}else if(Ue==="line-center"){for(const fe of l.geometry)if(fe.length>1){const sr=nD(fe,Ce,d.vertical||lt,f,24,Mt);sr&&He(fe,sr)}}else if(l.type==="Polygon")for(const fe of na(l.geometry,0)){const sr=aD(fe,16);He(fe[0],new Uh(sr.x,sr.y,0))}else if(l.type==="LineString")for(const fe of l.geometry)He(fe,new Uh(fe[0].x,fe[0].y,0));else if(l.type==="Point")for(const fe of l.geometry)for(const sr of fe)He([sr],new Uh(sr.x,sr.y,0))}function XA(u,l,d,f,b,x,T,L,k,O,V,$,K,et,lt){const ft=function(Jt,Gt,Ht,ae,Ce,Ve,yr,Ue){const Oe=ae.layout.get("text-rotate").evaluate(Ve,{})*Math.PI/180,nr=[];for(const Xe of Gt.positionedLines)for(const He of Xe.positionedGlyphs){if(!He.rect)continue;const fe=He.rect||{};let sr=uA+1,er=!0,Cr=1,Bi=0;const Ti=(Ce||Ue)&&He.vertical,rs=He.metrics.advance*He.scale/2;if(Ue&&Gt.verticalizable&&(Bi=Xe.lineOffset/2-(He.imageName?-(qn-He.metrics.width*He.scale)/2:(He.scale-1)*qn)),He.imageName){const ci=yr[He.imageName];er=ci.sdf,Cr=ci.pixelRatio,sr=Wo/Cr}const Pl=Ce?[He.x+rs,He.y]:[0,0];let Is=Ce?[0,0]:[He.x+rs+Ht[0],He.y+Ht[1]-Bi],is=[0,0];Ti&&(is=Is,Is=[0,0]);const fo=He.metrics.isDoubleResolution?2:1,mo=(He.metrics.left-sr)*He.scale-rs+Is[0],go=(-He.metrics.top-sr)*He.scale+Is[1],_n=mo+fe.w/fo*He.scale/Cr,ns=go+fe.h/fo*He.scale/Cr,Zs=new S(mo,go),Ls=new S(_n,go),yo=new S(mo,ns),Ms=new S(_n,ns);if(Ti){const ci=new S(-rs,rs-Qm),ji=-Math.PI/2,$i=qn/2-rs,ma=new S(5-Qm-$i,-(He.imageName?$i:0)),dn=new S(...is);Zs._rotateAround(ji,ci)._add(ma)._add(dn),Ls._rotateAround(ji,ci)._add(ma)._add(dn),yo._rotateAround(ji,ci)._add(ma)._add(dn),Ms._rotateAround(ji,ci)._add(ma)._add(dn)}if(Oe){const ci=Math.sin(Oe),ji=Math.cos(Oe),$i=[ji,-ci,ci,ji];Zs._matMult($i),Ls._matMult($i),yo._matMult($i),Ms._matMult($i)}const Ha=new S(0,0),Xo=new S(0,0);nr.push({tl:Zs,tr:Ls,bl:yo,br:Ms,tex:fe,writingMode:Gt.writingMode,glyphOffset:Pl,sectionIndex:He.sectionIndex,isSDF:er,pixelOffsetTL:Ha,pixelOffsetBR:Xo,minFontScaleX:0,minFontScaleY:0})}return nr}(0,d,L,b,x,T,f,u.allowVerticalPlacement),Tt=u.textSizeData;let Mt=null;Tt.kind==="source"?(Mt=[su*b.layout.get("text-size").evaluate(T,{})],Mt[0]>zh&&It(`${u.layerIds[0]}: Value for "text-size" is >= ${eg}. Reduce your "text-size".`)):Tt.kind==="composite"&&(Mt=[su*et.compositeTextSizes[0].evaluate(T,{},lt),su*et.compositeTextSizes[1].evaluate(T,{},lt)],(Mt[0]>zh||Mt[1]>zh)&&It(`${u.layerIds[0]}: Value for "text-size" is >= ${eg}. Reduce your "text-size".`)),u.addSymbols(u.text,ft,Mt,L,x,T,O,l,k.lineStartIndex,k.lineLength,K,lt);for(const Jt of V)$[Jt]=u.text.placedSymbolArray.length-1;return 4*ft.length}function ZA(u){for(const l in u)return u[l];return null}function uD(u,l,d,f){const b=u.compareText;if(l in b){const x=b[l];for(let T=x.length-1;T>=0;T--)if(f.dist(x[T])<d)return!0}else b[l]=[];return b[l].push(f),!1}const YA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ob{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[d,f]=new Uint8Array(l,0,2);if(d!==219)throw new Error("Data does not appear to be in a KDBush format.");const b=f>>4;if(b!==1)throw new Error(`Got v${b} data when expected v1.`);const x=YA[15&f];if(!x)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(l,2,1),[L]=new Uint32Array(l,4,1);return new ob(L,T,x,l)}constructor(l){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,b=arguments.length>3?arguments[3]:void 0;if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+d,2),65535),this.ArrayType=f,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const x=YA.indexOf(this.ArrayType),T=2*l*this.ArrayType.BYTES_PER_ELEMENT,L=l*this.IndexArrayType.BYTES_PER_ELEMENT,k=(8-L%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${f}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+L+k,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+T+L+k),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+L+k,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=d,new Uint32Array(this.data,4,1)[0]=l)}add(l,d){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=l,this.coords[this._pos++]=d,f}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return ab(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,d,f,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:T,nodeSize:L}=this,k=[0,x.length-1,0],O=[];for(;k.length;){const V=k.pop()||0,$=k.pop()||0,K=k.pop()||0;if($-K<=L){for(let Tt=K;Tt<=$;Tt++){const Mt=T[2*Tt],Jt=T[2*Tt+1];Mt>=l&&Mt<=f&&Jt>=d&&Jt<=b&&O.push(x[Tt])}continue}const et=K+$>>1,lt=T[2*et],ft=T[2*et+1];lt>=l&&lt<=f&&ft>=d&&ft<=b&&O.push(x[et]),(V===0?l<=lt:d<=ft)&&(k.push(K),k.push(et-1),k.push(1-V)),(V===0?f>=lt:b>=ft)&&(k.push(et+1),k.push($),k.push(1-V))}return O}within(l,d,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:x,nodeSize:T}=this,L=[0,b.length-1,0],k=[],O=f*f;for(;L.length;){const V=L.pop()||0,$=L.pop()||0,K=L.pop()||0;if($-K<=T){for(let Tt=K;Tt<=$;Tt++)KA(x[2*Tt],x[2*Tt+1],l,d)<=O&&k.push(b[Tt]);continue}const et=K+$>>1,lt=x[2*et],ft=x[2*et+1];KA(lt,ft,l,d)<=O&&k.push(b[et]),(V===0?l-f<=lt:d-f<=ft)&&(L.push(K),L.push(et-1),L.push(1-V)),(V===0?l+f>=lt:d+f>=ft)&&(L.push(et+1),L.push($),L.push(1-V))}return k}}function ab(u,l,d,f,b,x){if(b-f<=d)return;const T=f+b>>1;JA(u,l,T,f,b,x),ab(u,l,d,f,T-1,1-x),ab(u,l,d,T+1,b,1-x)}function JA(u,l,d,f,b,x){for(;b>f;){if(b-f>600){const O=b-f+1,V=d-f+1,$=Math.log(O),K=.5*Math.exp(2*$/3),et=.5*Math.sqrt($*K*(O-K)/O)*(V-O/2<0?-1:1);JA(u,l,d,Math.max(f,Math.floor(d-V*K/O+et)),Math.min(b,Math.floor(d+(O-V)*K/O+et)),x)}const T=l[2*d+x];let L=f,k=b;for(ng(u,l,f,d),l[2*b+x]>T&&ng(u,l,f,b);L<k;){for(ng(u,l,L,k),L++,k--;l[2*L+x]<T;)L++;for(;l[2*k+x]>T;)k--}l[2*f+x]===T?ng(u,l,f,k):(k++,ng(u,l,k,b)),k<=d&&(f=k+1),d<=k&&(b=k-1)}}function ng(u,l,d,f){lb(u,d,f),lb(l,2*d,2*f),lb(l,2*d+1,2*f+1)}function lb(u,l,d){const f=u[l];u[l]=u[d],u[d]=f}function KA(u,l,d,f){const b=u-d,x=l-f;return b*b+x*x}var cb;c.bg=void 0,(cb=c.bg||(c.bg={})).create="create",cb.load="load",cb.fullLoad="fullLoad";let x1=null,sg=[];const ub=1e3/60,hb="loadTime",db="fullLoadTime",hD={mark(u){performance.mark(u)},frame(u){const l=u;x1!=null&&sg.push(l-x1),x1=l},clearMetrics(){x1=null,sg=[],performance.clearMeasures(hb),performance.clearMeasures(db);for(const u in c.bg)performance.clearMarks(c.bg[u])},getPerformanceMetrics(){performance.measure(hb,c.bg.create,c.bg.load),performance.measure(db,c.bg.create,c.bg.fullLoad);const u=performance.getEntriesByName(hb)[0].duration,l=performance.getEntriesByName(db)[0].duration,d=sg.length,f=1/(sg.reduce((x,T)=>x+T,0)/d/1e3),b=sg.filter(x=>x>ub).reduce((x,T)=>x+(T-ub)/ub,0);return{loadTime:u,fullLoadTime:l,fps:f,percentDroppedFrames:b/(d+b)*100,totalFrames:d}}};c.$=class extends G{},c.A=tf,c.B=Fm,c.C=function(u){if(ee==null){const l=u.navigator?u.navigator.userAgent:null;ee=!!u.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return ee},c.D=Je,c.E=le,c.F=class{constructor(u,l){this.target=u,this.mapId=l,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new rD(()=>this.process()),this.subscription=function(d,f,b,x){return d.addEventListener(f,b,!1),{unsubscribe:()=>{d.removeEventListener(f,b,!1)}}}(this.target,"message",d=>this.receive(d)),this.globalScope=re(self)?u:window}registerMessageHandler(u,l){this.messageHandlers[u]=l}sendAsync(u,l){return new Promise((d,f)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[b]={resolve:d,reject:f},l&&l.signal.addEventListener("abort",()=>{delete this.resolveRejects[b];const L={id:b,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(L)},{once:!0});const x=[],T=Object.assign(Object.assign({},u),{id:b,sourceMapId:this.mapId,origin:location.origin,data:Yc(u.data,x)});this.target.postMessage(T,{transfer:x})})}receive(u){const l=u.data,d=l.id;if(!(l.origin!=="file://"&&location.origin!=="file://"&&l.origin!=="resource://android"&&location.origin!=="resource://android"&&l.origin!==location.origin||l.targetMapId&&this.mapId!==l.targetMapId)){if(l.type==="<cancel>"){delete this.tasks[d];const f=this.abortControllers[d];return delete this.abortControllers[d],void(f&&f.abort())}if(re(self)||l.mustQueue)return this.tasks[d]=l,this.taskQueue.push(d),void this.invoker.trigger();this.processTask(d,l)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),l=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),l&&this.processTask(u,l)}processTask(u,l){return a(this,void 0,void 0,function*(){if(l.type==="<response>"){const b=this.resolveRejects[u];return delete this.resolveRejects[u],b?void(l.error?b.reject(ec(l.error)):b.resolve(ec(l.data))):void 0}if(!this.messageHandlers[l.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${l.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const d=ec(l.data),f=new AbortController;this.abortControllers[u]=f;try{const b=yield this.messageHandlers[l.type](l.sourceMapId,d,f);this.completeTask(u,null,b)}catch(b){this.completeTask(u,b)}})}completeTask(u,l,d){const f=[];delete this.abortControllers[u];const b={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:l?Yc(l):null,data:Yc(d,f)};this.target.postMessage(b,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.G=qt,c.H=function(){var u=new tf(16);return tf!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},c.I=Wv,c.J=function(u,l,d){var f,b,x,T,L,k,O,V,$,K,et,lt,ft=d[0],Tt=d[1],Mt=d[2];return l===u?(u[12]=l[0]*ft+l[4]*Tt+l[8]*Mt+l[12],u[13]=l[1]*ft+l[5]*Tt+l[9]*Mt+l[13],u[14]=l[2]*ft+l[6]*Tt+l[10]*Mt+l[14],u[15]=l[3]*ft+l[7]*Tt+l[11]*Mt+l[15]):(b=l[1],x=l[2],T=l[3],L=l[4],k=l[5],O=l[6],V=l[7],$=l[8],K=l[9],et=l[10],lt=l[11],u[0]=f=l[0],u[1]=b,u[2]=x,u[3]=T,u[4]=L,u[5]=k,u[6]=O,u[7]=V,u[8]=$,u[9]=K,u[10]=et,u[11]=lt,u[12]=f*ft+L*Tt+$*Mt+l[12],u[13]=b*ft+k*Tt+K*Mt+l[13],u[14]=x*ft+O*Tt+et*Mt+l[14],u[15]=T*ft+V*Tt+lt*Mt+l[15]),u},c.K=function(u,l,d){var f=d[0],b=d[1],x=d[2];return u[0]=l[0]*f,u[1]=l[1]*f,u[2]=l[2]*f,u[3]=l[3]*f,u[4]=l[4]*b,u[5]=l[5]*b,u[6]=l[6]*b,u[7]=l[7]*b,u[8]=l[8]*x,u[9]=l[9]*x,u[10]=l[10]*x,u[11]=l[11]*x,u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15],u},c.L=B3,c.M=function(u,l){const d={};for(let f=0;f<l.length;f++){const b=l[f];b in u&&(d[b]=u[b])}return d},c.N=jh,c.O=CA,c.P=S,c.Q=PA,c.R=Va,c.S=qa,c.T=Rh,c.U=U,c.V=z,c.W=Xt,c.X=zi,c.Y=E,c.Z=rg,c._=a,c.a=Pt,c.a$=function(u,l){var d=u[0],f=u[1],b=u[2],x=u[3],T=u[4],L=u[5],k=u[6],O=u[7],V=u[8],$=u[9],K=u[10],et=u[11],lt=u[12],ft=u[13],Tt=u[14],Mt=u[15],Jt=l[0],Gt=l[1],Ht=l[2],ae=l[3],Ce=l[4],Ve=l[5],yr=l[6],Ue=l[7],Oe=l[8],nr=l[9],Xe=l[10],He=l[11],fe=l[12],sr=l[13],er=l[14],Cr=l[15];return Math.abs(d-Jt)<=po*Math.max(1,Math.abs(d),Math.abs(Jt))&&Math.abs(f-Gt)<=po*Math.max(1,Math.abs(f),Math.abs(Gt))&&Math.abs(b-Ht)<=po*Math.max(1,Math.abs(b),Math.abs(Ht))&&Math.abs(x-ae)<=po*Math.max(1,Math.abs(x),Math.abs(ae))&&Math.abs(T-Ce)<=po*Math.max(1,Math.abs(T),Math.abs(Ce))&&Math.abs(L-Ve)<=po*Math.max(1,Math.abs(L),Math.abs(Ve))&&Math.abs(k-yr)<=po*Math.max(1,Math.abs(k),Math.abs(yr))&&Math.abs(O-Ue)<=po*Math.max(1,Math.abs(O),Math.abs(Ue))&&Math.abs(V-Oe)<=po*Math.max(1,Math.abs(V),Math.abs(Oe))&&Math.abs($-nr)<=po*Math.max(1,Math.abs($),Math.abs(nr))&&Math.abs(K-Xe)<=po*Math.max(1,Math.abs(K),Math.abs(Xe))&&Math.abs(et-He)<=po*Math.max(1,Math.abs(et),Math.abs(He))&&Math.abs(lt-fe)<=po*Math.max(1,Math.abs(lt),Math.abs(fe))&&Math.abs(ft-sr)<=po*Math.max(1,Math.abs(ft),Math.abs(sr))&&Math.abs(Tt-er)<=po*Math.max(1,Math.abs(Tt),Math.abs(er))&&Math.abs(Mt-Cr)<=po*Math.max(1,Math.abs(Mt),Math.abs(Cr))},c.a0=$r,c.a1=ib,c.a2=me,c.a3=u=>{const l=window.document.createElement("video");return l.muted=!0,new Promise(d=>{l.onloadstart=()=>{d(l)};for(const f of u){const b=window.document.createElement("source");Ee(f)||(l.crossOrigin="Anonymous"),b.src=f,l.appendChild(b)}})},c.a4=function(){return mt++},c.a5=Ie,c.a6=of,c.a7=Vo,c.a8=ru,c.a9=RA,c.aA=function(u){if(u.type==="custom")return new eD(u);switch(u.type){case"background":return new KF(u);case"circle":return new OR(u);case"fill":return new eF(u);case"fill-extrusion":return new gF(u);case"heatmap":return new jR(u);case"hillshade":return new GR(u);case"line":return new AF(u);case"raster":return new tD(u);case"symbol":return new y1(u)}},c.aB=at,c.aC=function(u,l){if(!u)return[{command:"setStyle",args:[l]}];let d=[];try{if(!de(u.version,l.version))return[{command:"setStyle",args:[l]}];de(u.center,l.center)||d.push({command:"setCenter",args:[l.center]}),de(u.zoom,l.zoom)||d.push({command:"setZoom",args:[l.zoom]}),de(u.bearing,l.bearing)||d.push({command:"setBearing",args:[l.bearing]}),de(u.pitch,l.pitch)||d.push({command:"setPitch",args:[l.pitch]}),de(u.sprite,l.sprite)||d.push({command:"setSprite",args:[l.sprite]}),de(u.glyphs,l.glyphs)||d.push({command:"setGlyphs",args:[l.glyphs]}),de(u.transition,l.transition)||d.push({command:"setTransition",args:[l.transition]}),de(u.light,l.light)||d.push({command:"setLight",args:[l.light]}),de(u.terrain,l.terrain)||d.push({command:"setTerrain",args:[l.terrain]}),de(u.sky,l.sky)||d.push({command:"setSky",args:[l.sky]}),de(u.projection,l.projection)||d.push({command:"setProjection",args:[l.projection]});const f={},b=[];(function(T,L,k,O){let V;for(V in L=L||{},T=T||{})Object.prototype.hasOwnProperty.call(T,V)&&(Object.prototype.hasOwnProperty.call(L,V)||Ne(V,k,O));for(V in L)Object.prototype.hasOwnProperty.call(L,V)&&(Object.prototype.hasOwnProperty.call(T,V)?de(T[V],L[V])||(T[V].type==="geojson"&&L[V].type==="geojson"&&Er(T,L,V)?Te(k,{command:"setGeoJSONSourceData",args:[V,L[V].data]}):rr(V,L,k,O)):Be(V,L,k))})(u.sources,l.sources,b,f);const x=[];u.layers&&u.layers.forEach(T=>{"source"in T&&f[T.source]?d.push({command:"removeLayer",args:[T.id]}):x.push(T)}),d=d.concat(b),function(T,L,k){L=L||[];const O=(T=T||[]).map(Fr),V=L.map(Fr),$=T.reduce(Ur,{}),K=L.reduce(Ur,{}),et=O.slice(),lt=Object.create(null);let ft,Tt,Mt,Jt,Gt;for(let Ht=0,ae=0;Ht<O.length;Ht++)ft=O[Ht],Object.prototype.hasOwnProperty.call(K,ft)?ae++:(Te(k,{command:"removeLayer",args:[ft]}),et.splice(et.indexOf(ft,ae),1));for(let Ht=0,ae=0;Ht<V.length;Ht++)ft=V[V.length-1-Ht],et[et.length-1-Ht]!==ft&&(Object.prototype.hasOwnProperty.call($,ft)?(Te(k,{command:"removeLayer",args:[ft]}),et.splice(et.lastIndexOf(ft,et.length-ae),1)):ae++,Jt=et[et.length-Ht],Te(k,{command:"addLayer",args:[K[ft],Jt]}),et.splice(et.length-Ht,0,ft),lt[ft]=!0);for(let Ht=0;Ht<V.length;Ht++)if(ft=V[Ht],Tt=$[ft],Mt=K[ft],!lt[ft]&&!de(Tt,Mt))if(de(Tt.source,Mt.source)&&de(Tt["source-layer"],Mt["source-layer"])&&de(Tt.type,Mt.type)){for(Gt in wr(Tt.layout,Mt.layout,k,ft,null,"setLayoutProperty"),wr(Tt.paint,Mt.paint,k,ft,null,"setPaintProperty"),de(Tt.filter,Mt.filter)||Te(k,{command:"setFilter",args:[ft,Mt.filter]}),de(Tt.minzoom,Mt.minzoom)&&de(Tt.maxzoom,Mt.maxzoom)||Te(k,{command:"setLayerZoomRange",args:[ft,Mt.minzoom,Mt.maxzoom]}),Tt)Object.prototype.hasOwnProperty.call(Tt,Gt)&&Gt!=="layout"&&Gt!=="paint"&&Gt!=="filter"&&Gt!=="metadata"&&Gt!=="minzoom"&&Gt!=="maxzoom"&&(Gt.indexOf("paint.")===0?wr(Tt[Gt],Mt[Gt],k,ft,Gt.slice(6),"setPaintProperty"):de(Tt[Gt],Mt[Gt])||Te(k,{command:"setLayerProperty",args:[ft,Gt,Mt[Gt]]}));for(Gt in Mt)Object.prototype.hasOwnProperty.call(Mt,Gt)&&!Object.prototype.hasOwnProperty.call(Tt,Gt)&&Gt!=="layout"&&Gt!=="paint"&&Gt!=="filter"&&Gt!=="metadata"&&Gt!=="minzoom"&&Gt!=="maxzoom"&&(Gt.indexOf("paint.")===0?wr(Tt[Gt],Mt[Gt],k,ft,Gt.slice(6),"setPaintProperty"):de(Tt[Gt],Mt[Gt])||Te(k,{command:"setLayerProperty",args:[ft,Gt,Mt[Gt]]}))}else Te(k,{command:"removeLayer",args:[ft]}),Jt=et[et.lastIndexOf(ft)+1],Te(k,{command:"addLayer",args:[Mt,Jt]})}(x,l.layers,d)}catch(f){console.warn("Unable to compute style diff:",f),d=[{command:"setStyle",args:[l]}]}return d},c.aD=function(u){const l=[],d=u.id;return d===void 0&&l.push({message:`layers.${d}: missing required property "id"`}),u.render===void 0&&l.push({message:`layers.${d}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&l.push({message:`layers.${d}: property "renderingMode" must be either "2d" or "3d"`}),l},c.aE=function u(l,d){if(Array.isArray(l)){if(!Array.isArray(d)||l.length!==d.length)return!1;for(let f=0;f<l.length;f++)if(!u(l[f],d[f]))return!1;return!0}if(typeof l=="object"&&l!==null&&d!==null){if(typeof d!="object"||Object.keys(l).length!==Object.keys(d).length)return!1;for(const f in l)if(!u(l[f],d[f]))return!1;return!0}return l===d},c.aF=Dt,c.aG=kt,c.aH=class extends tu{constructor(u,l){super(u,l),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},c.aI=qd,c.aJ=class extends tu{constructor(u,l){super(u,l),this.current=$d}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let l=1;l<16;l++)if(u[l]!==this.current[l]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},c.aK=Hd,c.aL=Xp,c.aM=Jr,c.aN=class extends tu{constructor(u,l){super(u,l),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},c.aO=class extends tu{constructor(u,l){super(u,l),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},c.aP=function(u,l,d,f,b,x,T){var L=1/(l-d),k=1/(f-b),O=1/(x-T);return u[0]=-2*L,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*k,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*O,u[11]=0,u[12]=(l+d)*L,u[13]=(b+f)*k,u[14]=(T+x)*O,u[15]=1,u},c.aQ=NR,c.aR=class extends St{},c.aS=PF,c.aT=class extends Bt{},c.aU=Fv,c.aV=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},c.aW=N3,c.aX=Hi,c.aY=ts,c.aZ=class extends Se{},c.a_=function(u,l){return u[0]===l[0]&&u[1]===l[1]&&u[2]===l[2]&&u[3]===l[3]&&u[4]===l[4]&&u[5]===l[5]&&u[6]===l[6]&&u[7]===l[7]&&u[8]===l[8]&&u[9]===l[9]&&u[10]===l[10]&&u[11]===l[11]&&u[12]===l[12]&&u[13]===l[13]&&u[14]===l[14]&&u[15]===l[15]},c.aa=function(u){const l={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(d,f,b,x)=>{const T=b||x;return l[f]=!T||T.toLowerCase(),""}),l["max-age"]){const d=parseInt(l["max-age"],10);isNaN(d)?delete l["max-age"]:l["max-age"]=d}return l},c.ab=function(u,l){const d=[];for(const f in u)f in l||d.push(f);return d},c.ac=yt,c.ad=function(u,l,d){var f=Math.sin(d),b=Math.cos(d),x=l[0],T=l[1],L=l[2],k=l[3],O=l[4],V=l[5],$=l[6],K=l[7];return l!==u&&(u[8]=l[8],u[9]=l[9],u[10]=l[10],u[11]=l[11],u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15]),u[0]=x*b+O*f,u[1]=T*b+V*f,u[2]=L*b+$*f,u[3]=k*b+K*f,u[4]=O*b-x*f,u[5]=V*b-T*f,u[6]=$*b-L*f,u[7]=K*b-k*f,u},c.ae=function(u){var l=new tf(16);return l[0]=u[0],l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=u[6],l[7]=u[7],l[8]=u[8],l[9]=u[9],l[10]=u[10],l[11]=u[11],l[12]=u[12],l[13]=u[13],l[14]=u[14],l[15]=u[15],l},c.af=l1,c.ag=function(u,l){let d=0,f=0;if(u.kind==="constant")f=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:b,minZoom:x,maxZoom:T}=u,L=b?yt(pr.interpolationFactor(b,l,x,T),0,1):0;u.kind==="camera"?f=Un.number(u.minSize,u.maxSize,L):d=L}return{uSizeT:d,uSize:f}},c.ai=function(u,l,d){let{uSize:f,uSizeT:b}=l,{lowerSize:x,upperSize:T}=d;return u.kind==="source"?x/su:u.kind==="composite"?Un.number(x/su,T/su,b):f},c.aj=Jv,c.ak=function(u,l,d,f){const b=l.y-u.y,x=l.x-u.x,T=f.y-d.y,L=f.x-d.x,k=T*x-L*b;if(k===0)return null;const O=(L*(u.y-d.y)-T*(u.x-d.x))/k;return new S(u.x+O*x,u.y+O*b)},c.al=OA,c.am=Jp,c.an=Bv,c.ao=function(u){let l=1/0,d=1/0,f=-1/0,b=-1/0;for(const x of u)l=Math.min(l,x.x),d=Math.min(d,x.y),f=Math.max(f,x.x),b=Math.max(b,x.y);return[l,d,f,b]},c.ap=qn,c.ar=Yv,c.as=function(u,l){var d=l[0],f=l[1],b=l[2],x=l[3],T=l[4],L=l[5],k=l[6],O=l[7],V=l[8],$=l[9],K=l[10],et=l[11],lt=l[12],ft=l[13],Tt=l[14],Mt=l[15],Jt=d*L-f*T,Gt=d*k-b*T,Ht=d*O-x*T,ae=f*k-b*L,Ce=f*O-x*L,Ve=b*O-x*k,yr=V*ft-$*lt,Ue=V*Tt-K*lt,Oe=V*Mt-et*lt,nr=$*Tt-K*ft,Xe=$*Mt-et*ft,He=K*Mt-et*Tt,fe=Jt*He-Gt*Xe+Ht*nr+ae*Oe-Ce*Ue+Ve*yr;return fe?(u[0]=(L*He-k*Xe+O*nr)*(fe=1/fe),u[1]=(b*Xe-f*He-x*nr)*fe,u[2]=(ft*Ve-Tt*Ce+Mt*ae)*fe,u[3]=(K*Ce-$*Ve-et*ae)*fe,u[4]=(k*Oe-T*He-O*Ue)*fe,u[5]=(d*He-b*Oe+x*Ue)*fe,u[6]=(Tt*Ht-lt*Ve-Mt*Gt)*fe,u[7]=(V*Ve-K*Ht+et*Gt)*fe,u[8]=(T*Xe-L*Oe+O*yr)*fe,u[9]=(f*Oe-d*Xe-x*yr)*fe,u[10]=(lt*Ce-ft*Ht+Mt*Jt)*fe,u[11]=($*Ht-V*Ce-et*Jt)*fe,u[12]=(L*Ue-T*nr-k*yr)*fe,u[13]=(d*nr-f*Ue+b*yr)*fe,u[14]=(ft*Gt-lt*ae-Tt*Jt)*fe,u[15]=(V*ae-$*Gt+K*Jt)*fe,u):null},c.at=sb,c.au=Zv,c.av=ob,c.aw=function(){const u={},l=st.$version;for(const d in st.$root){const f=st.$root[d];if(f.required){let b=null;b=d==="version"?l:f.type==="array"?[]:{},b!=null&&(u[d]=b)}}return u},c.ax=da,c.ay=Qt,c.az=function(u){u=u.slice();const l=Object.create(null);for(let d=0;d<u.length;d++)l[u[d].id]=u[d];for(let d=0;d<u.length;d++)"ref"in u[d]&&(u[d]=Qe(u[d],l[u[d].ref]));return u},c.b=se,c.b0=function(u,l){return u[0]=l[0],u[1]=l[1],u[2]=l[2],u[3]=l[3],u[4]=l[4],u[5]=l[5],u[6]=l[6],u[7]=l[7],u[8]=l[8],u[9]=l[9],u[10]=l[10],u[11]=l[11],u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15],u},c.b1=function(u,l,d){return u[0]=l[0]*d[0],u[1]=l[1]*d[1],u[2]=l[2]*d[2],u[3]=l[3]*d[3],u},c.b2=function(u,l){return u[0]*l[0]+u[1]*l[1]+u[2]*l[2]+u[3]*l[3]},c.b3=bt,c.b4=MA,c.b5=IA,c.b6=function(u,l,d,f,b){var x,T=1/Math.tan(l/2);return u[0]=T/d,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=T,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,b!=null&&b!==1/0?(u[10]=(b+f)*(x=1/(f-b)),u[14]=2*b*f*x):(u[10]=-1,u[14]=-2*f),u},c.b7=function(u,l,d){var f=Math.sin(d),b=Math.cos(d),x=l[4],T=l[5],L=l[6],k=l[7],O=l[8],V=l[9],$=l[10],K=l[11];return l!==u&&(u[0]=l[0],u[1]=l[1],u[2]=l[2],u[3]=l[3],u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15]),u[4]=x*b+O*f,u[5]=T*b+V*f,u[6]=L*b+$*f,u[7]=k*b+K*f,u[8]=O*b-x*f,u[9]=V*b-T*f,u[10]=$*b-L*f,u[11]=K*b-k*f,u},c.b8=H,c.b9=nt,c.bA=iA,c.bB=function(u){return u.message===it},c.bC=Kn,c.bD=Hs,c.ba=function(u){return u*Math.PI/180},c.bb=function(u,l){const{x:d,y:f}=rg.fromLngLat(l);return!(u<0||u>25||f<0||f>=1||d<0||d>=1)},c.bc=function(u,l){return u[0]=l[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=l[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=l[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},c.bd=class extends D{},c.be=eb,c.bf=hD,c.bh=$t,c.bi=function(u,l){Pt.REGISTERED_PROTOCOLS[u]=l},c.bj=function(u){delete Pt.REGISTERED_PROTOCOLS[u]},c.bk=function(u,l){const d={};for(let b=0;b<u.length;b++){const x=l&&l[u[b].id]||kd(u[b]);l&&(l[u[b].id]=x);let T=d[x];T||(T=d[x]=[]),T.push(u[b])}const f=[];for(const b in d)f.push(d[b]);return f},c.bl=qe,c.bm=kA,c.bn=FA,c.bo=dA,c.bp=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=zi/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const l=u.bucket.layers[0],d=l.layout,f=l._unevaluatedLayout._values,b={layoutIconSize:f["icon-size"].possiblyEvaluate(new Ai(u.bucket.zoom+1),u.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new Ai(u.bucket.zoom+1),u.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new Ai(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:V}=u.bucket.textSizeData;b.compositeTextSizes=[f["text-size"].possiblyEvaluate(new Ai(O),u.canonical),f["text-size"].possiblyEvaluate(new Ai(V),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:V}=u.bucket.iconSizeData;b.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new Ai(O),u.canonical),f["icon-size"].possiblyEvaluate(new Ai(V),u.canonical)]}const x=d.get("text-line-height")*qn,T=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point",L=d.get("text-keep-upright"),k=d.get("text-size");for(const O of u.bucket.features){const V=d.get("text-font").evaluate(O,{},u.canonical).join(","),$=k.evaluate(O,{},u.canonical),K=b.layoutTextSize.evaluate(O,{},u.canonical),et=b.layoutIconSize.evaluate(O,{},u.canonical),lt={horizontal:{},vertical:void 0},ft=O.text;let Tt,Mt=[0,0];if(ft){const Ht=ft.toString(),ae=d.get("text-letter-spacing").evaluate(O,{},u.canonical)*qn,Ce=Dm(Ht)?ae:0,Ve=d.get("text-anchor").evaluate(O,{},u.canonical),yr=WA(l,O,u.canonical);if(!yr){const Xe=d.get("text-radial-offset").evaluate(O,{},u.canonical);Mt=Xe?$A(Ve,[Xe*qn,nb]):d.get("text-offset").evaluate(O,{},u.canonical).map(He=>He*qn)}let Ue=T?"center":d.get("text-justify").evaluate(O,{},u.canonical);const Oe=d.get("symbol-placement")==="point"?d.get("text-max-width").evaluate(O,{},u.canonical)*qn:1/0,nr=()=>{u.bucket.allowVerticalPlacement&&jd(Ht)&&(lt.vertical=f1(ft,u.glyphMap,u.glyphPositions,u.imagePositions,V,Oe,x,Ve,"left",Ce,Mt,c.ah.vertical,!0,K,$))};if(!T&&yr){const Xe=new Set;if(Ue==="auto")for(let fe=0;fe<yr.values.length;fe+=2)Xe.add(sb(yr.values[fe]));else Xe.add(Ue);let He=!1;for(const fe of Xe)if(!lt.horizontal[fe])if(He)lt.horizontal[fe]=lt.horizontal[0];else{const sr=f1(ft,u.glyphMap,u.glyphPositions,u.imagePositions,V,Oe,x,"center",fe,Ce,Mt,c.ah.horizontal,!1,K,$);sr&&(lt.horizontal[fe]=sr,He=sr.positionedLines.length===1)}nr()}else{Ue==="auto"&&(Ue=sb(Ve));const Xe=f1(ft,u.glyphMap,u.glyphPositions,u.imagePositions,V,Oe,x,Ve,Ue,Ce,Mt,c.ah.horizontal,!1,K,$);Xe&&(lt.horizontal[Ue]=Xe),nr(),jd(Ht)&&T&&L&&(lt.vertical=f1(ft,u.glyphMap,u.glyphPositions,u.imagePositions,V,Oe,x,Ve,Ue,Ce,Mt,c.ah.vertical,!1,K,$))}}let Jt=!1;if(O.icon&&O.icon.name){const Ht=u.imageMap[O.icon.name];Ht&&(Tt=WF(u.imagePositions[O.icon.name],d.get("icon-offset").evaluate(O,{},u.canonical),d.get("icon-anchor").evaluate(O,{},u.canonical)),Jt=!!Ht.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=Jt:u.bucket.sdfIcons!==Jt&&It("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ht.pixelRatio!==u.bucket.pixelRatio||d.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const Gt=ZA(lt.horizontal)||lt.vertical;u.bucket.iconsInText=!!Gt&&Gt.iconsInText,(Gt||Tt)&&cD(u.bucket,O,lt,Tt,u.imageMap,b,K,et,Mt,Jt,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},c.bq=Vv,c.br=jv,c.bs=Gv,c.bt=Nh,c.bu=Hv,c.bv=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},c.bw=function(u,l,d,f,b){return a(this,void 0,void 0,function*(){if(z())try{return yield Xt(u,l,d,f,b)}catch{}return function(x,T,L,k,O){const V=x.width,$=x.height;Wt&&xe||(Wt=new OffscreenCanvas(V,$),xe=Wt.getContext("2d",{willReadFrequently:!0})),Wt.width=V,Wt.height=$,xe.drawImage(x,0,0,V,$);const K=xe.getImageData(T,L,k,O);return xe.clearRect(0,0,V,$),K.data}(u,l,d,f,b)})},c.bx=BA,c.by=p,c.bz=_,c.c=Et,c.d=u=>a(void 0,void 0,void 0,function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const l=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(l)}catch(d){throw new Error(`Could not load image because of ${d.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),c.e=vt,c.f=u=>new Promise((l,d)=>{const f=new Image;f.onload=()=>{l(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Ot})},f.onerror=()=>d(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new Blob([new Uint8Array(u)],{type:"image/png"});f.src=u.byteLength?URL.createObjectURL(b):Ot}),c.g=jt,c.h=(u,l)=>Kt(vt(u,{type:"json"}),l),c.i=re,c.j=or,c.k=ze,c.l=(u,l)=>Kt(vt(u,{type:"arrayBuffer"}),l),c.m=Kt,c.n=function(u){return new Hv(u).readFields(jF,[])},c.o=$m,c.p=hA,c.q=g,c.r=zu,c.s=Ee,c.t=zd,c.u=za,c.v=st,c.w=It,c.x=function(u){let[l,d,f]=u;return d+=90,d*=Math.PI/180,f*=Math.PI/180,{x:l*Math.cos(d)*Math.sin(f),y:l*Math.sin(d)*Math.sin(f),z:l*Math.cos(f)}},c.y=Un,c.z=Ai}),n("worker",["./shared"],function(c){class a{constructor(J){this.keyCache={},J&&this.replace(J)}replace(J){this._layerConfigs={},this._layers={},this.update(J,[])}update(J,Q){for(const wt of J){this._layerConfigs[wt.id]=wt;const Nt=this._layers[wt.id]=c.aA(wt);Nt._featureFilter=c.a7(Nt.filter),this.keyCache[wt.id]&&delete this.keyCache[wt.id]}for(const wt of Q)delete this.keyCache[wt],delete this._layerConfigs[wt],delete this._layers[wt];this.familiesBySource={};const ut=c.bk(Object.values(this._layerConfigs),this.keyCache);for(const wt of ut){const Nt=wt.map(Zt=>this._layers[Zt.id]),Vt=Nt[0];if(Vt.visibility==="none")continue;const Ft=Vt.source||"";let Lt=this.familiesBySource[Ft];Lt||(Lt=this.familiesBySource[Ft]={});const ne=Vt.sourceLayer||"_geojsonTileLayer";let ue=Lt[ne];ue||(ue=Lt[ne]=[]),ue.push(Nt)}}}class p{constructor(J){const Q={},ut=[];for(const Ft in J){const Lt=J[Ft],ne=Q[Ft]={};for(const ue in Lt){const Zt=Lt[+ue];if(!Zt||Zt.bitmap.width===0||Zt.bitmap.height===0)continue;const be={x:0,y:0,w:Zt.bitmap.width+2,h:Zt.bitmap.height+2};ut.push(be),ne[ue]={rect:be,metrics:Zt.metrics}}}const{w:wt,h:Nt}=c.p(ut),Vt=new c.o({width:wt||1,height:Nt||1});for(const Ft in J){const Lt=J[Ft];for(const ne in Lt){const ue=Lt[+ne];if(!ue||ue.bitmap.width===0||ue.bitmap.height===0)continue;const Zt=Q[Ft][ne].rect;c.o.copy(ue.bitmap,Vt,{x:0,y:0},{x:Zt.x+1,y:Zt.y+1},ue.bitmap)}}this.image=Vt,this.positions=Q}}c.bl("GlyphAtlas",p);class _{constructor(J){this.tileID=new c.S(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.uid=J.uid,this.zoom=J.zoom,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.returnDependencies=!!J.returnDependencies,this.promoteId=J.promoteId,this.inFlightDependencies=[]}parse(J,Q,ut,wt){return c._(this,void 0,void 0,function*(){this.status="parsing",this.data=J,this.collisionBoxArray=new c.a5;const Nt=new c.bm(Object.keys(J.layers).sort()),Vt=new c.bn(this.tileID,this.promoteId);Vt.bucketLayerIDs=[];const Ft={},Lt={featureIndex:Vt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ut},ne=Q.familiesBySource[this.source];for(const dr in ne){const Nr=J.layers[dr];if(!Nr)continue;Nr.version===1&&c.w(`Vector tile source "${this.source}" layer "${dr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ei=Nt.encode(dr),yi=[];for(let Pi=0;Pi<Nr.length;Pi++){const tn=Nr.feature(Pi),Bo=Vt.getId(tn,dr);yi.push({feature:tn,id:Bo,index:Pi,sourceLayerIndex:ei})}for(const Pi of ne[dr]){const tn=Pi[0];tn.source!==this.source&&c.w(`layer.source = ${tn.source} does not equal this.source = ${this.source}`),tn.minzoom&&this.zoom<Math.floor(tn.minzoom)||tn.maxzoom&&this.zoom>=tn.maxzoom||tn.visibility!=="none"&&(w(Pi,this.zoom,ut),(Ft[tn.id]=tn.createBucket({index:Vt.bucketLayerIDs.length,layers:Pi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ei,sourceID:this.source})).populate(yi,Lt,this.tileID.canonical),Vt.bucketLayerIDs.push(Pi.map(Bo=>Bo.id)))}}const ue=c.aF(Lt.glyphDependencies,dr=>Object.keys(dr).map(Number));this.inFlightDependencies.forEach(dr=>dr==null?void 0:dr.abort()),this.inFlightDependencies=[];let Zt=Promise.resolve({});if(Object.keys(ue).length){const dr=new AbortController;this.inFlightDependencies.push(dr),Zt=wt.sendAsync({type:"GG",data:{stacks:ue,source:this.source,tileID:this.tileID,type:"glyphs"}},dr)}const be=Object.keys(Lt.iconDependencies);let We=Promise.resolve({});if(be.length){const dr=new AbortController;this.inFlightDependencies.push(dr),We=wt.sendAsync({type:"GI",data:{icons:be,source:this.source,tileID:this.tileID,type:"icons"}},dr)}const Ke=Object.keys(Lt.patternDependencies);let Br=Promise.resolve({});if(Ke.length){const dr=new AbortController;this.inFlightDependencies.push(dr),Br=wt.sendAsync({type:"GI",data:{icons:Ke,source:this.source,tileID:this.tileID,type:"patterns"}},dr)}const[tr,Ir,Sr]=yield Promise.all([Zt,We,Br]),oi=new p(tr),Wr=new c.bo(Ir,Sr);for(const dr in Ft){const Nr=Ft[dr];Nr instanceof c.a6?(w(Nr.layers,this.zoom,ut),c.bp({bucket:Nr,glyphMap:tr,glyphPositions:oi.positions,imageMap:Ir,imagePositions:Wr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Nr.hasPattern&&(Nr instanceof c.bq||Nr instanceof c.br||Nr instanceof c.bs)&&(w(Nr.layers,this.zoom,ut),Nr.addFeatures(Lt,this.tileID.canonical,Wr.patternPositions))}return this.status="done",{buckets:Object.values(Ft).filter(dr=>!dr.isEmpty()),featureIndex:Vt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:oi.image,imageAtlas:Wr,glyphMap:this.returnDependencies?tr:null,iconMap:this.returnDependencies?Ir:null,glyphPositions:this.returnDependencies?oi.positions:null}})}}function w(At,J,Q){const ut=new c.z(J);for(const wt of At)wt.recalculate(ut,Q)}class S{constructor(J,Q,ut){this.actor=J,this.layerIndex=Q,this.availableImages=ut,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(J,Q){return c._(this,void 0,void 0,function*(){const ut=yield c.l(J.request,Q);try{return{vectorTile:new c.bt.VectorTile(new c.bu(ut.data)),rawData:ut.data,cacheControl:ut.cacheControl,expires:ut.expires}}catch(wt){const Nt=new Uint8Array(ut.data);let Vt=`Unable to parse the tile at ${J.request.url}, `;throw Vt+=Nt[0]===31&&Nt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${wt.message}`,new Error(Vt)}})}loadTile(J){return c._(this,void 0,void 0,function*(){const Q=J.uid,ut=!!(J&&J.request&&J.request.collectResourceTiming)&&new c.bv(J.request),wt=new _(J);this.loading[Q]=wt;const Nt=new AbortController;wt.abort=Nt;try{const Vt=yield this.loadVectorTile(J,Nt);if(delete this.loading[Q],!Vt)return null;const Ft=Vt.rawData,Lt={};Vt.expires&&(Lt.expires=Vt.expires),Vt.cacheControl&&(Lt.cacheControl=Vt.cacheControl);const ne={};if(ut){const Zt=ut.finish();Zt&&(ne.resourceTiming=JSON.parse(JSON.stringify(Zt)))}wt.vectorTile=Vt.vectorTile;const ue=wt.parse(Vt.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[Q]=wt,this.fetching[Q]={rawTileData:Ft,cacheControl:Lt,resourceTiming:ne};try{const Zt=yield ue;return c.e({rawTileData:Ft.slice(0)},Zt,Lt,ne)}finally{delete this.fetching[Q]}}catch(Vt){throw delete this.loading[Q],wt.status="done",this.loaded[Q]=wt,Vt}})}reloadTile(J){return c._(this,void 0,void 0,function*(){const Q=J.uid;if(!this.loaded||!this.loaded[Q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ut=this.loaded[Q];if(ut.showCollisionBoxes=J.showCollisionBoxes,ut.status==="parsing"){const wt=yield ut.parse(ut.vectorTile,this.layerIndex,this.availableImages,this.actor);let Nt;if(this.fetching[Q]){const{rawTileData:Vt,cacheControl:Ft,resourceTiming:Lt}=this.fetching[Q];delete this.fetching[Q],Nt=c.e({rawTileData:Vt.slice(0)},wt,Ft,Lt)}else Nt=wt;return Nt}if(ut.status==="done"&&ut.vectorTile)return ut.parse(ut.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(J){return c._(this,void 0,void 0,function*(){const Q=this.loading,ut=J.uid;Q&&Q[ut]&&Q[ut].abort&&(Q[ut].abort.abort(),delete Q[ut])})}removeTile(J){return c._(this,void 0,void 0,function*(){this.loaded&&this.loaded[J.uid]&&delete this.loaded[J.uid]})}}class C{constructor(){this.loaded={}}loadTile(J){return c._(this,void 0,void 0,function*(){const{uid:Q,encoding:ut,rawImageData:wt,redFactor:Nt,greenFactor:Vt,blueFactor:Ft,baseShift:Lt}=J,ne=wt.width+2,ue=wt.height+2,Zt=c.b(wt)?new c.R({width:ne,height:ue},yield c.bw(wt,-1,-1,ne,ue)):wt,be=new c.bx(Q,Zt,ut,Nt,Vt,Ft,Lt);return this.loaded=this.loaded||{},this.loaded[Q]=be,be})}removeTile(J){const Q=this.loaded,ut=J.uid;Q&&Q[ut]&&delete Q[ut]}}function I(At,J){if(At.length!==0){N(At[0],J);for(var Q=1;Q<At.length;Q++)N(At[Q],!J)}}function N(At,J){for(var Q=0,ut=0,wt=0,Nt=At.length,Vt=Nt-1;wt<Nt;Vt=wt++){var Ft=(At[wt][0]-At[Vt][0])*(At[Vt][1]+At[wt][1]),Lt=Q+Ft;ut+=Math.abs(Q)>=Math.abs(Ft)?Q-Lt+Ft:Ft-Lt+Q,Q=Lt}Q+ut>=0!=!!J&&At.reverse()}var F=c.by(function At(J,Q){var ut,wt=J&&J.type;if(wt==="FeatureCollection")for(ut=0;ut<J.features.length;ut++)At(J.features[ut],Q);else if(wt==="GeometryCollection")for(ut=0;ut<J.geometries.length;ut++)At(J.geometries[ut],Q);else if(wt==="Feature")At(J.geometry,Q);else if(wt==="Polygon")I(J.coordinates,Q);else if(wt==="MultiPolygon")for(ut=0;ut<J.coordinates.length;ut++)I(J.coordinates[ut],Q);return J});const W=c.bt.VectorTileFeature.prototype.toGeoJSON;var U={exports:{}},z=c.bz,H=c.bt.VectorTileFeature,nt=yt;function yt(At,J){this.options=J||{},this.features=At,this.length=At.length}function bt(At,J){this.id=typeof At.id=="number"?At.id:void 0,this.type=At.type,this.rawGeometry=At.type===1?[At.geometry]:At.geometry,this.properties=At.tags,this.extent=J||4096}yt.prototype.feature=function(At){return new bt(this.features[At],this.options.extent)},bt.prototype.loadGeometry=function(){var At=this.rawGeometry;this.geometry=[];for(var J=0;J<At.length;J++){for(var Q=At[J],ut=[],wt=0;wt<Q.length;wt++)ut.push(new z(Q[wt][0],Q[wt][1]));this.geometry.push(ut)}return this.geometry},bt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var At=this.geometry,J=1/0,Q=-1/0,ut=1/0,wt=-1/0,Nt=0;Nt<At.length;Nt++)for(var Vt=At[Nt],Ft=0;Ft<Vt.length;Ft++){var Lt=Vt[Ft];J=Math.min(J,Lt.x),Q=Math.max(Q,Lt.x),ut=Math.min(ut,Lt.y),wt=Math.max(wt,Lt.y)}return[J,ut,Q,wt]},bt.prototype.toGeoJSON=H.prototype.toGeoJSON;var vt=c.bA,mt=nt;function Dt(At){var J=new vt;return function(Q,ut){for(var wt in Q.layers)ut.writeMessage(3,kt,Q.layers[wt])}(At,J),J.finish()}function kt(At,J){var Q;J.writeVarintField(15,At.version||1),J.writeStringField(1,At.name||""),J.writeVarintField(5,At.extent||4096);var ut={keys:[],values:[],keycache:{},valuecache:{}};for(Q=0;Q<At.length;Q++)ut.feature=At.feature(Q),J.writeMessage(2,at,ut);var wt=ut.keys;for(Q=0;Q<wt.length;Q++)J.writeStringField(3,wt[Q]);var Nt=ut.values;for(Q=0;Q<Nt.length;Q++)J.writeMessage(4,ee,Nt[Q])}function at(At,J){var Q=At.feature;Q.id!==void 0&&J.writeVarintField(1,Q.id),J.writeMessage(2,dt,At),J.writeVarintField(3,Q.type),J.writeMessage(4,re,Q)}function dt(At,J){var Q=At.feature,ut=At.keys,wt=At.values,Nt=At.keycache,Vt=At.valuecache;for(var Ft in Q.properties){var Lt=Q.properties[Ft],ne=Nt[Ft];if(Lt!==null){ne===void 0&&(ut.push(Ft),Nt[Ft]=ne=ut.length-1),J.writeVarint(ne);var ue=typeof Lt;ue!=="string"&&ue!=="boolean"&&ue!=="number"&&(Lt=JSON.stringify(Lt));var Zt=ue+":"+Lt,be=Vt[Zt];be===void 0&&(wt.push(Lt),Vt[Zt]=be=wt.length-1),J.writeVarint(be)}}}function It(At,J){return(J<<3)+(7&At)}function xt(At){return At<<1^At>>31}function re(At,J){for(var Q=At.loadGeometry(),ut=At.type,wt=0,Nt=0,Vt=Q.length,Ft=0;Ft<Vt;Ft++){var Lt=Q[Ft],ne=1;ut===1&&(ne=Lt.length),J.writeVarint(It(1,ne));for(var ue=ut===3?Lt.length-1:Lt.length,Zt=0;Zt<ue;Zt++){Zt===1&&ut!==1&&J.writeVarint(It(2,ue-1));var be=Lt[Zt].x-wt,We=Lt[Zt].y-Nt;J.writeVarint(xt(be)),J.writeVarint(xt(We)),wt+=be,Nt+=We}ut===3&&J.writeVarint(It(7,1))}}function ee(At,J){var Q=typeof At;Q==="string"?J.writeStringField(1,At):Q==="boolean"?J.writeBooleanField(7,At):Q==="number"&&(At%1!=0?J.writeDoubleField(3,At):At<0?J.writeSVarintField(6,At):J.writeVarintField(5,At))}U.exports=Dt,U.exports.fromVectorTileJs=Dt,U.exports.fromGeojsonVt=function(At,J){J=J||{};var Q={};for(var ut in At)Q[ut]=new mt(At[ut].features,J),Q[ut].name=ut,Q[ut].version=J.version,Q[ut].extent=J.extent;return Dt({layers:Q})},U.exports.GeoJSONWrapper=mt;var se=c.by(U.exports);const Ot={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:At=>At},Xt=Math.fround||(Wt=new Float32Array(1),At=>(Wt[0]=+At,Wt[0]));var Wt;const xe=3,it=5,Et=6;class Pt{constructor(J){this.options=Object.assign(Object.create(Ot),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){const{log:Q,minZoom:ut,maxZoom:wt}=this.options;Q&&console.time("total time");const Nt=`prepare ${J.length} points`;Q&&console.time(Nt),this.points=J;const Vt=[];for(let Lt=0;Lt<J.length;Lt++){const ne=J[Lt];if(!ne.geometry)continue;const[ue,Zt]=ne.geometry.coordinates,be=Xt($t(ue)),We=Xt(Qt(Zt));Vt.push(be,We,1/0,Lt,-1,1),this.options.reduce&&Vt.push(0)}let Ft=this.trees[wt+1]=this._createTree(Vt);Q&&console.timeEnd(Nt);for(let Lt=wt;Lt>=ut;Lt--){const ne=+Date.now();Ft=this.trees[Lt]=this._createTree(this._cluster(Ft,Lt)),Q&&console.log("z%d: %d clusters in %dms",Lt,Ft.numItems,+Date.now()-ne)}return Q&&console.timeEnd("total time"),this}getClusters(J,Q){let ut=((J[0]+180)%360+360)%360-180;const wt=Math.max(-90,Math.min(90,J[1]));let Nt=J[2]===180?180:((J[2]+180)%360+360)%360-180;const Vt=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)ut=-180,Nt=180;else if(ut>Nt){const Zt=this.getClusters([ut,wt,180,Vt],Q),be=this.getClusters([-180,wt,Nt,Vt],Q);return Zt.concat(be)}const Ft=this.trees[this._limitZoom(Q)],Lt=Ft.range($t(ut),Qt(Vt),$t(Nt),Qt(wt)),ne=Ft.data,ue=[];for(const Zt of Lt){const be=this.stride*Zt;ue.push(ne[be+it]>1?jt(ne,be,this.clusterProps):this.points[ne[be+xe]])}return ue}getChildren(J){const Q=this._getOriginId(J),ut=this._getOriginZoom(J),wt="No cluster with the specified id.",Nt=this.trees[ut];if(!Nt)throw new Error(wt);const Vt=Nt.data;if(Q*this.stride>=Vt.length)throw new Error(wt);const Ft=this.options.radius/(this.options.extent*Math.pow(2,ut-1)),Lt=Nt.within(Vt[Q*this.stride],Vt[Q*this.stride+1],Ft),ne=[];for(const ue of Lt){const Zt=ue*this.stride;Vt[Zt+4]===J&&ne.push(Vt[Zt+it]>1?jt(Vt,Zt,this.clusterProps):this.points[Vt[Zt+xe]])}if(ne.length===0)throw new Error(wt);return ne}getLeaves(J,Q,ut){const wt=[];return this._appendLeaves(wt,J,Q=Q||10,ut=ut||0,0),wt}getTile(J,Q,ut){const wt=this.trees[this._limitZoom(J)],Nt=Math.pow(2,J),{extent:Vt,radius:Ft}=this.options,Lt=Ft/Vt,ne=(ut-Lt)/Nt,ue=(ut+1+Lt)/Nt,Zt={features:[]};return this._addTileFeatures(wt.range((Q-Lt)/Nt,ne,(Q+1+Lt)/Nt,ue),wt.data,Q,ut,Nt,Zt),Q===0&&this._addTileFeatures(wt.range(1-Lt/Nt,ne,1,ue),wt.data,Nt,ut,Nt,Zt),Q===Nt-1&&this._addTileFeatures(wt.range(0,ne,Lt/Nt,ue),wt.data,-1,ut,Nt,Zt),Zt.features.length?Zt:null}getClusterExpansionZoom(J){let Q=this._getOriginZoom(J)-1;for(;Q<=this.options.maxZoom;){const ut=this.getChildren(J);if(Q++,ut.length!==1)break;J=ut[0].properties.cluster_id}return Q}_appendLeaves(J,Q,ut,wt,Nt){const Vt=this.getChildren(Q);for(const Ft of Vt){const Lt=Ft.properties;if(Lt&&Lt.cluster?Nt+Lt.point_count<=wt?Nt+=Lt.point_count:Nt=this._appendLeaves(J,Lt.cluster_id,ut,wt,Nt):Nt<wt?Nt++:J.push(Ft),J.length===ut)break}return Nt}_createTree(J){const Q=new c.av(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ut=0;ut<J.length;ut+=this.stride)Q.add(J[ut],J[ut+1]);return Q.finish(),Q.data=J,Q}_addTileFeatures(J,Q,ut,wt,Nt,Vt){for(const Ft of J){const Lt=Ft*this.stride,ne=Q[Lt+it]>1;let ue,Zt,be;if(ne)ue=qt(Q,Lt,this.clusterProps),Zt=Q[Lt],be=Q[Lt+1];else{const Br=this.points[Q[Lt+xe]];ue=Br.properties;const[tr,Ir]=Br.geometry.coordinates;Zt=$t(tr),be=Qt(Ir)}const We={type:1,geometry:[[Math.round(this.options.extent*(Zt*Nt-ut)),Math.round(this.options.extent*(be*Nt-wt))]],tags:ue};let Ke;Ke=ne||this.options.generateId?Q[Lt+xe]:this.points[Q[Lt+xe]].id,Ke!==void 0&&(We.id=Ke),Vt.features.push(We)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,Q){const{radius:ut,extent:wt,reduce:Nt,minPoints:Vt}=this.options,Ft=ut/(wt*Math.pow(2,Q)),Lt=J.data,ne=[],ue=this.stride;for(let Zt=0;Zt<Lt.length;Zt+=ue){if(Lt[Zt+2]<=Q)continue;Lt[Zt+2]=Q;const be=Lt[Zt],We=Lt[Zt+1],Ke=J.within(Lt[Zt],Lt[Zt+1],Ft),Br=Lt[Zt+it];let tr=Br;for(const Ir of Ke){const Sr=Ir*ue;Lt[Sr+2]>Q&&(tr+=Lt[Sr+it])}if(tr>Br&&tr>=Vt){let Ir,Sr=be*Br,oi=We*Br,Wr=-1;const dr=((Zt/ue|0)<<5)+(Q+1)+this.points.length;for(const Nr of Ke){const ei=Nr*ue;if(Lt[ei+2]<=Q)continue;Lt[ei+2]=Q;const yi=Lt[ei+it];Sr+=Lt[ei]*yi,oi+=Lt[ei+1]*yi,Lt[ei+4]=dr,Nt&&(Ir||(Ir=this._map(Lt,Zt,!0),Wr=this.clusterProps.length,this.clusterProps.push(Ir)),Nt(Ir,this._map(Lt,ei)))}Lt[Zt+4]=dr,ne.push(Sr/tr,oi/tr,1/0,dr,-1,tr),Nt&&ne.push(Wr)}else{for(let Ir=0;Ir<ue;Ir++)ne.push(Lt[Zt+Ir]);if(tr>1)for(const Ir of Ke){const Sr=Ir*ue;if(!(Lt[Sr+2]<=Q)){Lt[Sr+2]=Q;for(let oi=0;oi<ue;oi++)ne.push(Lt[Sr+oi])}}}}return ne}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,Q,ut){if(J[Q+it]>1){const Vt=this.clusterProps[J[Q+Et]];return ut?Object.assign({},Vt):Vt}const wt=this.points[J[Q+xe]].properties,Nt=this.options.map(wt);return ut&&Nt===wt?Object.assign({},Nt):Nt}}function jt(At,J,Q){return{type:"Feature",id:At[J+xe],properties:qt(At,J,Q),geometry:{type:"Point",coordinates:[(ut=At[J],360*(ut-.5)),Kt(At[J+1])]}};var ut}function qt(At,J,Q){const ut=At[J+it],wt=ut>=1e4?`${Math.round(ut/1e3)}k`:ut>=1e3?Math.round(ut/100)/10+"k":ut,Nt=At[J+Et],Vt=Nt===-1?{}:Object.assign({},Q[Nt]);return Object.assign(Vt,{cluster:!0,cluster_id:At[J+xe],point_count:ut,point_count_abbreviated:wt})}function $t(At){return At/360+.5}function Qt(At){const J=Math.sin(At*Math.PI/180),Q=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return Q<0?0:Q>1?1:Q}function Kt(At){const J=(180-360*At)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function Ee(At,J,Q,ut){let wt=ut;const Nt=J+(Q-J>>1);let Vt,Ft=Q-J;const Lt=At[J],ne=At[J+1],ue=At[Q],Zt=At[Q+1];for(let be=J+3;be<Q;be+=3){const We=Me(At[be],At[be+1],Lt,ne,ue,Zt);if(We>wt)Vt=be,wt=We;else if(We===wt){const Ke=Math.abs(be-Nt);Ke<Ft&&(Vt=be,Ft=Ke)}}wt>ut&&(Vt-J>3&&Ee(At,J,Vt,ut),At[Vt+2]=wt,Q-Vt>3&&Ee(At,Vt,Q,ut))}function Me(At,J,Q,ut,wt,Nt){let Vt=wt-Q,Ft=Nt-ut;if(Vt!==0||Ft!==0){const Lt=((At-Q)*Vt+(J-ut)*Ft)/(Vt*Vt+Ft*Ft);Lt>1?(Q=wt,ut=Nt):Lt>0&&(Q+=Vt*Lt,ut+=Ft*Lt)}return Vt=At-Q,Ft=J-ut,Vt*Vt+Ft*Ft}function De(At,J,Q,ut){const wt={id:At??null,type:J,geometry:Q,tags:ut,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(J==="Point"||J==="MultiPoint"||J==="LineString")ze(wt,Q);else if(J==="Polygon")ze(wt,Q[0]);else if(J==="MultiLineString")for(const Nt of Q)ze(wt,Nt);else if(J==="MultiPolygon")for(const Nt of Q)ze(wt,Nt[0]);return wt}function ze(At,J){for(let Q=0;Q<J.length;Q+=3)At.minX=Math.min(At.minX,J[Q]),At.minY=Math.min(At.minY,J[Q+1]),At.maxX=Math.max(At.maxX,J[Q]),At.maxY=Math.max(At.maxY,J[Q+1])}function or(At,J,Q,ut){if(!J.geometry)return;const wt=J.geometry.coordinates;if(wt&&wt.length===0)return;const Nt=J.geometry.type,Vt=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2);let Ft=[],Lt=J.id;if(Q.promoteId?Lt=J.properties[Q.promoteId]:Q.generateId&&(Lt=ut||0),Nt==="Point")le(wt,Ft);else if(Nt==="MultiPoint")for(const ne of wt)le(ne,Ft);else if(Nt==="LineString")st(wt,Ft,Vt,!1);else if(Nt==="MultiLineString"){if(Q.lineMetrics){for(const ne of wt)Ft=[],st(ne,Ft,Vt,!1),At.push(De(Lt,"LineString",Ft,J.properties));return}mr(wt,Ft,Vt,!1)}else if(Nt==="Polygon")mr(wt,Ft,Vt,!0);else{if(Nt!=="MultiPolygon"){if(Nt==="GeometryCollection"){for(const ne of J.geometry.geometries)or(At,{id:Lt,geometry:ne,properties:J.properties},Q,ut);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ne of wt){const ue=[];mr(ne,ue,Vt,!0),Ft.push(ue)}}At.push(De(Lt,Nt,Ft,J.properties))}function le(At,J){J.push(Qe(At[0]),de(At[1]),0)}function st(At,J,Q,ut){let wt,Nt,Vt=0;for(let Lt=0;Lt<At.length;Lt++){const ne=Qe(At[Lt][0]),ue=de(At[Lt][1]);J.push(ne,ue,0),Lt>0&&(Vt+=ut?(wt*ue-ne*Nt)/2:Math.sqrt(Math.pow(ne-wt,2)+Math.pow(ue-Nt,2))),wt=ne,Nt=ue}const Ft=J.length-3;J[2]=1,Ee(J,0,Ft,Q),J[Ft+2]=1,J.size=Math.abs(Vt),J.start=0,J.end=J.size}function mr(At,J,Q,ut){for(let wt=0;wt<At.length;wt++){const Nt=[];st(At[wt],Nt,Q,ut),J.push(Nt)}}function Qe(At){return At/360+.5}function de(At){const J=Math.sin(At*Math.PI/180),Q=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return Q<0?0:Q>1?1:Q}function Te(At,J,Q,ut,wt,Nt,Vt,Ft){if(ut/=J,Nt>=(Q/=J)&&Vt<ut)return At;if(Vt<Q||Nt>=ut)return null;const Lt=[];for(const ne of At){const ue=ne.geometry;let Zt=ne.type;const be=wt===0?ne.minX:ne.minY,We=wt===0?ne.maxX:ne.maxY;if(be>=Q&&We<ut){Lt.push(ne);continue}if(We<Q||be>=ut)continue;let Ke=[];if(Zt==="Point"||Zt==="MultiPoint")Be(ue,Ke,Q,ut,wt);else if(Zt==="LineString")Ne(ue,Ke,Q,ut,wt,!1,Ft.lineMetrics);else if(Zt==="MultiLineString")Er(ue,Ke,Q,ut,wt,!1);else if(Zt==="Polygon")Er(ue,Ke,Q,ut,wt,!0);else if(Zt==="MultiPolygon")for(const Br of ue){const tr=[];Er(Br,tr,Q,ut,wt,!0),tr.length&&Ke.push(tr)}if(Ke.length){if(Ft.lineMetrics&&Zt==="LineString"){for(const Br of Ke)Lt.push(De(ne.id,Zt,Br,ne.tags));continue}Zt!=="LineString"&&Zt!=="MultiLineString"||(Ke.length===1?(Zt="LineString",Ke=Ke[0]):Zt="MultiLineString"),Zt!=="Point"&&Zt!=="MultiPoint"||(Zt=Ke.length===3?"Point":"MultiPoint"),Lt.push(De(ne.id,Zt,Ke,ne.tags))}}return Lt.length?Lt:null}function Be(At,J,Q,ut,wt){for(let Nt=0;Nt<At.length;Nt+=3){const Vt=At[Nt+wt];Vt>=Q&&Vt<=ut&&wr(J,At[Nt],At[Nt+1],At[Nt+2])}}function Ne(At,J,Q,ut,wt,Nt,Vt){let Ft=rr(At);const Lt=wt===0?Fr:Ur;let ne,ue,Zt=At.start;for(let tr=0;tr<At.length-3;tr+=3){const Ir=At[tr],Sr=At[tr+1],oi=At[tr+2],Wr=At[tr+3],dr=At[tr+4],Nr=wt===0?Ir:Sr,ei=wt===0?Wr:dr;let yi=!1;Vt&&(ne=Math.sqrt(Math.pow(Ir-Wr,2)+Math.pow(Sr-dr,2))),Nr<Q?ei>Q&&(ue=Lt(Ft,Ir,Sr,Wr,dr,Q),Vt&&(Ft.start=Zt+ne*ue)):Nr>ut?ei<ut&&(ue=Lt(Ft,Ir,Sr,Wr,dr,ut),Vt&&(Ft.start=Zt+ne*ue)):wr(Ft,Ir,Sr,oi),ei<Q&&Nr>=Q&&(ue=Lt(Ft,Ir,Sr,Wr,dr,Q),yi=!0),ei>ut&&Nr<=ut&&(ue=Lt(Ft,Ir,Sr,Wr,dr,ut),yi=!0),!Nt&&yi&&(Vt&&(Ft.end=Zt+ne*ue),J.push(Ft),Ft=rr(At)),Vt&&(Zt+=ne)}let be=At.length-3;const We=At[be],Ke=At[be+1],Br=wt===0?We:Ke;Br>=Q&&Br<=ut&&wr(Ft,We,Ke,At[be+2]),be=Ft.length-3,Nt&&be>=3&&(Ft[be]!==Ft[0]||Ft[be+1]!==Ft[1])&&wr(Ft,Ft[0],Ft[1],Ft[2]),Ft.length&&J.push(Ft)}function rr(At){const J=[];return J.size=At.size,J.start=At.start,J.end=At.end,J}function Er(At,J,Q,ut,wt,Nt){for(const Vt of At)Ne(Vt,J,Q,ut,wt,Nt,!1)}function wr(At,J,Q,ut){At.push(J,Q,ut)}function Fr(At,J,Q,ut,wt,Nt){const Vt=(Nt-J)/(ut-J);return wr(At,Nt,Q+(wt-Q)*Vt,1),Vt}function Ur(At,J,Q,ut,wt,Nt){const Vt=(Nt-Q)/(wt-Q);return wr(At,J+(ut-J)*Vt,Nt,1),Vt}function me(At,J){const Q=[];for(let ut=0;ut<At.length;ut++){const wt=At[ut],Nt=wt.type;let Vt;if(Nt==="Point"||Nt==="MultiPoint"||Nt==="LineString")Vt=hr(wt.geometry,J);else if(Nt==="MultiLineString"||Nt==="Polygon"){Vt=[];for(const Ft of wt.geometry)Vt.push(hr(Ft,J))}else if(Nt==="MultiPolygon"){Vt=[];for(const Ft of wt.geometry){const Lt=[];for(const ne of Ft)Lt.push(hr(ne,J));Vt.push(Lt)}}Q.push(De(wt.id,Nt,Vt,wt.tags))}return Q}function hr(At,J){const Q=[];Q.size=At.size,At.start!==void 0&&(Q.start=At.start,Q.end=At.end);for(let ut=0;ut<At.length;ut+=3)Q.push(At[ut]+J,At[ut+1],At[ut+2]);return Q}function xr(At,J){if(At.transformed)return At;const Q=1<<At.z,ut=At.x,wt=At.y;for(const Nt of At.features){const Vt=Nt.geometry,Ft=Nt.type;if(Nt.geometry=[],Ft===1)for(let Lt=0;Lt<Vt.length;Lt+=2)Nt.geometry.push(Fe(Vt[Lt],Vt[Lt+1],J,Q,ut,wt));else for(let Lt=0;Lt<Vt.length;Lt++){const ne=[];for(let ue=0;ue<Vt[Lt].length;ue+=2)ne.push(Fe(Vt[Lt][ue],Vt[Lt][ue+1],J,Q,ut,wt));Nt.geometry.push(ne)}}return At.transformed=!0,At}function Fe(At,J,Q,ut,wt,Nt){return[Math.round(Q*(At*ut-wt)),Math.round(Q*(J*ut-Nt))]}function wi(At,J,Q,ut,wt){const Nt=J===wt.maxZoom?0:wt.tolerance/((1<<J)*wt.extent),Vt={features:[],numPoints:0,numSimplified:0,numFeatures:At.length,source:null,x:Q,y:ut,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ft of At)ge(Vt,Ft,Nt,wt);return Vt}function ge(At,J,Q,ut){const wt=J.geometry,Nt=J.type,Vt=[];if(At.minX=Math.min(At.minX,J.minX),At.minY=Math.min(At.minY,J.minY),At.maxX=Math.max(At.maxX,J.maxX),At.maxY=Math.max(At.maxY,J.maxY),Nt==="Point"||Nt==="MultiPoint")for(let Ft=0;Ft<wt.length;Ft+=3)Vt.push(wt[Ft],wt[Ft+1]),At.numPoints++,At.numSimplified++;else if(Nt==="LineString")br(Vt,wt,At,Q,!1,!1);else if(Nt==="MultiLineString"||Nt==="Polygon")for(let Ft=0;Ft<wt.length;Ft++)br(Vt,wt[Ft],At,Q,Nt==="Polygon",Ft===0);else if(Nt==="MultiPolygon")for(let Ft=0;Ft<wt.length;Ft++){const Lt=wt[Ft];for(let ne=0;ne<Lt.length;ne++)br(Vt,Lt[ne],At,Q,!0,ne===0)}if(Vt.length){let Ft=J.tags||null;if(Nt==="LineString"&&ut.lineMetrics){Ft={};for(const ne in J.tags)Ft[ne]=J.tags[ne];Ft.mapbox_clip_start=wt.start/wt.size,Ft.mapbox_clip_end=wt.end/wt.size}const Lt={geometry:Vt,type:Nt==="Polygon"||Nt==="MultiPolygon"?3:Nt==="LineString"||Nt==="MultiLineString"?2:1,tags:Ft};J.id!==null&&(Lt.id=J.id),At.features.push(Lt)}}function br(At,J,Q,ut,wt,Nt){const Vt=ut*ut;if(ut>0&&J.size<(wt?Vt:ut))return void(Q.numPoints+=J.length/3);const Ft=[];for(let Lt=0;Lt<J.length;Lt+=3)(ut===0||J[Lt+2]>Vt)&&(Q.numSimplified++,Ft.push(J[Lt],J[Lt+1])),Q.numPoints++;wt&&function(Lt,ne){let ue=0;for(let Zt=0,be=Lt.length,We=be-2;Zt<be;We=Zt,Zt+=2)ue+=(Lt[Zt]-Lt[We])*(Lt[Zt+1]+Lt[We+1]);if(ue>0===ne)for(let Zt=0,be=Lt.length;Zt<be/2;Zt+=2){const We=Lt[Zt],Ke=Lt[Zt+1];Lt[Zt]=Lt[be-2-Zt],Lt[Zt+1]=Lt[be-1-Zt],Lt[be-2-Zt]=We,Lt[be-1-Zt]=Ke}}(Ft,Nt),At.push(Ft)}const Ge={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Hr{constructor(J,Q){const ut=(Q=this.options=function(Nt,Vt){for(const Ft in Vt)Nt[Ft]=Vt[Ft];return Nt}(Object.create(Ge),Q)).debug;if(ut&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");let wt=function(Nt,Vt){const Ft=[];if(Nt.type==="FeatureCollection")for(let Lt=0;Lt<Nt.features.length;Lt++)or(Ft,Nt.features[Lt],Vt,Lt);else or(Ft,Nt.type==="Feature"?Nt:{geometry:Nt},Vt);return Ft}(J,Q);this.tiles={},this.tileCoords=[],ut&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),wt=function(Nt,Vt){const Ft=Vt.buffer/Vt.extent;let Lt=Nt;const ne=Te(Nt,1,-1-Ft,Ft,0,-1,2,Vt),ue=Te(Nt,1,1-Ft,2+Ft,0,-1,2,Vt);return(ne||ue)&&(Lt=Te(Nt,1,-Ft,1+Ft,0,-1,2,Vt)||[],ne&&(Lt=me(ne,1).concat(Lt)),ue&&(Lt=Lt.concat(me(ue,-1)))),Lt}(wt,Q),wt.length&&this.splitTile(wt,0,0,0),ut&&(wt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,Q,ut,wt,Nt,Vt,Ft){const Lt=[J,Q,ut,wt],ne=this.options,ue=ne.debug;for(;Lt.length;){wt=Lt.pop(),ut=Lt.pop(),Q=Lt.pop(),J=Lt.pop();const Zt=1<<Q,be=Qi(Q,ut,wt);let We=this.tiles[be];if(!We&&(ue>1&&console.time("creation"),We=this.tiles[be]=wi(J,Q,ut,wt,ne),this.tileCoords.push({z:Q,x:ut,y:wt}),ue)){ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,ut,wt,We.numFeatures,We.numPoints,We.numSimplified),console.timeEnd("creation"));const yi=`z${Q}`;this.stats[yi]=(this.stats[yi]||0)+1,this.total++}if(We.source=J,Nt==null){if(Q===ne.indexMaxZoom||We.numPoints<=ne.indexMaxPoints)continue}else{if(Q===ne.maxZoom||Q===Nt)continue;if(Nt!=null){const yi=Nt-Q;if(ut!==Vt>>yi||wt!==Ft>>yi)continue}}if(We.source=null,J.length===0)continue;ue>1&&console.time("clipping");const Ke=.5*ne.buffer/ne.extent,Br=.5-Ke,tr=.5+Ke,Ir=1+Ke;let Sr=null,oi=null,Wr=null,dr=null,Nr=Te(J,Zt,ut-Ke,ut+tr,0,We.minX,We.maxX,ne),ei=Te(J,Zt,ut+Br,ut+Ir,0,We.minX,We.maxX,ne);J=null,Nr&&(Sr=Te(Nr,Zt,wt-Ke,wt+tr,1,We.minY,We.maxY,ne),oi=Te(Nr,Zt,wt+Br,wt+Ir,1,We.minY,We.maxY,ne),Nr=null),ei&&(Wr=Te(ei,Zt,wt-Ke,wt+tr,1,We.minY,We.maxY,ne),dr=Te(ei,Zt,wt+Br,wt+Ir,1,We.minY,We.maxY,ne),ei=null),ue>1&&console.timeEnd("clipping"),Lt.push(Sr||[],Q+1,2*ut,2*wt),Lt.push(oi||[],Q+1,2*ut,2*wt+1),Lt.push(Wr||[],Q+1,2*ut+1,2*wt),Lt.push(dr||[],Q+1,2*ut+1,2*wt+1)}}getTile(J,Q,ut){J=+J,Q=+Q,ut=+ut;const wt=this.options,{extent:Nt,debug:Vt}=wt;if(J<0||J>24)return null;const Ft=1<<J,Lt=Qi(J,Q=Q+Ft&Ft-1,ut);if(this.tiles[Lt])return xr(this.tiles[Lt],Nt);Vt>1&&console.log("drilling down to z%d-%d-%d",J,Q,ut);let ne,ue=J,Zt=Q,be=ut;for(;!ne&&ue>0;)ue--,Zt>>=1,be>>=1,ne=this.tiles[Qi(ue,Zt,be)];return ne&&ne.source?(Vt>1&&(console.log("found parent tile z%d-%d-%d",ue,Zt,be),console.time("drilling down")),this.splitTile(ne.source,ue,Zt,be,J,Q,ut),Vt>1&&console.timeEnd("drilling down"),this.tiles[Lt]?xr(this.tiles[Lt],Nt):null):null}}function Qi(At,J,Q){return 32*((1<<At)*Q+J)+At}function je(At,J){return J?At.properties[J]:At.id}function In(At,J){if(At==null)return!0;if(At.type==="Feature")return je(At,J)!=null;if(At.type==="FeatureCollection"){const Q=new Set;for(const ut of At.features){const wt=je(ut,J);if(wt==null||Q.has(wt))return!1;Q.add(wt)}return!0}return!1}function si(At,J){const Q=new Map;if(At!=null)if(At.type==="Feature")Q.set(je(At,J),At);else for(const ut of At.features)Q.set(je(ut,J),ut);return Q}class on extends S{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(J,Q){return c._(this,void 0,void 0,function*(){const ut=J.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const wt=this._geoJSONIndex.getTile(ut.z,ut.x,ut.y);if(!wt)return null;const Nt=new class{constructor(Ft){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.X,this.length=Ft.length,this._features=Ft}feature(Ft){return new class{constructor(Lt){this._feature=Lt,this.extent=c.X,this.type=Lt.type,this.properties=Lt.tags,"id"in Lt&&!isNaN(Lt.id)&&(this.id=parseInt(Lt.id,10))}loadGeometry(){if(this._feature.type===1){const Lt=[];for(const ne of this._feature.geometry)Lt.push([new c.P(ne[0],ne[1])]);return Lt}{const Lt=[];for(const ne of this._feature.geometry){const ue=[];for(const Zt of ne)ue.push(new c.P(Zt[0],Zt[1]));Lt.push(ue)}return Lt}}toGeoJSON(Lt,ne,ue){return W.call(this,Lt,ne,ue)}}(this._features[Ft])}}(wt.features);let Vt=se(Nt);return Vt.byteOffset===0&&Vt.byteLength===Vt.buffer.byteLength||(Vt=new Uint8Array(Vt)),{vectorTile:Nt,rawData:Vt.buffer}})}loadData(J){return c._(this,void 0,void 0,function*(){var Q;(Q=this._pendingRequest)===null||Q===void 0||Q.abort();const ut=!!(J&&J.request&&J.request.collectResourceTiming)&&new c.bv(J.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(J,this._pendingRequest),this._geoJSONIndex=J.cluster?new Pt(function(Vt){let{superclusterOptions:Ft,clusterProperties:Lt}=Vt;if(!Lt||!Ft)return Ft;const ne={},ue={},Zt={accumulated:null,zoom:0},be={properties:null},We=Object.keys(Lt);for(const Ke of We){const[Br,tr]=Lt[Ke],Ir=c.bC(tr),Sr=c.bC(typeof Br=="string"?[Br,["accumulated"],["get",Ke]]:Br);ne[Ke]=Ir.value,ue[Ke]=Sr.value}return Ft.map=Ke=>{be.properties=Ke;const Br={};for(const tr of We)Br[tr]=ne[tr].evaluate(Zt,be);return Br},Ft.reduce=(Ke,Br)=>{be.properties=Br;for(const tr of We)Zt.accumulated=Ke[tr],Ke[tr]=ue[tr].evaluate(Zt,be)},Ft}(J)).load((yield this._pendingData).features):(wt=yield this._pendingData,new Hr(wt,J.geojsonVtOptions)),this.loaded={};const Nt={};if(ut){const Vt=ut.finish();Vt&&(Nt.resourceTiming={},Nt.resourceTiming[J.source]=JSON.parse(JSON.stringify(Vt)))}return Nt}catch(Nt){if(delete this._pendingRequest,c.bB(Nt))return{abandoned:!0};throw Nt}var wt})}getData(){return c._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(J){const Q=this.loaded;return Q&&Q[J.uid]?super.reloadTile(J):this.loadTile(J)}loadAndProcessGeoJSON(J,Q){return c._(this,void 0,void 0,function*(){let ut=yield this.loadGeoJSON(J,Q);if(delete this._pendingRequest,typeof ut!="object")throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(F(ut,!0),J.filter){const wt=c.bC(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(wt.result==="error")throw new Error(wt.value.map(Nt=>`${Nt.key}: ${Nt.message}`).join(", "));ut={type:"FeatureCollection",features:ut.features.filter(Nt=>wt.value.evaluate({zoom:0},Nt))}}return ut})}loadGeoJSON(J,Q){return c._(this,void 0,void 0,function*(){const{promoteId:ut}=J;if(J.request){const wt=yield c.h(J.request,Q);return this._dataUpdateable=In(wt.data,ut)?si(wt.data,ut):void 0,wt.data}if(typeof J.data=="string")try{const wt=JSON.parse(J.data);return this._dataUpdateable=In(wt,ut)?si(wt,ut):void 0,wt}catch{throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`)}if(!J.dataDiff)throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${J.source}`);return function(wt,Nt,Vt){var Ft,Lt,ne,ue;if(Nt.removeAll&&wt.clear(),Nt.remove)for(const Zt of Nt.remove)wt.delete(Zt);if(Nt.add)for(const Zt of Nt.add){const be=je(Zt,Vt);be!=null&&wt.set(be,Zt)}if(Nt.update)for(const Zt of Nt.update){let be=wt.get(Zt.id);if(be==null)continue;const We=!Zt.removeAllProperties&&(((Ft=Zt.removeProperties)===null||Ft===void 0?void 0:Ft.length)>0||((Lt=Zt.addOrUpdateProperties)===null||Lt===void 0?void 0:Lt.length)>0);if((Zt.newGeometry||Zt.removeAllProperties||We)&&(be=Object.assign({},be),wt.set(Zt.id,be),We&&(be.properties=Object.assign({},be.properties))),Zt.newGeometry&&(be.geometry=Zt.newGeometry),Zt.removeAllProperties)be.properties={};else if(((ne=Zt.removeProperties)===null||ne===void 0?void 0:ne.length)>0)for(const Ke of Zt.removeProperties)Object.prototype.hasOwnProperty.call(be.properties,Ke)&&delete be.properties[Ke];if(((ue=Zt.addOrUpdateProperties)===null||ue===void 0?void 0:ue.length)>0)for(const{key:Ke,value:Br}of Zt.addOrUpdateProperties)be.properties[Ke]=Br}}(this._dataUpdateable,J.dataDiff,ut),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(J){return c._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(J){return this._geoJSONIndex.getClusterExpansionZoom(J.clusterId)}getClusterChildren(J){return this._geoJSONIndex.getChildren(J.clusterId)}getClusterLeaves(J){return this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset)}}class an{constructor(J){this.self=J,this.actor=new c.F(J),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Q,ut)=>{if(this.externalWorkerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.externalWorkerSourceTypes[Q]=ut},this.self.addProtocol=c.bi,this.self.removeProtocol=c.bj,this.self.registerRTLTextPlugin=Q=>{if(c.bD.isParsed())throw new Error("RTL text plugin already registered.");c.bD.setMethods(Q)},this.actor.registerMessageHandler("LDT",(Q,ut)=>this._getDEMWorkerSource(Q,ut.source).loadTile(ut)),this.actor.registerMessageHandler("RDT",(Q,ut)=>c._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Q,ut.source).removeTile(ut)})),this.actor.registerMessageHandler("GCEZ",(Q,ut)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,ut.type,ut.source).getClusterExpansionZoom(ut)})),this.actor.registerMessageHandler("GCC",(Q,ut)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,ut.type,ut.source).getClusterChildren(ut)})),this.actor.registerMessageHandler("GCL",(Q,ut)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,ut.type,ut.source).getClusterLeaves(ut)})),this.actor.registerMessageHandler("LD",(Q,ut)=>this._getWorkerSource(Q,ut.type,ut.source).loadData(ut)),this.actor.registerMessageHandler("GD",(Q,ut)=>this._getWorkerSource(Q,ut.type,ut.source).getData()),this.actor.registerMessageHandler("LT",(Q,ut)=>this._getWorkerSource(Q,ut.type,ut.source).loadTile(ut)),this.actor.registerMessageHandler("RT",(Q,ut)=>this._getWorkerSource(Q,ut.type,ut.source).reloadTile(ut)),this.actor.registerMessageHandler("AT",(Q,ut)=>this._getWorkerSource(Q,ut.type,ut.source).abortTile(ut)),this.actor.registerMessageHandler("RMT",(Q,ut)=>this._getWorkerSource(Q,ut.type,ut.source).removeTile(ut)),this.actor.registerMessageHandler("RS",(Q,ut)=>c._(this,void 0,void 0,function*(){if(!this.workerSources[Q]||!this.workerSources[Q][ut.type]||!this.workerSources[Q][ut.type][ut.source])return;const wt=this.workerSources[Q][ut.type][ut.source];delete this.workerSources[Q][ut.type][ut.source],wt.removeSource!==void 0&&wt.removeSource(ut)})),this.actor.registerMessageHandler("RM",Q=>c._(this,void 0,void 0,function*(){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.workerSources[Q],delete this.demWorkerSources[Q]})),this.actor.registerMessageHandler("SR",(Q,ut)=>c._(this,void 0,void 0,function*(){this.referrer=ut})),this.actor.registerMessageHandler("SRPS",(Q,ut)=>this._syncRTLPluginState(Q,ut)),this.actor.registerMessageHandler("IS",(Q,ut)=>c._(this,void 0,void 0,function*(){this.self.importScripts(ut)})),this.actor.registerMessageHandler("SI",(Q,ut)=>this._setImages(Q,ut)),this.actor.registerMessageHandler("UL",(Q,ut)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(Q).update(ut.layers,ut.removedIds)})),this.actor.registerMessageHandler("SL",(Q,ut)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(Q).replace(ut)}))}_setImages(J,Q){return c._(this,void 0,void 0,function*(){this.availableImages[J]=Q;for(const ut in this.workerSources[J]){const wt=this.workerSources[J][ut];for(const Nt in wt)wt[Nt].availableImages=Q}})}_syncRTLPluginState(J,Q){return c._(this,void 0,void 0,function*(){if(c.bD.isParsed())return c.bD.getState();if(Q.pluginStatus!=="loading")return c.bD.setState(Q),Q;const ut=Q.pluginURL;if(this.self.importScripts(ut),c.bD.isParsed()){const wt={pluginStatus:"loaded",pluginURL:ut};return c.bD.setState(wt),wt}throw c.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ut}`)})}_getAvailableImages(J){let Q=this.availableImages[J];return Q||(Q=[]),Q}_getLayerIndex(J){let Q=this.layerIndexes[J];return Q||(Q=this.layerIndexes[J]=new a),Q}_getWorkerSource(J,Q,ut){if(this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][Q]||(this.workerSources[J][Q]={}),!this.workerSources[J][Q][ut]){const wt={sendAsync:(Nt,Vt)=>(Nt.targetMapId=J,this.actor.sendAsync(Nt,Vt))};switch(Q){case"vector":this.workerSources[J][Q][ut]=new S(wt,this._getLayerIndex(J),this._getAvailableImages(J));break;case"geojson":this.workerSources[J][Q][ut]=new on(wt,this._getLayerIndex(J),this._getAvailableImages(J));break;default:this.workerSources[J][Q][ut]=new this.externalWorkerSourceTypes[Q](wt,this._getLayerIndex(J),this._getAvailableImages(J))}}return this.workerSources[J][Q][ut]}_getDEMWorkerSource(J,Q){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][Q]||(this.demWorkerSources[J][Q]=new C),this.demWorkerSources[J][Q]}}return c.i(self)&&(self.worker=new an(self)),an}),n("index",["exports","./shared"],function(c,a){var p="4.7.1";let _,w;const S={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:g=>new Promise((o,h)=>{const m=requestAnimationFrame(o);g.signal.addEventListener("abort",()=>{cancelAnimationFrame(m),h(a.c())})}),getImageData(g){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(g).getImageData(-o,-o,g.width+2*o,g.height+2*o)},getImageCanvasContext(g){const o=window.document.createElement("canvas"),h=o.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return o.width=g.width,o.height=g.height,h.drawImage(g,0,0,g.width,g.height),h},resolveURL:g=>(_||(_=document.createElement("a")),_.href=g,_.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(w==null&&(w=matchMedia("(prefers-reduced-motion: reduce)")),w.matches)}};class C{static testProp(o){if(!C.docStyle)return o[0];for(let h=0;h<o.length;h++)if(o[h]in C.docStyle)return o[h];return o[0]}static create(o,h,m){const y=window.document.createElement(o);return h!==void 0&&(y.className=h),m&&m.appendChild(y),y}static createNS(o,h){return window.document.createElementNS(o,h)}static disableDrag(){C.docStyle&&C.selectProp&&(C.userSelect=C.docStyle[C.selectProp],C.docStyle[C.selectProp]="none")}static enableDrag(){C.docStyle&&C.selectProp&&(C.docStyle[C.selectProp]=C.userSelect)}static setTransform(o,h){o.style[C.transformProp]=h}static addEventListener(o,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};o.addEventListener(h,m,"passive"in y?y:y.capture)}static removeEventListener(o,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};o.removeEventListener(h,m,"passive"in y?y:y.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",C.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",C.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",C.suppressClickInternal,!0)},0)}static getScale(o){const h=o.getBoundingClientRect();return{x:h.width/o.offsetWidth||1,y:h.height/o.offsetHeight||1,boundingClientRect:h}}static getPoint(o,h,m){const y=h.boundingClientRect;return new a.P((m.clientX-y.left)/h.x-o.clientLeft,(m.clientY-y.top)/h.y-o.clientTop)}static mousePos(o,h){const m=C.getScale(o);return C.getPoint(o,m,h)}static touchPos(o,h){const m=[],y=C.getScale(o);for(let v=0;v<h.length;v++)m.push(C.getPoint(o,y,h[v]));return m}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}C.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,C.selectProp=C.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),C.transformProp=C.testProp(["transform","WebkitTransform"]);const I={supported:!1,testSupport:function(g){!W&&F&&(U?z(g):N=g)}};let N,F,W=!1,U=!1;function z(g){const o=g.createTexture();g.bindTexture(g.TEXTURE_2D,o);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,F),g.isContextLost())return;I.supported=!0}catch{}g.deleteTexture(o),W=!0}var H;typeof document<"u"&&(F=document.createElement("img"),F.onload=()=>{N&&z(N),N=null,U=!0},F.onerror=()=>{W=!0,N=null},F.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let o,h,m,y;g.resetRequestQueue=()=>{o=[],h=0,m=0,y={}},g.addThrottleControl=B=>{const D=m++;return y[D]=B,D},g.removeThrottleControl=B=>{delete y[B],E()},g.getImage=function(B,D){let G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((j,Z)=>{I.supported&&(B.headers||(B.headers={}),B.headers.accept="image/webp,*/*"),a.e(B,{type:"image"}),o.push({abortController:D,requestParameters:B,supportImageRefresh:G,state:"queued",onError:Y=>{Z(Y)},onSuccess:Y=>{j(Y)}}),E()})};const v=B=>a._(this,void 0,void 0,function*(){B.state="running";const{requestParameters:D,supportImageRefresh:G,onError:j,onSuccess:Z,abortController:Y}=B,X=G===!1&&!a.i(self)&&!a.g(D.url)&&(!D.headers||Object.keys(D.headers).reduce((ht,gt)=>ht&&gt==="accept",!0));h++;const tt=X?P(D,Y):a.m(D,Y);try{const ht=yield tt;delete B.abortController,B.state="completed",ht.data instanceof HTMLImageElement||a.b(ht.data)?Z(ht):ht.data&&Z({data:yield(ct=ht.data,typeof createImageBitmap=="function"?a.d(ct):a.f(ct)),cacheControl:ht.cacheControl,expires:ht.expires})}catch(ht){delete B.abortController,j(ht)}finally{h--,E()}var ct}),E=()=>{const B=(()=>{for(const D of Object.keys(y))if(y[D]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=h;D<B&&o.length>0;D++){const G=o.shift();G.abortController.signal.aborted?D--:v(G)}},P=(B,D)=>new Promise((G,j)=>{const Z=new Image,Y=B.url,X=B.credentials;X&&X==="include"?Z.crossOrigin="use-credentials":(X&&X==="same-origin"||!a.s(Y))&&(Z.crossOrigin="anonymous"),D.signal.addEventListener("abort",()=>{Z.src="",j(a.c())}),Z.fetchPriority="high",Z.onload=()=>{Z.onerror=Z.onload=null,G({data:Z})},Z.onerror=()=>{Z.onerror=Z.onload=null,D.signal.aborted||j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Z.src=Y})}(H||(H={})),H.resetRequestQueue();class nt{constructor(o){this._transformRequestFn=o}transformRequest(o,h){return this._transformRequestFn&&this._transformRequestFn(o,h)||{url:o}}setTransformRequest(o){this._transformRequestFn=o}}function yt(g){var o=new a.A(3);return o[0]=g[0],o[1]=g[1],o[2]=g[2],o}var bt,vt=function(g,o,h){return g[0]=o[0]-h[0],g[1]=o[1]-h[1],g[2]=o[2]-h[2],g};bt=new a.A(3),a.A!=Float32Array&&(bt[0]=0,bt[1]=0,bt[2]=0);var mt=function(g){var o=g[0],h=g[1];return o*o+h*h};function Dt(g){const o=[];if(typeof g=="string")o.push({id:"default",url:g});else if(g&&g.length>0){const h=[];for(const{id:m,url:y}of g){const v=`${m}${y}`;h.indexOf(v)===-1&&(h.push(v),o.push({id:m,url:y}))}}return o}function kt(g,o,h){const m=g.split("?");return m[0]+=`${o}${h}`,m.join("?")}(function(){var g=new a.A(2);a.A!=Float32Array&&(g[0]=0,g[1]=0)})();class at{constructor(o,h,m,y){this.context=o,this.format=m,this.texture=o.gl.createTexture(),this.update(h,y)}update(o,h,m){const{width:y,height:v}=o,E=!(this.size&&this.size[0]===y&&this.size[1]===v||m),{context:P}=this,{gl:B}=P;if(this.useMipmap=!!(h&&h.useMipmap),B.bindTexture(B.TEXTURE_2D,this.texture),P.pixelStoreUnpackFlipY.set(!1),P.pixelStoreUnpack.set(1),P.pixelStoreUnpackPremultiplyAlpha.set(this.format===B.RGBA&&(!h||h.premultiply!==!1)),E)this.size=[y,v],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.b(o)?B.texImage2D(B.TEXTURE_2D,0,this.format,this.format,B.UNSIGNED_BYTE,o):B.texImage2D(B.TEXTURE_2D,0,this.format,y,v,0,this.format,B.UNSIGNED_BYTE,o.data);else{const{x:D,y:G}=m||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.b(o)?B.texSubImage2D(B.TEXTURE_2D,0,D,G,B.RGBA,B.UNSIGNED_BYTE,o):B.texSubImage2D(B.TEXTURE_2D,0,D,G,y,v,B.RGBA,B.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&B.generateMipmap(B.TEXTURE_2D)}bind(o,h,m){const{context:y}=this,{gl:v}=y;v.bindTexture(v.TEXTURE_2D,this.texture),m!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=v.LINEAR),o!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,o),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,m||o),this.filter=o),h!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,h),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function dt(g){const{userImage:o}=g;return!!(o&&o.render&&o.render())&&(g.data.replace(new Uint8Array(o.data.buffer)),!0)}class It extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:h,promiseResolve:m}of this.requestors)m(this._getImagesForIds(h));this.requestors=[]}}getImage(o){const h=this.images[o];if(h&&!h.data&&h.spriteData){const m=h.spriteData;h.data=new a.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),h.spriteData=null}return h}addImage(o,h){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,h)&&(this.images[o]=h)}_validate(o,h){let m=!0;const y=h.data||h.spriteData;return this._validateStretch(h.stretchX,y&&y.width)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "stretchX" value`))),m=!1),this._validateStretch(h.stretchY,y&&y.height)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "stretchY" value`))),m=!1),this._validateContent(h.content,h)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "content" value`))),m=!1),m}_validateStretch(o,h){if(!o)return!0;let m=0;for(const y of o){if(y[0]<m||y[1]<y[0]||h<y[1])return!1;m=y[1]}return!0}_validateContent(o,h){if(!o)return!0;if(o.length!==4)return!1;const m=h.spriteData,y=m&&m.width||h.data.width,v=m&&m.height||h.data.height;return!(o[0]<0||y<o[0]||o[1]<0||v<o[1]||o[2]<0||y<o[2]||o[3]<0||v<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const y=this.getImage(o);if(m&&(y.data.width!==h.data.width||y.data.height!==h.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=y.version+1,this.images[o]=h,this.updatedImages[o]=!0}removeImage(o){const h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise((h,m)=>{let y=!0;if(!this.isLoaded())for(const v of o)this.images[v]||(y=!1);this.isLoaded()||y?h(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:h})})}_getImagesForIds(o){const h={};for(const m of o){let y=this.getImage(m);y||(this.fire(new a.k("styleimagemissing",{id:m})),y=this.getImage(m)),y?h[m]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,textFitWidth:y.textFitWidth,textFitHeight:y.textFitHeight,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:a.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:o,height:h}=this.atlasImage;return{width:o,height:h}}getPattern(o){const h=this.patterns[o],m=this.getImage(o);if(!m)return null;if(h&&h.position.version===m.version)return h.position;if(h)h.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},v=new a.I(y,m);this.patterns[o]={bin:y,position:v}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new at(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const v in this.patterns)o.push(this.patterns[v].bin);const{w:h,h:m}=a.p(o),y=this.atlasImage;y.resize({width:h||1,height:m||1});for(const v in this.patterns){const{bin:E}=this.patterns[v],P=E.x+1,B=E.y+1,D=this.getImage(v).data,G=D.width,j=D.height;a.R.copy(D,y,{x:0,y:0},{x:P,y:B},{width:G,height:j}),a.R.copy(D,y,{x:0,y:j-1},{x:P,y:B-1},{width:G,height:1}),a.R.copy(D,y,{x:0,y:0},{x:P,y:B+j},{width:G,height:1}),a.R.copy(D,y,{x:G-1,y:0},{x:P-1,y:B},{width:1,height:j}),a.R.copy(D,y,{x:0,y:0},{x:P+G,y:B},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const h of o){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const m=this.getImage(h);m||a.w(`Image with ID: "${h}" was not found`),dt(m)&&this.updateImage(h,m)}}}const xt=1e20;function re(g,o,h,m,y,v,E,P,B){for(let D=o;D<o+m;D++)ee(g,h*v+D,v,y,E,P,B);for(let D=h;D<h+y;D++)ee(g,D*v+o,1,m,E,P,B)}function ee(g,o,h,m,y,v,E){v[0]=0,E[0]=-xt,E[1]=xt,y[0]=g[o];for(let P=1,B=0,D=0;P<m;P++){y[P]=g[o+P*h];const G=P*P;do{const j=v[B];D=(y[P]-y[j]+G-j*j)/(P-j)/2}while(D<=E[B]&&--B>-1);B++,v[B]=P,E[B]=D,E[B+1]=xt}for(let P=0,B=0;P<m;P++){for(;E[B+1]<P;)B++;const D=v[B],G=P-D;g[o+P*h]=y[D]+G*G}}class se{constructor(o,h){this.requestManager=o,this.localIdeographFontFamily=h,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return a._(this,void 0,void 0,function*(){const h=[];for(const v in o)for(const E of o[v])h.push(this._getAndCacheGlyphsPromise(v,E));const m=yield Promise.all(h),y={};for(const{stack:v,id:E,glyph:P}of m)y[v]||(y[v]={}),y[v][E]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};return y})}_getAndCacheGlyphsPromise(o,h){return a._(this,void 0,void 0,function*(){let m=this.entries[o];m||(m=this.entries[o]={glyphs:{},requests:{},ranges:{}});let y=m.glyphs[h];if(y!==void 0)return{stack:o,id:h,glyph:y};if(y=this._tinySDF(m,o,h),y)return m.glyphs[h]=y,{stack:o,id:h,glyph:y};const v=Math.floor(h/256);if(256*v>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[v])return{stack:o,id:h,glyph:y};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[v]){const P=se.loadGlyphRange(o,v,this.url,this.requestManager);m.requests[v]=P}const E=yield m.requests[v];for(const P in E)this._doesCharSupportLocalGlyph(+P)||(m.glyphs[+P]=E[+P]);return m.ranges[v]=!0,{stack:o,id:h,glyph:E[h]||null}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(o))}_tinySDF(o,h,m){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(m))return;let v=o.tinySDF;if(!v){let P="400";/bold/i.test(h)?P="900":/medium/i.test(h)?P="500":/light/i.test(h)&&(P="200"),v=o.tinySDF=new se.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:y,fontWeight:P})}const E=v.draw(String.fromCharCode(m));return{id:m,bitmap:new a.o({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}se.loadGlyphRange=function(g,o,h,m){return a._(this,void 0,void 0,function*(){const y=256*o,v=y+255,E=m.transformRequest(h.replace("{fontstack}",g).replace("{range}",`${y}-${v}`),"Glyphs"),P=yield a.l(E,new AbortController);if(!P||!P.data)throw new Error(`Could not load glyph range. range: ${o}, ${y}-${v}`);const B={};for(const D of a.n(P.data))B[D.id]=D;return B})},se.TinySDF=class{constructor(){let{fontSize:g=24,buffer:o=3,radius:h=8,cutoff:m=.25,fontFamily:y="sans-serif",fontWeight:v="normal",fontStyle:E="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=o,this.cutoff=m,this.radius=h;const P=this.size=g+4*o,B=this._createCanvas(P),D=this.ctx=B.getContext("2d",{willReadFrequently:!0});D.font=`${E} ${v} ${g}px ${y}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(g){const o=document.createElement("canvas");return o.width=o.height=g,o}draw(g){const{width:o,actualBoundingBoxAscent:h,actualBoundingBoxDescent:m,actualBoundingBoxLeft:y,actualBoundingBoxRight:v}=this.ctx.measureText(g),E=Math.ceil(h),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-y))),B=Math.min(this.size-this.buffer,E+Math.ceil(m)),D=P+2*this.buffer,G=B+2*this.buffer,j=Math.max(D*G,0),Z=new Uint8ClampedArray(j),Y={data:Z,width:D,height:G,glyphWidth:P,glyphHeight:B,glyphTop:E,glyphLeft:0,glyphAdvance:o};if(P===0||B===0)return Y;const{ctx:X,buffer:tt,gridInner:ct,gridOuter:ht}=this;X.clearRect(tt,tt,P,B),X.fillText(g,tt,tt+E);const gt=X.getImageData(tt,tt,P,B);ht.fill(xt,0,j),ct.fill(0,0,j);for(let pt=0;pt<B;pt++)for(let St=0;St<P;St++){const Rt=gt.data[4*(pt*P+St)+3]/255;if(Rt===0)continue;const Bt=(pt+tt)*D+St+tt;if(Rt===1)ht[Bt]=0,ct[Bt]=xt;else{const ie=.5-Rt;ht[Bt]=ie>0?ie*ie:0,ct[Bt]=ie<0?ie*ie:0}}re(ht,0,0,D,G,D,this.f,this.v,this.z),re(ct,tt,tt,P,B,D,this.f,this.v,this.z);for(let pt=0;pt<j;pt++){const St=Math.sqrt(ht[pt])-Math.sqrt(ct[pt]);Z[pt]=Math.round(255-255*(St/this.radius+this.cutoff))}return Y}};class Ot{constructor(){this.specification=a.v.light.position}possiblyEvaluate(o,h){return a.x(o.expression.evaluate(h))}interpolate(o,h,m){return{x:a.y.number(o.x,h.x,m),y:a.y.number(o.y,h.y,m),z:a.y.number(o.z,h.z,m)}}}let Xt;class Wt extends a.E{constructor(o){super(),Xt=Xt||new a.q({anchor:new a.D(a.v.light.anchor),position:new Ot,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Xt),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(a.r,o,h))for(const m in o){const y=o[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,m){return(!m||m.validate!==!1)&&a.t(this,o.call(a.u,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const xe=new a.q({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class it extends a.E{constructor(o){super(),this._transitionable=new a.T(xe),this.setSky(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.z(0))}setSky(o){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(a.B,o,h)){o||(o={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const m in o){const y=o[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}}getSky(){return this._transitionable.serialize()}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(m==null?void 0:m.validate)!==!1&&a.t(this,o.call(a.u,a.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(o){return o<60?0:o<70?(o-60)/10:1}}class Et{constructor(o,h){this.width=o,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,h){const m=o.join(",")+String(h);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(o,h)),this.dashEntry[m]}getDashRanges(o,h,m){const y=[];let v=o.length%2==1?-o[o.length-1]*m:0,E=o[0]*m,P=!0;y.push({left:v,right:E,isDash:P,zeroLength:o[0]===0});let B=o[0];for(let D=1;D<o.length;D++){P=!P;const G=o[D];v=B*m,B+=G,E=B*m,y.push({left:v,right:E,isDash:P,zeroLength:G===0})}return y}addRoundDash(o,h,m){const y=h/2;for(let v=-m;v<=m;v++){const E=this.width*(this.nextRow+m+v);let P=0,B=o[P];for(let D=0;D<this.width;D++){D/B.right>1&&(B=o[++P]);const G=Math.abs(D-B.left),j=Math.abs(D-B.right),Z=Math.min(G,j);let Y;const X=v/m*(y+1);if(B.isDash){const tt=y-Math.abs(X);Y=Math.sqrt(Z*Z+tt*tt)}else Y=y-Math.sqrt(Z*Z+X*X);this.data[E+D]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(o){for(let P=o.length-1;P>=0;--P){const B=o[P],D=o[P+1];B.zeroLength?o.splice(P,1):D&&D.isDash===B.isDash&&(D.left=B.left,o.splice(P,1))}const h=o[0],m=o[o.length-1];h.isDash===m.isDash&&(h.left=m.left-this.width,m.right=h.right+this.width);const y=this.width*this.nextRow;let v=0,E=o[v];for(let P=0;P<this.width;P++){P/E.right>1&&(E=o[++v]);const B=Math.abs(P-E.left),D=Math.abs(P-E.right),G=Math.min(B,D);this.data[y+P]=Math.max(0,Math.min(255,(E.isDash?G:-G)+128))}}addDash(o,h){const m=h?7:0,y=2*m+1;if(this.nextRow+y>this.height)return a.w("LineAtlas out of space"),null;let v=0;for(let P=0;P<o.length;P++)v+=o[P];if(v!==0){const P=this.width/v,B=this.getDashRanges(o,this.width,P);h?this.addRoundDash(B,P,m):this.addRegularDash(B)}const E={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:v};return this.nextRow+=y,this.dirty=!0,E}bind(o){const h=o.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const Pt="maplibre_preloaded_worker_pool";class jt{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<jt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Pt]}numActive(){return Object.keys(this.active).length}}const qt=Math.floor(S.hardwareConcurrency/2);let $t,Qt;function Kt(){return $t||($t=new jt),$t}jt.workerCount=a.C(globalThis)?Math.max(Math.min(qt,3),1):1;class Ee{constructor(o,h){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=h;const m=this.workerPool.acquire(h);for(let y=0;y<m.length;y++){const v=new a.F(m[y],h);v.name=`Worker ${y}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,h){const m=[];for(const y of this.actors)m.push(y.sendAsync({type:o,data:h}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(h=>{h.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,h){for(const m of this.actors)m.registerMessageHandler(o,h)}}function Me(){return Qt||(Qt=new Ee(Kt(),a.G),Qt.registerMessageHandler("GR",(g,o,h)=>a.m(o,h))),Qt}function De(g,o){const h=a.H();return a.J(h,h,[1,1,0]),a.K(h,h,[.5*g.width,.5*g.height,1]),a.L(h,h,g.calculatePosMatrix(o.toUnwrapped()))}function ze(g,o,h,m,y,v){const E=function(j,Z,Y){if(j)for(const X of j){const tt=Z[X];if(tt&&tt.source===Y&&tt.type==="fill-extrusion")return!0}else for(const X in Z){const tt=Z[X];if(tt.source===Y&&tt.type==="fill-extrusion")return!0}return!1}(y&&y.layers,o,g.id),P=v.maxPitchScaleFactor(),B=g.tilesIn(m,P,E);B.sort(or);const D=[];for(const j of B)D.push({wrappedTileID:j.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(o,h,g._state,j.queryGeometry,j.cameraQueryGeometry,j.scale,y,v,P,De(g.transform,j.tileID))});const G=function(j){const Z={},Y={};for(const X of j){const tt=X.queryResults,ct=X.wrappedTileID,ht=Y[ct]=Y[ct]||{};for(const gt in tt){const pt=tt[gt],St=ht[gt]=ht[gt]||{},Rt=Z[gt]=Z[gt]||[];for(const Bt of pt)St[Bt.featureIndex]||(St[Bt.featureIndex]=!0,Rt.push(Bt))}}return Z}(D);for(const j in G)G[j].forEach(Z=>{const Y=Z.feature,X=g.getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=X});return G}function or(g,o){const h=g.tileID,m=o.tileID;return h.overscaledZ-m.overscaledZ||h.canonical.y-m.canonical.y||h.wrap-m.wrap||h.canonical.x-m.canonical.x}function le(g,o,h){return a._(this,void 0,void 0,function*(){let m=g;if(g.url?m=(yield a.h(o.transformRequest(g.url,"Source"),h)).data:yield S.frameAsync(h),!m)return null;const y=a.M(a.e(m,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(y.vectorLayerIds=m.vector_layers.map(v=>v.id)),y})}class st{constructor(o,h){o&&(h?this.setSouthWest(o).setNorthEast(h):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof a.N?new a.N(o.lng,o.lat):a.N.convert(o),this}setSouthWest(o){return this._sw=o instanceof a.N?new a.N(o.lng,o.lat):a.N.convert(o),this}extend(o){const h=this._sw,m=this._ne;let y,v;if(o instanceof a.N)y=o,v=o;else{if(!(o instanceof st))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(st.convert(o)):this.extend(a.N.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(a.N.convert(o)):this;if(y=o._sw,v=o._ne,!y||!v)return this}return h||m?(h.lng=Math.min(y.lng,h.lng),h.lat=Math.min(y.lat,h.lat),m.lng=Math.max(v.lng,m.lng),m.lat=Math.max(v.lat,m.lat)):(this._sw=new a.N(y.lng,y.lat),this._ne=new a.N(v.lng,v.lat)),this}getCenter(){return new a.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.N(this.getWest(),this.getNorth())}getSouthEast(){return new a.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:h,lat:m}=a.N.convert(o);let y=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&y}static convert(o){return o instanceof st?o:o&&new st(o)}static fromLngLat(o){const h=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,m=h/Math.cos(Math.PI/180*o.lat);return new st(new a.N(o.lng-m,o.lat-h),new a.N(o.lng+m,o.lat+h))}adjustAntiMeridian(){const o=new a.N(this._sw.lng,this._sw.lat),h=new a.N(this._ne.lng,this._ne.lat);return new st(o,o.lng>h.lng?new a.N(h.lng+360,h.lat):h)}}class mr{constructor(o,h,m){this.bounds=st.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=m||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const h=Math.pow(2,o.z),m=Math.floor(a.O(this.bounds.getWest())*h),y=Math.floor(a.Q(this.bounds.getNorth())*h),v=Math.ceil(a.O(this.bounds.getEast())*h),E=Math.ceil(a.Q(this.bounds.getSouth())*h);return o.x>=m&&o.x<v&&o.y>=y&&o.y<E}}class Qe extends a.E{constructor(o,h,m,y){if(super(),this.id=o,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.M(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield le(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(a.e(this,o),o.bounds&&(this.tileBounds=new mr(o.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new a.j(o))}})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(h,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};m.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise((v,E)=>{o.reloadPromise={resolve:v,reject:E}})}else o.actor=this.dispatcher.getActor(),y="LT";o.abortController=new AbortController;try{const v=yield o.actor.sendAsync({type:y,data:m},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,v)}catch(v){if(delete o.abortController,o.aborted)return;if(v&&v.status!==404)throw v;this._afterTileLoadWorkerResponse(o,null)}})}_afterTileLoadWorkerResponse(o,h){if(h&&h.resourceTiming&&(o.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&o.setExpiryData(h),o.loadVectorData(h,this.map.painter),o.reloadPromise){const m=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(m.resolve).catch(m.reject)}}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class de extends a.E{constructor(o,h,m,y){super(),this.id=o,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.M(h,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield le(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(a.e(this,o),o.bounds&&(this.tileBounds=new mr(o.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new a.j(o))}})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}serialize(){return a.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const m=yield H.getImage(this.map._requestManager.transformRequest(h,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&o.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const y=this.map.painter.context,v=y.gl,E=m.data;o.texture=this.map.painter.getTileTexture(E.width),o.texture?o.texture.update(E,{useMipmap:!0}):(o.texture=new at(y,E,v.RGBA,{useMipmap:!0}),o.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST)),o.state="loaded"}}catch(m){if(delete o.abortController,o.aborted)o.state="unloaded";else if(m)throw o.state="errored",m}})}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)})}hasTransition(){return!1}}class Te extends de{constructor(o,h,m,y){super(o,h,m,y),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(h,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const y=yield H.getImage(m,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(y&&y.data){const v=y.data;this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&o.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const E=a.b(v)&&a.U()?v:yield this.readImageNow(v),P={type:this.type,uid:o.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();const B=yield o.actor.sendAsync({type:"LDT",data:P});o.dem=B,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(y){if(delete o.abortController,o.aborted)o.state="unloaded";else if(y)throw o.state="errored",y}})}readImageNow(o){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.V()){const h=o.width+2,m=o.height+2;try{return new a.R({width:h,height:m},yield a.W(o,-1,-1,h,m))}catch{}}return S.getImageData(o,1)})}_getNeighboringTiles(o){const h=o.canonical,m=Math.pow(2,h.z),y=(h.x-1+m)%m,v=h.x===0?o.wrap-1:o.wrap,E=(h.x+1+m)%m,P=h.x+1===m?o.wrap+1:o.wrap,B={};return B[new a.S(o.overscaledZ,v,h.z,y,h.y).key]={backfilled:!1},B[new a.S(o.overscaledZ,P,h.z,E,h.y).key]={backfilled:!1},h.y>0&&(B[new a.S(o.overscaledZ,v,h.z,y,h.y-1).key]={backfilled:!1},B[new a.S(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},B[new a.S(o.overscaledZ,P,h.z,E,h.y-1).key]={backfilled:!1}),h.y+1<m&&(B[new a.S(o.overscaledZ,v,h.z,y,h.y+1).key]={backfilled:!1},B[new a.S(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},B[new a.S(o.overscaledZ,P,h.z,E,h.y+1).key]={backfilled:!1}),B}unloadTile(o){return a._(this,void 0,void 0,function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))})}}class Be extends a.E{constructor(o,h,m,y){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=m.getActor(),this.setEventedParent(y),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const v=a.X/this.tileSize;h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*v,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*v,extent:a.X,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.X,radius:(h.clusterRadius||50)*v,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}getData(){return a._(this,void 0,void 0,function*(){const o=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:o})})}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,h,m){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:h,offset:m}})}_updateWorkerData(o){return a._(this,void 0,void 0,function*(){const h=a.e({type:this.type},this.workerOptions);o?h.dataDiff=o:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(S.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const m=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||m.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let y=null;m.resourceTiming&&m.resourceTiming[this.id]&&(y=m.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&a.e(v,{resourceTiming:y}),this.fire(new a.k("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},v),{sourceDataType:"content"})))}catch(m){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(m))}})}loaded(){return this._pendingLoads===0}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.actor?"RT":"LT";o.actor=this.actor;const m={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.abortController=new AbortController;const y=yield this.actor.sendAsync({type:h,data:m},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(y,this.map.painter,h==="RT")})}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ne=a.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class rr extends a.E{constructor(o,h,m,y){super(),this.id=o,this.dispatcher=m,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=h}load(o){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield H.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,o&&(this.coordinates=o),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.j(h))}})}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const h=o.map(a.Z.fromLngLat);this.tileID=function(y){let v=1/0,E=1/0,P=-1/0,B=-1/0;for(const Z of y)v=Math.min(v,Z.x),E=Math.min(E,Z.y),P=Math.max(P,Z.x),B=Math.max(B,Z.y);const D=Math.max(P-v,B-E),G=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),j=Math.pow(2,G);return new a.a1(G,Math.floor((v+P)/2*j),Math.floor((E+B)/2*j))}(h),this.minzoom=this.maxzoom=this.tileID.z;const m=h.map(y=>this.tileID.getTilePoint(y)._round());return this._boundsArray=new a.$,this._boundsArray.emplaceBack(m[0].x,m[0].y,0,0),this._boundsArray.emplaceBack(m[1].x,m[1].y,a.X,0),this._boundsArray.emplaceBack(m[3].x,m[3].y,0,a.X),this._boundsArray.emplaceBack(m[2].x,m[2].y,a.X,a.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Ne.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new at(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let m=!1;for(const y in this.tiles){const v=this.tiles[y];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Er extends rr{constructor(o,h,m,y){super(o,h,m,y),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const h of o.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a3(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new a.j(new a.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Ne.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new at(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let m=!1;for(const y in this.tiles){const v=this.tiles[y];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class wr extends rr{constructor(o,h,m,y){super(o,h,m,y),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(E=>typeof E!="number"))||this.fire(new a.j(new a.a2(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a2(`sources.${o}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.j(new a.a2(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a2(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a2(`sources.${o}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,m=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Ne.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new at(h,this.canvas,m.RGBA,{premultiply:!0});let y=!1;for(const v in this.tiles){const E=this.tiles[v];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,y=!0)}y&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const Fr={},Ur=g=>{switch(g){case"geojson":return Be;case"image":return rr;case"raster":return de;case"raster-dem":return Te;case"vector":return Qe;case"video":return Er;case"canvas":return wr}return Fr[g]},me="RTLPluginLoaded";class hr extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Me()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return a._(this,arguments,void 0,function(h){var m=this;let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(m.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(m.url=S.resolveURL(h),!m.url)throw new Error(`requested url ${h} is invalid`);if(m.status==="unavailable"){if(!y)return m._requestImport();m.status="deferred",m._syncState(m.status)}else if(m.status==="requested")return m._requestImport()}()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(me))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let xr=null;function Fe(){return xr||(xr=new hr),xr}class wi{constructor(o,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=a.a4(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const h=o+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,h,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(y,v){const E={};if(!v)return E;for(const P of y){const B=P.layerIds.map(D=>v.getLayer(D)).filter(Boolean);if(B.length!==0){P.layers=B,P.stateDependentLayerIds&&(P.stateDependentLayers=P.stateDependentLayerIds.map(D=>B.filter(G=>G.id===D)[0]));for(const D of B)E[D.id]=P}}return E}(o.buckets,h.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const v=this.buckets[y];if(v instanceof a.a6){if(this.hasSymbolBuckets=!0,!m)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const v=this.buckets[y];if(v instanceof a.a6&&v.hasRTLText){this.hasRTLText=!0,Fe().lazyLoad();break}}this.queryPadding=0;for(const y in this.buckets){const v=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(y).queryRadius(v))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new a.a5}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const m in this.buckets){const y=this.buckets[m];y.uploadPending()&&y.upload(o)}const h=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new at(o,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new at(o,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,h,m,y,v,E,P,B,D,G){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:v,scale:E,tileSize:this.tileSize,pixelPosMatrix:G,transform:B,params:P,queryPadding:this.queryPadding*D},o,h,m):{}}querySourceFeatures(o,h){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const y=m.loadVTLayers(),v=h&&h.sourceLayer?h.sourceLayer:"",E=y._geojsonTileLayer||y[v];if(!E)return;const P=a.a7(h&&h.filter),{z:B,x:D,y:G}=this.tileID.canonical,j={z:B,x:D,y:G};for(let Z=0;Z<E.length;Z++){const Y=E.feature(Z);if(P.needGeometry){const ct=a.a8(Y,!0);if(!P.filter(new a.z(this.tileID.overscaledZ),ct,this.tileID.canonical))continue}else if(!P.filter(new a.z(this.tileID.overscaledZ),Y))continue;const X=m.getId(Y,v),tt=new a.a9(Y,B,D,G,X);tt.tile=j,o.push(tt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const h=this.expirationTime;if(o.cacheControl){const m=a.aa(o.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const m=Date.now();let y=!1;if(this.expirationTime>m)y=!1;else if(h)if(this.expirationTime<h)y=!0;else{const v=this.expirationTime-h;v?this.expirationTime=m+Math.max(v,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!h.style.hasLayer(y))continue;const v=this.buckets[y],E=v.layers[0].sourceLayer||"_geojsonTileLayer",P=m[E],B=o[E];if(!P||!B||Object.keys(B).length===0)continue;v.update(B,P,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=h&&h.style&&h.style.getLayer(y);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<S.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=S.now()+o}setDependencies(o,h){const m={};for(const y of h)m[y]=!0;this.dependencies[o]=m}hasDependency(o,h){for(const m of o){const y=this.dependencies[m];if(y){for(const v of h)if(y[v])return!0}}return!1}}class ge{constructor(o,h){this.max=o,this.onRemove=h,this.reset()}reset(){for(const o in this.data)for(const h of this.data[o])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(o,h,m){const y=o.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const v={value:h,timeout:void 0};if(m!==void 0&&(v.timeout=setTimeout(()=>{this.remove(o,v)},m)),this.data[y].push(v),this.order.push(y),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const h=this.data[o].shift();return h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),h.value}getByKey(o){const h=this.data[o];return h?h[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,h){if(!this.has(o))return this;const m=o.wrapped().key,y=h===void 0?0:this.data[m].indexOf(h),v=this.data[m][y];return this.data[m].splice(y,1),v.timeout&&clearTimeout(v.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(v.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(o){const h=[];for(const m in this.data)for(const y of this.data[m])o(y.value)||h.push(y);for(const m of h)this.remove(m.value.tileID,m)}}class br{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,h,m){const y=String(h);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][y]=this.stateChanges[o][y]||{},a.e(this.stateChanges[o][y],m),this.deletedStates[o]===null){this.deletedStates[o]={};for(const v in this.state[o])v!==y&&(this.deletedStates[o][v]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][y]===null){this.deletedStates[o][y]={};for(const v in this.state[o][y])m[v]||(this.deletedStates[o][y][v]=null)}else for(const v in m)this.deletedStates[o]&&this.deletedStates[o][y]&&this.deletedStates[o][y][v]===null&&delete this.deletedStates[o][y][v]}removeFeatureState(o,h,m){if(this.deletedStates[o]===null)return;const y=String(h);if(this.deletedStates[o]=this.deletedStates[o]||{},m&&h!==void 0)this.deletedStates[o][y]!==null&&(this.deletedStates[o][y]=this.deletedStates[o][y]||{},this.deletedStates[o][y][m]=null);else if(h!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][y])for(m in this.deletedStates[o][y]={},this.stateChanges[o][y])this.deletedStates[o][y][m]=null;else this.deletedStates[o][y]=null;else this.deletedStates[o]=null}getState(o,h){const m=String(h),y=a.e({},(this.state[o]||{})[m],(this.stateChanges[o]||{})[m]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const v=this.deletedStates[o][h];if(v===null)return{};for(const E in v)delete y[E]}return y}initializeTileState(o,h){o.setFeatureState(this.state,h)}coalesceChanges(o,h){const m={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const v={};for(const E in this.stateChanges[y])this.state[y][E]||(this.state[y][E]={}),a.e(this.state[y][E],this.stateChanges[y][E]),v[E]=this.state[y][E];m[y]=v}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const v={};if(this.deletedStates[y]===null)for(const E in this.state[y])v[E]={},this.state[y][E]={};else for(const E in this.deletedStates[y]){if(this.deletedStates[y][E]===null)this.state[y][E]={};else for(const P of Object.keys(this.deletedStates[y][E]))delete this.state[y][E][P];v[E]=this.state[y][E]}m[y]=m[y]||{},a.e(m[y],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const y in o)o[y].setFeatureState(m,h)}}class Ge extends a.E{constructor(o,h,m){super(),this.id=o,this.dispatcher=m,this.on("data",y=>this._dataHandler(y)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((y,v,E,P)=>{const B=new(Ur(v.type))(y,v,E,P);if(B.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${B.id}`);return B})(o,h,m,this),this._tiles={},this._cache=new ge(0,y=>this._unloadTile(y)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new br,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,h,m){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,h,m)}catch(y){o.state="errored",y.status!==404?this._source.fire(new a.j(y,{tile:o})):this.update(this.transform,this.terrain)}})}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new a.k("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const m=this._tiles[h];m.upload(o),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Hr).map(o=>o.key)}getRenderableIds(o){const h=[];for(const m in this._tiles)this._isIdRenderable(m,o)&&h.push(this._tiles[m]);return o?h.sort((m,y)=>{const v=m.tileID,E=y.tileID,P=new a.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),B=new a.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-E.overscaledZ||B.y-P.y||B.x-P.x}).map(m=>m.tileID.key):h.map(m=>m.tileID).sort(Hr).map(m=>m.key)}hasRenderableParent(o){const h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,h){return a._(this,void 0,void 0,function*(){const m=this._tiles[o];m&&(m.state!=="loading"&&(m.state=h),yield this._loadTile(m,o,h))})}_tileLoaded(o,h,m){o.timeAdded=S.now(),m==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const h=this.getRenderableIds();for(let y=0;y<h.length;y++){const v=h[y];if(o.neighboringTiles&&o.neighboringTiles[v]){const E=this.getTileByID(v);m(o,E),m(E,o)}}function m(y,v){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let E=v.tileID.canonical.x-y.tileID.canonical.x;const P=v.tileID.canonical.y-y.tileID.canonical.y,B=Math.pow(2,y.tileID.canonical.z),D=v.tileID.key;E===0&&P===0||Math.abs(P)>1||(Math.abs(E)>1&&(Math.abs(E+B)===1?E+=B:Math.abs(E-B)===1&&(E-=B)),v.dem&&y.dem&&(y.dem.backfillBorder(v.dem,E,P),y.neighboringTiles&&y.neighboringTiles[D]&&(y.neighboringTiles[D].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,h,m,y){for(const v in this._tiles){let E=this._tiles[v];if(y[v]||!E.hasData()||E.tileID.overscaledZ<=h||E.tileID.overscaledZ>m)continue;let P=E.tileID;for(;E&&E.tileID.overscaledZ>h+1;){const D=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[D.key],E&&E.hasData()&&(P=D)}let B=P;for(;B.overscaledZ>h;)if(B=B.scaledTo(B.overscaledZ-1),o[B.key]){y[P.key]=P;break}}}findLoadedParent(o,h){if(o.key in this._loadedParentTiles){const m=this._loadedParentTiles[o.key];return m&&m.tileID.overscaledZ>=h?m:null}for(let m=o.overscaledZ-1;m>=h;m--){const y=o.scaledTo(m),v=this._getLoadedTile(y);if(v)return v}}findLoadedSibling(o){return this._getLoadedTile(o)}_getLoadedTile(o){const h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const h=Math.ceil(o.width/this._source.tileSize)+1,m=Math.ceil(o.height/this._source.tileSize)+1,y=Math.floor(h*m*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(v)}handleWrapJump(o){const h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){const m={};for(const y in this._tiles){const v=this._tiles[y];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+h),m[v.tileID.key]=v}this._tiles=m;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}_updateCoveredAndRetainedTiles(o,h,m,y,v,E){const P={},B={},D=Object.keys(o),G=S.now();for(const j of D){const Z=o[j],Y=this._tiles[j];if(!Y||Y.fadeEndTime!==0&&Y.fadeEndTime<=G)continue;const X=this.findLoadedParent(Z,h),tt=this.findLoadedSibling(Z),ct=X||tt||null;ct&&(this._addTile(ct.tileID),P[ct.tileID.key]=ct.tileID),B[j]=Z}this._retainLoadedChildren(B,y,m,o);for(const j in P)o[j]||(this._coveredTiles[j]=!0,o[j]=P[j]);if(E){const j={},Z={};for(const Y of v)this._tiles[Y.key].hasData()?j[Y.key]=Y:Z[Y.key]=Y;for(const Y in Z){const X=Z[Y].children(this._source.maxzoom);this._tiles[X[0].key]&&this._tiles[X[1].key]&&this._tiles[X[2].key]&&this._tiles[X[3].key]&&(j[X[0].key]=o[X[0].key]=X[0],j[X[1].key]=o[X[1].key]=X[1],j[X[2].key]=o[X[2].key]=X[2],j[X[3].key]=o[X[3].key]=X[3],delete Z[Y])}for(const Y in Z){const X=Z[Y],tt=this.findLoadedParent(X,this._source.minzoom),ct=this.findLoadedSibling(X),ht=tt||ct||null;if(ht){j[ht.tileID.key]=o[ht.tileID.key]=ht.tileID;for(const gt in j)j[gt].isChildOf(ht.tileID)&&delete j[gt]}}for(const Y in this._tiles)j[Y]||(this._coveredTiles[Y]=!0)}}update(o,h){if(!this._sourceLoaded||this._paused)return;let m;this.transform=o,this.terrain=h,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(G=>new a.S(G.canonical.z,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y)):(m=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(m=m.filter(G=>this._source.hasTile(G)))):m=[];const y=o.coveringZoomLevel(this._source),v=Math.max(y-Ge.maxOverzooming,this._source.minzoom),E=Math.max(y+Ge.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const G={};for(const j of m)if(j.canonical.z>this._source.minzoom){const Z=j.scaledTo(j.canonical.z-1);G[Z.key]=Z;const Y=j.scaledTo(Math.max(this._source.minzoom,Math.min(j.canonical.z,5)));G[Y.key]=Y}m=m.concat(Object.values(G))}const P=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,P&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const B=this._updateRetainedTiles(m,y);Qi(this._source.type)&&this._updateCoveredAndRetainedTiles(B,v,E,y,m,h);for(const G in B)this._tiles[G].clearFadeHold();const D=a.ab(this._tiles,B);for(const G of D){const j=this._tiles[G];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(G)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,h){var m;const y={},v={},E=Math.max(h-Ge.maxOverzooming,this._source.minzoom),P=Math.max(h+Ge.maxUnderzooming,this._source.minzoom),B={};for(const D of o){const G=this._addTile(D);y[D.key]=D,G.hasData()||h<this._source.maxzoom&&(B[D.key]=D)}this._retainLoadedChildren(B,h,P,y);for(const D of o){let G=this._tiles[D.key];if(G.hasData())continue;if(h+1>this._source.maxzoom){const Z=D.children(this._source.maxzoom)[0],Y=this.getTile(Z);if(Y&&Y.hasData()){y[Z.key]=Z;continue}}else{const Z=D.children(this._source.maxzoom);if(y[Z[0].key]&&y[Z[1].key]&&y[Z[2].key]&&y[Z[3].key])continue}let j=G.wasRequested();for(let Z=D.overscaledZ-1;Z>=E;--Z){const Y=D.scaledTo(Z);if(v[Y.key])break;if(v[Y.key]=!0,G=this.getTile(Y),!G&&j&&(G=this._addTile(Y)),G){const X=G.hasData();if((X||!(!((m=this.map)===null||m===void 0)&&m.cancelPendingTileRequestsWhileZooming)||j)&&(y[Y.key]=Y),j=G.wasRequested(),X)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const h=[];let m,y=this._tiles[o].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){m=this._loadedParentTiles[y.key];break}h.push(y.key);const v=y.scaledTo(y.overscaledZ-1);if(m=this._getLoadedTile(v),m)break;y=v}for(const v of h)this._loadedParentTiles[v]=m}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const o in this._tiles){const h=this._tiles[o].tileID,m=this._getLoadedTile(h);this._loadedSiblingTiles[h.key]=m}}_addTile(o){let h=this._tiles[o.key];if(h)return h;h=this._cache.getAndRemove(o),h&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));const m=h;return h||(h=new wi(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,o.key,h.state)),h.uses++,this._tiles[o.key]=h,m||this._source.fire(new a.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(o,h){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const m=h.getExpiryTimeout();m&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},m))}_removeTile(o){const h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(o){const h=o.sourceDataType;o.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,h,m){const y=[],v=this.transform;if(!v)return y;const E=m?v.getCameraQueryGeometry(o):o,P=o.map(X=>v.pointCoordinate(X,this.terrain)),B=E.map(X=>v.pointCoordinate(X,this.terrain)),D=this.getIds();let G=1/0,j=1/0,Z=-1/0,Y=-1/0;for(const X of B)G=Math.min(G,X.x),j=Math.min(j,X.y),Z=Math.max(Z,X.x),Y=Math.max(Y,X.y);for(let X=0;X<D.length;X++){const tt=this._tiles[D[X]];if(tt.holdingForFade())continue;const ct=tt.tileID,ht=Math.pow(2,v.zoom-tt.tileID.overscaledZ),gt=h*tt.queryPadding*a.X/tt.tileSize/ht,pt=[ct.getTilePoint(new a.Z(G,j)),ct.getTilePoint(new a.Z(Z,Y))];if(pt[0].x-gt<a.X&&pt[0].y-gt<a.X&&pt[1].x+gt>=0&&pt[1].y+gt>=0){const St=P.map(Bt=>ct.getTilePoint(Bt)),Rt=B.map(Bt=>ct.getTilePoint(Bt));y.push({tile:tt,tileID:ct,queryGeometry:St,cameraQueryGeometry:Rt,scale:ht})}}return y}getVisibleCoordinates(o){const h=this.getRenderableIds(o).map(m=>this._tiles[m].tileID);for(const m of h)m.posMatrix=this.transform.calculatePosMatrix(m.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(Qi(this._source.type)){const o=S.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=o)return!0}return!1}setFeatureState(o,h,m){this._state.updateState(o=o||"_geojsonTileLayer",h,m)}removeFeatureState(o,h,m){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,m)}getFeatureState(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)}setDependencies(o,h,m){const y=this._tiles[o];y&&y.setDependencies(h,m)}reloadTilesForDependencies(o,h){for(const m in this._tiles)this._tiles[m].hasDependency(o,h)&&this._reloadTile(m,"reloading");this._cache.filter(m=>!m.hasDependency(o,h))}}function Hr(g,o){const h=Math.abs(2*g.wrap)-+(g.wrap<0),m=Math.abs(2*o.wrap)-+(o.wrap<0);return g.overscaledZ-o.overscaledZ||m-h||o.canonical.y-g.canonical.y||o.canonical.x-g.canonical.x}function Qi(g){return g==="raster"||g==="image"||g==="video"}Ge.maxOverzooming=10,Ge.maxUnderzooming=3;class je{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=a.ac(o,0,1);let h=1,m=this._distances[h];const y=o*this.paddedLength+this.padding;for(;m<y&&h<this._distances.length;)m=this._distances[++h];const v=h-1,E=this._distances[v],P=m-E,B=P>0?(y-E)/P:0;return this.points[v].mult(1-B).add(this.points[h].mult(B))}}function In(g,o){let h=!0;return g==="always"||g!=="never"&&o!=="never"||(h=!1),h}class si{constructor(o,h,m){const y=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(o/m),this.yCellCount=Math.ceil(h/m);for(let E=0;E<this.xCellCount*this.yCellCount;E++)y.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,m,y,v){this._forEachCell(h,m,y,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(v)}insertCircle(o,h,m,y){this._forEachCell(h-y,m-y,h+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(m),this.circles.push(y)}_insertBoxCell(o,h,m,y,v,E){this.boxCells[v].push(E)}_insertCircleCell(o,h,m,y,v,E){this.circleCells[v].push(E)}_query(o,h,m,y,v,E,P){if(m<0||o>this.width||y<0||h>this.height)return[];const B=[];if(o<=0&&h<=0&&this.width<=m&&this.height<=y){if(v)return[{key:null,x1:o,y1:h,x2:m,y2:y}];for(let D=0;D<this.boxKeys.length;D++)B.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const G=this.circles[3*D],j=this.circles[3*D+1],Z=this.circles[3*D+2];B.push({key:this.circleKeys[D],x1:G-Z,y1:j-Z,x2:G+Z,y2:j+Z})}}else this._forEachCell(o,h,m,y,this._queryCell,B,{hitTest:v,overlapMode:E,seenUids:{box:{},circle:{}}},P);return B}query(o,h,m,y){return this._query(o,h,m,y,!1,null)}hitTest(o,h,m,y,v,E){return this._query(o,h,m,y,!0,v,E).length>0}hitTestCircle(o,h,m,y,v){const E=o-m,P=o+m,B=h-m,D=h+m;if(P<0||E>this.width||D<0||B>this.height)return!1;const G=[];return this._forEachCell(E,B,P,D,this._queryCellCircle,G,{hitTest:!0,overlapMode:y,circle:{x:o,y:h,radius:m},seenUids:{box:{},circle:{}}},v),G.length>0}_queryCell(o,h,m,y,v,E,P,B){const{seenUids:D,hitTest:G,overlapMode:j}=P,Z=this.boxCells[v];if(Z!==null){const X=this.bboxes;for(const tt of Z)if(!D.box[tt]){D.box[tt]=!0;const ct=4*tt,ht=this.boxKeys[tt];if(o<=X[ct+2]&&h<=X[ct+3]&&m>=X[ct+0]&&y>=X[ct+1]&&(!B||B(ht))&&(!G||!In(j,ht.overlapMode))&&(E.push({key:ht,x1:X[ct],y1:X[ct+1],x2:X[ct+2],y2:X[ct+3]}),G))return!0}}const Y=this.circleCells[v];if(Y!==null){const X=this.circles;for(const tt of Y)if(!D.circle[tt]){D.circle[tt]=!0;const ct=3*tt,ht=this.circleKeys[tt];if(this._circleAndRectCollide(X[ct],X[ct+1],X[ct+2],o,h,m,y)&&(!B||B(ht))&&(!G||!In(j,ht.overlapMode))){const gt=X[ct],pt=X[ct+1],St=X[ct+2];if(E.push({key:ht,x1:gt-St,y1:pt-St,x2:gt+St,y2:pt+St}),G)return!0}}}return!1}_queryCellCircle(o,h,m,y,v,E,P,B){const{circle:D,seenUids:G,overlapMode:j}=P,Z=this.boxCells[v];if(Z!==null){const X=this.bboxes;for(const tt of Z)if(!G.box[tt]){G.box[tt]=!0;const ct=4*tt,ht=this.boxKeys[tt];if(this._circleAndRectCollide(D.x,D.y,D.radius,X[ct+0],X[ct+1],X[ct+2],X[ct+3])&&(!B||B(ht))&&!In(j,ht.overlapMode))return E.push(!0),!0}}const Y=this.circleCells[v];if(Y!==null){const X=this.circles;for(const tt of Y)if(!G.circle[tt]){G.circle[tt]=!0;const ct=3*tt,ht=this.circleKeys[tt];if(this._circlesCollide(X[ct],X[ct+1],X[ct+2],D.x,D.y,D.radius)&&(!B||B(ht))&&!In(j,ht.overlapMode))return E.push(!0),!0}}}_forEachCell(o,h,m,y,v,E,P,B){const D=this._convertToXCellCoord(o),G=this._convertToYCellCoord(h),j=this._convertToXCellCoord(m),Z=this._convertToYCellCoord(y);for(let Y=D;Y<=j;Y++)for(let X=G;X<=Z;X++)if(v.call(this,o,h,m,y,this.xCellCount*X+Y,E,P,B))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,m,y,v,E){const P=y-o,B=v-h,D=m+E;return D*D>P*P+B*B}_circleAndRectCollide(o,h,m,y,v,E,P){const B=(E-y)/2,D=Math.abs(o-(y+B));if(D>B+m)return!1;const G=(P-v)/2,j=Math.abs(h-(v+G));if(j>G+m)return!1;if(D<=B||j<=G)return!0;const Z=D-B,Y=j-G;return Z*Z+Y*Y<=m*m}}function on(g,o,h,m,y){const v=a.H();return o?(a.K(v,v,[1/y,1/y,1]),h||a.ad(v,v,m.angle)):a.L(v,m.labelPlaneMatrix,g),v}function an(g,o,h,m,y){if(o){const v=a.ae(g);return a.K(v,v,[y,y,1]),h||a.ad(v,v,-m.angle),v}return m.glCoordMatrix}function At(g,o,h,m){let y;m?(y=[g,o,m(g,o),1],a.af(y,y,h)):(y=[g,o,0,1],Br(y,y,h));const v=y[3];return{point:new a.P(y[0]/v,y[1]/v),signedDistanceFromCamera:v,isOccluded:!1}}function J(g,o){return .5+g/o*.5}function Q(g,o){return g.x>=-o[0]&&g.x<=o[0]&&g.y>=-o[1]&&g.y<=o[1]}function ut(g,o,h,m,y,v,E,P,B,D,G,j,Z,Y,X){const tt=m?g.textSizeData:g.iconSizeData,ct=a.ag(tt,h.transform.zoom),ht=[256/h.width*2+1,256/h.height*2+1],gt=m?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;gt.clear();const pt=g.lineVertexArray,St=m?g.text.placedSymbolArray:g.icon.placedSymbolArray,Rt=h.transform.width/h.transform.height;let Bt=!1;for(let ie=0;ie<St.length;ie++){const pe=St.get(ie);if(pe.hidden||pe.writingMode===a.ah.vertical&&!Bt){Ke(pe.numGlyphs,gt);continue}Bt=!1;const ye=At(pe.anchorX,pe.anchorY,o,X);if(!Q(ye.point,ht)){Ke(pe.numGlyphs,gt);continue}const we=J(h.transform.cameraToCenterDistance,ye.signedDistanceFromCamera),ve=a.ai(tt,ct,pe),_e=E?ve/we:ve*we,Se={getElevation:X,labelPlaneMatrix:y,lineVertexArray:pt,pitchWithMap:E,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:D,tileAnchorPoint:new a.P(pe.anchorX,pe.anchorY),unwrappedTileID:G,width:j,height:Z,translation:Y},Ye=Vt(Se,pe,_e,!1,P,o,v,g.glyphOffsetArray,gt,Rt,B);Bt=Ye.useVertical,(Ye.notEnoughRoom||Bt||Ye.needsFlipping&&Vt(Se,pe,_e,!0,P,o,v,g.glyphOffsetArray,gt,Rt,B).notEnoughRoom)&&Ke(pe.numGlyphs,gt)}m?g.text.dynamicLayoutVertexBuffer.updateData(gt):g.icon.dynamicLayoutVertexBuffer.updateData(gt)}function wt(g,o,h,m,y,v,E,P){const B=v.glyphStartIndex+v.numGlyphs,D=v.lineStartIndex,G=v.lineStartIndex+v.lineLength,j=o.getoffsetX(v.glyphStartIndex),Z=o.getoffsetX(B-1),Y=be(g*j,h,m,y,v.segment,D,G,P,E);if(!Y)return null;const X=be(g*Z,h,m,y,v.segment,D,G,P,E);return X?P.projectionCache.anyProjectionOccluded?null:{first:Y,last:X}:null}function Nt(g,o,h,m){return g===a.ah.horizontal&&Math.abs(h.y-o.y)>Math.abs(h.x-o.x)*m?{useVertical:!0}:(g===a.ah.vertical?o.y<h.y:o.x>h.x)?{needsFlipping:!0}:null}function Vt(g,o,h,m,y,v,E,P,B,D,G){const j=h/24,Z=o.lineOffsetX*j,Y=o.lineOffsetY*j;let X;if(o.numGlyphs>1){const tt=o.glyphStartIndex+o.numGlyphs,ct=o.lineStartIndex,ht=o.lineStartIndex+o.lineLength,gt=wt(j,P,Z,Y,m,o,G,g);if(!gt)return{notEnoughRoom:!0};const pt=At(gt.first.point.x,gt.first.point.y,E,g.getElevation).point,St=At(gt.last.point.x,gt.last.point.y,E,g.getElevation).point;if(y&&!m){const Rt=Nt(o.writingMode,pt,St,D);if(Rt)return Rt}X=[gt.first];for(let Rt=o.glyphStartIndex+1;Rt<tt-1;Rt++)X.push(be(j*P.getoffsetX(Rt),Z,Y,m,o.segment,ct,ht,g,G));X.push(gt.last)}else{if(y&&!m){const ct=At(g.tileAnchorPoint.x,g.tileAnchorPoint.y,v,g.getElevation).point,ht=o.lineStartIndex+o.segment+1,gt=new a.P(g.lineVertexArray.getx(ht),g.lineVertexArray.gety(ht)),pt=At(gt.x,gt.y,v,g.getElevation),St=pt.signedDistanceFromCamera>0?pt.point:function(Bt,ie,pe,ye,we,ve){return Ft(Bt,ie,pe,1,we,ve)}(g.tileAnchorPoint,gt,ct,0,v,g),Rt=Nt(o.writingMode,ct,St,D);if(Rt)return Rt}const tt=be(j*P.getoffsetX(o.glyphStartIndex),Z,Y,m,o.segment,o.lineStartIndex,o.lineStartIndex+o.lineLength,g,G);if(!tt||g.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};X=[tt]}for(const tt of X)a.aj(B,tt.point,tt.angle);return{}}function Ft(g,o,h,m,y,v){const E=g.add(g.sub(o)._unit()),P=y!==void 0?At(E.x,E.y,y,v.getElevation).point:ne(E.x,E.y,v).point,B=h.sub(P);return h.add(B._mult(m/B.mag()))}function Lt(g,o,h){const m=o.projectionCache;if(m.projections[g])return m.projections[g];const y=new a.P(o.lineVertexArray.getx(g),o.lineVertexArray.gety(g)),v=ne(y.x,y.y,o);if(v.signedDistanceFromCamera>0)return m.projections[g]=v.point,m.anyProjectionOccluded=m.anyProjectionOccluded||v.isOccluded,v.point;const E=g-h.direction;return function(P,B,D,G,j){return Ft(P,B,D,G,void 0,j)}(h.distanceFromAnchor===0?o.tileAnchorPoint:new a.P(o.lineVertexArray.getx(E),o.lineVertexArray.gety(E)),y,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,o)}function ne(g,o,h){const m=g+h.translation[0],y=o+h.translation[1];let v;return!h.pitchWithMap&&h.projection.useSpecialProjectionForSymbols?(v=h.projection.projectTileCoordinates(m,y,h.unwrappedTileID,h.getElevation),v.point.x=(.5*v.point.x+.5)*h.width,v.point.y=(.5*-v.point.y+.5)*h.height):(v=At(m,y,h.labelPlaneMatrix,h.getElevation),v.isOccluded=!1),v}function ue(g,o,h){return g._unit()._perp()._mult(o*h)}function Zt(g,o,h,m,y,v,E,P,B){if(P.projectionCache.offsets[g])return P.projectionCache.offsets[g];const D=h.add(o);if(g+B.direction<m||g+B.direction>=y)return P.projectionCache.offsets[g]=D,D;const G=Lt(g+B.direction,P,B),j=ue(G.sub(h),E,B.direction),Z=h.add(j),Y=G.add(j);return P.projectionCache.offsets[g]=a.ak(v,D,Z,Y)||D,P.projectionCache.offsets[g]}function be(g,o,h,m,y,v,E,P,B){const D=m?g-o:g+o;let G=D>0?1:-1,j=0;m&&(G*=-1,j=Math.PI),G<0&&(j+=Math.PI);let Z,Y=G>0?v+y:v+y+1;P.projectionCache.cachedAnchorPoint?Z=P.projectionCache.cachedAnchorPoint:(Z=ne(P.tileAnchorPoint.x,P.tileAnchorPoint.y,P).point,P.projectionCache.cachedAnchorPoint=Z);let X,tt,ct=Z,ht=Z,gt=0,pt=0;const St=Math.abs(D),Rt=[];let Bt;for(;gt+pt<=St;){if(Y+=G,Y<v||Y>=E)return null;gt+=pt,ht=ct,tt=X;const ye={absOffsetX:St,direction:G,distanceFromAnchor:gt,previousVertex:ht};if(ct=Lt(Y,P,ye),h===0)Rt.push(ht),Bt=ct.sub(ht);else{let we;const ve=ct.sub(ht);we=ve.mag()===0?ue(Lt(Y+G,P,ye).sub(ct),h,G):ue(ve,h,G),tt||(tt=ht.add(we)),X=Zt(Y,we,ct,v,E,tt,h,P,ye),Rt.push(tt),Bt=X.sub(tt)}pt=Bt.mag()}const ie=Bt._mult((St-gt)/pt)._add(tt||ht),pe=j+Math.atan2(ct.y-ht.y,ct.x-ht.x);return Rt.push(ie),{point:ie,angle:B?pe:0,path:Rt}}const We=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ke(g,o){for(let h=0;h<g;h++){const m=o.length;o.resize(m+4),o.float32.set(We,3*m)}}function Br(g,o,h){const m=o[0],y=o[1];return g[0]=h[0]*m+h[4]*y+h[12],g[1]=h[1]*m+h[5]*y+h[13],g[3]=h[3]*m+h[7]*y+h[15],g}const tr=100;class Ir{constructor(o,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new si(o.width+200,o.height+200,25),y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new si(o.width+200,o.height+200,25);this.transform=o,this.mapProjection=h,this.grid=m,this.ignoredGrid=y,this.pitchFactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+tr,this.screenBottomBoundary=o.height+tr,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,h,m,y,v,E,P,B,D,G,j){const Z=o.anchorPointX+B[0],Y=o.anchorPointY+B[1],X=this.projectAndGetPerspectiveRatio(y,Z,Y,v,G),tt=m*X.perspectiveRatio;let ct;if(E||P)ct=this._projectCollisionBox(o,tt,y,v,E,P,B,X,G,j);else{const Rt=X.point.x+(j?j.x*tt:0),Bt=X.point.y+(j?j.y*tt:0);ct={allPointsOccluded:!1,box:[Rt+o.x1*tt,Bt+o.y1*tt,Rt+o.x2*tt,Bt+o.y2*tt]}}const[ht,gt,pt,St]=ct.box;return this.mapProjection.useSpecialProjectionForSymbols&&(E?ct.allPointsOccluded:this.mapProjection.isOccluded(Z,Y,v))||X.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ht,gt,pt,St)||h!=="always"&&this.grid.hitTest(ht,gt,pt,St,h,D)?{box:[ht,gt,pt,St],placeable:!1,offscreen:!1}:{box:[ht,gt,pt,St],placeable:!0,offscreen:this.isOffscreen(ht,gt,pt,St)}}placeCollisionCircles(o,h,m,y,v,E,P,B,D,G,j,Z,Y,X,tt,ct){const ht=[],gt=new a.P(h.anchorX,h.anchorY),pt=this.getPerspectiveRatio(E,gt.x,gt.y,P,ct),St=(j?v/pt:v*pt)/a.ap,Rt={getElevation:ct,labelPlaneMatrix:B,lineVertexArray:m,pitchWithMap:j,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:gt,unwrappedTileID:P,width:this.transform.width,height:this.transform.height,translation:tt},Bt=wt(St,y,h.lineOffsetX*St,h.lineOffsetY*St,!1,h,!1,Rt);let ie=!1,pe=!1,ye=!0;if(Bt){const we=.5*Y*pt+X,ve=new a.P(-100,-100),_e=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Se=new je,Ye=Bt.first,Pe=Bt.last;let Ie=[];for(let vr=Ye.path.length-1;vr>=1;vr--)Ie.push(Ye.path[vr]);for(let vr=1;vr<Pe.path.length;vr++)Ie.push(Pe.path[vr]);const ir=2.5*we;if(D){const vr=this.projectPathToScreenSpace(Ie,Rt,D);Ie=vr.some(Tr=>Tr.signedDistanceFromCamera<=0)?[]:vr.map(Tr=>Tr.point)}let Ar=[];if(Ie.length>0){const vr=Ie[0].clone(),Tr=Ie[0].clone();for(let Dr=1;Dr<Ie.length;Dr++)vr.x=Math.min(vr.x,Ie[Dr].x),vr.y=Math.min(vr.y,Ie[Dr].y),Tr.x=Math.max(Tr.x,Ie[Dr].x),Tr.y=Math.max(Tr.y,Ie[Dr].y);Ar=vr.x>=ve.x&&Tr.x<=_e.x&&vr.y>=ve.y&&Tr.y<=_e.y?[Ie]:Tr.x<ve.x||vr.x>_e.x||Tr.y<ve.y||vr.y>_e.y?[]:a.al([Ie],ve.x,ve.y,_e.x,_e.y)}for(const vr of Ar){Se.reset(vr,.25*we);let Tr=0;Tr=Se.length<=.5*we?1:Math.ceil(Se.paddedLength/ir)+1;for(let Dr=0;Dr<Tr;Dr++){const ai=Dr/Math.max(Tr-1,1),Ni=Se.lerp(ai),ti=Ni.x+tr,Yi=Ni.y+tr;ht.push(ti,Yi,we,0);const li=ti-we,Hi=Yi-we,hn=ti+we,gs=Yi+we;if(ye=ye&&this.isOffscreen(li,Hi,hn,gs),pe=pe||this.isInsideGrid(li,Hi,hn,gs),o!=="always"&&this.grid.hitTestCircle(ti,Yi,we,o,Z)&&(ie=!0,!G))return{circles:[],offscreen:!1,collisionDetected:ie}}}}return{circles:!G&&ie||!pe||pt<this.perspectiveRatioCutoff?[]:ht,offscreen:ye,collisionDetected:ie}}projectPathToScreenSpace(o,h,m){return o.map(y=>At(y.x,y.y,m,h.getElevation))}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let m=1/0,y=1/0,v=-1/0,E=-1/0;for(const G of o){const j=new a.P(G.x+tr,G.y+tr);m=Math.min(m,j.x),y=Math.min(y,j.y),v=Math.max(v,j.x),E=Math.max(E,j.y),h.push(j)}const P=this.grid.query(m,y,v,E).concat(this.ignoredGrid.query(m,y,v,E)),B={},D={};for(const G of P){const j=G.key;if(B[j.bucketInstanceId]===void 0&&(B[j.bucketInstanceId]={}),B[j.bucketInstanceId][j.featureIndex])continue;const Z=[new a.P(G.x1,G.y1),new a.P(G.x2,G.y1),new a.P(G.x2,G.y2),new a.P(G.x1,G.y2)];a.am(h,Z)&&(B[j.bucketInstanceId][j.featureIndex]=!0,D[j.bucketInstanceId]===void 0&&(D[j.bucketInstanceId]=[]),D[j.bucketInstanceId].push(j.featureIndex))}return D}insertCollisionBox(o,h,m,y,v,E){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:v,collisionGroupID:E,overlapMode:h},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,m,y,v,E){const P=m?this.ignoredGrid:this.grid,B={bucketInstanceId:y,featureIndex:v,collisionGroupID:E,overlapMode:h};for(let D=0;D<o.length;D+=4)P.insertCircle(B,o[D],o[D+1],o[D+2])}projectAndGetPerspectiveRatio(o,h,m,y,v){let E;v?(E=[h,m,v(h,m),1],a.af(E,E,o)):(E=[h,m,0,1],Br(E,E,o));const P=E[3];return{point:new a.P((E[0]/P+1)/2*this.transform.width+tr,(-E[1]/P+1)/2*this.transform.height+tr),perspectiveRatio:.5+this.transform.cameraToCenterDistance/P*.5,isOccluded:!1,signedDistanceFromCamera:P}}getPerspectiveRatio(o,h,m,y,v){const E=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(h,m,y,v):At(h,m,o,v);return .5+this.transform.cameraToCenterDistance/E.signedDistanceFromCamera*.5}isOffscreen(o,h,m,y){return m<tr||o>=this.screenRightBoundary||y<tr||h>this.screenBottomBoundary}isInsideGrid(o,h,m,y){return m>=0&&o<this.gridRightBoundary&&y>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=a.an([]);return a.J(o,o,[-100,-100,0]),o}_projectCollisionBox(o,h,m,y,v,E,P,B,D,G){let j=new a.P(1,0),Z=new a.P(0,1);const Y=new a.P(o.anchorPointX+P[0],o.anchorPointY+P[1]);if(E&&!v){const ye=this.projectAndGetPerspectiveRatio(m,Y.x+1,Y.y,y,D).point.sub(B.point).unit(),we=Math.atan(ye.y/ye.x)+(ye.x<0?Math.PI:0),ve=Math.sin(we),_e=Math.cos(we);j=new a.P(_e,ve),Z=new a.P(-ve,_e)}else if(!E&&v){const ye=-this.transform.angle,we=Math.sin(ye),ve=Math.cos(ye);j=new a.P(ve,we),Z=new a.P(-we,ve)}let X=B.point,tt=h;if(v){X=Y;const ye=this.transform.zoom-Math.floor(this.transform.zoom);tt=Math.pow(2,-ye),tt*=this.mapProjection.getPitchedTextCorrection(this.transform,Y,y),G||(tt*=a.ac(.5+B.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}G&&(X=X.add(j.mult(G.x*tt)).add(Z.mult(G.y*tt)));const ct=o.x1*tt,ht=o.x2*tt,gt=(ct+ht)/2,pt=o.y1*tt,St=o.y2*tt,Rt=(pt+St)/2,Bt=[{offsetX:ct,offsetY:pt},{offsetX:gt,offsetY:pt},{offsetX:ht,offsetY:pt},{offsetX:ht,offsetY:Rt},{offsetX:ht,offsetY:St},{offsetX:gt,offsetY:St},{offsetX:ct,offsetY:St},{offsetX:ct,offsetY:Rt}];let ie=[];for(const{offsetX:ye,offsetY:we}of Bt)ie.push(new a.P(X.x+j.x*ye+Z.x*we,X.y+j.y*ye+Z.y*we));let pe=!1;if(v){const ye=ie.map(we=>this.projectAndGetPerspectiveRatio(m,we.x,we.y,y,D));pe=ye.some(we=>!we.isOccluded),ie=ye.map(we=>we.point)}else pe=!0;return{box:a.ao(ie),allPointsOccluded:!pe}}}function Sr(g,o,h){return o*(a.X/(g.tileSize*Math.pow(2,h-g.tileID.overscaledZ)))}class oi{constructor(o,h,m,y){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):y&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Wr{constructor(o,h,m,y,v){this.text=new oi(o?o.text:null,h,m,v),this.icon=new oi(o?o.icon:null,h,y,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class dr{constructor(o,h,m){this.text=o,this.icon=h,this.skipFade=m}}class Nr{constructor(){this.invProjMatrix=a.H(),this.viewportMatrix=a.H(),this.circles=[]}}class ei{constructor(o,h,m,y,v){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=v}}class yi{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:m=>m.collisionGroupID===h}}return this.collisionGroups[o]}}function Pi(g,o,h,m,y){const{horizontalAlign:v,verticalAlign:E}=a.au(g);return new a.P(-(v-.5)*o+m[0]*y,-(E-.5)*h+m[1]*y)}class tn{constructor(o,h,m,y,v,E){this.transform=o.clone(),this.terrain=m,this.collisionIndex=new Ir(this.transform,h),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new yi(v),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(o){const h=this.terrain;return h?(m,y)=>h.getElevation(o,m,y):null}getBucketParts(o,h,m,y){const v=m.getBucket(h),E=m.latestFeatureIndex;if(!v||!E||h.id!==v.layerIds[0])return;const P=m.collisionBoxArray,B=v.layers[0].layout,D=v.layers[0].paint,G=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),j=m.tileSize/a.X,Z=m.tileID.toUnwrapped(),Y=this.transform.calculatePosMatrix(Z),X=B.get("text-pitch-alignment")==="map",tt=B.get("text-rotation-alignment")==="map",ct=Sr(m,1,this.transform.zoom),ht=this.collisionIndex.mapProjection.translatePosition(this.transform,m,D.get("text-translate"),D.get("text-translate-anchor")),gt=this.collisionIndex.mapProjection.translatePosition(this.transform,m,D.get("icon-translate"),D.get("icon-translate-anchor")),pt=on(Y,X,tt,this.transform,ct);let St=null;if(X){const Bt=an(Y,X,tt,this.transform,ct);St=a.L([],this.transform.labelPlaneMatrix,Bt)}this.retainedQueryData[v.bucketInstanceId]=new ei(v.bucketInstanceId,E,v.sourceLayerIndex,v.index,m.tileID);const Rt={bucket:v,layout:B,translationText:ht,translationIcon:gt,posMatrix:Y,unwrappedTileID:Z,textLabelPlaneMatrix:pt,labelToScreenMatrix:St,scale:G,textPixelRatio:j,holdingForFade:m.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:a.ag(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(y)for(const Bt of v.sortKeyRanges){const{sortKey:ie,symbolInstanceStart:pe,symbolInstanceEnd:ye}=Bt;o.push({sortKey:ie,symbolInstanceStart:pe,symbolInstanceEnd:ye,parameters:Rt})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Rt})}attemptAnchorPlacement(o,h,m,y,v,E,P,B,D,G,j,Z,Y,X,tt,ct,ht,gt,pt){const St=a.aq[o.textAnchor],Rt=[o.textOffset0,o.textOffset1],Bt=Pi(St,m,y,Rt,v),ie=this.collisionIndex.placeCollisionBox(h,Z,B,D,G,P,E,ct,j.predicate,pt,Bt);if((!gt||this.collisionIndex.placeCollisionBox(gt,Z,B,D,G,P,E,ht,j.predicate,pt,Bt).placeable)&&ie.placeable){let pe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID].text&&(pe=this.prevPlacement.variableOffsets[Y.crossTileID].anchor),Y.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Y.crossTileID]={textOffset:Rt,width:m,height:y,anchor:St,textBoxScale:v,prevAnchor:pe},this.markUsedJustification(X,St,Y,tt),X.allowVerticalPlacement&&(this.markUsedOrientation(X,tt,Y),this.placedOrientations[Y.crossTileID]=tt),{shift:Bt,placedGlyphBoxes:ie}}}placeLayerBucketPart(o,h,m){const{bucket:y,layout:v,translationText:E,translationIcon:P,posMatrix:B,unwrappedTileID:D,textLabelPlaneMatrix:G,labelToScreenMatrix:j,textPixelRatio:Z,holdingForFade:Y,collisionBoxArray:X,partiallyEvaluatedTextSize:tt,collisionGroup:ct}=o.parameters,ht=v.get("text-optional"),gt=v.get("icon-optional"),pt=a.ar(v,"text-overlap","text-allow-overlap"),St=pt==="always",Rt=a.ar(v,"icon-overlap","icon-allow-overlap"),Bt=Rt==="always",ie=v.get("text-rotation-alignment")==="map",pe=v.get("text-pitch-alignment")==="map",ye=v.get("icon-text-fit")!=="none",we=v.get("symbol-z-order")==="viewport-y",ve=St&&(Bt||!y.hasIconData()||gt),_e=Bt&&(St||!y.hasTextData()||ht);!y.collisionArrays&&X&&y.deserializeCollisionBoxes(X);const Se=this._getTerrainElevationFunc(this.retainedQueryData[y.bucketInstanceId].tileID),Ye=(Pe,Ie,ir)=>{var Ar,vr;if(h[Pe.crossTileID])return;if(Y)return void(this.placements[Pe.crossTileID]=new dr(!1,!1,!1));let Tr=!1,Dr=!1,ai=!0,Ni=null,ti={box:null,placeable:!1,offscreen:null},Yi={box:null,placeable:!1,offscreen:null},li=null,Hi=null,hn=null,gs=0,$s=0,Oi=0;Ie.textFeatureIndex?gs=Ie.textFeatureIndex:Pe.useRuntimeCollisionCircles&&(gs=Pe.featureIndex),Ie.verticalTextFeatureIndex&&($s=Ie.verticalTextFeatureIndex);const Sl=Ie.textBox;if(Sl){const Qn=en=>{let Vn=a.ah.horizontal;if(y.allowVerticalPlacement&&!en&&this.prevPlacement){const es=this.prevPlacement.placedOrientations[Pe.crossTileID];es&&(this.placedOrientations[Pe.crossTileID]=es,Vn=es,this.markUsedOrientation(y,Vn,Pe))}return Vn},ys=(en,Vn)=>{if(y.allowVerticalPlacement&&Pe.numVerticalGlyphVertices>0&&Ie.verticalTextBox){for(const es of y.writingModes)if(es===a.ah.vertical?(ti=Vn(),Yi=ti):ti=en(),ti&&ti.placeable)break}else ti=en()},Rn=Pe.textAnchorOffsetStartIndex,ts=Pe.textAnchorOffsetEndIndex;if(ts===Rn){const en=(Vn,es)=>{const $r=this.collisionIndex.placeCollisionBox(Vn,pt,Z,B,D,pe,ie,E,ct.predicate,Se);return $r&&$r.placeable&&(this.markUsedOrientation(y,es,Pe),this.placedOrientations[Pe.crossTileID]=es),$r};ys(()=>en(Sl,a.ah.horizontal),()=>{const Vn=Ie.verticalTextBox;return y.allowVerticalPlacement&&Pe.numVerticalGlyphVertices>0&&Vn?en(Vn,a.ah.vertical):{box:null,offscreen:null}}),Qn(ti&&ti.placeable)}else{let en=a.aq[(vr=(Ar=this.prevPlacement)===null||Ar===void 0?void 0:Ar.variableOffsets[Pe.crossTileID])===null||vr===void 0?void 0:vr.anchor];const Vn=($r,pa,Al)=>{const ja=$r.x2-$r.x1,Qc=$r.y2-$r.y1,Nm=Pe.textBoxScale,Wp=ye&&Rt==="never"?pa:null;let fa=null,Ua=pt==="never"?1:2,Fh="never";en&&Ua++;for(let Hu=0;Hu<Ua;Hu++){for(let Dh=Rn;Dh<ts;Dh++){const $u=y.textAnchorOffsets.get(Dh);if(en&&$u.textAnchor!==en)continue;const Ga=this.attemptAnchorPlacement($u,$r,ja,Qc,Nm,ie,pe,Z,B,D,ct,Fh,Pe,y,Al,E,P,Wp,Se);if(Ga&&(fa=Ga.placedGlyphBoxes,fa&&fa.placeable))return Tr=!0,Ni=Ga.shift,fa}en?en=null:Fh=pt}return m&&!fa&&(fa={box:this.collisionIndex.placeCollisionBox(Sl,"always",Z,B,D,pe,ie,E,ct.predicate,Se,new a.P(0,0)).box,offscreen:!1,placeable:!1}),fa};ys(()=>Vn(Sl,Ie.iconBox,a.ah.horizontal),()=>{const $r=Ie.verticalTextBox;return y.allowVerticalPlacement&&(!ti||!ti.placeable)&&Pe.numVerticalGlyphVertices>0&&$r?Vn($r,Ie.verticalIconBox,a.ah.vertical):{box:null,occluded:!0,offscreen:null}}),ti&&(Tr=ti.placeable,ai=ti.offscreen);const es=Qn(ti&&ti.placeable);if(!Tr&&this.prevPlacement){const $r=this.prevPlacement.variableOffsets[Pe.crossTileID];$r&&(this.variableOffsets[Pe.crossTileID]=$r,this.markUsedJustification(y,$r.anchor,Pe,es))}}}if(li=ti,Tr=li&&li.placeable,ai=li&&li.offscreen,Pe.useRuntimeCollisionCircles){const Qn=y.text.placedSymbolArray.get(Pe.centerJustifiedTextSymbolIndex),ys=a.ai(y.textSizeData,tt,Qn),Rn=v.get("text-padding");Hi=this.collisionIndex.placeCollisionCircles(pt,Qn,y.lineVertexArray,y.glyphOffsetArray,ys,B,D,G,j,m,pe,ct.predicate,Pe.collisionCircleDiameter,Rn,E,Se),Hi.circles.length&&Hi.collisionDetected&&!m&&a.w("Collisions detected, but collision boxes are not shown"),Tr=St||Hi.circles.length>0&&!Hi.collisionDetected,ai=ai&&Hi.offscreen}if(Ie.iconFeatureIndex&&(Oi=Ie.iconFeatureIndex),Ie.iconBox){const Qn=ys=>this.collisionIndex.placeCollisionBox(ys,Rt,Z,B,D,pe,ie,P,ct.predicate,Se,ye&&Ni?Ni:void 0);Yi&&Yi.placeable&&Ie.verticalIconBox?(hn=Qn(Ie.verticalIconBox),Dr=hn.placeable):(hn=Qn(Ie.iconBox),Dr=hn.placeable),ai=ai&&hn.offscreen}const Ws=ht||Pe.numHorizontalGlyphVertices===0&&Pe.numVerticalGlyphVertices===0,qu=gt||Pe.numIconVertices===0;Ws||qu?qu?Ws||(Dr=Dr&&Tr):Tr=Dr&&Tr:Dr=Tr=Dr&&Tr;const Kc=Dr&&hn.placeable;if(Tr&&li.placeable&&this.collisionIndex.insertCollisionBox(li.box,pt,v.get("text-ignore-placement"),y.bucketInstanceId,Yi&&Yi.placeable&&$s?$s:gs,ct.ID),Kc&&this.collisionIndex.insertCollisionBox(hn.box,Rt,v.get("icon-ignore-placement"),y.bucketInstanceId,Oi,ct.ID),Hi&&Tr&&this.collisionIndex.insertCollisionCircles(Hi.circles,pt,v.get("text-ignore-placement"),y.bucketInstanceId,gs,ct.ID),m&&this.storeCollisionData(y.bucketInstanceId,ir,Ie,li,hn,Hi),Pe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Pe.crossTileID]=new dr(Tr||ve,Dr||_e,ai||y.justReloaded),h[Pe.crossTileID]=!0};if(we){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Pe=y.getSortedSymbolIndexes(this.transform.angle);for(let Ie=Pe.length-1;Ie>=0;--Ie){const ir=Pe[Ie];Ye(y.symbolInstances.get(ir),y.collisionArrays[ir],ir)}}else for(let Pe=o.symbolInstanceStart;Pe<o.symbolInstanceEnd;Pe++)Ye(y.symbolInstances.get(Pe),y.collisionArrays[Pe],Pe);if(m&&y.bucketInstanceId in this.collisionCircleArrays){const Pe=this.collisionCircleArrays[y.bucketInstanceId];a.as(Pe.invProjMatrix,B),Pe.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}storeCollisionData(o,h,m,y,v,E){if(m.textBox||m.iconBox){let P,B;this.collisionBoxArrays.has(o)?P=this.collisionBoxArrays.get(o):(P=new Map,this.collisionBoxArrays.set(o,P)),P.has(h)?B=P.get(h):(B={text:null,icon:null},P.set(h,B)),m.textBox&&(B.text=y.box),m.iconBox&&(B.icon=v.box)}if(E){let P=this.collisionCircleArrays[o];P===void 0&&(P=this.collisionCircleArrays[o]=new Nr);for(let B=0;B<E.circles.length;B+=4)P.circles.push(E.circles[B+0]),P.circles.push(E.circles[B+1]),P.circles.push(E.circles[B+2]),P.circles.push(E.collisionDetected?1:0)}}markUsedJustification(o,h,m,y){let v;v=y===a.ah.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[a.at(h)];const E=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const P of E)P>=0&&(o.text.placedSymbolArray.get(P).crossTileID=v>=0&&P!==v?0:m.crossTileID)}markUsedOrientation(o,h,m){const y=h===a.ah.horizontal||h===a.ah.horizontalOnly?h:0,v=h===a.ah.vertical?h:0,E=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const P of E)o.text.placedSymbolArray.get(P).placedOrientation=y;m.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let m=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const y=h?h.symbolFadeChange(o):1,v=h?h.opacities:{},E=h?h.variableOffsets:{},P=h?h.placedOrientations:{};for(const B in this.placements){const D=this.placements[B],G=v[B];G?(this.opacities[B]=new Wr(G,y,D.text,D.icon),m=m||D.text!==G.text.placed||D.icon!==G.icon.placed):(this.opacities[B]=new Wr(null,y,D.text,D.icon,D.skipFade),m=m||D.text||D.icon)}for(const B in v){const D=v[B];if(!this.opacities[B]){const G=new Wr(D,y,!1,!1);G.isHidden()||(this.opacities[B]=G,m=m||D.text.placed||D.icon.placed)}}for(const B in E)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=E[B]);for(const B in P)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=P[B]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h){const m={};for(const y of h){const v=y.getBucket(o);v&&y.latestFeatureIndex&&o.id===v.layerIds[0]&&this.updateBucketOpacities(v,y.tileID,m,y.collisionBoxArray)}}updateBucketOpacities(o,h,m,y){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const v=o.layers[0],E=v.layout,P=new Wr(null,0,!1,!1,!0),B=E.get("text-allow-overlap"),D=E.get("icon-allow-overlap"),G=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),j=E.get("text-rotation-alignment")==="map",Z=E.get("text-pitch-alignment")==="map",Y=E.get("icon-text-fit")!=="none",X=new Wr(null,0,B&&(D||!o.hasIconData()||E.get("icon-optional")),D&&(B||!o.hasTextData()||E.get("text-optional")),!0);!o.collisionArrays&&y&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(y);const tt=(ht,gt,pt)=>{for(let St=0;St<gt/4;St++)ht.opacityVertexArray.emplaceBack(pt);ht.hasVisibleVertices=ht.hasVisibleVertices||pt!==Ro},ct=this.collisionBoxArrays.get(o.bucketInstanceId);for(let ht=0;ht<o.symbolInstances.length;ht++){const gt=o.symbolInstances.get(ht),{numHorizontalGlyphVertices:pt,numVerticalGlyphVertices:St,crossTileID:Rt}=gt;let Bt=this.opacities[Rt];m[Rt]?Bt=P:Bt||(Bt=X,this.opacities[Rt]=Bt),m[Rt]=!0;const ie=gt.numIconVertices>0,pe=this.placedOrientations[gt.crossTileID],ye=pe===a.ah.vertical,we=pe===a.ah.horizontal||pe===a.ah.horizontalOnly;if(pt>0||St>0){const _e=Ii(Bt.text);tt(o.text,pt,ye?Ro:_e),tt(o.text,St,we?Ro:_e);const Se=Bt.text.isHidden();[gt.rightJustifiedTextSymbolIndex,gt.centerJustifiedTextSymbolIndex,gt.leftJustifiedTextSymbolIndex].forEach(Ie=>{Ie>=0&&(o.text.placedSymbolArray.get(Ie).hidden=Se||ye?1:0)}),gt.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(gt.verticalPlacedTextSymbolIndex).hidden=Se||we?1:0);const Ye=this.variableOffsets[gt.crossTileID];Ye&&this.markUsedJustification(o,Ye.anchor,gt,pe);const Pe=this.placedOrientations[gt.crossTileID];Pe&&(this.markUsedJustification(o,"left",gt,Pe),this.markUsedOrientation(o,Pe,gt))}if(ie){const _e=Ii(Bt.icon),Se=!(Y&&gt.verticalPlacedIconSymbolIndex&&ye);gt.placedIconSymbolIndex>=0&&(tt(o.icon,gt.numIconVertices,Se?_e:Ro),o.icon.placedSymbolArray.get(gt.placedIconSymbolIndex).hidden=Bt.icon.isHidden()),gt.verticalPlacedIconSymbolIndex>=0&&(tt(o.icon,gt.numVerticalIconVertices,Se?Ro:_e),o.icon.placedSymbolArray.get(gt.verticalPlacedIconSymbolIndex).hidden=Bt.icon.isHidden())}const ve=ct&&ct.has(ht)?ct.get(ht):{text:null,icon:null};if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const _e=o.collisionArrays[ht];if(_e){let Se=new a.P(0,0);if(_e.textBox||_e.verticalTextBox){let Ye=!0;if(G){const Pe=this.variableOffsets[Rt];Pe?(Se=Pi(Pe.anchor,Pe.width,Pe.height,Pe.textOffset,Pe.textBoxScale),j&&Se._rotate(Z?this.transform.angle:-this.transform.angle)):Ye=!1}if(_e.textBox||_e.verticalTextBox){let Pe;_e.textBox&&(Pe=ye),_e.verticalTextBox&&(Pe=we),Bo(o.textCollisionBox.collisionVertexArray,Bt.text.placed,!Ye||Pe,ve.text,Se.x,Se.y)}}if(_e.iconBox||_e.verticalIconBox){const Ye=!!(!we&&_e.verticalIconBox);let Pe;_e.iconBox&&(Pe=Ye),_e.verticalIconBox&&(Pe=!Ye),Bo(o.iconCollisionBox.collisionVertexArray,Bt.icon.placed,Pe,ve.icon,Y?Se.x:0,Y?Se.y:0)}}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const ht=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ht.invProjMatrix,o.placementViewportMatrix=ht.viewportMatrix,o.collisionCircleArray=ht.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const m=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*m>o}setStale(){this.stale=!0}}function Bo(g,o,h,m,y,v){m&&m.length!==0||(m=[0,0,0,0]);const E=m[0]-tr,P=m[1]-tr,B=m[2]-tr,D=m[3]-tr;g.emplaceBack(o?1:0,h?1:0,y||0,v||0,E,P),g.emplaceBack(o?1:0,h?1:0,y||0,v||0,B,P),g.emplaceBack(o?1:0,h?1:0,y||0,v||0,B,D),g.emplaceBack(o?1:0,h?1:0,y||0,v||0,E,D)}const Jr=Math.pow(2,25),Ln=Math.pow(2,24),ls=Math.pow(2,17),ki=Math.pow(2,16),Ri=Math.pow(2,9),ko=Math.pow(2,8),Fi=Math.pow(2,1);function Ii(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const o=g.placed?1:0,h=Math.floor(127*g.opacity);return h*Jr+o*Ln+h*ls+o*ki+h*Ri+o*ko+h*Fi+o}const Ro=0;function cs(){return{isOccluded:(g,o,h)=>!1,getPitchedTextCorrection:(g,o,h)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(g,o,h,m){throw new Error("Not implemented.")},translatePosition:(g,o,h,m)=>function(y,v,E,P){let B=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(!E[0]&&!E[1])return[0,0];const D=B?P==="map"?y.angle:0:P==="viewport"?-y.angle:0;if(D){const G=Math.sin(D),j=Math.cos(D);E=[E[0]*j-E[1]*G,E[0]*G+E[1]*j]}return[B?E[0]:Sr(v,E[0],y.zoom),B?E[1]:Sr(v,E[1],y.zoom)]}(g,o,h,m),getCircleRadiusCorrection:g=>1}}class xi{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,h,m,y,v){const E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(E,y,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((P,B)=>P.sortKey-B.sortKey));this._currentPartIndex<E.length;)if(h.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,v())return!0;return!1}}class Kr{constructor(o,h,m,y,v,E,P,B){this.placement=new tn(o,cs(),h,E,P,B),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(o,h,m){const y=S.now(),v=()=>!this._forceFullPlacement&&S.now()-y>2;for(;this._currentPlacementIndex>=0;){const E=h[o[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=P)&&(!E.maxzoom||E.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new xi(E)),this._inProgressLayer.continuePlacement(m[E.source],this.placement,this._showCollisionBoxes,E,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const bn=512/a.X/2;class _i{constructor(o,h,m){this.tileID=o,this.bucketInstanceId=m,this._symbolsByKey={};const y=new Map;for(let v=0;v<h.length;v++){const E=h.get(v),P=E.key,B=y.get(P);B?B.push(E):y.set(P,[E])}for(const[v,E]of y){const P={positions:E.map(B=>({x:Math.floor(B.anchorX*bn),y:Math.floor(B.anchorY*bn)})),crossTileIDs:E.map(B=>B.crossTileID)};if(P.positions.length>128){const B=new a.av(P.positions.length,16,Uint16Array);for(const{x:D,y:G}of P.positions)B.add(D,G);B.finish(),delete P.positions,P.index=B}this._symbolsByKey[v]=P}}getScaledCoordinates(o,h){const{x:m,y,z:v}=this.tileID.canonical,{x:E,y:P,z:B}=h.canonical,D=bn/Math.pow(2,B-v),G=(P*a.X+o.anchorY)*D,j=y*a.X*bn;return{x:Math.floor((E*a.X+o.anchorX)*D-m*a.X*bn),y:Math.floor(G-j)}}findMatches(o,h,m){const y=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let v=0;v<o.length;v++){const E=o.get(v);if(E.crossTileID)continue;const P=this._symbolsByKey[E.key];if(!P)continue;const B=this.getScaledCoordinates(E,h);if(P.index){const D=P.index.range(B.x-y,B.y-y,B.x+y,B.y+y).sort();for(const G of D){const j=P.crossTileIDs[G];if(!m[j]){m[j]=!0,E.crossTileID=j;break}}}else if(P.positions)for(let D=0;D<P.positions.length;D++){const G=P.positions[D],j=P.crossTileIDs[D];if(Math.abs(G.x-B.x)<=y&&Math.abs(G.y-B.y)<=y&&!m[j]){m[j]=!0,E.crossTileID=j;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(o=>{let{crossTileIDs:h}=o;return h})}}class Fo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class wn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(h!==0)for(const m in this.indexes){const y=this.indexes[m],v={};for(const E in y){const P=y[E];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),v[P.tileID.key]=P}this.indexes[m]=v}this.lng=o}addBucket(o,h,m){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let v=0;v<h.symbolInstances.length;v++)h.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const y=this.usedCrossTileIDs[o.overscaledZ];for(const v in this.indexes){const E=this.indexes[v];if(Number(v)>o.overscaledZ)for(const P in E){const B=E[P];B.tileID.isChildOf(o)&&B.findMatches(h.symbolInstances,o,y)}else{const P=E[o.scaledTo(Number(v)).key];P&&P.findMatches(h.symbolInstances,o,y)}}for(let v=0;v<h.symbolInstances.length;v++){const E=h.symbolInstances.get(v);E.crossTileID||(E.crossTileID=m.generate(),y[E.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new _i(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const m of h.getCrossTileIDsLists())for(const y of m)delete this.usedCrossTileIDs[o][y]}removeStaleBuckets(o){let h=!1;for(const m in this.indexes){const y=this.indexes[m];for(const v in y)o[y[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[v]),delete y[v],h=!0)}return h}}class La{constructor(){this.layerIndexes={},this.crossTileIDs=new Fo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,m){let y=this.layerIndexes[o.id];y===void 0&&(y=this.layerIndexes[o.id]=new wn);let v=!1;const E={};y.handleWrapJump(m);for(const P of h){const B=P.getBucket(o);B&&o.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(P.tileID,B,this.crossTileIDs)&&(v=!0),E[B.bucketInstanceId]=!0)}return y.removeStaleBuckets(E)&&(v=!0),v}pruneUnusedLayers(o){const h={};o.forEach(m=>{h[m]=!0});for(const m in this.layerIndexes)h[m]||delete this.layerIndexes[m]}}const Li=(g,o)=>a.t(g,o&&o.filter(h=>h.identifier!=="source.canvas")),us=a.aw();class xn extends a.E{constructor(o){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlPluginLoaded=()=>{for(const m in this.sourceCaches){const y=this.sourceCaches[m].getSource().type;y!=="vector"&&y!=="geojson"||this.sourceCaches[m].reload()}},this.map=o,this.dispatcher=new Ee(Kt(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",(m,y)=>this.getGlyphs(m,y)),this.dispatcher.registerMessageHandler("GI",(m,y)=>this.getImages(m,y)),this.imageManager=new It,this.imageManager.setEventedParent(this),this.glyphManager=new se(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Et(256,512),this.crossTileSymbolIndex=new La,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ay()),Fe().on(me,this._rtlPluginLoaded),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const y=this.sourceCaches[m.sourceId];if(!y)return;const v=y.getSource();if(v&&v.vectorLayerIds)for(const E in this._layers){const P=this._layers[E];P.source===v.id&&this._validateLayer(P)}})}loadURL(o){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;this.fire(new a.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const y=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController;const v=this._loadStyleRequest;a.h(y,this._loadStyleRequest).then(E=>{this._loadStyleRequest=null,this._load(E.data,h,m)}).catch(E=>{this._loadStyleRequest=null,E&&!v.signal.aborted&&this.fire(new a.j(E))})}loadJSON(o){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(o,h,m)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(us,{validate:!1})}_load(o,h,m){var y;const v=h.transformStyle?h.transformStyle(m,o):o;if(!h.validate||!Li(this,a.u(v))){this._loaded=!0,this.stylesheet=v;for(const E in v.sources)this.addSource(E,v.sources[E],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new Wt(this.stylesheet.light),this.sky=new it(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const o=a.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",o),this._order=o.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of o){const m=a.aA(h);m.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=m}}_loadSprite(o){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,y;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(v,E,P,B){return a._(this,void 0,void 0,function*(){const D=Dt(v),G=P>1?"@2x":"",j={},Z={};for(const{id:Y,url:X}of D){const tt=E.transformRequest(kt(X,G,".json"),"SpriteJSON");j[Y]=a.h(tt,B);const ct=E.transformRequest(kt(X,G,".png"),"SpriteImage");Z[Y]=H.getImage(ct,B)}return yield Promise.all([...Object.values(j),...Object.values(Z)]),function(Y,X){return a._(this,void 0,void 0,function*(){const tt={};for(const ct in Y){tt[ct]={};const ht=S.getImageCanvasContext((yield X[ct]).data),gt=(yield Y[ct]).data;for(const pt in gt){const{width:St,height:Rt,x:Bt,y:ie,sdf:pe,pixelRatio:ye,stretchX:we,stretchY:ve,content:_e,textFitWidth:Se,textFitHeight:Ye}=gt[pt];tt[ct][pt]={data:null,pixelRatio:ye,sdf:pe,stretchX:we,stretchY:ve,content:_e,textFitWidth:Se,textFitHeight:Ye,spriteData:{width:St,height:Rt,x:Bt,y:ie,context:ht}}}}return tt})}(j,Z)})}(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(v=>{if(this._spriteRequest=null,v)for(const E in v){this._spritesImagesIds[E]=[];const P=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(B=>!(B in v)):[];for(const B of P)this.imageManager.removeImage(B),this._changedImages[B]=!0;for(const B in v[E]){const D=E==="default"?B:`${E}:${B}`;this._spritesImagesIds[E].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,v[E][B],!1):this.imageManager.addImage(D,v[E][B]),h&&(this._changedImages[D]=!0)}}}).catch(v=>{this._spriteRequest=null,y=v,this.fire(new a.j(y))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),m&&m(y)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(o){const h=this.sourceCaches[o.source];if(!h)return;const m=o.sourceLayer;if(!m)return;const y=h.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(m)===-1)&&this.fire(new a.j(new Error(`Source layer "${m}" does not exist on source "${y.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const m=this._serializedAllLayers();if(!o||o.length===0)return Object.values(h?a.aB(m):m);const y=[];for(const v of o)if(m[v]){const E=h?a.aB(m[v]):m[v];y.push(E)}return y}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const h=Object.keys(this._layers);for(const m of h){const y=this._layers[m];y.type!=="custom"&&(o[m]=y.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const h=this._changed;if(h){const y=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(y.length||v.length)&&this._updateWorkerLayers(y,v);for(const E in this._updatedSources){const P=this._updatedSources[E];if(P==="reload")this._reloadSource(E);else{if(P!=="clear")throw new Error(`Invalid action ${P}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(o);this.light.updateTransitions(o),this.sky.updateTransitions(o),this._resetUpdates()}const m={};for(const y in this.sourceCaches){const v=this.sourceCaches[y];m[y]=v.used,v.used=!1}for(const y of this._order){const v=this._layers[y];v.recalculate(o,this._availableImages),!v.isHidden(o.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const y in m){const v=this.sourceCaches[y];!!m[y]!=!!v.used&&v.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(o),this.sky.recalculate(o),this.z=o.zoom,h&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var m;this._checkLoaded();const y=this.serialize();if(o=h.transformStyle?h.transformStyle(y,o):o,((m=h.validate)===null||m===void 0||m)&&Li(this,a.u(o)))return!1;(o=a.aB(o)).layers=a.az(o.layers);const v=a.aC(y,o),E=this._getOperationsToPerform(v);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(const P of E.operations)P();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const h=[],m=[];for(const y of o)switch(y.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,y.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,y.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,y.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,y.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,y.args));break;case"addSource":h.push(()=>this.addSource.apply(this,y.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,y.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,y.args));break;case"setLight":h.push(()=>this.setLight.apply(this,y.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,y.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,y.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,y.args));break;case"setSky":h.push(()=>this.setSky.apply(this,y.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,y.args));break;case"setTransition":h.push(()=>{});break;default:m.push(y.command)}return{operations:h,unimplemented:m}}addImage(o,h){if(this.getImage(o))return this.fire(new a.j(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,h),this._afterImageUpdated(o)}updateImage(o,h){this.imageManager.updateImage(o,h)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new a.j(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.u.source,`sources.${o}`,h,null,m))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const y=this.sourceCaches[o]=new Ge(o,h,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:o})),y.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===o)return this.fire(new a.j(new Error(`Source "${o}" cannot be removed while layer "${m}" is using it.`)));const h=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],h.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,h){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const m=this.sourceCaches[o].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(h),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const y=o.id;if(this.getLayer(y))return void this.fire(new a.j(new Error(`Layer "${y}" already exists on this map.`)));let v;if(o.type==="custom"){if(Li(this,a.aD(o)))return;v=a.aA(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(y,o.source),o=a.aB(o),o=a.e(o,{source:y})),this._validate(a.u.layer,`layers.${y}`,o,{arrayIndex:-1},m))return;v=a.aA(o),this._validateLayer(v),v.setEventedParent(this,{layer:{id:y}})}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)this.fire(new a.j(new Error(`Cannot add layer "${y}" before non-existing layer "${h}".`)));else{if(this._order.splice(E,0,y),this._layerOrderChanged=!0,this._layers[y]=v,this._removedLayers[y]&&v.source&&v.type!=="custom"){const P=this._removedLayers[y];delete this._removedLayers[y],P.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(o,h){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new a.j(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===h)return;const m=this._order.indexOf(o);this._order.splice(m,1);const y=h?this._order.indexOf(h):this._order.length;h&&y===-1?this.fire(new a.j(new Error(`Cannot move layer "${o}" before non-existing layer "${h}".`))):(this._order.splice(y,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const h=this._layers[o];if(!h)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${o}".`)));h.setEventedParent(null);const m=this._order.indexOf(o);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,h,m){this._checkLoaded();const y=this.getLayer(o);y?y.minzoom===h&&y.maxzoom===m||(h!=null&&(y.minzoom=h),m!=null&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const y=this.getLayer(o);if(y){if(!a.aE(y.filter,h))return h==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(a.u.filter,`layers.${y.id}.filter`,h,null,m)||(y.filter=a.aB(h),this._updateLayer(y)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return a.aB(this.getLayer(o).filter)}setLayoutProperty(o,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const v=this.getLayer(o);v?a.aE(v.getLayoutProperty(h),m)||(v.setLayoutProperty(h,m,y),this._updateLayer(v)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,h){const m=this.getLayer(o);if(m)return m.getLayoutProperty(h);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const v=this.getLayer(o);v?a.aE(v.getPaintProperty(h),m)||(v.setPaintProperty(h,m,y)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[o]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,h){return this.getLayer(o).getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();const m=o.source,y=o.sourceLayer,v=this.sourceCaches[m];if(v===void 0)return void this.fire(new a.j(new Error(`The source '${m}' does not exist in the map's style.`)));const E=v.getSource().type;E==="geojson"&&y?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||y?(o.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),v.setFeatureState(y,o.id,h)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,h){this._checkLoaded();const m=o.source,y=this.sourceCaches[m];if(y===void 0)return void this.fire(new a.j(new Error(`The source '${m}' does not exist in the map's style.`)));const v=y.getSource().type,E=v==="vector"?o.sourceLayer:void 0;v!=="vector"||E?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(E,o.id,h):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const h=o.source,m=o.sourceLayer,y=this.sourceCaches[h];if(y!==void 0)return y.getSource().type!=="vector"||m?(o.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),y.getFeatureState(m,o.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=a.aF(this.sourceCaches,v=>v.serialize()),h=this._serializeByIds(this._order,!0),m=this.map.getTerrain()||void 0,y=this.stylesheet;return a.aG({version:y.version,name:y.name,metadata:y.metadata,light:y.light,sky:y.sky,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,sources:o,layers:h,terrain:m},v=>v!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const h=E=>this._layers[E].type==="fill-extrusion",m={},y=[];for(let E=this._order.length-1;E>=0;E--){const P=this._order[E];if(h(P)){m[P]=E;for(const B of o){const D=B[P];if(D)for(const G of D)y.push(G)}}}y.sort((E,P)=>P.intersectionZ-E.intersectionZ);const v=[];for(let E=this._order.length-1;E>=0;E--){const P=this._order[E];if(h(P))for(let B=y.length-1;B>=0;B--){const D=y[B].feature;if(m[D.layer.id]<E)break;v.push(D),y.pop()}else for(const B of o){const D=B[P];if(D)for(const G of D)v.push(G.feature)}}return v}queryRenderedFeatures(o,h,m){h&&h.filter&&this._validate(a.u.filter,"queryRenderedFeatures.filter",h.filter,null,h);const y={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const P of h.layers){const B=this._layers[P];if(!B)return this.fire(new a.j(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];y[B.source]=!0}}const v=[];h.availableImages=this._availableImages;const E=this._serializedAllLayers();for(const P in this.sourceCaches)h.layers&&!y[P]||v.push(ze(this.sourceCaches[P],this._layers,E,o,h,m));return this.placement&&v.push(function(P,B,D,G,j,Z,Y){const X={},tt=Z.queryRenderedSymbols(G),ct=[];for(const ht of Object.keys(tt).map(Number))ct.push(Y[ht]);ct.sort(or);for(const ht of ct){const gt=ht.featureIndex.lookupSymbolFeatures(tt[ht.bucketInstanceId],B,ht.bucketIndex,ht.sourceLayerIndex,j.filter,j.layers,j.availableImages,P);for(const pt in gt){const St=X[pt]=X[pt]||[],Rt=gt[pt];Rt.sort((Bt,ie)=>{const pe=ht.featureSortOrder;if(pe){const ye=pe.indexOf(Bt.featureIndex);return pe.indexOf(ie.featureIndex)-ye}return ie.featureIndex-Bt.featureIndex});for(const Bt of Rt)St.push(Bt)}}for(const ht in X)X[ht].forEach(gt=>{const pt=gt.feature,St=D[P[ht].source].getFeatureState(pt.layer["source-layer"],pt.id);pt.source=pt.layer.source,pt.layer["source-layer"]&&(pt.sourceLayer=pt.layer["source-layer"]),pt.state=St});return X}(this._layers,E,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(o,h){h&&h.filter&&this._validate(a.u.filter,"querySourceFeatures.filter",h.filter,null,h);const m=this.sourceCaches[o];return m?function(y,v){const E=y.getRenderableIds().map(D=>y.getTileByID(D)),P=[],B={};for(let D=0;D<E.length;D++){const G=E[D],j=G.tileID.canonical.key;B[j]||(B[j]=!0,G.querySourceFeatures(P,v))}return P}(m,h):[]}getLight(){return this.light.getLight()}setLight(o){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const m=this.light.getLight();let y=!1;for(const E in o)if(!a.aE(o[E],m[E])){y=!0;break}if(!y)return;const v={now:S.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(v)}getSky(){var o;return(o=this.stylesheet)===null||o===void 0?void 0:o.sky}setSky(o){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const m=this.getSky();let y=!1;if(!o&&!m)return;if(o&&!m)y=!0;else if(!o&&m)y=!0;else for(const E in o)if(!a.aE(o[E],m[E])){y=!0;break}if(!y)return;const v={now:S.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=o,this.sky.setSky(o,h),this.sky.updateTransitions(v)}_validate(o,h,m,y){let v=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!v||v.validate!==!1)&&Li(this,o.call(a.u,a.e({key:h,style:this.serialize(),value:m,styleSpec:a.v},y)))}_remove(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Fe().off(me,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const m=this.sourceCaches[h];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const h in this.sourceCaches)this.sourceCaches[h].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,h,m,y){let v=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,E=!1,P=!1;const B={};for(const D of this._order){const G=this._layers[D];if(G.type!=="symbol")continue;if(!B[G.source]){const Z=this.sourceCaches[G.source];B[G.source]=Z.getRenderableIds(!0).map(Y=>Z.getTileByID(Y)).sort((Y,X)=>X.tileID.overscaledZ-Y.tileID.overscaledZ||(Y.tileID.isLessThan(X.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(G,B[G.source],o.center.lng);E=E||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(S.now(),o.zoom))&&(this.pauseablePlacement=new Kr(o,this.map.terrain,this._order,v,h,m,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(S.now()),P=!0),E&&this.pauseablePlacement.placement.setStale()),P||E)for(const D of this._order){const G=this._layers[D];G.type==="symbol"&&this.placement.updateLayerOpacities(G,B[G.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(S.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,h){return a._(this,void 0,void 0,function*(){const m=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const y=this.sourceCaches[h.source];return y&&y.setDependencies(h.tileID.key,h.type,h.icons),m})}getGlyphs(o,h){return a._(this,void 0,void 0,function*(){const m=yield this.glyphManager.getGlyphs(h.stacks),y=this.sourceCaches[h.source];return y&&y.setDependencies(h.tileID.key,h.type,[""]),m})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),o&&this._validate(a.u.glyphs,"glyphs",o,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},y=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const v=[{id:o,url:h}],E=[...Dt(this.stylesheet.sprite),...v];this._validate(a.u.sprite,"sprite",E,null,m)||(this.stylesheet.sprite=E,this._loadSprite(v,!0,y))}removeSprite(o){this._checkLoaded();const h=Dt(this.stylesheet.sprite);if(h.find(m=>m.id===o)){if(this._spritesImagesIds[o])for(const m of this._spritesImagesIds[o])this.imageManager.removeImage(m),this._changedImages[m]=!0;h.splice(h.findIndex(m=>m.id===o),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return Dt(this.stylesheet.sprite)}setSprite(o){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),o&&this._validate(a.u.sprite,"sprite",o,null,h)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,m):(this._unloadSprite(),m&&m(null)))}}var As=a.Y([{name:"a_pos",type:"Int16",components:2}]);const hs={prelude:Xr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Xr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Xr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Xr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Xr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Xr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Xr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Xr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Xr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Xr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Xr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Xr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Xr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Xr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Xr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Xr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Xr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Xr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Xr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Xr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Xr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Xr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Xr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Xr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Xr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Xr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Xr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Xr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Xr(g,o){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=o.match(/attribute ([\w]+) ([\w]+)/g),y=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=v?v.concat(y):y,P={};return{fragmentSource:g=g.replace(h,(B,D,G,j,Z)=>(P[Z]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
varying ${G} ${j} ${Z};
#else
uniform ${G} ${j} u_${Z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Z}
    ${G} ${j} ${Z} = u_${Z};
#endif
`)),vertexSource:o=o.replace(h,(B,D,G,j,Z)=>{const Y=j==="float"?"vec2":"vec4",X=Z.match(/color/)?"color":Y;return P[Z]?D==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
attribute ${G} ${Y} a_${Z};
varying ${G} ${j} ${Z};
#else
uniform ${G} ${j} u_${Z};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = a_${Z};
#else
    ${G} ${j} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = unpack_mix_${X}(a_${Z}, u_${Z}_t);
#else
    ${G} ${j} ${Z} = u_${Z};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
attribute ${G} ${Y} a_${Z};
#else
uniform ${G} ${j} u_${Z};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${G} ${j} ${Z} = a_${Z};
#else
    ${G} ${j} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${G} ${j} ${Z} = unpack_mix_${X}(a_${Z}, u_${Z}_t);
#else
    ${G} ${j} ${Z} = u_${Z};
#endif
`}),staticAttributes:m,staticUniforms:E}}class hl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,h,m,y,v,E,P,B,D){this.context=o;let G=this.boundPaintVertexBuffers.length!==y.length;for(let j=0;!G&&j<y.length;j++)this.boundPaintVertexBuffers[j]!==y[j]&&(G=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==m||G||this.boundIndexBuffer!==v||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==P||this.boundDynamicVertexBuffer2!==B||this.boundDynamicVertexBuffer3!==D?this.freshBind(h,m,y,v,E,P,B,D):(o.bindVertexArray.set(this.vao),P&&P.bind(),v&&v.dynamicDraw&&v.bind(),B&&B.bind(),D&&D.bind())}freshBind(o,h,m,y,v,E,P,B){const D=o.numAttributes,G=this.context,j=G.gl;this.vao&&this.destroy(),this.vao=G.createVertexArray(),G.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=P,this.boundDynamicVertexBuffer3=B,h.enableAttributes(j,o);for(const Z of m)Z.enableAttributes(j,o);E&&E.enableAttributes(j,o),P&&P.enableAttributes(j,o),B&&B.enableAttributes(j,o),h.bind(),h.setVertexAttribPointers(j,o,v);for(const Z of m)Z.bind(),Z.setVertexAttribPointers(j,o,v);E&&(E.bind(),E.setVertexAttribPointers(j,o,v)),y&&y.bind(),P&&(P.bind(),P.setVertexAttribPointers(j,o,v)),B&&(B.bind(),B.setVertexAttribPointers(j,o,v)),G.currentNumAttributes=D}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ql=(g,o,h,m,y)=>({u_matrix:g,u_texture:0,u_ele_delta:o,u_fog_matrix:h,u_fog_color:m?m.properties.get("fog-color"):a.aM.white,u_fog_ground_blend:m?m.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:m?m.calculateFogBlendOpacity(y):0,u_horizon_color:m?m.properties.get("horizon-color"):a.aM.white,u_horizon_fog_blend:m?m.properties.get("horizon-fog-blend"):1});function ot(g){const o=[];for(let h=0;h<g.length;h++){if(g[h]===null)continue;const m=g[h].split(" ");o.push(m.pop())}return o}class _t{constructor(o,h,m,y,v,E){const P=o.gl;this.program=P.createProgram();const B=ot(h.staticAttributes),D=m?m.getBinderAttributes():[],G=B.concat(D),j=hs.prelude.staticUniforms?ot(hs.prelude.staticUniforms):[],Z=h.staticUniforms?ot(h.staticUniforms):[],Y=m?m.getBinderUniforms():[],X=j.concat(Z).concat(Y),tt=[];for(const Bt of X)tt.indexOf(Bt)<0&&tt.push(Bt);const ct=m?m.defines():[];v&&ct.push("#define OVERDRAW_INSPECTOR;"),E&&ct.push("#define TERRAIN3D;");const ht=ct.concat(hs.prelude.fragmentSource,h.fragmentSource).join(`
`),gt=ct.concat(hs.prelude.vertexSource,h.vertexSource).join(`
`),pt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(pt,ht),P.compileShader(pt),!P.getShaderParameter(pt,P.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${P.getShaderInfoLog(pt)}`);P.attachShader(this.program,pt);const St=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(St,gt),P.compileShader(St),!P.getShaderParameter(St,P.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${P.getShaderInfoLog(St)}`);P.attachShader(this.program,St),this.attributes={};const Rt={};this.numAttributes=G.length;for(let Bt=0;Bt<this.numAttributes;Bt++)G[Bt]&&(P.bindAttribLocation(this.program,Bt,G[Bt]),this.attributes[G[Bt]]=Bt);if(P.linkProgram(this.program),!P.getProgramParameter(this.program,P.LINK_STATUS))throw new Error(`Program failed to link: ${P.getProgramInfoLog(this.program)}`);P.deleteShader(St),P.deleteShader(pt);for(let Bt=0;Bt<tt.length;Bt++){const ie=tt[Bt];if(ie&&!Rt[ie]){const pe=P.getUniformLocation(this.program,ie);pe&&(Rt[ie]=pe)}}this.fixedUniforms=y(o,Rt),this.terrainUniforms=((Bt,ie)=>({u_depth:new a.aH(Bt,ie.u_depth),u_terrain:new a.aH(Bt,ie.u_terrain),u_terrain_dim:new a.aI(Bt,ie.u_terrain_dim),u_terrain_matrix:new a.aJ(Bt,ie.u_terrain_matrix),u_terrain_unpack:new a.aK(Bt,ie.u_terrain_unpack),u_terrain_exaggeration:new a.aI(Bt,ie.u_terrain_exaggeration)}))(o,Rt),this.binderUniforms=m?m.getUniforms(o,Rt):[]}draw(o,h,m,y,v,E,P,B,D,G,j,Z,Y,X,tt,ct,ht,gt){const pt=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(m),o.setStencilMode(y),o.setColorMode(v),o.setCullFace(E),B){o.activeTexture.set(pt.TEXTURE2),pt.bindTexture(pt.TEXTURE_2D,B.depthTexture),o.activeTexture.set(pt.TEXTURE3),pt.bindTexture(pt.TEXTURE_2D,B.texture);for(const Rt in this.terrainUniforms)this.terrainUniforms[Rt].set(B[Rt])}for(const Rt in this.fixedUniforms)this.fixedUniforms[Rt].set(P[Rt]);tt&&tt.setUniforms(o,this.binderUniforms,Y,{zoom:X});let St=0;switch(h){case pt.LINES:St=2;break;case pt.TRIANGLES:St=3;break;case pt.LINE_STRIP:St=1}for(const Rt of Z.get()){const Bt=Rt.vaos||(Rt.vaos={});(Bt[D]||(Bt[D]=new hl)).bind(o,this,G,tt?tt.getPaintVertexBuffers():[],j,Rt.vertexOffset,ct,ht,gt),pt.drawElements(h,Rt.primitiveLength*St,pt.UNSIGNED_SHORT,Rt.primitiveOffset*St*2)}}}function zt(g,o,h){const m=1/Sr(h,1,o.transform.tileZoom),y=Math.pow(2,h.tileID.overscaledZ),v=h.tileSize*Math.pow(2,o.transform.tileZoom)/y,E=v*(h.tileID.canonical.x+h.tileID.wrap*y),P=v*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[m,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[E>>16,P>>16],u_pixel_coord_lower:[65535&E,65535&P]}}const oe=(g,o,h,m)=>{const y=o.style.light,v=y.properties.get("position"),E=[v.x,v.y,v.z],P=function(){var D=new a.A(9);return a.A!=Float32Array&&(D[1]=0,D[2]=0,D[3]=0,D[5]=0,D[6]=0,D[7]=0),D[0]=1,D[4]=1,D[8]=1,D}();y.properties.get("anchor")==="viewport"&&function(D,G){var j=Math.sin(G),Z=Math.cos(G);D[0]=Z,D[1]=j,D[2]=0,D[3]=-j,D[4]=Z,D[5]=0,D[6]=0,D[7]=0,D[8]=1}(P,-o.transform.angle),function(D,G,j){var Z=G[0],Y=G[1],X=G[2];D[0]=Z*j[0]+Y*j[3]+X*j[6],D[1]=Z*j[1]+Y*j[4]+X*j[7],D[2]=Z*j[2]+Y*j[5]+X*j[8]}(E,E,P);const B=y.properties.get("color");return{u_matrix:g,u_lightpos:E,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+h,u_opacity:m}},Ae=(g,o,h,m,y,v,E)=>a.e(oe(g,o,h,m),zt(v,o,E),{u_height_factor:-Math.pow(2,y.overscaledZ)/E.tileSize/8}),ar=g=>({u_matrix:g}),Lr=(g,o,h,m)=>a.e(ar(g),zt(h,o,m)),di=(g,o)=>({u_matrix:g,u_world:o}),Sn=(g,o,h,m,y)=>a.e(Lr(g,o,h,m),{u_world:y}),Mn=(g,o,h,m)=>{const y=g.transform;let v,E;if(m.paint.get("circle-pitch-alignment")==="map"){const P=Sr(h,1,y.zoom);v=!0,E=[P,P]}else v=!1,E=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:g.translatePosMatrix(o.posMatrix,h,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:E}},ii=(g,o,h)=>({u_matrix:g,u_inv_matrix:o,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}),Hl=function(g,o){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:g,u_color:o,u_overlay:0,u_overlay_scale:h}},Un=g=>({u_matrix:g}),pr=(g,o,h,m)=>({u_matrix:g,u_extrude_scale:Sr(o,1,h),u_intensity:m}),Lc=(g,o,h,m)=>{const y=a.H();a.aP(y,0,g.width,g.height,0,0,1);const v=g.context.gl;return{u_matrix:y,u_world:[v.drawingBufferWidth,v.drawingBufferHeight],u_image:h,u_color_ramp:m,u_opacity:o.paint.get("heatmap-opacity")}};function Mc(g,o){const h=Math.pow(2,o.canonical.z),m=o.canonical.y;return[new a.Z(0,m/h).toLngLat().lat,new a.Z(0,(m+1)/h).toLngLat().lat]}const js=(g,o,h,m)=>{const y=g.transform;return{u_matrix:Eh(g,o,h,m),u_ratio:1/Sr(o,1,y.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Iu=(g,o,h,m,y)=>a.e(js(g,o,h,y),{u_image:0,u_image_height:m}),Ma=(g,o,h,m,y)=>{const v=g.transform,E=kc(o,v);return{u_matrix:Eh(g,o,h,y),u_texsize:o.imageAtlasTexture.size,u_ratio:1/Sr(o,1,v.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[E,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Bc=(g,o,h,m,y,v)=>{const E=g.lineAtlas,P=kc(o,g.transform),B=h.layout.get("line-cap")==="round",D=E.getDash(m.from,B),G=E.getDash(m.to,B),j=D.width*y.fromScale,Z=G.width*y.toScale;return a.e(js(g,o,h,v),{u_patternscale_a:[P/j,-D.height/2],u_patternscale_b:[P/Z,-G.height/2],u_sdfgamma:E.width/(256*Math.min(j,Z)*g.pixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:G.y,u_mix:y.t})};function kc(g,o){return 1/Sr(g,1,o.tileZoom)}function Eh(g,o,h,m){return g.translatePosMatrix(m?m.posMatrix:o.tileID.posMatrix,o,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Ld=(g,o,h,m,y)=>{return{u_matrix:g,u_tl_parent:o,u_scale_parent:h,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(E=y.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(v=y.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Md(y.paint.get("raster-hue-rotate"))};var v,E};function Md(g){g*=Math.PI/180;const o=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const Rc=(g,o,h,m,y,v,E,P,B,D,G,j,Z,Y)=>{const X=E.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_pitch:X.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:X.width/X.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:B,u_coord_matrix:D,u_is_text:+j,u_pitch_with_map:+m,u_is_along_line:y,u_is_variable_anchor:v,u_texsize:Z,u_texture:0,u_translation:G,u_pitched_scale:Y}},Do=(g,o,h,m,y,v,E,P,B,D,G,j,Z,Y,X)=>{const tt=E.transform;return a.e(Rc(g,o,h,m,y,v,E,P,B,D,G,j,Z,X),{u_gamma_scale:m?Math.cos(tt._pitch)*tt.cameraToCenterDistance:1,u_device_pixel_ratio:E.pixelRatio,u_is_halo:+Y})},ra=(g,o,h,m,y,v,E,P,B,D,G,j,Z,Y)=>a.e(Do(g,o,h,m,y,v,E,P,B,D,G,!0,j,!0,Y),{u_texsize_icon:Z,u_texture_icon:1}),Fc=(g,o,h)=>({u_matrix:g,u_opacity:o,u_color:h}),Ba=(g,o,h,m,y,v)=>a.e(function(E,P,B,D){const G=B.imageManager.getPattern(E.from.toString()),j=B.imageManager.getPattern(E.to.toString()),{width:Z,height:Y}=B.imageManager.getPixelSize(),X=Math.pow(2,D.tileID.overscaledZ),tt=D.tileSize*Math.pow(2,B.transform.tileZoom)/X,ct=tt*(D.tileID.canonical.x+D.tileID.wrap*X),ht=tt*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:G.tl,u_pattern_br_a:G.br,u_pattern_tl_b:j.tl,u_pattern_br_b:j.br,u_texsize:[Z,Y],u_mix:P.t,u_pattern_size_a:G.displaySize,u_pattern_size_b:j.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/Sr(D,1,B.transform.tileZoom),u_pixel_coord_upper:[ct>>16,ht>>16],u_pixel_coord_lower:[65535&ct,65535&ht]}}(m,v,h,y),{u_matrix:g,u_opacity:o}),$l={fillExtrusion:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_lightpos:new a.aN(g,o.u_lightpos),u_lightintensity:new a.aI(g,o.u_lightintensity),u_lightcolor:new a.aN(g,o.u_lightcolor),u_vertical_gradient:new a.aI(g,o.u_vertical_gradient),u_opacity:new a.aI(g,o.u_opacity)}),fillExtrusionPattern:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_lightpos:new a.aN(g,o.u_lightpos),u_lightintensity:new a.aI(g,o.u_lightintensity),u_lightcolor:new a.aN(g,o.u_lightcolor),u_vertical_gradient:new a.aI(g,o.u_vertical_gradient),u_height_factor:new a.aI(g,o.u_height_factor),u_image:new a.aH(g,o.u_image),u_texsize:new a.aO(g,o.u_texsize),u_pixel_coord_upper:new a.aO(g,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(g,o.u_pixel_coord_lower),u_scale:new a.aN(g,o.u_scale),u_fade:new a.aI(g,o.u_fade),u_opacity:new a.aI(g,o.u_opacity)}),fill:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix)}),fillPattern:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_image:new a.aH(g,o.u_image),u_texsize:new a.aO(g,o.u_texsize),u_pixel_coord_upper:new a.aO(g,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(g,o.u_pixel_coord_lower),u_scale:new a.aN(g,o.u_scale),u_fade:new a.aI(g,o.u_fade)}),fillOutline:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_world:new a.aO(g,o.u_world)}),fillOutlinePattern:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_world:new a.aO(g,o.u_world),u_image:new a.aH(g,o.u_image),u_texsize:new a.aO(g,o.u_texsize),u_pixel_coord_upper:new a.aO(g,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(g,o.u_pixel_coord_lower),u_scale:new a.aN(g,o.u_scale),u_fade:new a.aI(g,o.u_fade)}),circle:(g,o)=>({u_camera_to_center_distance:new a.aI(g,o.u_camera_to_center_distance),u_scale_with_map:new a.aH(g,o.u_scale_with_map),u_pitch_with_map:new a.aH(g,o.u_pitch_with_map),u_extrude_scale:new a.aO(g,o.u_extrude_scale),u_device_pixel_ratio:new a.aI(g,o.u_device_pixel_ratio),u_matrix:new a.aJ(g,o.u_matrix)}),collisionBox:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_pixel_extrude_scale:new a.aO(g,o.u_pixel_extrude_scale)}),collisionCircle:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_inv_matrix:new a.aJ(g,o.u_inv_matrix),u_camera_to_center_distance:new a.aI(g,o.u_camera_to_center_distance),u_viewport_size:new a.aO(g,o.u_viewport_size)}),debug:(g,o)=>({u_color:new a.aL(g,o.u_color),u_matrix:new a.aJ(g,o.u_matrix),u_overlay:new a.aH(g,o.u_overlay),u_overlay_scale:new a.aI(g,o.u_overlay_scale)}),clippingMask:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix)}),heatmap:(g,o)=>({u_extrude_scale:new a.aI(g,o.u_extrude_scale),u_intensity:new a.aI(g,o.u_intensity),u_matrix:new a.aJ(g,o.u_matrix)}),heatmapTexture:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_world:new a.aO(g,o.u_world),u_image:new a.aH(g,o.u_image),u_color_ramp:new a.aH(g,o.u_color_ramp),u_opacity:new a.aI(g,o.u_opacity)}),hillshade:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_image:new a.aH(g,o.u_image),u_latrange:new a.aO(g,o.u_latrange),u_light:new a.aO(g,o.u_light),u_shadow:new a.aL(g,o.u_shadow),u_highlight:new a.aL(g,o.u_highlight),u_accent:new a.aL(g,o.u_accent)}),hillshadePrepare:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_image:new a.aH(g,o.u_image),u_dimension:new a.aO(g,o.u_dimension),u_zoom:new a.aI(g,o.u_zoom),u_unpack:new a.aK(g,o.u_unpack)}),line:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_ratio:new a.aI(g,o.u_ratio),u_device_pixel_ratio:new a.aI(g,o.u_device_pixel_ratio),u_units_to_pixels:new a.aO(g,o.u_units_to_pixels)}),lineGradient:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_ratio:new a.aI(g,o.u_ratio),u_device_pixel_ratio:new a.aI(g,o.u_device_pixel_ratio),u_units_to_pixels:new a.aO(g,o.u_units_to_pixels),u_image:new a.aH(g,o.u_image),u_image_height:new a.aI(g,o.u_image_height)}),linePattern:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_texsize:new a.aO(g,o.u_texsize),u_ratio:new a.aI(g,o.u_ratio),u_device_pixel_ratio:new a.aI(g,o.u_device_pixel_ratio),u_image:new a.aH(g,o.u_image),u_units_to_pixels:new a.aO(g,o.u_units_to_pixels),u_scale:new a.aN(g,o.u_scale),u_fade:new a.aI(g,o.u_fade)}),lineSDF:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_ratio:new a.aI(g,o.u_ratio),u_device_pixel_ratio:new a.aI(g,o.u_device_pixel_ratio),u_units_to_pixels:new a.aO(g,o.u_units_to_pixels),u_patternscale_a:new a.aO(g,o.u_patternscale_a),u_patternscale_b:new a.aO(g,o.u_patternscale_b),u_sdfgamma:new a.aI(g,o.u_sdfgamma),u_image:new a.aH(g,o.u_image),u_tex_y_a:new a.aI(g,o.u_tex_y_a),u_tex_y_b:new a.aI(g,o.u_tex_y_b),u_mix:new a.aI(g,o.u_mix)}),raster:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_tl_parent:new a.aO(g,o.u_tl_parent),u_scale_parent:new a.aI(g,o.u_scale_parent),u_buffer_scale:new a.aI(g,o.u_buffer_scale),u_fade_t:new a.aI(g,o.u_fade_t),u_opacity:new a.aI(g,o.u_opacity),u_image0:new a.aH(g,o.u_image0),u_image1:new a.aH(g,o.u_image1),u_brightness_low:new a.aI(g,o.u_brightness_low),u_brightness_high:new a.aI(g,o.u_brightness_high),u_saturation_factor:new a.aI(g,o.u_saturation_factor),u_contrast_factor:new a.aI(g,o.u_contrast_factor),u_spin_weights:new a.aN(g,o.u_spin_weights)}),symbolIcon:(g,o)=>({u_is_size_zoom_constant:new a.aH(g,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(g,o.u_is_size_feature_constant),u_size_t:new a.aI(g,o.u_size_t),u_size:new a.aI(g,o.u_size),u_camera_to_center_distance:new a.aI(g,o.u_camera_to_center_distance),u_pitch:new a.aI(g,o.u_pitch),u_rotate_symbol:new a.aH(g,o.u_rotate_symbol),u_aspect_ratio:new a.aI(g,o.u_aspect_ratio),u_fade_change:new a.aI(g,o.u_fade_change),u_matrix:new a.aJ(g,o.u_matrix),u_label_plane_matrix:new a.aJ(g,o.u_label_plane_matrix),u_coord_matrix:new a.aJ(g,o.u_coord_matrix),u_is_text:new a.aH(g,o.u_is_text),u_pitch_with_map:new a.aH(g,o.u_pitch_with_map),u_is_along_line:new a.aH(g,o.u_is_along_line),u_is_variable_anchor:new a.aH(g,o.u_is_variable_anchor),u_texsize:new a.aO(g,o.u_texsize),u_texture:new a.aH(g,o.u_texture),u_translation:new a.aO(g,o.u_translation),u_pitched_scale:new a.aI(g,o.u_pitched_scale)}),symbolSDF:(g,o)=>({u_is_size_zoom_constant:new a.aH(g,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(g,o.u_is_size_feature_constant),u_size_t:new a.aI(g,o.u_size_t),u_size:new a.aI(g,o.u_size),u_camera_to_center_distance:new a.aI(g,o.u_camera_to_center_distance),u_pitch:new a.aI(g,o.u_pitch),u_rotate_symbol:new a.aH(g,o.u_rotate_symbol),u_aspect_ratio:new a.aI(g,o.u_aspect_ratio),u_fade_change:new a.aI(g,o.u_fade_change),u_matrix:new a.aJ(g,o.u_matrix),u_label_plane_matrix:new a.aJ(g,o.u_label_plane_matrix),u_coord_matrix:new a.aJ(g,o.u_coord_matrix),u_is_text:new a.aH(g,o.u_is_text),u_pitch_with_map:new a.aH(g,o.u_pitch_with_map),u_is_along_line:new a.aH(g,o.u_is_along_line),u_is_variable_anchor:new a.aH(g,o.u_is_variable_anchor),u_texsize:new a.aO(g,o.u_texsize),u_texture:new a.aH(g,o.u_texture),u_gamma_scale:new a.aI(g,o.u_gamma_scale),u_device_pixel_ratio:new a.aI(g,o.u_device_pixel_ratio),u_is_halo:new a.aH(g,o.u_is_halo),u_translation:new a.aO(g,o.u_translation),u_pitched_scale:new a.aI(g,o.u_pitched_scale)}),symbolTextAndIcon:(g,o)=>({u_is_size_zoom_constant:new a.aH(g,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(g,o.u_is_size_feature_constant),u_size_t:new a.aI(g,o.u_size_t),u_size:new a.aI(g,o.u_size),u_camera_to_center_distance:new a.aI(g,o.u_camera_to_center_distance),u_pitch:new a.aI(g,o.u_pitch),u_rotate_symbol:new a.aH(g,o.u_rotate_symbol),u_aspect_ratio:new a.aI(g,o.u_aspect_ratio),u_fade_change:new a.aI(g,o.u_fade_change),u_matrix:new a.aJ(g,o.u_matrix),u_label_plane_matrix:new a.aJ(g,o.u_label_plane_matrix),u_coord_matrix:new a.aJ(g,o.u_coord_matrix),u_is_text:new a.aH(g,o.u_is_text),u_pitch_with_map:new a.aH(g,o.u_pitch_with_map),u_is_along_line:new a.aH(g,o.u_is_along_line),u_is_variable_anchor:new a.aH(g,o.u_is_variable_anchor),u_texsize:new a.aO(g,o.u_texsize),u_texsize_icon:new a.aO(g,o.u_texsize_icon),u_texture:new a.aH(g,o.u_texture),u_texture_icon:new a.aH(g,o.u_texture_icon),u_gamma_scale:new a.aI(g,o.u_gamma_scale),u_device_pixel_ratio:new a.aI(g,o.u_device_pixel_ratio),u_is_halo:new a.aH(g,o.u_is_halo),u_translation:new a.aO(g,o.u_translation),u_pitched_scale:new a.aI(g,o.u_pitched_scale)}),background:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_opacity:new a.aI(g,o.u_opacity),u_color:new a.aL(g,o.u_color)}),backgroundPattern:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_opacity:new a.aI(g,o.u_opacity),u_image:new a.aH(g,o.u_image),u_pattern_tl_a:new a.aO(g,o.u_pattern_tl_a),u_pattern_br_a:new a.aO(g,o.u_pattern_br_a),u_pattern_tl_b:new a.aO(g,o.u_pattern_tl_b),u_pattern_br_b:new a.aO(g,o.u_pattern_br_b),u_texsize:new a.aO(g,o.u_texsize),u_mix:new a.aI(g,o.u_mix),u_pattern_size_a:new a.aO(g,o.u_pattern_size_a),u_pattern_size_b:new a.aO(g,o.u_pattern_size_b),u_scale_a:new a.aI(g,o.u_scale_a),u_scale_b:new a.aI(g,o.u_scale_b),u_pixel_coord_upper:new a.aO(g,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(g,o.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aI(g,o.u_tile_units_to_pixels)}),terrain:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_texture:new a.aH(g,o.u_texture),u_ele_delta:new a.aI(g,o.u_ele_delta),u_fog_matrix:new a.aJ(g,o.u_fog_matrix),u_fog_color:new a.aL(g,o.u_fog_color),u_fog_ground_blend:new a.aI(g,o.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.aI(g,o.u_fog_ground_blend_opacity),u_horizon_color:new a.aL(g,o.u_horizon_color),u_horizon_fog_blend:new a.aI(g,o.u_horizon_fog_blend)}),terrainDepth:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_ele_delta:new a.aI(g,o.u_ele_delta)}),terrainCoords:(g,o)=>({u_matrix:new a.aJ(g,o.u_matrix),u_texture:new a.aH(g,o.u_texture),u_terrain_coords_id:new a.aI(g,o.u_terrain_coords_id),u_ele_delta:new a.aI(g,o.u_ele_delta)}),sky:(g,o)=>({u_sky_color:new a.aL(g,o.u_sky_color),u_horizon_color:new a.aL(g,o.u_horizon_color),u_horizon:new a.aI(g,o.u_horizon),u_sky_horizon_blend:new a.aI(g,o.u_sky_horizon_blend)})};class ds{constructor(o,h,m){this.context=o;const y=o.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Th={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Dc{constructor(o,h,m,y){this.length=h.length,this.attributes=m,this.itemSize=h.bytesPerElement,this.dynamicDraw=y,this.context=o;const v=o.gl;this.buffer=v.createBuffer(),o.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let m=0;m<this.attributes.length;m++){const y=h.attributes[this.attributes[m].name];y!==void 0&&o.enableVertexAttribArray(y)}}setVertexAttribPointers(o,h,m){for(let y=0;y<this.attributes.length;y++){const v=this.attributes[y],E=h.attributes[v.name];E!==void 0&&o.vertexAttribPointer(E,v.components,o[Th[v.type]],!1,this.itemSize,v.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ia=new WeakMap;function No(g){var o;if(ia.has(g))return ia.get(g);{const h=(o=g.getParameter(g.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return ia.set(g,h),h}}class Gr{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Oo extends Gr{getDefault(){return a.aM.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Bd extends Gr{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Us extends Gr{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class zo extends Gr{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Nc extends Gr{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Wl extends Gr{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Ch extends Gr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class dl extends Gr{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Ph extends Gr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class Oc extends Gr{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class zc extends Gr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class Lu extends Gr{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class ro extends Gr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class jc extends Gr{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Mu extends Gr{getDefault(){return a.aM.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Bu extends Gr{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Xl extends Gr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class Uc extends Gr{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class na extends Gr{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class ku extends Gr{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class pl extends Gr{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Gc extends Gr{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class R extends Gr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class rt extends Gr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Ct extends Gr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Ut extends Gr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Yt extends Gr{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class ce extends Gr{getDefault(){return null}set(o){var h;if(o===this.current&&!this.dirty)return;const m=this.gl;No(m)?m.bindVertexArray(o):(h=m.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class Le extends Gr{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class $e extends Gr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class _r extends Gr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Mr extends Gr{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class Or extends Mr{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Vr extends Mr{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Di extends Mr{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class ln{constructor(o,h,m,y,v){this.context=o,this.width=h,this.height=m;const E=o.gl,P=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new Or(o,P),y)this.depthAttachment=v?new Di(o,P):new Vr(o,P);else if(v)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,h=this.colorAttachment.get();if(h&&o.deleteTexture(h),this.depthAttachment){const m=this.depthAttachment.get();m&&o.deleteRenderbuffer(m)}o.deleteFramebuffer(this.framebuffer)}}class zr{constructor(o,h,m){this.blendFunction=o,this.blendColor=h,this.mask=m}}zr.Replace=[1,0],zr.disabled=new zr(zr.Replace,a.aM.transparent,[!1,!1,!1,!1]),zr.unblended=new zr(zr.Replace,a.aM.transparent,[!0,!0,!0,!0]),zr.alphaBlended=new zr([1,771],a.aM.transparent,[!0,!0,!0,!0]);class Zn{constructor(o){var h,m;if(this.gl=o,this.clearColor=new Oo(this),this.clearDepth=new Bd(this),this.clearStencil=new Us(this),this.colorMask=new zo(this),this.depthMask=new Nc(this),this.stencilMask=new Wl(this),this.stencilFunc=new Ch(this),this.stencilOp=new dl(this),this.stencilTest=new Ph(this),this.depthRange=new Oc(this),this.depthTest=new zc(this),this.depthFunc=new Lu(this),this.blend=new ro(this),this.blendFunc=new jc(this),this.blendColor=new Mu(this),this.blendEquation=new Bu(this),this.cullFace=new Xl(this),this.cullFaceSide=new Uc(this),this.frontFace=new na(this),this.program=new ku(this),this.activeTexture=new pl(this),this.viewport=new Gc(this),this.bindFramebuffer=new R(this),this.bindRenderbuffer=new rt(this),this.bindTexture=new Ct(this),this.bindVertexBuffer=new Ut(this),this.bindElementBuffer=new Yt(this),this.bindVertexArray=new ce(this),this.pixelStoreUnpack=new Le(this),this.pixelStoreUnpackPremultiplyAlpha=new $e(this),this.pixelStoreUnpackFlipY=new _r(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),No(o)){this.HALF_FLOAT=o.HALF_FLOAT;const y=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=o.RGBA16F)!==null&&h!==void 0?h:y==null?void 0:y.RGBA16F_EXT,this.RGB16F=(m=o.RGB16F)!==null&&m!==void 0?m:y==null?void 0:y.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const y=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=y==null?void 0:y.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h){return new ds(this,o,h)}createVertexBuffer(o,h,m){return new Dc(this,o,h,m)}createRenderbuffer(o,h,m){const y=this.gl,v=y.createRenderbuffer();return this.bindRenderbuffer.set(v),y.renderbufferStorage(y.RENDERBUFFER,o,h,m),this.bindRenderbuffer.set(null),v}createFramebuffer(o,h,m,y){return new ln(this,o,h,m,y)}clear(o){let{color:h,depth:m,stencil:y}=o;const v=this.gl;let E=0;h&&(E|=v.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),m!==void 0&&(E|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(m),this.depthMask.set(!0)),y!==void 0&&(E|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),v.clear(E)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){a.aE(o.blendFunction,zr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return No(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var h;return No(this.gl)?this.gl.deleteVertexArray(o):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class fr{constructor(o,h,m){this.func=o,this.mask=h,this.range=m}}fr.ReadOnly=!1,fr.ReadWrite=!0,fr.disabled=new fr(519,fr.ReadOnly,[0,1]);const Es=7680;class Zr{constructor(o,h,m,y,v,E){this.test=o,this.ref=h,this.mask=m,this.fail=y,this.depthFail=v,this.pass=E}}Zr.disabled=new Zr({func:519,mask:0},0,0,Es,Es,Es);class Qr{constructor(o,h,m){this.enable=o,this.mode=h,this.frontFace=m}}let sa;function ka(g,o,h,m,y){const v=g.context,E=v.gl,P=g.useProgram("collisionBox"),B=[];let D=0,G=0;for(let ht=0;ht<m.length;ht++){const gt=m[ht],pt=o.getTile(gt).getBucket(h);if(!pt)continue;const St=y?pt.textCollisionBox:pt.iconCollisionBox,Rt=pt.collisionCircleArray;if(Rt.length>0){const Bt=a.H();a.aQ(Bt,pt.placementInvProjMatrix,g.transform.glCoordMatrix),a.aQ(Bt,Bt,pt.placementViewportMatrix),B.push({circleArray:Rt,circleOffset:G,transform:gt.posMatrix,invTransform:Bt,coord:gt}),D+=Rt.length/4,G=D}St&&P.draw(v,E.LINES,fr.disabled,Zr.disabled,g.colorModeForRenderPass(),Qr.disabled,{u_matrix:gt.posMatrix,u_pixel_extrude_scale:[1/(j=g.transform).width,1/j.height]},g.style.map.terrain&&g.style.map.terrain.getTerrainData(gt),h.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,null,g.transform.zoom,null,null,St.collisionVertexBuffer)}var j;if(!y||!B.length)return;const Z=g.useProgram("collisionCircle"),Y=new a.aR;Y.resize(4*D),Y._trim();let X=0;for(const ht of B)for(let gt=0;gt<ht.circleArray.length/4;gt++){const pt=4*gt,St=ht.circleArray[pt+0],Rt=ht.circleArray[pt+1],Bt=ht.circleArray[pt+2],ie=ht.circleArray[pt+3];Y.emplace(X++,St,Rt,Bt,ie,0),Y.emplace(X++,St,Rt,Bt,ie,1),Y.emplace(X++,St,Rt,Bt,ie,2),Y.emplace(X++,St,Rt,Bt,ie,3)}(!sa||sa.length<2*D)&&(sa=function(ht){const gt=2*ht,pt=new a.aT;pt.resize(gt),pt._trim();for(let St=0;St<gt;St++){const Rt=6*St;pt.uint16[Rt+0]=4*St+0,pt.uint16[Rt+1]=4*St+1,pt.uint16[Rt+2]=4*St+2,pt.uint16[Rt+3]=4*St+2,pt.uint16[Rt+4]=4*St+3,pt.uint16[Rt+5]=4*St+0}return pt}(D));const tt=v.createIndexBuffer(sa,!0),ct=v.createVertexBuffer(Y,a.aS.members,!0);for(const ht of B){const gt=ii(ht.transform,ht.invTransform,g.transform);Z.draw(v,E.TRIANGLES,fr.disabled,Zr.disabled,g.colorModeForRenderPass(),Qr.disabled,gt,g.style.map.terrain&&g.style.map.terrain.getTerrainData(ht.coord),h.id,ct,tt,a.a0.simpleSegment(0,2*ht.circleOffset,ht.circleArray.length,ht.circleArray.length/2),null,g.transform.zoom,null,null,null)}ct.destroy(),tt.destroy()}Qr.disabled=new Qr(!1,1029,2305),Qr.backCCW=new Qr(!0,1029,2305);const Ra=a.an(new Float32Array(16));function fl(g,o,h,m,y,v){const{horizontalAlign:E,verticalAlign:P}=a.au(g);return new a.P((-(E-.5)*o/y+m[0])*v,(-(P-.5)*h/y+m[1])*v)}function jo(g,o,h,m,y,v){const E=o.tileAnchorPoint.add(new a.P(o.translation[0],o.translation[1]));if(o.pitchWithMap){let P=m.mult(v);h||(P=P.rotate(-y));const B=E.add(P);return At(B.x,B.y,o.labelPlaneMatrix,o.getElevation).point}if(h){const P=ne(o.tileAnchorPoint.x+1,o.tileAnchorPoint.y,o).point.sub(g),B=Math.atan(P.y/P.x)+(P.x<0?Math.PI:0);return g.add(m.rotate(B))}return g.add(m)}function oa(g,o,h,m,y,v,E,P,B,D,G,j,Z,Y){const X=g.text.placedSymbolArray,tt=g.text.dynamicLayoutVertexArray,ct=g.icon.dynamicLayoutVertexArray,ht={};tt.clear();for(let gt=0;gt<X.length;gt++){const pt=X.get(gt),St=pt.hidden||!pt.crossTileID||g.allowVerticalPlacement&&!pt.placedOrientation?null:m[pt.crossTileID];if(St){const Rt=new a.P(pt.anchorX,pt.anchorY),Bt={getElevation:Y,width:y.width,height:y.height,labelPlaneMatrix:v,lineVertexArray:null,pitchWithMap:h,projection:G,projectionCache:null,tileAnchorPoint:Rt,translation:j,unwrappedTileID:Z},ie=h?At(Rt.x,Rt.y,E,Y):ne(Rt.x,Rt.y,Bt),pe=J(y.cameraToCenterDistance,ie.signedDistanceFromCamera);let ye=a.ai(g.textSizeData,B,pt)*pe/a.ap;h&&(ye*=g.tilePixelRatio/P);const{width:we,height:ve,anchor:_e,textOffset:Se,textBoxScale:Ye}=St,Pe=fl(_e,we,ve,Se,Ye,ye),Ie=G.getPitchedTextCorrection(y,Rt.add(new a.P(j[0],j[1])),Z),ir=jo(ie.point,Bt,o,Pe,y.angle,Ie),Ar=g.allowVerticalPlacement&&pt.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let vr=0;vr<pt.numGlyphs;vr++)a.aj(tt,ir,Ar);D&&pt.associatedIconIndex>=0&&(ht[pt.associatedIconIndex]={shiftedAnchor:ir,angle:Ar})}else Ke(pt.numGlyphs,tt)}if(D){ct.clear();const gt=g.icon.placedSymbolArray;for(let pt=0;pt<gt.length;pt++){const St=gt.get(pt);if(St.hidden)Ke(St.numGlyphs,ct);else{const Rt=ht[pt];if(Rt)for(let Bt=0;Bt<St.numGlyphs;Bt++)a.aj(ct,Rt.shiftedAnchor,Rt.angle);else Ke(St.numGlyphs,ct)}}g.icon.dynamicLayoutVertexBuffer.updateData(ct)}g.text.dynamicLayoutVertexBuffer.updateData(tt)}function Gn(g,o,h){return h.iconsInText&&o?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Yn(g,o,h,m,y,v,E,P,B,D,G,j){const Z=g.context,Y=Z.gl,X=g.transform,tt=cs(),ct=P==="map",ht=B==="map",gt=P!=="viewport"&&h.layout.get("symbol-placement")!=="point",pt=ct&&!ht&&!gt,St=!ht&&gt,Rt=!h.layout.get("symbol-sort-key").isConstant();let Bt=!1;const ie=g.depthModeForSublayer(0,fr.ReadOnly),pe=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ye=[],we=tt.getCircleRadiusCorrection(X);for(const ve of m){const _e=o.getTile(ve),Se=_e.getBucket(h);if(!Se)continue;const Ye=y?Se.text:Se.icon;if(!Ye||!Ye.segments.get().length||!Ye.hasVisibleVertices)continue;const Pe=Ye.programConfigurations.get(h.id),Ie=y||Se.sdfIcons,ir=y?Se.textSizeData:Se.iconSizeData,Ar=ht||X.pitch!==0,vr=g.useProgram(Gn(Ie,y,Se),Pe),Tr=a.ag(ir,X.zoom),Dr=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ve);let ai,Ni,ti,Yi,li=[0,0],Hi=null;if(y)Ni=_e.glyphAtlasTexture,ti=Y.LINEAR,ai=_e.glyphAtlasTexture.size,Se.iconsInText&&(li=_e.imageAtlasTexture.size,Hi=_e.imageAtlasTexture,Yi=Ar||g.options.rotating||g.options.zooming||ir.kind==="composite"||ir.kind==="camera"?Y.LINEAR:Y.NEAREST);else{const $r=h.layout.get("icon-size").constantOr(0)!==1||Se.iconsNeedLinear;Ni=_e.imageAtlasTexture,ti=Ie||g.options.rotating||g.options.zooming||$r||Ar?Y.LINEAR:Y.NEAREST,ai=_e.imageAtlasTexture.size}const hn=Sr(_e,1,g.transform.zoom),gs=St?ve.posMatrix:Ra,$s=on(gs,ht,ct,g.transform,hn),Oi=an(gs,ht,ct,g.transform,hn),Sl=an(ve.posMatrix,ht,ct,g.transform,hn),Ws=tt.translatePosition(g.transform,_e,v,E),qu=pe&&Se.hasTextData(),Kc=h.layout.get("icon-text-fit")!=="none"&&qu&&Se.hasIconData();if(gt){const $r=g.style.map.terrain?(Al,ja)=>g.style.map.terrain.getElevation(ve,Al,ja):null,pa=h.layout.get("text-rotation-alignment")==="map";ut(Se,ve.posMatrix,g,y,$s,Sl,ht,D,pa,tt,ve.toUnwrapped(),X.width,X.height,Ws,$r)}const Qn=ve.posMatrix,ys=y&&pe||Kc,Rn=gt||ys?Ra:$s,ts=Oi,en=Ie&&h.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Vn;Vn=Ie?Se.iconsInText?ra(ir.kind,Tr,pt,ht,gt,ys,g,Qn,Rn,ts,Ws,ai,li,we):Do(ir.kind,Tr,pt,ht,gt,ys,g,Qn,Rn,ts,Ws,y,ai,!0,we):Rc(ir.kind,Tr,pt,ht,gt,ys,g,Qn,Rn,ts,Ws,y,ai,we);const es={program:vr,buffers:Ye,uniformValues:Vn,atlasTexture:Ni,atlasTextureIcon:Hi,atlasInterpolation:ti,atlasInterpolationIcon:Yi,isSDF:Ie,hasHalo:en};if(Rt&&Se.canOverlap){Bt=!0;const $r=Ye.segments.get();for(const pa of $r)ye.push({segments:new a.a0([pa]),sortKey:pa.sortKey,state:es,terrainData:Dr})}else ye.push({segments:Ye.segments,sortKey:0,state:es,terrainData:Dr})}Bt&&ye.sort((ve,_e)=>ve.sortKey-_e.sortKey);for(const ve of ye){const _e=ve.state;if(Z.activeTexture.set(Y.TEXTURE0),_e.atlasTexture.bind(_e.atlasInterpolation,Y.CLAMP_TO_EDGE),_e.atlasTextureIcon&&(Z.activeTexture.set(Y.TEXTURE1),_e.atlasTextureIcon&&_e.atlasTextureIcon.bind(_e.atlasInterpolationIcon,Y.CLAMP_TO_EDGE)),_e.isSDF){const Se=_e.uniformValues;_e.hasHalo&&(Se.u_is_halo=1,ml(_e.buffers,ve.segments,h,g,_e.program,ie,G,j,Se,ve.terrainData)),Se.u_is_halo=0}ml(_e.buffers,ve.segments,h,g,_e.program,ie,G,j,_e.uniformValues,ve.terrainData)}}function ml(g,o,h,m,y,v,E,P,B,D){const G=m.context;y.draw(G,G.gl.TRIANGLES,v,E,P,Qr.disabled,B,D,h.id,g.layoutVertexBuffer,g.indexBuffer,o,h.paint,m.transform.zoom,g.programConfigurations.get(h.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function gl(g,o,h,m){const y=g.context,v=y.gl,E=Zr.disabled,P=new zr([v.ONE,v.ONE],a.aM.transparent,[!0,!0,!0,!0]),B=o.getBucket(h);if(!B)return;const D=m.key;let G=h.heatmapFbos.get(D);G||(G=Fa(y,o.tileSize,o.tileSize),h.heatmapFbos.set(D,G)),y.bindFramebuffer.set(G.framebuffer),y.viewport.set([0,0,o.tileSize,o.tileSize]),y.clear({color:a.aM.transparent});const j=B.programConfigurations.get(h.id),Z=g.useProgram("heatmap",j),Y=g.style.map.terrain.getTerrainData(m);Z.draw(y,v.TRIANGLES,fr.disabled,E,P,Qr.disabled,pr(m.posMatrix,o,g.transform.zoom,h.paint.get("heatmap-intensity")),Y,h.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,h.paint,g.transform.zoom,j)}function io(g,o,h){const m=g.context,y=m.gl;m.setColorMode(g.colorModeForRenderPass());const v=Bn(m,o),E=h.key,P=o.heatmapFbos.get(E);P&&(m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,P.colorAttachment.get()),m.activeTexture.set(y.TEXTURE1),v.bind(y.LINEAR,y.CLAMP_TO_EDGE),g.useProgram("heatmapTexture").draw(m,y.TRIANGLES,fr.disabled,Zr.disabled,g.colorModeForRenderPass(),Qr.disabled,Lc(g,o,0,1),null,o.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments,o.paint,g.transform.zoom),P.destroy(),o.heatmapFbos.delete(E))}function Fa(g,o,h){var m,y;const v=g.gl,E=v.createTexture();v.bindTexture(v.TEXTURE_2D,E),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR);const P=(m=g.HALF_FLOAT)!==null&&m!==void 0?m:v.UNSIGNED_BYTE,B=(y=g.RGBA16F)!==null&&y!==void 0?y:v.RGBA;v.texImage2D(v.TEXTURE_2D,0,B,o,h,0,v.RGBA,P,null);const D=g.createFramebuffer(o,h,!1,!1);return D.colorAttachment.set(E),D}function Bn(g,o){return o.colorRampTexture||(o.colorRampTexture=new at(g,o.colorRamp,g.gl.RGBA)),o.colorRampTexture}function yl(g,o,h,m,y){if(!h||!m||!m.imageAtlas)return;const v=m.imageAtlas.patternPositions;let E=v[h.to.toString()],P=v[h.from.toString()];if(!E&&P&&(E=P),!P&&E&&(P=E),!E||!P){const B=y.getPaintProperty(o);E=v[B],P=v[B]}E&&P&&g.setConstantPatternPositions(E,P)}function Da(g,o,h,m,y,v,E){const P=g.context.gl,B="fill-pattern",D=h.paint.get(B),G=D&&D.constantOr(1),j=h.getCrossfadeParameters();let Z,Y,X,tt,ct;E?(Y=G&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=P.LINES):(Y=G?"fillPattern":"fill",Z=P.TRIANGLES);const ht=D.constantOr(null);for(const gt of m){const pt=o.getTile(gt);if(G&&!pt.patternsLoaded())continue;const St=pt.getBucket(h);if(!St)continue;const Rt=St.programConfigurations.get(h.id),Bt=g.useProgram(Y,Rt),ie=g.style.map.terrain&&g.style.map.terrain.getTerrainData(gt);G&&(g.context.activeTexture.set(P.TEXTURE0),pt.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Rt.updatePaintBuffers(j)),yl(Rt,B,ht,pt,h);const pe=ie?gt:null,ye=g.translatePosMatrix(pe?pe.posMatrix:gt.posMatrix,pt,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){tt=St.indexBuffer2,ct=St.segments2;const we=[P.drawingBufferWidth,P.drawingBufferHeight];X=Y==="fillOutlinePattern"&&G?Sn(ye,g,j,pt,we):di(ye,we)}else tt=St.indexBuffer,ct=St.segments,X=G?Lr(ye,g,j,pt):ar(ye);Bt.draw(g.context,Z,y,g.stencilModeForClipping(gt),v,Qr.disabled,X,ie,h.id,St.layoutVertexBuffer,tt,ct,h.paint,g.transform.zoom,Rt)}}function Zl(g,o,h,m,y,v,E){const P=g.context,B=P.gl,D="fill-extrusion-pattern",G=h.paint.get(D),j=G.constantOr(1),Z=h.getCrossfadeParameters(),Y=h.paint.get("fill-extrusion-opacity"),X=G.constantOr(null);for(const tt of m){const ct=o.getTile(tt),ht=ct.getBucket(h);if(!ht)continue;const gt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(tt),pt=ht.programConfigurations.get(h.id),St=g.useProgram(j?"fillExtrusionPattern":"fillExtrusion",pt);j&&(g.context.activeTexture.set(B.TEXTURE0),ct.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),pt.updatePaintBuffers(Z)),yl(pt,D,X,ct,h);const Rt=g.translatePosMatrix(tt.posMatrix,ct,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Bt=h.paint.get("fill-extrusion-vertical-gradient"),ie=j?Ae(Rt,g,Bt,Y,tt,Z,ct):oe(Rt,g,Bt,Y);St.draw(P,P.gl.TRIANGLES,y,v,E,Qr.backCCW,ie,gt,h.id,ht.layoutVertexBuffer,ht.indexBuffer,ht.segments,h.paint,g.transform.zoom,pt,g.style.map.terrain&&ht.centroidVertexBuffer)}}function Jn(g,o,h,m,y,v,E){const P=g.context,B=P.gl,D=h.fbo;if(!D)return;const G=g.useProgram("hillshade"),j=g.style.map.terrain&&g.style.map.terrain.getTerrainData(o);P.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,D.colorAttachment.get()),G.draw(P,B.TRIANGLES,y,v,E,Qr.disabled,((Z,Y,X,tt)=>{const ct=X.paint.get("hillshade-shadow-color"),ht=X.paint.get("hillshade-highlight-color"),gt=X.paint.get("hillshade-accent-color");let pt=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);X.paint.get("hillshade-illumination-anchor")==="viewport"&&(pt-=Z.transform.angle);const St=!Z.options.moving;return{u_matrix:tt?tt.posMatrix:Z.transform.calculatePosMatrix(Y.tileID.toUnwrapped(),St),u_image:0,u_latrange:Mc(0,Y.tileID),u_light:[X.paint.get("hillshade-exaggeration"),pt],u_shadow:ct,u_highlight:ht,u_accent:gt}})(g,h,m,j?o:null),j,m.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}function aa(g,o,h,m,y,v){const E=g.context,P=E.gl,B=o.dem;if(B&&B.data){const D=B.dim,G=B.stride,j=B.getPixels();if(E.activeTexture.set(P.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||g.getTileTexture(G),o.demTexture){const Y=o.demTexture;Y.update(j,{premultiply:!1}),Y.bind(P.NEAREST,P.CLAMP_TO_EDGE)}else o.demTexture=new at(E,j,P.RGBA,{premultiply:!1}),o.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);E.activeTexture.set(P.TEXTURE0);let Z=o.fbo;if(!Z){const Y=new at(E,{width:D,height:D,data:null},P.RGBA);Y.bind(P.LINEAR,P.CLAMP_TO_EDGE),Z=o.fbo=E.createFramebuffer(D,D,!0,!1),Z.colorAttachment.set(Y.texture)}E.bindFramebuffer.set(Z.framebuffer),E.viewport.set([0,0,D,D]),g.useProgram("hillshadePrepare").draw(E,P.TRIANGLES,m,y,v,Qr.disabled,((Y,X)=>{const tt=X.stride,ct=a.H();return a.aP(ct,0,a.X,-a.X,0,0,1),a.J(ct,ct,[0,-a.X,0]),{u_matrix:ct,u_image:1,u_dimension:[tt,tt],u_zoom:Y.overscaledZ,u_unpack:X.getUnpackVector()}})(o.tileID,B),null,h.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function Ih(g,o,h,m,y,v){const E=m.paint.get("raster-fade-duration");if(!v&&E>0){const P=S.now(),B=(P-g.timeAdded)/E,D=o?(P-o.timeAdded)/E:-1,G=h.getSource(),j=y.coveringZoomLevel({tileSize:G.tileSize,roundZoom:G.roundZoom}),Z=!o||Math.abs(o.tileID.overscaledZ-j)>Math.abs(g.tileID.overscaledZ-j),Y=Z&&g.refreshedUponExpiration?1:a.ac(Z?B:1-D,0,1);return g.refreshedUponExpiration&&B>=1&&(g.refreshedUponExpiration=!1),o?{opacity:1,mix:1-Y}:{opacity:Y,mix:0}}return{opacity:1,mix:0}}const Ru=new a.aM(1,0,0,1),jr=new a.aM(0,1,0,1),ps=new a.aM(0,0,1,1),Uo=new a.aM(1,0,1,1),Na=new a.aM(0,1,1,1);function fs(g,o,h,m){Oa(g,0,o+h/2,g.transform.width,h,m)}function la(g,o,h,m){Oa(g,o-h/2,0,h,g.transform.height,m)}function Oa(g,o,h,m,y,v){const E=g.context,P=E.gl;P.enable(P.SCISSOR_TEST),P.scissor(o*g.pixelRatio,h*g.pixelRatio,m*g.pixelRatio,y*g.pixelRatio),E.clear({color:v}),P.disable(P.SCISSOR_TEST)}function no(g,o,h){const m=g.context,y=m.gl,v=h.posMatrix,E=g.useProgram("debug"),P=fr.disabled,B=Zr.disabled,D=g.colorModeForRenderPass(),G="$debug",j=g.style.map.terrain&&g.style.map.terrain.getTerrainData(h);m.activeTexture.set(y.TEXTURE0);const Z=o.getTileByID(h.key).latestRawTileData,Y=Math.floor((Z&&Z.byteLength||0)/1024),X=o.getTile(h).tileSize,tt=512/Math.min(X,512)*(h.overscaledZ/g.transform.zoom)*.5;let ct=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ct+=` => ${h.overscaledZ}`),function(ht,gt){ht.initDebugOverlayCanvas();const pt=ht.debugOverlayCanvas,St=ht.context.gl,Rt=ht.debugOverlayCanvas.getContext("2d");Rt.clearRect(0,0,pt.width,pt.height),Rt.shadowColor="white",Rt.shadowBlur=2,Rt.lineWidth=1.5,Rt.strokeStyle="white",Rt.textBaseline="top",Rt.font="bold 36px Open Sans, sans-serif",Rt.fillText(gt,5,5),Rt.strokeText(gt,5,5),ht.debugOverlayTexture.update(pt),ht.debugOverlayTexture.bind(St.LINEAR,St.CLAMP_TO_EDGE)}(g,`${ct} ${Y}kB`),E.draw(m,y.TRIANGLES,P,B,zr.alphaBlended,Qr.disabled,Hl(v,a.aM.transparent,tt),null,G,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),E.draw(m,y.LINE_STRIP,P,B,D,Qr.disabled,Hl(v,a.aM.red),j,G,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function Yl(g,o,h){const m=g.context,y=m.gl,v=g.colorModeForRenderPass(),E=new fr(y.LEQUAL,fr.ReadWrite,g.depthRangeFor3D),P=g.useProgram("terrain"),B=o.getTerrainMesh();m.bindFramebuffer.set(null),m.viewport.set([0,0,g.width,g.height]);for(const D of h){const G=g.renderToTexture.getTexture(D),j=o.getTerrainData(D.tileID);m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,G.texture);const Z=g.transform.calculatePosMatrix(D.tileID.toUnwrapped()),Y=o.getMeshFrameDelta(g.transform.zoom),X=g.transform.calculateFogMatrix(D.tileID.toUnwrapped()),tt=ql(Z,Y,X,g.style.sky,g.transform.pitch);P.draw(m,y.TRIANGLES,E,Zr.disabled,v,Qr.backCCW,tt,j,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}}class _l{constructor(o,h,m){this.vertexBuffer=o,this.indexBuffer=h,this.segments=m}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Go{constructor(o,h){this.context=new Zn(o),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ge.maxUnderzooming+Ge.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new La}resize(o,h,m){if(this.width=Math.floor(o*m),this.height=Math.floor(h*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const o=this.context,h=new a.aX;h.emplaceBack(0,0),h.emplaceBack(a.X,0),h.emplaceBack(0,a.X),h.emplaceBack(a.X,a.X),this.tileExtentBuffer=o.createVertexBuffer(h,As.members),this.tileExtentSegments=a.a0.simpleSegment(0,0,4,2);const m=new a.aX;m.emplaceBack(0,0),m.emplaceBack(a.X,0),m.emplaceBack(0,a.X),m.emplaceBack(a.X,a.X),this.debugBuffer=o.createVertexBuffer(m,As.members),this.debugSegments=a.a0.simpleSegment(0,0,4,5);const y=new a.$;y.emplaceBack(0,0,0,0),y.emplaceBack(a.X,0,a.X,0),y.emplaceBack(0,a.X,0,a.X),y.emplaceBack(a.X,a.X,a.X,a.X),this.rasterBoundsBuffer=o.createVertexBuffer(y,Ne.members),this.rasterBoundsSegments=a.a0.simpleSegment(0,0,4,2);const v=new a.aX;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(v,As.members),this.viewportSegments=a.a0.simpleSegment(0,0,4,2);const E=new a.aZ;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(E);const P=new a.aY;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(P);const B=this.context.gl;this.stencilClearMode=new Zr({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)}clearStencil(){const o=this.context,h=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=a.H();a.aP(m,0,this.width,this.height,0,0,1),a.K(m,m,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,h.TRIANGLES,fr.disabled,this.stencilClearMode,zr.disabled,Qr.disabled,Un(m),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,h){if(this.currentStencilSource===o.source||!o.isTileClipped()||!h||!h.length)return;this.currentStencilSource=o.source;const m=this.context,y=m.gl;this.nextStencilID+h.length>256&&this.clearStencil(),m.setColorMode(zr.disabled),m.setDepthMode(fr.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const P=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E);v.draw(m,y.TRIANGLES,fr.disabled,new Zr({func:y.ALWAYS,mask:0},P,255,y.KEEP,y.KEEP,y.REPLACE),zr.disabled,Qr.disabled,Un(E.posMatrix),B,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new Zr({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){const h=this.context.gl;return new Zr({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,m=o.sort((E,P)=>P.overscaledZ-E.overscaledZ),y=m[m.length-1].overscaledZ,v=m[0].overscaledZ-y+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const E={};for(let P=0;P<v;P++)E[P+y]=new Zr({func:h.GEQUAL,mask:255},P+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=v,[E,m]}return[{[y]:Zr.disabled},m]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new zr([o.CONSTANT_COLOR,o.ONE],new a.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?zr.unblended:zr.alphaBlended}depthModeForSublayer(o,h,m){if(!this.opaquePassEnabledForLayer())return fr.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new fr(m||this.context.gl.LEQUAL,h,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,h){this.style=o,this.options=h,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(S.now()),this.imageManager.beginFrame();const m=this.style._order,y=this.style.sourceCaches,v={},E={},P={};for(const B in y){const D=y[B];D.used&&D.prepare(this.context),v[B]=D.getVisibleCoordinates(),E[B]=v[B].slice().reverse(),P[B]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<m.length;B++)if(this.style._layers[m[B]].is3D()){this.opaquePassCutoff=B;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const B of m){const D=this.style._layers[B];if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const G=E[D.source];(D.type==="custom"||G.length)&&this.renderLayer(this,y[D.source],D,G)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.aM.black:a.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(B,D){const G=B.context,j=G.gl,Z=((ht,gt,pt)=>({u_sky_color:ht.properties.get("sky-color"),u_horizon_color:ht.properties.get("horizon-color"),u_horizon:(gt.height/2+gt.getHorizon())*pt,u_sky_horizon_blend:ht.properties.get("sky-horizon-blend")*gt.height/2*pt}))(D,B.style.map.transform,B.pixelRatio),Y=new fr(j.LEQUAL,fr.ReadWrite,[0,1]),X=Zr.disabled,tt=B.colorModeForRenderPass(),ct=B.useProgram("sky");if(!D.mesh){const ht=new a.aX;ht.emplaceBack(-1,-1),ht.emplaceBack(1,-1),ht.emplaceBack(1,1),ht.emplaceBack(-1,1);const gt=new a.aY;gt.emplaceBack(0,1,2),gt.emplaceBack(0,2,3),D.mesh=new _l(G.createVertexBuffer(ht,As.members),G.createIndexBuffer(gt),a.a0.simpleSegment(0,0,ht.length,gt.length))}ct.draw(G,j.TRIANGLES,Y,X,tt,Qr.disabled,Z,void 0,"sky",D.mesh.vertexBuffer,D.mesh.indexBuffer,D.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[m[this.currentLayer]],D=y[B.source],G=v[B.source];this._renderTileClippingMasks(B,G),this.renderLayer(this,D,B,G)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const B=this.style._layers[m[this.currentLayer]],D=y[B.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(B))continue;const G=(B.type==="symbol"?P:E)[B.source];this._renderTileClippingMasks(B,v[B.source]),this.renderLayer(this,D,B,G)}if(this.options.showTileBoundaries){const B=function(D,G){let j=null;const Z=Object.values(D._layers).flatMap(ct=>ct.source&&!ct.isHidden(G)?[D.sourceCaches[ct.source]]:[]),Y=Z.filter(ct=>ct.getSource().type==="vector"),X=Z.filter(ct=>ct.getSource().type!=="vector"),tt=ct=>{(!j||j.getSource().maxzoom<ct.getSource().maxzoom)&&(j=ct)};return Y.forEach(ct=>tt(ct)),j||X.forEach(ct=>tt(ct)),j}(this.style,this.transform.zoom);B&&function(D,G,j){for(let Z=0;Z<j.length;Z++)no(D,G,j[Z])}(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const D=B.transform.padding;fs(B,B.transform.height-(D.top||0),3,Ru),fs(B,D.bottom||0,3,jr),la(B,D.left||0,3,ps),la(B,B.transform.width-(D.right||0),3,Uo);const G=B.transform.centerPoint;(function(j,Z,Y,X){Oa(j,Z-1,Y-10,2,20,X),Oa(j,Z-10,Y-1,20,2,X)})(B,G.x,B.transform.height-G.y,Na)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,m=this.transform.modelViewProjectionMatrix;let y=this.terrainFacilitator.dirty;y||(y=o?!a.a_(h,m):!a.a$(h,m)),y||(y=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),y&&(a.b0(h,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(v,E){const P=v.context,B=P.gl,D=zr.unblended,G=new fr(B.LEQUAL,fr.ReadWrite,[0,1]),j=E.getTerrainMesh(),Z=E.sourceCache.getRenderableTiles(),Y=v.useProgram("terrainDepth");P.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),P.clear({color:a.aM.transparent,depth:1});for(const X of Z){const tt=E.getTerrainData(X.tileID),ct={u_matrix:v.transform.calculatePosMatrix(X.tileID.toUnwrapped()),u_ele_delta:E.getMeshFrameDelta(v.transform.zoom)};Y.draw(P,B.TRIANGLES,G,Zr.disabled,D,Qr.backCCW,ct,tt,"terrain",j.vertexBuffer,j.indexBuffer,j.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain),function(v,E){const P=v.context,B=P.gl,D=zr.unblended,G=new fr(B.LEQUAL,fr.ReadWrite,[0,1]),j=E.getTerrainMesh(),Z=E.getCoordsTexture(),Y=E.sourceCache.getRenderableTiles(),X=v.useProgram("terrainCoords");P.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),P.clear({color:a.aM.transparent,depth:1}),E.coordsIndex=[];for(const tt of Y){const ct=E.getTerrainData(tt.tileID);P.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,Z.texture);const ht={u_matrix:v.transform.calculatePosMatrix(tt.tileID.toUnwrapped()),u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(v.transform.zoom)};X.draw(P,B.TRIANGLES,G,Zr.disabled,D,Qr.backCCW,ht,ct,"terrain",j.vertexBuffer,j.indexBuffer,j.segments),E.coordsIndex.push(tt.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain))}renderLayer(o,h,m,y){if(!m.isHidden(this.transform.zoom)&&(m.type==="background"||m.type==="custom"||(y||[]).length))switch(this.id=m.id,m.type){case"symbol":(function(v,E,P,B,D){if(v.renderPass!=="translucent")return;const G=Zr.disabled,j=v.colorModeForRenderPass();(P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Z,Y,X,tt,ct,ht,gt,pt,St){const Rt=Y.transform,Bt=cs(),ie=ct==="map",pe=ht==="map";for(const ye of Z){const we=tt.getTile(ye),ve=we.getBucket(X);if(!ve||!ve.text||!ve.text.segments.get().length)continue;const _e=a.ag(ve.textSizeData,Rt.zoom),Se=Sr(we,1,Y.transform.zoom),Ye=on(ye.posMatrix,pe,ie,Y.transform,Se),Pe=X.layout.get("icon-text-fit")!=="none"&&ve.hasIconData();if(_e){const Ie=Math.pow(2,Rt.zoom-we.tileID.overscaledZ),ir=Y.style.map.terrain?(vr,Tr)=>Y.style.map.terrain.getElevation(ye,vr,Tr):null,Ar=Bt.translatePosition(Rt,we,gt,pt);oa(ve,ie,pe,St,Rt,Ye,ye.posMatrix,Ie,_e,Pe,Bt,Ar,ye.toUnwrapped(),ir)}}}(B,v,P,E,P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),D),P.paint.get("icon-opacity").constantOr(1)!==0&&Yn(v,E,P,B,!1,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),P.layout.get("icon-rotation-alignment"),P.layout.get("icon-pitch-alignment"),P.layout.get("icon-keep-upright"),G,j),P.paint.get("text-opacity").constantOr(1)!==0&&Yn(v,E,P,B,!0,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.layout.get("text-keep-upright"),G,j),E.map.showCollisionBoxes&&(ka(v,E,P,B,!0),ka(v,E,P,B,!1))})(o,h,m,y,this.style.placement.variableOffsets);break;case"circle":(function(v,E,P,B){if(v.renderPass!=="translucent")return;const D=P.paint.get("circle-opacity"),G=P.paint.get("circle-stroke-width"),j=P.paint.get("circle-stroke-opacity"),Z=!P.layout.get("circle-sort-key").isConstant();if(D.constantOr(1)===0&&(G.constantOr(1)===0||j.constantOr(1)===0))return;const Y=v.context,X=Y.gl,tt=v.depthModeForSublayer(0,fr.ReadOnly),ct=Zr.disabled,ht=v.colorModeForRenderPass(),gt=[];for(let pt=0;pt<B.length;pt++){const St=B[pt],Rt=E.getTile(St),Bt=Rt.getBucket(P);if(!Bt)continue;const ie=Bt.programConfigurations.get(P.id),pe=v.useProgram("circle",ie),ye=Bt.layoutVertexBuffer,we=Bt.indexBuffer,ve=v.style.map.terrain&&v.style.map.terrain.getTerrainData(St),_e={programConfiguration:ie,program:pe,layoutVertexBuffer:ye,indexBuffer:we,uniformValues:Mn(v,St,Rt,P),terrainData:ve};if(Z){const Se=Bt.segments.get();for(const Ye of Se)gt.push({segments:new a.a0([Ye]),sortKey:Ye.sortKey,state:_e})}else gt.push({segments:Bt.segments,sortKey:0,state:_e})}Z&&gt.sort((pt,St)=>pt.sortKey-St.sortKey);for(const pt of gt){const{programConfiguration:St,program:Rt,layoutVertexBuffer:Bt,indexBuffer:ie,uniformValues:pe,terrainData:ye}=pt.state;Rt.draw(Y,X.TRIANGLES,tt,ct,ht,Qr.disabled,pe,ye,P.id,Bt,ie,pt.segments,P.paint,v.transform.zoom,St)}})(o,h,m,y);break;case"heatmap":(function(v,E,P,B){if(P.paint.get("heatmap-opacity")===0)return;const D=v.context;if(v.style.map.terrain){for(const G of B){const j=E.getTile(G);E.hasRenderableParent(G)||(v.renderPass==="offscreen"?gl(v,j,P,G):v.renderPass==="translucent"&&io(v,P,G))}D.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?function(G,j,Z,Y){const X=G.context,tt=X.gl,ct=Zr.disabled,ht=new zr([tt.ONE,tt.ONE],a.aM.transparent,[!0,!0,!0,!0]);(function(gt,pt,St){const Rt=gt.gl;gt.activeTexture.set(Rt.TEXTURE1),gt.viewport.set([0,0,pt.width/4,pt.height/4]);let Bt=St.heatmapFbos.get(a.aU);Bt?(Rt.bindTexture(Rt.TEXTURE_2D,Bt.colorAttachment.get()),gt.bindFramebuffer.set(Bt.framebuffer)):(Bt=Fa(gt,pt.width/4,pt.height/4),St.heatmapFbos.set(a.aU,Bt))})(X,G,Z),X.clear({color:a.aM.transparent});for(let gt=0;gt<Y.length;gt++){const pt=Y[gt];if(j.hasRenderableParent(pt))continue;const St=j.getTile(pt),Rt=St.getBucket(Z);if(!Rt)continue;const Bt=Rt.programConfigurations.get(Z.id),ie=G.useProgram("heatmap",Bt),{zoom:pe}=G.transform;ie.draw(X,tt.TRIANGLES,fr.disabled,ct,ht,Qr.disabled,pr(pt.posMatrix,St,pe,Z.paint.get("heatmap-intensity")),null,Z.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,Z.paint,G.transform.zoom,Bt)}X.viewport.set([0,0,G.width,G.height])}(v,E,P,B):v.renderPass==="translucent"&&function(G,j){const Z=G.context,Y=Z.gl;Z.setColorMode(G.colorModeForRenderPass());const X=j.heatmapFbos.get(a.aU);X&&(Z.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,X.colorAttachment.get()),Z.activeTexture.set(Y.TEXTURE1),Bn(Z,j).bind(Y.LINEAR,Y.CLAMP_TO_EDGE),G.useProgram("heatmapTexture").draw(Z,Y.TRIANGLES,fr.disabled,Zr.disabled,G.colorModeForRenderPass(),Qr.disabled,Lc(G,j,0,1),null,j.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments,j.paint,G.transform.zoom))}(v,P)})(o,h,m,y);break;case"line":(function(v,E,P,B){if(v.renderPass!=="translucent")return;const D=P.paint.get("line-opacity"),G=P.paint.get("line-width");if(D.constantOr(1)===0||G.constantOr(1)===0)return;const j=v.depthModeForSublayer(0,fr.ReadOnly),Z=v.colorModeForRenderPass(),Y=P.paint.get("line-dasharray"),X=P.paint.get("line-pattern"),tt=X.constantOr(1),ct=P.paint.get("line-gradient"),ht=P.getCrossfadeParameters(),gt=tt?"linePattern":Y?"lineSDF":ct?"lineGradient":"line",pt=v.context,St=pt.gl;let Rt=!0;for(const Bt of B){const ie=E.getTile(Bt);if(tt&&!ie.patternsLoaded())continue;const pe=ie.getBucket(P);if(!pe)continue;const ye=pe.programConfigurations.get(P.id),we=v.context.program.get(),ve=v.useProgram(gt,ye),_e=Rt||ve.program!==we,Se=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Bt),Ye=X.constantOr(null);if(Ye&&ie.imageAtlas){const ir=ie.imageAtlas,Ar=ir.patternPositions[Ye.to.toString()],vr=ir.patternPositions[Ye.from.toString()];Ar&&vr&&ye.setConstantPatternPositions(Ar,vr)}const Pe=Se?Bt:null,Ie=tt?Ma(v,ie,P,ht,Pe):Y?Bc(v,ie,P,Y,ht,Pe):ct?Iu(v,ie,P,pe.lineClipsArray.length,Pe):js(v,ie,P,Pe);if(tt)pt.activeTexture.set(St.TEXTURE0),ie.imageAtlasTexture.bind(St.LINEAR,St.CLAMP_TO_EDGE),ye.updatePaintBuffers(ht);else if(Y&&(_e||v.lineAtlas.dirty))pt.activeTexture.set(St.TEXTURE0),v.lineAtlas.bind(pt);else if(ct){const ir=pe.gradients[P.id];let Ar=ir.texture;if(P.gradientVersion!==ir.version){let vr=256;if(P.stepInterpolant){const Tr=E.getSource().maxzoom,Dr=Bt.canonical.z===Tr?Math.ceil(1<<v.transform.maxZoom-Bt.canonical.z):1;vr=a.ac(a.aV(pe.maxLineLength/a.X*1024*Dr),256,pt.maxTextureSize)}ir.gradient=a.aW({expression:P.gradientExpression(),evaluationKey:"lineProgress",resolution:vr,image:ir.gradient||void 0,clips:pe.lineClipsArray}),ir.texture?ir.texture.update(ir.gradient):ir.texture=new at(pt,ir.gradient,St.RGBA),ir.version=P.gradientVersion,Ar=ir.texture}pt.activeTexture.set(St.TEXTURE0),Ar.bind(P.stepInterpolant?St.NEAREST:St.LINEAR,St.CLAMP_TO_EDGE)}ve.draw(pt,St.TRIANGLES,j,v.stencilModeForClipping(Bt),Z,Qr.disabled,Ie,Se,P.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,P.paint,v.transform.zoom,ye,pe.layoutVertexBuffer2),Rt=!1}})(o,h,m,y);break;case"fill":(function(v,E,P,B){const D=P.paint.get("fill-color"),G=P.paint.get("fill-opacity");if(G.constantOr(1)===0)return;const j=v.colorModeForRenderPass(),Z=P.paint.get("fill-pattern"),Y=v.opaquePassEnabledForLayer()&&!Z.constantOr(1)&&D.constantOr(a.aM.transparent).a===1&&G.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===Y){const X=v.depthModeForSublayer(1,v.renderPass==="opaque"?fr.ReadWrite:fr.ReadOnly);Da(v,E,P,B,X,j,!1)}if(v.renderPass==="translucent"&&P.paint.get("fill-antialias")){const X=v.depthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,fr.ReadOnly);Da(v,E,P,B,X,j,!0)}})(o,h,m,y);break;case"fill-extrusion":(function(v,E,P,B){const D=P.paint.get("fill-extrusion-opacity");if(D!==0&&v.renderPass==="translucent"){const G=new fr(v.context.gl.LEQUAL,fr.ReadWrite,v.depthRangeFor3D);if(D!==1||P.paint.get("fill-extrusion-pattern").constantOr(1))Zl(v,E,P,B,G,Zr.disabled,zr.disabled),Zl(v,E,P,B,G,v.stencilModeFor3D(),v.colorModeForRenderPass());else{const j=v.colorModeForRenderPass();Zl(v,E,P,B,G,Zr.disabled,j)}}})(o,h,m,y);break;case"hillshade":(function(v,E,P,B){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const D=v.context,G=v.depthModeForSublayer(0,fr.ReadOnly),j=v.colorModeForRenderPass(),[Z,Y]=v.renderPass==="translucent"?v.stencilConfigForOverlap(B):[{},B];for(const X of Y){const tt=E.getTile(X);tt.needsHillshadePrepare!==void 0&&tt.needsHillshadePrepare&&v.renderPass==="offscreen"?aa(v,tt,P,G,Zr.disabled,j):v.renderPass==="translucent"&&Jn(v,X,tt,P,G,Z[X.overscaledZ],j)}D.viewport.set([0,0,v.width,v.height])})(o,h,m,y);break;case"raster":(function(v,E,P,B){if(v.renderPass!=="translucent"||P.paint.get("raster-opacity")===0||!B.length)return;const D=v.context,G=D.gl,j=E.getSource(),Z=v.useProgram("raster"),Y=v.colorModeForRenderPass(),[X,tt]=j instanceof rr?[{},B]:v.stencilConfigForOverlap(B),ct=tt[tt.length-1].overscaledZ,ht=!v.options.moving;for(const gt of tt){const pt=v.depthModeForSublayer(gt.overscaledZ-ct,P.paint.get("raster-opacity")===1?fr.ReadWrite:fr.ReadOnly,G.LESS),St=E.getTile(gt);St.registerFadeDuration(P.paint.get("raster-fade-duration"));const Rt=E.findLoadedParent(gt,0),Bt=E.findLoadedSibling(gt),ie=Ih(St,Rt||Bt||null,E,P,v.transform,v.style.map.terrain);let pe,ye;const we=P.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR;D.activeTexture.set(G.TEXTURE0),St.texture.bind(we,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),D.activeTexture.set(G.TEXTURE1),Rt?(Rt.texture.bind(we,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),pe=Math.pow(2,Rt.tileID.overscaledZ-St.tileID.overscaledZ),ye=[St.tileID.canonical.x*pe%1,St.tileID.canonical.y*pe%1]):St.texture.bind(we,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),St.texture.useMipmap&&D.extTextureFilterAnisotropic&&v.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const ve=v.style.map.terrain&&v.style.map.terrain.getTerrainData(gt),_e=ve?gt:null,Se=_e?_e.posMatrix:v.transform.calculatePosMatrix(gt.toUnwrapped(),ht),Ye=Ld(Se,ye||[0,0],pe||1,ie,P);j instanceof rr?Z.draw(D,G.TRIANGLES,pt,Zr.disabled,Y,Qr.disabled,Ye,ve,P.id,j.boundsBuffer,v.quadTriangleIndexBuffer,j.boundsSegments):Z.draw(D,G.TRIANGLES,pt,X[gt.overscaledZ],Y,Qr.disabled,Ye,ve,P.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}})(o,h,m,y);break;case"background":(function(v,E,P,B){const D=P.paint.get("background-color"),G=P.paint.get("background-opacity");if(G===0)return;const j=v.context,Z=j.gl,Y=v.transform,X=Y.tileSize,tt=P.paint.get("background-pattern");if(v.isPatternMissing(tt))return;const ct=!tt&&D.a===1&&G===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==ct)return;const ht=Zr.disabled,gt=v.depthModeForSublayer(0,ct==="opaque"?fr.ReadWrite:fr.ReadOnly),pt=v.colorModeForRenderPass(),St=v.useProgram(tt?"backgroundPattern":"background"),Rt=B||Y.coveringTiles({tileSize:X,terrain:v.style.map.terrain});tt&&(j.activeTexture.set(Z.TEXTURE0),v.imageManager.bind(v.context));const Bt=P.getCrossfadeParameters();for(const ie of Rt){const pe=B?ie.posMatrix:v.transform.calculatePosMatrix(ie.toUnwrapped()),ye=tt?Ba(pe,G,v,tt,{tileID:ie,tileSize:X},Bt):Fc(pe,G,D),we=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ie);St.draw(j,Z.TRIANGLES,gt,ht,pt,Qr.disabled,ye,we,P.id,v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}})(o,0,m,y);break;case"custom":(function(v,E,P){const B=v.context,D=P.implementation;if(v.renderPass==="offscreen"){const G=D.prerender;G&&(v.setCustomLayerDefaults(),B.setColorMode(v.colorModeForRenderPass()),G.call(D,B.gl,v.transform.customLayerMatrix()),B.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),B.setColorMode(v.colorModeForRenderPass()),B.setStencilMode(Zr.disabled);const G=D.renderingMode==="3d"?new fr(v.context.gl.LEQUAL,fr.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,fr.ReadOnly);B.setDepthMode(G),D.render(B.gl,v.transform.customLayerMatrix(),{farZ:v.transform.farZ,nearZ:v.transform.nearZ,fov:v.transform._fov,modelViewProjectionMatrix:v.transform.modelViewProjectionMatrix,projectionMatrix:v.transform.projectionMatrix}),B.setDirty(),v.setBaseState(),B.bindFramebuffer.set(null)}})(o,0,m)}}translatePosMatrix(o,h,m,y,v){if(!m[0]&&!m[1])return o;const E=v?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(E){const D=Math.sin(E),G=Math.cos(E);m=[m[0]*G-m[1]*D,m[0]*D+m[1]*G]}const P=[v?m[0]:Sr(h,m[0],this.transform.zoom),v?m[1]:Sr(h,m[1],this.transform.zoom),0],B=new Float32Array(16);return a.J(B,o,P),B}saveTileTexture(o){const h=this._tileTextures[o.size[0]];h?h.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const h=this.imageManager.getPattern(o.from.toString()),m=this.imageManager.getPattern(o.to.toString());return!h||!m}useProgram(o,h){this.cache=this.cache||{};const m=o+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[m]||(this.cache[m]=new _t(this.context,hs[o],h,$l[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[m]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new at(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:h}=this.context.gl;return this.width!==o||this.height!==h}}class Kn{constructor(o,h){this.points=o,this.planes=h}static fromInvProjectionMatrix(o,h,m){const y=Math.pow(2,m),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const B=1/(P=a.af([],P,o))[3]/h*y;return a.b1(P,P,[B,B,1/P[3],B])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const B=function(Z,Y){var X=Y[0],tt=Y[1],ct=Y[2],ht=X*X+tt*tt+ct*ct;return ht>0&&(ht=1/Math.sqrt(ht)),Z[0]=Y[0]*ht,Z[1]=Y[1]*ht,Z[2]=Y[2]*ht,Z}([],function(Z,Y,X){var tt=Y[0],ct=Y[1],ht=Y[2],gt=X[0],pt=X[1],St=X[2];return Z[0]=ct*St-ht*pt,Z[1]=ht*gt-tt*St,Z[2]=tt*pt-ct*gt,Z}([],vt([],v[P[0]],v[P[1]]),vt([],v[P[2]],v[P[1]]))),D=-((G=B)[0]*(j=v[P[1]])[0]+G[1]*j[1]+G[2]*j[2]);var G,j;return B.concat(D)});return new Kn(v,E)}}class Ts{constructor(o,h){this.min=o,this.max=h,this.center=function(m,y,v){return m[0]=.5*y[0],m[1]=.5*y[1],m[2]=.5*y[2],m}([],function(m,y,v){return m[0]=y[0]+v[0],m[1]=y[1]+v[1],m[2]=y[2]+v[2],m}([],this.min,this.max))}quadrant(o){const h=[o%2==0,o<2],m=yt(this.min),y=yt(this.max);for(let v=0;v<h.length;v++)m[v]=h[v]?this.min[v]:this.center[v],y[v]=h[v]?this.center[v]:this.max[v];return y[2]=this.max[2],new Ts(m,y)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let m=!0;for(let y=0;y<o.planes.length;y++){const v=o.planes[y];let E=0;for(let P=0;P<h.length;P++)a.b2(v,h[P])>=0&&E++;if(E===0)return 0;E!==h.length&&(m=!1)}if(m)return 2;for(let y=0;y<3;y++){let v=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let P=0;P<o.points.length;P++){const B=o.points[P][y]-this.min[y];v=Math.min(v,B),E=Math.max(E,B)}if(E<0||v>this.max[y]-this.min[y])return 0}return 1}}class so{constructor(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=m,this.right=y}interpolate(o,h,m){return h.top!=null&&o.top!=null&&(this.top=a.y.number(o.top,h.top,m)),h.bottom!=null&&o.bottom!=null&&(this.bottom=a.y.number(o.bottom,h.bottom,m)),h.left!=null&&o.left!=null&&(this.left=a.y.number(o.left,h.left,m)),h.right!=null&&o.right!=null&&(this.right=a.y.number(o.right,h.right,m)),this}getCenter(o,h){const m=a.ac((this.left+o-this.right)/2,0,o),y=a.ac((this.top+h-this.bottom)/2,0,h);return new a.P(m,y)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new so(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const vl=85.051129;class oo{constructor(o,h,m,y,v){this.tileSize=512,this._renderWorldCopies=v===void 0||!!v,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=m??0,this._maxPitch=y??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new so,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const o=new oo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.lngRange=o.lngRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this.minElevationForCurrentTile=o.minElevationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const h=-a.b3(o,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var m=new a.A(4);return a.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}(),function(m,y,v){var E=y[0],P=y[1],B=y[2],D=y[3],G=Math.sin(v),j=Math.cos(v);m[0]=E*j+B*G,m[1]=P*j+D*G,m[2]=E*-G+B*j,m[3]=P*-G+D*j}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=a.ac(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,m){this._unmodified=!1,this._edgeInsets.interpolate(o,h,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new a.b4(0,o)];if(this._renderWorldCopies){const m=this.pointCoordinate(new a.P(0,0)),y=this.pointCoordinate(new a.P(this.width,0)),v=this.pointCoordinate(new a.P(this.width,this.height)),E=this.pointCoordinate(new a.P(0,this.height)),P=Math.floor(Math.min(m.x,y.x,v.x,E.x)),B=Math.floor(Math.max(m.x,y.x,v.x,E.x)),D=1;for(let G=P-D;G<=B+D;G++)G!==0&&h.push(new a.b4(G,o))}return h}coveringTiles(o){var h,m;let y=this.coveringZoomLevel(o);const v=y;if(o.minzoom!==void 0&&y<o.minzoom)return[];o.maxzoom!==void 0&&y>o.maxzoom&&(y=o.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),P=a.Z.fromLngLat(this.center),B=Math.pow(2,y),D=[B*E.x,B*E.y,0],G=[B*P.x,B*P.y,0],j=Kn.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,y);let Z=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Z=y);const Y=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,X=pt=>({aabb:new Ts([pt*B,0,0],[(pt+1)*B,B,0]),zoom:0,x:0,y:0,wrap:pt,fullyVisible:!1}),tt=[],ct=[],ht=y,gt=o.reparseOverscaled?v:y;if(this._renderWorldCopies)for(let pt=1;pt<=3;pt++)tt.push(X(-pt)),tt.push(X(pt));for(tt.push(X(0));tt.length>0;){const pt=tt.pop(),St=pt.x,Rt=pt.y;let Bt=pt.fullyVisible;if(!Bt){const ve=pt.aabb.intersects(j);if(ve===0)continue;Bt=ve===2}const ie=o.terrain?D:G,pe=pt.aabb.distanceX(ie),ye=pt.aabb.distanceY(ie),we=Math.max(Math.abs(pe),Math.abs(ye));if(pt.zoom===ht||we>Y+(1<<ht-pt.zoom)-2&&pt.zoom>=Z){const ve=ht-pt.zoom,_e=D[0]-.5-(St<<ve),Se=D[1]-.5-(Rt<<ve);ct.push({tileID:new a.S(pt.zoom===ht?gt:pt.zoom,pt.wrap,pt.zoom,St,Rt),distanceSq:mt([G[0]-.5-St,G[1]-.5-Rt]),tileDistanceToCamera:Math.sqrt(_e*_e+Se*Se)})}else for(let ve=0;ve<4;ve++){const _e=(St<<1)+ve%2,Se=(Rt<<1)+(ve>>1),Ye=pt.zoom+1;let Pe=pt.aabb.quadrant(ve);if(o.terrain){const Ie=new a.S(Ye,pt.wrap,Ye,_e,Se),ir=o.terrain.getMinMaxElevation(Ie),Ar=(h=ir.minElevation)!==null&&h!==void 0?h:this.elevation,vr=(m=ir.maxElevation)!==null&&m!==void 0?m:this.elevation;Pe=new Ts([Pe.min[0],Pe.min[1],Ar],[Pe.max[0],Pe.max[1],vr])}tt.push({aabb:Pe,zoom:Ye,x:_e,y:Se,wrap:pt.wrap,fullyVisible:Bt})}}return ct.sort((pt,St)=>pt.distanceSq-St.distanceSq).map(pt=>pt.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=a.ac(o.lat,-85.051129,vl);return new a.P(a.O(o.lng)*this.worldSize,a.Q(h)*this.worldSize)}unproject(o){return new a.Z(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const h=this.elevation,m=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,y=this.pointLocation(this.centerPoint,o),v=o.getElevationForLngLatZoom(y,this.tileZoom);if(!(this.elevation-v))return;const E=m+h-v,P=Math.cos(this._pitch)*this.cameraToCenterDistance/E/a.b5(1,y.lat),B=this.scaleZoom(P/this.tileSize);this._elevation=v,this._center=y,this.zoom=B}setLocationAtPoint(o,h){const m=this.pointCoordinate(h),y=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(o),E=new a.Z(v.x-(m.x-y.x),v.y-(m.y-y.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,h){return h?this.coordinatePoint(this.locationCoordinate(o),h.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,h){return this.coordinateLocation(this.pointCoordinate(o,h))}locationCoordinate(o){return a.Z.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,h){if(h){const Z=h.pointCoordinate(o);if(Z!=null)return Z}const m=[o.x,o.y,0,1],y=[o.x,o.y,1,1];a.af(m,m,this.pixelMatrixInverse),a.af(y,y,this.pixelMatrixInverse);const v=m[3],E=y[3],P=m[1]/v,B=y[1]/E,D=m[2]/v,G=y[2]/E,j=D===G?0:(0-D)/(G-D);return new a.Z(a.y.number(m[0]/v,y[0]/E,j)/this.worldSize,a.y.number(P,B,j)/this.worldSize)}coordinatePoint(o){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const y=[o.x*this.worldSize,o.y*this.worldSize,h,1];return a.af(y,y,m),new a.P(y[0]/y[3],y[1]/y[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new st().extend(this.pointLocation(new a.P(0,o))).extend(this.pointLocation(new a.P(this.width,o))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new st([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,vl])}calculateTileMatrix(o){const h=o.canonical,m=this.worldSize/this.zoomScale(h.z),y=h.x+Math.pow(2,h.z)*o.wrap,v=a.an(new Float64Array(16));return a.J(v,v,[y*m,h.y*m,0]),a.K(v,v,[m/a.X,m/a.X,1]),v}calculatePosMatrix(o){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const m=o.key,y=h?this._alignedPosMatrixCache:this._posMatrixCache;if(y[m])return y[m];const v=this.calculateTileMatrix(o);return a.L(v,h?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,v),y[m]=new Float32Array(v),y[m]}calculateFogMatrix(o){const h=o.key,m=this._fogMatrixCache;if(m[h])return m[h];const y=this.calculateTileMatrix(o);return a.L(y,this.fogMatrix,y),m[h]=new Float32Array(y),m[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(o,h){h=a.ac(+h,this.minZoom,this.maxZoom);const m={center:new a.N(o.lng,o.lat),zoom:h};let y=this.lngRange;if(!this._renderWorldCopies&&y===null){const pt=179.9999999999;y=[-pt,pt]}const v=this.tileSize*this.zoomScale(m.zoom);let E=0,P=v,B=0,D=v,G=0,j=0;const{x:Z,y:Y}=this.size;if(this.latRange){const pt=this.latRange;E=a.Q(pt[1])*v,P=a.Q(pt[0])*v,P-E<Y&&(G=Y/(P-E))}y&&(B=a.b3(a.O(y[0])*v,0,v),D=a.b3(a.O(y[1])*v,0,v),D<B&&(D+=v),D-B<Z&&(j=Z/(D-B)));const{x:X,y:tt}=this.project.call({worldSize:v},o);let ct,ht;const gt=Math.max(j||0,G||0);if(gt){const pt=new a.P(j?(D+B)/2:X,G?(P+E)/2:tt);return m.center=this.unproject.call({worldSize:v},pt).wrap(),m.zoom+=this.scaleZoom(gt),m}if(this.latRange){const pt=Y/2;tt-pt<E&&(ht=E+pt),tt+pt>P&&(ht=P-pt)}if(y){const pt=(B+D)/2;let St=X;this._renderWorldCopies&&(St=a.b3(X,pt-v/2,pt+v/2));const Rt=Z/2;St-Rt<B&&(ct=B+Rt),St+Rt>D&&(ct=D-Rt)}if(ct!==void 0||ht!==void 0){const pt=new a.P(ct??X,ht??tt);m.center=this.unproject.call({worldSize:v},pt).wrap()}return m}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:h,zoom:m}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=m,this._unmodified=o,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,h=this.point.x,m=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b5(1,this.center.lat)*this.worldSize;let y=a.an(new Float64Array(16));a.K(y,y,[this.width/2,-this.height/2,1]),a.J(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=a.an(new Float64Array(16)),a.K(y,y,[1,-1,1]),a.J(y,y,[-1,-1,0]),a.K(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y;const v=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),E=Math.min(this.elevation,this.minElevationForCurrentTile),P=v-E*this._pixelPerMeter/Math.cos(this._pitch),B=E<0?P:v,D=Math.PI/2+this._pitch,G=this._fov*(.5+o.y/this.height),j=Math.sin(G)*B/Math.sin(a.ac(Math.PI-D-G,.01,Math.PI-.01)),Z=this.getHorizon(),Y=2*Math.atan(Z/this.cameraToCenterDistance)*(.5+o.y/(2*Z)),X=Math.sin(Y)*B/Math.sin(a.ac(Math.PI-D-Y,.01,Math.PI-.01)),tt=Math.min(j,X);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*tt+B),this.nearZ=this.height/50,y=new Float64Array(16),a.b6(y,this._fov,this.width/this.height,this.nearZ,this.farZ),y[8]=2*-o.x/this.width,y[9]=2*o.y/this.height,this.projectionMatrix=a.ae(y),a.K(y,y,[1,-1,1]),a.J(y,y,[0,0,-this.cameraToCenterDistance]),a.b7(y,y,this._pitch),a.ad(y,y,this.angle),a.J(y,y,[-h,-m,0]),this.mercatorMatrix=a.K([],y,[this.worldSize,this.worldSize,this.worldSize]),a.K(y,y,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.L(new Float64Array(16),this.labelPlaneMatrix,y),a.J(y,y,[0,0,-this.elevation]),this.modelViewProjectionMatrix=y,this.invModelViewProjectionMatrix=a.as([],y),this.fogMatrix=new Float64Array(16),a.b6(this.fogMatrix,this._fov,this.width/this.height,v,this.farZ),this.fogMatrix[8]=2*-o.x/this.width,this.fogMatrix[9]=2*o.y/this.height,a.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b7(this.fogMatrix,this.fogMatrix,this._pitch),a.ad(this.fogMatrix,this.fogMatrix,this.angle),a.J(this.fogMatrix,this.fogMatrix,[-h,-m,0]),a.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=a.L(new Float64Array(16),this.labelPlaneMatrix,y);const ct=this.width%2/2,ht=this.height%2/2,gt=Math.cos(this.angle),pt=Math.sin(this.angle),St=h-Math.round(h)+gt*ct+pt*ht,Rt=m-Math.round(m)+gt*ht+pt*ct,Bt=new Float64Array(y);if(a.J(Bt,Bt,[St>.5?St-1:St,Rt>.5?Rt-1:Rt,0]),this.alignedModelViewProjectionMatrix=Bt,y=a.as(new Float64Array(16),this.pixelMatrix),!y)throw new Error("failed to invert matrix");this.pixelMatrixInverse=y,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new a.P(0,0)),h=[o.x*this.worldSize,o.y*this.worldSize,0,1];return a.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,o))}getCameraQueryGeometry(o){const h=this.getCameraPoint();if(o.length===1)return[o[0],h];{let m=h.x,y=h.y,v=h.x,E=h.y;for(const P of o)m=Math.min(m,P.x),y=Math.min(y,P.y),v=Math.max(v,P.x),E=Math.max(E,P.y);return[new a.P(m,y),new a.P(v,y),new a.P(v,E),new a.P(m,E),new a.P(m,y)]}}lngLatToCameraDepth(o,h){const m=this.locationCoordinate(o),y=[m.x*this.worldSize,m.y*this.worldSize,h,1];return a.af(y,y,this.modelViewProjectionMatrix),y[2]/y[3]}}function ao(g,o){var h=this;let m,y=!1,v=null,E=null;const P=()=>{v=null,y&&(g.apply(E,m),v=setTimeout(P,o),y=!1)};return function(){for(var B=arguments.length,D=new Array(B),G=0;G<B;G++)D[G]=arguments[G];return y=!0,E=h,m=D,v||P(),v}}class bl{constructor(o){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let m;return h.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(m=y)}),(m&&m[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(m=>isNaN(m))){const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:m,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const m=h.join("/");let y=m;y.split("&").length>0&&(y=y.split("&")[0]),this._hashName&&(y=`${this._hashName}=${m}`);let v=window.location.hash.replace(y,"");v.startsWith("#&")?v=v.slice(0,1)+v.slice(2):v==="#"&&(v="");let E=window.location.href.replace(/(#.+)?$/,v);E=E.replace("&&","&"),window.history.replaceState(window.history.state,null,E)},this._updateHash=ao(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(o){const h=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,y),E=Math.round(h.lng*v)/v,P=Math.round(h.lat*v)/v,B=this._map.getBearing(),D=this._map.getPitch();let G="";if(G+=o?`/${E}/${P}/${m}`:`${m}/${P}/${E}`,(B||D)&&(G+="/"+Math.round(10*B)/10),D&&(G+=`/${Math.round(D)}`),this._hashName){const j=this._hashName;let Z=!1;const Y=window.location.hash.slice(1).split("&").map(X=>{const tt=X.split("=")[0];return tt===j?(Z=!0,`${tt}=${G}`):X}).filter(X=>X);return Z||Y.push(`${j}=${G}`),`#${Y.join("&")}`}return`#${G}`}}const ms={linearity:.3,easing:a.b8(0,0,.3,1)},Vo=a.e({deceleration:2500,maxSpeed:1400},ms),Mi=a.e({deceleration:20,maxSpeed:1400},ms),Si=a.e({deceleration:1e3,maxSpeed:360},ms),qi=a.e({deceleration:1e3,maxSpeed:90},ms);class cn{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:S.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=S.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)h.zoom+=v.zoomDelta||0,h.bearing+=v.bearingDelta||0,h.pitch+=v.pitchDelta||0,v.panDelta&&h.pan._add(v.panDelta),v.around&&(h.around=v.around),v.pinchAround&&(h.pinchAround=v.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(h.pan.mag()){const v=lo(h.pan.mag(),m,a.e({},Vo,o||{}));y.offset=h.pan.mult(v.amount/h.pan.mag()),y.center=this._map.transform.center,Gs(y,v)}if(h.zoom){const v=lo(h.zoom,m,Mi);y.zoom=this._map.transform.zoom+v.amount,Gs(y,v)}if(h.bearing){const v=lo(h.bearing,m,Si);y.bearing=this._map.transform.bearing+a.ac(v.amount,-179,179),Gs(y,v)}if(h.pitch){const v=lo(h.pitch,m,qi);y.pitch=this._map.transform.pitch+v.amount,Gs(y,v)}if(y.zoom||y.bearing){const v=h.pinchAround===void 0?h.around:h.pinchAround;y.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),a.e(y,{noMoveStart:!0})}}function Gs(g,o){(!g.duration||g.duration<o.duration)&&(g.duration=o.duration,g.easing=o.easing)}function lo(g,o,h){const{maxSpeed:m,linearity:y,deceleration:v}=h,E=a.ac(g*y/(o/1e3),-m,m),P=Math.abs(E)/(v*y);return{easing:h.easing,duration:1e3*P,amount:E*(P/2)}}class un extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const v=C.mousePos(h.getCanvas(),m),E=h.unproject(v);super(o,a.e({point:v,lngLat:E,originalEvent:m},y)),this._defaultPrevented=!1,this.target=h}}class ca extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,m){const y=o==="touchend"?m.changedTouches:m.touches,v=C.touchPos(h.getCanvasContainer(),y),E=v.map(B=>h.unproject(B)),P=v.reduce((B,D,G,j)=>B.add(D.div(j.length)),new a.P(0,0));super(o,{points:v,point:P,lngLats:E,lngLat:h.unproject(P),originalEvent:m}),this._defaultPrevented=!1}}class kd extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,m){super(o,{originalEvent:m}),this._defaultPrevented=!1}}class Rd{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new kd(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new un(o.type,this._map,o))}mouseup(o){this._map.fire(new un(o.type,this._map,o))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new un(o.type,this._map,o))}dblclick(o){return this._firePreventable(new un(o.type,this._map,o))}mouseover(o){this._map.fire(new un(o.type,this._map,o))}mouseout(o){this._map.fire(new un(o.type,this._map,o))}touchstart(o){return this._firePreventable(new ca(o.type,this._map,o))}touchmove(o){this._map.fire(new ca(o.type,this._map,o))}touchend(o){this._map.fire(new ca(o.type,this._map,o))}touchcancel(o){this._map.fire(new ca(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zi{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new un(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new un("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new un(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class co{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(a.P.convert(o),this._map.terrain)}}class Cs{constructor(o,h){this._map=o,this._tr=new co(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(C.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const m=h;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=m,this._box||(this._box=C.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const v=Math.min(y.x,m.x),E=Math.max(y.x,m.x),P=Math.min(y.y,m.y),B=Math.max(y.y,m.y);C.setTransform(this._box,`translate(${v}px,${P}px)`),this._box.style.width=E-v+"px",this._box.style.height=B-P+"px"}mouseupWindow(o,h){if(!this._active||o.button!==0)return;const m=this._startPos,y=h;if(this.reset(),C.suppressClick(),m.x!==y.x||m.y!==y.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:o})),{cameraAnimation:v=>v.fitScreenCoordinates(m,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(C.remove(this._box),this._box=null),C.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new a.k(o,{originalEvent:h}))}}function Vc(g,o){if(g.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${o.length}`);const h={};for(let m=0;m<g.length;m++)h[g[m].identifier]=o[m];return h}class Fu{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,h,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){const v=new a.P(0,0);for(const E of y)v._add(E);return v.div(y.length)}(h),this.touches=Vc(m,h)))}touchmove(o,h,m){if(this.aborted||!this.centroid)return;const y=Vc(m,h);for(const v in this.touches){const E=y[v];(!E||E.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(o,h,m){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Jl{constructor(o){this.singleTap=new Fu(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,h,m){this.singleTap.touchstart(o,h,m)}touchmove(o,h,m){this.singleTap.touchmove(o,h,m)}touchend(o,h,m){const y=this.singleTap.touchend(o,h,m);if(y){const v=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(y)<30;if(v&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class kn{constructor(o){this._tr=new co(o),this._zoomIn=new Jl({numTouches:1,numTaps:2}),this._zoomOut=new Jl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,m){this._zoomIn.touchstart(o,h,m),this._zoomOut.touchstart(o,h,m)}touchmove(o,h,m){this._zoomIn.touchmove(o,h,m),this._zoomOut.touchmove(o,h,m)}touchend(o,h,m){const y=this._zoomIn.touchend(o,h,m),v=this._zoomOut.touchend(o,h,m),E=this._tr;return y?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(y)},{originalEvent:o})}):v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(v)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yn{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(){const o=this._moveFunction(...arguments);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(o,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,h){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const y=h.length?h[0]:h;return!this._moved&&y.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(m,y))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&C.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const qc={0:1,2:2};class Kl{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const h=C.mouseButton(o);this._eventButton=h}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(h,m){const y=qc[m];return h.buttons===void 0||(h.buttons&y)!==y}(o,this._eventButton)}isValidEndEvent(o){return C.mouseButton(o)===this._eventButton}}class Lh{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const Ql=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=o=>{o.preventDefault()}},Hc=g=>{let{enable:o,clickTolerance:h,bearingDegreesPerPixelMoved:m=.8}=g;const y=new Kl({checkCorrectEvent:v=>C.mouseButton(v)===0&&v.ctrlKey||C.mouseButton(v)===2});return new yn({clickTolerance:h,move:(v,E)=>({bearingDelta:(E.x-v.x)*m}),moveStateManager:y,enable:o,assignEvents:Ql})},Du=g=>{let{enable:o,clickTolerance:h,pitchDegreesPerPixelMoved:m=-.5}=g;const y=new Kl({checkCorrectEvent:v=>C.mouseButton(v)===0&&v.ctrlKey||C.mouseButton(v)===2});return new yn({clickTolerance:h,move:(v,E)=>({pitchDelta:(E.y-v.y)*m}),moveStateManager:y,enable:o,assignEvents:Ql})};class wl{constructor(o,h){this._clickTolerance=o.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(o){return o<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(o,h,m){return this._calculateTransform(o,h,m)}touchmove(o,h,m){if(this._active){if(!this._shouldBePrevented(m.length))return o.preventDefault(),this._calculateTransform(o,h,m);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",o)}}touchend(o,h,m){this._calculateTransform(o,h,m),this._active&&this._shouldBePrevented(m.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,m){m.length>0&&(this._active=!0);const y=Vc(m,h),v=new a.P(0,0),E=new a.P(0,0);let P=0;for(const D in y){const G=y[D],j=this._touches[D];j&&(v._add(G),E._add(G.sub(j)),P++,y[D]=G)}if(this._touches=y,this._shouldBePrevented(P)||!E.mag())return;const B=E.div(P);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(P),panDelta:B}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $c{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,h,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,m){if(!this._firstTwoTouches)return;o.preventDefault();const[y,v]=this._firstTwoTouches,E=tc(m,h,y),P=tc(m,h,v);if(!E||!P)return;const B=this._aroundCenter?null:E.add(P).div(2);return this._move([E,P],B,o)}touchend(o,h,m){if(!this._firstTwoTouches)return;const[y,v]=this._firstTwoTouches,E=tc(m,h,y),P=tc(m,h,v);E&&P||(this._active&&C.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function tc(g,o,h){for(let m=0;m<g.length;m++)if(g[m].identifier===h)return o[m]}function Wc(g,o){return Math.log(g/o)/Math.LN2}class Nu extends $c{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const m=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Wc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Wc(this._distance,m),pinchAround:h}}}function Fd(g,o){return 180*g.angleWith(o)/Math.PI}class Dd extends $c{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h,m){const y=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Fd(this._vector,y),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,m=Fd(o,this._startVector);return Math.abs(m)<h}}function Ou(g){return Math.abs(g.y)>Math.abs(g.x)}class Xc extends $c{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,h,m){super.touchstart(o,h,m),this._currentTouchCount=m.length}_start(o){this._lastPoints=o,Ou(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const y=o[0].sub(this._lastPoints[0]),v=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,v,m.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(y.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(o,h,m){if(this._valid!==void 0)return this._valid;const y=o.mag()>=2,v=h.mag()>=2;if(!y&&!v)return;if(!y||!v)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const E=o.y>0==h.y>0;return Ou(o)&&Ou(h)&&E}}const Gp={panStep:100,bearingStep:15,pitchStep:10};class uo{constructor(o){this._tr=new co(o);const h=Gp;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,m=0,y=0,v=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?m=-1:(o.preventDefault(),v=-1);break;case 39:o.shiftKey?m=1:(o.preventDefault(),v=1);break;case 38:o.shiftKey?y=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?y=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:P=>{const B=this._tr;P.easeTo({duration:300,easeId:"keyboardHandler",easing:ua,zoom:h?Math.round(B.zoom)+h*(o.shiftKey?2:1):B.zoom,bearing:B.bearing+m*this._bearingStep,pitch:B.pitch+y*this._pitchStep,offset:[-v*this._panStep,-E*this._panStep],center:B.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ua(g){return g*(2-g)}const Nd=4.000244140625;class Vs{constructor(o,h){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=o,this._tr=new co(o),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(o){return!!this._map.cooperativeGestures.isEnabled()&&!(o.ctrlKey||this._map.cooperativeGestures.isBypassed(o))}wheel(o){if(!this.isEnabled())return;if(this._shouldBePrevented(o))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",o);let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const m=S.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,h!==0&&h%Nd==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(y*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=C.mousePos(this._map.getCanvas(),o),m=this._tr;this._around=h.y>m.transform.height/2-m.transform.getHorizon()?a.N.convert(this._aroundCenter?m.center:m.unproject(h)):a.N.convert(m.center),this._aroundPoint=m.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>Nd?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&D!==0&&(D=1/D);const G=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(G*D))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,m=this._startZoom,y=this._easing;let v,E=!1;const P=S.now()-this._lastWheelEventTime;if(this._type==="wheel"&&m&&y&&P){const B=Math.min(P/200,1),D=y(B);v=a.y.number(m,h,D),B<1?this._frameId||(this._frameId=!0):E=!0}else v=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:v-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=a.b9;if(this._prevEase){const m=this._prevEase,y=(S.now()-m.start)/m.duration,v=m.easing(y+.01)-m.easing(y),E=.27/Math.sqrt(v*v+1e-4)*.01,P=Math.sqrt(.0729-E*E);h=a.b8(E,P,.25,1)}return this._prevEase={start:S.now(),duration:o,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class za{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zu{constructor(o){this._tr=new co(o),this.reset()}reset(){this._active=!1}dblclick(o,h){return o.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fm{constructor(){this._tap=new Jl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,h,m){if(!this._swipePoint)if(this._tapTime){const y=h[0],v=o.timeStamp-this._tapTime<500,E=this._tapPoint.dist(y)<30;v&&E?m.length>0&&(this._swipePoint=y,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(o,h,m)}touchmove(o,h,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=h[0],v=y.y-this._swipePoint.y;return this._swipePoint=y,o.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(o,h,m)}touchend(o,h,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const y=this._tap.touchend(o,h,m);y&&(this._tapTime=o.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vp{constructor(o,h,m){this._el=o,this._mousePan=h,this._touchPan=m}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Od{constructor(o,h,m){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zd{constructor(o,h,m,y){this._el=o,this._touchZoom=h,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Zc{constructor(o,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=C.create("div","maplibregl-cooperative-gesture-screen",o);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),y=document.createElement("div");y.className="maplibregl-desktop-message",y.textContent=h,this._container.appendChild(y);const v=document.createElement("div");v.className="maplibregl-mobile-message",v.textContent=m,this._container.appendChild(v),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(C.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(o){return o[this._bypassKey]}notifyGestureBlocked(o,h){this._enabled&&(this._map.fire(new a.k("cooperativegestureprevented",{gestureType:o,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ho=g=>g.zoom||g.drag||g.pitch||g.rotate;class qe extends a.k{}function qo(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class qs{constructor(o,h){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,v)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=y.type==="renderFrame"?void 0:y,P={needsRenderFrame:!1},B={},D={},G=y.touches,j=G?this._getMapTouches(G):void 0,Z=j?C.touchPos(this._map.getCanvas(),j):C.mousePos(this._map.getCanvas(),y);for(const{handlerName:tt,handler:ct,allowed:ht}of this._handlers){if(!ct.isEnabled())continue;let gt;this._blockedByActive(D,ht,tt)?ct.reset():ct[v||y.type]&&(gt=ct[v||y.type](y,Z,j),this.mergeHandlerResult(P,B,gt,tt,E),gt&&gt.needsRenderFrame&&this._triggerRenderFrame()),(gt||ct.isActive())&&(D[tt]=ct)}const Y={};for(const tt in this._previousActiveHandlers)D[tt]||(Y[tt]=E);this._previousActiveHandlers=D,(Object.keys(Y).length||qo(P))&&(this._changes.push([P,B,Y]),this._triggerRenderFrame()),(Object.keys(D).length||qo(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=P;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new cn(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,v,E]of this._listeners)C.addEventListener(y,v,y===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[o,h,m]of this._listeners)C.removeEventListener(o,h,o===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(o){const h=this._map,m=h.getCanvasContainer();this._add("mapEvent",new Rd(h,o));const y=h.boxZoom=new Cs(h,o);this._add("boxZoom",y),o.interactive&&o.boxZoom&&y.enable();const v=h.cooperativeGestures=new Zc(h,o.cooperativeGestures);this._add("cooperativeGestures",v),o.cooperativeGestures&&v.enable();const E=new kn(h),P=new zu(h);h.doubleClickZoom=new za(P,E),this._add("tapZoom",E),this._add("clickZoom",P),o.interactive&&o.doubleClickZoom&&h.doubleClickZoom.enable();const B=new Fm;this._add("tapDragZoom",B);const D=h.touchPitch=new Xc(h);this._add("touchPitch",D),o.interactive&&o.touchPitch&&h.touchPitch.enable(o.touchPitch);const G=Hc(o),j=Du(o);h.dragRotate=new Od(o,G,j),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]),o.interactive&&o.dragRotate&&h.dragRotate.enable();const Z=(gt=>{let{enable:pt,clickTolerance:St}=gt;const Rt=new Kl({checkCorrectEvent:Bt=>C.mouseButton(Bt)===0&&!Bt.ctrlKey});return new yn({clickTolerance:St,move:(Bt,ie)=>({around:ie,panDelta:ie.sub(Bt)}),activateOnStart:!0,moveStateManager:Rt,enable:pt,assignEvents:Ql})})(o),Y=new wl(o,h);h.dragPan=new Vp(m,Z,Y),this._add("mousePan",Z),this._add("touchPan",Y,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&h.dragPan.enable(o.dragPan);const X=new Dd,tt=new Nu;h.touchZoomRotate=new zd(m,tt,X,B),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",tt,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&h.touchZoomRotate.enable(o.touchZoomRotate);const ct=h.scrollZoom=new Vs(h,()=>this._triggerRenderFrame());this._add("scrollZoom",ct,["mousePan"]),o.interactive&&o.scrollZoom&&h.scrollZoom.enable(o.scrollZoom);const ht=h.keyboard=new uo(h);this._add("keyboard",ht),o.interactive&&o.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new Zi(h))}_add(o,h,m){this._handlers.push({handlerName:o,handler:h,allowed:m}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ho(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,h,m){for(const y in o)if(y!==m&&(!h||h.indexOf(y)<0))return!0;return!1}_getMapTouches(o){const h=[];for(const m of o)this._el.contains(m.target)&&h.push(m);return h}mergeHandlerResult(o,h,m,y,v){if(!m)return;a.e(o,m);const E={handlerName:y,originalEvent:m.originalEvent||v};m.zoomDelta!==void 0&&(h.zoom=E),m.panDelta!==void 0&&(h.drag=E),m.pitchDelta!==void 0&&(h.pitch=E),m.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const o={},h={},m={};for(const[y,v,E]of this._changes)y.panDelta&&(o.panDelta=(o.panDelta||new a.P(0,0))._add(y.panDelta)),y.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(o.around=y.around),y.pinchAround!==void 0&&(o.pinchAround=y.pinchAround),y.noInertia&&(o.noInertia=y.noInertia),a.e(h,v),a.e(m,E);this._updateMapTransform(o,h,m),this._changes=[]}_updateMapTransform(o,h,m){const y=this._map,v=y._getTransformForUpdate(),E=y.terrain;if(!(qo(o)||E&&this._terrainMovement))return this._fireEvents(h,m,!0);let{panDelta:P,zoomDelta:B,bearingDelta:D,pitchDelta:G,around:j,pinchAround:Z}=o;Z!==void 0&&(j=Z),y._stop(!0),j=j||y.transform.centerPoint;const Y=v.pointLocation(P?j.sub(P):j);D&&(v.bearing+=D),G&&(v.pitch+=G),B&&(v.zoom+=B),E?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?v.center=v.pointLocation(v.centerPoint.sub(P)):v.setLocationAtPoint(Y,j):(this._terrainMovement=!0,this._map._elevationFreeze=!0,v.setLocationAtPoint(Y,j)):v.setLocationAtPoint(Y,j),y._applyUpdatedTransform(v),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,m,!0)}_fireEvents(o,h,m){const y=ho(this._eventsInProgress),v=ho(o),E={};for(const j in o){const{originalEvent:Z}=o[j];this._eventsInProgress[j]||(E[`${j}start`]=Z),this._eventsInProgress[j]=o[j]}!y&&v&&this._fireEvent("movestart",v.originalEvent);for(const j in E)this._fireEvent(j,E[j]);v&&this._fireEvent("move",v.originalEvent);for(const j in o){const{originalEvent:Z}=o[j];this._fireEvent(j,Z)}const P={};let B;for(const j in this._eventsInProgress){const{handlerName:Z,originalEvent:Y}=this._eventsInProgress[j];this._handlersById[Z].isActive()||(delete this._eventsInProgress[j],B=h[Z]||Y,P[`${j}end`]=B)}for(const j in P)this._fireEvent(j,P[j]);const D=ho(this._eventsInProgress),G=(y||v)&&!D;if(G&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const j=this._map._getTransformForUpdate();j.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(j)}if(m&&G){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;!j||!j.essential&&S.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:B})),Z(this._map.getBearing())&&this._map.resetNorth()):(Z(j.bearing||this._map.getBearing())&&(j.bearing=0),j.freezeElevation=!0,this._map.easeTo(j,{originalEvent:B})),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new a.k(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new qe("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ha extends a.E{constructor(o,h){super(),this._renderFrameCallback=()=>{const m=Math.min((S.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.N(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,m){return o=a.P.convert(o).mult(-1),this.panTo(this.transform.center,a.e({offset:o},h),m)}panTo(o,h,m){return this.easeTo(a.e({center:o},h),m)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,m){return this.easeTo(a.e({zoom:o},h),m)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,m){return this.easeTo(a.e({bearing:o},h),m)}resetNorth(o,h){return this.rotateTo(0,a.e({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=st.convert(o).adjustAntiMeridian();const m=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),m,h)}_cameraForBoxAndBearing(o,h,m,y){const v={top:0,bottom:0,right:0,left:0};if(typeof(y=a.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const ve=y.padding;y.padding={top:ve,bottom:ve,right:ve,left:ve}}y.padding=a.e(v,y.padding);const E=this.transform,P=E.padding,B=new st(o,h),D=E.project(B.getNorthWest()),G=E.project(B.getNorthEast()),j=E.project(B.getSouthEast()),Z=E.project(B.getSouthWest()),Y=a.ba(-m),X=D.rotate(Y),tt=G.rotate(Y),ct=j.rotate(Y),ht=Z.rotate(Y),gt=new a.P(Math.max(X.x,tt.x,ht.x,ct.x),Math.max(X.y,tt.y,ht.y,ct.y)),pt=new a.P(Math.min(X.x,tt.x,ht.x,ct.x),Math.min(X.y,tt.y,ht.y,ct.y)),St=gt.sub(pt),Rt=(E.width-(P.left+P.right+y.padding.left+y.padding.right))/St.x,Bt=(E.height-(P.top+P.bottom+y.padding.top+y.padding.bottom))/St.y;if(Bt<0||Rt<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ie=Math.min(E.scaleZoom(E.scale*Math.min(Rt,Bt)),y.maxZoom),pe=a.P.convert(y.offset),ye=new a.P((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(a.ba(m)),we=pe.add(ye).mult(E.scale/E.zoomScale(ie));return{center:E.unproject(D.add(j).div(2).sub(we)),zoom:ie,bearing:m}}fitBounds(o,h,m){return this._fitInternal(this.cameraForBounds(o,h),h,m)}fitScreenCoordinates(o,h,m,y,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(o)),this.transform.pointLocation(a.P.convert(h)),m,y),y,v)}_fitInternal(o,h,m){return o?(delete(h=a.e(o,h)).padding,h.linear?this.easeTo(h,m):this.flyTo(h,m)):this}jumpTo(o,h){this.stop();const m=this._getTransformForUpdate();let y=!1,v=!1,E=!1;return"zoom"in o&&m.zoom!==+o.zoom&&(y=!0,m.zoom=+o.zoom),o.center!==void 0&&(m.center=a.N.convert(o.center)),"bearing"in o&&m.bearing!==+o.bearing&&(v=!0,m.bearing=+o.bearing),"pitch"in o&&m.pitch!==+o.pitch&&(E=!0,m.pitch=+o.pitch),o.padding==null||m.isPaddingEqual(o.padding)||(m.padding=o.padding),this._applyUpdatedTransform(m),this.fire(new a.k("movestart",h)).fire(new a.k("move",h)),y&&this.fire(new a.k("zoomstart",h)).fire(new a.k("zoom",h)).fire(new a.k("zoomend",h)),v&&this.fire(new a.k("rotatestart",h)).fire(new a.k("rotate",h)).fire(new a.k("rotateend",h)),E&&this.fire(new a.k("pitchstart",h)).fire(new a.k("pitch",h)).fire(new a.k("pitchend",h)),this.fire(new a.k("moveend",h))}calculateCameraOptionsFromTo(o,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const v=a.Z.fromLngLat(o,h),E=a.Z.fromLngLat(m,y),P=E.x-v.x,B=E.y-v.y,D=E.z-v.z,G=Math.hypot(P,B,D);if(G===0)throw new Error("Can't calculate camera options with same From and To");const j=Math.hypot(P,B),Z=this.transform.scaleZoom(this.transform.cameraToCenterDistance/G/this.transform.tileSize),Y=180*Math.atan2(P,-B)/Math.PI;let X=180*Math.acos(j/G)/Math.PI;return X=D<0?90-X:90+X,{center:E.toLngLat(),zoom:Z,pitch:X,bearing:Y}}easeTo(o,h){var m;this._stop(!1,o.easeId),((o=a.e({offset:[0,0],duration:500,easing:a.b9},o)).animate===!1||!o.essential&&S.prefersReducedMotion)&&(o.duration=0);const y=this._getTransformForUpdate(),v=y.zoom,E=y.bearing,P=y.pitch,B=y.padding,D="bearing"in o?this._normalizeBearing(o.bearing,E):E,G="pitch"in o?+o.pitch:P,j="padding"in o?o.padding:y.padding,Z=a.P.convert(o.offset);let Y=y.centerPoint.add(Z);const X=y.pointLocation(Y),{center:tt,zoom:ct}=y.getConstrained(a.N.convert(o.center||X),(m=o.zoom)!==null&&m!==void 0?m:v);this._normalizeCenter(tt,y);const ht=y.project(X),gt=y.project(tt).sub(ht),pt=y.zoomScale(ct-v);let St,Rt;o.around&&(St=a.N.convert(o.around),Rt=y.locationPoint(St));const Bt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ct!==v,this._rotating=this._rotating||E!==D,this._pitching=this._pitching||G!==P,this._padding=!y.isPaddingEqual(j),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,Bt),this.terrain&&this._prepareElevation(tt),this._ease(ie=>{if(this._zooming&&(y.zoom=a.y.number(v,ct,ie)),this._rotating&&(y.bearing=a.y.number(E,D,ie)),this._pitching&&(y.pitch=a.y.number(P,G,ie)),this._padding&&(y.interpolatePadding(B,j,ie),Y=y.centerPoint.add(Z)),this.terrain&&!o.freezeElevation&&this._updateElevation(ie),St)y.setLocationAtPoint(St,Rt);else{const pe=y.zoomScale(y.zoom-v),ye=ct>v?Math.min(2,pt):Math.max(.5,pt),we=Math.pow(ye,1-ie),ve=y.unproject(ht.add(gt.mult(ie*we)).mult(pe));y.setLocationAtPoint(y.renderWorldCopies?ve.wrap():ve,Y)}this._applyUpdatedTransform(y),this._fireMoveEvents(h)},ie=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(h,ie)},o),this}_prepareEase(o,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,h||m.moving||this.fire(new a.k("movestart",o)),this._zooming&&!m.zooming&&this.fire(new a.k("zoomstart",o)),this._rotating&&!m.rotating&&this.fire(new a.k("rotatestart",o)),this._pitching&&!m.pitching&&this.fire(new a.k("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&h!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(m-(h-(m*o+this._elevationStart))/(1-o)),this._elevationTarget=h}this.transform.elevation=a.y.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(o){const h=o.getCameraPosition(),m=this.terrain.getElevationForLngLatZoom(h.lngLat,o.zoom);if(h.altitude<m){const y=this.calculateCameraOptionsFromTo(h.lngLat,m,o.center,o.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(o){const h=[];if(this.terrain&&h.push(y=>this._elevateCameraIfInsideTerrain(y)),this.transformCameraUpdate&&h.push(y=>this.transformCameraUpdate(y)),!h.length)return;const m=o.clone();for(const y of h){const v=m.clone(),{center:E,zoom:P,pitch:B,bearing:D,elevation:G}=y(v);E&&(v.center=E),P!==void 0&&(v.zoom=P),B!==void 0&&(v.pitch=B),D!==void 0&&(v.bearing=D),G!==void 0&&(v.elevation=G),m.apply(v)}this.transform.apply(m)}_fireMoveEvents(o){this.fire(new a.k("move",o)),this._zooming&&this.fire(new a.k("zoom",o)),this._rotating&&this.fire(new a.k("rotate",o)),this._pitching&&this.fire(new a.k("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const m=this._zooming,y=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new a.k("zoomend",o)),y&&this.fire(new a.k("rotateend",o)),v&&this.fire(new a.k("pitchend",o)),this.fire(new a.k("moveend",o))}flyTo(o,h){var m;if(!o.essential&&S.prefersReducedMotion){const Ie=a.M(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ie,h)}this.stop(),o=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b9},o);const y=this._getTransformForUpdate(),v=y.zoom,E=y.bearing,P=y.pitch,B=y.padding,D="bearing"in o?this._normalizeBearing(o.bearing,E):E,G="pitch"in o?+o.pitch:P,j="padding"in o?o.padding:y.padding,Z=a.P.convert(o.offset);let Y=y.centerPoint.add(Z);const X=y.pointLocation(Y),{center:tt,zoom:ct}=y.getConstrained(a.N.convert(o.center||X),(m=o.zoom)!==null&&m!==void 0?m:v);this._normalizeCenter(tt,y);const ht=y.zoomScale(ct-v),gt=y.project(X),pt=y.project(tt).sub(gt);let St=o.curve;const Rt=Math.max(y.width,y.height),Bt=Rt/ht,ie=pt.mag();if("minZoom"in o){const Ie=a.ac(Math.min(o.minZoom,v,ct),y.minZoom,y.maxZoom),ir=Rt/y.zoomScale(Ie-v);St=Math.sqrt(ir/ie*2)}const pe=St*St;function ye(Ie){const ir=(Bt*Bt-Rt*Rt+(Ie?-1:1)*pe*pe*ie*ie)/(2*(Ie?Bt:Rt)*pe*ie);return Math.log(Math.sqrt(ir*ir+1)-ir)}function we(Ie){return(Math.exp(Ie)-Math.exp(-Ie))/2}function ve(Ie){return(Math.exp(Ie)+Math.exp(-Ie))/2}const _e=ye(!1);let Se=function(Ie){return ve(_e)/ve(_e+St*Ie)},Ye=function(Ie){return Rt*((ve(_e)*(we(ir=_e+St*Ie)/ve(ir))-we(_e))/pe)/ie;var ir},Pe=(ye(!0)-_e)/St;if(Math.abs(ie)<1e-6||!isFinite(Pe)){if(Math.abs(Rt-Bt)<1e-6)return this.easeTo(o,h);const Ie=Bt<Rt?-1:1;Pe=Math.abs(Math.log(Bt/Rt))/St,Ye=()=>0,Se=ir=>Math.exp(Ie*St*ir)}return o.duration="duration"in o?+o.duration:1e3*Pe/("screenSpeed"in o?+o.screenSpeed/St:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=E!==D,this._pitching=G!==P,this._padding=!y.isPaddingEqual(j),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(tt),this._ease(Ie=>{const ir=Ie*Pe,Ar=1/Se(ir);y.zoom=Ie===1?ct:v+y.scaleZoom(Ar),this._rotating&&(y.bearing=a.y.number(E,D,Ie)),this._pitching&&(y.pitch=a.y.number(P,G,Ie)),this._padding&&(y.interpolatePadding(B,j,Ie),Y=y.centerPoint.add(Z)),this.terrain&&!o.freezeElevation&&this._updateElevation(Ie);const vr=Ie===1?tt:y.unproject(gt.add(pt.mult(Ye(ir))).mult(Ar));y.setLocationAtPoint(y.renderWorldCopies?vr.wrap():vr,Y),this._applyUpdatedTransform(y),this._fireMoveEvents(h)},()=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(h)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,h){var m;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,h)}return o||(m=this.handlers)===null||m===void 0||m.stop(!1),this}_ease(o,h,m){m.animate===!1||m.duration===0?(o(1),h()):(this._easeStart=S.now(),this._easeOptions=m,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,h){o=a.b3(o,-180,180);const m=Math.abs(o-h);return Math.abs(o-360-h)<m&&(o-=360),Math.abs(o+360-h)<m&&(o+=360),o}_normalizeCenter(o,h){if(!h.renderWorldCopies||h.lngRange)return;const m=o.lng-h.center.lng;o.lng+=m>180?-360:m<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(a.N.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}const Yc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ec{constructor(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Yc;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=C.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=C.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=C.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){C.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,h){const m=this._map._getUIString(`AttributionControl.${h}`);o.title=m,o.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(y=>typeof y!="string"?"":y)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const h=this._map.style.sourceCaches;for(const y in h){const v=h[y];if(v.used||v.usedForTerrain){const E=v.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o=o.filter(y=>String(y).trim()),o.sort((y,v)=>y.length-v.length),o=o.filter((y,v)=>{for(let E=v+1;E<o.length;E++)if(o[E].indexOf(y)>=0)return!1;return!0});const m=o.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,o.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class da{constructor(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const h=this._container.children;if(h.length){const m=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=C.create("div","maplibregl-ctrl");const h=C.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){C.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Pr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,m=h?this._queue.concat(h):this._queue;for(const y of m)if(y.id===o)return void(y.cancelled=!0)}run(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const m of h)if(!m.cancelled&&(m.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var jd=a.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Dm extends a.E{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,h){this.sourceCache.update(o,h),this._renderableTilesKeys=[];const m={};for(const y of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))m[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.posMatrix=new Float64Array(16),a.aP(y.posMatrix,0,a.X,0,a.X,0,1),this._tiles[y.key]=new wi(y,this.tileSize));for(const y in this._tiles)m[y]||delete this._tiles[y]}freeRtt(o){for(const h in this._tiles){const m=this._tiles[h];(!o||m.tileID.equals(o)||m.tileID.isChildOf(o)||o.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const h={};for(const m of this._renderableTilesKeys){const y=this._tiles[m].tileID;if(y.canonical.equals(o.canonical)){const v=o.clone();v.posMatrix=new Float64Array(16),a.aP(v.posMatrix,0,a.X,0,a.X,0,1),h[m]=v}else if(y.canonical.isChildOf(o.canonical)){const v=o.clone();v.posMatrix=new Float64Array(16);const E=y.canonical.z-o.canonical.z,P=y.canonical.x-(y.canonical.x>>E<<E),B=y.canonical.y-(y.canonical.y>>E<<E),D=a.X>>E;a.aP(v.posMatrix,0,D,0,D,0,1),a.J(v.posMatrix,v.posMatrix,[-P*D,-B*D,0]),h[m]=v}else if(o.canonical.isChildOf(y.canonical)){const v=o.clone();v.posMatrix=new Float64Array(16);const E=o.canonical.z-y.canonical.z,P=o.canonical.x-(o.canonical.x>>E<<E),B=o.canonical.y-(o.canonical.y>>E<<E),D=a.X>>E;a.aP(v.posMatrix,0,a.X,0,a.X,0,1),a.J(v.posMatrix,v.posMatrix,[P*D,B*D,0]),a.K(v.posMatrix,v.posMatrix,[1/2**E,1/2**E,0]),h[m]=v}}return h}getSourceTile(o,h){const m=this.sourceCache._source;let y=o.overscaledZ-this.deltaZoom;if(y>m.maxzoom&&(y=m.maxzoom),y<m.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(y).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!v||!v.dem)&&h)for(;y>=m.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(o.scaledTo(y--).key);return v}tilesAfterTime(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(h=>h.timeAdded>=o)}}class Mh{constructor(o,h,m){this.painter=o,this.sourceCache=new Dm(h),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:a.X;var v;if(!(h>=0&&h<y&&m>=0&&m<y))return 0;const E=this.getTerrainData(o),P=(v=E.tile)===null||v===void 0?void 0:v.dem;if(!P)return 0;const B=function(X,tt,ct){var ht=tt[0],gt=tt[1];return X[0]=ct[0]*ht+ct[4]*gt+ct[12],X[1]=ct[1]*ht+ct[5]*gt+ct[13],X}([],[h/y*a.X,m/y*a.X],E.u_terrain_matrix),D=[B[0]*P.dim,B[1]*P.dim],G=Math.floor(D[0]),j=Math.floor(D[1]),Z=D[0]-G,Y=D[1]-j;return P.get(G,j)*(1-Z)*(1-Y)+P.get(G+1,j)*Z*(1-Y)+P.get(G,j+1)*(1-Z)*Y+P.get(G+1,j+1)*Z*Y}getElevationForLngLatZoom(o,h){if(!a.bb(h,o.wrap()))return 0;const{tileID:m,mercatorX:y,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(o,h);return this.getElevation(m,y%a.X,v%a.X,a.X)}getElevation(o,h,m){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:a.X;return this.getDEMElevation(o,h,m,y)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const y=this.painter.context,v=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new at(y,v,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new at(y,new a.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const h=this.sourceCache.getSourceTile(o,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const y=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new at(y,h.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),h.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const m=h&&h+h.tileID.key+o.key;if(m&&!this._demMatrixCache[m]){const y=this.sourceCache.sourceCache._source.maxzoom;let v=o.canonical.z-h.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=y?v=o.canonical.z-y:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=o.canonical.x-(o.canonical.x>>v<<v),P=o.canonical.y-(o.canonical.y>>v<<v),B=a.bc(new Float64Array(16),[1/(a.X<<v),1/(a.X<<v),0]);a.J(B,B,[E*a.X,P*a.X,0]),this._demMatrixCache[o.key]={matrix:B,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(o){const h=this.painter,m=h.width/devicePixelRatio,y=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new at(h.context,{width:m,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new at(h.context,{width:m,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(m,y,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,m,y))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,E=0;v<this._coordsTextureSize;v++)for(let P=0;P<this._coordsTextureSize;P++,E+=4)h[E+0]=255&P,h[E+1]=255&v,h[E+2]=P>>8<<4|v>>8,h[E+3]=0;const m=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),y=new at(o,m,o.gl.RGBA,{premultiply:!1});return y.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),m=this.painter.context,y=m.gl,v=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),P=Math.round(this.painter.height/devicePixelRatio);m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(v,P-E-1,1,1,y.RGBA,y.UNSIGNED_BYTE,h),m.bindFramebuffer.set(null);const B=h[0]+(h[2]>>4<<8),D=h[1]+((15&h[2])<<8),G=this.coordsIndex[255-h[3]],j=G&&this.sourceCache.getTileByID(G);if(!j)return null;const Z=this._coordsTextureSize,Y=(1<<j.tileID.canonical.z)*Z;return new a.Z((j.tileID.canonical.x*Z+B)/Y+j.tileID.wrap,(j.tileID.canonical.y*Z+D)/Y,this.getElevation(j.tileID,B,D,Z))}depthAtPoint(o){const h=new Uint8Array(4),m=this.painter.context,y=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),y.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,h),m.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,h=new a.bd,m=new a.aY,y=this.meshSize,v=a.X/y,E=y*y;for(let j=0;j<=y;j++)for(let Z=0;Z<=y;Z++)h.emplaceBack(Z*v,j*v,0);for(let j=0;j<E;j+=y+1)for(let Z=0;Z<y;Z++)m.emplaceBack(Z+j,y+Z+j+1,y+Z+j+2),m.emplaceBack(Z+j,y+Z+j+2,Z+j+1);const P=h.length,B=P+2*(y+1);for(const j of[0,1])for(let Z=0;Z<=y;Z++)for(const Y of[0,1])h.emplaceBack(Z*v,j*a.X,Y);for(let j=0;j<2*y;j+=2)m.emplaceBack(B+j,B+j+1,B+j+3),m.emplaceBack(B+j,B+j+3,B+j+2),m.emplaceBack(P+j,P+j+3,P+j+1),m.emplaceBack(P+j,P+j+2,P+j+3);const D=h.length,G=D+2*(y+1);for(const j of[0,1])for(let Z=0;Z<=y;Z++)for(const Y of[0,1])h.emplaceBack(j*a.X,Z*v,Y);for(let j=0;j<2*y;j+=2)m.emplaceBack(D+j,D+j+1,D+j+3),m.emplaceBack(D+j,D+j+3,D+j+2),m.emplaceBack(G+j,G+j+3,G+j+1),m.emplaceBack(G+j,G+j+2,G+j+3);return this._mesh=new _l(o.createVertexBuffer(h,jd.members),o.createIndexBuffer(m),a.a0.simpleSegment(0,0,h.length,m.length)),this._mesh}getMeshFrameDelta(o){return 2*Math.PI*a.be/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,h){var m;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(o,h);return(m=this.getMinMaxElevation(y).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(o){const h=this.getTerrainData(o).tile,m={minElevation:null,maxElevation:null};return h&&h.dem&&(m.minElevation=h.dem.min*this.exaggeration,m.maxElevation=h.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(o,h){const m=a.Z.fromLngLat(o.wrap()),y=(1<<h)*a.X,v=m.x*y,E=m.y*y,P=Math.floor(v/a.X),B=Math.floor(E/a.X);return{tileID:new a.S(h,0,h,P,B),mercatorX:v,mercatorY:E}}}class qp{constructor(o,h,m){this._context=o,this._size=h,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new at(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(m.texture),{id:o,fbo:h,texture:m,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>o.id!==h),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(o=>!o.inUse)===!1}}const rc={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Ud{constructor(o,h){this.painter=o,this.terrain=h,this.pool=new qp(o.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(m=>!o._layers[m].isHidden(h)),this._coordsDescendingInv={};for(const m in o.sourceCaches){this._coordsDescendingInv[m]={};const y=o.sourceCaches[m].getVisibleCoordinates();for(const v of y){const E=this.terrain.sourceCache.getTerrainCoords(v);for(const P in E)this._coordsDescendingInv[m][P]||(this._coordsDescendingInv[m][P]=[]),this._coordsDescendingInv[m][P].push(E[P])}}this._coordsDescendingInvStr={};for(const m of o._order){const y=o._layers[m],v=y.source;if(rc[y.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const E in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][E]=this._coordsDescendingInv[v][E].map(P=>P.key).sort().join()}}for(const m of this._renderableTiles)for(const y in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[y][m.tileID.key];v&&v!==m.rttCoords[y]&&(m.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const h=o.type,m=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(rc[h]&&(this._prevType&&rc[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(o.id),!y))return!0;if(rc[this._prevType]||rc[h]&&y){this._prevType=h;const v=this._stacks.length-1,E=this._stacks[v]||[];for(const P of this._renderableTiles){if(this.pool.isFull()&&(Yl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[v]){const D=this.pool.getObjectForId(P.rtt[v].id);if(D.stamp===P.rtt[v].stamp){this.pool.useObject(D);continue}}const B=this.pool.getOrCreateFreeObject();this.pool.useObject(B),this.pool.stampObject(B),P.rtt[v]={id:B.id,stamp:B.stamp},m.context.bindFramebuffer.set(B.fbo.framebuffer),m.context.clear({color:a.aM.transparent,stencil:0}),m.currentStencilSource=void 0;for(let D=0;D<E.length;D++){const G=m.style._layers[E[D]],j=G.source?this._coordsDescendingInv[G.source][P.tileID.key]:[P.tileID];m.context.viewport.set([0,0,B.fbo.width,B.fbo.height]),m._renderTileClippingMasks(G,j),m.renderLayer(m,m.style.sourceCaches[G.source],G,j),G.source&&(P.rttCoords[G.source]=this._coordsDescendingInvStr[G.source][P.tileID.key])}}return Yl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),rc[h]}return!1}}const Gd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ju=p,Bh={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Yc,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},ic=g=>{g.touchstart=g.dragStart,g.touchmoveWindow=g.dragMove,g.touchend=g.dragEnd},Vd={showCompass:!0,showZoom:!0,visualizePitch:!1};class Hp{constructor(o,h){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=E=>{this.startMouse(a.e({},E,{ctrlKey:!0,preventDefault:()=>E.preventDefault()}),C.mousePos(this.element,E)),C.addEventListener(window,"mousemove",this.mousemove),C.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=E=>{this.moveMouse(E,C.mousePos(this.element,E))},this.mouseup=E=>{this.mouseRotate.dragEnd(E),this.mousePitch&&this.mousePitch.dragEnd(E),this.offTemp()},this.touchstart=E=>{E.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=C.touchPos(this.element,E.targetTouches)[0],this.startTouch(E,this._startPos),C.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.addEventListener(window,"touchend",this.touchend))},this.touchmove=E=>{E.targetTouches.length!==1?this.reset():(this._lastPos=C.touchPos(this.element,E.targetTouches)[0],this.moveTouch(E,this._lastPos))},this.touchend=E=>{E.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const y=o.dragRotate._mouseRotate.getClickTolerance(),v=o.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=Hc({clickTolerance:y,enable:!0}),this.touchRotate=(E=>{let{enable:P,clickTolerance:B,bearingDegreesPerPixelMoved:D=.8}=E;const G=new Lh;return new yn({clickTolerance:B,move:(j,Z)=>({bearingDelta:(Z.x-j.x)*D}),moveStateManager:G,enable:P,assignEvents:ic})})({clickTolerance:y,enable:!0}),this.map=o,m&&(this.mousePitch=Du({clickTolerance:v,enable:!0}),this.touchPitch=(E=>{let{enable:P,clickTolerance:B,pitchDegreesPerPixelMoved:D=-.5}=E;const G=new Lh;return new yn({clickTolerance:B,move:(j,Z)=>({pitchDelta:(Z.y-j.y)*D}),moveStateManager:G,enable:P,assignEvents:ic})})({clickTolerance:v,enable:!0})),C.addEventListener(h,"mousedown",this.mousedown),C.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),C.addEventListener(h,"touchcancel",this.reset)}startMouse(o,h){this.mouseRotate.dragStart(o,h),this.mousePitch&&this.mousePitch.dragStart(o,h),C.disableDrag()}startTouch(o,h){this.touchRotate.dragStart(o,h),this.touchPitch&&this.touchPitch.dragStart(o,h),C.disableDrag()}moveMouse(o,h){const m=this.map,{bearingDelta:y}=this.mouseRotate.dragMove(o,h)||{};if(y&&m.setBearing(m.getBearing()+y),this.mousePitch){const{pitchDelta:v}=this.mousePitch.dragMove(o,h)||{};v&&m.setPitch(m.getPitch()+v)}}moveTouch(o,h){const m=this.map,{bearingDelta:y}=this.touchRotate.dragMove(o,h)||{};if(y&&m.setBearing(m.getBearing()+y),this.touchPitch){const{pitchDelta:v}=this.touchPitch.dragMove(o,h)||{};v&&m.setPitch(m.getPitch()+v)}}off(){const o=this.element;C.removeEventListener(o,"mousedown",this.mousedown),C.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend),C.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){C.enableDrag(),C.removeEventListener(window,"mousemove",this.mousemove),C.removeEventListener(window,"mouseup",this.mouseup),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend)}}let Hs;function Ai(g,o,h){const m=new a.N(g.lng,g.lat);if(g=new a.N(g.lng,g.lat),o){const y=new a.N(g.lng-360,g.lat),v=new a.N(g.lng+360,g.lat),E=h.locationPoint(g).distSqr(o);h.locationPoint(y).distSqr(o)<E?g=y:h.locationPoint(v).distSqr(o)<E&&(g=v)}for(;Math.abs(g.lng-h.center.lng)>180;){const y=h.locationPoint(g);if(y.x>=0&&y.y>=0&&y.x<=h.width&&y.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g.lng!==m.lng&&h.locationPoint(g).y>h.height/2-h.getHorizon()?g:m}const Jc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function kh(g,o,h){const m=g.classList;for(const y in Jc)m.remove(`maplibregl-${h}-anchor-${y}`);m.add(`maplibregl-${h}-anchor-${o}`)}class Rh extends a.E{constructor(o){if(super(),this._onKeyPress=h=>{const m=h.code,y=h.charCode||h.keyCode;m!=="Space"&&m!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=h=>{const m=h.originalEvent.target,y=this._element;this._popup&&(m===y||y.contains(m))&&this.togglePopup()},this._update=h=>{var m;if(!this._map)return;const y=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!y)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ai(this._lngLat,this._flatPos,this._map.transform):(m=this._lngLat)===null||m===void 0?void 0:m.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let v="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?v=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(v=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),C.setTransform(this._element,`${Jc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${E} ${v}`),S.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._subpixelPositioning=o&&o.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(o==null?void 0:o.opacity,o==null?void 0:o.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=a.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=C.create("div");const h=C.createNS("http://www.w3.org/2000/svg","svg"),m=41,y=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${m}px`),h.setAttributeNS(null,"width",`${y}px`),h.setAttributeNS(null,"viewBox",`0 0 ${y} ${m}`);const v=C.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const E=C.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const P=C.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");const B=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ht of B){const gt=C.createNS("http://www.w3.org/2000/svg","ellipse");gt.setAttributeNS(null,"opacity","0.04"),gt.setAttributeNS(null,"cx","10.5"),gt.setAttributeNS(null,"cy","5.80029008"),gt.setAttributeNS(null,"rx",ht.rx),gt.setAttributeNS(null,"ry",ht.ry),P.appendChild(gt)}const D=C.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const G=C.createNS("http://www.w3.org/2000/svg","path");G.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(G);const j=C.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"fill","#000000");const Z=C.createNS("http://www.w3.org/2000/svg","path");Z.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),j.appendChild(Z);const Y=C.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Y.setAttributeNS(null,"fill","#FFFFFF");const X=C.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");const tt=C.createNS("http://www.w3.org/2000/svg","circle");tt.setAttributeNS(null,"fill","#000000"),tt.setAttributeNS(null,"opacity","0.25"),tt.setAttributeNS(null,"cx","5.5"),tt.setAttributeNS(null,"cy","5.5"),tt.setAttributeNS(null,"r","5.4999962");const ct=C.createNS("http://www.w3.org/2000/svg","circle");ct.setAttributeNS(null,"fill","#FFFFFF"),ct.setAttributeNS(null,"cx","5.5"),ct.setAttributeNS(null,"cy","5.5"),ct.setAttributeNS(null,"r","5.4999962"),X.appendChild(tt),X.appendChild(ct),E.appendChild(P),E.appendChild(D),E.appendChild(j),E.appendChild(Y),E.appendChild(X),h.appendChild(E),h.setAttributeNS(null,"height",m*this._scale+"px"),h.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),kh(this._element,this._anchor,"marker"),o&&o.className)for(const h of o.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(o){return this.remove(),this._map=o,this._element.setAttribute("aria-label",o._getUIString("Marker.Title")),o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),C.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=a.N.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const h=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(o){return this._subpixelPositioning=o,this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var h,m;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,v=y.terrain.depthAtPoint(this._pos),E=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,E)-v<.006)return void(this._element.style.opacity=this._opacity);const P=-this._offset.y/y.transform._pixelPerMeter,B=Math.sin(y.getPitch()*Math.PI/180)*P,D=y.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),G=y.transform.lngLatToCameraDepth(this._lngLat,E+B)-D>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&G&&this._popup.remove(),this._element.style.opacity=G?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=a.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,h){return o===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const $p={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Uu=0,Gu=!1;const Ho={maxWidth:100,unit:"metric"};function xl(g,o,h){const m=h&&h.maxWidth||100,y=g._container.clientHeight/2,v=g.unproject([0,y]),E=g.unproject([m,y]),P=v.distanceTo(E);if(h&&h.unit==="imperial"){const B=3.2808*P;B>5280?Je(o,m,B/5280,g._getUIString("ScaleControl.Miles")):Je(o,m,B,g._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Je(o,m,P/1852,g._getUIString("ScaleControl.NauticalMiles")):P>=1e3?Je(o,m,P/1e3,g._getUIString("ScaleControl.Kilometers")):Je(o,m,P,g._getUIString("ScaleControl.Meters"))}function Je(g,o,h,m){const y=function(v){const E=Math.pow(10,`${Math.floor(v)}`.length-1);let P=v/E;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(B){const D=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*D)/D}(P),E*P}(h);g.style.width=o*(y/h)+"px",g.innerHTML=`${y}&nbsp;${m}`}const gr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Vu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function A(g){if(g){if(typeof g=="number"){const o=Math.round(Math.abs(g)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,g),"top-left":new a.P(o,o),"top-right":new a.P(-o,o),bottom:new a.P(0,-g),"bottom-left":new a.P(o,-o),"bottom-right":new a.P(-o,-o),left:new a.P(g,0),right:new a.P(-g,0)}}if(g instanceof a.P||Array.isArray(g)){const o=a.P.convert(g);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:a.P.convert(g.center||[0,0]),top:a.P.convert(g.top||[0,0]),"top-left":a.P.convert(g["top-left"]||[0,0]),"top-right":a.P.convert(g["top-right"]||[0,0]),bottom:a.P.convert(g.bottom||[0,0]),"bottom-left":a.P.convert(g["bottom-left"]||[0,0]),"bottom-right":a.P.convert(g["bottom-right"]||[0,0]),left:a.P.convert(g.left||[0,0]),right:a.P.convert(g.right||[0,0])}}return A(new a.P(0,0))}const M=p;c.AJAXError=a.bh,c.Evented=a.E,c.LngLat=a.N,c.MercatorCoordinate=a.Z,c.Point=a.P,c.addProtocol=a.bi,c.config=a.a,c.removeProtocol=a.bj,c.AttributionControl=ec,c.BoxZoomHandler=Cs,c.CanvasSource=wr,c.CooperativeGesturesHandler=Zc,c.DoubleClickZoomHandler=za,c.DragPanHandler=Vp,c.DragRotateHandler=Od,c.EdgeInsets=so,c.FullscreenControl=class extends a.E{constructor(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{var o;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=h==null?void 0:h.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){C.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=C.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);C.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=Be,c.GeolocateControl=class extends a.E{constructor(g){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const h=new a.N(o.coords.longitude,o.coords.latitude),m=o.coords.accuracy,y=this._map.getBearing(),v=a.e({bearing:y},this.options.fitBoundsOptions),E=st.fromLngLat(h,m);this._map.fitBounds(E,v,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const h=new a.N(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&Gu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=C.create("button","maplibregl-ctrl-geolocate",this._container),C.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=o=>{if(this._map){if(o===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=C.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Rh({element:this._dotElement}),this._circleElement=C.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Rh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")),this.fire(new a.k("userlocationlostfocus")))})}},this.options=a.e({},$p,g)}onAdd(g){return this._map=g,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){if(Hs!==void 0&&!o)return Hs;if(window.navigator.permissions===void 0)return Hs=!!window.navigator.geolocation,Hs;try{Hs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Hs=!!window.navigator.geolocation}return Hs}()})}().then(o=>this._finishSetupUI(o)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),C.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Uu=0,Gu=!1}_isOutOfMapMaxBounds(g){const o=this._map.getMaxBounds(),h=g.coords;return o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),o=g.getSouthEast(),h=g.getNorthEast(),m=o.distanceTo(h),y=Math.ceil(this._accuracy/(m/this._map._container.clientHeight)*2);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Uu--,Gu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart")),this.fire(new a.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Uu++,Uu>1?(g={maximumAge:6e5,timeout:0},Gu=!0):(g=this.options.positionOptions,Gu=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.Hash=bl,c.ImageSource=rr,c.KeyboardHandler=uo,c.LngLatBounds=st,c.LogoControl=da,c.Map=class extends ha{constructor(g){a.bf.mark(a.bg.create);const o=Object.assign(Object.assign({},Bh),g);if(o.minZoom!=null&&o.maxZoom!=null&&o.minZoom>o.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(o.minPitch!=null&&o.maxPitch!=null&&o.minPitch>o.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(o.minPitch!=null&&o.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(o.maxPitch!=null&&o.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new oo(o.minZoom,o.maxZoom,o.minPitch,o.maxPitch,o.renderWorldCopies),{bearingSnap:o.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Pr,this._controls=[],this._mapId=a.a4(),this._contextLost=h=>{h.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:h}))},this._contextRestored=h=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:h}))},this._onMapScroll=h=>{if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=o.interactive,this._maxTileCacheSize=o.maxTileCacheSize,this._maxTileCacheZoomLevels=o.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=o.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=o.preserveDrawingBuffer===!0,this._antialias=o.antialias===!0,this._trackResize=o.trackResize===!0,this._bearingSnap=o.bearingSnap,this._refreshExpiredTiles=o.refreshExpiredTiles===!0,this._fadeDuration=o.fadeDuration,this._crossSourceCollisions=o.crossSourceCollisions===!0,this._collectResourceTiming=o.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Gd),o.locale),this._clickTolerance=o.clickTolerance,this._overridePixelRatio=o.pixelRatio,this._maxCanvasSize=o.maxCanvasSize,this.transformCameraUpdate=o.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=o.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=H.addThrottleControl(()=>this.isMoving()),this._requestManager=new nt(o.transformRequest),typeof o.container=="string"){if(this._container=document.getElementById(o.container),!this._container)throw new Error(`Container '${o.container}' not found.`)}else{if(!(o.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=o.container}if(o.maxBounds&&this.setMaxBounds(o.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let h=!1;const m=ao(y=>{this._trackResize&&!this._removed&&(this.resize(y),this.redraw())},50);this._resizeObserver=new ResizeObserver(y=>{h?m(y):h=!0}),this._resizeObserver.observe(this._container)}this.handlers=new qs(this,o),this._hash=o.hash&&new bl(typeof o.hash=="string"&&o.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:o.center,zoom:o.zoom,bearing:o.bearing,pitch:o.pitch}),o.bounds&&(this.resize(),this.fitBounds(o.bounds,a.e({},o.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=o.localIdeographFontFamily,this._validateStyle=o.validateStyle,o.style&&this.setStyle(o.style,{localIdeographFontFamily:o.localIdeographFontFamily}),o.attributionControl&&this.addControl(new ec(typeof o.attributionControl=="boolean"?void 0:o.attributionControl)),o.maplibreLogo&&this.addControl(new da,o.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new a.k(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new a.k(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new a.k("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(g,o){if(o===void 0&&(o=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const m=this._controlPositions[o];return o.indexOf("bottom")!==-1?m.insertBefore(h,m.firstChild):m.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(g);return o>-1&&this._controls.splice(o,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,o,h,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,o,h,m)}resize(g){var o;const h=this._containerDimensions(),m=h[0],y=h[1],v=this._getClampedPixelRatio(m,y);if(this._resizeCanvas(m,y,v),this.painter.resize(m,y,v),this.painter.overLimit()){const P=this.painter.context.gl;this._maxCanvasSize=[P.drawingBufferWidth,P.drawingBufferHeight];const B=this._getClampedPixelRatio(m,y);this._resizeCanvas(m,y,B),this.painter.resize(m,y,B)}this.transform.resize(m,y),(o=this._requestedCameraState)===null||o===void 0||o.resize(m,y);const E=!this._moving;return E&&(this.stop(),this.fire(new a.k("movestart",g)).fire(new a.k("move",g))),this.fire(new a.k("resize",g)),E&&this.fire(new a.k("moveend",g)),this}_getClampedPixelRatio(g,o){const{0:h,1:m}=this._maxCanvasSize,y=this.getPixelRatio(),v=g*y,E=o*y;return Math.min(v>h?h/v:1,E>m?m/E:1)*y}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(st.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}project(g){return this.transform.locationPoint(a.N.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.pointLocation(a.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,o,h){if(g==="mouseenter"||g==="mouseover"){let m=!1;return{layers:o,listener:h,delegates:{mousemove:y=>{const v=o.filter(P=>this.getLayer(P)),E=v.length!==0?this.queryRenderedFeatures(y.point,{layers:v}):[];E.length?m||(m=!0,h.call(this,new un(g,this,y.originalEvent,{features:E}))):m=!1},mouseout:()=>{m=!1}}}}if(g==="mouseleave"||g==="mouseout"){let m=!1;return{layers:o,listener:h,delegates:{mousemove:y=>{const v=o.filter(E=>this.getLayer(E));(v.length!==0?this.queryRenderedFeatures(y.point,{layers:v}):[]).length?m=!0:m&&(m=!1,h.call(this,new un(g,this,y.originalEvent)))},mouseout:y=>{m&&(m=!1,h.call(this,new un(g,this,y.originalEvent)))}}}}{const m=y=>{const v=o.filter(P=>this.getLayer(P)),E=v.length!==0?this.queryRenderedFeatures(y.point,{layers:v}):[];E.length&&(y.features=E,h.call(this,y),delete y.features)};return{layers:o,listener:h,delegates:{[g]:m}}}}_saveDelegatedListener(g,o){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(o)}_removeDelegatedListener(g,o,h){if(!this._delegatedListeners||!this._delegatedListeners[g])return;const m=this._delegatedListeners[g];for(let y=0;y<m.length;y++){const v=m[y];if(v.listener===h&&v.layers.length===o.length&&v.layers.every(E=>o.includes(E))){for(const E in v.delegates)this.off(E,v.delegates[E]);return void m.splice(y,1)}}}on(g,o,h){if(h===void 0)return super.on(g,o);const m=this._createDelegatedListener(g,typeof o=="string"?[o]:o,h);this._saveDelegatedListener(g,m);for(const y in m.delegates)this.on(y,m.delegates[y]);return this}once(g,o,h){var m=this;if(h===void 0)return super.once(g,o);const y=typeof o=="string"?[o]:o,v=this._createDelegatedListener(g,y,h);for(const E in v.delegates){const P=v.delegates[E];v.delegates[E]=function(){m._removeDelegatedListener(g,y,h),P(...arguments)}}this._saveDelegatedListener(g,v);for(const E in v.delegates)this.once(E,v.delegates[E]);return this}off(g,o,h){return h===void 0?super.off(g,o):(this._removeDelegatedListener(g,typeof o=="string"?[o]:o,h),this)}queryRenderedFeatures(g,o){if(!this.style)return[];let h;const m=g instanceof a.P||Array.isArray(g),y=m?g:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(m?{}:g)||{},y instanceof a.P||typeof y[0]=="number")h=[a.P.convert(y)];else{const v=a.P.convert(y[0]),E=a.P.convert(y[1]);h=[v,new a.P(E.x,v.y),E,new a.P(v.x,E.y),v]}return this.style.queryRenderedFeatures(h,o,this.transform)}querySourceFeatures(g,o){return this.style.querySourceFeatures(g,o)}setStyle(g,o){return(o=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(g,o))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const o=this._locale[g];if(o==null)throw new Error(`Missing UI string '${g}'`);return o}_updateStyle(g,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,o));const h=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new xn(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,o,h):this.style.loadJSON(g,o,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,o){if(typeof g=="string"){const h=this._requestManager.transformRequest(g,"Style");a.h(h,new AbortController).then(m=>{this._updateDiff(m.data,o)}).catch(m=>{m&&this.fire(new a.j(m))})}else typeof g=="object"&&this._updateDiff(g,o)}_updateDiff(g,o){try{this.style.setState(g,o)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(g,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(g,o){return this._lazyInitEmptyStyle(),this.style.addSource(g,o),this._update(!0)}isSourceLoaded(g){const o=this.style&&this.style.sourceCaches[g];if(o!==void 0)return o.loaded();this.fire(new a.j(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const o=this.style.sourceCaches[g.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&o.reload();for(const h in this.style._layers){const m=this.style._layers[h];m.type==="hillshade"&&m.source===g.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Mh(this.painter,o,g),this.painter.renderToTexture=new Ud(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==g.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:g})),this}getTerrain(){var g,o;return(o=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const o in g){const h=g[o]._tiles;for(const m in h){const y=h[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,o){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:m=1,sdf:y=!1,stretchX:v,stretchY:E,content:P,textFitWidth:B,textFitHeight:D}=h;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||a.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:G,height:j,data:Z}=o,Y=o;return this.style.addImage(g,{data:new a.R({width:G,height:j},new Uint8Array(Z)),pixelRatio:m,stretchX:v,stretchY:E,content:P,textFitWidth:B,textFitHeight:D,sdf:y,version:0,userImage:Y}),Y.onAdd&&Y.onAdd(this,g),this}}{const{width:G,height:j,data:Z}=S.getImageData(o);this.style.addImage(g,{data:new a.R({width:G,height:j},Z),pixelRatio:m,stretchX:v,stretchY:E,content:P,textFitWidth:B,textFitHeight:D,sdf:y,version:0})}}updateImage(g,o){const h=this.style.getImage(g);if(!h)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=o instanceof HTMLImageElement||a.b(o)?S.getImageData(o):o,{width:y,height:v,data:E}=m;if(y===void 0||v===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==h.data.width||v!==h.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const P=!(o instanceof HTMLImageElement||a.b(o));return h.data.replace(E,P),this.style.updateImage(g,h),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return H.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,o){return this._lazyInitEmptyStyle(),this.style.addLayer(g,o),this._update(!0)}moveLayer(g,o){return this.style.moveLayer(g,o),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,o,h){return this.style.setLayerZoomRange(g,o,h),this._update(!0)}setFilter(g,o){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(g,o,h),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,o,h){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(g,o,h,m),this._update(!0)}getPaintProperty(g,o){return this.style.getPaintProperty(g,o)}setLayoutProperty(g,o,h){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(g,o,h,m),this._update(!0)}getLayoutProperty(g,o){return this.style.getLayoutProperty(g,o)}setGlyphs(g){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,o){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(g,o,h,m=>{m||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(g,o,h=>{h||this._update(!0)}),this}setLight(g){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(g,o),this._update(!0)}getLight(){return this.style.getLight()}setSky(g){return this._lazyInitEmptyStyle(),this.style.setSky(g),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(g,o){return this.style.setFeatureState(g,o),this._update()}removeFeatureState(g,o){return this.style.removeFeatureState(g,o),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,o=0;return this._container&&(g=this._container.clientWidth||400,o=this._container.clientHeight||300),[g,o]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const o=this._canvasContainer=C.create("div","maplibregl-canvas-container",g);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=C.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),m=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],m);const y=this._controlContainer=C.create("div","maplibregl-control-container",g),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{v[E]=C.create("div",`maplibregl-ctrl-${E} `,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,o,h){this._canvas.width=Math.floor(h*g),this._canvas.height=Math.floor(h*o),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const g={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",m=>{o={requestedAttributes:g},m&&(o.statusMessage=m.statusMessage,o.type=m.type)},{once:!0});const h=this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g);if(!h){const m="Failed to initialize WebGL";throw o?(o.message=m,new Error(JSON.stringify(o))):new Error(m)}this.painter=new Go(h,this.transform),I.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const y=this.transform.zoom,v=S.now();this.style.zoomHistory.update(y,v);const E=new a.z(y,{now:v,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),P=E.crossFadingFactor();P===1&&P===this._crossFadingFactor||(h=!0,this._crossFadingFactor=P),this.style.update(E)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bf.mark(a.bg.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const m=this._sourcesDirty||this._styleDirty||this._placementDirty;return m||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||m||(this._fullyLoaded=!0,a.bf.mark(a.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),H.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o!=null&&o.loseContext&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),C.remove(this._canvasContainer),C.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bf.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(g=>{a.bf.frame(g),this._frameRequest=null,this._render(g)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return ju}getCameraTargetElevation(){return this.transform.elevation}},c.MapMouseEvent=un,c.MapTouchEvent=ca,c.MapWheelEvent=kd,c.Marker=Rh,c.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const o=this._map.getZoom(),h=o===this._map.getMaxZoom(),m=o===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,h)=>{const m=this._map._getUIString(`NavigationControl.${h}`);o.title=m,o.setAttribute("aria-label",m)},this.options=a.e({},Vd,g),this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),C.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),C.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=C.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Hp(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){C.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,o){const h=C.create("button",g,this._container);return h.type="button",h.addEventListener("click",o),h}},c.Popup=class extends a.E{constructor(g){super(),this.remove=()=>(this._content&&C.remove(this._content),this._container&&(C.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=C.create("div","maplibregl-popup",this._map.getContainer()),this._tip=C.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const P of this.options.className.split(" "))this._container.classList.add(P);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ai(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!o)return;const m=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationPoint(this._lngLat));let y=this.options.anchor;const v=A(this.options.offset);if(!y){const P=this._container.offsetWidth,B=this._container.offsetHeight;let D;D=m.y+v.bottom.y<B?["top"]:m.y>this._map.transform.height-B?["bottom"]:[],m.x<P/2?D.push("left"):m.x>this._map.transform.width-P/2&&D.push("right"),y=D.length===0?"bottom":D.join("-")}let E=m.add(v[y]);this.options.subpixelPositioning||(E=E.round()),C.setTransform(this._container,`${Jc[y]} translate(${E.x}px,${E.y}px)`),kh(this._container,y,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(gr),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=a.N.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const o=document.createDocumentFragment(),h=document.createElement("body");let m;for(h.innerHTML=g;m=h.firstChild,m;)o.appendChild(m);return this.setDOMContent(o)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=C.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._container&&this._container.classList.add(g),this}removeClassName(g){return this._container&&this._container.classList.remove(g),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=C.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Vu);g&&g.focus()}},c.RasterDEMTileSource=Te,c.RasterTileSource=de,c.ScaleControl=class{constructor(g){this._onMove=()=>{xl(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,xl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ho),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){C.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=Vs,c.Style=xn,c.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=C.create("button","maplibregl-ctrl-terrain",this._container),C.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){C.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=Xc,c.TwoFingersTouchRotateHandler=Dd,c.TwoFingersTouchZoomHandler=Nu,c.TwoFingersTouchZoomRotateHandler=zd,c.VectorTileSource=Qe,c.VideoSource=Er,c.addSourceType=(g,o)=>a._(void 0,void 0,void 0,function*(){if(Ur(g))throw new Error(`A source type called "${g}" already exists.`);((h,m)=>{Fr[h]=m})(g,o)}),c.clearPrewarmedResources=function(){const g=$t;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(Pt),$t=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return Fe().getRTLTextPluginStatus()},c.getVersion=function(){return M},c.getWorkerCount=function(){return jt.workerCount},c.getWorkerUrl=function(){return a.a.WORKER_URL},c.importScriptInWorkers=function(g){return Me().broadcast("IS",g)},c.prewarm=function(){Kt().acquire(Pt)},c.setMaxParallelImageRequests=function(g){a.a.MAX_PARALLEL_IMAGE_REQUESTS=g},c.setRTLTextPlugin=function(g,o){return Fe().setRTLTextPlugin(g,o)},c.setWorkerCount=function(g){jt.workerCount=g},c.setWorkerUrl=function(g){a.a.WORKER_URL=g}});var s=r;return s})})(RM);var DM=RM.exports;const Bs=av(DM);var Ns;(function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon",e[e.MultiPoint=4]="MultiPoint",e[e.MultiLineString=5]="MultiLineString",e[e.MultiPolygon=6]="MultiPolygon",e[e.GeometryCollection=7]="GeometryCollection",e[e.CircularString=8]="CircularString",e[e.CompoundCurve=9]="CompoundCurve",e[e.CurvePolygon=10]="CurvePolygon",e[e.MultiCurve=11]="MultiCurve",e[e.MultiSurface=12]="MultiSurface",e[e.Curve=13]="Curve",e[e.Surface=14]="Surface",e[e.PolyhedralSurface=15]="PolyhedralSurface",e[e.TIN=16]="TIN",e[e.Triangle=17]="Triangle"})(Ns||(Ns={}));const mg=4,gg=4,U0=4,rd=new Int32Array(2),fT=new Float32Array(rd.buffer),mT=new Float64Array(rd.buffer),U1=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Jw;(function(e){e[e.UTF8_BYTES=1]="UTF8_BYTES",e[e.UTF16_STRING=2]="UTF16_STRING"})(Jw||(Jw={}));class _h{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new _h(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return rd[0]=this.readInt32(t),fT[0]}readFloat64(t){return rd[U1?0:1]=this.readInt32(t),rd[U1?1:0]=this.readInt32(t+4),mT[0]}writeInt8(t,r){this.bytes_[t]=r}writeUint8(t,r){this.bytes_[t]=r}writeInt16(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8}writeUint16(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8}writeInt32(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8,this.bytes_[t+2]=r>>16,this.bytes_[t+3]=r>>24}writeUint32(t,r){this.bytes_[t]=r,this.bytes_[t+1]=r>>8,this.bytes_[t+2]=r>>16,this.bytes_[t+3]=r>>24}writeInt64(t,r){this.writeInt32(t,Number(BigInt.asIntN(32,r))),this.writeInt32(t+4,Number(BigInt.asIntN(32,r>>BigInt(32))))}writeUint64(t,r){this.writeUint32(t,Number(BigInt.asUintN(32,r))),this.writeUint32(t+4,Number(BigInt.asUintN(32,r>>BigInt(32))))}writeFloat32(t,r){fT[0]=r,this.writeInt32(t,rd[0])}writeFloat64(t,r){mT[0]=r,this.writeInt32(t,rd[U1?0:1]),this.writeInt32(t+4,rd[U1?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+mg+gg)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let r=0;r<gg;r++)t+=String.fromCharCode(this.readInt8(this.position_+mg+r));return t}__offset(t,r){const i=t-this.readInt32(t);return r<this.readInt16(i)?this.readInt16(i+r):0}__union(t,r){return t.bb_pos=r+this.readInt32(r),t.bb=this,t}__string(t,r){t+=this.readInt32(t);const i=this.readInt32(t);t+=mg;const n=this.bytes_.subarray(t,t+i);return r===Jw.UTF8_BYTES?n:this.text_decoder_.decode(n)}__union_with_string(t,r){return typeof t=="string"?this.__string(r):this.__union(t,r)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+mg}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=gg)throw new Error("FlatBuffers: file identifier must be length "+gg);for(let r=0;r<gg;r++)if(t.charCodeAt(r)!=this.readInt8(this.position()+mg+r))return!1;return!0}createScalarList(t,r){const i=[];for(let n=0;n<r;++n){const s=t(n);s!==null&&i.push(s)}return i}createObjList(t,r){const i=[];for(let n=0;n<r;++n){const s=t(n);s!==null&&i.push(s.unpack())}return i}}let tO=class ya{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsGeometry(t,r){return(r||new ya).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometry(t,r){return t.setPosition(t.position()+U0),(r||new ya).__init(t.readInt32(t.position())+t.position(),t)}ends(t){const r=this.bb.__offset(this.bb_pos,4);return r?this.bb.readUint32(this.bb.__vector(this.bb_pos+r)+t*4):0}endsLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}endsArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}xy(t){const r=this.bb.__offset(this.bb_pos,6);return r?this.bb.readFloat64(this.bb.__vector(this.bb_pos+r)+t*8):0}xyLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}xyArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}z(t){const r=this.bb.__offset(this.bb_pos,8);return r?this.bb.readFloat64(this.bb.__vector(this.bb_pos+r)+t*8):0}zLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}zArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}m(t){const r=this.bb.__offset(this.bb_pos,10);return r?this.bb.readFloat64(this.bb.__vector(this.bb_pos+r)+t*8):0}mLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}mArray(){const t=this.bb.__offset(this.bb_pos,10);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}t(t){const r=this.bb.__offset(this.bb_pos,12);return r?this.bb.readFloat64(this.bb.__vector(this.bb_pos+r)+t*8):0}tLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}tArray(){const t=this.bb.__offset(this.bb_pos,12);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}tm(t){const r=this.bb.__offset(this.bb_pos,14);return r?this.bb.readUint64(this.bb.__vector(this.bb_pos+r)+t*8):BigInt(0)}tmLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}type(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):Ns.Unknown}parts(t,r){const i=this.bb.__offset(this.bb_pos,18);return i?(r||new ya).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+t*4),this.bb):null}partsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}static startGeometry(t){t.startObject(8)}static addEnds(t,r){t.addFieldOffset(0,r,0)}static createEndsVector(t,r){t.startVector(4,r.length,4);for(let i=r.length-1;i>=0;i--)t.addInt32(r[i]);return t.endVector()}static startEndsVector(t,r){t.startVector(4,r,4)}static addXy(t,r){t.addFieldOffset(1,r,0)}static createXyVector(t,r){t.startVector(8,r.length,8);for(let i=r.length-1;i>=0;i--)t.addFloat64(r[i]);return t.endVector()}static startXyVector(t,r){t.startVector(8,r,8)}static addZ(t,r){t.addFieldOffset(2,r,0)}static createZVector(t,r){t.startVector(8,r.length,8);for(let i=r.length-1;i>=0;i--)t.addFloat64(r[i]);return t.endVector()}static startZVector(t,r){t.startVector(8,r,8)}static addM(t,r){t.addFieldOffset(3,r,0)}static createMVector(t,r){t.startVector(8,r.length,8);for(let i=r.length-1;i>=0;i--)t.addFloat64(r[i]);return t.endVector()}static startMVector(t,r){t.startVector(8,r,8)}static addT(t,r){t.addFieldOffset(4,r,0)}static createTVector(t,r){t.startVector(8,r.length,8);for(let i=r.length-1;i>=0;i--)t.addFloat64(r[i]);return t.endVector()}static startTVector(t,r){t.startVector(8,r,8)}static addTm(t,r){t.addFieldOffset(5,r,0)}static createTmVector(t,r){t.startVector(8,r.length,8);for(let i=r.length-1;i>=0;i--)t.addInt64(r[i]);return t.endVector()}static startTmVector(t,r){t.startVector(8,r,8)}static addType(t,r){t.addFieldInt8(6,r,Ns.Unknown)}static addParts(t,r){t.addFieldOffset(7,r,0)}static createPartsVector(t,r){t.startVector(4,r.length,4);for(let i=r.length-1;i>=0;i--)t.addOffset(r[i]);return t.endVector()}static startPartsVector(t,r){t.startVector(4,r,4)}static endGeometry(t){return t.endObject()}static createGeometry(t,r,i,n,s,c,a,p,_){return ya.startGeometry(t),ya.addEnds(t,r),ya.addXy(t,i),ya.addZ(t,n),ya.addM(t,s),ya.addT(t,c),ya.addTm(t,a),ya.addType(t,p),ya.addParts(t,_),ya.endGeometry(t)}};function Kw(e,t){const r=[];for(let i=0;i<e.length;i+=2){const n=[e[i],e[i+1]];t&&n.push(t[i>>1]),r.push(n)}return r}function gT(e,t,r){if(!r||r.length===0)return[Kw(e,t)];let i=0;const n=Array.from(r).map(c=>e.slice(i,i=c<<1));let s;return t&&(i=0,s=Array.from(r).map(c=>t.slice(i,i=c))),n.map((c,a)=>Kw(c,s?s[a]:void 0))}function eO(e,t){const r=e.xyArray(),i=e.zArray();switch(t){case Ns.Point:{const n=Array.from(r);return i&&n.push(i[0]),n}case Ns.MultiPoint:case Ns.LineString:return Kw(r,i);case Ns.MultiLineString:return gT(r,i,e.endsArray());case Ns.Polygon:return gT(r,i,e.endsArray())}}function Qw(e,t){let r=t;if(r===Ns.Unknown&&(r=e.type()),r===Ns.GeometryCollection){const n=[];for(let s=0;s<e.partsLength();s++){const c=e.parts(s),a=c.type();n.push(Qw(c,a))}return{type:Ns[r],geometries:n}}else if(r===Ns.MultiPolygon){const n=[];for(let s=0;s<e.partsLength();s++)n.push(Qw(e.parts(s),Ns.Polygon));return{type:Ns[r],coordinates:n.map(s=>s.coordinates)}}const i=eO(e,r);return{type:Ns[r],coordinates:i}}var Rs;(function(e){e[e.Byte=0]="Byte",e[e.UByte=1]="UByte",e[e.Bool=2]="Bool",e[e.Short=3]="Short",e[e.UShort=4]="UShort",e[e.Int=5]="Int",e[e.UInt=6]="UInt",e[e.Long=7]="Long",e[e.ULong=8]="ULong",e[e.Float=9]="Float",e[e.Double=10]="Double",e[e.String=11]="String",e[e.Json=12]="Json",e[e.DateTime=13]="DateTime",e[e.Binary=14]="Binary"})(Rs||(Rs={}));class ks{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsColumn(t,r){return(r||new ks).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsColumn(t,r){return t.setPosition(t.position()+U0),(r||new ks).__init(t.readInt32(t.position())+t.position(),t)}name(t){const r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,t):null}type(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):Rs.Byte}title(t){const r=this.bb.__offset(this.bb_pos,8);return r?this.bb.__string(this.bb_pos+r,t):null}description(t){const r=this.bb.__offset(this.bb_pos,10);return r?this.bb.__string(this.bb_pos+r,t):null}width(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1}precision(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1}scale(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1}nullable(){const t=this.bb.__offset(this.bb_pos,18);return t?!!this.bb.readInt8(this.bb_pos+t):!0}unique(){const t=this.bb.__offset(this.bb_pos,20);return t?!!this.bb.readInt8(this.bb_pos+t):!1}primaryKey(){const t=this.bb.__offset(this.bb_pos,22);return t?!!this.bb.readInt8(this.bb_pos+t):!1}metadata(t){const r=this.bb.__offset(this.bb_pos,24);return r?this.bb.__string(this.bb_pos+r,t):null}static startColumn(t){t.startObject(11)}static addName(t,r){t.addFieldOffset(0,r,0)}static addType(t,r){t.addFieldInt8(1,r,Rs.Byte)}static addTitle(t,r){t.addFieldOffset(2,r,0)}static addDescription(t,r){t.addFieldOffset(3,r,0)}static addWidth(t,r){t.addFieldInt32(4,r,-1)}static addPrecision(t,r){t.addFieldInt32(5,r,-1)}static addScale(t,r){t.addFieldInt32(6,r,-1)}static addNullable(t,r){t.addFieldInt8(7,+r,1)}static addUnique(t,r){t.addFieldInt8(8,+r,0)}static addPrimaryKey(t,r){t.addFieldInt8(9,+r,0)}static addMetadata(t,r){t.addFieldOffset(10,r,0)}static endColumn(t){const r=t.endObject();return t.requiredField(r,4),r}static createColumn(t,r,i,n,s,c,a,p,_,w,S,C){return ks.startColumn(t),ks.addName(t,r),ks.addType(t,i),ks.addTitle(t,n),ks.addDescription(t,s),ks.addWidth(t,c),ks.addPrecision(t,a),ks.addScale(t,p),ks.addNullable(t,_),ks.addUnique(t,w),ks.addPrimaryKey(t,S),ks.addMetadata(t,C),ks.endColumn(t)}}class fc{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsFeature(t,r){return(r||new fc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFeature(t,r){return t.setPosition(t.position()+U0),(r||new fc).__init(t.readInt32(t.position())+t.position(),t)}geometry(t){const r=this.bb.__offset(this.bb_pos,4);return r?(t||new tO).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}properties(t){const r=this.bb.__offset(this.bb_pos,6);return r?this.bb.readUint8(this.bb.__vector(this.bb_pos+r)+t):0}propertiesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}propertiesArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}columns(t,r){const i=this.bb.__offset(this.bb_pos,8);return i?(r||new ks).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFeature(t){t.startObject(3)}static addGeometry(t,r){t.addFieldOffset(0,r,0)}static addProperties(t,r){t.addFieldOffset(1,r,0)}static createPropertiesVector(t,r){t.startVector(1,r.length,1);for(let i=r.length-1;i>=0;i--)t.addInt8(r[i]);return t.endVector()}static startPropertiesVector(t,r){t.startVector(1,r,1)}static addColumns(t,r){t.addFieldOffset(2,r,0)}static createColumnsVector(t,r){t.startVector(4,r.length,4);for(let i=r.length-1;i>=0;i--)t.addOffset(r[i]);return t.endVector()}static startColumnsVector(t,r){t.startVector(4,r,4)}static endFeature(t){return t.endObject()}static finishFeatureBuffer(t,r){t.finish(r)}static finishSizePrefixedFeatureBuffer(t,r){t.finish(r,void 0,!0)}static createFeature(t,r,i,n){return fc.startFeature(t),fc.addGeometry(t,r),fc.addProperties(t,i),fc.addColumns(t,n),fc.endFeature(t)}}new TextEncoder;const yT=new TextDecoder;function rO(e,t){const r={};if(!t||t.length===0)return r;const i=e.propertiesArray();if(!i)return r;const n=new DataView(i.buffer,i.byteOffset),s=e.propertiesLength();let c=0;for(;c<s;){const a=n.getUint16(c,!0);c+=2;const p=t[a],_=p.name;switch(p.type){case Rs.Bool:{r[_]=!!n.getUint8(c),c+=1;break}case Rs.Byte:{r[_]=n.getInt8(c),c+=1;break}case Rs.UByte:{r[_]=n.getUint8(c),c+=1;break}case Rs.Short:{r[_]=n.getInt16(c,!0),c+=2;break}case Rs.UShort:{r[_]=n.getUint16(c,!0),c+=2;break}case Rs.Int:{r[_]=n.getInt32(c,!0),c+=4;break}case Rs.UInt:{r[_]=n.getUint32(c,!0),c+=4;break}case Rs.Long:{r[_]=Number(n.getBigInt64(c,!0)),c+=8;break}case Rs.ULong:{r[_]=Number(n.getBigUint64(c,!0)),c+=8;break}case Rs.Float:{r[_]=n.getFloat32(c,!0),c+=4;break}case Rs.Double:{r[_]=n.getFloat64(c,!0),c+=8;break}case Rs.DateTime:case Rs.String:{const w=n.getUint32(c,!0);c+=4,r[_]=yT.decode(i.subarray(c,c+w)),c+=w;break}case Rs.Json:{const w=n.getUint32(c,!0);c+=4;const S=yT.decode(i.subarray(c,c+w));r[_]=JSON.parse(S),c+=w;break}default:throw new Error("Unknown type "+p.type)}}return r}function nS(e,t){const r=t.columns;return{type:"Feature",geometry:Qw(e.geometry(),t.geometryType),properties:rO(e,r)}}const sS=new Uint8Array(0);function iO(){return this._source.cancel()}function nO(e,t){if(!e.length)return t;if(!t.length)return e;var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function sO(){var e=this,t=e._array.subarray(e._index);return e._source.read().then(function(r){return e._array=sS,e._index=0,r.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:nO(t,r.value)}})}function oO(e){if((e|=0)<0)throw new Error("invalid length");var t=this,r=this._array.length-this._index;if(this._index+e<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=e));var i=new Uint8Array(e);return i.set(this._array.subarray(this._index)),function n(){return t._source.read().then(function(s){return s.done?(t._array=sS,t._index=0,r>0?i.subarray(0,r):null):r+s.value.length>=e?(t._array=s.value,t._index=e-r,i.set(s.value.subarray(0,e-r),r),i):(i.set(s.value,r),r+=s.value.length,n())})}()}function aO(e){return typeof e.slice=="function"?e:new lv(typeof e.read=="function"?e:e.getReader())}function lv(e){this._source=e,this._array=sS,this._index=0}lv.prototype.read=sO;lv.prototype.slice=oO;lv.prototype.cancel=iO;class Ll{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsCrs(t,r){return(r||new Ll).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsCrs(t,r){return t.setPosition(t.position()+U0),(r||new Ll).__init(t.readInt32(t.position())+t.position(),t)}org(t){const r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,t):null}code(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}name(t){const r=this.bb.__offset(this.bb_pos,8);return r?this.bb.__string(this.bb_pos+r,t):null}description(t){const r=this.bb.__offset(this.bb_pos,10);return r?this.bb.__string(this.bb_pos+r,t):null}wkt(t){const r=this.bb.__offset(this.bb_pos,12);return r?this.bb.__string(this.bb_pos+r,t):null}codeString(t){const r=this.bb.__offset(this.bb_pos,14);return r?this.bb.__string(this.bb_pos+r,t):null}static startCrs(t){t.startObject(6)}static addOrg(t,r){t.addFieldOffset(0,r,0)}static addCode(t,r){t.addFieldInt32(1,r,0)}static addName(t,r){t.addFieldOffset(2,r,0)}static addDescription(t,r){t.addFieldOffset(3,r,0)}static addWkt(t,r){t.addFieldOffset(4,r,0)}static addCodeString(t,r){t.addFieldOffset(5,r,0)}static endCrs(t){return t.endObject()}static createCrs(t,r,i,n,s,c,a){return Ll.startCrs(t),Ll.addOrg(t,r),Ll.addCode(t,i),Ll.addName(t,n),Ll.addDescription(t,s),Ll.addWkt(t,c),Ll.addCodeString(t,a),Ll.endCrs(t)}}class b_{constructor(){this.bb=null,this.bb_pos=0}__init(t,r){return this.bb_pos=t,this.bb=r,this}static getRootAsHeader(t,r){return(r||new b_).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsHeader(t,r){return t.setPosition(t.position()+U0),(r||new b_).__init(t.readInt32(t.position())+t.position(),t)}name(t){const r=this.bb.__offset(this.bb_pos,4);return r?this.bb.__string(this.bb_pos+r,t):null}envelope(t){const r=this.bb.__offset(this.bb_pos,6);return r?this.bb.readFloat64(this.bb.__vector(this.bb_pos+r)+t*8):0}envelopeLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}envelopeArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}geometryType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):Ns.Unknown}hasZ(){const t=this.bb.__offset(this.bb_pos,10);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasM(){const t=this.bb.__offset(this.bb_pos,12);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasT(){const t=this.bb.__offset(this.bb_pos,14);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasTm(){const t=this.bb.__offset(this.bb_pos,16);return t?!!this.bb.readInt8(this.bb_pos+t):!1}columns(t,r){const i=this.bb.__offset(this.bb_pos,18);return i?(r||new ks).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}featuresCount(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):BigInt("0")}indexNodeSize(){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16}crs(t){const r=this.bb.__offset(this.bb_pos,24);return r?(t||new Ll).__init(this.bb.__indirect(this.bb_pos+r),this.bb):null}title(t){const r=this.bb.__offset(this.bb_pos,26);return r?this.bb.__string(this.bb_pos+r,t):null}description(t){const r=this.bb.__offset(this.bb_pos,28);return r?this.bb.__string(this.bb_pos+r,t):null}metadata(t){const r=this.bb.__offset(this.bb_pos,30);return r?this.bb.__string(this.bb_pos+r,t):null}static startHeader(t){t.startObject(14)}static addName(t,r){t.addFieldOffset(0,r,0)}static addEnvelope(t,r){t.addFieldOffset(1,r,0)}static createEnvelopeVector(t,r){t.startVector(8,r.length,8);for(let i=r.length-1;i>=0;i--)t.addFloat64(r[i]);return t.endVector()}static startEnvelopeVector(t,r){t.startVector(8,r,8)}static addGeometryType(t,r){t.addFieldInt8(2,r,Ns.Unknown)}static addHasZ(t,r){t.addFieldInt8(3,+r,0)}static addHasM(t,r){t.addFieldInt8(4,+r,0)}static addHasT(t,r){t.addFieldInt8(5,+r,0)}static addHasTm(t,r){t.addFieldInt8(6,+r,0)}static addColumns(t,r){t.addFieldOffset(7,r,0)}static createColumnsVector(t,r){t.startVector(4,r.length,4);for(let i=r.length-1;i>=0;i--)t.addOffset(r[i]);return t.endVector()}static startColumnsVector(t,r){t.startVector(4,r,4)}static addFeaturesCount(t,r){t.addFieldInt64(8,r,BigInt("0"))}static addIndexNodeSize(t,r){t.addFieldInt16(9,r,16)}static addCrs(t,r){t.addFieldOffset(10,r,0)}static addTitle(t,r){t.addFieldOffset(11,r,0)}static addDescription(t,r){t.addFieldOffset(12,r,0)}static addMetadata(t,r){t.addFieldOffset(13,r,0)}static endHeader(t){return t.endObject()}static finishHeaderBuffer(t,r){t.finish(r)}static finishSizePrefixedHeaderBuffer(t,r){t.finish(r,void 0,!0)}}function oS(e){const t=b_.getRootAsHeader(e),r=t.featuresCount(),i=t.indexNodeSize(),n=[];for(let a=0;a<t.columnsLength();a++){const p=t.columns(a);if(!p)throw new Error("Column unexpectedly missing");if(!p.name())throw new Error("Column name unexpectedly missing");n.push({name:p.name(),type:p.type(),title:p.title(),description:p.description(),width:p.width(),precision:p.precision(),scale:p.scale(),nullable:p.nullable(),unique:p.unique(),primary_key:p.primaryKey()})}const s=t.crs(),c=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:t.geometryType(),columns:n,envelope:null,featuresCount:Number(r),indexNodeSize:i,crs:c,title:t.title(),description:t.description(),metadata:t.metadata()}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var tx=function(e,t){return tx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},tx(e,t)};function lO(e,t){tx(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function fm(e,t,r,i){function n(s){return s instanceof r?s:new r(function(c){c(s)})}return new(r||(r=Promise))(function(s,c){function a(w){try{_(i.next(w))}catch(S){c(S)}}function p(w){try{_(i.throw(w))}catch(S){c(S)}}function _(w){w.done?s(w.value):n(w.value).then(a,p)}_((i=i.apply(e,[])).next())})}function xd(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(_){return function(w){return p([_,w])}}function p(_){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=_[0]&2?n.return:_[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,_[1])).done)return s;switch(n=0,s&&(_=[_[0]&2,s.value]),_[0]){case 0:case 1:s=_;break;case 4:return r.label++,{value:_[1],done:!1};case 5:r.label++,n=_[1],_=[0];continue;case 7:_=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(_[0]===6||_[0]===2)){r=0;continue}if(_[0]===3&&(!s||_[1]>s[0]&&_[1]<s[3])){r.label=_[1];break}if(_[0]===6&&r.label<s[1]){r.label=s[1],s=_;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(_);break}s[2]&&r.ops.pop(),r.trys.pop();continue}_=t.call(e,r)}catch(w){_=[6,w],n=0}finally{i=s=0}if(_[0]&5)throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}}function Pm(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function x0(e){return this instanceof x0?(this.v=e,this):new x0(e)}function cO(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(e,t||[]),n,s=[];return n={},c("next"),c("throw"),c("return"),n[Symbol.asyncIterator]=function(){return this},n;function c(C){i[C]&&(n[C]=function(I){return new Promise(function(N,F){s.push([C,I,N,F])>1||a(C,I)})})}function a(C,I){try{p(i[C](I))}catch(N){S(s[0][3],N)}}function p(C){C.value instanceof x0?Promise.resolve(C.value.v).then(_,w):S(s[0][2],C)}function _(C){a("next",C)}function w(C){a("throw",C)}function S(C,I){C(I),s.shift(),s.length&&a(s[0][0],s[0][1])}}var NM=function(e){lO(t,e);function t(r){var i=e.call(this,r)||this;return Object.defineProperty(i,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(i,i.constructor.prototype):i.__proto__=i.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(i,i.constructor),i}return t}(Error);(function(){function e(t){if(t<0)throw new RangeError("Capacity may not be less than 0");this._c=t,this._q=[]}return Object.defineProperty(e.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),e.prototype.add=function(t){if(this.full)throw new Error("Buffer full");this._q.push(t)},e.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},e})();(function(){function e(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(e.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.add=function(t){for(;this._q.length>=this._c;)this._q.shift();this._q.push(t)},e.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},e})();(function(){function e(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(e.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.add=function(t){this._q.length<this._c&&this._q.push(t)},e.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},e})();function ex(e){e!=null&&typeof e.then=="function"&&e.then(S_,S_)}var Ub=0,_T=1,Lp=2,w_=3,rx=4,x_=1024,S_=function(){};function Yf(e){var t=e.err,r=Promise.resolve(e.execution).then(function(i){if(t!=null)throw t;return i});return e.err=void 0,e.execution=r.then(function(){},function(){}),e.pending===void 0?r:e.pending.then(function(){return r})}function ap(e,t){var r=e.state>=w_;return Promise.resolve(t).then(function(i){return!r&&e.state>=rx?Yf(e).then(function(n){return{value:n,done:!0}}):{value:i,done:r}})}function aS(e,t){var r,i;if(!(e.state>=Lp))if(e.state=Lp,e.onnext(),e.onstop(),e.err==null&&(e.err=t),e.pushes.length===0&&(typeof e.buffer>"u"||e.buffer.empty))Yg(e);else try{for(var n=Pm(e.pushes),s=n.next();!s.done;s=n.next()){var c=s.value;c.resolve()}}catch(a){r={error:a}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}}function Yg(e){var t,r;if(!(e.state>=w_)){e.state<Lp&&aS(e),e.state=w_,e.buffer=void 0;try{for(var i=Pm(e.nexts),n=i.next();!n.done;n=i.next()){var s=n.value,c=e.pending===void 0?Yf(e):e.pending.then(function(){return Yf(e)});s.resolve(ap(e,c))}}catch(a){t={error:a}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.pushes=[],e.nexts=[]}}function vT(e){e.state>=rx||(e.state<w_&&Yg(e),e.state=rx)}function uO(e,t){if(ex(t),e.pushes.length>=x_)throw new NM("No more than "+x_+" pending calls to push are allowed on a single repeater.");if(e.state>=Lp)return Promise.resolve(void 0);var r=e.pending===void 0?Promise.resolve(t):e.pending.then(function(){return t});r=r.catch(function(p){e.state<Lp&&(e.err=p),vT(e)});var i;if(e.nexts.length){var n=e.nexts.shift();n.resolve(ap(e,r)),e.nexts.length?i=Promise.resolve(e.nexts[0].value):i=new Promise(function(p){return e.onnext=p})}else typeof e.buffer<"u"&&!e.buffer.full?(e.buffer.add(r),i=Promise.resolve(void 0)):i=new Promise(function(p){return e.pushes.push({resolve:p,value:r})});var s=!0,c={},a=i.catch(function(p){if(s)throw p});return c.then=function(p,_){return s=!1,Promise.prototype.then.call(i,p,_)},c.catch=function(p){return s=!1,Promise.prototype.catch.call(i,p)},c.finally=i.finally.bind(i),e.pending=r.then(function(){return a}).catch(function(p){e.err=p,vT(e)}),c}function hO(e){var t=aS.bind(null,e),r=new Promise(function(i){return e.onstop=i});return t.then=r.then.bind(r),t.catch=r.catch.bind(r),t.finally=r.finally.bind(r),t}function dO(e){if(!(e.state>=_T)){e.state=_T;var t=uO.bind(null,e),r=hO(e);e.execution=new Promise(function(i){return i(e.executor(t,r))}),e.execution.catch(function(){return aS(e)})}}var G1=new WeakMap,G0=function(){function e(t,r){G1.set(this,{executor:t,buffer:r,err:void 0,state:Ub,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:S_,onstop:S_})}return e.prototype.next=function(t){ex(t);var r=G1.get(this);if(r===void 0)throw new Error("WeakMap error");if(r.nexts.length>=x_)throw new NM("No more than "+x_+" pending calls to next are allowed on a single repeater.");if(r.state<=Ub&&dO(r),r.onnext(t),typeof r.buffer<"u"&&!r.buffer.empty){var i=ap(r,r.buffer.remove());if(r.pushes.length){var n=r.pushes.shift();r.buffer.add(n.value),r.onnext=n.resolve}return i}else if(r.pushes.length){var s=r.pushes.shift();return r.onnext=s.resolve,ap(r,s.value)}else if(r.state>=Lp)return Yg(r),ap(r,Yf(r));return new Promise(function(c){return r.nexts.push({resolve:c,value:t})})},e.prototype.return=function(t){ex(t);var r=G1.get(this);if(r===void 0)throw new Error("WeakMap error");return Yg(r),r.execution=Promise.resolve(r.execution).then(function(){return t}),ap(r,Yf(r))},e.prototype.throw=function(t){var r=G1.get(this);if(r===void 0)throw new Error("WeakMap error");return r.state<=Ub||r.state>=Lp||typeof r.buffer<"u"&&!r.buffer.empty?(Yg(r),r.err==null&&(r.err=t),ap(r,Yf(r))):this.next(Promise.reject(t))},e.prototype[Symbol.asyncIterator]=function(){return this},e.race=pO,e.merge=fO,e.zip=mO,e.latest=gO,e}();function cv(e,t){var r,i,n=[],s=function(_){_!=null&&typeof _[Symbol.asyncIterator]=="function"?n.push(_[Symbol.asyncIterator]()):_!=null&&typeof _[Symbol.iterator]=="function"?n.push(_[Symbol.iterator]()):n.push(function(){return cO(this,arguments,function(){return xd(this,function(w){switch(w.label){case 0:return t.yieldValues?[4,x0(_)]:[3,3];case 1:return[4,w.sent()];case 2:w.sent(),w.label=3;case 3:return t.returnValues?[4,x0(_)]:[3,5];case 4:return[2,w.sent()];case 5:return[2]}})})}())};try{for(var c=Pm(e),a=c.next();!a.done;a=c.next()){var p=a.value;s(p)}}catch(_){r={error:_}}finally{try{a&&!a.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}return n}function pO(e){var t=this,r=cv(e,{returnValues:!0});return new G0(function(i,n){return fm(t,void 0,void 0,function(){var s,c,a,p,_,w;return xd(this,function(S){switch(S.label){case 0:if(!r.length)return n(),[2];c=!1,n.then(function(){s(),c=!0}),S.label=1;case 1:S.trys.push([1,,5,7]),p=void 0,_=0,w=function(){var C,I,N,F,W,U;return xd(this,function(z){switch(z.label){case 0:C=_;try{for(I=(W=void 0,Pm(r)),N=I.next();!N.done;N=I.next())F=N.value,Promise.resolve(F.next()).then(function(H){H.done?(n(),a===void 0&&(a=H)):_===C&&(_++,s(H))},function(H){return n(H)})}catch(H){W={error:H}}finally{try{N&&!N.done&&(U=I.return)&&U.call(I)}finally{if(W)throw W.error}}return[4,new Promise(function(H){return s=H})];case 1:return p=z.sent(),p===void 0?[3,3]:[4,i(p.value)];case 2:z.sent(),z.label=3;case 3:return[2]}})},S.label=2;case 2:return c?[3,4]:[5,w()];case 3:return S.sent(),[3,2];case 4:return[2,a&&a.value];case 5:return n(),[4,Promise.race(r.map(function(C){return C.return&&C.return()}))];case 6:return S.sent(),[7];case 7:return[2]}})})})}function fO(e){var t=this,r=cv(e,{yieldValues:!0});return new G0(function(i,n){return fm(t,void 0,void 0,function(){var s,c,a,p=this;return xd(this,function(_){switch(_.label){case 0:if(!r.length)return n(),[2];s=[],c=!1,n.then(function(){var w,S;c=!0;try{for(var C=Pm(s),I=C.next();!I.done;I=C.next()){var N=I.value;N()}}catch(F){w={error:F}}finally{try{I&&!I.done&&(S=C.return)&&S.call(C)}finally{if(w)throw w.error}}}),_.label=1;case 1:return _.trys.push([1,,3,4]),[4,Promise.all(r.map(function(w,S){return fm(p,void 0,void 0,function(){var C,I;return xd(this,function(N){switch(N.label){case 0:N.trys.push([0,,6,9]),N.label=1;case 1:return c?[3,5]:(Promise.resolve(w.next()).then(function(F){return s[S](F)},function(F){return n(F)}),[4,new Promise(function(F){s[S]=F})]);case 2:return C=N.sent(),C===void 0?[3,4]:C.done?(a=C,[2]):[4,i(C.value)];case 3:N.sent(),N.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return I=w.return,I?[4,w.return()]:[3,8];case 7:I=N.sent(),N.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return _.sent(),[2,a&&a.value];case 3:return n(),[7];case 4:return[2]}})})})}function mO(e){var t=this,r=cv(e,{returnValues:!0});return new G0(function(i,n){return fm(t,void 0,void 0,function(){var s,c,a,p;return xd(this,function(_){switch(_.label){case 0:if(!r.length)return n(),[2,[]];c=!1,n.then(function(){s(),c=!0}),_.label=1;case 1:_.trys.push([1,,6,8]),_.label=2;case 2:return c?[3,5]:(Promise.all(r.map(function(w){return w.next()})).then(function(w){return s(w)},function(w){return n(w)}),[4,new Promise(function(w){return s=w})]);case 3:return a=_.sent(),a===void 0?[2]:(p=a.map(function(w){return w.value}),a.some(function(w){return w.done})?[2,p]:[4,i(p)]);case 4:return _.sent(),[3,2];case 5:return[3,8];case 6:return n(),[4,Promise.all(r.map(function(w){return w.return&&w.return()}))];case 7:return _.sent(),[7];case 8:return[2]}})})})}function gO(e){var t=this,r=cv(e,{yieldValues:!0,returnValues:!0});return new G0(function(i,n){return fm(t,void 0,void 0,function(){var s,c,a,p,_,w=this;return xd(this,function(S){switch(S.label){case 0:if(!r.length)return n(),[2,[]];c=[],a=!1,n.then(function(){var C,I;s();try{for(var N=Pm(c),F=N.next();!F.done;F=N.next()){var W=F.value;W()}}catch(U){C={error:U}}finally{try{F&&!F.done&&(I=N.return)&&I.call(N)}finally{if(C)throw C.error}}a=!0}),S.label=1;case 1:return S.trys.push([1,,5,7]),Promise.all(r.map(function(C){return C.next()})).then(function(C){return s(C)},function(C){return n(C)}),[4,new Promise(function(C){return s=C})];case 2:return p=S.sent(),p===void 0?[2]:(_=p.map(function(C){return C.value}),p.every(function(C){return C.done})?[2,_]:[4,i(_.slice())]);case 3:return S.sent(),[4,Promise.all(r.map(function(C,I){return fm(w,void 0,void 0,function(){var N;return xd(this,function(F){switch(F.label){case 0:if(p[I].done)return[2,p[I].value];F.label=1;case 1:return a?[3,4]:(Promise.resolve(C.next()).then(function(W){return c[I](W)},function(W){return n(W)}),[4,new Promise(function(W){return c[I]=W})]);case 2:return N=F.sent(),N===void 0?[2,p[I].value]:N.done?[2,N.value]:(_[I]=N.value,[4,i(_.slice())]);case 3:return F.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,S.sent()];case 5:return n(),[4,Promise.all(r.map(function(C){return C.return&&C.return()}))];case 6:return S.sent(),[7];case 7:return[2]}})})})}let A_=class{constructor(){this._extraRequestThreshold=256*1024}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw new Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}};A_.global=new A_;var dc;(function(e){e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Warn=2]="Warn",e[e.Error=3]="Error"})(dc||(dc={}));class Os{static debug(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.log(dc.Debug,...r)}static info(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.log(dc.Info,...r)}static warn(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.log(dc.Warn,...r)}static error(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.log(dc.Error,...r)}static log(t){if(!(this.logLevel>t)){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];switch(t){case dc.Debug:{console.debug(...i);break}case dc.Info:{console.info(...i);break}case dc.Warn:{console.warn(...i);break}case dc.Error:{console.error(...i);break}}}}}Os.logLevel=dc.Warn;const lp=8*4+8,yO=16;function lS(e,t){t=Math.min(Math.max(+t,2),65535);let r=e,i=r;do r=Math.ceil(r/t),i+=r;while(r!==1);return i*lp}function _O(e,t){if(t<2)throw new Error("Node size must be at least 2");if(e===0)throw new Error("Number of items must be greater than 0");let r=e,i=r;const n=[r];do r=Math.ceil(r/t),i+=r,n.push(r);while(r!==1);const s=[];r=i;for(const a of n)s.push(r-a),r-=a;const c=[];for(let a=0;a<n.length;a++)c.push([s[a],s[a]+n[a]]);return c}async function*vO(e,t,r,i){class n{constructor(I,N){this._level=N,this.nodes=I}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(I){console.assert(I>this.nodes[1]),this.nodes[1]=I}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}const{minX:s,minY:c,maxX:a,maxY:p}=r;Os.info(`tree items: ${e}, nodeSize: ${t}`);const _=_O(e,t),w=_[0][0],S=[(()=>{const C=[0,1],I=_.length-1;return new n(C,I)})()];for(Os.debug(`starting stream search with queue: ${S}, numItems: ${e}, nodeSize: ${t}, levelBounds: ${_}`);S.length!=0;){const C=S.shift();Os.debug(`popped node: ${C}, queueLength: ${S.length}`);const I=C.startNodeIdx(),N=I>=w,F=(()=>{const[,H]=_[C.level()],nt=Math.min(C.endNodeIdx()+t,H);return N&&nt<H?nt+1:nt})(),W=F-I,U=await i(I*lp,W*lp),z=new DataView(U);for(let H=I;H<F;H++){const nt=H-I,yt=nt*lp;if(a<z.getFloat64(yt+0,!0)||p<z.getFloat64(yt+8,!0)||s>z.getFloat64(yt+16,!0)||c>z.getFloat64(yt+24,!0))continue;const bt=z.getBigUint64(yt+32,!0);if(N){const at=bt,dt=(()=>{if(H<e-1){const xt=(nt+1)*lp;return z.getBigUint64(xt+32,!0)-at}else return null})(),It=H-w;yield[Number(at),It,Number(dt)];continue}const vt=bt,mt=A_.global.extraRequestThreshold()/lp,Dt=S[S.length-1];if(Dt!==void 0&&Dt.level()==C.level()-1&&vt<Dt.endNodeIdx()+mt){Os.debug(`Merging "nodeRange" request into existing range: ${Dt}, newEndNodeIdx: ${Dt.endNodeIdx()} -> ${vt}`),Dt.extendEndNodeIdx(Number(vt));continue}const kt=(()=>{const at=C.level()-1,dt=[Number(vt),Number(vt)+1];return new n(dt,at)})();Dt!==void 0&&Dt.level()==kt.level()?Os.info(`Same level, but too far away. Pushing new request for nodeIdx: ${vt} rather than merging with distant ${Dt}`):Os.info(`Pushing new level for ${kt} onto queue with nearestNodeRange: ${Dt} since there's not already a range for this level.`),S.push(kt)}}}const ad=new Uint8Array([102,103,98,3,102,103,98,0]),ah=4;class cS{constructor(t,r,i,n,s){this.headerClient=t,this.header=r,this.headerLength=i,this.indexLength=n,this.nocache=s}static async open(t,r){const i=new bT(t,r),n=(()=>{const S=yO,C=3;let I=0,N;for(N=0;N<C;N++){const F=S**N*lp;I+=F}return I})(),s=2024+n;Os.debug(`fetching header. minReqLength: ${s} (assumedHeaderLength: 2024, assumedIndexLength: ${n})`);{const S=new Uint8Array(await i.getRange(0,8,s,"header"));if(!S.subarray(0,3).every((C,I)=>ad[I]===C))throw Os.error(`bytes: ${S} != ${ad}`),new Error("Not a FlatGeobuf file");Os.debug("magic bytes look good")}let c;{const S=await i.getRange(8,4,s,"header");c=new DataView(S).getUint32(0,!0);const C=1048576*10;if(c>C||c<8)throw new Error("Invalid header size");Os.debug(`headerLength: ${c}`)}const a=await i.getRange(12,c,s,"header"),p=new _h(new Uint8Array(a)),_=oS(p),w=lS(_.featuresCount,_.indexNodeSize);return Os.debug("completed: opening http reader"),new cS(i,_,c,w,r)}async*selectBbox(t){const r=this.lengthBeforeTree(),i=this.headerClient,n=async function(p,_){return i.getRange(r+p,_,0,"index")},s=[];let c=[];for await(const p of vO(this.header.featuresCount,this.header.indexNodeSize,t,n)){const[_,,]=p;let[,,w]=p;if(w||(Os.info("final feature"),w=4),c.length==0){c.push([_,w]);continue}const S=c[c.length-1],C=_-(S[0]+S[1]);C>A_.global.extraRequestThreshold()&&(Os.info(`Pushing new feature batch, since gap ${C} was too large`),s.push(c),c=[]),c.push([_,w])}this.headerClient.logUsage("header+index"),c.length>0&&s.push(c);const a=s.flatMap(p=>this.readFeatureBatch(p,this.nocache));yield*G0.merge(a)}lengthBeforeTree(){return ad.length+ah+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(t){return new bT(this.headerClient.httpClient,t)}async*readFeatureBatch(t,r){const[i]=t[0],[n,s]=t[t.length-1],c=i,a=n+s-c,p=this.buildFeatureClient(r);let _=a;for(const[w]of t)yield await this.readFeature(p,w,_),_=0;p.logUsage("feature")}async readFeature(t,r,i){const n=r+this.lengthBeforeFeatures();let s;{const w=await t.getRange(n,4,i,"feature length");s=new DataView(w).getUint32(0,!0)}const c=await t.getRange(n+4,s,i,"feature data"),a=new Uint8Array(c),p=new Uint8Array(s+ah);p.set(a,ah);const _=new _h(p);return _.setPosition(ah),fc.getRootAsFeature(_)}}class bT{constructor(t,r){if(this.bytesEverUsed=0,this.bytesEverFetched=0,this.buffer=new ArrayBuffer(0),this.head=0,typeof t=="string")this.httpClient=new wT(t,r);else if(t instanceof wT)this.httpClient=t;else throw new Error("Unknown source ")}async getRange(t,r,i,n){this.bytesEverUsed+=r;const s=t-this.head,c=s+r;if(s>=0&&c<=this.buffer.byteLength)return this.buffer.slice(s,c);const a=Math.max(r,i);return this.bytesEverFetched+=a,Os.debug(`requesting for new Range: ${t}-${t+a-1}`),this.buffer=await this.httpClient.getRange(t,a,n),this.head=t,this.buffer.slice(0,r)}logUsage(t){const r=t.split(" ")[0],i=this.bytesEverUsed,n=this.bytesEverFetched,s=(100*i/n).toFixed(2);Os.info(`${r} bytes used/requested: ${i} / ${n} = ${s}%`)}}class wT{constructor(t,r){this.requestsEverMade=0,this.bytesEverRequested=0,this.url=t,this.nocache=r}async getRange(t,r,i){this.requestsEverMade+=1,this.bytesEverRequested+=r;const n=`bytes=${t}-${t+r-1}`;Os.info(`request: #${this.requestsEverMade}, purpose: ${i}), bytes: (this_request: ${r}, ever: ${this.bytesEverRequested}), Range: ${n}`);const s={Range:n};return this.nocache&&(s["Cache-Control"]="no-cache, no-store"),(await fetch(this.url,{headers:s})).arrayBuffer()}}function bO(e,t,r){if(!e.subarray(0,3).every((w,S)=>ad[S]===w))throw new Error("Not a FlatGeobuf file");const i=new _h(e),n=i.readUint32(ad.length);i.setPosition(ad.length+ah);const s=oS(i);let c=ad.length+ah+n;const{indexNodeSize:a,featuresCount:p}=s;a>0&&(c+=lS(p,a));const _=[];for(;c<i.capacity();){const w=i.readUint32(c);i.setPosition(c+ah);const S=fc.getRootAsFeature(i);_.push(t(S,s)),c+=ah+w}return _}async function*wO(e,t,r){const i=aO(e),n=async C=>await i.slice(C);let s=new Uint8Array(await n(8));if(!s.subarray(0,3).every((C,I)=>ad[I]===C))throw new Error("Not a FlatGeobuf file");s=new Uint8Array(await n(4));let c=new _h(s);const a=c.readUint32(0);s=new Uint8Array(await n(a)),c=new _h(s);const p=oS(c),{indexNodeSize:_,featuresCount:w}=p;if(_>0){const C=lS(w,_);await n(C)}let S;for(;S=await SO(n,p,t);)yield S}function xO(e,t,r,i){try{let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return async function*(){const s=await cS.open(e,n);Os.debug("opened reader");for await(const c of s.selectBbox(t))yield r(c,s.header)}()}catch(n){return Promise.reject(n)}}async function SO(e,t,r){let i=new Uint8Array(await e(4,"feature length"));if(i.byteLength===0)return;let n=new _h(i);const s=n.readUint32(0);i=new Uint8Array(await e(s,"feature data"));const c=new Uint8Array(s+4);c.set(i,4),n=new _h(c),n.setPosition(ah);const a=fc.getRootAsFeature(n);return r(a,t)}function AO(e,t){return{type:"FeatureCollection",features:bO(e,nS)}}function EO(e,t){return wO(e,nS)}function TO(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return xO(e,t,nS,r,i)}function xT(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e instanceof Uint8Array?AO(e):e instanceof ReadableStream?EO(e):TO(e,t,r,i)}class CO{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(t){this._map=t;let r=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(r._btn.className.indexOf("3d")!=-1){let _={pitch:r._pitch,bearing:r._bearing};r._minpitchzoom&&t.getZoom()>r._minpitchzoom&&(_.zoom=r._minpitchzoom);var i=0,n=38.5,s=6,c=62.33,{longitude:a,latitude:p}=t.getCenter();t.getZoom()<10?t.setTerrain({source:"terrainICGC",exaggeration:1.5}):a>=i&&a<=s&&p>=n&&p<=c?t.setTerrain({source:"terrainICGC",exaggeration:1.2}):t.setTerrain({source:"terrainICGC",exaggeration:1.5}),t.easeTo(_),r._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else t.setTerrain(null),t.easeTo({pitch:0,bearing:0}),r._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function S0(e){"@babel/helpers - typeof";return S0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S0(e)}function PO(e,t){if(S0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(S0(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function IO(e){var t=PO(e,"string");return S0(t)=="symbol"?t:t+""}function q(e,t,r){return t=IO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ki(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const uv=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),ST=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ST&&parseFloat(ST[1]);const LO="3.4.15";function Cu(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const Gb={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},MO=Gb.global||Gb.self||Gb.window||{},dh=typeof process!="object"||String(process)!=="[object process]"||process.browser,uS=typeof importScripts=="function",BO=typeof window<"u"&&typeof window.orientation<"u",AT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);AT&&parseFloat(AT[1]);class kO{constructor(t,r){q(this,"name",void 0),q(this,"workerThread",void 0),q(this,"isRunning",!0),q(this,"result",void 0),q(this,"_resolve",()=>{}),q(this,"_reject",()=>{}),this.name=t,this.workerThread=r,this.result=new Promise((i,n)=>{this._resolve=i,this._reject=n})}postMessage(t,r){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:r})}done(t){Cu(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Cu(this.isRunning),this.isRunning=!1,this._reject(t)}}let Vb=class{terminate(){}};const qb=new Map;function RO(e){Cu(e.source&&!e.url||!e.source&&e.url);let t=qb.get(e.source||e.url);return t||(e.url&&(t=FO(e.url),qb.set(e.url,t)),e.source&&(t=OM(e.source),qb.set(e.source,t))),Cu(t),t}function FO(e){if(!e.startsWith("http"))return e;const t=DO(e);return OM(t)}function OM(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function DO(e){return`try {
  importScripts('`.concat(e,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function zM(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2?arguments[2]:void 0;const i=r||new Set;if(e){if(ET(e))i.add(e);else if(ET(e.buffer))i.add(e.buffer);else if(!ArrayBuffer.isView(e)&&t&&typeof e=="object")for(const n in e)zM(e[n],t,i)}return r===void 0?Array.from(i):[]}function ET(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}const Hb=()=>{};class ix{static isSupported(){return typeof Worker<"u"&&dh||typeof Vb<"u"&&!dh}constructor(t){q(this,"name",void 0),q(this,"source",void 0),q(this,"url",void 0),q(this,"terminated",!1),q(this,"worker",void 0),q(this,"onMessage",void 0),q(this,"onError",void 0),q(this,"_loadableURL","");const{name:r,source:i,url:n}=t;Cu(i||n),this.name=r,this.source=i,this.url=n,this.onMessage=Hb,this.onError=s=>console.log(s),this.worker=dh?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Hb,this.onError=Hb,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,r){r=r||zM(t),this.worker.postMessage(t,r)}_getErrorFromErrorEvent(t){let r="Failed to load ";return r+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(r+="".concat(t.message," in ")),t.lineno&&(r+=":".concat(t.lineno,":").concat(t.colno)),new Error(r)}_createBrowserWorker(){this._loadableURL=RO({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},t.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},t.onmessageerror=r=>console.error(r),t}_createNodeWorker(){let t;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);t=new Vb(r,{eval:!1})}else if(this.source)t=new Vb(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",r=>{this.onMessage(r)}),t.on("error",r=>{this.onError(r)}),t.on("exit",r=>{}),t}}class NO{static isSupported(){return ix.isSupported()}constructor(t){q(this,"name","unnamed"),q(this,"source",void 0),q(this,"url",void 0),q(this,"maxConcurrency",1),q(this,"maxMobileConcurrency",1),q(this,"onDebug",()=>{}),q(this,"reuseWorkers",!0),q(this,"props",{}),q(this,"jobQueue",[]),q(this,"idleQueue",[]),q(this,"count",0),q(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s,c,a)=>s.done(a),i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s,c)=>s.error(c);const n=new Promise(s=>(this.jobQueue.push({name:t,onMessage:r,onError:i,onStart:s}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:t,backlog:this.jobQueue.length});const i=new kO(r.name,t);t.onMessage=n=>r.onMessage(i,n.type,n.payload),t.onError=n=>r.onError(i,n),r.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new ix({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return BO?this.maxMobileConcurrency:this.maxConcurrency}}const OO={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class ih{static isSupported(){return ix.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ih._workerFarm=ih._workerFarm||new ih({}),ih._workerFarm.setProps(t),ih._workerFarm}constructor(t){q(this,"props",void 0),q(this,"workerPools",new Map),this.props={...OO},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:r,source:i,url:n}=t;let s=this.workerPools.get(r);return s||(s=new NO({name:r,source:i,url:n}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}q(ih,"_workerFarm",void 0);const zO="latest";function jO(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t[e.id]||{},i="".concat(e.id,"-worker.js");let n=r.workerUrl;if(!n&&e.id==="compression"&&(n=t.workerUrl),t._workerType==="test"&&(n="modules/".concat(e.module,"/dist/").concat(i)),!n){let s=e.version;s==="latest"&&(s=zO);const c=s?"@".concat(s):"";n="https://unpkg.com/@loaders.gl/".concat(e.module).concat(c,"/dist/").concat(i)}return Cu(n),n}function UO(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:LO;Cu(e,"no worker provided");const r=e.version;return!(!t||!r)}const GO=null,VO=null,nx=null,jM=null,qO=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:GO,readFileAsText:VO,requireFromFile:nx,requireFromString:jM},Symbol.toStringTag,{value:"Module"})),HO="3.4.15",$b={};async function wp(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return t&&(e=$O(e,t,r)),$b[e]=$b[e]||WO(e),await $b[e]}function $O(e,t,r){if(e.startsWith("http"))return e;const i=r.modules||{};return i[e]?i[e]:dh?r.CDN?(Cu(r.CDN.startsWith("http")),"".concat(r.CDN,"/").concat(t,"@").concat(HO,"/dist/libs/").concat(e)):uS?"../src/libs/".concat(e):"modules/".concat(t,"/src/libs/").concat(e):"modules/".concat(t,"/dist/libs/").concat(e)}async function WO(e){if(e.endsWith("wasm"))return await(await fetch(e)).arrayBuffer();if(!dh)try{return qO&&nx&&await nx(e)}catch{return null}if(uS)return importScripts(e);const t=await(await fetch(e)).text();return XO(t,e)}function XO(e,t){if(!dh)return jM;if(uS)return eval.call(MO,e),null;const r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch{r.text=e}return document.body.appendChild(r),null}function ZO(e,t){return!ih.isSupported()||!dh&&!(t!=null&&t._nodeWorkers)?!1:e.worker&&(t==null?void 0:t.worker)}async function YO(e,t,r,i,n){const s=e.id,c=jO(e,r),a=ih.getWorkerFarm(r).getWorkerPool({name:s,url:c});r=JSON.parse(JSON.stringify(r)),i=JSON.parse(JSON.stringify(i||{}));const p=await a.startJob("process-on-worker",JO.bind(null,n));return p.postMessage("process",{input:t,options:r,context:i}),await(await p.result).result}async function JO(e,t,r,i){switch(r){case"done":t.done(i);break;case"error":t.error(new Error(i.error));break;case"process":const{id:n,input:s,options:c}=i;try{const a=await e(s,c);t.postMessage("done",{id:n,result:a})}catch(a){const p=a instanceof Error?a.message:"unknown error";t.postMessage("error",{id:n,error:p})}break;default:console.warn("parse-with-worker unknown message ".concat(r))}}function KO(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?TT(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?TT(e,0,t):""}function TT(e,t,r){if(e.byteLength<=t+r)return"";const i=new DataView(e);let n="";for(let s=0;s<r;s++)n+=String.fromCharCode(i.getUint8(t+s));return n}function QO(e){try{return JSON.parse(e)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(KO(e),'"'))}}function tz(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;const i=new Uint8Array(e),n=new Uint8Array(t);for(let s=0;s<i.length;++s)if(i[s]!==n[s])return!1;return!0}function ez(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const i=t.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),n=i.reduce((a,p)=>a+p.byteLength,0),s=new Uint8Array(n);let c=0;for(const a of i)s.set(a,c),c+=a.byteLength;return s.buffer}function hS(e,t,r){const i=r!==void 0?new Uint8Array(e).subarray(t,t+r):new Uint8Array(e).subarray(t);return new Uint8Array(i).buffer}function V0(e,t){return Ki(e>=0),Ki(t>0),e+(t-1)&~(t-1)}function rz(e,t,r){let i;if(e instanceof ArrayBuffer)i=new Uint8Array(e);else{const n=e.byteOffset,s=e.byteLength;i=new Uint8Array(e.buffer||e.arrayBuffer,n,s)}return t.set(i,r),r+V0(i.byteLength,4)}async function iz(e){const t=[];for await(const r of e)t.push(r);return ez(...t)}function CT(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}class PT{constructor(t,r){q(this,"name",void 0),q(this,"type",void 0),q(this,"sampleSize",1),q(this,"time",void 0),q(this,"count",void 0),q(this,"samples",void 0),q(this,"lastTiming",void 0),q(this,"lastSampleTime",void 0),q(this,"lastSampleCount",void 0),q(this,"_count",0),q(this,"_time",0),q(this,"_samples",0),q(this,"_startTime",0),q(this,"_timerPending",!1),this.name=t,this.type=r,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=CT(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(CT()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class q0{constructor(t){q(this,"id",void 0),q(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const r in this.stats)t(this.stats[r])}getTable(){const t={};return this.forEach(r=>{t[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(t){if(!t||!t.name)return null;const{name:r,type:i}=t;return this.stats[r]||(t instanceof PT?this.stats[r]=t:this.stats[r]=new PT(r,i)),this.stats[r]}}const nz="Queued Requests",sz="Active Requests",oz="Cancelled Requests",az="Queued Requests Ever",lz="Active Requests Ever",cz={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class uz{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};q(this,"props",void 0),q(this,"stats",void 0),q(this,"activeRequestCount",0),q(this,"requestQueue",[]),q(this,"requestMap",new Map),q(this,"deferredUpdate",null),this.props={...cz,...t},this.stats=new q0({id:this.props.id}),this.stats.get(nz),this.stats.get(sz),this.stats.get(oz),this.stats.get(az),this.stats.get(lz)}scheduleRequest(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const i={handle:t,priority:0,getPriority:r},n=new Promise(s=>(i.resolve=s,i));return this.requestQueue.push(i),this.requestMap.set(t,n),this._issueNewRequests(),n}_issueRequest(t){const{handle:r,resolve:i}=t;let n=!1;const s=()=>{n||(n=!0,this.requestMap.delete(r),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let r=0;r<t;++r){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const t=this.requestQueue;for(let r=0;r<t.length;++r){const i=t[r];this._updateRequest(i)||(t.splice(r,1),this.requestMap.delete(i.handle),r--)}t.sort((r,i)=>r.priority-i.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let hz="";const IT={};function dz(e){for(const t in IT)if(e.startsWith(t)){const r=IT[t];e=e.replace(t,r)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e="".concat(hz).concat(e)),e}function pz(e){return e&&typeof e=="object"&&e.isBuffer}function UM(e){if(pz(e)||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function GM(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function dS(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}const fz=e=>typeof e=="boolean",Jg=e=>typeof e=="function",H0=e=>e!==null&&typeof e=="object",LT=e=>H0(e)&&e.constructor==={}.constructor,mz=e=>e&&typeof e[Symbol.iterator]=="function",gz=e=>e&&typeof e[Symbol.asyncIterator]=="function",Np=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Op=e=>typeof Blob<"u"&&e instanceof Blob,yz=e=>e&&typeof e=="object"&&e.isBuffer,_z=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||H0(e)&&Jg(e.tee)&&Jg(e.cancel)&&Jg(e.getReader),vz=e=>H0(e)&&Jg(e.read)&&Jg(e.pipe)&&fz(e.readable),VM=e=>_z(e)||vz(e),bz=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,wz=/^([-\w.]+\/[-\w.+]+)/;function xz(e){const t=wz.exec(e);return t?t[1]:e}function MT(e){const t=bz.exec(e);return t?t[1]:""}const qM=/\?.*/;function Sz(e){const t=e.match(qM);return t&&t[0]}function pS(e){return e.replace(qM,"")}function hv(e){return Np(e)?e.url:Op(e)?e.name||"":typeof e=="string"?e:""}function fS(e){if(Np(e)){const t=e,r=t.headers.get("content-type")||"",i=pS(t.url);return xz(r)||MT(i)}return Op(e)?e.type||"":typeof e=="string"?MT(e):""}function Az(e){return Np(e)?e.headers["content-length"]||-1:Op(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function HM(e){if(Np(e))return e;const t={},r=Az(e);r>=0&&(t["content-length"]=String(r));const i=hv(e),n=fS(e);n&&(t["content-type"]=n);const s=await Cz(e);s&&(t["x-first-bytes"]=s),typeof e=="string"&&(e=new TextEncoder().encode(e));const c=new Response(e,{headers:t});return Object.defineProperty(c,"url",{value:i}),c}async function Ez(e){if(!e.ok){const t=await Tz(e);throw new Error(t)}}async function Tz(e){let t="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): ");try{const r=e.headers.get("Content-Type");let i=e.statusText;r.includes("application/json")&&(i+=" ".concat(await e.text())),t+=i,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch{}return t}async function Cz(e){if(typeof e=="string")return"data:,".concat(e.slice(0,5));if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=n=>{var s;return r(n==null||(s=n.target)===null||s===void 0?void 0:s.result)},i.readAsDataURL(t)})}if(e instanceof ArrayBuffer){const t=e.slice(0,5),r=Pz(t);return"data:base64,".concat(r)}return null}function Pz(e){let t="";const r=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)t+=String.fromCharCode(r[i]);return btoa(t)}async function BT(e,t){if(typeof e=="string"){e=dz(e);let r=t;return t!=null&&t.fetch&&typeof(t==null?void 0:t.fetch)!="function"&&(r=t.fetch),await fetch(e,r)}return await HM(e)}function $M(e){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Sh(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||$M()}const My={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Wb=My.window||My.self||My.global,V1=My.process||{},WM=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Sh();const Xb=globalThis;function XM(e){if(!Sh())return"Node";if($M())return"Electron";const t=(typeof navigator<"u"?navigator:{}).userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";const r=t.indexOf("MSIE ")!==-1,i=t.indexOf("Trident/")!==-1;return r||i?"IE":Xb.chrome?"Chrome":Xb.safari?"Safari":Xb.mozInnerScreenX?"Firefox":"Unknown"}function Iz(e){try{const t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch{return null}}class Lz{constructor(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";q(this,"storage",void 0),q(this,"id",void 0),q(this,"config",void 0),this.storage=Iz(i),this.id=t,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let t={};if(this.storage){const r=this.storage.getItem(this.id);t=r?JSON.parse(r):{}}return Object.assign(this.config,t),this}}function Mz(e){let t;return e<10?t="".concat(e.toFixed(2),"ms"):e<100?t="".concat(e.toFixed(1),"ms"):e<1e3?t="".concat(e.toFixed(0),"ms"):t="".concat((e/1e3).toFixed(2),"s"),t}function Bz(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const r=Math.max(t-e.length,0);return"".concat(" ".repeat(r)).concat(e)}function Zb(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const n=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>i&&(r=Math.min(r,i/e.width));const s=e.width*r,c=e.height*r,a=["font-size:1px;","padding:".concat(Math.floor(c/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(c,"px;"),"background:url(".concat(n,");"),"background-size:".concat(s,"px ").concat(c,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}let E_;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(E_||(E_={}));function kT(e){return typeof e=="string"?E_[e.toUpperCase()]||E_.WHITE:e}function kz(e,t,r){return!Sh&&typeof e=="string"&&(t&&(t=kT(t),e="\x1B[".concat(t,"m").concat(e,"\x1B[39m")),r&&(t=kT(r),e="\x1B[".concat(r+10,"m").concat(e,"\x1B[49m"))),e}function Rz(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const r=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(r);for(const n of i)typeof e[n]=="function"&&(t.find(s=>n===s)||(e[n]=e[n].bind(e)))}function T_(e,t){if(!e)throw new Error(t||"Assertion failed")}function hf(){let e;if(Sh&&"performance"in Wb){var t,r;e=Wb==null||(t=Wb.performance)===null||t===void 0||(r=t.now)===null||r===void 0?void 0:r.call(t)}else if("hrtime"in V1){var i;const n=V1==null||(i=V1.hrtime)===null||i===void 0?void 0:i.call(V1);e=n[0]*1e3+n[1]/1e6}else e=Date.now();return e}const df={debug:Sh&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Fz={enabled:!0,level:0};function kl(){}const RT={},FT={once:!0};class $0{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};q(this,"id",void 0),q(this,"VERSION",WM),q(this,"_startTs",hf()),q(this,"_deltaTs",hf()),q(this,"_storage",void 0),q(this,"userData",{}),q(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new Lz("__probe-".concat(this.id,"__"),Fz),this.timeStamp("".concat(this.id," started")),Rz(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((hf()-this._startTs).toPrecision(10))}getDelta(){return Number((hf()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,r){this._storage.setConfiguration({[t]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,r){T_(t,r)}warn(t){return this._getLogFunction(0,t,df.warn,arguments,FT)}error(t){return this._getLogFunction(0,t,df.error,arguments)}deprecated(t,r){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(r,"` instead"))}removed(t,r){return this.error("`".concat(t,"` has been removed. Use `").concat(r,"` instead"))}probe(t,r){return this._getLogFunction(t,r,df.log,arguments,{time:!0,once:!0})}log(t,r){return this._getLogFunction(t,r,df.debug,arguments)}info(t,r){return this._getLogFunction(t,r,console.info,arguments)}once(t,r){for(var i=arguments.length,n=new Array(i>2?i-2:0),s=2;s<i;s++)n[s-2]=arguments[s];return this._getLogFunction(t,r,df.debug||df.info,arguments,FT)}table(t,r,i){return r?this._getLogFunction(t,r,console.table||kl,i&&[i],{tag:zz(r)}):kl}image(t){let{logLevel:r,priority:i,image:n,message:s="",scale:c=1}=t;return this._shouldLog(r||i)?Sh?Oz({image:n,message:s,scale:c}):Nz():kl}time(t,r){return this._getLogFunction(t,r,console.time?console.time:console.info)}timeEnd(t,r){return this._getLogFunction(t,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,r){return this._getLogFunction(t,r,console.timeStamp||kl)}group(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const n=DT({logLevel:t,message:r,opts:i}),{collapsed:s}=i;return n.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,r,Object.assign({},i,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||kl)}withGroup(t,r,i){this.group(t,r)();try{i()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=ZM(t)}_getLogFunction(t,r,i,n,s){if(this._shouldLog(t)){s=DT({logLevel:t,message:r,args:n,opts:s}),i=i||s.method,T_(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=hf();const c=s.tag||s.message;if(s.once)if(!RT[c])RT[c]=hf();else return kl;return r=Dz(this.id,s.message,s),i.bind(console,r,...s.args)}return kl}}q($0,"VERSION",WM);function ZM(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return T_(Number.isFinite(t)&&t>=0),t}function DT(e){const{logLevel:t,message:r}=e;e.logLevel=ZM(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==r;);switch(typeof t){case"string":case"function":r!==void 0&&i.unshift(r),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const n=typeof e.message;return T_(n==="string"||n==="object"),Object.assign(e,{args:i},e.opts)}function Dz(e,t,r){if(typeof t=="string"){const i=r.time?Bz(Mz(r.total)):"";t=r.time?"".concat(e,": ").concat(i,"  ").concat(t):"".concat(e,": ").concat(t),t=kz(t,r.color,r.background)}return t}function Nz(e){return console.warn("removed"),kl}function Oz(e){let{image:t,message:r="",scale:i=1}=e;if(typeof t=="string"){const s=new Image;return s.onload=()=>{const c=Zb(s,r,i);console.log(...c)},s.src=t,kl}const n=t.nodeName||"";if(n.toLowerCase()==="img")return console.log(...Zb(t,r,i)),kl;if(n.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Zb(s,r,i)),s.src=t.toDataURL(),kl}return kl}function zz(e){for(const t in e)for(const r in e[t])return r||"untitled";return"empty"}const NT=new $0({id:"loaders.gl"});class jz{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Uz{constructor(){q(this,"console",void 0),this.console=console}log(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return this.console.log.bind(this.console,...r)}info(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return this.console.info.bind(this.console,...r)}warn(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return this.console.warn.bind(this.console,...r)}error(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return this.console.error.bind(this.console,...r)}}const YM={fetch:null,mimeType:void 0,nothrow:!1,log:new Uz,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:uv,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Gz={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function JM(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}const KM=()=>{const e=JM();return e.globalOptions=e.globalOptions||{...YM},e.globalOptions};function Vz(e,t,r,i){return r=r||[],r=Array.isArray(r)?r:[r],qz(e,r),$z(t,e,i)}function qz(e,t){OT(e,null,YM,Gz,t);for(const r of t){const i=e&&e[r.id]||{},n=r.options&&r.options[r.id]||{},s=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};OT(i,r.id,n,s,t)}}function OT(e,t,r,i,n){const s=t||"Top level",c=t?"".concat(t,"."):"";for(const a in e){const p=!t&&H0(e[a]),_=a==="baseUri"&&!t,w=a==="workerUrl"&&t;if(!(a in r)&&!_&&!w){if(a in i)NT.warn("".concat(s," loader option '").concat(c).concat(a,"' no longer supported, use '").concat(i[a],"'"))();else if(!p){const S=Hz(a,n);NT.warn("".concat(s," loader option '").concat(c).concat(a,"' not recognized. ").concat(S))()}}}}function Hz(e,t){const r=e.toLowerCase();let i="";for(const n of t)for(const s in n.options){if(e===s)return"Did you mean '".concat(n.id,".").concat(s,"'?");const c=s.toLowerCase();(r.startsWith(c)||c.startsWith(r))&&(i=i||"Did you mean '".concat(n.id,".").concat(s,"'?"))}return i}function $z(e,t,r){const i={...e.options||{}};return Wz(i,r),i.log===null&&(i.log=new jz),zT(i,KM()),zT(i,t),i}function zT(e,t){for(const r in t)if(r in t){const i=t[r];LT(i)&&LT(e[r])?e[r]={...e[r],...t[r]}:e[r]=t[r]}}function Wz(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function mS(e){var t;return e?(Array.isArray(e)&&(e=e[0]),Array.isArray((t=e)===null||t===void 0?void 0:t.extensions)):!1}function gS(e){var t,r;Ki(e,"null loader"),Ki(mS(e),"invalid loader");let i;return Array.isArray(e)&&(i=e[1],e=e[0],e={...e,options:{...e.options,...i}}),((t=e)!==null&&t!==void 0&&t.parseTextSync||(r=e)!==null&&r!==void 0&&r.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const QM=()=>{const e=JM();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function Xz(e){const t=QM();e=Array.isArray(e)?e:[e];for(const r of e){const i=gS(r);t.find(n=>i===n)||t.unshift(i)}}function Zz(){return QM()}const Yz=new $0({id:"loaders.gl"}),Jz=/\.([^.]+)$/;async function Kz(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!t6(e))return null;let n=jT(e,t,{...r,nothrow:!0},i);if(n)return n;if(Op(e)&&(e=await e.slice(0,10).arrayBuffer(),n=jT(e,t,r,i)),!n&&!(r!=null&&r.nothrow))throw new Error(e6(e));return n}function jT(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!t6(e))return null;if(t&&!Array.isArray(t))return gS(t);let n=[];t&&(n=n.concat(t)),r!=null&&r.ignoreRegisteredLoaders||n.push(...Zz()),t7(n);const s=Qz(e,n,r,i);if(!s&&!(r!=null&&r.nothrow))throw new Error(e6(e));return s}function Qz(e,t,r,i){const n=hv(e),s=fS(e),c=pS(n)||(i==null?void 0:i.url);let a=null,p="";if(r!=null&&r.mimeType&&(a=Yb(t,r==null?void 0:r.mimeType),p="match forced by supplied MIME type ".concat(r==null?void 0:r.mimeType)),a=a||e7(t,c),p=p||(a?"matched url ".concat(c):""),a=a||Yb(t,s),p=p||(a?"matched MIME type ".concat(s):""),a=a||i7(t,e),p=p||(a?"matched initial data ".concat(r6(e)):""),a=a||Yb(t,r==null?void 0:r.fallbackMimeType),p=p||(a?"matched fallback MIME type ".concat(s):""),p){var _;Yz.log(1,"selectLoader selected ".concat((_=a)===null||_===void 0?void 0:_.name,": ").concat(p,"."))}return a}function t6(e){return!(e instanceof Response&&e.status===204)}function e6(e){const t=hv(e),r=fS(e);let i="No valid loader found (";i+=t?"".concat(GM(t),", "):"no url provided, ",i+="MIME type: ".concat(r?'"'.concat(r,'"'):"not provided",", ");const n=e?r6(e):"";return i+=n?' first bytes: "'.concat(n,'"'):"first bytes: not available",i+=")",i}function t7(e){for(const t of e)gS(t)}function e7(e,t){const r=t&&Jz.exec(t),i=r&&r[1];return i?r7(e,i):null}function r7(e,t){t=t.toLowerCase();for(const r of e)for(const i of r.extensions)if(i.toLowerCase()===t)return r;return null}function Yb(e,t){for(const r of e)if(r.mimeTypes&&r.mimeTypes.includes(t)||t==="application/x.".concat(r.id))return r;return null}function i7(e,t){if(!t)return null;for(const r of e)if(typeof t=="string"){if(n7(t,r))return r}else if(ArrayBuffer.isView(t)){if(UT(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&UT(t,0,r))return r;return null}function n7(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(r=>e.startsWith(r))}function UT(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(i=>s7(e,t,r,i))}function s7(e,t,r,i){if(i instanceof ArrayBuffer)return tz(i,e,i.byteLength);switch(typeof i){case"function":return i(e,r);case"string":const n=sx(e,t,i.length);return i===n;default:return!1}}function r6(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?sx(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?sx(e,0,t):""}function sx(e,t,r){if(e.byteLength<t+r)return"";const i=new DataView(e);let n="";for(let s=0;s<r;s++)n+=String.fromCharCode(i.getUint8(t+s));return n}const o7=256*1024;function*a7(e,t){const r=(t==null?void 0:t.chunkSize)||o7;let i=0;const n=new TextEncoder;for(;i<e.length;){const s=Math.min(e.length-i,r),c=e.slice(i,i+s);i+=s,yield n.encode(c)}}const l7=256*1024;function c7(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:r=l7}=t;let i=0;for(;i<e.byteLength;){const n=Math.min(e.byteLength-i,r),s=new ArrayBuffer(n),c=new Uint8Array(e,i,n);new Uint8Array(s).set(c),i+=n,yield s}}()}const u7=1024*1024;async function*h7(e,t){const r=(t==null?void 0:t.chunkSize)||u7;let i=0;for(;i<e.size;){const n=i+r,s=await e.slice(i,n).arrayBuffer();i=n,yield s}}function GT(e,t){return uv?d7(e,t):p7(e)}async function*d7(e,t){const r=e.getReader();let i;try{for(;;){const n=i||r.read();t!=null&&t._streamReadAhead&&(i=r.read());const{done:s,value:c}=await n;if(s)return;yield UM(c)}}catch{r.releaseLock()}}async function*p7(e,t){for await(const r of e)yield UM(r)}function f7(e,t){if(typeof e=="string")return a7(e,t);if(e instanceof ArrayBuffer)return c7(e,t);if(Op(e))return h7(e,t);if(VM(e))return GT(e,t);if(Np(e))return GT(e.body,t);throw new Error("makeIterator")}const i6="Cannot convert supplied data type";function m7(e,t,r){if(t.text&&typeof e=="string")return e;if(yz(e)&&(e=e.buffer),e instanceof ArrayBuffer){const i=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let i=e.buffer;const n=e.byteLength||e.length;return(e.byteOffset!==0||n!==i.byteLength)&&(i=i.slice(e.byteOffset,e.byteOffset+n)),i}throw new Error(i6)}async function g7(e,t,r){const i=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||i)return m7(e,t);if(Op(e)&&(e=await HM(e)),Np(e)){const n=e;return await Ez(n),t.binary?await n.arrayBuffer():await n.text()}if(VM(e)&&(e=f7(e,r)),mz(e)||gz(e))return iz(e);throw new Error(i6)}function n6(e,t){const r=KM(),i=e||r;return typeof i.fetch=="function"?i.fetch:H0(i.fetch)?n=>BT(n,i):t!=null&&t.fetch?t==null?void 0:t.fetch:BT}function y7(e,t,r){if(r)return r;const i={fetch:n6(t,e),...e};if(i.url){const n=pS(i.url);i.baseUrl=n,i.queryString=Sz(i.url),i.filename=GM(n),i.baseUrl=dS(n)}return Array.isArray(i.loaders)||(i.loaders=null),i}function _7(e,t){if(!t&&e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){const i=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...i]:i}return r&&r.length?r:null}async function yS(e,t,r,i){Cu(!i||typeof i=="object"),t&&!Array.isArray(t)&&!mS(t)&&(i=void 0,r=t,t=void 0),e=await e,r=r||{};const n=hv(e),s=_7(t,i),c=await Kz(e,s,r);return c?(r=Vz(r,c,s,n),i=y7({url:n,parse:yS,loaders:s},r,i||null),await v7(c,e,r,i)):null}async function v7(e,t,r,i){if(UO(e),Np(t)){const n=t,{ok:s,redirected:c,status:a,statusText:p,type:_,url:w}=n,S=Object.fromEntries(n.headers.entries());i.response={headers:S,ok:s,redirected:c,status:a,statusText:p,type:_,url:w}}if(t=await g7(t,e,r),e.parseTextSync&&typeof t=="string")return r.dataType="text",e.parseTextSync(t,r,i,e);if(ZO(e,r))return await YO(e,t,r,i,yS);if(e.parseText&&typeof t=="string")return await e.parseText(t,r,i,e);if(e.parse)return await e.parse(t,r,i,e);throw Cu(!e.parseSync),new Error("".concat(e.id," loader - no parser found and worker is disabled"))}async function Sd(e,t,r,i){!Array.isArray(t)&&!mS(t)&&(r=t,t=void 0);const n=n6(r);let s=e;return typeof e=="string"&&(s=await n(e)),Op(e)&&(s=await n(e)),await yS(s,t,r)}const b7="3.4.15",{_parseImageNode:w7}=globalThis,ox=typeof Image<"u",ax=typeof ImageBitmap<"u",x7=!!w7,lx=uv?!0:x7;function S7(e){switch(e){case"auto":return ax||ox||lx;case"imagebitmap":return ax;case"image":return ox;case"data":return lx;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}}function A7(){if(ax)return"imagebitmap";if(ox)return"image";if(lx)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function E7(e){const t=C7(e);if(!t)throw new Error("Not an image");return t}function T7(e){switch(E7(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function C7(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}const P7=/^data:image\/svg\+xml/,I7=/\.svg((\?|#).*)?$/;function _S(e){return e&&(P7.test(e)||I7.test(e))}function L7(e,t){if(_S(t)){let r=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(i){throw new Error(i.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return s6(e,t)}function s6(e,t){if(_S(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function o6(e,t,r){const i=L7(e,r),n=self.URL||self.webkitURL,s=typeof i!="string"&&n.createObjectURL(i);try{return await M7(s||i,t)}finally{s&&n.revokeObjectURL(s)}}async function M7(e,t){const r=new Image;return r.src=e,t.image&&t.image.decode&&r.decode?(await r.decode(),r):await new Promise((i,n)=>{try{r.onload=()=>i(r),r.onerror=s=>n(new Error("Could not load image ".concat(e,": ").concat(s)))}catch(s){n(s)}})}const B7={};let VT=!0;async function k7(e,t,r){let i;_S(r)?i=await o6(e,t,r):i=s6(e,r);const n=t&&t.imagebitmap;return await R7(i,n)}async function R7(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((F7(t)||!VT)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(r){console.warn(r),VT=!1}return await createImageBitmap(e)}function F7(e){for(const t in e||B7)return!1;return!0}function D7(e){return!j7(e,"ftyp",4)||!(e[8]&96)?null:N7(e)}function N7(e){switch(O7(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function O7(e,t,r){return String.fromCharCode(...e.slice(t,r))}function z7(e){return[...e].map(t=>t.charCodeAt(0))}function j7(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=z7(t);for(let n=0;n<i.length;++n)if(i[n]!==e[n+r])return!1;return!0}const _u=!1,Kg=!0;function vS(e){const t=W0(e);return G7(t)||H7(t)||V7(t)||q7(t)||U7(t)}function U7(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),r=D7(t);return r?{mimeType:r.mimeType,width:0,height:0}:null}function G7(e){const t=W0(e);return t.byteLength>=24&&t.getUint32(0,_u)===2303741511?{mimeType:"image/png",width:t.getUint32(16,_u),height:t.getUint32(20,_u)}:null}function V7(e){const t=W0(e);return t.byteLength>=10&&t.getUint32(0,_u)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,Kg),height:t.getUint16(8,Kg)}:null}function q7(e){const t=W0(e);return t.byteLength>=14&&t.getUint16(0,_u)===16973&&t.getUint32(2,Kg)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Kg),height:t.getUint32(22,Kg)}:null}function H7(e){const t=W0(e);if(!(t.byteLength>=3&&t.getUint16(0,_u)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=$7();let n=2;for(;n+9<t.byteLength;){const s=t.getUint16(n,_u);if(i.has(s))return{mimeType:"image/jpeg",height:t.getUint16(n+5,_u),width:t.getUint16(n+7,_u)};if(!r.has(s))return null;n+=2,n+=t.getUint16(n,_u)}return null}function $7(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function W0(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function W7(e,t){const{mimeType:r}=vS(e)||{},i=globalThis._parseImageNode;return Ki(i),await i(e,r)}async function X7(e,t,r){t=t||{};const i=(t.image||{}).type||"auto",{url:n}=r||{},s=Z7(i);let c;switch(s){case"imagebitmap":c=await k7(e,t,n);break;case"image":c=await o6(e,t,n);break;case"data":c=await W7(e);break;default:Ki(!1)}return i==="data"&&(c=T7(c)),c}function Z7(e){switch(e){case"auto":case"data":return A7();default:return S7(e),e}}const Y7=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],J7=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],K7={image:{type:"auto",decode:!0}},a6={id:"image",module:"images",name:"Images",version:b7,mimeTypes:J7,extensions:Y7,parse:X7,tests:[e=>!!vS(new DataView(e))],options:K7},Jb={};function Q7(e){if(Jb[e]===void 0){const t=uv?e9(e):t9(e);Jb[e]=t}return Jb[e]}function t9(e){const t=["image/png","image/jpeg","image/gif"],{_parseImageNode:r,_imageFormatsNode:i=t}=globalThis;return!!r&&i.includes(e)}function e9(e){switch(e){case"image/avif":case"image/webp":return r9(e);default:return!0}}function r9(e){try{return document.createElement("canvas").toDataURL(e).indexOf("data:".concat(e))===0}catch{return!1}}const pi=new $0({id:"deck"}),qh={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},Kb=1,yg=2,Qb=3,t2=4,i9=2,n9=e=>({"layer.changeFlag":(t,r,i)=>{e.log(Qb,"".concat(t.id," ").concat(r,": "),i[r])()},"layer.initialize":t=>{e.log(Kb,"Initializing ".concat(t))()},"layer.update":(t,r)=>{if(r){const i=t.getChangeFlags();e.log(yg,"Updating ".concat(t," because: ").concat(Object.keys(i).filter(n=>i[n]).join(", ")))()}else e.log(t2,"".concat(t," does not need update"))()},"layer.matched":(t,r)=>{r&&e.log(t2,"Matched ".concat(t,", state transfered"))()},"layer.finalize":t=>{e.log(Kb,"Finalizing ".concat(t))()},"compositeLayer.renderLayers":(t,r,i)=>{r?e.log(yg,"Composite layer rendered new subLayers ".concat(t),i)():e.log(t2,"Composite layer reused subLayers ".concat(t),i)()},"layerManager.setLayers":(t,r,i)=>{r&&e.log(yg,"Updating ".concat(i.length," deck layers"))()},"layerManager.activateViewport":(t,r)=>{e.log(Qb,"Viewport changed",r)()},"attributeManager.invalidate":(t,r,i)=>{e.log(Kb,i?"invalidated attributes ".concat(i," (").concat(r,") for ").concat(t.id):"invalidated all attributes for ".concat(t.id))()},"attributeManager.updateStart":t=>{qh.attributeUpdateMessages.length=0,qh.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(t,r)=>{const i=Math.round(Date.now()-qh.attributeManagerUpdateStart);e.groupCollapsed(yg,"Updated attributes for ".concat(r," instances in ").concat(t.id," in ").concat(i,"ms"))();for(const n of qh.attributeUpdateMessages)e.log(Qb,n)();e.groupEnd(yg)()},"attribute.updateStart":t=>{qh.attributeUpdateStart=Date.now()},"attribute.allocate":(t,r)=>{const i="".concat(t.id," allocated ").concat(r);qh.attributeUpdateMessages.push(i)},"attribute.updateEnd":(t,r)=>{const i=Math.round(Date.now()-qh.attributeUpdateStart),n="".concat(t.id," updated ").concat(r," in ").concat(i,"ms");qh.attributeUpdateMessages.push(n)},"deckRenderer.renderLayers":(t,r,i)=>{const{pass:n,redrawReason:s,stats:c}=i;for(const a of r){const{totalCount:p,visibleCount:_,compositeCount:w,pickableCount:S}=a,C=p-w-_;e.log(i9,"RENDER #".concat(t.renderCount,"   ").concat(_," (of ").concat(p," layers) to ").concat(n," because ").concat(s,"   (").concat(C," hidden, ").concat(w," composite ").concat(S," pickable)"))(),c&&c.get("Redraw Layers").add(_)}}});var s9={};let C_={};s9.NODE_ENV!=="production"&&(C_=n9(pi));function o9(e){C_=e}function Eo(e,t,r,i){pi.level>0&&C_[e]&&C_[e].call(null,t,r,i)}function a9(e){const t=e[0],r=e[e.length-1];return t==="{"&&r==="}"||t==="["&&r==="]"}const l9={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:a9,parseTextSync:JSON.parse};function c9(){const e="8.9.36",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error("deck.gl - multiple versions detected: ".concat(t," vs ").concat(e));return t||(pi.log(1,"deck.gl ".concat(e))(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:pi,_registerLoggers:o9},Xz([l9,[a6,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}const u9=c9(),hi={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(hi,"IDENTITY",{get:()=>(pi.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const bu={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},cx={common:0,meters:1,pixels:2},qT={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},cr=new $0({id:"luma.gl"});function Yo(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}const h9="Invalid WebGLRenderingContext",d9="Requires WebGL2";function dv(e){return typeof WebGLRenderingContext<"u"&&e instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&Number.isFinite(e._version))}function ri(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}function p9(e){return ri(e)?e:null}function pv(e){return Yo(dv(e),h9),e}function Jo(e){return Yo(ri(e),d9),e}const Ng={};function f9(e){globalThis.console&&globalThis.console.error&&globalThis.console.error(e)}function m9(e){globalThis.console&&globalThis.console.log&&globalThis.console.log(e)}function g9(e,t){Ng[e]=!0,f9(t)}function y9(e){const t=e.getError;e.getError=function(){let r;do r=t.apply(e),r!==0&&(Ng[r]=!0);while(r!==0);for(r in Ng)if(Ng[r])return delete Ng[r],parseInt(r,10);return 0}}const X0=function e(t){const r=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const n=new e.VertexAttrib(r);this.attribs[i]=n}this.maxAttrib=0};X0.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};X0.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const zp=function(e){const t=this;this.gl=e,y9(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(i){return i===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(i){const n=t.currentVertexArrayObject;n.maxAttrib=Math.max(n.maxAttrib,i);const s=n.attribs[i];return s.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(i){const n=t.currentVertexArrayObject;n.maxAttrib=Math.max(n.maxAttrib,i);const s=n.attribs[i];return s.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(i,n){switch(i){case 34962:t.currentArrayBuffer=n;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=n;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(i,n){const s=t.currentVertexArrayObject.attribs[i];switch(n){case 34975:return s.buffer;case 34338:return s.enabled;case 34339:return s.size;case 34340:return s.stride;case 34341:return s.type;case 34922:return s.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(i,n,s,c,a,p){const _=t.currentVertexArrayObject;_.maxAttrib=Math.max(_.maxAttrib,i);const w=_.attribs[i];return w.buffer=t.currentArrayBuffer,w.size=n,w.type=s,w.normalized=c,w.stride=a,w.offset=p,w.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{m9("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};zp.prototype.VERTEX_ARRAY_BINDING_OES=34229;zp.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;const e=this.gl;this.maxVertexAttribs=e.getParameter(34921),this.defaultVertexArrayObject=new X0(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};zp.prototype.createVertexArrayOES=function(){const e=new X0(this);return this.vertexArrayObjects.push(e),e};zp.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};zp.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof X0&&e.hasBeenBound&&e.ext===this)};zp.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive){g9(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const n=this.currentVertexArrayObject;if(i===n)return;(!i||n.elementArrayBuffer!==i.elementArrayBuffer)&&r.bindBuffer.call(t,34963,n.elementArrayBuffer);let s=this.currentArrayBuffer;const c=Math.max(i?i.maxAttrib:0,n.maxAttrib);for(let a=0;a<=c;a++){const p=n.attribs[a],_=i?i.attribs[a]:null;if((!i||p.enabled!==_.enabled)&&(p.enabled?r.enableVertexAttribArray.call(t,a):r.disableVertexAttribArray.call(t,a)),p.enabled){let w=!1;(!i||p.buffer!==_.buffer)&&(s!==p.buffer&&(r.bindBuffer.call(t,34962,p.buffer),s=p.buffer),w=!0),(w||p.cached!==_.cached)&&r.vertexAttribPointer.call(t,a,p.size,p.type,p.normalized,p.stride,p.offset)}}this.currentArrayBuffer!==s&&r.bindBuffer.call(t,34962,this.currentArrayBuffer)};function _9(e){if(typeof e.createVertexArray=="function")return;const t=e.getSupportedExtensions;e.getSupportedExtensions=function(){const i=t.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};const r=e.getExtension;e.getExtension=function(i){return r.call(this,i)||(i!=="OES_vertex_array_object"?null:(e.__OESVertexArrayObject||(this.__OESVertexArrayObject=new zp(this)),this.__OESVertexArrayObject))}}const HT="OES_element_index",$T="WEBGL_draw_buffers",v9="EXT_disjoint_timer_query",b9="EXT_disjoint_timer_query_webgl2",w9="EXT_texture_filter_anisotropic",WT="WEBGL_debug_renderer_info",x9=35723,S9=4352,A9=36795,E9=34047,T9=37445,C9=37446,rn=e=>ri(e)?void 0:0,P9={3074:e=>ri(e)?void 0:36064,[x9]:e=>ri(e)?void 0:S9,35977:rn,32937:rn,[A9]:(e,t)=>{const r=ri(e)?e.getExtension(b9):e.getExtension(v9);return r&&r.GPU_DISJOINT_EXT?t(r.GPU_DISJOINT_EXT):0},[T9]:(e,t)=>{const r=e.getExtension(WT);return t(r&&r.UNMASKED_VENDOR_WEBGL||7936)},[C9]:(e,t)=>{const r=e.getExtension(WT);return t(r&&r.UNMASKED_RENDERER_WEBGL||7937)},[E9]:(e,t)=>{const r=e.luma.extensions[w9];return r?t(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:rn,35071:rn,37447:rn,36063:(e,t)=>{if(!ri(e)){const r=e.getExtension($T);return r?t(r.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:rn,35374:rn,35377:rn,34852:e=>{if(!ri(e)){const t=e.getExtension($T);return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},36203:e=>e.getExtension(HT)?2147483647:65535,33001:e=>e.getExtension(HT)?16777216:65535,33e3:e=>16777216,37157:rn,35373:rn,35657:rn,36183:rn,37137:rn,34045:rn,35978:rn,35979:rn,35968:rn,35376:rn,35375:rn,35659:rn,37154:rn,35371:rn,35658:rn,35076:rn,35077:rn,35380:rn};function I9(e,t,r){const i=P9[r],n=typeof i=="function"?i(e,t,r):i;return n!==void 0?n:t(r)}const L9="OES_vertex_array_object",l6="ANGLE_instanced_arrays",M9="WEBGL_draw_buffers",B9="EXT_disjoint_timer_query",k9="EXT_texture_filter_anisotropic",R9="VertexArray requires WebGL2 or OES_vertex_array_object extension";function F9(e,t){return{webgl2:ri(e),ext:e.getExtension(t)}}const c6={[L9]:{meta:{suffix:"OES"},createVertexArray:()=>{Yo(!1,R9)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[l6]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(e,t){Yo(t===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[M9]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Yo(!1)}},[B9]:{meta:{suffix:"EXT"},createQuery:()=>{Yo(!1)},deleteQuery:()=>{Yo(!1)},beginQuery:()=>{Yo(!1)},endQuery:()=>{},getQuery(e,t){return this.getQueryObject(e,t)},getQueryParameter(e,t){return this.getQueryObject(e,t)},getQueryObject:()=>{}}},e2={readBuffer:(e,t,r)=>{ri(e)&&t(r)},getVertexAttrib:(e,t,r,i)=>{const{webgl2:n,ext:s}=F9(e,l6);let c;switch(i){case 35069:c=n?void 0:!1;break;case 35070:c=!n&&!s?0:void 0;break}return c!==void 0?c:t(r,i)},getProgramParameter:(e,t,r,i)=>{if(!ri(e))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return t(r,i)},getInternalformatParameter:(e,t,r,i,n)=>{if(!ri(e))switch(n){case 32937:return new Int32Array([0])}return e.getInternalformatParameter(r,i,n)},getTexParameter(e,t,r,i){switch(i){case 34046:const{extensions:n}=e.luma,s=n[k9];i=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return t(r,i)},getParameter:I9,hint(e,t,r,i){return t(r,i)}};function D9(e){e.luma=e.luma||{};const{luma:t}=e;return t.polyfilled||(_9(e),N9(e),z9(e,c6),O9(e,{target:t,target2:e}),t.polyfilled=!0),e}globalThis.polyfillContext=D9;function N9(e){e.luma.extensions={};const t=e.getSupportedExtensions()||[];for(const r of t)e.luma[r]=e.getExtension(r)}function O9(e,t){let{target:r,target2:i}=t;Object.keys(e2).forEach(n=>{if(typeof e2[n]=="function"){const s=e[n]?e[n].bind(e):()=>{},c=e2[n].bind(null,e,s);r[n]=c,i[n]=c}})}function z9(e,t){for(const r of Object.getOwnPropertyNames(t))r!=="overrides"&&j9(e,{extension:r,target:e.luma,target2:e})}function j9(e,t){let{extension:r,target:i,target2:n}=t;const s=c6[r];Yo(s);const{meta:c={}}=s,{suffix:a=""}=c,p=e.getExtension(r);for(const _ of Object.keys(s)){const w="".concat(_).concat(a);let S=null;_==="meta"||typeof e[_]=="function"||(p&&typeof p[w]=="function"?S=function(){return p[w](...arguments)}:typeof s[_]=="function"&&(S=s[_].bind(i))),S&&(i[_]=S,n[_]=S)}}const bS={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Hh=(e,t,r)=>t?e.enable(r):e.disable(r),XT=(e,t,r)=>e.hint(r,t),Xa=(e,t,r)=>e.pixelStorei(r,t),U9=(e,t)=>{const r=ri(e)?36009:36160;return e.bindFramebuffer(r,t)},G9=(e,t)=>e.bindFramebuffer(36008,t);function _g(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const V9={3042:Hh,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:Hh,2885:(e,t)=>e.cullFace(t),2929:Hh,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:Hh,35723:XT,36006:U9,2886:(e,t)=>e.frontFace(t),33170:XT,2849:(e,t)=>e.lineWidth(t),32823:Hh,32824:"polygonOffset",10752:"polygonOffset",35977:Hh,32938:"sampleCoverage",32939:"sampleCoverage",3089:Hh,3088:(e,t)=>e.scissor(...t),2960:Hh,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),3333:Xa,3317:Xa,37440:Xa,37441:Xa,37443:Xa,3330:Xa,3332:Xa,3331:Xa,36010:G9,3314:Xa,32878:Xa,3316:Xa,3315:Xa,32877:Xa,framebuffer:(e,t)=>{const r=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,r)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{t=_g(t)?t:[t,t],e.blendEquationSeparate(...t)},blendFunc:(e,t)=>{t=_g(t)&&t.length===2?[...t,...t]:t,e.blendFuncSeparate(...t)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=_g(t)?t:[t,t];const[r,i]=t;e.stencilMaskSeparate(1028,r),e.stencilMaskSeparate(1029,i)},stencilFunc:(e,t)=>{t=_g(t)&&t.length===3?[...t,...t]:t;const[r,i,n,s,c,a]=t;e.stencilFuncSeparate(1028,r,i,n),e.stencilFuncSeparate(1029,s,c,a)},stencilOp:(e,t)=>{t=_g(t)&&t.length===3?[...t,...t]:t;const[r,i,n,s,c,a]=t;e.stencilOpSeparate(1028,r,i,n),e.stencilOpSeparate(1029,s,c,a)},viewport:(e,t)=>e.viewport(...t)};function Fn(e,t,r){return t[e]!==void 0?t[e]:r[e]}const q9={blendEquation:(e,t,r)=>e.blendEquationSeparate(Fn(32777,t,r),Fn(34877,t,r)),blendFunc:(e,t,r)=>e.blendFuncSeparate(Fn(32969,t,r),Fn(32968,t,r),Fn(32971,t,r),Fn(32970,t,r)),polygonOffset:(e,t,r)=>e.polygonOffset(Fn(32824,t,r),Fn(10752,t,r)),sampleCoverage:(e,t,r)=>e.sampleCoverage(Fn(32938,t,r),Fn(32939,t,r)),stencilFuncFront:(e,t,r)=>e.stencilFuncSeparate(1028,Fn(2962,t,r),Fn(2967,t,r),Fn(2963,t,r)),stencilFuncBack:(e,t,r)=>e.stencilFuncSeparate(1029,Fn(34816,t,r),Fn(36003,t,r),Fn(36004,t,r)),stencilOpFront:(e,t,r)=>e.stencilOpSeparate(1028,Fn(2964,t,r),Fn(2965,t,r),Fn(2966,t,r)),stencilOpBack:(e,t,r)=>e.stencilOpSeparate(1029,Fn(34817,t,r),Fn(34818,t,r),Fn(34819,t,r))},ZT={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,r)=>e({[t]:r}),hint:(e,t,r)=>e({[t]:r}),bindFramebuffer:(e,t,r)=>{switch(t){case 36160:return e({36006:r,36010:r});case 36009:return e({36006:r});case 36008:return e({36010:r});default:return null}},blendColor:(e,t,r,i,n)=>e({32773:new Float32Array([t,r,i,n])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,r)=>e({32777:t,34877:r}),blendFunc:(e,t,r)=>e({32969:t,32968:r,32971:t,32970:r}),blendFuncSeparate:(e,t,r,i,n)=>e({32969:t,32968:r,32971:i,32970:n}),clearColor:(e,t,r,i,n)=>e({3106:new Float32Array([t,r,i,n])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,r,i,n)=>e({3107:[t,r,i,n]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,r)=>e({2928:new Float32Array([t,r])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,r)=>e({32824:t,10752:r}),sampleCoverage:(e,t,r)=>e({32938:t,32939:r}),scissor:(e,t,r,i,n)=>e({3088:new Int32Array([t,r,i,n])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,r)=>e({[t===1028?2968:36005]:r}),stencilFunc:(e,t,r,i)=>e({2962:t,2967:r,2963:i,34816:t,36003:r,36004:i}),stencilFuncSeparate:(e,t,r,i,n)=>e({[t===1028?2962:34816]:r,[t===1028?2967:36003]:i,[t===1028?2963:36004]:n}),stencilOp:(e,t,r,i)=>e({2964:t,2965:r,2966:i,34817:t,34818:r,34819:i}),stencilOpSeparate:(e,t,r,i,n)=>e({[t===1028?2964:34817]:r,[t===1028?2965:34818]:i,[t===1028?2966:34819]:n}),viewport:(e,t,r,i,n)=>e({2978:[t,r,i,n]})},uu=(e,t)=>e.isEnabled(t),YT={3042:uu,2884:uu,2929:uu,3024:uu,32823:uu,32926:uu,32928:uu,3089:uu,2960:uu,35977:uu};function u6(e){for(const t in e)return!1;return!0}function H9(e,t){if(e===t)return!0;const r=Array.isArray(e)||ArrayBuffer.isView(e),i=Array.isArray(t)||ArrayBuffer.isView(t);if(r&&i&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}function JT(e,t){const r=e[t].bind(e);e[t]=function(){const i=arguments.length<=0?void 0:arguments[0];return i in e.state.cache?e.state.enable?e.state.cache[i]:r(...arguments):r(...arguments)},Object.defineProperty(e[t],"name",{value:"".concat(t,"-from-cache"),configurable:!1})}function $9(e,t,r){const i=e[t].bind(e);e[t]=function(){for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];const{valueChanged:a,oldValue:p}=r(e.state._updateCache,...s);return a&&i(...s),p},Object.defineProperty(e[t],"name",{value:"".concat(t,"-to-cache"),configurable:!1})}function W9(e){const t=e.useProgram.bind(e);e.useProgram=function(r){e.state.program!==r&&(t(r),e.state.program=r)}}class X9{constructor(t){let{copyState:r=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=r?Y9(t):Object.assign({},bS),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Yo(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];vh(this.gl,t),this.stateStack.pop()}_updateCache(t){let r=!1,i;const n=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in t){Yo(s!==void 0);const c=t[s],a=this.cache[s];H9(c,a)||(r=!0,i=a,n&&!(s in n)&&(n[s]=a),this.cache[s]=c)}return{valueChanged:r,oldValue:i}}}function h6(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:r=!0,copyState:i}=t;if(Yo(i!==void 0),!e.state){const{polyfillContext:n}=globalThis;n&&n(e),e.state=new X9(e,{copyState:i}),W9(e);for(const s in ZT){const c=ZT[s];$9(e,s,c)}JT(e,"getParameter"),JT(e,"isEnabled")}return e.state.enable=r,e}function Z9(e){e.state||h6(e,{copyState:!1}),e.state.push()}function KT(e){Yo(e.state),e.state.pop()}function vh(e,t){if(Yo(dv(e),"setParameters requires a WebGL context"),u6(t))return;const r={};for(const n in t){const s=Number(n),c=V9[n];c&&(typeof c=="string"?r[c]=!0:c(e,t[n],s))}const i=e.state&&e.state.cache;if(i)for(const n in r){const s=q9[n];s(e,t,i)}}function Y9(e,t){if(t=t||bS,typeof t=="number"){const n=t,s=YT[n];return s?s(e,n):e.getParameter(n)}const r=Array.isArray(t)?t:Object.keys(t),i={};for(const n of r){const s=YT[n];i[n]=s?s(e,Number(n)):e.getParameter(Number(n))}return i}function J9(e){vh(e,bS)}function xc(e,t,r){if(u6(t))return r(e);const{nocatch:i=!0}=t;Z9(e),vh(e,t);let n;if(i)n=r(e),KT(e);else try{n=r(e)}finally{KT(e)}return n}function mm(e){const{luma:t}=e;if(e.canvas&&t){const r=t.canvasSizeInfo,i="clientWidth"in r?r.clientWidth:e.canvas.clientWidth;return i?e.drawingBufferWidth/i:1}return 1}function r2(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=mm(e),n=e.drawingBufferWidth,s=e.drawingBufferHeight;return Q9(t,i,n,s,r)}function K9(e){const t=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(e)?e<=0?1:e:e?t:1}function Q9(e,t,r,i,n){const s=QT(e[0],t,r);let c=tC(e[1],t,i,n),a=QT(e[0]+1,t,r);const p=a===r-1?a:a-1;a=tC(e[1]+1,t,i,n);let _;return n?(a=a===0?a:a+1,_=c,c=a):_=a===i-1?a:a-1,{x:s,y:c,width:Math.max(p-s+1,1),height:Math.max(_-c+1,1)}}function QT(e,t,r){return Math.min(Math.round(e*t),r-1)}function tC(e,t,r,i){return i?Math.max(0,r-1-Math.round(e*t)):Math.min(Math.round(e*t),r-1)}const wS=Sh(),tj=wS&&typeof document<"u",d6={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function p6(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Yo(wS,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),e=Object.assign({},d6,e);const{width:t,height:r}=e;function i(a){if(e.throwOnError)throw new Error(a);return console.error(a),null}e.onError=i;let n;const{canvas:s}=e,c=nj({canvas:s,width:t,height:r,onError:i});return n=ij(c,e),n?(n=xS(n,e),sj(n),n):null}function xS(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!e||e._instrumented)return e;e._version=e._version||oj(e),e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{},t=Object.assign({},d6,t);const{manageState:r,debug:i}=t;return r&&h6(e,{copyState:!1,log:function(){for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return cr.log(1,...s)()}}),wS&&i&&(globalThis.makeDebugContext?(e=globalThis.makeDebugContext(e,t),cr.level=Math.max(cr.level,1)):cr.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),e._instrumented=!0,e}function ej(e){const t=e.getParameter(7936),r=e.getParameter(7937),i=e.getExtension("WEBGL_debug_renderer_info"),n=i&&e.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),s=i&&e.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:n||t,renderer:s||r,vendorMasked:t,rendererMasked:r,version:e.getParameter(7938),shadingLanguageVersion:e.getParameter(35724)}}function rj(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.canvas){const i=K9(t.useDevicePixels);aj(e,i,t);return}const r=e.getExtension("STACKGL_resize_drawingbuffer");r&&"width"in t&&"height"in t&&r.resize(t.width,t.height)}function ij(e,t){const{onError:r}=t;let i=null;const n=p=>i=p.statusMessage||i;e.addEventListener("webglcontextcreationerror",n,!1);const{webgl1:s=!0,webgl2:c=!0}=t;let a=null;return c&&(a=a||e.getContext("webgl2",t),a=a||e.getContext("experimental-webgl2",t)),s&&(a=a||e.getContext("webgl",t),a=a||e.getContext("experimental-webgl",t)),e.removeEventListener("webglcontextcreationerror",n,!1),a?(t.onContextLost&&e.addEventListener("webglcontextlost",t.onContextLost,!1),t.onContextRestored&&e.addEventListener("webglcontextrestored",t.onContextRestored,!1),a):r("Failed to create ".concat(c&&!s?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function nj(e){let{canvas:t,width:r=800,height:i=600,onError:n}=e,s;return typeof t=="string"?(tj&&document.readyState==="complete"||n("createGLContext called on canvas '".concat(t,"' before page was loaded")),s=document.getElementById(t)):t?s=t:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(r)?"".concat(r,"px"):"100%",s.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function sj(e){const t=ri(e)?"WebGL2":"WebGL1",r=ej(e),i=r?"(".concat(r.vendor,",").concat(r.renderer,")"):"",n=e.debug?" debug":"";cr.info(1,"".concat(t).concat(n," context ").concat(i))()}function oj(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?2:1}function aj(e,t,r){let i="width"in r?r.width:e.canvas.clientWidth,n="height"in r?r.height:e.canvas.clientHeight;(!i||!n)&&(cr.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,i=e.canvas.width||1,n=e.canvas.height||1),e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{};const s=e.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==n||s.devicePixelRatio!==t){let c=t;const a=Math.floor(i*c),p=Math.floor(n*c);e.canvas.width=a,e.canvas.height=p,(e.drawingBufferWidth!==a||e.drawingBufferHeight!==p)&&(cr.warn("Device pixel ratio clamped")(),c=Math.min(e.drawingBufferWidth/i,e.drawingBufferHeight/n),e.canvas.width=Math.floor(i*c),e.canvas.height=Math.floor(n*c)),Object.assign(e.luma.canvasSizeInfo,{clientWidth:i,clientHeight:n,devicePixelRatio:t})}}const Qg="8.5.21",lj="set luma.log.level=1 (or higher) to trace rendering";class cj{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new q0({id:t})),this.stats.get(t)}}const fp=new cj;if(globalThis.luma&&globalThis.luma.VERSION!==Qg)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Qg));globalThis.luma||(Sh()&&cr.log(1,"luma.gl ".concat(Qg," - ").concat(lj))(),globalThis.luma=globalThis.luma||{VERSION:Qg,version:Qg,log:cr,stats:fp,globals:{modules:{},nodeIO:{}}});function uj(e){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function hj(e){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}function Ze(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}function i2(e,t){if(typeof t!="string")return t;const r=Number(t);if(!isNaN(r))return r;t=t.replace(/^.*\./,"");const i=e[t];return Ze(i!==void 0,"Accessing undefined constant GL.".concat(t)),i}function _d(e,t){t=Number(t);for(const r in e)if(e[r]===t)return"GL.".concat(r);return String(t)}const n2={};function bh(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";n2[e]=n2[e]||1;const t=n2[e]++;return"".concat(e,"-").concat(t)}function eC(e){return Ze(typeof e=="number","Input must be a number"),e&&(e&e-1)===0}function gm(e){let t=!0;for(const r in e){t=!1;break}return t}function f6(e,t,r,i){const n="See luma.gl ".concat(r," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(e);i.forEach(c=>{s.methodName||(s[c]=()=>{throw cr.removed("Calling removed method ".concat(t,".").concat(c,": "),n)(),new Error(c)})})}const pf="Resource subclass must define virtual methods";let Ah=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};pv(e);const{id:r,userData:i={}}=t;this.gl=e,this.gl2=e,this.id=r||bh(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=t.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=i2(this.gl,e),Ze(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const i=ri(this.gl);if(!((!("webgl2"in r)||i)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const n=r.webgl1,s="webgl2"in r?r.webgl2:r.webgl1;return i?s:n}}return this._getParameter(e,t)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:t,keys:r}=e,i=this.constructor.PARAMETERS||{},n=ri(this.gl),s={},c=t||Object.keys(i);for(const a of c){const p=i[a];if(p&&(!("webgl2"in p)||n)&&(!("extension"in p)||this.gl.getExtension(p.extension))){const _=r?_d(this.gl,a):a;s[_]=this.getParameter(a,e),r&&p.type==="GLenum"&&(s[_]=_d(this.gl,s[_]))}}return s}setParameter(e,t){e=i2(this.gl,e),Ze(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const i=ri(this.gl);if(!((!("webgl2"in r)||i)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");r.type==="GLenum"&&(t=i2(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,r){return f6(this,e,t,r)}initialize(e){}_createHandle(){throw new Error(pf)}_deleteHandle(){throw new Error(pf)}_bindHandle(e){throw new Error(pf)}_getOptsFromHandle(){throw new Error(pf)}_getParameter(e,t){throw new Error(pf)}_setParameter(e,t){throw new Error(pf)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],t=fp.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(e,"s Created")).incrementCount(),t.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];fp.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,t),this._trackAllocatedMemoryForContext(e,t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const i=fp.get("Memory Usage".concat(r));i.get("GPU Memory").addCount(e),i.get("".concat(t," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=fp.get("Memory Usage".concat(t));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const dj="Failed to deduce GL constant from typed array";function ux(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(dj)}}function A0(e){let{clamped:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function pj(e){let{data:t,width:r,height:i,bytesPerPixel:n=4,temp:s}=e;const c=r*n;s=s||new Uint8Array(c);for(let a=0;a<i/2;++a){const p=a*c,_=(i-a-1)*c;s.set(t.subarray(p,p+c)),t.copyWithin(p,_,_+c),t.set(s,_)}}function fj(e){let{data:t,width:r,height:i}=e;const n=Math.round(r/2),s=Math.round(i/2),c=new Uint8Array(n*s*4);for(let a=0;a<s;a++)for(let p=0;p<n;p++)for(let _=0;_<4;_++)c[(a*n+p)*4+_]=t[(a*2*r+p*2)*4+_];return{data:c,width:n,height:s}}function hx(e,t,r){const{removedProps:i={},deprecatedProps:n={},replacedProps:s={}}=r;for(const a in i)if(a in t){const p=i[a]?"".concat(e,".").concat(i[a]):"N/A";cr.removed("".concat(e,".").concat(a),p)()}for(const a in n)if(a in t){const p=n[a];cr.deprecated("".concat(e,".").concat(a),"".concat(e,".").concat(p))()}let c=null;for(const a in s)if(a in t){const p=s[a];cr.deprecated("".concat(e,".").concat(a),"".concat(e,".").concat(p))(),c=c||Object.assign({},t),c[p]=t[a],delete c[a]}return c||t}const mj={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},gj={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class va{static getBytesPerElement(t){return A0(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return Ze(t.size),A0(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return new va(mj,...r)}constructor(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];r.forEach(n=>this._assign(n)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return va.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return va.getBytesPerVertex(this)}_assign(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t=hx("Accessor",t,gj),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this}}const rC=10,m6={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},yj={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:m6},_j={removedProps:m6};let Wi=class extends Ah{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/va.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/va.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=hx("Buffer",e,yj),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=hx("Buffer",e,_j),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new va(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:r=0,srcOffset:i=0}=e,n=e.byteLength||e.length;Ze(t);const s=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(s,this.handle),i!==0||n!==void 0?(Jo(this.gl),this.gl.bufferSubData(this.target,r,t,i,n)):this.gl.bufferSubData(s,r,t),this.gl.bindBuffer(s,null),this.debugData=null,this._inferType(t),this}copyData(e){let{sourceBuffer:t,readOffset:r=0,writeOffset:i=0,size:n}=e;const{gl:s}=this;return Jo(s),s.bindBuffer(36662,t.handle),s.bindBuffer(36663,this.handle),s.copyBufferSubData(36662,36663,r,i,n),s.bindBuffer(36662,null),s.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:t=0,dstOffset:r=0,length:i=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Jo(this.gl);const n=A0(this.accessor.type||5126,{clamped:!1}),s=this._getAvailableElementCount(t),c=r;let a,p;e?(p=e.length,a=p-c):(a=Math.min(s,i||s),p=c+a);const _=Math.min(s,a);return i=i||_,Ze(i<=_),e=e||new n(p),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,e,r,i),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:r=0,size:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?i!==void 0?this.gl.bindBufferRange(e,t,this.handle,r,i):(Ze(r===0),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(rC,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+t;Ze(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.usage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.debugData=e.slice(0,rC),this.bytesUsed=r,this._trackAllocatedMemory(r);const n=ux(e);return Ze(n),this.setAccessor(new va(this.accessor,{type:n})),this}_setByteLength(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;Ze(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,t),this.gl.bindBuffer(i,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const t=A0(this.accessor.type||5126,{clamped:!1}),r=e/t.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new va(this.accessor,{type:ux(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return cr.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return cr.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return cr.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return cr.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new va(this.accessor,e),this}};const SS={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},g6={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},y6={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function vj(e,t){const r=SS[t];if(!r)return!1;if(r.gl1===void 0&&r.gl2===void 0)return!0;const i=ri(e)&&r.gl2||r.gl1;return typeof i=="string"?e.getExtension(i):i}function bj(e,t){const r=SS[t];switch(r&&r.types[0]){case 5126:return e.getExtension("OES_texture_float_linear");case 5131:return e.getExtension("OES_texture_half_float_linear");default:return!0}}const wj=[9729,9728],iC=globalThis.WebGLBuffer||function(){};class ym extends Ah{get[Symbol.toStringTag](){return"Texture"}static isSupported(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:n}=r;let s=!0;return i&&(s=s&&vj(t,i),s=s&&(!n||bj(t,i))),s}constructor(t,r){const{id:i=bh("texture"),handle:n,target:s}=r;super(t,{id:i,handle:n}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.data;if(r instanceof Promise)return r.then(z=>this.initialize(Object.assign({},t,{pixels:z,data:z}))),this;const i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(i&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(t)),this;const{pixels:n=null,format:s=6408,border:c=0,recreate:a=!1,parameters:p={},pixelStore:_={},textureUnit:w=void 0}=t;r||(r=n);let{width:S,height:C,dataFormat:I,type:N,compressed:F=!1,mipmaps:W=!0}=t;const{depth:U=0}=t;return{width:S,height:C,compressed:F,dataFormat:I,type:N}=this._deduceParameters({format:s,type:N,dataFormat:I,compressed:F,data:r,width:S,height:C}),this.width=S,this.height=C,this.depth=U,this.format=s,this.type=N,this.dataFormat=I,this.border=c,this.textureUnit=w,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),W&&this._isNPOT()&&(cr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),W=!1,this._updateForNPOT(p)),this.mipmaps=W,this.setImageData({data:r,width:S,height:C,depth:U,format:s,type:N,dataFormat:I,border:c,mipmaps:W,parameters:_,compressed:F}),W&&this.generateMipmap(),this.setParameters(p),a&&(this.data=r),i&&(this._video={video:r,parameters:p,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:r,lastTime:i}=this._video;if(i===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize(t){let{height:r,width:i,mipmaps:n=!1}=t;return i!==this.width||r!==this.height?this.initialize({width:i,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:n}):this}generateMipmap(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(cr.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),xc(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:i=null,level:n=0,format:s=this.format,border:c=this.border,offset:a=0,parameters:p={}}=t;let{data:_=null,type:w=this.type,width:S=this.width,height:C=this.height,dataFormat:I=this.dataFormat,compressed:N=!1}=t;_||(_=i),{type:w,dataFormat:I,compressed:N,width:S,height:C}=this._deduceParameters({format:s,type:w,dataFormat:I,compressed:N,data:_,width:S,height:C});const{gl:F}=this;F.bindTexture(this.target,this.handle);let W=null;({data:_,dataType:W}=this._getDataType({data:_,compressed:N}));let U,z=0;if(xc(this.gl,p,()=>{switch(W){case"null":F.texImage2D(r,n,s,S,C,c,I,w,_);break;case"typed-array":F.texImage2D(r,n,s,S,C,c,I,w,_,a);break;case"buffer":U=Jo(F),U.bindBuffer(35052,_.handle||_),U.texImage2D(r,n,s,S,C,c,I,w,a),U.bindBuffer(35052,null);break;case"browser-object":ri(F)?F.texImage2D(r,n,s,S,C,c,I,w,_):F.texImage2D(r,n,s,I,w,_);break;case"compressed":for(const[H,nt]of _.entries())F.compressedTexImage2D(r,H,nt.format,nt.width,nt.height,c,nt.data),z+=nt.levelSize;break;default:Ze(!1,"Unknown image data type")}}),W==="compressed")this._trackAllocatedMemory(z,"Texture");else if(_&&_.byteLength)this._trackAllocatedMemory(_.byteLength,"Texture");else{const H=g6[this.dataFormat]||4,nt=y6[this.type]||1;this._trackAllocatedMemory(this.width*this.height*H*nt,"Texture")}return this.loaded=!0,this}setSubImageData(t){let{target:r=this.target,pixels:i=null,data:n=null,x:s=0,y:c=0,width:a=this.width,height:p=this.height,level:_=0,format:w=this.format,type:S=this.type,dataFormat:C=this.dataFormat,compressed:I=!1,offset:N=0,border:F=this.border,parameters:W={}}=t;if({type:S,dataFormat:C,compressed:I,width:a,height:p}=this._deduceParameters({format:w,type:S,dataFormat:C,compressed:I,data:n,width:a,height:p}),Ze(this.depth===0,"texSubImage not supported for 3D textures"),n||(n=i),n&&n.data){const U=n;n=U.data,a=U.shape[0],p=U.shape[1]}n instanceof Wi&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),xc(this.gl,W,()=>{if(I)this.gl.compressedTexSubImage2D(r,_,s,c,a,p,w,n);else if(n===null)this.gl.texSubImage2D(r,_,s,c,a,p,C,S,null);else if(ArrayBuffer.isView(n))this.gl.texSubImage2D(r,_,s,c,a,p,C,S,n,N);else if(n instanceof iC){const U=Jo(this.gl);U.bindBuffer(35052,n),U.texSubImage2D(r,_,s,c,a,p,C,S,N),U.bindBuffer(35052,null)}else ri(this.gl)?Jo(this.gl).texSubImage2D(r,_,s,c,a,p,C,S,n):this.gl.texSubImage2D(r,_,s,c,C,S,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return cr.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.target,this.handle),t}unbind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.target,null),t}_getDataType(t){let{data:r,compressed:i=!1}=t;return i?{data:r,dataType:"compressed"}:r===null?{data:r,dataType:"null"}:ArrayBuffer.isView(r)?{data:r,dataType:"typed-array"}:r instanceof Wi?{data:r.handle,dataType:"buffer"}:r instanceof iC?{data:r,dataType:"buffer"}:{data:r,dataType:"browser-object"}}_deduceParameters(t){const{format:r,data:i}=t;let{width:n,height:s,dataFormat:c,type:a,compressed:p}=t;const _=SS[r];return c=c||_&&_.dataFormat,a=a||_&&_.types[0],p=p||_&&_.compressed,{width:n,height:s}=this._deduceImageSize(i,n,s),{dataFormat:c,type:a,compressed:p,width:n,height:s,format:r,data:i}}_deduceImageSize(t,r,i){let n;return typeof ImageData<"u"&&t instanceof ImageData?n={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?n={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?n={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?n={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?n={width:t.videoWidth,height:t.videoHeight}:t?n={width:r,height:i}:n={width:r>=0?r:1,height:i>=0?i:1},Ze(n,"Could not deduced texture size"),Ze(r===void 0||n.width===r,"Deduced texture width does not match supplied width"),Ze(i===void 0||n.height===i,"Deduced texture height does not match supplied height"),n}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const r=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),r}}_setParameter(t,r){switch(this.gl.bindTexture(this.target,this.handle),r=this._getNPOTParam(t,r),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,r);break;case 4096:case 4097:Ze(!1);break;default:this.gl.texParameteri(this.target,t,r);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return ri(this.gl)||!this.width||!this.height?!1:!eC(this.width)||!eC(this.height)}_updateForNPOT(t){t[this.gl.TEXTURE_MIN_FILTER]===void 0&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),t[this.gl.TEXTURE_WRAP_S]===void 0&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),t[this.gl.TEXTURE_WRAP_T]===void 0&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,r){if(this._isNPOT())switch(t){case 10241:wj.indexOf(r)===-1&&(r=9729);break;case 10242:case 10243:r!==33071&&(r=33071);break}return r}}let xj="";function Sj(e,t){return Ze(typeof e=="string"),e=xj+e,new Promise((r,i)=>{try{const n=new Image;n.onload=()=>r(n),n.onerror=()=>i(new Error("Could not load image ".concat(e,"."))),n.crossOrigin=t&&t.crossOrigin||"anonymous",n.src=e}catch(n){i(n)}})}class ll extends ym{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(t,r){return ym.isSupported(t,r)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};pv(t),(r instanceof Promise||typeof r=="string")&&(r={data:r}),typeof r.data=="string"&&(r=Object.assign({},r,{data:Sj(r.data)})),super(t,Object.assign({},r,{target:3553})),this.initialize(r),Object.seal(this)}}const dx=[34069,34070,34071,34072,34073,34074];class _6 extends ym{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};pv(t),super(t,Object.assign({},r,{target:34067})),this.initialize(r),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:r=!0,parameters:i={}}=t;return this.opts=t,this.setCubeMapImageData(t).then(()=>{this.loaded=!0,r&&this.generateMipmap(t),this.setParameters(i)}),this}subImage(t){let{face:r,data:i,x:n=0,y:s=0,mipmapLevel:c=0}=t;return this._subImage({target:r,data:i,x:n,y:s,mipmapLevel:c})}async setCubeMapImageData(t){let{width:r,height:i,pixels:n,data:s,border:c=0,format:a=6408,type:p=5121}=t;const{gl:_}=this,w=n||s,S=await Promise.all(dx.map(C=>{const I=w[C];return Promise.all(Array.isArray(I)?I:[I])}));this.bind(),dx.forEach((C,I)=>{S[I].length>1&&this.opts.mipmaps!==!1&&cr.warn("".concat(this.id," has mipmap and multiple LODs."))(),S[I].forEach((N,F)=>{r&&i?_.texImage2D(C,F,a,r,i,c,a,p,N):_.texImage2D(C,F,a,a,p,N)})}),this.unbind()}setImageDataForFace(t){const{face:r,width:i,height:n,pixels:s,data:c,border:a=0,format:p=6408,type:_=5121}=t,{gl:w}=this,S=s||c;return this.bind(),S instanceof Promise?S.then(C=>this.setImageDataForFace(Object.assign({},t,{face:r,data:C,pixels:C}))):this.width||this.height?w.texImage2D(r,0,p,i,n,a,p,_,S):w.texImage2D(r,0,p,p,_,S),this}}_6.FACES=dx;class Aj extends ym{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(t){return ri(t)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Jo(t),r=Object.assign({depth:1},r,{target:32879,unpackFlipY:!1}),super(t,r),this.initialize(r),Object.seal(this)}setImageData(t){let{level:r=0,dataFormat:i=6408,width:n,height:s,depth:c=1,border:a=0,format:p,type:_=5121,offset:w=0,data:S,parameters:C={}}=t;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),xc(this.gl,C,()=>{ArrayBuffer.isView(S)&&this.gl.texImage3D(this.target,r,i,n,s,c,a,p,_,S),S instanceof Wi&&(this.gl.bindBuffer(35052,S.handle),this.gl.texImage3D(this.target,r,i,n,s,c,a,p,_,w))}),S&&S.byteLength)this._trackAllocatedMemory(S.byteLength,"Texture");else{const I=g6[this.dataFormat]||4,N=y6[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*I*N,"Texture")}return this.loaded=!0,this}}const Kd="EXT_color_buffer_float",nC={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:Kd,bpp:2},33327:{gl2:Kd,bpp:4},34842:{gl2:Kd,bpp:8},33326:{gl2:Kd,bpp:4},33328:{gl2:Kd,bpp:8},34836:{gl2:Kd,bpp:16},35898:{gl2:Kd,bpp:4}};function Ej(e,t,r){const i=r[t];if(!i)return!1;const n=ri(e)&&i.gl2||i.gl1;return typeof n=="string"?e.getExtension(n):n}class zf extends Ah{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(t){let{format:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!r||Ej(t,r,nC)}static getSamplesForFormat(t,r){let{format:i}=r;return t.getInternalformatParameter(36161,i,32937)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,r),this.initialize(r),Object.seal(this)}initialize(t){let{format:r,width:i=1,height:n=1,samples:s=0}=t;return Ze(r,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&ri(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,r,i,n):this.gl.renderbufferStorage(36161,r,i,n),this.format=r,this.width=i,this.height=n,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*nC[this.format].bpp),this}resize(t){let{width:r,height:i}=t;return r!==this.width||i!==this.height?this.initialize({width:r,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}const Tj=256,Cj=1024,Pj=16384,sC=6144,oC=6145,aC=6146,lC=34041,v6="clear: bad arguments";function AS(e){let{framebuffer:t=null,color:r=null,depth:i=null,stencil:n=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};t&&(s.framebuffer=t);let c=0;r&&(c|=Pj,r!==!0&&(s.clearColor=r)),i&&(c|=Tj,i!==!0&&(s.clearDepth=i)),n&&(c|=Cj,i!==!0&&(s.clearStencil=i)),Ze(c!==0,v6),xc(e,s,()=>{e.clear(c)})}function Ij(e){let{framebuffer:t=null,buffer:r=sC,drawBuffer:i=0,value:n=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Jo(e),xc(e,{framebuffer:t},()=>{switch(r){case sC:switch(n.constructor){case Int32Array:e.clearBufferiv(r,i,n);break;case Uint32Array:e.clearBufferuiv(r,i,n);break;case Float32Array:default:e.clearBufferfv(r,i,n)}break;case oC:e.clearBufferfv(oC,0,[n]);break;case aC:e.clearBufferiv(aC,0,[n]);break;case lC:const[s,c]=n;e.clearBufferfi(lC,0,s,c);break;default:Ze(!1,v6)}})}function Lj(e){switch(e){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Ze(!1),0}}function fv(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:r=0,sourceY:i=0,sourceFormat:n=6408}=t;let{sourceAttachment:s=36064,target:c=null,sourceWidth:a,sourceHeight:p,sourceType:_}=t;const{framebuffer:w,deleteFramebuffer:S}=Mj(e);Ze(w);const{gl:C,handle:I,attachments:N}=w;a=a||w.width,p=p||w.height,s===36064&&I===null&&(s=1028),Ze(N[s]),_=_||N[s].type,c=Bj(c,_,n,a,p),_=_||ux(c);const F=C.bindFramebuffer(36160,I);return C.readPixels(r,i,a,p,n,_,c),C.bindFramebuffer(36160,F||null),S&&w.delete(),c}function cC(e){let{sourceAttachment:t=36064,targetMaxHeight:r=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=fv(e,{sourceAttachment:t}),{width:n,height:s}=e;for(;s>r;)({data:i,width:n,height:s}=fj({data:i,width:n,height:s}));pj({data:i,width:n,height:s});const c=document.createElement("canvas");c.width=n,c.height=s;const a=c.getContext("2d"),p=a.createImageData(n,s);return p.data.set(i),a.putImageData(p,0,0),c.toDataURL()}function Mj(e){return e instanceof Ss?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:Uj(e),deleteFramebuffer:!0}}function Bj(e,t,r,i,n){if(e)return e;t=t||5121;const s=A0(t,{clamped:!1}),c=Lj(r);return new s(i*n*c)}const nn={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function kj(e){const t=new ll(e,{format:6408,type:5126,dataFormat:6408}),r=new Ss(e,{id:"test-framebuffer",check:!1,attachments:{36064:t}}),i=r.getStatus();return t.delete(),r.delete(),i===36053}const b6={[nn.WEBGL2]:[!1,!0],[nn.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[nn.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[nn.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[nn.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[nn.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[nn.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[nn.FLOAT_BLEND]:["EXT_float_blend"],[nn.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[nn.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[nn.TEXTURE_FLOAT]:["OES_texture_float",!0],[nn.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[nn.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[nn.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[nn.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[nn.COLOR_ATTACHMENT_RGBA32F]:[kj,"EXT_color_buffer_float"],[nn.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[nn.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[nn.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[nn.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[nn.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[nn.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},Rj=2;function ES(e,t){return w6(e,t)}function w6(e,t){return t=Array.isArray(t)?t:[t],t.every(r=>x6(e,r))}function Fj(e){e.luma=e.luma||{},e.luma.caps=e.luma.caps||{};for(const t in b6)e.luma.caps[t]===void 0&&(e.luma.caps[t]=x6(e,t));return e.luma.caps}function x6(e,t){return e.luma=e.luma||{},e.luma.caps=e.luma.caps||{},e.luma.caps[t]===void 0&&(e.luma.caps[t]=Dj(e,t)),e.luma.caps[t]||cr.log(Rj,"Feature: ".concat(t," not supported"))(),e.luma.caps[t]}function Dj(e,t){const r=b6[t];Ze(r,t);let i;const n=ri(e)&&r[1]||r[0];if(typeof n=="function")i=n(e);else if(Array.isArray(n)){i=!0;for(const s of n)i=i&&!!e.getExtension(s)}else typeof n=="string"?i=!!e.getExtension(n):typeof n=="boolean"?i=n:Ze(!1);return i}const uC="Multiple render targets not supported";class Ss extends Ah{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:n}=r;let s=!0;return i&&(s=!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),n&&(s=s&&!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new Ss(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=Jo(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=Jo(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,r),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(r),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(t){let{width:r=1,height:i=1,attachments:n=null,color:s=!0,depth:c=!0,stencil:a=!1,check:p=!0,readBuffer:_=void 0,drawBuffers:w=void 0}=t;if(Ze(r>=0&&i>=0,"Width and height need to be integers"),this.width=r,this.height=i,n)for(const S in n){const C=n[S];(Array.isArray(C)?C[0]:C).resize({width:r,height:i})}else n=this._createDefaultAttachments(s,c,a,r,i);this.update({clearAttachments:!0,attachments:n,readBuffer:_,drawBuffers:w}),n&&p&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update(t){let{attachments:r={},readBuffer:i,drawBuffers:n,clearAttachments:s=!1,resizeAttachments:c=!0}=t;this.attach(r,{clearAttachments:s,resizeAttachments:c});const{gl:a}=this,p=a.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),n&&this._setDrawBuffers(n),a.bindFramebuffer(36160,p||null),this}resize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:r,height:i}=t;if(this.handle===null)return Ze(r===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;r===void 0&&(r=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),r!==this.width&&i!==this.height&&cr.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(r,"x").concat(i))();for(const n in this.attachments)this.attachments[n].resize({width:r,height:i});return this.width=r,this.height=i,this}attach(t){let{clearAttachments:r=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n={};r&&Object.keys(this.attachments).forEach(c=>{n[c]=null}),Object.assign(n,t);const s=this.gl.bindFramebuffer(36160,this.handle);for(const c in n){Ze(c!==void 0,"Misspelled framebuffer binding point?");const a=Number(c),p=n[a];let _=p;if(!_)this._unattach(a);else if(_ instanceof zf)this._attachRenderbuffer({attachment:a,renderbuffer:_});else if(Array.isArray(p)){const[w,S=0,C=0]=p;_=w,this._attachTexture({attachment:a,texture:w,layer:S,level:C})}else this._attachTexture({attachment:a,texture:_,layer:0,level:0});i&&_&&_.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(c=>!this.attachments[c]).forEach(c=>{delete this.attachments[c]})}checkStatus(){const t=this.getStatus();if(t!==36053)throw new Error(Oj(t));return this}getStatus(){const{gl:t}=this,r=t.bindFramebuffer(36160,this.handle),i=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,r||null),i}clear(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:r,depth:i,stencil:n,drawBuffers:s=[]}=t,c=this.gl.bindFramebuffer(36160,this.handle);return(r||i||n)&&AS(this.gl,{color:r,depth:i,stencil:n}),s.forEach((a,p)=>{Ij(this.gl,{drawBuffer:p,value:a})}),this.gl.bindFramebuffer(36160,c||null),this}readPixels(){return cr.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return cr.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return cr.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return cr.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return cr.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return cr.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(t){let{attachments:r=[],x:i=0,y:n=0,width:s,height:c}=t;const a=Jo(this.gl),p=a.bindFramebuffer(36008,this.handle);return i===0&&n===0&&s===void 0&&c===void 0?a.invalidateFramebuffer(36008,r):a.invalidateFramebuffer(36008,r,i,n,s,c),a.bindFramebuffer(36008,p),this}getAttachmentParameter(t,r,i){let n=this._getAttachmentParameterFallback(r);return n===null&&(this.gl.bindFramebuffer(36160,this.handle),n=this.gl.getFramebufferAttachmentParameter(36160,t,r),this.gl.bindFramebuffer(36160,null)),i&&n>1e3&&(n=_d(this.gl,n)),n}getAttachmentParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,r=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const n={};for(const s of i){const c=r?_d(this.gl,s):s;n[c]=this.getAttachmentParameter(t,s,r)}return n}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const r=Object.keys(this.attachments),i={};for(const n of r){const s=Number(n),c=t?_d(this.gl,s):s;i[c]=this.getAttachmentParameters(s,t)}return i}show(){return typeof window<"u"&&window.open(cC(this),"luma-debug-texture"),this}log(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(t>cr.level||typeof window>"u")return this;r=r||"Framebuffer ".concat(this.id);const i=cC(this,{targetMaxHeight:100});return cr.image({logLevel:t,message:r,image:i},r)(),this}bind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,this.handle),this}unbind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,r,i,n,s){let c=null;return t&&(c=c||{},c[36064]=new ll(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:n,height:s,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(c[36064])),r&&i?(c=c||{},c[33306]=new zf(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:n,height:111}),this.ownResources.push(c[33306])):r?(c=c||{},c[36096]=new zf(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:n,height:s}),this.ownResources.push(c[36096])):i&&Ze(!1),c}_unattach(t){const r=this.attachments[t];r&&(r instanceof zf?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer(t){let{attachment:r=36064,renderbuffer:i}=t;const{gl:n}=this;n.framebufferRenderbuffer(36160,r,36161,i.handle),this.attachments[r]=i}_attachTexture(t){let{attachment:r=36064,texture:i,layer:n,level:s}=t;const{gl:c}=this;switch(c.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:Jo(c).framebufferTextureLayer(36160,r,i.target,s,n);break;case 34067:const a=Nj(n);c.framebufferTexture2D(36160,r,a,i.handle,s);break;case 3553:c.framebufferTexture2D(36160,r,3553,i.handle,s);break;default:Ze(!1,"Illegal texture type")}c.bindTexture(i.target,null),this.attachments[r]=i}_setReadBuffer(t){const r=p9(this.gl);r?r.readBuffer(t):Ze(t===36064||t===1029,uC),this.readBuffer=t}_setDrawBuffers(t){const{gl:r}=this,i=Jo(r);if(i)i.drawBuffers(t);else{const n=r.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(t):Ze(t.length===1&&(t[0]===36064||t[0]===1029),uC)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const r=Fj(this.gl);switch(t){case 36052:return r.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return r.WEBGL2?null:8;case 33297:return r.WEBGL2?null:5125;case 33296:return!r.WEBGL2&&!r.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}function Nj(e){return e<34069?e+34069:e}function Oj(e){return(Ss.STATUS||{})[e]||"Framebuffer error ".concat(e)}const zj=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Ss.ATTACHMENT_PARAMETERS=zj;function jj(e,t){Ze(e instanceof ll||e instanceof _6||e instanceof Aj);const r=e.constructor,{gl:i,width:n,height:s,format:c,type:a,dataFormat:p,border:_,mipmaps:w}=e,S=Object.assign({width:n,height:s,format:c,type:a,dataFormat:p,border:_,mipmaps:w},t);return new r(i,S)}function Uj(e,t){const{gl:r,width:i,height:n,id:s}=e;return new Ss(r,Object.assign({},t,{id:"framebuffer-for-".concat(s),width:i,height:n,attachments:{36064:e}}))}function By(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=e.match(r);return i?i[1]:t}const Gj=35632,Vj=35633;function qj(e){switch(e){case Gj:return"fragment";case Vj:return"vertex";default:return"unknown type"}}function Hj(e,t,r,i){const n=e.split(/\r?\n/),s={},c={},a=i||By(t)||"(unnamed)",p="".concat(qj(r)," shader ").concat(a);for(let w=0;w<n.length;w++){const S=n[w];if(S.length<=1)continue;const C=S.split(":"),I=C[0],N=parseInt(C[2],10);if(isNaN(N))throw new Error("GLSL compilation error in ".concat(p,": ").concat(e));I!=="WARNING"?s[N]=S:c[N]=S}const _=$j(t);return{shaderName:p,errors:hC(s,_),warnings:hC(c,_)}}function hC(e,t){let r="";for(let i=0;i<t.length;i++){const n=t[i];if(!(!e[i+3]&&!e[i+2]&&!e[i+1])&&(r+="".concat(n,`
`),e[i+1])){const s=e[i+1],c=s.split(":",3),a=c[0],p=parseInt(c[1],10)||0,_=s.substring(c.join(":").length+1).trim();r+=S6("^^^ ".concat(a,": ").concat(_,`

`),p)}}return r}function $j(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=e.split(/\r?\n/),n=String(i.length+t-1).length;return i.map((s,c)=>{const a=String(c+t),p=a.length;return S6(a,n-p)+r+s})}function S6(e,t){let r="";for(let i=0;i<t;++i)r+=" ";return"".concat(r).concat(e)}function A6(e){let t=100;const r=e.match(/[^\s]+/g);if(r.length>=2&&r[0]==="#version"){const i=parseInt(r[1],10);Number.isFinite(i)&&(t=i)}return t}const Wj="Shader: GLSL source code must be a JavaScript string";class E0 extends Ah{get[Symbol.toStringTag](){return"Shader"}static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Ze(!1),"unknown"}}constructor(t,r){pv(t),Ze(typeof r.source=="string",Wj);const i=By(r.source,null)||r.id||bh("unnamed ".concat(E0.getTypeName(r.shaderType)));super(t,{id:i}),this.shaderType=r.shaderType,this.source=r.source,this.initialize(r)}initialize(t){let{source:r}=t;const i=By(r,null);i&&(this.id=bh(i)),this._compile(r)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(E0.getTypeName(this.shaderType),":").concat(this.id)}getName(){return By(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(t.startsWith("#version ")||(t=`#version 100
`.concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:i,errors:n,warnings:s}=Hj(r,this.source,this.shaderType,this.id);throw cr.error("GLSL compilation errors in ".concat(i,`
`).concat(n))(),cr.warn("GLSL compilation warnings in ".concat(i,`
`).concat(s))(),new Error("GLSL compilation errors in ".concat(i))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class s2 extends E0{get[Symbol.toStringTag](){return"VertexShader"}constructor(t,r){typeof r=="string"&&(r={source:r}),super(t,Object.assign({},r,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class o2 extends E0{get[Symbol.toStringTag](){return"FragmentShader"}constructor(t,r){typeof r=="string"&&(r={source:r}),super(t,Object.assign({},r,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const Xj={5126:pn.bind(null,"uniform1fv",Za,1,bo),35664:pn.bind(null,"uniform2fv",Za,2,bo),35665:pn.bind(null,"uniform3fv",Za,3,bo),35666:pn.bind(null,"uniform4fv",Za,4,bo),5124:pn.bind(null,"uniform1iv",$h,1,bo),35667:pn.bind(null,"uniform2iv",$h,2,bo),35668:pn.bind(null,"uniform3iv",$h,3,bo),35669:pn.bind(null,"uniform4iv",$h,4,bo),35670:pn.bind(null,"uniform1iv",$h,1,bo),35671:pn.bind(null,"uniform2iv",$h,2,bo),35672:pn.bind(null,"uniform3iv",$h,3,bo),35673:pn.bind(null,"uniform4iv",$h,4,bo),35674:pn.bind(null,"uniformMatrix2fv",Za,4,Ku),35675:pn.bind(null,"uniformMatrix3fv",Za,9,Ku),35676:pn.bind(null,"uniformMatrix4fv",Za,16,Ku),35678:Js,35680:Js,5125:pn.bind(null,"uniform1uiv",q1,1,bo),36294:pn.bind(null,"uniform2uiv",q1,2,bo),36295:pn.bind(null,"uniform3uiv",q1,3,bo),36296:pn.bind(null,"uniform4uiv",q1,4,bo),35685:pn.bind(null,"uniformMatrix2x3fv",Za,6,Ku),35686:pn.bind(null,"uniformMatrix2x4fv",Za,8,Ku),35687:pn.bind(null,"uniformMatrix3x2fv",Za,6,Ku),35688:pn.bind(null,"uniformMatrix3x4fv",Za,12,Ku),35689:pn.bind(null,"uniformMatrix4x2fv",Za,8,Ku),35690:pn.bind(null,"uniformMatrix4x3fv",Za,12,Ku),35678:Js,35680:Js,35679:Js,35682:Js,36289:Js,36292:Js,36293:Js,36298:Js,36299:Js,36300:Js,36303:Js,36306:Js,36307:Js,36308:Js,36311:Js},Zj={},Yj={},Jj={},dC=[0];function TS(e,t,r,i){t===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(dC[0]=e,e=dC);const n=e.length;if(n%t&&cr.warn("Uniform size should be multiples of ".concat(t),e)(),e instanceof r)return e;let s=i[n];s||(s=new r(n),i[n]=s);for(let c=0;c<n;c++)s[c]=e[c];return s}function Za(e,t){return TS(e,t,Float32Array,Zj)}function $h(e,t){return TS(e,t,Int32Array,Yj)}function q1(e,t){return TS(e,t,Uint32Array,Jj)}function pC(e,t,r){const i=Xj[r.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(r.type));return i().bind(null,e,t)}function Kj(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/,r=e.match(t);if(!r||r.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:r[1],length:r[2]||1,isArray:!!r[2]}}function Qj(e,t,r){for(const i in e){const n=e[i];if((!r||r[i])&&!tU(n))throw t=t?"".concat(t," "):"",console.error("".concat(t," Bad uniform ").concat(i),n),new Error("".concat(t," Bad uniform ").concat(i))}return!0}function tU(e){return Array.isArray(e)||ArrayBuffer.isView(e)?rU(e):isFinite(e)||e===!0||e===!1||e instanceof ym||e instanceof zf?!0:e instanceof Ss?!!e.texture:!1}function eU(e,t,r){if(Array.isArray(r)||ArrayBuffer.isView(r))if(e[t]){const i=e[t];for(let n=0,s=r.length;n<s;++n)i[n]=r[n]}else e[t]=r.slice();else e[t]=r}function rU(e){if(e.length===0)return!1;const t=Math.min(e.length,16);for(let r=0;r<t;++r)if(!Number.isFinite(e[r]))return!1;return!0}function Js(){let e=null;return(t,r,i)=>{const n=e!==i;return n&&(t.uniform1i(r,i),e=i),n}}function pn(e,t,r,i){let n=null,s=null;return(c,a,p)=>{const _=t(p,r),w=_.length;let S=!1;if(n===null)n=new Float32Array(w),s=w,S=!0;else{Ze(s===w,"Uniform length cannot change.");for(let C=0;C<w;++C)if(_[C]!==n[C]){S=!0;break}}return S&&(i(c,e,a,_),n.set(_)),S}}function bo(e,t,r,i){e[t](r,i)}function Ku(e,t,r,i){e[t](r,!1,i)}const iU=5120,nU=5121,sU=5122,oU=5123,fC=0,H1=1,aU=2,lU=3,$1=4,cU=5,uU=6,vs=5126,hU=35664,dU=35665,pU=35666,vg=5124,fU=35667,mU=35668,gU=35669,bg=5125,yU=36294,_U=36295,vU=36296,bU=35670,wU=35671,xU=35672,SU=35673,AU=35674,EU=35675,TU=35676,CU=35685,PU=35686,IU=35687,LU=35688,MU=35689,BU=35690,px={[vs]:[vs,1,"float"],[hU]:[vs,2,"vec2"],[dU]:[vs,3,"vec3"],[pU]:[vs,4,"vec4"],[vg]:[vg,1,"int"],[fU]:[vg,2,"ivec2"],[mU]:[vg,3,"ivec3"],[gU]:[vg,4,"ivec4"],[bg]:[bg,1,"uint"],[yU]:[bg,2,"uvec2"],[_U]:[bg,3,"uvec3"],[vU]:[bg,4,"uvec4"],[bU]:[vs,1,"bool"],[wU]:[vs,2,"bvec2"],[xU]:[vs,3,"bvec3"],[SU]:[vs,4,"bvec4"],[AU]:[vs,8,"mat2"],[CU]:[vs,8,"mat2x3"],[PU]:[vs,8,"mat2x4"],[EU]:[vs,12,"mat3"],[IU]:[vs,12,"mat3x2"],[LU]:[vs,12,"mat3x4"],[TU]:[vs,16,"mat4"],[MU]:[vs,16,"mat4x2"],[BU]:[vs,16,"mat4x3"]};function kU(e){switch(e){case fC:return fC;case H1:return H1;case lU:return H1;case aU:return H1;case $1:return $1;case cU:return $1;case uU:return $1;default:return Ze(!1),0}}function mC(e){const t=px[e];if(!t)return null;const[r,i]=t;return{type:r,components:i}}function E6(e,t){switch(e){case iU:case nU:case sU:case oU:e=vs;break}for(const r in px){const[i,n,s]=px[r];if(i===e&&n===t)return{glType:r,name:s}}return null}class RU{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const r=Number(t);return Number.isFinite(r)?this.attributeInfosByLocation[r]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const r=this.getAttributeInfo(t);return r?r.location:-1}getAttributeAccessor(t){const r=this.getAttributeInfo(t);return r?r.accessor:null}getVaryingInfo(t){const r=Number(t);return Number.isFinite(r)?this.varyingInfos[r]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const r=this.getVaryingInfo();return r?r.location:-1}getVaryingAccessor(t){const r=this.getVaryingInfo();return r?r.accessor:null}_readAttributesFromProgram(t){const{gl:r}=t,i=r.getProgramParameter(t.handle,35721);for(let n=0;n<i;n++){const{name:s,type:c,size:a}=r.getActiveAttrib(t.handle,n),p=r.getAttribLocation(t.handle,s);p>=0&&this._addAttribute(p,s,c,a)}this.attributeInfos.sort((n,s)=>n.location-s.location)}_readVaryingsFromProgram(t){const{gl:r}=t;if(!ri(r))return;const i=r.getProgramParameter(t.handle,35971);for(let n=0;n<i;n++){const{name:s,type:c,size:a}=r.getTransformFeedbackVarying(t.handle,n);this._addVarying(n,s,c,a)}this.varyingInfos.sort((n,s)=>n.location-s.location)}_addAttribute(t,r,i,n){const{type:s,components:c}=mC(i),a={type:s,size:n*c};this._inferProperties(t,r,a);const p={location:t,name:r,accessor:new va(a)};this.attributeInfos.push(p),this.attributeInfosByLocation[t]=p,this.attributeInfosByName[p.name]=p}_inferProperties(t,r,i){/instance/i.test(r)&&(i.divisor=1)}_addVarying(t,r,i,n){const{type:s,components:c}=mC(i),a=new va({type:s,size:n*c}),p={location:t,name:r,accessor:a};this.varyingInfos.push(p),this.varyingInfosByName[p.name]=p}}const gC=4,FU=35981,DU=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class T6 extends Ah{get[Symbol.toStringTag](){return"Program"}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,r),this.stubRemovedMethods("Program","v6.0",DU),this._isCached=!1,this.initialize(r),Object.seal(this),this._setId(r.id)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:r,vs:i,fs:n,varyings:s,bufferMode:c=FU}=t;return this.hash=r||"",this.vs=typeof i=="string"?new s2(this.gl,{id:"".concat(t.id,"-vs"),source:i}):i,this.fs=typeof n=="string"?new o2(this.gl,{id:"".concat(t.id,"-fs"),source:n}):n,Ze(this.vs instanceof s2),Ze(this.fs instanceof o2),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(Jo(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,c)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new RU(this),this.setProps(t)}delete(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw(t){let{logPriority:r,drawMode:i=4,vertexCount:n,offset:s=0,start:c,end:a,isIndexed:p=!1,indexType:_=5123,instanceCount:w=0,isInstanced:S=w>0,vertexArray:C=null,transformFeedback:I,framebuffer:N,parameters:F={},uniforms:W,samplers:U}=t;if((W||U)&&(cr.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(W||{})),cr.priority>=r){const z=N?N.id:"default",H="mode=".concat(_d(this.gl,i)," verts=").concat(n," ")+"instances=".concat(w," indexType=").concat(_d(this.gl,_)," ")+"isInstanced=".concat(S," isIndexed=").concat(p," ")+"Framebuffer=".concat(z);cr.log(r,H)()}return Ze(C),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||n===0||S&&w===0?!1:(C.bindForDraw(n,w,()=>{if(N!==void 0&&(F=Object.assign({},F,{framebuffer:N})),I){const z=kU(i);I.begin(z)}this._bindTextures(),xc(this.gl,F,()=>{p&&S?this.gl2.drawElementsInstanced(i,n,_,s,w):p&&ri(this.gl)&&!isNaN(c)&&!isNaN(a)?this.gl2.drawRangeElements(i,c,a,n,_,s):p?this.gl.drawElements(i,n,_,s):S?this.gl2.drawArraysInstanced(i,s,n,w):this.gl.drawArrays(i,s,n)}),I&&I.end()}),!0)}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};cr.priority>=2&&Qj(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const r in t){const i=t[r],n=this._uniformSetters[r];if(n){let s=i,c=!1;if(s instanceof Ss&&(s=s.texture),s instanceof ym)if(c=this.uniforms[r]!==i,c){n.textureIndex===void 0&&(n.textureIndex=this._textureIndexCounter++);const a=s,{textureIndex:p}=n;a.bind(p),s=p,this._textureUniforms[r]=a}else s=n.textureIndex;else this._textureUniforms[r]&&delete this._textureUniforms[r];(n(s)||c)&&eU(this.uniforms,r,i)}}return this}_areTexturesRenderable(){let t=!0;for(const r in this._textureUniforms){const i=this._textureUniforms[r];i.update(),t=t&&i.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const r=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(r)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const r=this.gl.getAttachedShaders(t),i={};for(const n of r)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new s2({handle:n});break;case 35632:i.fs=new o2({handle:n});break}return i}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const r=this._getName();this.id=bh(r)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),cr.time(gC,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),cr.timeEnd(gC,"linkProgram for ".concat(this._getName()))(),t.debug||cr.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let r=0;r<this._uniformCount;r++){const i=this.gl.getActiveUniform(this.handle,r),{name:n}=Kj(i.name);let s=t.getUniformLocation(this.handle,n);if(this._uniformSetters[n]=pC(t,s,i),i.size>1)for(let c=0;c<i.size;c++)s=t.getUniformLocation(this.handle,"".concat(n,"[").concat(c,"]")),this._uniformSetters["".concat(n,"[").concat(c,"]")]=pC(t,s,i)}this._textureIndexCounter=0}getActiveUniforms(t,r){return this.gl2.getActiveUniforms(this.handle,t,r)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,r){return this.gl2.getActiveUniformBlockParameter(this.handle,t,r)}uniformBlockBinding(t,r){this.gl2.uniformBlockBinding(this.handle,t,r)}}const NU=34918,OU=34919,zU=35007,jU=36795,UU=35976,GU=35887,VU=36202;class P_ extends Ah{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=ri(t),n=w6(t,nn.TIMER_QUERY);let s=i||n;for(const c of r)switch(c){case"queries":s=s&&i;break;case"timers":s=s&&n;break;default:Ze(!1)}return s}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,r),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(zU)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(t?VU:GU)}beginTransformFeedbackQuery(){return this.begin(UU)}begin(t){return this._queryPending?this:(this.target=t,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,OU);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(jU)}getResult(){return this.gl2.getQueryParameter(this.handle,NU)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,n)=>{const s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>t?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return P_.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class C6 extends Ah{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(t){return ri(t)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Jo(t),super(t,r),this.initialize(r),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,gm(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const r in t)this.setBuffer(r,t[r])}),this}setBuffer(t,r){const i=this._getVaryingIndex(t),{buffer:n,byteSize:s,byteOffset:c}=this._getBufferParams(r);return i<0?(this.unused[t]=n,cr.warn("".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[i]=r,this.bindOnUse||this._bindBuffer(i,n,c,s),this)}begin(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let r,i,n;return t instanceof Wi?n=t:(n=t.buffer,i=t.byteSize,r=t.byteOffset),(r!==void 0||i!==void 0)&&(r=r||0,i=i||n.byteLength-r),{buffer:n,byteOffset:r,byteSize:i}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const r=Number(t);return Number.isFinite(r)?r:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:r,byteSize:i,byteOffset:n}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,r,n,i)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;const s=r&&r.handle;return!s||n===void 0?this.gl.bindBufferBase(35982,t,s):this.gl.bindBufferRange(35982,t,s,i,n),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}let W1=null;function qU(e){return(!W1||W1.byteLength<e)&&(W1=new ArrayBuffer(e)),W1}function HU(e,t){const r=qU(e.BYTES_PER_ELEMENT*t);return new e(r,0,t)}function $U(e){let{target:t,source:r,start:i=0,count:n=1}=e;const s=r.length,c=n*s;let a=0;for(let p=i;a<s;a++)t[p++]=r[a];for(;a<c;)a<c-a?(t.copyWithin(i+a,i,i+a),a*=2):(t.copyWithin(i+a,i,i+c-a),a=c);return t}const WU="elements must be GL.ELEMENT_ARRAY_BUFFER";class Qa extends Ah{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(t){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?ri(t)||XM()==="Chrome":!0}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new Qa(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return Qa.MAX_ATTRIBUTES=Qa.MAX_ATTRIBUTES||t.getParameter(34921),Qa.MAX_ATTRIBUTES}static setConstant(t,r,i){switch(i.constructor){case Float32Array:Qa._setConstantFloatArray(t,r,i);break;case Int32Array:Qa._setConstantIntArray(t,r,i);break;case Uint32Array:Qa._setConstantUintArray(t,r,i);break;default:Ze(!1)}}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=r.id||r.program&&r.program.id;super(t,Object.assign({},r,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=r.isDefaultArray||!1,this.gl2=t,this.initialize(r),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Qa.getMaxAttributes(this.gl)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(t)}setProps(t){return this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return Ze(!t||t.target===34963,WU),this.bind(()=>{this.gl.bindBuffer(34963,t?t.handle:null)}),this}setBuffer(t,r,i){if(r.target===34963)return this.setElementBuffer(r,i);const{size:n,type:s,stride:c,offset:a,normalized:p,integer:_,divisor:w}=i,{gl:S,gl2:C}=this;return t=Number(t),this.bind(()=>{S.bindBuffer(34962,r.handle),_?(Ze(ri(S)),C.vertexAttribIPointer(t,n,s,c,a)):S.vertexAttribPointer(t,n,s,p,c,a),S.enableVertexAttribArray(t),C.vertexAttribDivisor(t,w||0)}),this}enable(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!r&&t===0&&!Qa.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind(()=>r?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t))),this}getConstantBuffer(t,r){const i=this._normalizeConstantArrayValue(r),n=i.byteLength*t,s=i.length*t;let c=!this.buffer;if(this.buffer=this.buffer||new Wi(this.gl,n),c=c||this.buffer.reallocate(n),c=c||!this._compareConstantArrayValues(i,this.bufferValue),c){const a=HU(r.constructor,s);$U({target:a,source:i,start:0,count:s}),this.buffer.subData(a),this.bufferValue=r}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,r){if(!t||!r||t.length!==r.length||t.constructor!==r.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==r[i])return!1;return!0}static _setConstantFloatArray(t,r,i){switch(i.length){case 1:t.vertexAttrib1fv(r,i);break;case 2:t.vertexAttrib2fv(r,i);break;case 3:t.vertexAttrib3fv(r,i);break;case 4:t.vertexAttrib4fv(r,i);break;default:Ze(!1)}}static _setConstantIntArray(t,r,i){switch(Ze(ri(t)),i.length){case 1:t.vertexAttribI1iv(r,i);break;case 2:t.vertexAttribI2iv(r,i);break;case 3:t.vertexAttribI3iv(r,i);break;case 4:t.vertexAttribI4iv(r,i);break;default:Ze(!1)}}static _setConstantUintArray(t,r,i){switch(Ze(ri(t)),i.length){case 1:t.vertexAttribI1uiv(r,i);break;case 2:t.vertexAttribI2uiv(r,i);break;case 3:t.vertexAttribI3uiv(r,i);break;case 4:t.vertexAttribI4uiv(r,i);break;default:Ze(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,r){let{location:i}=r;return Ze(Number.isFinite(i)),this.bind(()=>{switch(t){case 34373:return this.gl.getVertexAttribOffset(i,t);default:return this.gl.getVertexAttrib(i,t)}})}}const XU="VertexArray: attributes must be Buffers or constants (i.e. typed array)",ZU=/^(.+)__LOCATION_([0-9]+)$/,YU=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class JU{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=r.id||r.program&&r.program.id;this.id=i,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Qa(t),f6(this,"VertexArray","v6.0",YU),this.initialize(r),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind(()=>{for(const r in t){const i=t[r];this._setAttribute(r,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=t,this.elementsAccessor=r,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,r),this}setBuffer(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(r.target===34963)return this.setElementBuffer(r,i);const{location:n,accessor:s}=this._resolveLocationAndAccessor(t,r,r.accessor,i);return n>=0&&(this.values[n]=r,this.accessors[n]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(n,r,s)),this}setConstant(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:n,accessor:s}=this._resolveLocationAndAccessor(t,r,Object.assign({size:r.length},i));return n>=0&&(r=this.vertexArrayObject._normalizeConstantArrayValue(r),this.values[n]=r,this.accessors[n]=s,this.clearDrawParams(),this.vertexArrayObject.enable(n,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Wi(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof Wi&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const r=this.values[t];r instanceof Wi&&this.setBuffer(t,r)}}),this}bindForDraw(t,r,i){let n;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(t,r),n=i()}),n}_resolveLocationAndAccessor(t,r,i,n){const s={location:-1,accessor:null},{location:c,name:a}=this._getAttributeIndex(t);if(!Number.isFinite(c)||c<0)return this.unused[t]=r,cr.once(3,()=>"unused value ".concat(t," in ").concat(this.id))(),s;const p=this._getAttributeInfo(a||c);if(!p)return s;const _=this.accessors[c]||{},w=va.resolve(p.accessor,_,i,n),{size:S,type:C}=w;return Ze(Number.isFinite(S)&&Number.isFinite(C)),{location:c,accessor:w}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const r=Number(t);if(Number.isFinite(r))return{location:r};const i=ZU.exec(t),n=i?i[1]:t,s=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(n)+s,name:n}:{location:-1}}_setAttribute(t,r){if(r instanceof Wi)this.setBuffer(t,r);else if(Array.isArray(r)&&r.length&&r[0]instanceof Wi){const i=r[0],n=r[1];this.setBuffer(t,i,n)}else if(ArrayBuffer.isView(r)||Array.isArray(r)){const i=r;this.setConstant(t,i)}else if(r.buffer instanceof Wi){const i=r;this.setBuffer(t,i.buffer,i)}else throw new Error(XU)}_setConstantAttributes(t,r){const i=Math.max(t|0,r|0);let n=this.values[0];ArrayBuffer.isView(n)&&this._setConstantAttributeZero(n,i);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)n=this.values[s],ArrayBuffer.isView(n)&&this._setConstantAttribute(s,n)}_setConstantAttributeZero(t,r){if(Qa.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,t);return}const i=this.vertexArrayObject.getConstantBuffer(r,t);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(t,r){Qa.setConstant(this.gl,t,r)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let r=0;r<this.vertexArrayObject.MAX_ATTRIBUTES;r++)this._updateDrawParamsForLocation(t,r);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,r){const i=this.values[r],n=this.accessors[r];if(!i)return;const{divisor:s}=n,c=s>0;if(t.isInstanced=t.isInstanced||c,i instanceof Wi){const a=i;if(c){const p=a.getVertexCount(n);t.instanceCount=Math.min(t.instanceCount,p)}else{const p=a.getVertexCount(n);t.vertexCount=Math.min(t.vertexCount,p)}}}setElements(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return cr.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,r)}}function KU(e,t){const{maxElts:r=16,size:i=1}=t;let n="[";for(let c=0;c<e.length&&c<r;++c)c>0&&(n+=",".concat(c%i===0?" ":"")),n+=T0(e[c],t);const s=e.length>r?"...":"]";return"".concat(n).concat(s)}function T0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=1e-16,{isInteger:i=!1}=t;if(Array.isArray(e)||ArrayBuffer.isView(e))return KU(e,t);if(!Number.isFinite(e))return String(e);if(Math.abs(e)<r)return i?"0":"0.";if(i||Math.abs(e)>100&&Math.abs(e)<1e4)return e.toFixed(0);const n=e.toPrecision(2);return n.indexOf(".0")===n.length-2?n.slice(0,-1):n}function yC(e){let{header:t="Uniforms",program:r,uniforms:i,undefinedOnly:n=!1}=e;Ze(r);const s=".*_.*",c=".*Matrix",a=r._uniformSetters,p={},_=Object.keys(a).sort();let w=0;for(const I of _)!I.match(s)&&!I.match(c)&&a2({table:p,header:t,uniforms:i,uniformName:I,undefinedOnly:n})&&w++;for(const I of _)I.match(c)&&a2({table:p,header:t,uniforms:i,uniformName:I,undefinedOnly:n})&&w++;for(const I of _)p[I]||a2({table:p,header:t,uniforms:i,uniformName:I,undefinedOnly:n})&&w++;let S=0;const C={};if(!n)for(const I in i){const N=i[I];p[I]||(S++,C[I]={Type:"NOT USED: ".concat(N),[t]:T0(N)})}return{table:p,count:w,unusedTable:C,unusedCount:S}}function a2(e){let{table:t,header:r,uniforms:i,uniformName:n,undefinedOnly:s}=e;const c=i[n],a=QU(c);return!s||!a?(t[n]={[r]:a?T0(c):"N/A","Uniform Type":a?c:"NOT PROVIDED"},!0):!1}function QU(e){return e!=null}function tG(e){let{vertexArray:t,header:r="Attributes"}=e;if(!t.configuration)return{};const i={};t.elements&&(i.ELEMENT_ARRAY_BUFFER=_C(t,t.elements,null,r));const n=t.values;for(const s in n){const c=t._getAttributeInfo(s);if(c){let a="".concat(s,": ").concat(c.name);const p=t.accessors[c.location];p&&(a="".concat(s,": ").concat(eG(c.name,p))),i[a]=_C(t,n[s],p,r)}}return i}function _C(e,t,r,i){const{gl:n}=e;if(!t)return{[i]:"null","Format ":"N/A"};let s="NOT PROVIDED",c=1,a=0,p=0,_,w,S;if(r&&(s=r.type,c=r.size,s=String(s).replace("Array",""),_=s.indexOf("nt")!==-1),t instanceof Wi){const C=t,{data:I,changed:N}=C.getDebugData();w=N?"*":"",S=I,p=C.byteLength,a=p/I.BYTES_PER_ELEMENT/c;let F;if(r){const W=r.divisor>0;F="".concat(W?"I ":"P "," ").concat(a," (x").concat(c,"=").concat(p," bytes ").concat(_d(n,s),")")}else _=!0,F="".concat(p," bytes");return{[i]:"".concat(w).concat(T0(S,{size:c,isInteger:_})),"Format ":F}}return S=t,c=t.length,s=String(t.constructor.name).replace("Array",""),_=s.indexOf("nt")!==-1,{[i]:"".concat(T0(S,{size:c,isInteger:_})," (constant)"),"Format ":"".concat(c,"x").concat(s," (constant)")}}function eG(e,t){const{type:r,size:i}=t,n=E6(r,i);return n?"".concat(e," (").concat(n.name,")"):e}function rG(e){const t={},r="Accessors for ".concat(e.id);for(const i of e.attributeInfos)if(i){const n=vC(i);t["in ".concat(n)]={[r]:JSON.stringify(i.accessor)}}for(const i of e.varyingInfos)if(i){const n=vC(i);t["out ".concat(n)]={[r]:JSON.stringify(i.accessor)}}return t}function vC(e){const{type:t,size:r}=e.accessor,i=E6(t,r);return i?"".concat(i.name," ").concat(e.name):e.name}const bC=Sh()&&typeof document<"u";let iG=0;class nG{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:r=W=>p6(W),onAddHTML:i=null,onInitialize:n=()=>{},onRender:s=()=>{},onFinalize:c=()=>{},onError:a,gl:p=null,glOptions:_={},debug:w=!1,createFramebuffer:S=!1,autoResizeViewport:C=!0,autoResizeDrawingBuffer:I=!0,stats:N=fp.get("animation-loop-".concat(iG++))}=t;let{useDevicePixels:F=!0}=t;"useDevicePixelRatio"in t&&(cr.deprecated("useDevicePixelRatio","useDevicePixels")(),F=t.useDevicePixelRatio),this.props={onCreateContext:r,onAddHTML:i,onInitialize:n,onRender:s,onFinalize:c,onError:a,gl:p,glOptions:_,debug:w,createFramebuffer:S},this.gl=p,this.needsRedraw=null,this.timeline=null,this.stats=N,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:C,autoResizeDrawingBuffer:I,useDevicePixels:F}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return Ze(typeof t=="string"),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const r=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=P_.isSupported(this.gl,["timers"])?new P_(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&r.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(t);return i?Number(i.value):r}setViewParameters(){return cr.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=bC?new Promise((t,r)=>{if(bC&&document.readyState==="complete"){t(document);return}window.addEventListener("load",()=>{t(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):hj(t)}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):uj(t)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:r,aspect:i}=this._getSizeAndAspect();(t!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=r,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){typeof t=="object"&&t!==null&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&typeof OffscreenCanvas<"u"&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?xS(this.props.gl,t):this.onCreateContext(t),!dv(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");J9(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(r);const i=this.props.onAddHTML(r);i&&(r.innerHTML=i)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,r=this.gl.drawingBufferHeight;let i=1;const{canvas:n}=this.gl;return n&&n.clientHeight?i=n.clientWidth/n.clientHeight:t>0&&r>0&&(i=t/r),{width:t,height:r,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&rj(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Ss(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}const Z0="vs",CS="fs";function sl(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const l2={number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},array:{validate(e,t){return Array.isArray(e)||ArrayBuffer.isView(e)}}};function sG(e){const t={};for(const r in e){const i=e[r],n=oG(i);t[r]=n}return t}function oG(e){let t=wC(e);return t==="object"?e?"type"in e?Object.assign({},e,l2[e.type]):"value"in e?(t=wC(e.value),Object.assign({type:t},e,l2[t])):{type:"object",value:e}:{type:"object",value:null}:Object.assign({type:t,value:e},l2[t])}function wC(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const aG="vs",lG="fs";class xC{constructor(t){let{name:r,vs:i,fs:n,dependencies:s=[],uniforms:c,getUniforms:a,deprecations:p=[],defines:_={},inject:w={},vertexShader:S,fragmentShader:C}=t;sl(typeof r=="string"),this.name=r,this.vs=i||S,this.fs=n||C,this.getModuleUniforms=a,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(p),this.defines=_,this.injections=cG(w),c&&(this.uniforms=sG(c))}getModuleSource(t){let r;switch(t){case aG:r=this.vs||"";break;case lG:r=this.fs||"";break;default:sl(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(r,"// END MODULE_").concat(this.name,`

`)}getUniforms(t,r){return this.getModuleUniforms?this.getModuleUniforms(t,r):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,r){this.deprecations.forEach(i=>{i.regex.test(t)&&(i.deprecated?r.deprecated(i.old,i.new)():r.removed(i.old,i.new)())})}_parseDeprecationDefinitions(t){return t.forEach(r=>{switch(r.type){case"function":r.regex=new RegExp("\\b".concat(r.old,"\\("));break;default:r.regex=new RegExp("".concat(r.type," ").concat(r.old,";"))}}),t}_defaultGetUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r={},i=this.uniforms;for(const n in i){const s=i[n];n in t&&!s.private?(s.validate&&sl(s.validate(t[n],s),"".concat(this.name,": invalid ").concat(n)),r[n]=t[n]):r[n]=s.value}return r}}function cG(e){const t={vs:{},fs:{}};for(const r in e){let i=e[r];const n=r.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),t[n][r]=i}return t}function uG(e){return hG(I6(e))}function hG(e){const t={},r={};return P6({modules:e,level:0,moduleMap:t,moduleDepth:r}),Object.keys(r).sort((i,n)=>r[n]-r[i]).map(i=>t[i])}function P6(e){let{modules:t,level:r,moduleMap:i,moduleDepth:n}=e;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)i[s.name]=s,(n[s.name]===void 0||n[s.name]<r)&&(n[s.name]=r);for(const s of t)s.dependencies&&P6({modules:s.dependencies,level:r+1,moduleMap:i,moduleDepth:n})}function I6(e,t){return e.map(r=>(r instanceof xC||(sl(typeof r!="string","Shader module use by name is deprecated. Import shader module '".concat(r,"' and use it directly.")),sl(r.name,"shader module has no name"),r=new xC(r),r.dependencies=I6(r.dependencies)),r))}function dG(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=typeof window<"u"?window.navigator||{}:{},r=e.userAgent||t.userAgent||"",i=r.indexOf("MSIE ")!==-1,n=r.indexOf("Trident/")!==-1;return i||n}const pG=7936,fG=7937,mG=7938,gG=35724,PS={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},sp={};Object.keys(PS).forEach(e=>{sp[e]=e});function yG(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}function _G(e){const t=e.getExtension("WEBGL_debug_renderer_info"),r=e.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||pG),i=e.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||fG);return{gpuVendor:vG(r,i),vendor:r,renderer:i,version:e.getParameter(mG),shadingLanguageVersion:e.getParameter(gG)}}function vG(e,t){return e.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":e.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":e.match(/AMD/i)||t.match(/AMD/i)||e.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const c2={};function SC(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=PS[t];if(sl(i,t),!dG(r))return!0;if(t in c2)return c2[t];const n=i[0],s=r.behavior||"enable",c="#extension GL_".concat(n," : ").concat(s,`
void main(void) {}`),a=e.createShader(35633);e.shaderSource(a,c),e.compileShader(a);const p=e.getShaderParameter(a,35713);return e.deleteShader(a),c2[t]=p,p}function bG(e,t){const r=PS[t];sl(r,t);const i=yG(e)&&r[1]||r[0],n=typeof i=="string"?!!e.getExtension(i):i;return sl(n===!1||n===!0),n}function X1(e,t){return t=Array.isArray(t)?t:[t],t.every(r=>bG(e,r))}function wG(e){switch(_G(e).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function xG(e,t,r){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return X1(e,sp.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),X1(e,sp.GLSL_DERIVATIVES)&&SC(e,sp.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),X1(e,sp.GLSL_FRAG_DATA)&&SC(e,sp.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),X1(e,sp.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const SG=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,AG=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,EG={[Z0]:SG,[CS]:AG},ky="__LUMA_INJECT_DECLARATIONS__",AC=/void\s+main\s*\([^)]*\)\s*\{\n?/,EC=/}\n?[^{}]*$/,u2=[];function TC(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const n=t===Z0;for(const s in r){const c=r[s];c.sort((p,_)=>p.order-_.order),u2.length=c.length;for(let p=0,_=c.length;p<_;++p)u2[p]=c[p].injection;const a="".concat(u2.join(`
`),`
`);switch(s){case"vs:#decl":n&&(e=e.replace(ky,a));break;case"vs:#main-start":n&&(e=e.replace(AC,p=>p+a));break;case"vs:#main-end":n&&(e=e.replace(EC,p=>a+p));break;case"fs:#decl":n||(e=e.replace(ky,a));break;case"fs:#main-start":n||(e=e.replace(AC,p=>p+a));break;case"fs:#main-end":n||(e=e.replace(EC,p=>a+p));break;default:e=e.replace(s,p=>p+a)}}return e=e.replace(ky,""),i&&(e=e.replace(/\}\s*$/,s=>s+EG[t])),e}function fx(e){const t={};return sl(Array.isArray(e)&&e.length>1),e.forEach(r=>{for(const i in r)t[i]=t[i]?"".concat(t[i],`
`).concat(r[i]):r[i]}),t}function _m(e){return new RegExp("\\b".concat(e,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const L6=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],TG=[...L6,[_m("attribute"),"in $1"],[_m("varying"),"out $1"]],CG=[...L6,[_m("varying"),"in $1"]],M6=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],PG=[...M6,[_m("in"),"attribute $1"],[_m("out"),"varying $1"]],IG=[...M6,[_m("in"),"varying $1"]],mx="gl_FragColor",gx=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,LG=/void\s+main\s*\([^)]*\)\s*\{\n?/;function MG(e,t,r){switch(t){case 300:return r?I_(e,TG):BG(e);case 100:return r?I_(e,PG):kG(e);default:throw new Error("unknown GLSL version ".concat(t))}}function I_(e,t){for(const[r,i]of t)e=e.replace(r,i);return e}function BG(e){e=I_(e,CG);const t=e.match(gx);if(t){const r=t[1];e=e.replace(new RegExp("\\b".concat(mx,"\\b"),"g"),r)}else{const r="fragmentColor";e=e.replace(LG,i=>"out vec4 ".concat(r,`;
`).concat(i)).replace(new RegExp("\\b".concat(mx,"\\b"),"g"),r)}return e}function kG(e){e=I_(e,IG);const t=e.match(gx);if(t){const r=t[1];e=e.replace(gx,"").replace(new RegExp("\\b".concat(r,"\\b"),"g"),mx)}return e}const RG=`

`.concat(ky,`

`),B6={[Z0]:"vertex",[CS]:"fragment"},FG=`precision highp float;

`;function DG(e,t){const{vs:r,fs:i}=t,n=uG(t.modules||[]);return{gl:e,vs:CC(e,Object.assign({},t,{source:r,type:Z0,modules:n})),fs:CC(e,Object.assign({},t,{source:i,type:CS,modules:n})),getUniforms:NG(n)}}function CC(e,t){let{id:r,source:i,type:n,modules:s,defines:c={},hookFunctions:a=[],inject:p={},transpileToGLSL100:_=!1,prologue:w=!0,log:S}=t;sl(typeof i=="string","shader source must be a string");const C=n===Z0,I=i.split(`
`);let N=100,F="",W=i;I[0].indexOf("#version ")===0?(N=300,F=I[0],W=I.slice(1).join(`
`)):F="#version ".concat(N);const U={};s.forEach(vt=>{Object.assign(U,vt.getDefines())}),Object.assign(U,c);let z=w?"".concat(F,`
`).concat(zG({id:r,source:i,type:n}),`
`).concat(OG({type:n}),`
`).concat(wG(e),`
`).concat(xG(e),`
`).concat(jG(U),`
`).concat(C?"":FG,`
`):"".concat(F,`
`);const H=GG(a),nt={},yt={},bt={};for(const vt in p){const mt=typeof p[vt]=="string"?{injection:p[vt],order:0}:p[vt],Dt=vt.match(/^(v|f)s:(#)?([\w-]+)$/);if(Dt){const kt=Dt[2],at=Dt[3];kt?at==="decl"?yt[vt]=[mt]:bt[vt]=[mt]:nt[vt]=[mt]}else bt[vt]=[mt]}for(const vt of s){S&&vt.checkDeprecations(W,S);const mt=vt.getModuleSource(n,N);z+=mt;const Dt=vt.injections[n];for(const kt in Dt){const at=kt.match(/^(v|f)s:#([\w-]+)$/);if(at){const dt=at[2]==="decl"?yt:bt;dt[kt]=dt[kt]||[],dt[kt].push(Dt[kt])}else nt[kt]=nt[kt]||[],nt[kt].push(Dt[kt])}}return z+=RG,z=TC(z,n,yt),z+=UG(H[n],nt),z+=W,z=TC(z,n,bt),z=MG(z,_?100:N,C),z}function NG(e){return function(t){const r={};for(const i of e){const n=i.getUniforms(t,r);Object.assign(r,n)}return r}}function OG(e){let{type:t}=e;return`
#define SHADER_TYPE_`.concat(B6[t].toUpperCase(),`
`)}function zG(e){let{id:t,source:r,type:i}=e;return t&&typeof t=="string"&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(t,"_").concat(B6[i],`

`):""}function jG(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=0,r="";for(const i in e){t===0&&(r+=`
// APPLICATION DEFINES
`),t++;const n=e[i];(n||Number.isFinite(n))&&(r+="#define ".concat(i.toUpperCase()," ").concat(e[i],`
`))}return t===0&&(r+=`
`),r}function UG(e,t){let r="";for(const i in e){const n=e[i];if(r+="void ".concat(n.signature,` {
`),n.header&&(r+="  ".concat(n.header)),t[i]){const s=t[i];s.sort((c,a)=>c.order-a.order);for(const c of s)r+="  ".concat(c.injection,`
`)}n.footer&&(r+="  ".concat(n.footer)),r+=`}
`}return r}function GG(e){const t={vs:{},fs:{}};return e.forEach(r=>{let i;typeof r!="string"?(i=r,r=i.hook):i={},r=r.trim();const[n,s]=r.split(":"),c=r.replace(/\(.+/,"");t[n][c]=Object.assign(i,{signature:s})}),t}const VG="void main() {gl_FragColor = vec4(0);}",k6=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,qG=`#version 300 es
`.concat(k6);function R6(e,t){t=Array.isArray(t)?t:[t];const r=e.replace(/^\s+/,"").split(/\s+/),[i,n,s]=r;if(!t.includes(i)||!n||!s)return null;const c=s.split(";")[0];return{qualifier:i,type:n,name:c}}function F6(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:t=100,input:r,inputType:i,output:n}=e;if(!r)return t===300?qG:t>300?"#version ".concat(t,`
`).concat(k6):VG;const s=WG(r,i);return t>=300?"#version ".concat(t," ").concat(t===300?"es":"",`
in `).concat(i," ").concat(r,`;
out vec4 `).concat(n,`;
void main() {
  `).concat(n," = ").concat(s,`;
}`):"varying ".concat(i," ").concat(r,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function HG(e){switch(e){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return sl(!1),null}}function $G(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return sl(!1),null}}function WG(e,t){switch(t){case"float":return"vec4(".concat(e,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(e,", 0.0, 1.0)");case"vec3":return"vec4(".concat(e,", 1.0)");case"vec4":return e;default:return sl(!1),null}}const XG=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,ZG={name:"fp32",vs:XG,fs:null};function yc(e,t){if(!e)throw new Error("math.gl assertion ".concat(t))}const YG=1/Math.PI*180,JG=1/180*Math.PI,xs={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function KG(e){let{precision:t=xs.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e=rV(e),"".concat(parseFloat(e.toPrecision(t)))}function Ad(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function QG(e){return eV(e)}function tV(e){return lh(e)}function eV(e,t){return IS(e,r=>r*JG,t)}function lh(e,t){return IS(e,r=>r*YG,t)}function ch(e,t,r){return IS(e,i=>Math.max(t,Math.min(r,i)))}function L_(e,t,r){return Ad(e)?e.map((i,n)=>L_(i,t[n],r)):r*t+(1-r)*e}function Sc(e,t,r){const i=xs.EPSILON;r&&(xs.EPSILON=r);try{if(e===t)return!0;if(Ad(e)&&Ad(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Sc(e[n],t[n]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=xs.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{xs.EPSILON=i}}function rV(e){return Math.round(e/xs.EPSILON)*xs.EPSILON}function iV(e){return e.clone?e.clone():new Array(e.length)}function IS(e,t,r){if(Ad(e)){const i=e;r=r||iV(i);for(let n=0;n<r.length&&n<i.length;++n)r[n]=t(e[n],n,r);return r}return t(e)}function nV(e){function t(){var r=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(r,Object.getPrototypeOf(this)),r}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}class LS extends nV(Array){clone(){return new this.constructor().copy(this)}fromArray(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let i=0;i<this.ELEMENTS;++i)this[i]=t[i+r];return this.check()}toArray(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let i=0;i<this.ELEMENTS;++i)t[r+i]=this[i];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:Ad(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(xs)}formatString(t){let r="";for(let i=0;i<this.ELEMENTS;++i)r+=(i>0?", ":"")+KG(this[i],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(r,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!Sc(this[r],t[r]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==t[r])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,r,i){if(i===void 0)return this.lerp(this,t,r);for(let n=0;n<this.ELEMENTS;++n){const s=t[n];this[n]=s+i*(r[n]-s)}return this.check()}min(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(t[r],this[r]);return this.check()}max(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(t[r],this[r]);return this.check()}clamp(t,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t[i]),r[i]);return this.check()}add(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(const n of r)for(let s=0;s<this.ELEMENTS;++s)this[s]+=n[s];return this.check()}subtract(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(const n of r)for(let s=0;s<this.ELEMENTS;++s)this[s]-=n[s];return this.check()}scale(t){if(typeof t=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;else for(let r=0;r<this.ELEMENTS&&r<t.length;++r)this[r]*=t[r];return this.check()}multiplyByScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}check(){if(xs.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)t=t&&Number.isFinite(this[r]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=t;return this.check()}addScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t),r);return this.check()}get elements(){return this}}function sV(e,t){if(e.length!==t)return!1;for(let r=0;r<e.length;++r)if(!Number.isFinite(e[r]))return!1;return!0}function Ci(e){if(!Number.isFinite(e))throw new Error("Invalid number ".concat(e));return e}function t0(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(xs.debug&&!sV(e,t))throw new Error("math.gl: ".concat(r," some fields set to invalid numbers'"));return e}class MS extends LS{get x(){return this[0]}set x(t){this[0]=Ci(t)}get y(){return this[1]}set y(t){this[1]=Ci(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*this[r];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let r=0;for(let i=0;i<this.ELEMENTS;++i){const n=this[i]-t[i];r+=n*n}return Ci(r)}dot(t){let r=0;for(let i=0;i<this.ELEMENTS;++i)r+=this[i]*t[i];return Ci(r)}normalize(){const t=this.magnitude();if(t!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t;return this.check()}multiply(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(const n of r)for(let s=0;s<this.ELEMENTS;++s)this[s]*=n[s];return this.check()}divide(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(const n of r)for(let s=0;s<this.ELEMENTS;++s)this[s]/=n[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return yc(t>=0&&t<this.ELEMENTS,"index is out of range"),Ci(this[t])}setComponent(t,r){return yc(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=r,this.check()}addVectors(t,r){return this.copy(t).add(r)}subVectors(t,r){return this.copy(t).subtract(r)}multiplyVectors(t,r){return this.copy(t).multiply(r)}addScaledVector(t,r){return this.add(new this.constructor(t).multiplyScalar(r))}}var e0=1e-6,Ec=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function oV(){var e=new Ec(2);return Ec!=Float32Array&&(e[0]=0,e[1]=0),e}function PC(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function aV(e,t){return e[0]=-t[0],e[1]=-t[1],e}function D6(e,t,r,i){var n=t[0],s=t[1];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e}function lV(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function cV(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function N6(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function O6(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}(function(){var e=oV();return function(t,r,i,n,s,c){var a,p;for(r||(r=2),i||(i=0),n?p=Math.min(n*r+i,t.length):p=t.length,a=i;a<p;a+=r)e[0]=t[a],e[1]=t[a+1],s(e,e,c),t[a]=e[0],t[a+1]=e[1];return t}})();function z6(e,t,r){const i=t[0],n=t[1],s=r[3]*i+r[7]*n||1;return e[0]=(r[0]*i+r[4]*n)/s,e[1]=(r[1]*i+r[5]*n)/s,e}function j6(e,t,r){const i=t[0],n=t[1],s=t[2],c=r[3]*i+r[7]*n+r[11]*s||1;return e[0]=(r[0]*i+r[4]*n+r[8]*s)/c,e[1]=(r[1]*i+r[5]*n+r[9]*s)/c,e[2]=(r[2]*i+r[6]*n+r[10]*s)/c,e}function uV(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e[2]=t[2],e}function hV(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e[2]=t[2],e[3]=t[3],e}function U6(e,t,r){const i=t[0],n=t[1],s=t[2];return e[0]=r[0]*i+r[3]*n+r[6]*s,e[1]=r[1]*i+r[4]*n+r[7]*s,e[2]=r[2]*i+r[5]*n+r[8]*s,e[3]=t[3],e}class BS extends MS{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),Ad(t)&&arguments.length===1?this.copy(t):(xs.debug&&(Ci(t),Ci(r)),this[0]=t,this[1]=r)}set(t,r){return this[0]=t,this[1]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return xs.debug&&(Ci(t.x),Ci(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return O6(this,this,t),this.check()}transformAsVector(t){return z6(this,this,t),this.check()}transformByMatrix3(t){return N6(this,this,t),this.check()}transformByMatrix2x3(t){return cV(this,this,t),this.check()}transformByMatrix2(t){return lV(this,this,t),this.check()}}function G6(){var e=new Ec(3);return Ec!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function V6(e){var t=e[0],r=e[1],i=e[2];return Math.hypot(t,r,i)}function IC(e,t,r){var i=new Ec(3);return i[0]=e,i[1]=t,i[2]=r,i}function dV(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function pV(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function fV(e,t){var r=t[0],i=t[1],n=t[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function kS(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ry(e,t,r){var i=t[0],n=t[1],s=t[2],c=r[0],a=r[1],p=r[2];return e[0]=n*p-s*a,e[1]=s*c-i*p,e[2]=i*a-n*c,e}function RS(e,t,r){var i=t[0],n=t[1],s=t[2],c=r[3]*i+r[7]*n+r[11]*s+r[15];return c=c||1,e[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/c,e[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/c,e[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/c,e}function q6(e,t,r){var i=t[0],n=t[1],s=t[2];return e[0]=i*r[0]+n*r[3]+s*r[6],e[1]=i*r[1]+n*r[4]+s*r[7],e[2]=i*r[2]+n*r[5]+s*r[8],e}function H6(e,t,r){var i=r[0],n=r[1],s=r[2],c=r[3],a=t[0],p=t[1],_=t[2],w=n*_-s*p,S=s*a-i*_,C=i*p-n*a,I=n*C-s*S,N=s*w-i*C,F=i*S-n*w,W=c*2;return w*=W,S*=W,C*=W,I*=2,N*=2,F*=2,e[0]=a+w+I,e[1]=p+S+N,e[2]=_+C+F,e}function mV(e,t,r,i){var n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function gV(e,t,r,i){var n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function yV(e,t,r,i){var n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function _V(e,t){var r=e[0],i=e[1],n=e[2],s=t[0],c=t[1],a=t[2],p=Math.sqrt(r*r+i*i+n*n),_=Math.sqrt(s*s+c*c+a*a),w=p*_,S=w&&kS(e,t)/w;return Math.acos(Math.min(Math.max(S,-1),1))}var vV=dV,bV=V6;(function(){var e=G6();return function(t,r,i,n,s,c){var a,p;for(r||(r=3),i||(i=0),n?p=Math.min(n*r+i,t.length):p=t.length,a=i;a<p;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],s(e,e,c),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}})();const h2=[0,0,0];let Z1;class te extends MS{static get ZERO(){return Z1||(Z1=new te(0,0,0),Object.freeze(Z1)),Z1}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&Ad(t)?this.copy(t):(xs.debug&&(Ci(t),Ci(r),Ci(i)),this[0]=t,this[1]=r,this[2]=i)}set(t,r,i){return this[0]=t,this[1]=r,this[2]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return xs.debug&&(Ci(t.x),Ci(t.y),Ci(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Ci(t)}angle(t){return _V(this,t)}cross(t){return Ry(this,this,t),this.check()}rotateX(t){let{radians:r,origin:i=h2}=t;return mV(this,this,i,r),this.check()}rotateY(t){let{radians:r,origin:i=h2}=t;return gV(this,this,i,r),this.check()}rotateZ(t){let{radians:r,origin:i=h2}=t;return yV(this,this,i,r),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return RS(this,this,t),this.check()}transformAsVector(t){return j6(this,this,t),this.check()}transformByMatrix3(t){return q6(this,this,t),this.check()}transformByMatrix2(t){return uV(this,this,t),this.check()}transformByQuaternion(t){return H6(this,this,t),this.check()}}let Y1;class FS extends MS{static get ZERO(){return Y1||(Y1=new FS(0,0,0,0),Object.freeze(Y1)),Y1}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),Ad(t)&&arguments.length===1?this.copy(t):(xs.debug&&(Ci(t),Ci(r),Ci(i),Ci(n)),this[0]=t,this[1]=r,this[2]=i,this[3]=n)}set(t,r,i,n){return this[0]=t,this[1]=r,this[2]=i,this[3]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return xs.debug&&(Ci(t.x),Ci(t.y),Ci(t.z),Ci(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=Ci(t)}get w(){return this[3]}set w(t){this[3]=Ci(t)}transform(t){return RS(this,this,t),this.check()}transformByMatrix3(t){return U6(this,this,t),this.check()}transformByMatrix2(t){return hV(this,this,t),this.check()}transformByQuaternion(t){return H6(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class $6 extends LS{toString(){let t="[";if(xs.printRowMajor){t+="row-major:";for(let r=0;r<this.RANK;++r)for(let i=0;i<this.RANK;++i)t+=" ".concat(this[i*this.RANK+r])}else{t+="column-major:";for(let r=0;r<this.ELEMENTS;++r)t+=" ".concat(this[r])}return t+="]",t}getElementIndex(t,r){return r*this.RANK+t}getElement(t,r){return this[r*this.RANK+t]}setElement(t,r,i){return this[r*this.RANK+t]=Ci(i),this}getColumn(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const i=t*this.RANK;for(let n=0;n<this.RANK;++n)r[n]=this[i+n];return r}setColumn(t,r){const i=t*this.RANK;for(let n=0;n<this.RANK;++n)this[i+n]=r[n];return this}}function wV(){var e=new Ec(9);return Ec!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function xV(e,t){if(e===t){var r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function SV(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],c=t[4],a=t[5],p=t[6],_=t[7],w=t[8],S=w*c-a*_,C=-w*s+a*p,I=_*s-c*p,N=r*S+i*C+n*I;return N?(N=1/N,e[0]=S*N,e[1]=(-w*i+n*_)*N,e[2]=(a*i-n*c)*N,e[3]=C*N,e[4]=(w*r-n*p)*N,e[5]=(-a*r+n*s)*N,e[6]=I*N,e[7]=(-_*r+i*p)*N,e[8]=(c*r-i*s)*N,e):null}function AV(e){var t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],c=e[5],a=e[6],p=e[7],_=e[8];return t*(_*s-c*p)+r*(-_*n+c*a)+i*(p*n-s*a)}function LC(e,t,r){var i=t[0],n=t[1],s=t[2],c=t[3],a=t[4],p=t[5],_=t[6],w=t[7],S=t[8],C=r[0],I=r[1],N=r[2],F=r[3],W=r[4],U=r[5],z=r[6],H=r[7],nt=r[8];return e[0]=C*i+I*c+N*_,e[1]=C*n+I*a+N*w,e[2]=C*s+I*p+N*S,e[3]=F*i+W*c+U*_,e[4]=F*n+W*a+U*w,e[5]=F*s+W*p+U*S,e[6]=z*i+H*c+nt*_,e[7]=z*n+H*a+nt*w,e[8]=z*s+H*p+nt*S,e}function EV(e,t,r){var i=t[0],n=t[1],s=t[2],c=t[3],a=t[4],p=t[5],_=t[6],w=t[7],S=t[8],C=r[0],I=r[1];return e[0]=i,e[1]=n,e[2]=s,e[3]=c,e[4]=a,e[5]=p,e[6]=C*i+I*c+_,e[7]=C*n+I*a+w,e[8]=C*s+I*p+S,e}function TV(e,t,r){var i=t[0],n=t[1],s=t[2],c=t[3],a=t[4],p=t[5],_=t[6],w=t[7],S=t[8],C=Math.sin(r),I=Math.cos(r);return e[0]=I*i+C*c,e[1]=I*n+C*a,e[2]=I*s+C*p,e[3]=I*c-C*i,e[4]=I*a-C*n,e[5]=I*p-C*s,e[6]=_,e[7]=w,e[8]=S,e}function MC(e,t,r){var i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function CV(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],c=r+r,a=i+i,p=n+n,_=r*c,w=i*c,S=i*a,C=n*c,I=n*a,N=n*p,F=s*c,W=s*a,U=s*p;return e[0]=1-S-N,e[3]=w-U,e[6]=C+W,e[1]=w+U,e[4]=1-_-N,e[7]=I-F,e[2]=C-W,e[5]=I+F,e[8]=1-_-S,e}var yx;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(yx||(yx={}));const PV=Object.freeze([1,0,0,0,1,0,0,0,1]);class jn extends $6{static get IDENTITY(){return LV()}static get ZERO(){return IV()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return yx}constructor(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):i.length>0?this.copy([t,...i]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(PV)}fromObject(t){return this.check()}fromQuaternion(t){return CV(this,t),this.check()}set(t,r,i,n,s,c,a,p,_){return this[0]=t,this[1]=r,this[2]=i,this[3]=n,this[4]=s,this[5]=c,this[6]=a,this[7]=p,this[8]=_,this.check()}setRowMajor(t,r,i,n,s,c,a,p,_){return this[0]=t,this[1]=n,this[2]=a,this[3]=r,this[4]=s,this[5]=p,this[6]=i,this[7]=c,this[8]=_,this.check()}determinant(){return AV(this)}transpose(){return xV(this,this),this.check()}invert(){return SV(this,this),this.check()}multiplyLeft(t){return LC(this,t,this),this.check()}multiplyRight(t){return LC(this,this,t),this.check()}rotate(t){return TV(this,this,t),this.check()}scale(t){return Array.isArray(t)?MC(this,this,t):MC(this,this,[t,t]),this.check()}translate(t){return EV(this,this,t),this.check()}transform(t,r){let i;switch(t.length){case 2:i=N6(r||[-0,-0],t,this);break;case 3:i=q6(r||[-0,-0,-0],t,this);break;case 4:i=U6(r||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return t0(i,t.length),i}transformVector(t,r){return this.transform(t,r)}transformVector2(t,r){return this.transform(t,r)}transformVector3(t,r){return this.transform(t,r)}}let J1,K1;function IV(){return J1||(J1=new jn([0,0,0,0,0,0,0,0,0]),Object.freeze(J1)),J1}function LV(){return K1||(K1=new jn,Object.freeze(K1)),K1}function MV(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function BV(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],s=t[6],c=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=n,e[13]=c,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function _x(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],c=t[4],a=t[5],p=t[6],_=t[7],w=t[8],S=t[9],C=t[10],I=t[11],N=t[12],F=t[13],W=t[14],U=t[15],z=r*a-i*c,H=r*p-n*c,nt=r*_-s*c,yt=i*p-n*a,bt=i*_-s*a,vt=n*_-s*p,mt=w*F-S*N,Dt=w*W-C*N,kt=w*U-I*N,at=S*W-C*F,dt=S*U-I*F,It=C*U-I*W,xt=z*It-H*dt+nt*at+yt*kt-bt*Dt+vt*mt;return xt?(xt=1/xt,e[0]=(a*It-p*dt+_*at)*xt,e[1]=(n*dt-i*It-s*at)*xt,e[2]=(F*vt-W*bt+U*yt)*xt,e[3]=(C*bt-S*vt-I*yt)*xt,e[4]=(p*kt-c*It-_*Dt)*xt,e[5]=(r*It-n*kt+s*Dt)*xt,e[6]=(W*nt-N*vt-U*H)*xt,e[7]=(w*vt-C*nt+I*H)*xt,e[8]=(c*dt-a*kt+_*mt)*xt,e[9]=(i*kt-r*dt-s*mt)*xt,e[10]=(N*bt-F*nt+U*z)*xt,e[11]=(S*nt-w*bt-I*z)*xt,e[12]=(a*Dt-c*at-p*mt)*xt,e[13]=(r*at-i*Dt+n*mt)*xt,e[14]=(F*H-N*yt-W*z)*xt,e[15]=(w*yt-S*H+C*z)*xt,e):null}function kV(e){var t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],c=e[5],a=e[6],p=e[7],_=e[8],w=e[9],S=e[10],C=e[11],I=e[12],N=e[13],F=e[14],W=e[15],U=t*c-r*s,z=t*a-i*s,H=t*p-n*s,nt=r*a-i*c,yt=r*p-n*c,bt=i*p-n*a,vt=_*N-w*I,mt=_*F-S*I,Dt=_*W-C*I,kt=w*F-S*N,at=w*W-C*N,dt=S*W-C*F;return U*dt-z*at+H*kt+nt*Dt-yt*mt+bt*vt}function xp(e,t,r){var i=t[0],n=t[1],s=t[2],c=t[3],a=t[4],p=t[5],_=t[6],w=t[7],S=t[8],C=t[9],I=t[10],N=t[11],F=t[12],W=t[13],U=t[14],z=t[15],H=r[0],nt=r[1],yt=r[2],bt=r[3];return e[0]=H*i+nt*a+yt*S+bt*F,e[1]=H*n+nt*p+yt*C+bt*W,e[2]=H*s+nt*_+yt*I+bt*U,e[3]=H*c+nt*w+yt*N+bt*z,H=r[4],nt=r[5],yt=r[6],bt=r[7],e[4]=H*i+nt*a+yt*S+bt*F,e[5]=H*n+nt*p+yt*C+bt*W,e[6]=H*s+nt*_+yt*I+bt*U,e[7]=H*c+nt*w+yt*N+bt*z,H=r[8],nt=r[9],yt=r[10],bt=r[11],e[8]=H*i+nt*a+yt*S+bt*F,e[9]=H*n+nt*p+yt*C+bt*W,e[10]=H*s+nt*_+yt*I+bt*U,e[11]=H*c+nt*w+yt*N+bt*z,H=r[12],nt=r[13],yt=r[14],bt=r[15],e[12]=H*i+nt*a+yt*S+bt*F,e[13]=H*n+nt*p+yt*C+bt*W,e[14]=H*s+nt*_+yt*I+bt*U,e[15]=H*c+nt*w+yt*N+bt*z,e}function M_(e,t,r){var i=r[0],n=r[1],s=r[2],c,a,p,_,w,S,C,I,N,F,W,U;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*s+t[12],e[13]=t[1]*i+t[5]*n+t[9]*s+t[13],e[14]=t[2]*i+t[6]*n+t[10]*s+t[14],e[15]=t[3]*i+t[7]*n+t[11]*s+t[15]):(c=t[0],a=t[1],p=t[2],_=t[3],w=t[4],S=t[5],C=t[6],I=t[7],N=t[8],F=t[9],W=t[10],U=t[11],e[0]=c,e[1]=a,e[2]=p,e[3]=_,e[4]=w,e[5]=S,e[6]=C,e[7]=I,e[8]=N,e[9]=F,e[10]=W,e[11]=U,e[12]=c*i+w*n+N*s+t[12],e[13]=a*i+S*n+F*s+t[13],e[14]=p*i+C*n+W*s+t[14],e[15]=_*i+I*n+U*s+t[15]),e}function DS(e,t,r){var i=r[0],n=r[1],s=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function RV(e,t,r,i){var n=i[0],s=i[1],c=i[2],a=Math.hypot(n,s,c),p,_,w,S,C,I,N,F,W,U,z,H,nt,yt,bt,vt,mt,Dt,kt,at,dt,It,xt,re;return a<e0?null:(a=1/a,n*=a,s*=a,c*=a,p=Math.sin(r),_=Math.cos(r),w=1-_,S=t[0],C=t[1],I=t[2],N=t[3],F=t[4],W=t[5],U=t[6],z=t[7],H=t[8],nt=t[9],yt=t[10],bt=t[11],vt=n*n*w+_,mt=s*n*w+c*p,Dt=c*n*w-s*p,kt=n*s*w-c*p,at=s*s*w+_,dt=c*s*w+n*p,It=n*c*w+s*p,xt=s*c*w-n*p,re=c*c*w+_,e[0]=S*vt+F*mt+H*Dt,e[1]=C*vt+W*mt+nt*Dt,e[2]=I*vt+U*mt+yt*Dt,e[3]=N*vt+z*mt+bt*Dt,e[4]=S*kt+F*at+H*dt,e[5]=C*kt+W*at+nt*dt,e[6]=I*kt+U*at+yt*dt,e[7]=N*kt+z*at+bt*dt,e[8]=S*It+F*xt+H*re,e[9]=C*It+W*xt+nt*re,e[10]=I*It+U*xt+yt*re,e[11]=N*It+z*xt+bt*re,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function W6(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[4],c=t[5],a=t[6],p=t[7],_=t[8],w=t[9],S=t[10],C=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+_*i,e[5]=c*n+w*i,e[6]=a*n+S*i,e[7]=p*n+C*i,e[8]=_*n-s*i,e[9]=w*n-c*i,e[10]=S*n-a*i,e[11]=C*n-p*i,e}function FV(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[0],c=t[1],a=t[2],p=t[3],_=t[8],w=t[9],S=t[10],C=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-_*i,e[1]=c*n-w*i,e[2]=a*n-S*i,e[3]=p*n-C*i,e[8]=s*i+_*n,e[9]=c*i+w*n,e[10]=a*i+S*n,e[11]=p*i+C*n,e}function X6(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[0],c=t[1],a=t[2],p=t[3],_=t[4],w=t[5],S=t[6],C=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+_*i,e[1]=c*n+w*i,e[2]=a*n+S*i,e[3]=p*n+C*i,e[4]=_*n-s*i,e[5]=w*n-c*i,e[6]=S*n-a*i,e[7]=C*n-p*i,e}function DV(e,t){var r=t[0],i=t[1],n=t[2],s=t[4],c=t[5],a=t[6],p=t[8],_=t[9],w=t[10];return e[0]=Math.hypot(r,i,n),e[1]=Math.hypot(s,c,a),e[2]=Math.hypot(p,_,w),e}function NV(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],c=r+r,a=i+i,p=n+n,_=r*c,w=i*c,S=i*a,C=n*c,I=n*a,N=n*p,F=s*c,W=s*a,U=s*p;return e[0]=1-S-N,e[1]=w+U,e[2]=C-W,e[3]=0,e[4]=w-U,e[5]=1-_-N,e[6]=I+F,e[7]=0,e[8]=C+W,e[9]=I-F,e[10]=1-_-S,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function OV(e,t,r,i,n,s,c){var a=1/(r-t),p=1/(n-i),_=1/(s-c);return e[0]=s*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*p,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(n+i)*p,e[10]=(c+s)*_,e[11]=-1,e[12]=0,e[13]=0,e[14]=c*s*2*_,e[15]=0,e}function zV(e,t,r,i,n){var s=1/Math.tan(t/2),c;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0?(c=1/(i-n),e[10]=(n+i)*c,e[14]=2*n*i*c):(e[10]=-1,e[14]=-2*i),e}var jV=zV;function UV(e,t,r,i,n,s,c){var a=1/(t-r),p=1/(i-n),_=1/(s-c);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*_,e[11]=0,e[12]=(t+r)*a,e[13]=(n+i)*p,e[14]=(c+s)*_,e[15]=1,e}var GV=UV;function VV(e,t,r,i){var n,s,c,a,p,_,w,S,C,I,N=t[0],F=t[1],W=t[2],U=i[0],z=i[1],H=i[2],nt=r[0],yt=r[1],bt=r[2];return Math.abs(N-nt)<e0&&Math.abs(F-yt)<e0&&Math.abs(W-bt)<e0?MV(e):(w=N-nt,S=F-yt,C=W-bt,I=1/Math.hypot(w,S,C),w*=I,S*=I,C*=I,n=z*C-H*S,s=H*w-U*C,c=U*S-z*w,I=Math.hypot(n,s,c),I?(I=1/I,n*=I,s*=I,c*=I):(n=0,s=0,c=0),a=S*c-C*s,p=C*n-w*c,_=w*s-S*n,I=Math.hypot(a,p,_),I?(I=1/I,a*=I,p*=I,_*=I):(a=0,p=0,_=0),e[0]=n,e[1]=a,e[2]=w,e[3]=0,e[4]=s,e[5]=p,e[6]=S,e[7]=0,e[8]=c,e[9]=_,e[10]=C,e[11]=0,e[12]=-(n*N+s*F+c*W),e[13]=-(a*N+p*F+_*W),e[14]=-(w*N+S*F+C*W),e[15]=1,e)}function qV(){var e=new Ec(4);return Ec!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function HV(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function Z6(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function $V(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.hypot(t,r,i,n)}function WV(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function XV(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],c=r*r+i*i+n*n+s*s;return c>0&&(c=1/Math.sqrt(c)),e[0]=r*c,e[1]=i*c,e[2]=n*c,e[3]=s*c,e}function ZV(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function YV(e,t,r,i){var n=t[0],s=t[1],c=t[2],a=t[3];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=c+i*(r[2]-c),e[3]=a+i*(r[3]-a),e}function Y0(e,t,r){var i=t[0],n=t[1],s=t[2],c=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*c,e[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*c,e[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*c,e[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*c,e}function JV(e,t,r){var i=t[0],n=t[1],s=t[2],c=r[0],a=r[1],p=r[2],_=r[3],w=_*i+a*s-p*n,S=_*n+p*i-c*s,C=_*s+c*n-a*i,I=-c*i-a*n-p*s;return e[0]=w*_+I*-c+S*-p-C*-a,e[1]=S*_+I*-a+C*-c-w*-p,e[2]=C*_+I*-p+w*-a-S*-c,e[3]=t[3],e}(function(){var e=qV();return function(t,r,i,n,s,c){var a,p;for(r||(r=4),i||(i=0),n?p=Math.min(n*r+i,t.length):p=t.length,a=i;a<p;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],s(e,e,c),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}})();var vx;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(vx||(vx={}));const KV=45*Math.PI/180,QV=1,d2=.1,p2=500,tq=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ui extends $6{static get IDENTITY(){return rq()}static get ZERO(){return eq()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return vx}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,r,i,n,s,c,a,p,_,w,S,C,I,N,F,W){return this[0]=t,this[1]=r,this[2]=i,this[3]=n,this[4]=s,this[5]=c,this[6]=a,this[7]=p,this[8]=_,this[9]=w,this[10]=S,this[11]=C,this[12]=I,this[13]=N,this[14]=F,this[15]=W,this.check()}setRowMajor(t,r,i,n,s,c,a,p,_,w,S,C,I,N,F,W){return this[0]=t,this[1]=s,this[2]=_,this[3]=I,this[4]=r,this[5]=c,this[6]=w,this[7]=N,this[8]=i,this[9]=a,this[10]=S,this[11]=F,this[12]=n,this[13]=p,this[14]=C,this[15]=W,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(tq)}fromObject(t){return this.check()}fromQuaternion(t){return NV(this,t),this.check()}frustum(t){const{left:r,right:i,bottom:n,top:s,near:c=d2,far:a=p2}=t;return a===1/0?iq(this,r,i,n,s,c):OV(this,r,i,n,s,c,a),this.check()}lookAt(t){const{eye:r,center:i=[0,0,0],up:n=[0,1,0]}=t;return VV(this,r,i,n),this.check()}ortho(t){const{left:r,right:i,bottom:n,top:s,near:c=d2,far:a=p2}=t;return GV(this,r,i,n,s,c,a),this.check()}orthographic(t){const{fovy:r=KV,aspect:i=QV,focalDistance:n=1,near:s=d2,far:c=p2}=t;BC(r);const a=r/2,p=n*Math.tan(a),_=p*i;return this.ortho({left:-_,right:_,bottom:-p,top:p,near:s,far:c})}perspective(t){const{fovy:r=45*Math.PI/180,aspect:i=1,near:n=.1,far:s=500}=t;return BC(r),jV(this,r,i,n,s),this.check()}determinant(){return kV(this)}getScale(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const i=this.getScale(r),n=1/i[0],s=1/i[1],c=1/i[2];return t[0]=this[0]*n,t[1]=this[1]*s,t[2]=this[2]*c,t[3]=0,t[4]=this[4]*n,t[5]=this[5]*s,t[6]=this[6]*c,t[7]=0,t[8]=this[8]*n,t[9]=this[9]*s,t[10]=this[10]*c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const i=this.getScale(r),n=1/i[0],s=1/i[1],c=1/i[2];return t[0]=this[0]*n,t[1]=this[1]*s,t[2]=this[2]*c,t[3]=this[4]*n,t[4]=this[5]*s,t[5]=this[6]*c,t[6]=this[8]*n,t[7]=this[9]*s,t[8]=this[10]*c,t}transpose(){return BV(this,this),this.check()}invert(){return _x(this,this),this.check()}multiplyLeft(t){return xp(this,t,this),this.check()}multiplyRight(t){return xp(this,this,t),this.check()}rotateX(t){return W6(this,this,t),this.check()}rotateY(t){return FV(this,this,t),this.check()}rotateZ(t){return X6(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,r){return RV(this,this,t,r),this.check()}scale(t){return DS(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return M_(this,this,t),this.check()}transform(t,r){return t.length===4?(r=Y0(r||[-0,-0,-0,-0],t,this),t0(r,4),r):this.transformAsPoint(t,r)}transformAsPoint(t,r){const{length:i}=t;let n;switch(i){case 2:n=O6(r||[-0,-0],t,this);break;case 3:n=RS(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return t0(n,t.length),n}transformAsVector(t,r){let i;switch(t.length){case 2:i=z6(r||[-0,-0],t,this);break;case 3:i=j6(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return t0(i,t.length),i}transformPoint(t,r){return this.transformAsPoint(t,r)}transformVector(t,r){return this.transformAsPoint(t,r)}transformDirection(t,r){return this.transformAsVector(t,r)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,r,i){return this.identity().translate([t,r,i])}}let Q1,ty;function eq(){return Q1||(Q1=new ui([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Q1)),Q1}function rq(){return ty||(ty=new ui,Object.freeze(ty)),ty}function BC(e){if(e>Math.PI*2)throw Error("expected radians")}function iq(e,t,r,i,n,s){const c=2*s/(r-t),a=2*s/(n-i),p=(r+t)/(r-t),_=(n+i)/(n-i),w=-1,S=-1,C=-2*s;return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=p,e[9]=_,e[10]=w,e[11]=S,e[12]=0,e[13]=0,e[14]=C,e[15]=0,e}function kC(){var e=new Ec(4);return Ec!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function nq(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Y6(e,t,r){r=r*.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function RC(e,t,r){var i=t[0],n=t[1],s=t[2],c=t[3],a=r[0],p=r[1],_=r[2],w=r[3];return e[0]=i*w+c*a+n*_-s*p,e[1]=n*w+c*p+s*a-i*_,e[2]=s*w+c*_+i*p-n*a,e[3]=c*w-i*a-n*p-s*_,e}function sq(e,t,r){r*=.5;var i=t[0],n=t[1],s=t[2],c=t[3],a=Math.sin(r),p=Math.cos(r);return e[0]=i*p+c*a,e[1]=n*p+s*a,e[2]=s*p-n*a,e[3]=c*p-i*a,e}function oq(e,t,r){r*=.5;var i=t[0],n=t[1],s=t[2],c=t[3],a=Math.sin(r),p=Math.cos(r);return e[0]=i*p-s*a,e[1]=n*p+c*a,e[2]=s*p+i*a,e[3]=c*p-n*a,e}function aq(e,t,r){r*=.5;var i=t[0],n=t[1],s=t[2],c=t[3],a=Math.sin(r),p=Math.cos(r);return e[0]=i*p+n*a,e[1]=n*p-i*a,e[2]=s*p+c*a,e[3]=c*p-s*a,e}function lq(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e}function Fy(e,t,r,i){var n=t[0],s=t[1],c=t[2],a=t[3],p=r[0],_=r[1],w=r[2],S=r[3],C,I,N,F,W;return I=n*p+s*_+c*w+a*S,I<0&&(I=-I,p=-p,_=-_,w=-w,S=-S),1-I>e0?(C=Math.acos(I),N=Math.sin(C),F=Math.sin((1-i)*C)/N,W=Math.sin(i*C)/N):(F=1-i,W=i),e[0]=F*n+W*p,e[1]=F*s+W*_,e[2]=F*c+W*w,e[3]=F*a+W*S,e}function cq(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],c=r*r+i*i+n*n+s*s,a=c?1/c:0;return e[0]=-r*a,e[1]=-i*a,e[2]=-n*a,e[3]=s*a,e}function uq(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function J6(e,t){var r=t[0]+t[4]+t[8],i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var s=(n+1)%3,c=(n+2)%3;i=Math.sqrt(t[n*3+n]-t[s*3+s]-t[c*3+c]+1),e[n]=.5*i,i=.5/i,e[3]=(t[s*3+c]-t[c*3+s])*i,e[s]=(t[s*3+n]+t[n*3+s])*i,e[c]=(t[c*3+n]+t[n*3+c])*i}return e}var hq=HV,dq=Z6,pq=ZV,fq=YV,mq=$V,gq=WV,K6=XV,yq=function(){var e=G6(),t=IC(1,0,0),r=IC(0,1,0);return function(i,n,s){var c=kS(n,s);return c<-.999999?(Ry(e,t,n),bV(e)<1e-6&&Ry(e,r,n),fV(e,e),Y6(i,e,Math.PI),i):c>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Ry(e,n,s),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+c,K6(i,i))}}();(function(){var e=kC(),t=kC();return function(r,i,n,s,c,a){return Fy(e,i,c,a),Fy(t,n,s,a),Fy(r,e,t,2*a*(1-a)),r}})();(function(){var e=wV();return function(t,r,i,n){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],K6(t,J6(t,e))}})();const _q=[0,0,0,1];class C0 extends LS{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,r,i,n)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,r,i,n){return this[0]=t,this[1]=r,this[2]=i,this[3]=n,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return J6(this,t),this.check()}fromAxisRotation(t,r){return Y6(this,t,r),this.check()}identity(){return nq(this),this.check()}setAxisAngle(t,r){return this.fromAxisRotation(t,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=Ci(t)}get y(){return this[1]}set y(t){this[1]=Ci(t)}get z(){return this[2]}set z(t){this[2]=Ci(t)}get w(){return this[3]}set w(t){this[3]=Ci(t)}len(){return mq(this)}lengthSquared(){return gq(this)}dot(t){return pq(this,t)}rotationTo(t,r){return yq(this,t,r),this.check()}add(t){return hq(this,this,t),this.check()}calculateW(){return lq(this,this),this.check()}conjugate(){return uq(this,this),this.check()}invert(){return cq(this,this),this.check()}lerp(t,r,i){return i===void 0?this.lerp(this,t,r):(fq(this,t,r,i),this.check())}multiplyRight(t){return RC(this,this,t),this.check()}multiplyLeft(t){return RC(this,t,this),this.check()}normalize(){const t=this.len(),r=t>0?1/t:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,t===0&&(this[3]=1),this.check()}rotateX(t){return sq(this,this,t),this.check()}rotateY(t){return oq(this,this,t),this.check()}rotateZ(t){return aq(this,this,t),this.check()}scale(t){return dq(this,this,t),this.check()}slerp(t,r,i){let n,s,c;switch(arguments.length){case 1:({start:n=_q,target:s,ratio:c}=t);break;case 2:n=this,s=t,c=r;break;default:n=t,s=r,c=i}return Fy(this,n,s,c),this.check()}transformVector4(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new FS;return JV(r,t,this),t0(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,r){return this.setAxisAngle(t,r)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const P0={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},FC=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,vq={lightSources:{}};function f2(){let{color:e=[0,0,0],intensity:t=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.map(r=>r*t/255)}function bq(e){let{ambientLight:t,pointLights:r=[],directionalLights:i=[]}=e;const n={};return t?n["lighting_uAmbientLight.color"]=f2(t):n["lighting_uAmbientLight.color"]=[0,0,0],r.forEach((s,c)=>{n["lighting_uPointLight[".concat(c,"].color")]=f2(s),n["lighting_uPointLight[".concat(c,"].position")]=s.position,n["lighting_uPointLight[".concat(c,"].attenuation")]=s.attenuation||[1,0,0]}),n.lighting_uPointLightCount=r.length,i.forEach((s,c)=>{n["lighting_uDirectionalLight[".concat(c,"].color")]=f2(s),n["lighting_uDirectionalLight[".concat(c,"].direction")]=s.direction}),n.lighting_uDirectionalLightCount=i.length,n}function Q6(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:vq;if("lightSources"in e){const{ambientLight:t,pointLights:r,directionalLights:i}=e.lightSources||{};return t||r&&r.length>0||i&&i.length>0?Object.assign({},bq({ambientLight:t,pointLights:r,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){const t={pointLights:[],directionalLights:[]};for(const r of e.lights||[])switch(r.type){case"ambient":t.ambientLight=r;break;case"directional":t.directionalLights.push(r);break;case"point":t.pointLights.push(r);break}return Q6({lightSources:t})}return{}}const NS={name:"lights",vs:FC,fs:FC,getUniforms:Q6,defines:{MAX_LIGHTS:3}},wq=new Uint8Array([0,255,255,255]),xq={pickingSelectedColor:null,pickingHighlightColor:wq,pickingActive:!1,pickingAttribute:!1};function Sq(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:xq;const t={};if(e.pickingSelectedColor!==void 0)if(!e.pickingSelectedColor)t.picking_uSelectedColorValid=0;else{const r=e.pickingSelectedColor.slice(0,3);t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=r}if(e.pickingHighlightColor){const r=Array.from(e.pickingHighlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),t.picking_uHighlightColor=r}return e.pickingActive!==void 0&&(t.picking_uActive=!!e.pickingActive,t.picking_uAttribute=!!e.pickingAttribute),t}const Aq=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,Eq=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,Tq={name:"picking",vs:Aq,fs:Eq,getUniforms:Sq},tB=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,Cq={};function Pq(e){const{ambient:t=.35,diffuse:r=.6,shininess:i=32,specularColor:n=[30,30,30]}=e;return{lighting_uAmbient:t,lighting_uDiffuse:r,lighting_uShininess:i,lighting_uSpecularColor:n.map(s=>s/255)}}function eB(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Cq;if(!("material"in e))return{};const{material:t}=e;return t?Pq(t):{lighting_uEnabled:!1}}const Iq={name:"gouraud-lighting",dependencies:[NS],vs:tB,defines:{LIGHTING_VERTEX:1},getUniforms:eB},Lq={name:"phong-lighting",dependencies:[NS],fs:tB,defines:{LIGHTING_FRAGMENT:1},getUniforms:eB},Mq=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,Bq=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,OS={name:"pbr",vs:Mq,fs:Bq,defines:{LIGHTING_FRAGMENT:1},dependencies:[NS]},kq=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,Rq={name:"transform",vs:kq,fs:null};class J0{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new J0(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find(r=>r.name===t.name)||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const r=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==r),this.stateHash++}addShaderHook(t,r){r&&(t=Object.assign(r,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:r="",fs:i="",defines:n={},inject:s={},varyings:c=[],bufferMode:a=35981,transpileToGLSL100:p=!1}=t,_=this._getModuleList(t.modules),w=this._getHash(r),S=this._getHash(i),C=_.map(H=>this._getHash(H.name)).sort(),I=c.map(H=>this._getHash(H)),N=Object.keys(n).sort(),F=Object.keys(s).sort(),W=[],U=[];for(const H of N)W.push(this._getHash(H)),W.push(this._getHash(n[H]));for(const H of F)U.push(this._getHash(H)),U.push(this._getHash(s[H]));const z="".concat(w,"/").concat(S,"D").concat(W.join("/"),"M").concat(C.join("/"),"I").concat(U.join("/"),"V").concat(I.join("/"),"H").concat(this.stateHash,"B").concat(a).concat(p?"T":"");if(!this._programCache[z]){const H=DG(this.gl,{vs:r,fs:i,modules:_,inject:s,defines:n,hookFunctions:this._hookFunctions,transpileToGLSL100:p});this._programCache[z]=new T6(this.gl,{hash:z,vs:H.vs,fs:H.fs,varyings:c,bufferMode:a}),this._getUniforms[z]=H.getUniforms||(nt=>{}),this._useCounts[z]=0}return this._useCounts[z]++,this._programCache[z]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const r=t.hash;this._useCounts[r]--,this._useCounts[r]===0&&(this._programCache[r].delete(),delete this._programCache[r],delete this._getUniforms[r],delete this._useCounts[r])}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const r=new Array(this._defaultModules.length+t.length),i={};let n=0;for(let s=0,c=this._defaultModules.length;s<c;++s){const a=this._defaultModules[s],p=a.name;r[n++]=a,i[p]=!0}for(let s=0,c=t.length;s<c;++s){const a=t[s],p=a.name;i[p]||(r[n++]=a,i[p]=!0)}return r.length=n,r}}const Fq={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Dq(e,t,r){const i={};let n=t.indices;for(const s in t.attributes){const c=t.attributes[s],a=Nq(s);if(s==="indices")n=c;else if(c.constant)i[a]=c.value;else{const p=c.value,_={...c};delete _.value,i[a]=[new Wi(e,p),_],Oq(s,_)}}if(n){const s=n.value||n;Ze(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const c={size:1,isIndexed:n.isIndexed===void 0?!0:n.isIndexed};i.indices=[new Wi(e,{data:s,target:34963}),c]}return i}function Nq(e,t){const{attributeMap:r=Fq}={};return r&&r[e]||e}function Oq(e,t){let r;switch(e){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":r="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":r="vectors";break}switch(r){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2;break}Ze(Number.isFinite(t.size),"attribute ".concat(e," needs size"))}const ff=2,zq=1e4,jq="Model needs drawMode and vertexCount",DC=()=>{},Uq={};class vm{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=bh("model")}=r;Ze(dv(t)),this.id=i,this.gl=t,this.id=r.id||bh("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(r)}initialize(t){this.props={},this.programManager=t.programManager||J0.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:r=null,vs:i,fs:n,modules:s,defines:c,inject:a,varyings:p,bufferMode:_,transpileToGLSL100:w}=t;this.programProps={program:r,vs:i,fs:n,modules:s,defines:c,inject:a,varyings:p,bufferMode:_,transpileToGLSL100:w},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=t.drawMode!==void 0?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},Ze(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),jq)}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:r,vs:i,fs:n,modules:s,defines:c,inject:a,varyings:p,bufferMode:_,transpileToGLSL100:w}=t;this.programProps={program:r,vs:i,fs:n,modules:s,defines:c,inject:a,varyings:p,bufferMode:_,transpileToGLSL100:w},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return Ze(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return Ze(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=Dq(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(gm(t))return this;const r={};for(const i in t){const n=t[i];r[i]=n.getValue?n.getValue():n}return this.vertexArray.setAttributes(r),this}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const r=this.programManager.getUniforms(this.program);return r?r(t):{}}updateModuleSettings(t){const r=this.getModuleUniforms(t||{});return this.setUniforms(r)}clear(t){return AS(this.program.gl,t),this}draw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:r=null,framebuffer:i,uniforms:n={},attributes:s={},transformFeedback:c=this.transformFeedback,parameters:a={},vertexArray:p=this.vertexArray}=t;this.setAttributes(s),this.updateModuleSettings(r),this.setUniforms(n);let _;cr.priority>=ff&&(_=this._logDrawCallStart(ff));const w=this.vertexArray.getDrawParams(),{isIndexed:S=w.isIndexed,indexType:C=w.indexType,indexOffset:I=w.indexOffset,vertexArrayInstanced:N=w.isInstanced}=this.props;N&&!this.isInstanced&&cr.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:F,instanceCount:W}=this,{onBeforeRender:U=DC,onAfterRender:z=DC}=this.props;U(),this.program.setUniforms(this.uniforms);const H=this.program.draw(Object.assign(Uq,t,{logPriority:_,uniforms:null,framebuffer:i,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:p,transformFeedback:c,isIndexed:S,indexType:C,isInstanced:F,instanceCount:W,offset:S?I:0}));return z(),cr.priority>=ff&&this._logDrawCallEnd(_,p,i),H}transform(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:r=!0,feedbackBuffers:i,unbindModels:n=[]}=t;let{parameters:s}=t;i&&this._setFeedbackBuffers(i),r&&(s=Object.assign({},s,{35977:r})),n.forEach(c=>c.vertexArray.unbindBuffers());try{this.draw(Object.assign({},t,{parameters:s}))}finally{n.forEach(c=>c.vertexArray.bindBuffers())}return this}render(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return cr.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:r,fs:i,modules:n,inject:s,defines:c,varyings:a,bufferMode:p,transpileToGLSL100:_}=this.programProps;t=this.programManager.get({vs:r,fs:i,modules:n,inject:s,defines:c,varyings:a,bufferMode:p,transpileToGLSL100:_}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Ze(t instanceof T6,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new JU(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const r=this.geometryBuffers[t][0]||this.geometryBuffers[t];r instanceof Wi&&r.delete()}}_setAnimationProps(t){this.animated&&Ze(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(gm(t))return this;const{gl:r}=this.program;return this.transformFeedback=this.transformFeedback||new C6(r,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const r=t>3?0:zq;if(!(Date.now()-this.lastLogTime<r))return this.lastLogTime=Date.now(),cr.group(ff,">>> DRAWING MODEL ".concat(this.id),{collapsed:cr.level<=2})(),t}_logDrawCallEnd(t,r,i,n){if(t===void 0)return;const s=tG({vertexArray:r,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:c,unusedTable:a,unusedCount:p}=yC({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:_,count:w}=yC({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});w>0&&cr.log("MISSING UNIFORMS",Object.keys(_))(),p>0&&cr.log("UNUSED UNIFORMS",Object.keys(a))();const S=rG(this.vertexArray.configuration);cr.table(t,s)(),cr.table(t,c)(),cr.table(t+1,S)(),n&&n.log({logLevel:ff,message:"Rendered to ".concat(n.id)}),cr.groupEnd(ff)()}}class Gq{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(r),Object.seal(this)}setupResources(t){for(const r of this.bindings)this._setupTransformFeedback(r,t)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:r}=this;return r.length>0&&(t=Object.assign({},t,{varyings:r})),t}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:n}=r;return{attributes:Object.assign({},i,t.attributes),transformFeedback:n}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:r}=this.bindings[this.currentIndex],i=t?r[t]:null;return i?i instanceof Wi?i:i.buffer:null}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:r}=t,i=this.getBuffer(r);return i?i.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Ze(ri(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:r={}}=t,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const n in this.feedbackMap){const s=this.feedbackMap[n];n in r&&(i[s]=n)}Object.assign(i,t.feedbackBuffers);for(const n in i){const s=i[n];if(typeof s=="string"){const c=r[s],{byteLength:a,usage:p,accessor:_}=c;i[n]=this._createNewBuffer(n,{byteLength:a,usage:p,accessor:_})}}return i}_setupBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:r=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const i=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:r,feedbackBuffers:i})}_setupTransformFeedback(t,r){let{model:i}=r;const{program:n}=i;t.transformFeedback=new C6(this.gl,{program:n,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:r,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceBuffers:r,feedbackBuffers:i})}}_updateBinding(t,r){return t?(Object.assign(t.sourceBuffers,r.sourceBuffers),Object.assign(t.feedbackBuffers,r.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},r.sourceBuffers),feedbackBuffers:Object.assign({},r.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const r=Object.assign({},t.sourceBuffers),i=Object.assign({},t.feedbackBuffers);for(const n in this.feedbackMap){const s=this.feedbackMap[n];r[n]=t.feedbackBuffers[s],i[s]=t.sourceBuffers[n],Ze(i[s]instanceof Wi)}return{sourceBuffers:r,feedbackBuffers:i}}_createNewBuffer(t,r){const i=new Wi(this.gl,r);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const Vq="transform_uSampler_",B_="transform_uSize_",NC="transform_position";function qq(e){let{vs:t,sourceTextureMap:r,targetTextureVarying:i,targetTexture:n}=e,s=Object.keys(r).length,c=null;const a={};let p=t,_={};if(s>0||i){const w=p.split(`
`),S=w.slice();if(w.forEach((C,I,N)=>{if(s>0){const F=Zq(C,r);if(F){const{updatedLine:W,inject:U}=F;S[I]=W,_=fx([_,U]),Object.assign(a,F.samplerTextureMap),s--}}i&&!c&&(c=Xq(C,i))}),i){Ze(n);const C="".concat(B_).concat(i),I="uniform vec2 ".concat(C,`;
`),N="     vec2 ".concat(NC," = transform_getPos(").concat(C,`);
     gl_Position = vec4(`).concat(NC,`, 0, 1.);
`);_=fx([_,{"vs:#decl":I,"vs:#main-start":N}])}p=S.join(`
`)}return{vs:p,targetTextureType:c,inject:_,samplerTextureMap:a}}function Hq(e){let{sourceTextureMap:t,targetTextureVarying:r,targetTexture:i}=e;const n={};let s,c;r&&({width:s,height:c}=i,n["".concat(B_).concat(r)]=[s,c]);for(const a in t)({width:s,height:c}=t[a]),n["".concat(B_).concat(a)]=[s,c];return n}function $q(e){return R6(e,["attribute","in"])}function Wq(e){const t="".concat(Vq).concat(e),r="".concat(B_).concat(e),i="  uniform sampler2D ".concat(t,`;
  uniform vec2 `).concat(r,";");return{samplerName:t,sizeName:r,uniformDeclerations:i}}function Xq(e,t){const r=R6(e,["varying","out"]);return r&&r.name===t?r.type:null}function Zq(e,t){const r={},i=$q(e);if(!i)return null;const{type:n,name:s}=i;if(s&&t[s]){const c="// ".concat(e," => Replaced by Transform with a sampler"),{samplerName:a,sizeName:p,uniformDeclerations:_}=Wq(s),w=HG(n),S="  ".concat(n," ").concat(s," = transform_getInput(").concat(a,", ").concat(p,").").concat(w,`;
`);return r[a]=s,{updatedLine:c,inject:{"vs:#decl":_,"vs:#main-start":S},samplerTextureMap:r}}return null}const Yq={10241:9728,10240:9728,10242:33071,10243:33071},Jq="transform_output";class Kq{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(r),Object.seal(this)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=this._processVertexShader(t);return Object.assign({},t,r)}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:r,sourceTextures:i,framebuffer:n,targetTexture:s}=this.bindings[this.currentIndex],c=Object.assign({},r,t.attributes),a=Object.assign({},t.uniforms),p=Object.assign({},t.parameters);let _=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){c.transform_elementID=this.elementIDBuffer;for(const S in this.samplerTextureMap){const C=this.samplerTextureMap[S];a[S]=i[C]}this._setSourceTextureParameters();const w=Hq({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(a,w)}return this.hasTargetTexture&&(_=!1,p.viewport=[0,0,n.width,n.height]),{attributes:c,framebuffer:n,uniforms:a,discard:_,parameters:p}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData(){let{packed:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:r}=this.bindings[this.currentIndex],i=fv(r);if(!t)return i;const n=i.constructor,s=$G(this.targetTextureType),c=new n(i.length*s/4);let a=0;for(let p=0;p<i.length;p+=4)for(let _=0;_<s;_++)c[a++]=i[p+_];return c}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:r,_swapTexture:i}=t;this._swapTexture=i,this.targetTextureVarying=r,this.hasTargetTexture=r,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:r,textureOrReference:i}=t;if(i instanceof ll)return i;const n=r[i];return n?(this._targetRefTexName=i,this._createNewTexture(n)):null}_setupTextures(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:r,_sourceTextures:i={},_targetTexture:n}=t,s=this._createTargetTexture({sourceTextures:i,textureOrReference:n});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:r,sourceTextures:i,targetTexture:s}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if(typeof t!="number"||this.elementCount>=t)return;const r=new Float32Array(t);r.forEach((i,n,s)=>{s[n]=n}),this.elementIDBuffer?this.elementIDBuffer.setData({data:r}):this.elementIDBuffer=new Wi(this.gl,{data:r,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:r,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceTextures:r,targetTexture:i})}}_updateBinding(t,r){const{sourceBuffers:i,sourceTextures:n,targetTexture:s}=r;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,n),Object.assign(t.sourceBuffers,i),s){t.targetTexture=s;const{width:c,height:a}=s,{framebuffer:p}=t;p?(p.update({attachments:{36064:s},resizeAttachments:!1}),p.resize({width:c,height:a})):t.framebuffer=new Ss(this.gl,{id:"transform-framebuffer",width:c,height:a,attachments:{36064:s}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:r}=this.bindings[t];for(const i in r)r[i].setParameters(Yq)}_swapTextures(t){if(!this._swapTexture)return null;const r=Object.assign({},t.sourceTextures);r[this._swapTexture]=t.targetTexture;const i=t.sourceTextures[this._swapTexture];return{sourceTextures:r,targetTexture:i}}_createNewTexture(t){const r=jj(t,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=r,r}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:r,targetTexture:i}=this.bindings[this.currentIndex],{vs:n,uniforms:s,targetTextureType:c,inject:a,samplerTextureMap:p}=qq({vs:t.vs,sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),_=fx([t.inject||{},a]);this.targetTextureType=c,this.samplerTextureMap=p;const w=t._fs||F6({version:A6(n),input:this.targetTextureVarying,inputType:c,output:Jq}),S=this.hasSourceTextures||this.targetTextureVarying?[Rq].concat(t.modules||[]):t.modules;return{vs:n,fs:w,modules:S,uniforms:s,inject:_}}}class zS{static isSupported(t){return ri(t)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(r),Object.seal(this)}delete(){const{model:t,bufferTransform:r,textureTransform:i}=this;t&&t.delete(),r&&r.delete(),i&&i.delete()}run(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:r=!0}=t,i=this._updateDrawOptions(t);r&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let t=!1;const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)t=t||i.swap();Ze(t,"Nothing to swap")}getBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r){const n=i.getData(t);if(n)return n}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)i.update(t)}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:r}=this;this._buildResourceTransforms(r,t),t=this._updateModelProps(t),this.model=new vm(r,Object.assign({},t,{fs:t.fs||F6({version:A6(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let r=Object.assign({},t);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of i)r=n.updateModelProps(r);return r}_buildResourceTransforms(t,r){Qq(r)&&(this.bufferTransform=new Gq(t,r)),tH(r)&&(this.textureTransform=new Kq(t,r)),Ze(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let r=Object.assign({},t);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of i)r=Object.assign(r,n.getDrawOptions(r));return r}}function Qq(e){return!!(!gm(e.feedbackBuffers)||!gm(e.feedbackMap)||e.varyings&&e.varyings.length>0)}function tH(e){return!!(!gm(e._sourceTextures)||e._targetTexture||e._targetTextureVarying)}const OC={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class r0{static get DRAW_MODE(){return OC}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:r=bh("geometry"),drawMode:i=OC.TRIANGLES,attributes:n={},indices:s=null,vertexCount:c=null}=t;this.id=r,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(n,s),this.vertexCount=c||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return"Geometry ".concat(this.id," attribute ").concat(t)}_setAttributes(t,r){r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r);for(const i in t){let n=t[i];n=ArrayBuffer.isView(n)?{value:n}:n,Ze(ArrayBuffer.isView(n.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!n.size&&(n.size=3),i==="indices"?(Ze(!this.indices),this.indices=n):this.attributes[i]=n}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,r){if(r)return r.value.length;let i=1/0;for(const n in t){const s=t[n],{value:c,size:a,constant:p}=s;!p&&c&&a>=1&&(i=Math.min(i,c.length/a))}return Ze(Number.isFinite(i)),i}}let eH=1,rH=1;class rB{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:r=0,duration:i=Number.POSITIVE_INFINITY,rate:n=1,repeat:s=1}=t,c=eH++,a={time:0,delay:r,duration:i,rate:n,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(c,a),c}removeChannel(t){this.channels.delete(t);for(const[r,i]of this.animations)i.channel===t&&this.detachAnimation(r)}isFinished(t){const r=this.channels.get(t);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(t){if(t===void 0)return this.time;const r=this.channels.get(t);return r===void 0?-1:r.time}setTime(t){this.time=Math.max(0,t);const r=this.channels.values();for(const n of r)this._setChannelTime(n,this.time);const i=this.animations.values();for(const n of i){const{animation:s,channel:c}=n;s.setTime(this.getTime(c))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,r){const i=rH++;return this.animations.set(i,{animation:t,channel:r}),t.setTime(this.getTime(r)),i}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,r){const i=r-t.delay,n=t.duration*t.repeat;i>=n?t.time=t.duration*t.rate:(t.time=Math.max(0,i)%t.duration,t.time*=t.rate)}}const iH=[255,255,255],nH=1;let sH=0;class iB{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};q(this,"id",void 0),q(this,"color",void 0),q(this,"intensity",void 0),q(this,"type","ambient");const{color:r=iH}=t,{intensity:i=nH}=t;this.id=t.id||"ambient-".concat(sH++),this.color=r,this.intensity=i}}const oH=[255,255,255],aH=1,lH=[0,0,-1];let cH=0;class zC{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};q(this,"id",void 0),q(this,"color",void 0),q(this,"intensity",void 0),q(this,"type","directional"),q(this,"direction",void 0),q(this,"shadow",void 0);const{color:r=oH}=t,{intensity:i=aH}=t,{direction:n=lH}=t,{_shadow:s=!1}=t;this.id=t.id||"directional-".concat(cH++),this.color=r,this.intensity=i,this.type="directional",this.direction=new te(n).normalize().toArray(),this.shadow=s}getProjectedLight(t){return this}}class uH{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};q(this,"id",void 0),q(this,"gl",void 0),q(this,"props",void 0);const{id:i}=r;this.id=i,this.gl=t,this.props={...r}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class jS extends uH{constructor(){super(...arguments),q(this,"_lastRenderIndex",-1)}render(t){const r=this.gl;return vh(r,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{target:r,moduleParameters:i,viewports:n,views:s,onViewportActive:c,clearStack:a=!0,clearCanvas:p=!0}=t;t.pass=t.pass||"unknown";const _=this.gl;p&&dH(_,r),a&&(this._lastRenderIndex=-1);const w=[];for(const S of n){const C=s&&s[S.id];c==null||c(S);const I=this._getDrawLayerParams(S,t),N=S.subViewports||[S];for(const F of N){const W=this._drawLayersInViewport(_,{target:r,moduleParameters:i,viewport:F,view:C,pass:t.pass,layers:t.layers},I);w.push(W)}}return w}_getDrawLayerParams(t,r){let{layers:i,pass:n,isPicking:s=!1,layerFilter:c,cullRect:a,effects:p,moduleParameters:_}=r,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const S=[],C=nB(this._lastRenderIndex+1),I={layer:i[0],viewport:t,isPicking:s,renderPass:n,cullRect:a},N={};for(let F=0;F<i.length;F++){const W=i[F],U=this._shouldDrawLayer(W,I,c,N),z={shouldDrawLayer:U};U&&!w&&(z.layerRenderIndex=C(W,U),z.moduleParameters=this._getModuleParameters(W,p,n,_),z.layerParameters=this.getLayerParameters(W,F,t)),S[F]=z}return S}_drawLayersInViewport(t,r,i){let{layers:n,moduleParameters:s,pass:c,target:a,viewport:p,view:_}=r;const w=hH(t,{moduleParameters:s,target:a,viewport:p});if(_&&_.props.clear){const C=_.props.clear===!0?{color:!0,depth:!0}:_.props.clear;xc(t,{scissorTest:!0,scissor:w},()=>AS(t,C))}const S={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};vh(t,{viewport:w});for(let C=0;C<n.length;C++){const I=n[C],{shouldDrawLayer:N,layerRenderIndex:F,moduleParameters:W,layerParameters:U}=i[C];if(N&&I.props.pickable&&S.pickableCount++,I.isComposite)S.compositeCount++;else if(N){S.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,F),W.viewport=p;try{I._drawLayer({moduleParameters:W,uniforms:{layerIndex:F},parameters:U})}catch(z){I.raiseError(z,"drawing ".concat(I," to ").concat(c))}}}return S}shouldDrawLayer(t){return!0}getModuleParameters(t,r){return null}getLayerParameters(t,r,i){return t.props.parameters}_shouldDrawLayer(t,r,i,n){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;r.layer=t;let s=t.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(r))return!1;r.layer=s,s=s.parent}if(i){const c=r.layer.id;if(c in n||(n[c]=i(r)),!n[c])return!1}return t.activateViewport(r.viewport),!0}_getModuleParameters(t,r,i,n){var s;const c=Object.assign(Object.create(((s=t.internalState)===null||s===void 0?void 0:s.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:mm(this.gl)});if(r)for(const p of r){var a;Object.assign(c,(a=p.getModuleParameters)===null||a===void 0?void 0:a.call(p,t))}return Object.assign(c,this.getModuleParameters(t,r),n)}}function nB(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r={},i=(n,s)=>{const c=n.props._offset,a=n.id,p=n.parent&&n.parent.id;let _;if(p&&!(p in t)&&i(n.parent,!1),p in r){const w=r[p]=r[p]||nB(t[p],t);_=w(n,s),r[a]=w}else Number.isFinite(c)?(_=c+(t[p]||0),r[a]=null):_=e;return s&&_>=e&&(e=_+1),t[a]=_,_};return i}function hH(e,t){let{moduleParameters:r,target:i,viewport:n}=t;const s=i&&i.id!=="default-framebuffer",c=r&&r.devicePixelRatio||mm(e),a=s?i.height:e.drawingBufferHeight,p=n;return[p.x*c,a-(p.y+p.height)*c,p.width*c,p.height*c]}function dH(e,t){const r=t?t.width:e.drawingBufferWidth,i=t?t.height:e.drawingBufferHeight;vh(e,{viewport:[0,0,r,i]}),e.clear(16640)}class pH extends jS{constructor(t,r){super(t,r),q(this,"shadowMap",void 0),q(this,"depthBuffer",void 0),q(this,"fbo",void 0),this.shadowMap=new ll(t,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new zf(t,{format:33189,width:1,height:1}),this.fbo=new Ss(t,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(t){const r=this.fbo;xc(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=t.viewports[0],n=mm(this.gl),s=i.width*n,c=i.height*n;(s!==r.width||c!==r.height)&&r.resize({width:s,height:c}),super.render({...t,target:r,pass:"shadow"})})}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const sB="#define SMOOTH_EDGE_RADIUS 0.5",fH=`
`.concat(sB,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),mH=`
`.concat(sB,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),gH={name:"geometry",vs:fH,fs:mH},yH=Object.keys(hi).map(e=>"const int COORDINATE_SYSTEM_".concat(e," = ").concat(hi[e],";")).join(""),_H=Object.keys(bu).map(e=>"const int PROJECTION_MODE_".concat(e," = ").concat(bu[e],";")).join(""),vH=Object.keys(cx).map(e=>"const int UNIT_".concat(e.toUpperCase()," = ").concat(cx[e],";")).join(""),bH="".concat(yH,`
`).concat(_H,`
`).concat(vH,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function wH(e,t){if(e===t)return!0;if(Array.isArray(e)){const r=e.length;if(!t||t.length!==r)return!1;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}return!1}function K0(e){let t={},r;return i=>{for(const n in i)if(!wH(i[n],t[n])){r=e(i),t=i;break}return r}}const jC=[0,0,0,0],xH=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],oB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],SH=[0,0,0],aB=[0,0,0],AH=K0(CH);function lB(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:aB;r.length<3&&(r=[r[0],r[1],0]);let i=r,n,s=!0;switch(t===hi.LNGLAT_OFFSETS||t===hi.METER_OFFSETS?n=r:n=e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case bu.WEB_MERCATOR:(t===hi.LNGLAT||t===hi.CARTESIAN)&&(n=[0,0,0],s=!1);break;case bu.WEB_MERCATOR_AUTO_OFFSET:t===hi.LNGLAT?i=n:t===hi.CARTESIAN&&(i=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],n=e.unprojectPosition(i),i[0]-=r[0],i[1]-=r[1],i[2]-=r[2]);break;case bu.IDENTITY:i=e.position.map(Math.fround),i[2]=i[2]||0;break;case bu.GLOBE:s=!1,n=null;break;default:s=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:i,offsetMode:s}}function EH(e,t,r){const{viewMatrixUncentered:i,projectionMatrix:n}=e;let{viewMatrix:s,viewProjectionMatrix:c}=e,a=jC,p=jC,_=e.cameraPosition;const{geospatialOrigin:w,shaderCoordinateOrigin:S,offsetMode:C}=lB(e,t,r);return C&&(p=e.projectPosition(w||S),_=[_[0]-p[0],_[1]-p[1],_[2]-p[2]],p[3]=1,a=Y0([],p,c),s=i||s,c=xp([],n,s),c=xp([],c,xH)),{viewMatrix:s,viewProjectionMatrix:c,projectionCenter:a,originCommon:p,cameraPosCommon:_,shaderCoordinateOrigin:S,geospatialOrigin:w}}function TH(e){let{viewport:t,devicePixelRatio:r=1,modelMatrix:i=null,coordinateSystem:n=hi.DEFAULT,coordinateOrigin:s=aB,autoWrapLongitude:c=!1}=e;n===hi.DEFAULT&&(n=t.isGeospatial?hi.LNGLAT:hi.CARTESIAN);const a=AH({viewport:t,devicePixelRatio:r,coordinateSystem:n,coordinateOrigin:s});return a.project_uWrapLongitude=c,a.project_uModelMatrix=i||oB,a}function CH(e){let{viewport:t,devicePixelRatio:r,coordinateSystem:i,coordinateOrigin:n}=e;const{projectionCenter:s,viewProjectionMatrix:c,originCommon:a,cameraPosCommon:p,shaderCoordinateOrigin:_,geospatialOrigin:w}=EH(t,i,n),S=t.getDistanceScales(),C=[t.width*r,t.height*r],I=Y0([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,N={project_uCoordinateSystem:i,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:_,project_uCommonOrigin:a.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:C,project_uDevicePixelRatio:r,project_uFocalDistance:I,project_uCommonUnitsPerMeter:S.unitsPerMeter,project_uCommonUnitsPerWorldUnit:S.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:SH,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:c,project_uModelMatrix:oB,project_uCameraPosition:p};if(w){const F=t.getDistanceScales(w);switch(i){case hi.METER_OFFSETS:N.project_uCommonUnitsPerWorldUnit=F.unitsPerMeter,N.project_uCommonUnitsPerWorldUnit2=F.unitsPerMeter2;break;case hi.LNGLAT:case hi.LNGLAT_OFFSETS:t._pseudoMeters||(N.project_uCommonUnitsPerMeter=F.unitsPerMeter),N.project_uCommonUnitsPerWorldUnit=F.unitsPerDegree,N.project_uCommonUnitsPerWorldUnit2=F.unitsPerDegree2;break;case hi.CARTESIAN:N.project_uCommonUnitsPerWorldUnit=[1,1,F.unitsPerMeter[2]],N.project_uCommonUnitsPerWorldUnit2=[0,0,F.unitsPerMeter2[2]];break}}return N}const PH={};function IH(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:PH;return"viewport"in e?TH(e):{}}const US={name:"project",dependencies:[ZG,gH],vs:bH,getUniforms:IH};function LH(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Jf(e,t){const r=Y0([],t,e);return Z6(r,r,1/r[3]),r}function UC(e,t){const r=e%t;return r<0?t+r:r}function bx(e,t,r){return e<t?t:e>r?r:e}function MH(e){return Math.log(e)*Math.LOG2E}const GS=Math.log2||MH;function wh(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const _c=Math.PI,cB=_c/4,Ul=_c/180,wx=180/_c,bm=512,k_=4003e4,ey=85.051129,BH=1.5;function kH(e){return GS(e)}function I0(e){const[t,r]=e;wh(Number.isFinite(t)),wh(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const i=t*Ul,n=r*Ul,s=bm*(i+_c)/(2*_c),c=bm*(_c+Math.log(Math.tan(cB+n*.5)))/(2*_c);return[s,c]}function wm(e){const[t,r]=e,i=t/bm*(2*_c)-_c,n=2*(Math.atan(Math.exp(r/bm*(2*_c)-_c))-cB);return[i*wx,n*wx]}function RH(e){const{latitude:t}=e;wh(Number.isFinite(t));const r=Math.cos(t*Ul);return kH(k_*r)-9}function Dy(e){const t=Math.cos(e*Ul);return bm/k_/t}function xx(e){const{latitude:t,longitude:r,highPrecision:i=!1}=e;wh(Number.isFinite(t)&&Number.isFinite(r));const n=bm,s=Math.cos(t*Ul),c=n/360,a=c/s,p=n/k_/s,_={unitsPerMeter:[p,p,p],metersPerUnit:[1/p,1/p,1/p],unitsPerDegree:[c,a,p],degreesPerUnit:[1/c,1/a,1/p]};if(i){const w=Ul*Math.tan(t*Ul)/s,S=c*w/2,C=n/k_*w,I=C/a*p;_.unitsPerDegree2=[0,S,C],_.unitsPerMeter2=[I,0,I]}return _}function uB(e,t){const[r,i,n]=e,[s,c,a]=t,{unitsPerMeter:p,unitsPerMeter2:_}=xx({longitude:r,latitude:i,highPrecision:!0}),w=I0(e);w[0]+=s*(p[0]+_[0]*c),w[1]+=c*(p[1]+_[1]*c);const S=wm(w),C=(n||0)+(a||0);return Number.isFinite(n)||Number.isFinite(a)?[S[0],S[1],C]:S}function FH(e){const{height:t,pitch:r,bearing:i,altitude:n,scale:s,center:c}=e,a=LH();M_(a,a,[0,0,-n]),W6(a,a,-r*Ul),X6(a,a,i*Ul);const p=s/t;return DS(a,a,[p,p,p]),c&&M_(a,a,pV([],c)),a}function DH(e){const{width:t,height:r,altitude:i,pitch:n=0,offset:s,center:c,scale:a,nearZMultiplier:p=1,farZMultiplier:_=1}=e;let{fovy:w=R_(BH)}=e;i!==void 0&&(w=R_(i));const S=w*Ul,C=n*Ul,I=hB(w);let N=I;c&&(N+=c[2]*a/Math.cos(C)/r);const F=S*(.5+(s?s[1]:0)/r),W=Math.sin(F)*N/Math.sin(bx(Math.PI/2-C-F,.01,Math.PI-.01)),U=Math.sin(C)*W+N,z=N*10,H=Math.min(U*_,z);return{fov:S,aspect:t/r,focalDistance:I,near:p,far:H}}function R_(e){return 2*Math.atan(.5/e)*wx}function hB(e){return .5/Math.tan(.5*e*Ul)}function dB(e,t){const[r,i,n=0]=e;return wh(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(n)),Jf(t,[r,i,n,1])}function VS(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[i,n,s]=e;if(wh(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(s))return Jf(t,[i,n,s,1]);const c=Jf(t,[i,n,0,1]),a=Jf(t,[i,n,1,1]),p=c[2],_=a[2],w=p===_?0:((r||0)-p)/(_-p);return D6([],c,a,w)}function NH(e){const{width:t,height:r,bounds:i,minExtent:n=0,maxZoom:s=24,offset:c=[0,0]}=e,[[a,p],[_,w]]=i,S=OH(e.padding),C=I0([a,bx(w,-ey,ey)]),I=I0([_,bx(p,-ey,ey)]),N=[Math.max(Math.abs(I[0]-C[0]),n),Math.max(Math.abs(I[1]-C[1]),n)],F=[t-S.left-S.right-Math.abs(c[0])*2,r-S.top-S.bottom-Math.abs(c[1])*2];wh(F[0]>0&&F[1]>0);const W=F[0]/N[0],U=F[1]/N[1],z=(S.right-S.left)/2/W,H=(S.top-S.bottom)/2/U,nt=[(I[0]+C[0])/2+z,(I[1]+C[1])/2+H],yt=wm(nt),bt=Math.min(s,GS(Math.abs(Math.min(W,U))));return wh(Number.isFinite(bt)),{longitude:yt[0],latitude:yt[1],zoom:bt}}function OH(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(wh(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}const GC=Math.PI/180;function zH(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:r,height:i,unproject:n}=e,s={targetZ:t},c=n([0,i],s),a=n([r,i],s);let p,_;const w=e.fovy?.5*e.fovy*GC:Math.atan(.5/e.altitude),S=(90-e.pitch)*GC;return w>S-.01?(p=VC(e,0,t),_=VC(e,r,t)):(p=n([0,0],s),_=n([r,0],s)),[c,a,_,p]}function VC(e,t,r){const{pixelUnprojectionMatrix:i}=e,n=Jf(i,[t,0,1,1]),s=Jf(i,[t,e.height,1,1]),c=(r*e.distanceScales.unitsPerMeter[2]-n[2])/(s[2]-n[2]),a=D6([],n,s,c),p=wm(a);return p.push(r),p}const qC=512;function jH(e){const{width:t,height:r,pitch:i=0}=e;let{longitude:n,latitude:s,zoom:c,bearing:a=0}=e;(n<-180||n>180)&&(n=UC(n+180,360)-180),(a<-180||a>180)&&(a=UC(a+180,360)-180);const p=GS(r/qC);if(c<=p)c=p,s=0;else{const _=r/2/Math.pow(2,c),w=wm([0,_])[1];if(s<w)s=w;else{const S=wm([0,qC-_])[1];s>S&&(s=S)}}return{width:t,height:r,longitude:n,latitude:s,zoom:c,pitch:i,bearing:a}}const UH=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,GH=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,VH=K0(XH),qH=K0(ZH),HH=[0,0,0,1],$H=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function WH(e,t){const[r,i,n]=e,s=VS([r,i,n],t);return Number.isFinite(n)?s:[s[0],s[1],0]}function XH(e){let{viewport:t,center:r}=e;return new ui(t.viewProjectionMatrix).invert().transform(r)}function ZH(e){let{viewport:t,shadowMatrices:r}=e;const i=[],n=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,c=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(a=>WH(a,n));for(const a of r){const p=a.clone().translate(new te(t.center).negate()),_=c.map(S=>p.transform(S)),w=new ui().ortho({left:Math.min(..._.map(S=>S[0])),right:Math.max(..._.map(S=>S[0])),bottom:Math.min(..._.map(S=>S[1])),top:Math.max(..._.map(S=>S[1])),near:Math.min(..._.map(S=>-S[2])),far:Math.max(..._.map(S=>-S[2]))});i.push(w.multiplyRight(a))}return i}function YH(e,t){const{shadowEnabled:r=!0}=e;if(!r||!e.shadowMatrices||!e.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:!!e.drawToShadowMap,shadow_uUseShadowMap:e.shadowMaps?e.shadowMaps.length>0:!1,shadow_uColor:e.shadowColor||HH,shadow_uLightId:e.shadowLightId||0,shadow_uLightCount:e.shadowMatrices.length},n=VH({viewport:e.viewport,center:t.project_uCenter}),s=[],c=qH({shadowMatrices:e.shadowMatrices,viewport:e.viewport}).slice();for(let a=0;a<e.shadowMatrices.length;a++){const p=c[a],_=p.clone().translate(new te(e.viewport.center).negate());t.project_uCoordinateSystem===hi.LNGLAT&&t.project_uProjectionMode===bu.WEB_MERCATOR?(c[a]=_,s[a]=n):(c[a]=p.clone().multiplyRight($H),s[a]=_.transform(n))}for(let a=0;a<c.length;a++)i["shadow_uViewProjectionMatrices[".concat(a,"]")]=c[a],i["shadow_uProjectCenters[".concat(a,"]")]=s[a],e.shadowMaps&&e.shadowMaps.length>0?i["shadow_uShadowMap".concat(a)]=e.shadowMaps[a]:i["shadow_uShadowMap".concat(a)]=e.dummyShadowMap;return i}const m2={name:"shadow",dependencies:[US],vs:UH,fs:GH,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in e&&(e.drawToShadowMap||e.shadowMaps&&e.shadowMaps.length>0)?YH(e,t):{}}},JH={color:[255,255,255],intensity:1},HC=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],KH=[0,0,0,200/255];class qS{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};q(this,"id","lighting-effect"),q(this,"props",void 0),q(this,"shadowColor",KH),q(this,"shadow",void 0),q(this,"ambientLight",void 0),q(this,"directionalLights",void 0),q(this,"pointLights",void 0),q(this,"shadowPasses",[]),q(this,"shadowMaps",[]),q(this,"dummyShadowMap",null),q(this,"programManager",void 0),q(this,"shadowMatrices",void 0),this.setProps(t)}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const r in t){const i=t[r];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.props=t}preRender(t,r){let{layers:i,layerFilter:n,viewports:s,onViewportActive:c,views:a}=r;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(t),this.programManager||(this.programManager=J0.getDefaultProgramManager(t),m2&&this.programManager.addDefaultModule(m2)),this.dummyShadowMap||(this.dummyShadowMap=new ll(t,{width:1,height:1}));for(let p=0;p<this.shadowPasses.length;p++)this.shadowPasses[p].render({layers:i,layerFilter:n,viewports:s,onViewportActive:c,views:a,moduleParameters:{shadowLightId:p,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const r=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return r.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:t})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:t}))},r}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(m2),this.programManager=null)}_calculateMatrices(){const t=[];for(const r of this.directionalLights){const i=new ui().lookAt({eye:new te(r.direction).negate()});t.push(i)}return t}_createShadowPasses(t){for(let r=0;r<this.directionalLights.length;r++){const i=new pH(t);this.shadowPasses[r]=i,this.shadowMaps[r]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:r,directionalLights:i}=this;!t&&r.length===0&&i.length===0&&(this.ambientLight=new iB(JH),this.directionalLights.push(new zC(HC[0]),new zC(HC[1])))}}class QH{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};q(this,"_pool",[]),q(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,r,i){let{size:n=1,type:s,padding:c=0,copy:a=!1,initialize:p=!1,maxCount:_}=i;const w=s||t&&t.constructor||Float32Array,S=r*n+c;if(ArrayBuffer.isView(t)){if(S<=t.length)return t;if(S*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new w(t.buffer,0,S)}let C=1/0;_&&(C=_*n+c);const I=this._allocate(w,S,p,C);return t&&a?I.set(t):p||I.fill(0,0,4),this._release(t),I}release(t){this._release(t)}_allocate(t,r,i,n){let s=Math.max(Math.ceil(r*this.opts.overAlloc),1);s>n&&(s=n);const c=this._pool,a=t.BYTES_PER_ELEMENT*s,p=c.findIndex(_=>_.byteLength>=a);if(p>=0){const _=new t(c.splice(p,1)[0],0,s);return i&&_.fill(0),_}return new t(s)}_release(t){if(!ArrayBuffer.isView(t))return;const r=this._pool,{buffer:i}=t,{byteLength:n}=i,s=r.findIndex(c=>c.byteLength>=n);s<0?r.push(i):(s>0||r.length<this.opts.poolSize)&&r.splice(s,0,i),r.length>this.opts.poolSize&&r.shift()}}const L0=new QH;function Og(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function t$(e){return[e[12],e[13],e[14]]}function e$(e){return{left:mf(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:mf(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:mf(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:mf(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:mf(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:mf(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}const $C=new te;function mf(e,t,r,i){$C.set(e,t,r);const n=$C.len();return{distance:i/n,normal:new te(-e/n,-t/n,-r/n)}}function r$(e){return e-Math.fround(e)}let wg;function g2(e,t){const{size:r=1,startIndex:i=0}=t,n=t.endIndex!==void 0?t.endIndex:e.length,s=(n-i)/r;wg=L0.allocate(wg,s,{type:Float32Array,size:r*2});let c=i,a=0;for(;c<n;){for(let p=0;p<r;p++){const _=e[c++];wg[a+p]=_,wg[a+p+r]=r$(_)}a+=r*2}return wg.subarray(0,s*r*2)}function i$(e){let t=null,r=!1;for(const i of e)i&&(t?(r||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],r=!0),t[0][0]=Math.min(t[0][0],i[0][0]),t[0][1]=Math.min(t[0][1],i[0][1]),t[1][0]=Math.max(t[1][0],i[1][0]),t[1][1]=Math.max(t[1][1],i[1][1])):t=i);return t}const n$=Math.PI/180,s$=Og(),WC=[0,0,0],o$={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function a$(e){let{width:t,height:r,orthographic:i,fovyRadians:n,focalDistance:s,padding:c,near:a,far:p}=e;const _=t/r,w=i?new ui().orthographic({fovy:n,aspect:_,focalDistance:s,near:a,far:p}):new ui().perspective({fovy:n,aspect:_,near:a,far:p});if(c){const{left:S=0,right:C=0,top:I=0,bottom:N=0}=c,F=ch((S+t-C)/2,0,t)-t/2,W=ch((I+r-N)/2,0,r)-r/2;w[8]-=F*2/t,w[9]+=W*2/r}return w}class Im{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};q(this,"id",void 0),q(this,"x",void 0),q(this,"y",void 0),q(this,"width",void 0),q(this,"height",void 0),q(this,"padding",void 0),q(this,"isGeospatial",void 0),q(this,"zoom",void 0),q(this,"focalDistance",void 0),q(this,"position",void 0),q(this,"modelMatrix",void 0),q(this,"distanceScales",void 0),q(this,"scale",void 0),q(this,"center",void 0),q(this,"cameraPosition",void 0),q(this,"projectionMatrix",void 0),q(this,"viewMatrix",void 0),q(this,"viewMatrixUncentered",void 0),q(this,"viewMatrixInverse",void 0),q(this,"viewProjectionMatrix",void 0),q(this,"pixelProjectionMatrix",void 0),q(this,"pixelUnprojectionMatrix",void 0),q(this,"resolution",void 0),q(this,"_frustumPlanes",{}),this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||o$,this.focalDistance=t.focalDistance||1,this.position=t.position||WC,this.modelMatrix=t.modelMatrix||null;const{longitude:r,latitude:i}=t;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(r),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?bu.WEB_MERCATOR:bu.WEB_MERCATOR_AUTO_OFFSET:bu.IDENTITY}equals(t){return t instanceof Im?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&Sc(t.projectionMatrix,this.projectionMatrix)&&Sc(t.viewMatrix,this.viewMatrix):!1}project(t){let{topLeft:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=this.projectPosition(t),n=dB(i,this.pixelProjectionMatrix),[s,c]=n,a=r?c:this.height-c;return t.length===2?[s,a]:[s,a,n[2]]}unproject(t){let{topLeft:r=!0,targetZ:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[n,s,c]=t,a=r?s:this.height-s,p=i&&i*this.distanceScales.unitsPerMeter[2],_=VS([n,a,c],this.pixelUnprojectionMatrix,p),[w,S,C]=this.unprojectPosition(_);return Number.isFinite(c)?[w,S,C]:Number.isFinite(i)?[w,S,i]:[w,S]}projectPosition(t){const[r,i]=this.projectFlat(t),n=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,i,n]}unprojectPosition(t){const[r,i]=this.unprojectFlat(t),n=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[r,i,n]}projectFlat(t){if(this.isGeospatial){const r=I0(t);return r[1]=ch(r[1],-318,830),r}return t}unprojectFlat(t){return this.isGeospatial?wm(t):t}getBounds(){const t={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},r=this.unproject([0,0],t),i=this.unproject([this.width,0],t),n=this.unproject([0,this.height],t),s=this.unproject([this.width,this.height],t);return[Math.min(r[0],i[0],n[0],s[0]),Math.min(r[1],i[1],n[1],s[1]),Math.max(r[0],i[0],n[0],s[0]),Math.max(r[1],i[1],n[1],s[1])]}getDistanceScales(t){return t?xx({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel(t){let{x:r,y:i,width:n=1,height:s=1}=t;return r<this.x+this.width&&this.x<r+n&&i<this.y+this.height&&this.y<i+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,e$(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,r){return null}_initProps(t){const r=t.longitude,i=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=RH({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||xx({latitude:i,longitude:r}));const n=Math.pow(2,this.zoom);this.scale=n;const{position:s,modelMatrix:c}=t;let a=WC;if(s&&(a=c?new ui(c).transformAsVector(s,[]):s),this.isGeospatial){const p=this.projectPosition([r,i,0]);this.center=new te(a).scale(this.distanceScales.unitsPerMeter).add(p)}else this.center=this.projectPosition(a)}_initMatrices(t){const{viewMatrix:r=s$,projectionMatrix:i=null,orthographic:n=!1,fovyRadians:s,fovy:c=75,near:a=.1,far:p=1e3,padding:_=null,focalDistance:w=1}=t;this.viewMatrixUncentered=r,this.viewMatrix=new ui().multiplyRight(r).translate(new te(this.center).negate()),this.projectionMatrix=i||a$({width:this.width,height:this.height,orthographic:n,fovyRadians:s||c*n$,focalDistance:w,padding:_,near:a,far:p});const S=Og();xp(S,S,this.projectionMatrix),xp(S,S,this.viewMatrix),this.viewProjectionMatrix=S,this.viewMatrixInverse=_x([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=t$(this.viewMatrixInverse);const C=Og(),I=Og();DS(C,C,[this.width/2,-this.height/2,1]),M_(C,C,[1,-1,0]),xp(I,C,this.viewProjectionMatrix),this.pixelProjectionMatrix=I,this.pixelUnprojectionMatrix=_x(Og(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||pi.warn("Pixel project matrix not invertible")()}}q(Im,"displayName","Viewport");class Mp extends Im{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:r=0,longitude:i=0,zoom:n=0,pitch:s=0,bearing:c=0,nearZMultiplier:a=.1,farZMultiplier:p=1.01,nearZ:_,farZ:w,orthographic:S=!1,projectionMatrix:C,repeat:I=!1,worldOffset:N=0,position:F,padding:W,legacyMeterSizes:U=!1}=t;let{width:z,height:H,altitude:nt=1.5}=t;const yt=Math.pow(2,n);z=z||1,H=H||1;let bt,vt=null;if(C)nt=C[5]/2,bt=R_(nt);else{t.fovy?(bt=t.fovy,nt=hB(bt)):bt=R_(nt);let Dt;if(W){const{top:kt=0,bottom:at=0}=W;Dt=[0,ch((kt+H-at)/2,0,H)-H/2]}vt=DH({width:z,height:H,scale:yt,center:F&&[0,0,F[2]*Dy(r)],offset:Dt,pitch:s,fovy:bt,nearZMultiplier:a,farZMultiplier:p}),Number.isFinite(_)&&(vt.near=_),Number.isFinite(w)&&(vt.far=w)}let mt=FH({height:H,pitch:s,bearing:c,scale:yt,altitude:nt});N&&(mt=new ui().translate([512*N,0,0]).multiplyLeft(mt)),super({...t,width:z,height:H,viewMatrix:mt,longitude:i,latitude:r,zoom:n,...vt,fovy:bt,focalDistance:nt}),q(this,"longitude",void 0),q(this,"latitude",void 0),q(this,"pitch",void 0),q(this,"bearing",void 0),q(this,"altitude",void 0),q(this,"fovy",void 0),q(this,"orthographic",void 0),q(this,"_subViewports",void 0),q(this,"_pseudoMeters",void 0),this.latitude=r,this.longitude=i,this.zoom=n,this.pitch=s,this.bearing=c,this.altitude=nt,this.fovy=bt,this.orthographic=S,this._subViewports=I?[]:null,this._pseudoMeters=U,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),r=Math.floor((t[0]+180)/360),i=Math.ceil((t[2]-180)/360);for(let n=r;n<=i;n++){const s=n?new Mp({...this,worldOffset:n}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[r,i]=this.projectFlat(t),n=(t[2]||0)*Dy(t[1]);return[r,i,n]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[r,i]=this.unprojectFlat(t),n=(t[2]||0)/Dy(i);return[r,i,n]}addMetersToLngLat(t,r){return uB(t,r)}panByPosition(t,r){const i=VS(r,this.pixelUnprojectionMatrix),n=this.projectFlat(t),s=PC([],n,aV([],i)),c=PC([],this.center,s),[a,p]=this.unprojectFlat(c);return{longitude:a,latitude:p}}getBounds(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=zH(this,t.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:i,height:n}=this,{longitude:s,latitude:c,zoom:a}=NH({width:i,height:n,bounds:t,...r});return new Mp({width:i,height:n,longitude:s,latitude:c,zoom:a})}}q(Mp,"displayName","WebMercatorViewport");const XC=[0,0,0];function y2(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=t.projectPosition(e);if(r&&t instanceof Mp){const[n,s,c=0]=e,a=t.getDistanceScales([n,s]);i[2]=c*a.unitsPerMeter[2]}return i}function l$(e){const{viewport:t,modelMatrix:r,coordinateOrigin:i}=e;let{coordinateSystem:n,fromCoordinateSystem:s,fromCoordinateOrigin:c}=e;return n===hi.DEFAULT&&(n=t.isGeospatial?hi.LNGLAT:hi.CARTESIAN),s===void 0&&(s=n),c===void 0&&(c=i),{viewport:t,coordinateSystem:n,coordinateOrigin:i,modelMatrix:r,fromCoordinateSystem:s,fromCoordinateOrigin:c}}function pB(e,t){let{viewport:r,modelMatrix:i,coordinateSystem:n,coordinateOrigin:s,offsetMode:c}=t,[a,p,_=0]=e;switch(i&&([a,p,_]=Y0([],[a,p,_,1],i)),n){case hi.LNGLAT:return y2([a,p,_],r,c);case hi.LNGLAT_OFFSETS:return y2([a+s[0],p+s[1],_+(s[2]||0)],r,c);case hi.METER_OFFSETS:return y2(uB(s,[a,p,_]),r,c);case hi.CARTESIAN:default:return r.isGeospatial?[a+s[0],p+s[1],_+s[2]]:r.projectPosition([a,p,_])}}function c$(e,t){const{viewport:r,coordinateSystem:i,coordinateOrigin:n,modelMatrix:s,fromCoordinateSystem:c,fromCoordinateOrigin:a}=l$(t),{autoOffset:p=!0}=t,{geospatialOrigin:_=XC,shaderCoordinateOrigin:w=XC,offsetMode:S=!1}=p?lB(r,i,n):{},C=pB(e,{viewport:r,modelMatrix:s,coordinateSystem:c,coordinateOrigin:a,offsetMode:S});if(S){const I=r.projectPosition(_||w);vV(C,C,I)}return C}const ZC={blendFunc:[1,0,32771,0],blendEquation:32774};class fB extends jS{constructor(){super(...arguments),q(this,"pickZ",void 0),q(this,"_colorEncoderState",null)}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer(t){let{layers:r,layerFilter:i,views:n,viewports:s,onViewportActive:c,pickingFBO:a,deviceRect:{x:p,y:_,width:w,height:S},cullRect:C,effects:I,pass:N="picking",pickZ:F,moduleParameters:W}=t;const U=this.gl;this.pickZ=F;const z=this._resetColorEncoder(F),H=xc(U,{scissorTest:!0,scissor:[p,_,w,S],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...ZC,blend:!F},()=>super.render({target:a,layers:r,layerFilter:i,views:n,viewports:s,onViewportActive:c,cullRect:C,effects:I==null?void 0:I.filter(nt=>nt.useInPicking),pass:N,isPicking:!0,moduleParameters:W}));return this._colorEncoderState=null,{decodePickingColor:z&&h$.bind(null,z),stats:H}}shouldDrawLayer(t){const{pickable:r,operation:i}=t.props;return r&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,r,i){const n={...t.props.parameters},{pickable:s,operation:c}=t.props;return this._colorEncoderState?s&&c.includes("draw")&&(Object.assign(n,ZC),n.blend=!0,n.blendColor=u$(this._colorEncoderState,t,i)):n.blend=!1,c.includes("terrain")&&(n.blend=!1),n}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function u$(e,t,r){const{byLayer:i,byAlpha:n}=e;let s,c=i.get(t);return c?(c.viewports.push(r),s=c.a):(s=i.size+1,s<=255?(c={a:s,layer:t,viewports:[r]},i.set(t,c),n[s]=c):(pi.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function h$(e,t){const r=e.byAlpha[t[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(t)}}const xf={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},F_=Symbol.for("component"),vd=Symbol.for("propTypes"),_2=Symbol.for("deprecatedProps"),Kf=Symbol.for("asyncPropDefaults"),Bp=Symbol.for("asyncPropOriginal"),ld=Symbol.for("asyncPropResolved");function mv(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(e)?mB(e,t,[]):t(e)?[e]:[]}function mB(e,t,r){let i=-1;for(;++i<e.length;){const n=e[i];Array.isArray(n)?mB(n,t,r):t(n)&&r.push(n)}return r}function d$(e){let{target:t,source:r,start:i=0,count:n=1}=e;const s=r.length,c=n*s;let a=0;for(let p=i;a<s;a++)t[p++]=r[a];for(;a<c;)a<c-a?(t.copyWithin(i+a,i,i+a),a*=2):(t.copyWithin(i+a,i,i+c-a),a=c);return t}class p${constructor(t,r,i){q(this,"id",void 0),q(this,"context",void 0),q(this,"isLoaded",void 0),q(this,"persistent",void 0),q(this,"_loadCount",0),q(this,"_subscribers",new Set),q(this,"_data",void 0),q(this,"_loader",void 0),q(this,"_error",void 0),q(this,"_content",void 0),this.id=t,this.context=i,this.setData(r)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,r){if(t===this._data&&!r)return;this._data=t;const i=++this._loadCount;let n=t;typeof t=="string"&&(n=Sd(t)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const s of this._subscribers)s.onChange(this.getData())}}class f${constructor(t){let{gl:r,protocol:i}=t;q(this,"protocol",void 0),q(this,"_context",void 0),q(this,"_resources",void 0),q(this,"_consumers",void 0),q(this,"_pruneRequest",void 0),this.protocol=i||"resource://",this._context={gl:r,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add(t){let{resourceId:r,data:i,forceUpdate:n=!1,persistent:s=!0}=t,c=this._resources[r];c?c.setData(i,n):(c=new p$(r,i,this._context),this._resources[r]=c),c.persistent=s}remove(t){const r=this._resources[t];r&&(r.delete(),delete this._resources[t])}unsubscribe(t){let{consumerId:r}=t;const i=this._consumers[r];if(i){for(const n in i){const s=i[n],c=this._resources[s.resourceId];c&&c.unsubscribe(s)}delete this._consumers[r],this.prune()}}subscribe(t){let{resourceId:r,onChange:i,consumerId:n,requestId:s="default"}=t;const{_resources:c,protocol:a}=this;r.startsWith(a)&&(r=r.replace(a,""),c[r]||this.add({resourceId:r,data:null,persistent:!1}));const p=c[r];if(this._track(n,s,p,i),p)return p.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,r,i,n){const s=this._consumers,c=s[t]=s[t]||{},a=c[r]||{},p=a.resourceId&&this._resources[a.resourceId];p&&(p.unsubscribe(a),this.prune()),i&&(c[r]=a,a.onChange=n,a.resourceId=i.id,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const r=this._resources[t];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[t])}}}const m$=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,HS={name:"project32",dependencies:[US],vs:m$},$S={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...Tq},g$=[US],y$=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function _$(e){const t=J0.getDefaultProgramManager(e);for(const r of g$)t.addDefaultModule(r);for(const r of y$)t.addShaderHook(r);return t}const v$="layerManager.setLayers",b$="layerManager.activateViewport";class w${constructor(t){let{deck:r,stats:i,viewport:n,timeline:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};q(this,"layers",void 0),q(this,"context",void 0),q(this,"resourceManager",void 0),q(this,"_lastRenderedLayers",[]),q(this,"_needsRedraw",!1),q(this,"_needsUpdate",!1),q(this,"_nextLayers",null),q(this,"_debug",!1),q(this,"activateViewport",c=>{Eo(b$,this,c),c&&(this.context.viewport=c)}),this.layers=[],this.resourceManager=new f$({gl:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:t,deck:r,programManager:t&&_$(t),stats:i||new q0({id:"deck.gl"}),viewport:n||new Im({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new rB,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const n=i.getNeedsRedraw(t);r=r||n}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers(){let{layerIds:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t?this.layers.filter(r=>t.find(i=>r.id.indexOf(i)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,r){Eo(v$,this,r,t),this._lastRenderedLayers=t;const i=mv(t,Boolean);for(const n of i)n.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}_handleError(t,r,i){i.raiseError(r,"".concat(t," of ").concat(i))}_updateLayers(t,r){const i={};for(const c of t)i[c.id]?pi.warn("Multiple old layers with same id ".concat(c.id))():i[c.id]=c;const n=[];this._updateSublayersRecursively(r,i,n),this._finalizeOldLayers(i);let s=!1;for(const c of n)if(c.hasUniformTransition()){s="Uniform transition in ".concat(c);break}this._needsUpdate=s,this.layers=n}_updateSublayersRecursively(t,r,i){for(const n of t){n.context=this.context;const s=r[n.id];s===null&&pi.warn("Multiple new layers with same id ".concat(n.id))(),r[n.id]=null;let c=null;try{this._debug&&s!==n&&n.validateProps(),s?(this._transferLayerState(s,n),this._updateLayer(n)):this._initializeLayer(n),i.push(n),c=n.isComposite?n.getSubLayers():null}catch(a){this._handleError("matching",a,n)}c&&this._updateSublayersRecursively(c,r,i)}}_finalizeOldLayers(t){for(const r in t){const i=t[r];i&&this._finalizeLayer(i)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=xf.INITIALIZED}catch(r){this._handleError("initialization",r,t)}}_transferLayerState(t,r){r._transferState(t),r.lifecycle=xf.MATCHED,r!==t&&(t.lifecycle=xf.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(r){this._handleError("update",r,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=xf.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=xf.FINALIZED}catch(r){this._handleError("finalization",r,t)}}}function wu(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!wu(e[i],t[i],r-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){const i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(const s of i)if(!t.hasOwnProperty(s)||!wu(e[s],t[s],r-1))return!1;return!0}return!1}class x${constructor(t){q(this,"width",void 0),q(this,"height",void 0),q(this,"views",void 0),q(this,"viewState",void 0),q(this,"controllers",void 0),q(this,"timeline",void 0),q(this,"_viewports",void 0),q(this,"_viewportMap",void 0),q(this,"_isUpdating",void 0),q(this,"_needsRedraw",void 0),q(this,"_needsUpdate",void 0),q(this,"_eventManager",void 0),q(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const r=this.controllers[t];r&&r.finalize()}this.controllers={}}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const r=this.controllers[t];r&&r.updateTransition()}}getViewports(t){return t?this._viewports.filter(r=>r.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(r=>{t[r.id]=r}),t}getView(t){return this.views.find(r=>r.id===t)}getViewState(t){const r=typeof t=="string"?this.getView(t):t,i=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(i):i}getViewport(t){return this._viewportMap[t]}unproject(t,r){const i=this.getViewports(),n={x:t[0],y:t[1]};for(let s=i.length-1;s>=0;--s){const c=i[s];if(c.containsPixel(n)){const a=t.slice();return a[0]-=c.x,a[1]-=c.y,c.unproject(a,r)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,r){(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(t){t=mv(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!wu(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):pi.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,r){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...r,viewId:t})}_createController(t,r){const i=r.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,r.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:n=>{var s;return(s=this.getView(t.id))===null||s===void 0?void 0:s.makeViewport({viewState:n,width:this.width,height:this.height})}})}_updateController(t,r,i,n){const s=t.controller;if(s&&i){const c={...r,...s,id:t.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!n||n.constructor!==s.type)&&(n=this._createController(t,c)),n&&n.setProps(c),n}return null}_rebuildViewports(){const{views:t}=this,r=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let n=t.length;n--;){const s=t[n],c=this.getViewState(s),a=s.makeViewport({viewState:c,width:this.width,height:this.height});let p=r[s.id];const _=!!s.controller;_&&!p&&(i=!0),(i||!_)&&p&&(p.finalize(),p=null),this.controllers[s.id]=this._updateController(s,c,a,p),a&&this._viewports.unshift(a)}for(const n in r){const s=r[n];s&&!this.controllers[n]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,r){return t.length!==r.length?!0:t.some((i,n)=>!t[n].equals(r[n]))}}const S$=/([0-9]+\.?[0-9]*)(%|px)/;function Wh(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=S$.exec(e);if(t&&t.length>=3){const r=t[2]==="%",i=parseFloat(t[1]);return{position:r?i/100:i,relative:r}}default:throw new Error("Could not parse position string ".concat(e))}}function Xh(e,t){return e.relative?Math.round(e.position*t):e.position}function Qs(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}class A${constructor(t){q(this,"id",void 0),q(this,"viewportInstance",void 0),q(this,"_x",void 0),q(this,"_y",void 0),q(this,"_width",void 0),q(this,"_height",void 0),q(this,"_padding",void 0),q(this,"props",void 0);const{id:r,x:i=0,y:n=0,width:s="100%",height:c="100%",padding:a=null,viewportInstance:p}=t||{};Qs(!p||p instanceof Im),this.viewportInstance=p,this.id=r||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=Wh(i),this._y=Wh(n),this._width=Wh(s),this._height=Wh(c),this._padding=a&&{left:Wh(a.left||0),right:Wh(a.right||0),top:Wh(a.top||0),bottom:Wh(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.viewportInstance?t.viewportInstance?this.viewportInstance.equals(t.viewportInstance):!1:this.ViewportType===t.ViewportType&&wu(this.props,t.props,2)}makeViewport(t){let{width:r,height:i,viewState:n}=t;if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);const s=this.getDimensions({width:r,height:i});return!s.height||!s.width?null:new this.ViewportType({...n,...this.props,...s})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const r={...t};for(const i in this.props.viewState)i!=="id"&&(r[i]=this.props.viewState[i]);return r}return t}getDimensions(t){let{width:r,height:i}=t;const n={x:Xh(this._x,r),y:Xh(this._y,i),width:Xh(this._width,r),height:Xh(this._height,i)};return this._padding&&(n.padding={left:Xh(this._padding.left,r),top:Xh(this._padding.top,i),right:Xh(this._padding.right,r),bottom:Xh(this._padding.bottom,i)}),n}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class Q0{constructor(t){q(this,"_inProgress",void 0),q(this,"_handle",void 0),q(this,"_timeline",void 0),q(this,"time",void 0),q(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=t,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(t){var r,i;this.cancel(),this.settings=t,this._inProgress=!0,(r=(i=this.settings).onStart)===null||r===void 0||r.call(i,this)}end(){if(this._inProgress){var t,r;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(r=this.settings).onEnd)===null||t===void 0||t.call(r,this)}}cancel(){if(this._inProgress){var t,r;(t=(r=this.settings).onInterrupt)===null||t===void 0||t.call(r,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var t,r;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:n}=this;this._handle=i.addChannel({delay:i.getTime(),duration:n.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(r=this.settings).onUpdate)===null||t===void 0||t.call(r,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const YC=()=>{},Sx={BREAK:1,SNAP_TO_END:2,IGNORE:3},E$=e=>e,T$=Sx.BREAK;class C${constructor(t){q(this,"getControllerState",void 0),q(this,"props",void 0),q(this,"propsInTransition",void 0),q(this,"transition",void 0),q(this,"onViewStateChange",void 0),q(this,"onStateChange",void 0),q(this,"_onTransitionUpdate",r=>{const{time:i,settings:{interpolator:n,startProps:s,endProps:c,duration:a,easing:p}}=r,_=p(i/a),w=n.interpolateProps(s,c,_);this.propsInTransition=this.getControllerState({...this.props,...w}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new Q0(t.timeline),this.onViewStateChange=t.onViewStateChange||YC,this.onStateChange=t.onStateChange||YC}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let r=!1;const i=this.props;if(this.props=t,!i||this._shouldIgnoreViewportChange(i,t))return!1;if(this._isTransitionEnabled(t)){let n=i;if(this.transition.inProgress){const{interruption:s,endProps:c}=this.transition.settings;n={...i,...s===Sx.SNAP_TO_END?c:this.propsInTransition||i}}this._triggerTransition(n,t),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:r,transitionInterpolator:i}=t;return(r>0||r==="auto")&&!!i}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,r){return this.transition.inProgress?this.transition.settings.interruption===Sx.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(t,r):!0}_triggerTransition(t,r){const i=this.getControllerState(t),n=this.getControllerState(r).shortestPathFrom(i),s=r.transitionInterpolator,c=s.getDuration?s.getDuration(t,r):r.transitionDuration;if(c===0)return;const a=s.initializeProps(t,n);this.propsInTransition={};const p={duration:c,easing:r.transitionEasing||E$,interpolator:s,interruption:r.transitionInterruption||T$,startProps:a.start,endProps:a.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(p),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t==null||t(r)}}}class P${constructor(t){q(this,"_propsToCompare",void 0),q(this,"_propsToExtract",void 0),q(this,"_requiredProps",void 0);const{compare:r,extract:i,required:n}=t;this._propsToCompare=r,this._propsToExtract=i||r,this._requiredProps=n}arePropsEqual(t,r){for(const i of this._propsToCompare)if(!(i in t)||!(i in r)||!Sc(t[i],r[i]))return!1;return!0}initializeProps(t,r){const i={},n={};for(const s of this._propsToExtract)(s in t||s in r)&&(i[s]=t[s],n[s]=r[s]);return this._checkRequiredProps(i),this._checkRequiredProps(n),{start:i,end:n}}getDuration(t,r){return r.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(r=>{const i=t[r];Qs(Number.isFinite(i)||Array.isArray(i),"".concat(r," is required for transition"))})}}const I$=["longitude","latitude","zoom","bearing","pitch"],L$=["longitude","latitude","zoom"];class gB extends P${constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=Array.isArray(t)?t:t.transitionProps,i=Array.isArray(t)?{}:t;i.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:I$,required:L$},super(i.transitionProps),q(this,"opts",void 0),this.opts=i}initializeProps(t,r){const i=super.initializeProps(t,r),{makeViewport:n,around:s}=this.opts;if(n&&s){const c=n(t),a=n(r),p=c.unproject(s);i.start.around=s,Object.assign(i.end,{around:a.project(p),aroundPosition:p,width:r.width,height:r.height})}return i}interpolateProps(t,r,i){const n={};for(const s of this._propsToExtract)n[s]=L_(t[s]||0,r[s]||0,i);if(r.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...r,...n});Object.assign(n,s.panByPosition(r.aroundPosition,L_(t.around,r.around,i)))}return n}}const Zh={transitionDuration:0},M$=300,ry=e=>1-(1-e)*(1-e),gf={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Qd={};class B${constructor(t){q(this,"props",void 0),q(this,"state",{}),q(this,"transitionManager",void 0),q(this,"eventManager",void 0),q(this,"onViewStateChange",void 0),q(this,"onStateChange",void 0),q(this,"makeViewport",void 0),q(this,"_controllerState",void 0),q(this,"_events",{}),q(this,"_interactionState",{isDragging:!1}),q(this,"_customEvents",[]),q(this,"_eventStartBlocked",null),q(this,"_panMove",!1),q(this,"invertPan",!1),q(this,"dragMode","rotate"),q(this,"inertia",0),q(this,"scrollZoom",!0),q(this,"dragPan",!0),q(this,"dragRotate",!0),q(this,"doubleClickZoom",!0),q(this,"touchZoom",!0),q(this,"touchRotate",!1),q(this,"keyboard",!0),this.transitionManager=new C$({...t,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const r in this._events)if(this._events[r]){var t;(t=this.eventManager)===null||t===void 0||t.off(r,this.handleEvent)}this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const r=this._eventStartBlocked;switch(t.type){case"panstart":return r?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return r?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return r?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:r,y:i}=this.props,{offsetCenter:n}=t;return[n.x-r,n.y-i]}isPointInBounds(t,r){const{width:i,height:n}=this.props;if(r&&r.handled)return!1;const s=t[0]>=0&&t[0]<=i&&t[1]>=0&&t[1]<=n;return s&&r&&r.stopPropagation(),s}isFunctionKeyPressed(t){const{srcEvent:r}=t;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=r}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:r}=t;this.inertia=Number.isFinite(r)?r:r===!0?M$:0;const{scrollZoom:i=!0,dragPan:n=!0,dragRotate:s=!0,doubleClickZoom:c=!0,touchZoom:a=!0,touchRotate:p=!1,keyboard:_=!0}=t,w=!!this.onViewStateChange;this.toggleEvents(gf.WHEEL,w&&i),this.toggleEvents(gf.PAN,w),this.toggleEvents(gf.PINCH,w&&(a||p)),this.toggleEvents(gf.TRIPLE_PAN,w&&p),this.toggleEvents(gf.DOUBLE_TAP,w&&c),this.toggleEvents(gf.KEYBOARD,w&&_),this.scrollZoom=i,this.dragPan=n,this.dragRotate=s,this.doubleClickZoom=c,this.touchZoom=a,this.touchRotate=p,this.keyboard=_}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,r){this.eventManager&&t.forEach(i=>{this._events[i]!==r&&(this._events[i]=r,r?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n={...t.getViewportProps(),...r},s=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(i),s){const c=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:c})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let i=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const n=this.controllerState[i?"panStart":"rotateStart"]({pos:r});return this._panMove=i,this.updateViewport(n,Zh,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const r=this.getCenter(t),i=this.controllerState.pan({pos:r});return this.updateViewport(i,Zh,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:r}=this;if(this.dragPan&&r&&t.velocity){const i=this.getCenter(t),n=[i[0]+t.velocityX*r/2,i[1]+t.velocityY*r/2],s=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:ry},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const r=this.getCenter(t),i=this.controllerState.rotate({pos:r});return this.updateViewport(i,Zh,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:r}=this;if(this.dragRotate&&r&&t.velocity){const i=this.getCenter(t),n=[i[0]+t.velocityX*r/2,i[1]+t.velocityY*r/2],s=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:ry},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;t.srcEvent.preventDefault();const{speed:i=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=t;let c=2/(1+Math.exp(-Math.abs(s*i)));s<0&&c!==0&&(c=1/c);const a=this.controllerState.zoom({pos:r,scale:c});return this.updateViewport(a,{...this._getTransitionProps({around:r}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;const i=this.controllerState.rotateStart({pos:r});return this.updateViewport(i,Zh,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;const r=this.getCenter(t);r[0]-=t.deltaX;const i=this.controllerState.rotate({pos:r});return this.updateViewport(i,Zh,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:r}=this;if(this.touchRotate&&r&&t.velocityY){const i=this.getCenter(t),n=[i[0],i[1]+=t.velocityY*r/2],s=this.controllerState.rotate({pos:n});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:ry},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;const i=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return Qd._startPinchRotation=t.rotation,Qd._lastPinchEvent=t,this.updateViewport(i,Zh,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){const{scale:i}=t,n=this.getCenter(t);r=r.zoom({pos:n,scale:i})}if(this.touchRotate){const{rotation:i}=t;r=r.rotate({deltaAngleX:Qd._startPinchRotation-i})}return this.updateViewport(r,Zh,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Qd._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:r}=this,{_lastPinchEvent:i}=Qd;if(this.touchZoom&&r&&i&&t.scale!==i.scale){const n=this.getCenter(t);let s=this.controllerState.rotateEnd();const c=Math.log2(t.scale),a=(c-Math.log2(i.scale))/(t.deltaTime-i.deltaTime),p=Math.pow(2,c+a*r/2);s=s.zoom({pos:n,scale:p}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:n}),transitionDuration:r,transitionEasing:ry},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{const n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Qd._startPinchRotation=null,Qd._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;const i=this.isFunctionKeyPressed(t),n=this.controllerState.zoom({pos:r,scale:i?.5:2});return this.updateViewport(n,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const r=this.isFunctionKeyPressed(t),{zoomSpeed:i,moveSpeed:n,rotateSpeedX:s,rotateSpeedY:c}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let p;const _={};switch(t.srcEvent.code){case"Minus":p=r?a.zoomOut(i).zoomOut(i):a.zoomOut(i),_.isZooming=!0;break;case"Equal":p=r?a.zoomIn(i).zoomIn(i):a.zoomIn(i),_.isZooming=!0;break;case"ArrowLeft":r?(p=a.rotateLeft(s),_.isRotating=!0):(p=a.moveLeft(n),_.isPanning=!0);break;case"ArrowRight":r?(p=a.rotateRight(s),_.isRotating=!0):(p=a.moveRight(n),_.isPanning=!0);break;case"ArrowUp":r?(p=a.rotateUp(c),_.isRotating=!0):(p=a.moveUp(n),_.isPanning=!0);break;case"ArrowDown":r?(p=a.rotateDown(c),_.isRotating=!0):(p=a.moveDown(n),_.isPanning=!0);break;default:return!1}return this.updateViewport(p,this._getTransitionProps(),_),!0}_getTransitionProps(t){const{transition:r}=this;return!r||!r.transitionInterpolator?Zh:t?{...r,transitionInterpolator:new gB({...t,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}}class k${constructor(t,r){q(this,"_viewportProps",void 0),q(this,"_state",void 0),this._viewportProps=this.applyConstraints(t),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}}const JC=5,R$=1.2;class F$ extends k${constructor(t){const{width:r,height:i,latitude:n,longitude:s,zoom:c,bearing:a=0,pitch:p=0,altitude:_=1.5,position:w=[0,0,0],maxZoom:S=20,minZoom:C=0,maxPitch:I=60,minPitch:N=0,startPanLngLat:F,startZoomLngLat:W,startRotatePos:U,startBearing:z,startPitch:H,startZoom:nt,normalize:yt=!0}=t;Qs(Number.isFinite(s)),Qs(Number.isFinite(n)),Qs(Number.isFinite(c)),super({width:r,height:i,latitude:n,longitude:s,zoom:c,bearing:a,pitch:p,altitude:_,maxZoom:S,minZoom:C,maxPitch:I,minPitch:N,normalize:yt,position:w},{startPanLngLat:F,startZoomLngLat:W,startRotatePos:U,startBearing:z,startPitch:H,startZoom:nt}),q(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart(t){let{pos:r}=t;return this._getUpdatedState({startPanLngLat:this._unproject(r)})}pan(t){let{pos:r,startPos:i}=t;const n=this.getState().startPanLngLat||this._unproject(i);if(!n)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(n,r);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(t){let{pos:r}=t;return this._getUpdatedState({startRotatePos:r,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(t){let{pos:r,deltaAngleX:i=0,deltaAngleY:n=0}=t;const{startRotatePos:s,startBearing:c,startPitch:a}=this.getState();if(!s||c===void 0||a===void 0)return this;let p;return r?p=this._getNewRotation(r,s,a,c):p={bearing:c+i,pitch:a+n},this._getUpdatedState(p)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(t){let{pos:r}=t;return this._getUpdatedState({startZoomLngLat:this._unproject(r),startZoom:this.getViewportProps().zoom})}zoom(t){let{pos:r,startPos:i,scale:n}=t,{startZoom:s,startZoomLngLat:c}=this.getState();if(c||(s=this.getViewportProps().zoom,c=this._unproject(i)||this._unproject(r)),!c)return this;const{maxZoom:a,minZoom:p}=this.getViewportProps();let _=s+Math.log2(n);_=ch(_,p,a);const w=this.makeViewport({...this.getViewportProps(),zoom:_});return this._getUpdatedState({zoom:_,...w.panByPosition(c,r)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(t)}zoomOut(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/t)}moveLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([t,0])}moveRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-t,0])}moveUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,t])}moveDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-t])}rotateLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const r=t.getViewportProps(),i={...this.getViewportProps()},{bearing:n,longitude:s}=i;return Math.abs(n-r.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(s-r.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(t){const{maxZoom:r,minZoom:i,zoom:n}=t;t.zoom=ch(n,i,r);const{maxPitch:s,minPitch:c,pitch:a}=t;t.pitch=ch(a,c,s);const{normalize:p=!0}=t;return p&&Object.assign(t,jH(t)),t}_zoomFromCenter(t){const{width:r,height:i}=this.getViewportProps();return this.zoom({pos:[r/2,i/2],scale:t})}_panFromCenter(t){const{width:r,height:i}=this.getViewportProps();return this.pan({startPos:[r/2,i/2],pos:[r/2+t[0],i/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const r=this.makeViewport(this.getViewportProps());return t&&r.unproject(t)}_getNewRotation(t,r,i,n){const s=t[0]-r[0],c=t[1]-r[1],a=t[1],p=r[1],{width:_,height:w}=this.getViewportProps(),S=s/_;let C=0;c>0?Math.abs(w-p)>JC&&(C=c/(p-w)*R$):c<0&&p>JC&&(C=1-a/p),C=ch(C,-1,1);const{minPitch:I,maxPitch:N}=this.getViewportProps(),F=n+180*S;let W=i;return C>0?W=i+C*(N-i):C<0&&(W=i-C*(I-i)),{pitch:W,bearing:F}}}class D$ extends B${constructor(){super(...arguments),q(this,"ControllerState",F$),q(this,"transition",{transitionDuration:300,transitionInterpolator:new gB({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),q(this,"dragMode","pan")}setProps(t){t.position=t.position||[0,0,0];const r=this.props;super.setProps(t),(!r||r.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class WS extends A${get ViewportType(){return Mp}get ControllerType(){return D$}}q(WS,"displayName","MapView");const N$=new qS;function O$(e,t){var r,i;const n=(r=e.order)!==null&&r!==void 0?r:1/0,s=(i=t.order)!==null&&i!==void 0?i:1/0;return n-s}class z${constructor(){q(this,"effects",void 0),q(this,"_resolvedEffects",[]),q(this,"_defaultEffects",[]),q(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const r=this._defaultEffects;if(!r.find(i=>i.id===t.id)){const i=r.findIndex(n=>O$(n,t)>0);i<0?r.push(t):r.splice(i,0,t),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(wu(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(t){const r={};for(const n of this.effects)r[n.id]=n;const i=[];for(const n of t){const s=r[n.id];s&&s!==n?s.setProps?(s.setProps(n.props),i.push(s)):(s.cleanup(),i.push(n)):i.push(n),delete r[n.id]}for(const n in r)r[n].cleanup();this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),t.some(n=>n instanceof qS)||this._resolvedEffects.push(N$),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class j$ extends jS{shouldDrawLayer(t){const{operation:r}=t.props;return r.includes("draw")||r.includes("terrain")}}const U$="deckRenderer.renderLayers";class G${constructor(t){q(this,"gl",void 0),q(this,"layerFilter",void 0),q(this,"drawPickingColors",void 0),q(this,"drawLayersPass",void 0),q(this,"pickLayersPass",void 0),q(this,"renderCount",void 0),q(this,"_needsRedraw",void 0),q(this,"renderBuffers",void 0),q(this,"lastPostProcessEffect",void 0),this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new j$(t),this.pickLayersPass=new fB(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t,target:t.target||Ss.getDefaultFramebuffer(this.gl)};i.effects&&this._preRender(i.effects,i);const n=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,s=r.render({...i,target:n});i.effects&&this._postRender(i.effects,i),this.renderCount++,Eo(U$,this,s,t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){const{renderBuffers:t}=this;for(const r of t)r.delete();t.length=0}_preRender(t,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(const i of t)r.preRenderStats[i.id]=i.preRender(this.gl,r),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this;t.length===0&&t.push(new Ss(this.gl),new Ss(this.gl));for(const r of t)r.resize()}_postRender(t,r){const{renderBuffers:i}=this,n={...r,inputBuffer:i[0],swapBuffer:i[1],target:null};for(const s of t)if(s.postRender){if(s.id===this.lastPostProcessEffect){n.target=r.target,s.postRender(this.gl,n);break}const c=s.postRender(this.gl,n);n.inputBuffer=c,n.swapBuffer=c===i[0]?i[1]:i[0]}}}const V$={pickedColor:null,pickedObjectIndex:-1};function q$(e){let{pickedColors:t,decodePickingColor:r,deviceX:i,deviceY:n,deviceRadius:s,deviceRect:c}=e;const{x:a,y:p,width:_,height:w}=c;let S=s*s,C=-1,I=0;for(let N=0;N<w;N++){const F=N+p-n,W=F*F;if(W>S)I+=4*_;else for(let U=0;U<_;U++){if(t[I+3]-1>=0){const z=U+a-i,H=z*z+W;H<=S&&(S=H,C=I)}I+=4}}if(C>=0){const N=t.slice(C,C+4),F=r(N);if(F){const W=Math.floor(C/4/_),U=C/4-W*_;return{...F,pickedColor:N,pickedX:a+U,pickedY:p+W}}pi.error("Picked non-existent layer. Is picking buffer corrupt?")()}return V$}function H$(e){let{pickedColors:t,decodePickingColor:r}=e;const i=new Map;if(t){for(let n=0;n<t.length;n+=4)if(t[n+3]-1>=0){const s=t.slice(n,n+4),c=s.join(",");if(!i.has(c)){const a=r(s);a?i.set(c,{...a,color:s}):pi.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function yB(e){let{pickInfo:t,viewports:r,pixelRatio:i,x:n,y:s,z:c}=e,a=r[0];r.length>1&&(a=W$((t==null?void 0:t.pickedViewports)||r,{x:n,y:s}));let p;if(a){const _=[n-a.x,s-a.y];c!==void 0&&(_[2]=c),p=a.unproject(_)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:n,y:s,pixel:[n,s],coordinate:p,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:i}}function $$(e){const{pickInfo:t,lastPickedInfo:r,mode:i,layers:n}=e,{pickedColor:s,pickedLayer:c,pickedObjectIndex:a}=t,p=c?[c]:[];if(i==="hover"){const S=r.index,C=r.layerId,I=c?c.props.id:null;if(I!==C||a!==S){if(I!==C){const N=n.find(F=>F.props.id===C);N&&p.unshift(N)}r.layerId=I,r.index=a,r.info=null}}const _=yB(e),w=new Map;return w.set(null,_),p.forEach(S=>{let C={..._};S===c&&(C.color=s,C.index=a,C.picked=!0),C=_B({layer:S,info:C,mode:i});const I=C.layer;S===c&&i==="hover"&&(r.info=C),w.set(I.id,C),i==="hover"&&I.updateAutoHighlight(C)}),w}function _B(e){let{layer:t,info:r,mode:i}=e;for(;t&&r;){const n=r.layer||null;r.sourceLayer=n,r.layer=t,r=t.getPickingInfo({info:r,mode:i,sourceLayer:n}),t=t.parent}return r}function W$(e,t){for(let r=e.length-1;r>=0;r--){const i=e[r];if(i.containsPixel(t))return i}return e[0]}class X${constructor(t){q(this,"gl",void 0),q(this,"pickingFBO",void 0),q(this,"depthFBO",void 0),q(this,"pickLayersPass",void 0),q(this,"layerFilter",void 0),q(this,"lastPickedInfo",void 0),q(this,"_pickable",!0),this.gl=t,this.pickLayersPass=new fB(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject(t){let{x:r,y:i,layers:n,viewports:s}=t,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const a=c&&c.layer&&c.layer.id,p=c&&c.viewport&&c.viewport.id,_=a?n.find(C=>C.id===a):null,w=p&&s.find(C=>C.id===p)||s[0],S=w&&w.unproject([r-w.x,i-w.y]);return{...c,x:r,y:i,viewport:w,coordinate:S,layer:_}}_resizeBuffer(){var t,r;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new Ss(i),Ss.isSupported(i,{colorBufferFloat:!0}))){const n=new Ss(i);n.attach({36064:new ll(i,{format:ri(i)?34836:6408,type:5126})}),this.depthFBO=n}(t=this.pickingFBO)===null||t===void 0||t.resize({width:i.canvas.width,height:i.canvas.height}),(r=this.depthFBO)===null||r===void 0||r.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(t){if(this._pickable===!1)return null;const r=t.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return r.length?r:null}_pickClosestObject(t){let{layers:r,views:i,viewports:n,x:s,y:c,radius:a=0,depth:p=1,mode:_="query",unproject3D:w,onViewportActive:S,effects:C}=t;const I=this._getPickable(r),N=mm(this.gl);if(!I)return{result:[],emptyInfo:yB({viewports:n,x:s,y:c,pixelRatio:N})};this._resizeBuffer();const F=r2(this.gl,[s,c],!0),W=[F.x+Math.floor(F.width/2),F.y+Math.floor(F.height/2)],U=Math.round(a*N),{width:z,height:H}=this.pickingFBO,nt=this._getPickingRect({deviceX:W[0],deviceY:W[1],deviceRadius:U,deviceWidth:z,deviceHeight:H}),yt={x:s-a,y:c-a,width:a*2+1,height:a*2+1};let bt;const vt=[],mt=new Set;for(let Dt=0;Dt<p;Dt++){let kt;if(nt){const dt=this._drawAndSample({layers:I,views:i,viewports:n,onViewportActive:S,deviceRect:nt,cullRect:yt,effects:C,pass:"picking:".concat(_)});kt=q$({...dt,deviceX:W[0],deviceY:W[1],deviceRadius:U,deviceRect:nt})}else kt={pickedColor:null,pickedObjectIndex:-1};let at;if(kt.pickedLayer&&w&&this.depthFBO){const{pickedColors:dt}=this._drawAndSample({layers:[kt.pickedLayer],views:i,viewports:n,onViewportActive:S,deviceRect:{x:kt.pickedX,y:kt.pickedY,width:1,height:1},cullRect:yt,effects:C,pass:"picking:".concat(_,":z")},!0);dt[3]&&(at=dt[0])}kt.pickedLayer&&Dt+1<p&&(mt.add(kt.pickedLayer),kt.pickedLayer.disablePickingIndex(kt.pickedObjectIndex)),bt=$$({pickInfo:kt,lastPickedInfo:this.lastPickedInfo,mode:_,layers:I,viewports:n,x:s,y:c,z:at,pixelRatio:N});for(const dt of bt.values())dt.layer&&vt.push(dt);if(!kt.pickedColor)break}for(const Dt of mt)Dt.restorePickingColors();return{result:vt,emptyInfo:bt.get(null)}}_pickVisibleObjects(t){let{layers:r,views:i,viewports:n,x:s,y:c,width:a=1,height:p=1,mode:_="query",maxObjects:w=null,onViewportActive:S,effects:C}=t;const I=this._getPickable(r);if(!I)return[];this._resizeBuffer();const N=mm(this.gl),F=r2(this.gl,[s,c],!0),W=F.x,U=F.y+F.height,z=r2(this.gl,[s+a,c+p],!0),H=z.x+z.width,nt=z.y,yt={x:W,y:nt,width:H-W,height:U-nt},bt=this._drawAndSample({layers:I,views:i,viewports:n,onViewportActive:S,deviceRect:yt,cullRect:{x:s,y:c,width:a,height:p},effects:C,pass:"picking:".concat(_)}),vt=H$(bt),mt=new Map,Dt=Number.isFinite(w);for(let at=0;at<vt.length;at++){var kt;if(Dt&&w&&mt.size>=w)break;const dt=vt[at];let It={color:dt.pickedColor,layer:null,index:dt.pickedObjectIndex,picked:!0,x:s,y:c,pixelRatio:N};It=_B({layer:dt.pickedLayer,info:It,mode:_});const xt=(kt=It.object)!==null&&kt!==void 0?kt:"".concat(It.layer.id,"[").concat(It.index,"]");mt.has(xt)||mt.set(xt,It)}return Array.from(mt.values())}_drawAndSample(t){let{layers:r,views:i,viewports:n,onViewportActive:s,deviceRect:c,cullRect:a,effects:p,pass:_}=t,w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const S=w?this.depthFBO:this.pickingFBO,C={layers:r,layerFilter:this.layerFilter,views:i,viewports:n,onViewportActive:s,pickingFBO:S,deviceRect:c,cullRect:a,effects:p,pass:_,pickZ:w,preRenderStats:{}};for(const H of p)H.useInPicking&&(C.preRenderStats[H.id]=H.preRender(this.gl,C));const{decodePickingColor:I}=this.pickLayersPass.render(C),{x:N,y:F,width:W,height:U}=c,z=new(w?Float32Array:Uint8Array)(W*U*4);return fv(S,{sourceX:N,sourceY:F,sourceWidth:W,sourceHeight:U,target:z}),{pickedColors:z,decodePickingColor:I}}_getPickingRect(t){let{deviceX:r,deviceY:i,deviceRadius:n,deviceWidth:s,deviceHeight:c}=t;const a=Math.max(0,r-n),p=Math.max(0,i-n),_=Math.min(s,r+n+1)-a,w=Math.min(c,i+n+1)-p;return _<=0||w<=0?null:{x:a,y:p,width:_,height:w}}}const Z$={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Y${constructor(t){q(this,"el",null),q(this,"isVisible",!1);const r=t.parentElement;r&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,Z$),r.appendChild(this.el))}setTooltip(t,r,i){const n=this.el;if(n){if(typeof t=="string")n.innerText=t;else if(t)t.text&&(n.innerText=t.text),t.html&&(n.innerHTML=t.html),t.className&&(n.className=t.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform="translate(".concat(r,"px, ").concat(i,"px)"),t&&typeof t=="object"&&"style"in t&&Object.assign(n.style,t.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var vB={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(e){(function(t,r,i,n){var s=["","webkit","Moz","MS","ms","o"],c=r.createElement("div"),a="function",p=Math.round,_=Math.abs,w=Date.now;function S(ot,_t,zt){return setTimeout(H(ot,zt),_t)}function C(ot,_t,zt){return Array.isArray(ot)?(I(ot,zt[_t],zt),!0):!1}function I(ot,_t,zt){var oe;if(ot)if(ot.forEach)ot.forEach(_t,zt);else if(ot.length!==n)for(oe=0;oe<ot.length;)_t.call(zt,ot[oe],oe,ot),oe++;else for(oe in ot)ot.hasOwnProperty(oe)&&_t.call(zt,ot[oe],oe,ot)}function N(ot,_t,zt){var oe="DEPRECATED METHOD: "+_t+`
`+zt+` AT 
`;return function(){var Ae=new Error("get-stack-trace"),ar=Ae&&Ae.stack?Ae.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Lr=t.console&&(t.console.warn||t.console.log);return Lr&&Lr.call(t.console,oe,ar),ot.apply(this,arguments)}}var F;typeof Object.assign!="function"?F=function(ot){if(ot===n||ot===null)throw new TypeError("Cannot convert undefined or null to object");for(var _t=Object(ot),zt=1;zt<arguments.length;zt++){var oe=arguments[zt];if(oe!==n&&oe!==null)for(var Ae in oe)oe.hasOwnProperty(Ae)&&(_t[Ae]=oe[Ae])}return _t}:F=Object.assign;var W=N(function(ot,_t,zt){for(var oe=Object.keys(_t),Ae=0;Ae<oe.length;)(!zt||zt&&ot[oe[Ae]]===n)&&(ot[oe[Ae]]=_t[oe[Ae]]),Ae++;return ot},"extend","Use `assign`."),U=N(function(ot,_t){return W(ot,_t,!0)},"merge","Use `assign`.");function z(ot,_t,zt){var oe=_t.prototype,Ae;Ae=ot.prototype=Object.create(oe),Ae.constructor=ot,Ae._super=oe,zt&&F(Ae,zt)}function H(ot,_t){return function(){return ot.apply(_t,arguments)}}function nt(ot,_t){return typeof ot==a?ot.apply(_t&&_t[0]||n,_t):ot}function yt(ot,_t){return ot===n?_t:ot}function bt(ot,_t,zt){I(kt(_t),function(oe){ot.addEventListener(oe,zt,!1)})}function vt(ot,_t,zt){I(kt(_t),function(oe){ot.removeEventListener(oe,zt,!1)})}function mt(ot,_t){for(;ot;){if(ot==_t)return!0;ot=ot.parentNode}return!1}function Dt(ot,_t){return ot.indexOf(_t)>-1}function kt(ot){return ot.trim().split(/\s+/g)}function at(ot,_t,zt){if(ot.indexOf&&!zt)return ot.indexOf(_t);for(var oe=0;oe<ot.length;){if(zt&&ot[oe][zt]==_t||!zt&&ot[oe]===_t)return oe;oe++}return-1}function dt(ot){return Array.prototype.slice.call(ot,0)}function It(ot,_t,zt){for(var oe=[],Ae=[],ar=0;ar<ot.length;){var Lr=ot[ar][_t];at(Ae,Lr)<0&&oe.push(ot[ar]),Ae[ar]=Lr,ar++}return oe=oe.sort(function(di,Sn){return di[_t]>Sn[_t]}),oe}function xt(ot,_t){for(var zt,oe,Ae=_t[0].toUpperCase()+_t.slice(1),ar=0;ar<s.length;){if(zt=s[ar],oe=zt?zt+Ae:_t,oe in ot)return oe;ar++}return n}var re=1;function ee(){return re++}function se(ot){var _t=ot.ownerDocument||ot;return _t.defaultView||_t.parentWindow||t}var Ot=/mobile|tablet|ip(ad|hone|od)|android/i,Xt="ontouchstart"in t,Wt=xt(t,"PointerEvent")!==n,xe=Xt&&Ot.test(navigator.userAgent),it="touch",Et="pen",Pt="mouse",jt="kinect",qt=25,$t=1,Qt=2,Kt=4,Ee=8,Me=1,De=2,ze=4,or=8,le=16,st=De|ze,mr=or|le,Qe=st|mr,de=["x","y"],Te=["clientX","clientY"];function Be(ot,_t){var zt=this;this.manager=ot,this.callback=_t,this.element=ot.element,this.target=ot.options.inputTarget,this.domHandler=function(oe){nt(ot.options.enable,[ot])&&zt.handler(oe)},this.init()}Be.prototype={handler:function(){},init:function(){this.evEl&&bt(this.element,this.evEl,this.domHandler),this.evTarget&&bt(this.target,this.evTarget,this.domHandler),this.evWin&&bt(se(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&vt(this.element,this.evEl,this.domHandler),this.evTarget&&vt(this.target,this.evTarget,this.domHandler),this.evWin&&vt(se(this.element),this.evWin,this.domHandler)}};function Ne(ot){var _t,zt=ot.options.inputClass;return zt?_t=zt:Wt?_t=At:xe?_t=Lt:Xt?_t=be:_t=je,new _t(ot,rr)}function rr(ot,_t,zt){var oe=zt.pointers.length,Ae=zt.changedPointers.length,ar=_t&$t&&oe-Ae===0,Lr=_t&(Kt|Ee)&&oe-Ae===0;zt.isFirst=!!ar,zt.isFinal=!!Lr,ar&&(ot.session={}),zt.eventType=_t,Er(ot,zt),ot.emit("hammer.input",zt),ot.recognize(zt),ot.session.prevInput=zt}function Er(ot,_t){var zt=ot.session,oe=_t.pointers,Ae=oe.length;zt.firstInput||(zt.firstInput=Ur(_t)),Ae>1&&!zt.firstMultiple?zt.firstMultiple=Ur(_t):Ae===1&&(zt.firstMultiple=!1);var ar=zt.firstInput,Lr=zt.firstMultiple,di=Lr?Lr.center:ar.center,Sn=_t.center=me(oe);_t.timeStamp=w(),_t.deltaTime=_t.timeStamp-ar.timeStamp,_t.angle=wi(di,Sn),_t.distance=Fe(di,Sn),wr(zt,_t),_t.offsetDirection=xr(_t.deltaX,_t.deltaY);var Mn=hr(_t.deltaTime,_t.deltaX,_t.deltaY);_t.overallVelocityX=Mn.x,_t.overallVelocityY=Mn.y,_t.overallVelocity=_(Mn.x)>_(Mn.y)?Mn.x:Mn.y,_t.scale=Lr?br(Lr.pointers,oe):1,_t.rotation=Lr?ge(Lr.pointers,oe):0,_t.maxPointers=zt.prevInput?_t.pointers.length>zt.prevInput.maxPointers?_t.pointers.length:zt.prevInput.maxPointers:_t.pointers.length,Fr(zt,_t);var ii=ot.element;mt(_t.srcEvent.target,ii)&&(ii=_t.srcEvent.target),_t.target=ii}function wr(ot,_t){var zt=_t.center,oe=ot.offsetDelta||{},Ae=ot.prevDelta||{},ar=ot.prevInput||{};(_t.eventType===$t||ar.eventType===Kt)&&(Ae=ot.prevDelta={x:ar.deltaX||0,y:ar.deltaY||0},oe=ot.offsetDelta={x:zt.x,y:zt.y}),_t.deltaX=Ae.x+(zt.x-oe.x),_t.deltaY=Ae.y+(zt.y-oe.y)}function Fr(ot,_t){var zt=ot.lastInterval||_t,oe=_t.timeStamp-zt.timeStamp,Ae,ar,Lr,di;if(_t.eventType!=Ee&&(oe>qt||zt.velocity===n)){var Sn=_t.deltaX-zt.deltaX,Mn=_t.deltaY-zt.deltaY,ii=hr(oe,Sn,Mn);ar=ii.x,Lr=ii.y,Ae=_(ii.x)>_(ii.y)?ii.x:ii.y,di=xr(Sn,Mn),ot.lastInterval=_t}else Ae=zt.velocity,ar=zt.velocityX,Lr=zt.velocityY,di=zt.direction;_t.velocity=Ae,_t.velocityX=ar,_t.velocityY=Lr,_t.direction=di}function Ur(ot){for(var _t=[],zt=0;zt<ot.pointers.length;)_t[zt]={clientX:p(ot.pointers[zt].clientX),clientY:p(ot.pointers[zt].clientY)},zt++;return{timeStamp:w(),pointers:_t,center:me(_t),deltaX:ot.deltaX,deltaY:ot.deltaY}}function me(ot){var _t=ot.length;if(_t===1)return{x:p(ot[0].clientX),y:p(ot[0].clientY)};for(var zt=0,oe=0,Ae=0;Ae<_t;)zt+=ot[Ae].clientX,oe+=ot[Ae].clientY,Ae++;return{x:p(zt/_t),y:p(oe/_t)}}function hr(ot,_t,zt){return{x:_t/ot||0,y:zt/ot||0}}function xr(ot,_t){return ot===_t?Me:_(ot)>=_(_t)?ot<0?De:ze:_t<0?or:le}function Fe(ot,_t,zt){zt||(zt=de);var oe=_t[zt[0]]-ot[zt[0]],Ae=_t[zt[1]]-ot[zt[1]];return Math.sqrt(oe*oe+Ae*Ae)}function wi(ot,_t,zt){zt||(zt=de);var oe=_t[zt[0]]-ot[zt[0]],Ae=_t[zt[1]]-ot[zt[1]];return Math.atan2(Ae,oe)*180/Math.PI}function ge(ot,_t){return wi(_t[1],_t[0],Te)+wi(ot[1],ot[0],Te)}function br(ot,_t){return Fe(_t[0],_t[1],Te)/Fe(ot[0],ot[1],Te)}var Ge={mousedown:$t,mousemove:Qt,mouseup:Kt},Hr="mousedown",Qi="mousemove mouseup";function je(){this.evEl=Hr,this.evWin=Qi,this.pressed=!1,Be.apply(this,arguments)}z(je,Be,{handler:function(ot){var _t=Ge[ot.type];_t&$t&&ot.button===0&&(this.pressed=!0),_t&Qt&&ot.which!==1&&(_t=Kt),this.pressed&&(_t&Kt&&(this.pressed=!1),this.callback(this.manager,_t,{pointers:[ot],changedPointers:[ot],pointerType:Pt,srcEvent:ot}))}});var In={pointerdown:$t,pointermove:Qt,pointerup:Kt,pointercancel:Ee,pointerout:Ee},si={2:it,3:Et,4:Pt,5:jt},on="pointerdown",an="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(on="MSPointerDown",an="MSPointerMove MSPointerUp MSPointerCancel");function At(){this.evEl=on,this.evWin=an,Be.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}z(At,Be,{handler:function(ot){var _t=this.store,zt=!1,oe=ot.type.toLowerCase().replace("ms",""),Ae=In[oe],ar=si[ot.pointerType]||ot.pointerType,Lr=ar==it,di=at(_t,ot.pointerId,"pointerId");Ae&$t&&(ot.button===0||Lr)?di<0&&(_t.push(ot),di=_t.length-1):Ae&(Kt|Ee)&&(zt=!0),!(di<0)&&(_t[di]=ot,this.callback(this.manager,Ae,{pointers:_t,changedPointers:[ot],pointerType:ar,srcEvent:ot}),zt&&_t.splice(di,1))}});var J={touchstart:$t,touchmove:Qt,touchend:Kt,touchcancel:Ee},Q="touchstart",ut="touchstart touchmove touchend touchcancel";function wt(){this.evTarget=Q,this.evWin=ut,this.started=!1,Be.apply(this,arguments)}z(wt,Be,{handler:function(ot){var _t=J[ot.type];if(_t===$t&&(this.started=!0),!!this.started){var zt=Nt.call(this,ot,_t);_t&(Kt|Ee)&&zt[0].length-zt[1].length===0&&(this.started=!1),this.callback(this.manager,_t,{pointers:zt[0],changedPointers:zt[1],pointerType:it,srcEvent:ot})}}});function Nt(ot,_t){var zt=dt(ot.touches),oe=dt(ot.changedTouches);return _t&(Kt|Ee)&&(zt=It(zt.concat(oe),"identifier")),[zt,oe]}var Vt={touchstart:$t,touchmove:Qt,touchend:Kt,touchcancel:Ee},Ft="touchstart touchmove touchend touchcancel";function Lt(){this.evTarget=Ft,this.targetIds={},Be.apply(this,arguments)}z(Lt,Be,{handler:function(ot){var _t=Vt[ot.type],zt=ne.call(this,ot,_t);zt&&this.callback(this.manager,_t,{pointers:zt[0],changedPointers:zt[1],pointerType:it,srcEvent:ot})}});function ne(ot,_t){var zt=dt(ot.touches),oe=this.targetIds;if(_t&($t|Qt)&&zt.length===1)return oe[zt[0].identifier]=!0,[zt,zt];var Ae,ar,Lr=dt(ot.changedTouches),di=[],Sn=this.target;if(ar=zt.filter(function(Mn){return mt(Mn.target,Sn)}),_t===$t)for(Ae=0;Ae<ar.length;)oe[ar[Ae].identifier]=!0,Ae++;for(Ae=0;Ae<Lr.length;)oe[Lr[Ae].identifier]&&di.push(Lr[Ae]),_t&(Kt|Ee)&&delete oe[Lr[Ae].identifier],Ae++;if(di.length)return[It(ar.concat(di),"identifier"),di]}var ue=2500,Zt=25;function be(){Be.apply(this,arguments);var ot=H(this.handler,this);this.touch=new Lt(this.manager,ot),this.mouse=new je(this.manager,ot),this.primaryTouch=null,this.lastTouches=[]}z(be,Be,{handler:function(ot,_t,zt){var oe=zt.pointerType==it,Ae=zt.pointerType==Pt;if(!(Ae&&zt.sourceCapabilities&&zt.sourceCapabilities.firesTouchEvents)){if(oe)We.call(this,_t,zt);else if(Ae&&Br.call(this,zt))return;this.callback(ot,_t,zt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function We(ot,_t){ot&$t?(this.primaryTouch=_t.changedPointers[0].identifier,Ke.call(this,_t)):ot&(Kt|Ee)&&Ke.call(this,_t)}function Ke(ot){var _t=ot.changedPointers[0];if(_t.identifier===this.primaryTouch){var zt={x:_t.clientX,y:_t.clientY};this.lastTouches.push(zt);var oe=this.lastTouches,Ae=function(){var ar=oe.indexOf(zt);ar>-1&&oe.splice(ar,1)};setTimeout(Ae,ue)}}function Br(ot){for(var _t=ot.srcEvent.clientX,zt=ot.srcEvent.clientY,oe=0;oe<this.lastTouches.length;oe++){var Ae=this.lastTouches[oe],ar=Math.abs(_t-Ae.x),Lr=Math.abs(zt-Ae.y);if(ar<=Zt&&Lr<=Zt)return!0}return!1}var tr=xt(c.style,"touchAction"),Ir=tr!==n,Sr="compute",oi="auto",Wr="manipulation",dr="none",Nr="pan-x",ei="pan-y",yi=Bo();function Pi(ot,_t){this.manager=ot,this.set(_t)}Pi.prototype={set:function(ot){ot==Sr&&(ot=this.compute()),Ir&&this.manager.element.style&&yi[ot]&&(this.manager.element.style[tr]=ot),this.actions=ot.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ot=[];return I(this.manager.recognizers,function(_t){nt(_t.options.enable,[_t])&&(ot=ot.concat(_t.getTouchAction()))}),tn(ot.join(" "))},preventDefaults:function(ot){var _t=ot.srcEvent,zt=ot.offsetDirection;if(this.manager.session.prevented){_t.preventDefault();return}var oe=this.actions,Ae=Dt(oe,dr)&&!yi[dr],ar=Dt(oe,ei)&&!yi[ei],Lr=Dt(oe,Nr)&&!yi[Nr];if(Ae){var di=ot.pointers.length===1,Sn=ot.distance<2,Mn=ot.deltaTime<250;if(di&&Sn&&Mn)return}if(!(Lr&&ar)&&(Ae||ar&&zt&st||Lr&&zt&mr))return this.preventSrc(_t)},preventSrc:function(ot){this.manager.session.prevented=!0,ot.preventDefault()}};function tn(ot){if(Dt(ot,dr))return dr;var _t=Dt(ot,Nr),zt=Dt(ot,ei);return _t&&zt?dr:_t||zt?_t?Nr:ei:Dt(ot,Wr)?Wr:oi}function Bo(){if(!Ir)return!1;var ot={},_t=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(zt){ot[zt]=_t?t.CSS.supports("touch-action",zt):!0}),ot}var Jr=1,Ln=2,ls=4,ki=8,Ri=ki,ko=16,Fi=32;function Ii(ot){this.options=F({},this.defaults,ot||{}),this.id=ee(),this.manager=null,this.options.enable=yt(this.options.enable,!0),this.state=Jr,this.simultaneous={},this.requireFail=[]}Ii.prototype={defaults:{},set:function(ot){return F(this.options,ot),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ot){if(C(ot,"recognizeWith",this))return this;var _t=this.simultaneous;return ot=xi(ot,this),_t[ot.id]||(_t[ot.id]=ot,ot.recognizeWith(this)),this},dropRecognizeWith:function(ot){return C(ot,"dropRecognizeWith",this)?this:(ot=xi(ot,this),delete this.simultaneous[ot.id],this)},requireFailure:function(ot){if(C(ot,"requireFailure",this))return this;var _t=this.requireFail;return ot=xi(ot,this),at(_t,ot)===-1&&(_t.push(ot),ot.requireFailure(this)),this},dropRequireFailure:function(ot){if(C(ot,"dropRequireFailure",this))return this;ot=xi(ot,this);var _t=at(this.requireFail,ot);return _t>-1&&this.requireFail.splice(_t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ot){return!!this.simultaneous[ot.id]},emit:function(ot){var _t=this,zt=this.state;function oe(Ae){_t.manager.emit(Ae,ot)}zt<ki&&oe(_t.options.event+Ro(zt)),oe(_t.options.event),ot.additionalEvent&&oe(ot.additionalEvent),zt>=ki&&oe(_t.options.event+Ro(zt))},tryEmit:function(ot){if(this.canEmit())return this.emit(ot);this.state=Fi},canEmit:function(){for(var ot=0;ot<this.requireFail.length;){if(!(this.requireFail[ot].state&(Fi|Jr)))return!1;ot++}return!0},recognize:function(ot){var _t=F({},ot);if(!nt(this.options.enable,[this,_t])){this.reset(),this.state=Fi;return}this.state&(Ri|ko|Fi)&&(this.state=Jr),this.state=this.process(_t),this.state&(Ln|ls|ki|ko)&&this.tryEmit(_t)},process:function(ot){},getTouchAction:function(){},reset:function(){}};function Ro(ot){return ot&ko?"cancel":ot&ki?"end":ot&ls?"move":ot&Ln?"start":""}function cs(ot){return ot==le?"down":ot==or?"up":ot==De?"left":ot==ze?"right":""}function xi(ot,_t){var zt=_t.manager;return zt?zt.get(ot):ot}function Kr(){Ii.apply(this,arguments)}z(Kr,Ii,{defaults:{pointers:1},attrTest:function(ot){var _t=this.options.pointers;return _t===0||ot.pointers.length===_t},process:function(ot){var _t=this.state,zt=ot.eventType,oe=_t&(Ln|ls),Ae=this.attrTest(ot);return oe&&(zt&Ee||!Ae)?_t|ko:oe||Ae?zt&Kt?_t|ki:_t&Ln?_t|ls:Ln:Fi}});function bn(){Kr.apply(this,arguments),this.pX=null,this.pY=null}z(bn,Kr,{defaults:{event:"pan",threshold:10,pointers:1,direction:Qe},getTouchAction:function(){var ot=this.options.direction,_t=[];return ot&st&&_t.push(ei),ot&mr&&_t.push(Nr),_t},directionTest:function(ot){var _t=this.options,zt=!0,oe=ot.distance,Ae=ot.direction,ar=ot.deltaX,Lr=ot.deltaY;return Ae&_t.direction||(_t.direction&st?(Ae=ar===0?Me:ar<0?De:ze,zt=ar!=this.pX,oe=Math.abs(ot.deltaX)):(Ae=Lr===0?Me:Lr<0?or:le,zt=Lr!=this.pY,oe=Math.abs(ot.deltaY))),ot.direction=Ae,zt&&oe>_t.threshold&&Ae&_t.direction},attrTest:function(ot){return Kr.prototype.attrTest.call(this,ot)&&(this.state&Ln||!(this.state&Ln)&&this.directionTest(ot))},emit:function(ot){this.pX=ot.deltaX,this.pY=ot.deltaY;var _t=cs(ot.direction);_t&&(ot.additionalEvent=this.options.event+_t),this._super.emit.call(this,ot)}});function _i(){Kr.apply(this,arguments)}z(_i,Kr,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[dr]},attrTest:function(ot){return this._super.attrTest.call(this,ot)&&(Math.abs(ot.scale-1)>this.options.threshold||this.state&Ln)},emit:function(ot){if(ot.scale!==1){var _t=ot.scale<1?"in":"out";ot.additionalEvent=this.options.event+_t}this._super.emit.call(this,ot)}});function Fo(){Ii.apply(this,arguments),this._timer=null,this._input=null}z(Fo,Ii,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[oi]},process:function(ot){var _t=this.options,zt=ot.pointers.length===_t.pointers,oe=ot.distance<_t.threshold,Ae=ot.deltaTime>_t.time;if(this._input=ot,!oe||!zt||ot.eventType&(Kt|Ee)&&!Ae)this.reset();else if(ot.eventType&$t)this.reset(),this._timer=S(function(){this.state=Ri,this.tryEmit()},_t.time,this);else if(ot.eventType&Kt)return Ri;return Fi},reset:function(){clearTimeout(this._timer)},emit:function(ot){this.state===Ri&&(ot&&ot.eventType&Kt?this.manager.emit(this.options.event+"up",ot):(this._input.timeStamp=w(),this.manager.emit(this.options.event,this._input)))}});function wn(){Kr.apply(this,arguments)}z(wn,Kr,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[dr]},attrTest:function(ot){return this._super.attrTest.call(this,ot)&&(Math.abs(ot.rotation)>this.options.threshold||this.state&Ln)}});function La(){Kr.apply(this,arguments)}z(La,Kr,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:st|mr,pointers:1},getTouchAction:function(){return bn.prototype.getTouchAction.call(this)},attrTest:function(ot){var _t=this.options.direction,zt;return _t&(st|mr)?zt=ot.overallVelocity:_t&st?zt=ot.overallVelocityX:_t&mr&&(zt=ot.overallVelocityY),this._super.attrTest.call(this,ot)&&_t&ot.offsetDirection&&ot.distance>this.options.threshold&&ot.maxPointers==this.options.pointers&&_(zt)>this.options.velocity&&ot.eventType&Kt},emit:function(ot){var _t=cs(ot.offsetDirection);_t&&this.manager.emit(this.options.event+_t,ot),this.manager.emit(this.options.event,ot)}});function Li(){Ii.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}z(Li,Ii,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Wr]},process:function(ot){var _t=this.options,zt=ot.pointers.length===_t.pointers,oe=ot.distance<_t.threshold,Ae=ot.deltaTime<_t.time;if(this.reset(),ot.eventType&$t&&this.count===0)return this.failTimeout();if(oe&&Ae&&zt){if(ot.eventType!=Kt)return this.failTimeout();var ar=this.pTime?ot.timeStamp-this.pTime<_t.interval:!0,Lr=!this.pCenter||Fe(this.pCenter,ot.center)<_t.posThreshold;this.pTime=ot.timeStamp,this.pCenter=ot.center,!Lr||!ar?this.count=1:this.count+=1,this._input=ot;var di=this.count%_t.taps;if(di===0)return this.hasRequireFailures()?(this._timer=S(function(){this.state=Ri,this.tryEmit()},_t.interval,this),Ln):Ri}return Fi},failTimeout:function(){return this._timer=S(function(){this.state=Fi},this.options.interval,this),Fi},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ri&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function us(ot,_t){return _t=_t||{},_t.recognizers=yt(_t.recognizers,us.defaults.preset),new hs(ot,_t)}us.VERSION="2.0.7",us.defaults={domEvents:!1,touchAction:Sr,enable:!0,inputTarget:null,inputClass:null,preset:[[wn,{enable:!1}],[_i,{enable:!1},["rotate"]],[La,{direction:st}],[bn,{direction:st},["swipe"]],[Li],[Li,{event:"doubletap",taps:2},["tap"]],[Fo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var xn=1,As=2;function hs(ot,_t){this.options=F({},us.defaults,_t||{}),this.options.inputTarget=this.options.inputTarget||ot,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ot,this.input=Ne(this),this.touchAction=new Pi(this,this.options.touchAction),Xr(this,!0),I(this.options.recognizers,function(zt){var oe=this.add(new zt[0](zt[1]));zt[2]&&oe.recognizeWith(zt[2]),zt[3]&&oe.requireFailure(zt[3])},this)}hs.prototype={set:function(ot){return F(this.options,ot),ot.touchAction&&this.touchAction.update(),ot.inputTarget&&(this.input.destroy(),this.input.target=ot.inputTarget,this.input.init()),this},stop:function(ot){this.session.stopped=ot?As:xn},recognize:function(ot){var _t=this.session;if(!_t.stopped){this.touchAction.preventDefaults(ot);var zt,oe=this.recognizers,Ae=_t.curRecognizer;(!Ae||Ae&&Ae.state&Ri)&&(Ae=_t.curRecognizer=null);for(var ar=0;ar<oe.length;)zt=oe[ar],_t.stopped!==As&&(!Ae||zt==Ae||zt.canRecognizeWith(Ae))?zt.recognize(ot):zt.reset(),!Ae&&zt.state&(Ln|ls|ki)&&(Ae=_t.curRecognizer=zt),ar++}},get:function(ot){if(ot instanceof Ii)return ot;for(var _t=this.recognizers,zt=0;zt<_t.length;zt++)if(_t[zt].options.event==ot)return _t[zt];return null},add:function(ot){if(C(ot,"add",this))return this;var _t=this.get(ot.options.event);return _t&&this.remove(_t),this.recognizers.push(ot),ot.manager=this,this.touchAction.update(),ot},remove:function(ot){if(C(ot,"remove",this))return this;if(ot=this.get(ot),ot){var _t=this.recognizers,zt=at(_t,ot);zt!==-1&&(_t.splice(zt,1),this.touchAction.update())}return this},on:function(ot,_t){if(ot!==n&&_t!==n){var zt=this.handlers;return I(kt(ot),function(oe){zt[oe]=zt[oe]||[],zt[oe].push(_t)}),this}},off:function(ot,_t){if(ot!==n){var zt=this.handlers;return I(kt(ot),function(oe){_t?zt[oe]&&zt[oe].splice(at(zt[oe],_t),1):delete zt[oe]}),this}},emit:function(ot,_t){this.options.domEvents&&hl(ot,_t);var zt=this.handlers[ot]&&this.handlers[ot].slice();if(!(!zt||!zt.length)){_t.type=ot,_t.preventDefault=function(){_t.srcEvent.preventDefault()};for(var oe=0;oe<zt.length;)zt[oe](_t),oe++}},destroy:function(){this.element&&Xr(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Xr(ot,_t){var zt=ot.element;if(zt.style){var oe;I(ot.options.cssProps,function(Ae,ar){oe=xt(zt.style,ar),_t?(ot.oldCssProps[oe]=zt.style[oe],zt.style[oe]=Ae):zt.style[oe]=ot.oldCssProps[oe]||""}),_t||(ot.oldCssProps={})}}function hl(ot,_t){var zt=r.createEvent("Event");zt.initEvent(ot,!0,!0),zt.gesture=_t,_t.target.dispatchEvent(zt)}F(us,{INPUT_START:$t,INPUT_MOVE:Qt,INPUT_END:Kt,INPUT_CANCEL:Ee,STATE_POSSIBLE:Jr,STATE_BEGAN:Ln,STATE_CHANGED:ls,STATE_ENDED:ki,STATE_RECOGNIZED:Ri,STATE_CANCELLED:ko,STATE_FAILED:Fi,DIRECTION_NONE:Me,DIRECTION_LEFT:De,DIRECTION_RIGHT:ze,DIRECTION_UP:or,DIRECTION_DOWN:le,DIRECTION_HORIZONTAL:st,DIRECTION_VERTICAL:mr,DIRECTION_ALL:Qe,Manager:hs,Input:Be,TouchAction:Pi,TouchInput:Lt,MouseInput:je,PointerEventInput:At,TouchMouseInput:be,SingleTouchInput:wt,Recognizer:Ii,AttrRecognizer:Kr,Tap:Li,Pan:bn,Swipe:La,Pinch:_i,Rotate:wn,Press:Fo,on:bt,off:vt,each:I,merge:U,extend:W,assign:F,inherit:z,bindFn:H,prefixed:xt});var ql=typeof t<"u"?t:typeof self<"u"?self:{};ql.Hammer=us,e.exports?e.exports=us:t[i]=us})(window,document,"Hammer")})(vB);var t1=vB.exports;const J$=av(t1),hu=QN({__proto__:null,default:J$},[t1]),bB=1,wB=2,Ax=4,K$={mousedown:bB,mousemove:wB,mouseup:Ax};function Q$(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return!0;return!1}function tW(e){const t=e.prototype.handler;e.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(Q$(i,n=>n.pointerId===r.pointerId)||i.push(r)),t.call(this,r)}}function eW(e){e.prototype.handler=function(t){let r=K$[t.type];r&bB&&t.button>=0&&(this.pressed=!0),r&wB&&t.which===0&&(r=Ax),this.pressed&&(r&Ax&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}tW(t1.PointerEventInput);eW(t1.MouseInput);const rW=t1.Manager;class gv{constructor(t,r,i){this.element=t,this.callback=r,this.options={enable:!0,...i}}}const iW=hu?[[hu.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[hu.Rotate,{enable:!1}],[hu.Pinch,{enable:!1}],[hu.Swipe,{enable:!1}],[hu.Pan,{threshold:0,enable:!1}],[hu.Press,{enable:!1}],[hu.Tap,{event:"doubletap",taps:2,enable:!1}],[hu.Tap,{event:"anytap",enable:!1}],[hu.Tap,{enable:!1}]]:null,KC={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},nW={doubletap:["tap"]},sW={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},XS={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},oW={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},QC={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},aW=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",jf=typeof window<"u"?window:global;let Ex=!1;try{const e={get passive(){return Ex=!0,!0}};jf.addEventListener("test",null,e),jf.removeEventListener("test",null)}catch{Ex=!1}const lW=aW.indexOf("firefox")!==-1,{WHEEL_EVENTS:cW}=XS,tP="wheel",eP=4.000244140625,uW=40,hW=.25;class dW extends gv{constructor(t,r,i){super(t,r,i),this.handleEvent=n=>{if(!this.options.enable)return;let s=n.deltaY;jf.WheelEvent&&(lW&&n.deltaMode===jf.WheelEvent.DOM_DELTA_PIXEL&&(s/=jf.devicePixelRatio),n.deltaMode===jf.WheelEvent.DOM_DELTA_LINE&&(s*=uW)),s!==0&&s%eP===0&&(s=Math.floor(s/eP)),n.shiftKey&&s&&(s=s*hW),this.callback({type:tP,center:{x:n.clientX,y:n.clientY},delta:-s,srcEvent:n,pointerType:"mouse",target:n.target})},this.events=(this.options.events||[]).concat(cW),this.events.forEach(n=>t.addEventListener(n,this.handleEvent,Ex?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t===tP&&(this.options.enable=r)}}const{MOUSE_EVENTS:pW}=XS,rP="pointermove",iP="pointerover",nP="pointerout",sP="pointerenter",oP="pointerleave";class fW extends gv{constructor(t,r,i){super(t,r,i),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,this.events=(this.options.events||[]).concat(pW),this.events.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t===rP&&(this.enableMoveEvent=r),t===iP&&(this.enableOverEvent=r),t===nP&&(this.enableOutEvent=r),t===sP&&(this.enableEnterEvent=r),t===oP&&(this.enableLeaveEvent=r)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(iP,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(nP,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(sP,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(oP,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.which===0&&(this.pressed=!1),this.pressed||this._emit(rP,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,r){this.callback({type:t,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}}const{KEY_EVENTS:mW}=XS,aP="keydown",lP="keyup";class gW extends gv{constructor(t,r,i){super(t,r,i),this.handleEvent=n=>{const s=n.target||n.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:aP,srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:lP,srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(mW),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(n=>t.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t===aP&&(this.enableDownEvent=r),t===lP&&(this.enableUpEvent=r)}}const cP="contextmenu";class yW extends gv{constructor(t,r,i){super(t,r,i),this.handleEvent=n=>{this.options.enable&&this.callback({type:cP,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,r){t===cP&&(this.options.enable=r)}}const Tx=1,D_=2,Cx=4,_W={pointerdown:Tx,pointermove:D_,pointerup:Cx,mousedown:Tx,mousemove:D_,mouseup:Cx},vW=1,bW=2,wW=3,xW=0,SW=1,AW=2,EW=1,TW=2,CW=4;function PW(e){const t=_W[e.srcEvent.type];if(!t)return null;const{buttons:r,button:i,which:n}=e.srcEvent;let s=!1,c=!1,a=!1;return t===Cx||t===D_&&!Number.isFinite(r)?(s=n===vW,c=n===bW,a=n===wW):t===D_?(s=!!(r&EW),c=!!(r&CW),a=!!(r&TW)):t===Tx&&(s=i===xW,c=i===SW,a=i===AW),{leftButton:s,middleButton:c,rightButton:a}}function IW(e,t){const r=e.center;if(!r)return null;const i=t.getBoundingClientRect(),n=i.width/t.offsetWidth||1,s=i.height/t.offsetHeight||1,c={x:(r.x-i.left-t.clientLeft)/n,y:(r.y-i.top-t.clientTop)/s};return{center:r,offsetCenter:c}}const v2={srcElement:"root",priority:0};class LW{constructor(t){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let n=r.srcEvent.target;for(;n&&n!==i.rootElement;){if(this._emit(i,n),i.handled)return;n=n.parentNode}this._emit(i,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,r,i){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:c,handlersByElement:a}=this;let p=v2;typeof i=="string"||i&&i.addEventListener?p={...v2,srcElement:i}:i&&(p={...v2,...i});let _=a.get(p.srcElement);_||(_=[],a.set(p.srcElement,_));const w={type:t,handler:r,srcElement:p.srcElement,priority:p.priority};n&&(w.once=!0),s&&(w.passive=!0),c.push(w),this._active=this._active||!w.passive;let S=_.length-1;for(;S>=0&&!(_[S].priority>=w.priority);)S--;_.splice(S+1,0,w)}remove(t,r){const{handlers:i,handlersByElement:n}=this;for(let s=i.length-1;s>=0;s--){const c=i[s];if(c.type===t&&c.handler===r){i.splice(s,1);const a=n.get(c.srcElement);a.splice(a.indexOf(c),1),a.length===0&&n.delete(c.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(t,r){const i=this.handlersByElement.get(r);if(i){let n=!1;const s=()=>{t.handled=!0},c=()=>{t.handled=!0,n=!0},a=[];for(let p=0;p<i.length;p++){const{type:_,handler:w,once:S}=i[p];if(w({...t,type:_,stopPropagation:s,stopImmediatePropagation:c}),S&&a.push(i[p]),n)break}for(let p=0;p<a.length;p++){const{type:_,handler:w}=a[p];this.remove(_,w)}}}_normalizeEvent(t){const r=this.eventManager.getElement();return{...t,...PW(t),...IW(t,r),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}}const MW={events:null,recognizers:null,recognizerOptions:{},Manager:rW,touchAction:"none",tabIndex:0};class BW{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1?arguments[1]:void 0;this._onBasicInput=n=>{const{srcEvent:s}=n,c=sW[s.type];c&&this.manager.emit(c,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={...MW,...r},this.events=new Map,this.setElement(t);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:r}=this,i=r.Manager;this.manager=new i(t,{touchAction:r.touchAction,recognizers:r.recognizers||iW}).on("hammer.input",this._onBasicInput),r.recognizers||Object.keys(KC).forEach(n=>{const s=this.manager.get(n);s&&KC[n].forEach(c=>{s.recognizeWith(c)})});for(const n in r.recognizerOptions){const s=this.manager.get(n);if(s){const c=r.recognizerOptions[n];delete c.enable,s.set(c)}}this.wheelInput=new dW(t,this._onOtherEvent,{enable:!1}),this.moveInput=new fW(t,this._onOtherEvent,{enable:!1}),this.keyInput=new gW(t,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new yW(t,this._onOtherEvent,{enable:!1});for(const[n,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(n,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,r,i){this._addEventHandler(t,r,i,!1)}once(t,r,i){this._addEventHandler(t,r,i,!0)}watch(t,r,i){this._addEventHandler(t,r,i,!1,!0)}off(t,r){this._removeEventHandler(t,r)}_toggleRecognizer(t,r){const{manager:i}=this;if(!i)return;const n=i.get(t);if(n&&n.options.enable!==r){n.set({enable:r});const s=nW[t];s&&!this.options.recognizers&&s.forEach(c=>{const a=i.get(c);r?(a.requireFailure(t),n.dropRequireFailure(c)):a.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,r),this.moveInput.enableEventType(t,r),this.keyInput.enableEventType(t,r),this.contextmenuInput.enableEventType(t,r)}_addEventHandler(t,r,i,n,s){if(typeof t!="string"){i=r;for(const w in t)this._addEventHandler(w,t[w],i,n,s);return}const{manager:c,events:a}=this,p=QC[t]||t;let _=a.get(p);_||(_=new LW(this),a.set(p,_),_.recognizerName=oW[p]||p,c&&c.on(p,_.handleEvent)),_.add(t,r,i,n,s),_.isEmpty()||this._toggleRecognizer(_.recognizerName,!0)}_removeEventHandler(t,r){if(typeof t!="string"){for(const c in t)this._removeEventHandler(c,t[c]);return}const{events:i}=this,n=QC[t]||t,s=i.get(n);if(s&&(s.remove(t,r),s.isEmpty())){const{recognizerName:c}=s;let a=!1;for(const p of i.values())if(p.recognizerName===c&&!p.isEmpty()){a=!0;break}a||this._toggleRecognizer(c,!1)}}}function tp(){}const kW=e=>{let{isDragging:t}=e;return t?"grabbing":"grab"},xB={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:tp,onResize:tp,onViewStateChange:tp,onInteractionStateChange:tp,onBeforeRender:tp,onAfterRender:tp,onLoad:tp,onError:e=>pi.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:kW,getTooltip:null,debug:!1,drawPickingColors:!1};class ZS{constructor(t){q(this,"props",void 0),q(this,"width",0),q(this,"height",0),q(this,"userData",{}),q(this,"canvas",null),q(this,"viewManager",null),q(this,"layerManager",null),q(this,"effectManager",null),q(this,"deckRenderer",null),q(this,"deckPicker",null),q(this,"eventManager",null),q(this,"tooltip",null),q(this,"metrics",void 0),q(this,"animationLoop",void 0),q(this,"stats",void 0),q(this,"viewState",void 0),q(this,"cursorState",void 0),q(this,"_needsRedraw",void 0),q(this,"_pickRequest",void 0),q(this,"_lastPointerDownInfo",null),q(this,"_metricsCounter",void 0),q(this,"_onPointerMove",r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const n=r.offsetCenter;if(!n)return;i.x=n.x,i.y=n.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r}),q(this,"_onEvent",r=>{const i=qT[r.type],n=r.offsetCenter;if(!i||!n||!this.layerManager)return;const s=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:s,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:a}=c,p=a&&(a[i.handler]||a.props[i.handler]),_=this.props[i.handler];let w=!1;p&&(w=p.call(a,c,r)),!w&&_&&_(c,r)}),q(this,"_onPointerDown",r=>{const i=r.offsetCenter,n=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=n.result[0]||n.emptyInfo}),this.props={...xB,...t},t=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},t.viewState&&t.initialViewState&&pi.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),XM()==="IE"&&pi.warn("IE 11 is not supported")(),this.viewState=t.initialViewState,t.gl||typeof document<"u"&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new q0({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&L0.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,r,i,n,s,c,a,p;if((t=this.animationLoop)===null||t===void 0||t.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)===null||r===void 0||r.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(n=this.effectManager)===null||n===void 0||n.finalize(),this.effectManager=null,(s=this.deckRenderer)===null||s===void 0||s.finalize(),this.deckRenderer=null,(c=this.deckPicker)===null||c===void 0||c.finalize(),this.deckPicker=null,(a=this.eventManager)===null||a===void 0||a.destroy(),this.eventManager=null,(p=this.tooltip)===null||p===void 0||p.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var _;(_=this.canvas.parentElement)===null||_===void 0||_.removeChild(this.canvas),this.canvas=null}}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&pi.removed("onLayerHover","onHover")(),"onLayerClick"in t&&pi.removed("onLayerClick","onClick")(),t.initialViewState&&!wu(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(t),n=this.layerManager.needsRedraw(t),s=this.effectManager.needsRedraw(t),c=this.deckRenderer.needsRedraw(t);return r=r||i||n||s||c,r}redraw(t){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=t||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return Qs(this.viewManager),this.viewManager.views}getViewports(t){return Qs(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const r=this._pick("pickObject","pickObject Time",t).result;return r.length?r[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const i in t)this.layerManager.resourceManager.add({resourceId:i,data:t[i],forceUpdate:r})}_removeResources(t){for(const r of t)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_pick(t,r,i){Qs(this.deckPicker);const{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(r).timeStart();const s=this.deckPicker[t]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return n.get(r).timeEnd(),s}_createCanvas(t){let r=t.canvas;return typeof r=="string"&&(r=document.getElementById(r),Qs(r)),r||(r=document.createElement("canvas"),r.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(r)),Object.assign(r.style,t.style),r}_setCanvasSize(t){if(!this.canvas)return;const{width:r,height:i}=t;if(r||r===0){const s=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.width=s}if(i||i===0){var n;const s=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((n=t.style)===null||n===void 0?void 0:n.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var t,r;const{canvas:i}=this;if(!i)return;const n=(t=i.clientWidth)!==null&&t!==void 0?t:i.width,s=(r=i.clientHeight)!==null&&r!==void 0?r:i.height;if(n!==this.width||s!==this.height){var c,a;this.width=n,this.height=s,(c=this.viewManager)===null||c===void 0||c.setProps({width:n,height:s}),(a=this.layerManager)===null||a===void 0||a.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:s})}}_createAnimationLoop(t){const{width:r,height:i,gl:n,glOptions:s,debug:c,onError:a,onBeforeRender:p,onAfterRender:_,useDevicePixels:w}=t;return new nG({width:r,height:i,useDevicePixels:w,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,gl:n,onCreateContext:S=>p6({...s,...S,canvas:this.canvas,debug:c,onContextLost:()=>this._onContextLost()}),onInitialize:S=>this._setGLContext(S.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:p,onAfterRender:_,onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new WS({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:i,emptyInfo:n}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=i.length>0;let s=n,c=!1;for(const a of i){var r;s=a,c=((r=a.layer)===null||r===void 0?void 0:r.onHover(a,t.event))||c}if(!c&&this.props.onHover&&this.props.onHover(s,t.event),this.props.getTooltip&&this.tooltip){const a=this.props.getTooltip(s);this.tooltip.setTooltip(a,s.x,s.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,xS(t,{enable:!0,copyState:!0})),this.tooltip=new Y$(this.canvas),vh(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const r=new rB;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new BW(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const n in qT)this.eventManager.on(n,this._onEvent);this.viewManager=new x$({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new w$(t,{deck:this,stats:this.stats,viewport:i,timeline:r}),this.effectManager=new z$,this.deckRenderer=new G$(t),this.deckPicker=new X$(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,r){const{gl:i}=this.layerManager.context;vh(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r}),this.props.onAfterRender({gl:i})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),pi.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const r=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const r=this.animationLoop.stats;t.get("GPU Time").addTime(r.get("GPU Time").lastTiming),t.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:r}=this;t.fps=r.get("frameRate").getHz(),t.setPropsTime=r.get("setProps Time").time,t.updateAttributesTime=r.get("Update Attributes").time,t.framesRedrawn=r.get("Redraw Count").count,t.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,t.pickCount=r.get("Pick Count").count,t.gpuTime=r.get("GPU Time").time,t.cpuTime=r.get("CPU Time").time,t.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=r.get("CPU Time").getAverageTime();const i=fp.get("Memory Usage");t.bufferMemory=i.get("Buffer Memory").count,t.textureMemory=i.get("Texture Memory").count,t.renderbufferMemory=i.get("Renderbuffer Memory").count,t.gpuMemory=i.get("GPU Memory").count}}q(ZS,"defaultProps",xB);q(ZS,"VERSION",u9);class b2{constructor(t,r){q(this,"opts",void 0),q(this,"source",void 0),this.opts=r,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),r=this.getAccessor();if(t)return[t,r];const{value:i}=this.source,{size:n}=r;let s=i;if(i&&i.length!==n){s=new Float32Array(n);const c=r.elementOffset||0;for(let a=0;a<n;++a)s[a]=i[c+a]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function RW(e){switch(e){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Ny(e){return e.stride||e.size*e.bytesPerElement}function SB(e,t){t.offset&&pi.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const r=Ny(e),i=t.vertexOffset!==void 0?t.vertexOffset:e.vertexOffset||0,n=t.elementOffset||0,s=i*r+n*e.bytesPerElement+(e.offset||0);return{...t,offset:s,stride:r}}function FW(e,t){const r=SB(e,t);return{high:r,low:{...r,offset:r.offset+e.size*4}}}class DW{constructor(t,r,i){q(this,"gl",void 0),q(this,"id",void 0),q(this,"size",void 0),q(this,"settings",void 0),q(this,"value",void 0),q(this,"doublePrecision",void 0),q(this,"_buffer",void 0),q(this,"state",void 0),this.gl=t,this.id=r.id||"",this.size=r.size||1;const n=r.logicalType||r.type,s=n===5130;let{defaultValue:c}=r;c=Number.isFinite(c)?[c]:c||new Array(this.size).fill(0);let a;s?a=5126:!n&&r.isIndexed?a=t&&ES(t,nn.ELEMENT_INDEX_UINT32)?5125:5123:a=n||5126;let p=RW(n||a||5126);this.doublePrecision=s,s&&r.fp64===!1&&(p=Float32Array),this.value=null,this.settings={...r,defaultType:p,defaultValue:c,logicalType:n,type:a,size:this.size,bytesPerElement:p.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:t,type:r}=this.settings;this._buffer=new Wi(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:r}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*Ny(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),L0.release(this.state.allocatedValue)}getShaderAttributes(t,r){if(this.doublePrecision){const i={},n=this.value instanceof Float64Array,s=FW(this.getAccessor(),r||{});return i[t]=new b2(this,s.high),i["".concat(t,"64Low")]=n?new b2(this,s.low):new Float32Array(this.size),i}if(r){const i=SB(this.getAccessor(),r);return{[t]:new b2(this,i)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const r=Array.from(this.value);t=[r,r]}else{const{value:r,numInstances:i,size:n}=this,s=i*n;if(r&&s&&r.length>=s){const c=new Array(n).fill(1/0),a=new Array(n).fill(-1/0);for(let p=0;p<s;)for(let _=0;_<n;_++){const w=r[p++];w<c[_]&&(c[_]=w),w>a[_]&&(a[_]=w)}t=[c,a]}}return this.state.bounds=t,t}setData(t){const{state:r}=this;let i;ArrayBuffer.isView(t)?i={value:t}:t instanceof Wi?i={buffer:t}:i=t;const n={...this.settings,...i};if(r.bufferAccessor=n,r.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!r.constant||!this._areValuesEqual(s,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=s}else if(i.buffer){const s=i.buffer;r.externalBuffer=s,r.constant=!1,this.value=i.value||null;const c=i.value instanceof Float64Array;n.type=i.type||s.accessor.type,n.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(c?2:1),n.stride=Ny(n)}else if(i.value){this._checkExternalBuffer(i);let s=i.value;r.externalBuffer=null,r.constant=!1,this.value=s,n.bytesPerElement=s.BYTES_PER_ELEMENT,n.stride=Ny(n);const{buffer:c,byteOffset:a}=this;this.doublePrecision&&s instanceof Float64Array&&(s=g2(s,n));const p=s.byteLength+a+n.stride*2;c.byteLength<p&&c.reallocate(p),c.setAccessor(null),c.subData({data:s,offset:a}),n.type=i.type||c.accessor.type}return!0}updateSubBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const r=this.value,{startOffset:i=0,endOffset:n}=t;this.buffer.subData({data:this.doublePrecision&&r instanceof Float64Array?g2(r,{size:this.size,startIndex:i,endIndex:n}):r.subarray(i,n),offset:i*r.BYTES_PER_ELEMENT+this.byteOffset})}allocate(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:i}=this,n=i.allocatedValue,s=L0.allocate(n,t+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=s;const{buffer:c,byteOffset:a}=this;return c.byteLength<s.byteLength+a&&(c.reallocate(s.byteLength+a),r&&n&&c.subData({data:n instanceof Float64Array?g2(n,this):n,offset:a})),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:r}=t;if(!ArrayBuffer.isView(r))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let n=!1;if(this.doublePrecision&&(n=r.BYTES_PER_ELEMENT<4),n)throw new Error("Attribute ".concat(this.id," does not support ").concat(r.constructor.name));!(r instanceof i)&&this.settings.normalized&&!("normalized"in t)&&pi.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map(r=>(r+128)/255*2-1);case 5122:return new Float32Array(t).map(r=>(r+32768)/65535*2-1);case 5121:return new Float32Array(t).map(r=>r/255);case 5123:return new Float32Array(t).map(r=>r/65535);default:return t}}_normalizeValue(t,r,i){const{defaultValue:n,size:s}=this.settings;if(Number.isFinite(t))return r[i]=t,r;if(!t){let c=s;for(;--c>=0;)r[i+c]=n[c];return r}switch(s){case 4:r[i+3]=Number.isFinite(t[3])?t[3]:n[3];case 3:r[i+2]=Number.isFinite(t[2])?t[2]:n[2];case 2:r[i+1]=Number.isFinite(t[1])?t[1]:n[1];case 1:r[i+0]=Number.isFinite(t[0])?t[0]:n[0];break;default:let c=s;for(;--c>=0;)r[i+c]=Number.isFinite(t[c])?t[c]:n[c]}return r}_areValuesEqual(t,r){if(!t||!r)return!1;const{size:i}=this;for(let n=0;n<i;n++)if(t[n]!==r[n])return!1;return!0}}const uP=[],hP=[];function AB(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,i=uP;const n={index:-1,data:e,target:[]};return e?typeof e[Symbol.iterator]=="function"?i=e:e.length>0&&(hP.length=e.length,i=hP):i=uP,(t>0||Number.isFinite(r))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,r),n.index=t-1),{iterable:i,objectInfo:n}}function EB(e){return e&&e[Symbol.asyncIterator]}function NW(e,t){const{size:r,stride:i,offset:n,startIndices:s,nested:c}=t,a=e.BYTES_PER_ELEMENT,p=i?i/a:r,_=n?n/a:0,w=Math.floor((e.length-_)/p);return(S,C)=>{let{index:I,target:N}=C;if(!s){const z=I*p+_;for(let H=0;H<r;H++)N[H]=e[z+H];return N}const F=s[I],W=s[I+1]||w;let U;if(c){U=new Array(W-F);for(let z=F;z<W;z++){const H=z*p+_;N=new Array(r);for(let nt=0;nt<r;nt++)N[nt]=e[H+nt];U[z-F]=N}}else if(p===r)U=e.subarray(F*r+_,W*r+_);else{U=new e.constructor((W-F)*r);let z=0;for(let H=F;H<W;H++){const nt=H*p+_;for(let yt=0;yt<r;yt++)U[z++]=e[nt+yt]}}return U}}const OW=[],Oy=[[0,1/0]];function zW(e,t){if(e===Oy||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;const r=[],i=e.length;let n=0;for(let s=0;s<i;s++){const c=e[s];c[1]<t[0]?(r.push(c),n=s+1):c[0]>t[1]?r.push(c):t=[Math.min(c[0],t[0]),Math.max(c[1],t[1])]}return r.splice(n,0,t),r}function w2(e){const{source:t,target:r,start:i=0,size:n,getData:s}=e,c=e.end||r.length,a=t.length,p=c-i;if(a>p){r.set(t.subarray(0,p),i);return}if(r.set(t,i),!s)return;let _=a;for(;_<p;){const w=s(_,t);for(let S=0;S<n;S++)r[i+_]=w[S]||0,_++}}function jW(e){let{source:t,target:r,size:i,getData:n,sourceStartIndices:s,targetStartIndices:c}=e;if(!Array.isArray(c))return w2({source:t,target:r,size:i,getData:n}),r;let a=0,p=0;const _=n&&((S,C)=>n(S+p,C)),w=Math.min(s.length,c.length);for(let S=1;S<w;S++){const C=s[S]*i,I=c[S]*i;w2({source:t.subarray(a,C),target:r,start:p,end:I,size:i,getData:_}),a=C,p=I}return p<r.length&&w2({source:[],target:r,start:p,size:i,getData:_}),r}const UW={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function TB(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const r=e.type||"interpolation";return{...UW[r],...t,...e,type:r}}function CB(e,t){const r=t.getBuffer();return r?[r,{divisor:0,size:t.size,normalized:t.settings.normalized}]:t.value}function PB(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(e,'"'))}}function IB(e){e.push(e.shift())}function YS(e,t){const{doublePrecision:r,settings:i,value:n,size:s}=e,c=r&&n instanceof Float64Array?2:1;return(i.noAlloc?n.length:t*s)*c}function LB(e){let{buffer:t,numInstances:r,attribute:i,fromLength:n,fromStartIndices:s,getData:c=z=>z}=e;const a=i.doublePrecision&&i.value instanceof Float64Array?2:1,p=i.size*a,_=i.byteOffset,w=i.startIndices,S=s&&w,C=YS(i,r),I=i.isConstant;if(!S&&n>=C)return;const N=I?i.value:i.getBuffer().getData({srcByteOffset:_});if(i.settings.normalized&&!I){const z=c;c=(H,nt)=>i.normalizeConstant(z(H,nt))}const F=I?(z,H)=>c(N,H):(z,H)=>c(N.subarray(z,z+p),H),W=t.getData({length:n}),U=new Float32Array(C);jW({source:W,target:U,sourceStartIndices:s,targetStartIndices:w,size:p,getData:F}),t.byteLength<U.byteLength+_&&t.reallocate(U.byteLength+_),t.subData({data:U,offset:_})}class JS extends DW{constructor(t,r){super(t,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Oy}),q(this,"constant",!1),this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=this.state.needsRedraw;return this.state.needsRedraw=r&&!t,r}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:r}=this.settings,i=this.settings.transition,n=Array.isArray(r)?t[r.find(s=>t[s])]:t[r];return TB(n,i)}setNeedsUpdate(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,r=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),r){const{startRow:i=0,endRow:n=1/0}=r;this.state.updateRanges=zW(this.state.updateRanges,[i,n])}else this.state.updateRanges=Oy}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=OW}setNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:r,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(t,r.updateRanges!==Oy),!0):!1}updateBuffer(t){let{numInstances:r,data:i,props:n,context:s}=t;if(!this.needsUpdate())return!1;const{state:{updateRanges:c},settings:{update:a,noAlloc:p}}=this;let _=!0;if(a){for(const[w,S]of c)a.call(s,this,{data:i,startRow:w,endRow:S,props:n,numInstances:r});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[w,S]of c){const C=Number.isFinite(w)?this.getVertexOffset(w):0,I=Number.isFinite(S)?this.getVertexOffset(S):p||!Number.isFinite(r)?this.value.length:r*this.size;super.updateSubBuffer({startOffset:C,endOffset:I})}this._checkAttributeArray()}else _=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),_}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:r}=this;return t?(this.clearNeedsUpdate(),r.lastExternalBuffer===t||(r.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:i,settings:n}=this;if(!t)return i.binaryValue=null,i.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(i.binaryValue===t)return this.clearNeedsUpdate(),!0;if(i.binaryValue=t,this.setNeedsRedraw(),n.transform||r!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const s=t;Qs(ArrayBuffer.isView(s.value),"invalid ".concat(n.accessor));const c=!!s.size&&s.size!==this.size;return i.binaryAccessor=NW(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:r,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:r}=this;return(r?t<r.length?r[t]:this.numInstances:t)*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},r={};for(const i in t)Object.assign(r,super.getShaderAttributes(i,t[i]));return r}_autoUpdater(t,r){let{data:i,startRow:n,endRow:s,props:c,numInstances:a}=r;if(t.constant)return;const{settings:p,state:_,value:w,size:S,startIndices:C}=t,{accessor:I,transform:N}=p,F=_.binaryAccessor||(typeof I=="function"?I:c[I]);Qs(typeof F=="function",'accessor "'.concat(I,'" is not a function'));let W=t.getVertexOffset(n);const{iterable:U,objectInfo:z}=AB(i,n,s);for(const H of U){z.index++;let nt=F(H,z);if(N&&(nt=N.call(this,nt)),C){const yt=(z.index<C.length-1?C[z.index+1]:a)-C[z.index];if(nt&&Array.isArray(nt[0])){let bt=W;for(const vt of nt)t._normalizeValue(vt,w,bt),bt+=S}else nt&&nt.length>S?w.set(nt,W):(t._normalizeValue(nt,z.target,0),d$({target:w,source:z.target,start:W,count:yt}));W+=yt*S}else t._normalizeValue(nt,w,W),W+=S}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,r=Math.min(4,this.size);if(t&&t.length>=r){let i=!0;switch(r){case 4:i=i&&Number.isFinite(t[3]);case 3:i=i&&Number.isFinite(t[2]);case 2:i=i&&Number.isFinite(t[1]);case 1:i=i&&Number.isFinite(t[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class GW{constructor(t){let{gl:r,attribute:i,timeline:n}=t;q(this,"gl",void 0),q(this,"type","interpolation"),q(this,"attributeInTransition",void 0),q(this,"settings",void 0),q(this,"attribute",void 0),q(this,"transition",void 0),q(this,"currentStartIndices",void 0),q(this,"currentLength",void 0),q(this,"transform",void 0),q(this,"buffers",void 0),this.gl=r,this.transition=new Q0(n),this.attribute=i,this.attributeInTransition=new JS(r,i.settings),this.currentStartIndices=i.startIndices,this.currentLength=0,this.transform=qW(r,i);const s={byteLength:0,usage:35050};this.buffers=[new Wi(r,s),new Wi(r,s)]}get inProgress(){return this.transition.inProgress}start(t,r){if(t.duration<=0){this.transition.cancel();return}this.settings=t;const{gl:i,buffers:n,attribute:s}=this;IB(n);const c={numInstances:r,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const a of n)LB({buffer:a,...c});this.currentStartIndices=s.startIndices,this.currentLength=YS(s,r),this.attributeInTransition.setData({buffer:n[1],value:s.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:n[0],aTo:CB(i,s)},feedbackBuffers:{vCurrent:n[1]}})}update(){const t=this.transition.update();if(t){const{duration:r,easing:i}=this.settings,{time:n}=this.transition;let s=n/r;i&&(s=i(s)),this.transform.run({uniforms:{time:s}})}return t}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0}}const VW=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function qW(e,t){const r=PB(t.size);return new zS(e,{vs:VW,defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"]})}class HW{constructor(t){let{gl:r,attribute:i,timeline:n}=t;q(this,"gl",void 0),q(this,"type","spring"),q(this,"attributeInTransition",void 0),q(this,"settings",void 0),q(this,"attribute",void 0),q(this,"transition",void 0),q(this,"currentStartIndices",void 0),q(this,"currentLength",void 0),q(this,"texture",void 0),q(this,"framebuffer",void 0),q(this,"transform",void 0),q(this,"buffers",void 0),this.gl=r,this.type="spring",this.transition=new Q0(n),this.attribute=i,this.attributeInTransition=new JS(r,{...i.settings,normalized:!1}),this.currentStartIndices=i.startIndices,this.currentLength=0,this.texture=WW(r),this.framebuffer=XW(r,this.texture),this.transform=$W(r,i,this.framebuffer);const s={byteLength:0,usage:35050};this.buffers=[new Wi(r,s),new Wi(r,s),new Wi(r,s)]}get inProgress(){return this.transition.inProgress}start(t,r){const{gl:i,buffers:n,attribute:s}=this,c={numInstances:r,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const a of n)LB({buffer:a,...c});this.settings=t,this.currentStartIndices=s.startIndices,this.currentLength=YS(s,r),this.attributeInTransition.setData({buffer:n[1],value:s.value}),this.transition.start({...t,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:CB(i,s)}})}update(){const{buffers:t,transform:r,framebuffer:i,transition:n}=this;if(!n.update())return!1;const s=this.settings;return r.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),r.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:s.stiffness,damping:s.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),IB(t),this.attributeInTransition.setData({buffer:t[1],value:this.attribute.value}),fv(i)[0]>0||n.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function $W(e,t,r){const i=PB(t.size);return new zS(e,{framebuffer:r,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function WW(e){return new ll(e,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function XW(e,t){return new Ss(e,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:t}})}const ZW={interpolation:GW,spring:HW};class YW{constructor(t,r){let{id:i,timeline:n}=r;q(this,"id",void 0),q(this,"isSupported",void 0),q(this,"gl",void 0),q(this,"timeline",void 0),q(this,"transitions",void 0),q(this,"needsRedraw",void 0),q(this,"numInstances",void 0),this.id=i,this.gl=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=zS.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update(t){let{attributes:r,transitions:i,numInstances:n}=t;this.numInstances=n||1;for(const s in r){const c=r[s],a=c.getTransitionSetting(i);a&&this._updateAttribute(s,c,a)}for(const s in this.transitions){const c=r[s];(!c||!c.getTransitionSetting(i))&&this._removeTransition(s)}}hasAttribute(t){const r=this.transitions[t];return r&&r.inProgress}getAttributes(){const t={};for(const r in this.transitions){const i=this.transitions[r];i.inProgress&&(t[r]=i.attributeInTransition)}return t}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,r,i){const n=this.transitions[t];let s=!n||n.type!==i.type;if(s){if(!this.isSupported){pi.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();return}n&&this._removeTransition(t);const c=ZW[i.type];c?this.transitions[t]=new c({attribute:r,timeline:this.timeline,gl:this.gl}):(pi.error("unsupported transition type '".concat(i.type,"'"))(),s=!1)}(s||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(i,this.numInstances))}}const dP="attributeManager.invalidate",JW="attributeManager.updateStart",KW="attributeManager.updateEnd",QW="attribute.updateStart",tX="attribute.allocate",eX="attribute.updateEnd";class rX{constructor(t){let{id:r="attribute-manager",stats:i,timeline:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};q(this,"id",void 0),q(this,"gl",void 0),q(this,"attributes",void 0),q(this,"updateTriggers",void 0),q(this,"needsRedraw",void 0),q(this,"userData",void 0),q(this,"stats",void 0),q(this,"attributeTransitionManager",void 0),q(this,"mergeBoundsMemoized",K0(i$)),this.id=r,this.gl=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new YW(t,{id:"".concat(r,"-transitions"),timeline:n}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(const r of t)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(t,r){const i=this._invalidateTrigger(t,r);Eo(dP,this,t,i)}invalidateAll(t){for(const r in this.attributes)this.attributes[r].setNeedsUpdate(r,t);Eo(dP,this,"all")}update(t){let{data:r,numInstances:i,startIndices:n=null,transitions:s,props:c={},buffers:a={},context:p={}}=t,_=!1;Eo(JW,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const w in this.attributes){const S=this.attributes[w],C=S.settings.accessor;S.startIndices=n,S.numInstances=i,c[w]&&pi.removed("props.".concat(w),"data.attributes.".concat(w))(),S.setExternalBuffer(a[w])||S.setBinaryValue(typeof C=="string"?a[C]:void 0,r.startIndices)||typeof C=="string"&&!a[C]&&S.setConstantValue(c[C])||S.needsUpdate()&&(_=!0,this._updateAttribute({attribute:S,numInstances:i,data:r,props:c,context:p})),this.needsRedraw=this.needsRedraw||S.needsRedraw()}_&&Eo(KW,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:s})}updateTransition(){const{attributeTransitionManager:t}=this,r=t.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return this.attributes}getBounds(t){const r=t.map(i=>{var n;return(n=this.attributes[i])===null||n===void 0?void 0:n.getBounds()});return this.mergeBoundsMemoized(r)}getChangedAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:r,attributeTransitionManager:i}=this,n={...i.getAttributes()};for(const s in r){const c=r[s];c.needsRedraw(t)&&!i.hasAttribute(s)&&(n[s]=c)}return n}getShaderAttributes(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t||(t=this.getAttributes());const i={};for(const n in t)r[n]||Object.assign(i,t[n].getShaderAttributes());return i}_add(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(const i in t){const n=t[i];this.attributes[i]=this._createAttribute(i,n,r)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,r,i){const n={...r,id:t,size:r.isIndexed&&1||r.size||1,divisor:i.instanced?1:r.divisor||0};return new JS(this.gl,n)}_mapUpdateTriggersToAttributes(){const t={};for(const r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(i=>{t[i]||(t[i]=[]),t[i].push(r)});this.updateTriggers=t}_invalidateTrigger(t,r){const{attributes:i,updateTriggers:n}=this,s=n[t];return s&&s.forEach(c=>{const a=i[c];a&&a.setNeedsUpdate(a.id,r)}),s}_updateAttribute(t){const{attribute:r,numInstances:i}=t;if(Eo(QW,r),r.constant){r.setConstantValue(r.value);return}r.allocate(i)&&Eo(tX,r,i),r.updateBuffer(t)&&(this.needsRedraw=!0,Eo(eX,r,i))}}class iX extends Q0{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:r,toValue:i,duration:n,easing:s}}=this,c=s(t/n);this._value=L_(r,i,c)}}const pP=1e-5;function fP(e,t,r,i,n){const s=t-e,c=(r-t)*n,a=-s*i;return c+a+s+t}function nX(e,t,r,i,n){if(Array.isArray(r)){const s=[];for(let c=0;c<r.length;c++)s[c]=fP(e[c],t[c],r[c],i,n);return s}return fP(e,t,r,i,n)}function mP(e,t){if(Array.isArray(e)){let r=0;for(let i=0;i<e.length;i++){const n=e[i]-t[i];r+=n*n}return Math.sqrt(r)}return Math.abs(e-t)}class sX extends Q0{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:r,damping:i,stiffness:n}=this.settings,{_prevValue:s=t,_currValue:c=t}=this;let a=nX(s,c,r,i,n);const p=mP(a,r),_=mP(a,c);p<pP&&_<pP&&(a=r,this.end()),this._prevValue=c,this._currValue=a}}const oX={interpolation:iX,spring:sX};class aX{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,r,i,n){const{transitions:s}=this;if(s.has(t)){const p=s.get(t),{value:_=p.settings.fromValue}=p;r=_,this.remove(t)}if(n=TB(n),!n)return;const c=oX[n.type];if(!c){pi.error("unsupported transition type '".concat(n.type,"'"))();return}const a=new c(this.timeline);a.start({...n,fromValue:r,toValue:i}),s.set(t,a)}remove(t){const{transitions:r}=this;r.has(t)&&(r.get(t).cancel(),r.delete(t))}update(){const t={};for(const[r,i]of this.transitions)i.update(),t[r]=i.value,i.inProgress||this.remove(r);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function lX(e){const t=e[vd];for(const r in t){const i=t[r],{validate:n}=i;if(n&&!n(e[r],i))throw new Error("Invalid prop ".concat(r,": ").concat(e[r]))}}function cX(e,t){const r=MB({newProps:e,oldProps:t,propTypes:e[vd],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=hX(e,t);let n=!1;return i||(n=dX(e,t)),{dataChanged:i,propsChanged:r,updateTriggersChanged:n,extensionsChanged:pX(e,t),transitionsChanged:uX(e,t)}}function uX(e,t){if(!e.transitions)return!1;const r={},i=e[vd];let n=!1;for(const s in e.transitions){const c=i[s],a=c&&c.type;(a==="number"||a==="color"||a==="array")&&Px(e[s],t[s],c)&&(r[s]=!0,n=!0)}return n?r:!1}function MB(e){let{newProps:t,oldProps:r,ignoreProps:i={},propTypes:n={},triggerName:s="props"}=e;if(r===t)return!1;if(typeof t!="object"||t===null||typeof r!="object"||r===null)return"".concat(s," changed shallowly");for(const c of Object.keys(t))if(!(c in i)){if(!(c in r))return"".concat(s,".").concat(c," added");const a=Px(t[c],r[c],n[c]);if(a)return"".concat(s,".").concat(c," ").concat(a)}for(const c of Object.keys(r))if(!(c in i)){if(!(c in t))return"".concat(s,".").concat(c," dropped");if(!Object.hasOwnProperty.call(t,c)){const a=Px(t[c],r[c],n[c]);if(a)return"".concat(s,".").concat(c," ").concat(a)}}return!1}function Px(e,t,r){let i=r&&r.equal;return i&&!i(e,t,r)||!i&&(i=e&&t&&e.equals,i&&!i.call(e,t))?"changed deeply":!i&&t!==e?"changed shallowly":null}function hX(e,t){if(t===null)return"oldProps is null, initial diff";let r=!1;const{dataComparator:i,_dataDiff:n}=e;return i?i(e.data,t.data)||(r="Data comparator detected a change"):e.data!==t.data&&(r="A new data container was supplied"),r&&n&&(r=n(e.data,t.data)||r),r}function dX(e,t){if(t===null)return{all:!0};if("all"in e.updateTriggers&&gP(e,t,"all"))return{all:!0};const r={};let i=!1;for(const n in e.updateTriggers)n!=="all"&&gP(e,t,n)&&(r[n]=!0,i=!0);return i?r:!1}function pX(e,t){if(t===null)return!0;const r=t.extensions,{extensions:i}=e;if(i===r)return!1;if(!r||!i||i.length!==r.length)return!0;for(let n=0;n<i.length;n++)if(!i[n].equals(r[n]))return!0;return!1}function gP(e,t,r){let i=e.updateTriggers[r];i=i??{};let n=t.updateTriggers[r];return n=n??{},MB({oldProps:n,newProps:i,triggerName:r})}const fX="count(): argument not an object",mX="count(): argument not a container";function gX(e){if(!_X(e))throw new Error(fX);if(typeof e.count=="function")return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(yX(e))return Object.keys(e).length;throw new Error(mX)}function yX(e){return e!==null&&typeof e=="object"&&e.constructor===Object}function _X(e){return e!==null&&typeof e=="object"}function vX(e,t){if(!t)return e;const r={...e,...t};if("defines"in t&&(r.defines={...e.defines,...t.defines}),"modules"in t&&(r.modules=(e.modules||[]).concat(t.modules),t.modules.some(i=>i.name==="project64"))){const i=r.modules.findIndex(n=>n.name==="project32");i>=0&&r.modules.splice(i,1)}if("inject"in t)if(!e.inject)r.inject=t.inject;else{const i={...e.inject};for(const n in t.inject)i[n]=(i[n]||"")+t.inject[n];r.inject=i}return r}const bX={10241:9987,10240:9729,10242:33071,10243:33071},Ix={};function wX(e,t,r,i){if(r instanceof ll)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let n=null;r.compressed&&(n={10241:r.data.length>1?9985:9729});const s=new ll(t,{...r,parameters:{...bX,...n,...i}});return Ix[s.id]=e,s}function xX(e,t){!t||!(t instanceof ll)||Ix[t.id]===e&&(t.delete(),delete Ix[t.id])}const SX={boolean:{validate(e,t){return!0},equal(e,t,r){return!!e==!!t}},number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},color:{validate(e,t){return t.optional&&!e||Lx(e)&&(e.length===3||e.length===4)},equal(e,t,r){return wu(e,t,1)}},accessor:{validate(e,t){const r=N_(e);return r==="function"||r===N_(t.value)},equal(e,t,r){return typeof t=="function"?!0:wu(e,t,1)}},array:{validate(e,t){return t.optional&&!e||Lx(e)},equal(e,t,r){const{compare:i}=r,n=Number.isInteger(i)?i:i?1:0;return i?wu(e,t,n):e===t}},object:{equal(e,t,r){if(r.ignore)return!0;const{compare:i}=r,n=Number.isInteger(i)?i:i?1:0;return i?wu(e,t,n):e===t}},function:{validate(e,t){return t.optional&&!e||typeof e=="function"},equal(e,t,r){return!r.compare&&r.ignore!==!1||e===t}},data:{transform:(e,t,r)=>{const{dataTransform:i}=r.props;return i&&e?i(e):e}},image:{transform:(e,t,r)=>{const i=r.context;return!i||!i.gl?null:wX(r.id,i.gl,e,{...t.parameters,...r.props.textureParameters})},release:(e,t,r)=>{xX(r.id,e)}}};function AX(e){const t={},r={},i={};for(const[n,s]of Object.entries(e)){const c=s==null?void 0:s.deprecatedFor;if(c)i[n]=Array.isArray(c)?c:[c];else{const a=EX(n,s);t[n]=a,r[n]=a.value}}return{propTypes:t,defaultProps:r,deprecatedProps:i}}function EX(e,t){switch(N_(t)){case"object":return xg(e,t);case"array":return xg(e,{type:"array",value:t,compare:!1});case"boolean":return xg(e,{type:"boolean",value:t});case"number":return xg(e,{type:"number",value:t});case"function":return xg(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function xg(e,t){return"type"in t?{name:e,...SX[t.type],...t}:"value"in t?{name:e,type:N_(t.value),...t}:{name:e,type:"object",value:t}}function Lx(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function N_(e){return Lx(e)?"array":e===null?"null":typeof e}function TX(e,t){let r;for(let s=t.length-1;s>=0;s--){const c=t[s];"extensions"in c&&(r=c.extensions)}const i=Mx(e.constructor,r),n=Object.create(i);n[F_]=e,n[Bp]={},n[ld]={};for(let s=0;s<t.length;++s){const c=t[s];for(const a in c)n[a]=c[a]}return Object.freeze(n),n}const CX="_mergedDefaultProps";function Mx(e,t){let r=CX;if(t)for(const n of t){const s=n.constructor;s&&(r+=":".concat(s.extensionName||s.name))}return BB(e,r)||(e[r]=PX(e,t||[]))}function PX(e,t){if(!e.prototype)return null;const r=Object.getPrototypeOf(e),i=Mx(r),n=BB(e,"defaultProps")||{},s=AX(n),c=Object.assign(Object.create(null),i,s.defaultProps),a=Object.assign(Object.create(null),i==null?void 0:i[vd],s.propTypes),p=Object.assign(Object.create(null),i==null?void 0:i[_2],s.deprecatedProps);for(const _ of t){const w=Mx(_.constructor);w&&(Object.assign(c,w),Object.assign(a,w[vd]),Object.assign(p,w[_2]))}return IX(c,e),MX(c,a),LX(c,p),c[vd]=a,c[_2]=p,t.length===0&&!KS(e,"_propTypes")&&(e._propTypes=a),c}function IX(e,t){const r=kX(t);Object.defineProperties(e,{id:{writable:!0,value:r}})}function LX(e,t){for(const r in t)Object.defineProperty(e,r,{enumerable:!1,set(i){const n="".concat(this.id,": ").concat(r);for(const s of t[r])KS(this,s)||(this[s]=i);pi.deprecated(n,t[r].join("/"))()}})}function MX(e,t){const r={},i={};for(const n in t){const s=t[n],{name:c,value:a}=s;s.async&&(r[c]=a,i[c]=BX(c))}e[Kf]=r,e[Bp]={},Object.defineProperties(e,i)}function BX(e){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||EB(t)?this[Bp][e]=t:this[ld][e]=t},get(){if(this[ld]){if(e in this[ld])return this[ld][e]||this[Kf][e];if(e in this[Bp]){const t=this[F_]&&this[F_].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[Kf][e]}}return this[Kf][e]}}}function KS(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function BB(e,t){return KS(e,t)&&e[t]}function kX(e){const t=e.componentName;return t||pi.warn("".concat(e.name,".componentName not specified"))(),t||e.name}let RX=0;class QS{constructor(){q(this,"id",void 0),q(this,"props",void 0),q(this,"count",void 0);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.props=TX(this,r),this.id=this.props.id,this.count=RX++}clone(t){const{props:r}=this,i={};for(const n in r[Kf])n in r[ld]?i[n]=r[ld][n]:n in r[Bp]&&(i[n]=r[Bp][n]);return new this.constructor({...r,...i,...t})}}q(QS,"componentName","Component");q(QS,"defaultProps",{});const FX=Object.freeze({});class DX{constructor(t){q(this,"component",void 0),q(this,"onAsyncPropUpdated",void 0),q(this,"asyncProps",void 0),q(this,"oldProps",void 0),q(this,"oldAsyncProps",void 0),this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const r=this.asyncProps[t];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||FX}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const r=this.asyncProps[t];return r&&r.resolvedValue}isAsyncPropLoading(t){if(t){const r=this.asyncProps[t];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(const r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(t,r){this._watchPromise(t,Promise.resolve(r))}setAsyncProps(t){this.component=t[F_]||this.component;const r=t[ld]||{},i=t[Bp]||t,n=t[Kf]||{};for(const s in r){const c=r[s];this._createAsyncPropData(s,n[s]),this._updateAsyncProp(s,c),r[s]=this.getAsyncProp(s)}for(const s in i){const c=i[s];this._createAsyncPropData(s,n[s]),this._updateAsyncProp(s,c)}}_fetch(t,r){return null}_onResolve(t,r){}_onError(t,r){}_updateAsyncProp(t,r){if(this._didAsyncInputValueChange(t,r)){if(typeof r=="string"&&(r=this._fetch(t,r)),r instanceof Promise){this._watchPromise(t,r);return}if(EB(r)){this._resolveAsyncIterable(t,r);return}this._setPropValue(t,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,r){const i=this.asyncProps[t];return r===i.resolvedValue||r===i.lastValue?!1:(i.lastValue=r,!0)}_setPropValue(t,r){this._freezeAsyncOldProps();const i=this.asyncProps[t];i&&(r=this._postProcessValue(i,r),i.resolvedValue=r,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(t,r,i){const n=this.asyncProps[t];n&&i>=n.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=r,n.resolvedLoadCount=i,this.onAsyncPropUpdated(t,r))}_watchPromise(t,r){const i=this.asyncProps[t];if(i){i.pendingLoadCount++;const n=i.pendingLoadCount;r.then(s=>{this.component&&(s=this._postProcessValue(i,s),this._setAsyncPropValue(t,s,n),this._onResolve(t,s))}).catch(s=>{this._onError(t,s)})}}async _resolveAsyncIterable(t,r){if(t!=="data"){this._setPropValue(t,r);return}const i=this.asyncProps[t];if(!i)return;i.pendingLoadCount++;const n=i.pendingLoadCount;let s=[],c=0;for await(const a of r){if(!this.component)return;const{dataTransform:p}=this.component.props;p?s=p(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:c,endRow:s.length}]}),c=s.length,this._setAsyncPropValue(t,s,n)}this._onResolve(t,s)}_postProcessValue(t,r){const i=t.type;return i&&this.component&&(i.release&&i.release(t.resolvedValue,i,this.component),i.transform)?i.transform(r,i,this.component):r}_createAsyncPropData(t,r){if(!this.asyncProps[t]){const i=this.component&&this.component.props[vd];this.asyncProps[t]={type:i&&i[t],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}}class NX extends DX{constructor(t){let{attributeManager:r,layer:i}=t;super(i),q(this,"attributeManager",void 0),q(this,"needsRedraw",void 0),q(this,"needsUpdate",void 0),q(this,"subLayers",void 0),q(this,"usesPickingColorCache",void 0),q(this,"hasPickingBuffer",void 0),q(this,"changeFlags",void 0),q(this,"viewport",void 0),q(this,"uniformTransitions",void 0),q(this,"propsInTransition",void 0),this.attributeManager=r,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,r){const i=this.layer,n=i==null?void 0:i.props.fetch;return n?n(r,{propName:t,layer:i}):super._fetch(t,r)}_onResolve(t,r){const i=this.layer;if(i){const n=i.props.onDataLoad;t==="data"&&n&&n(r,{propName:t,layer:i})}}_onError(t,r){const i=this.layer;i&&i.raiseError(r,"loading ".concat(t," of ").concat(this.layer))}}const OX="layer.changeFlag",zX="layer.initialize",jX="layer.update",UX="layer.finalize",GX="layer.matched",yP=2**24-1,VX=Object.freeze([]),qX=K0(e=>{let{oldViewport:t,viewport:r}=e;return t.equals(r)});let du=new Uint8ClampedArray(0);const HX={data:{type:"data",value:VX,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,t)=>{let{propName:r,layer:i,loaders:n,loadOptions:s,signal:c}=t;const{resourceManager:a}=i.context;if(s=s||i.getLoadOptions(),n=n||i.props.loaders,c){var p;s={...s,fetch:{...(p=s)===null||p===void 0?void 0:p.fetch,signal:c}}}let _=a.contains(e);return!_&&!s&&(a.add({resourceId:e,data:Sd(e,n),persistent:!1}),_=!0),_?a.subscribe({resourceId:e,onChange:w=>{var S;return(S=i.internalState)===null||S===void 0?void 0:S.reloadAsyncProp(r,w)},consumerId:i.id,requestId:r}):Sd(e,n,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:hi.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:e=>{let{layerIndex:t}=e;return[0,-t*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Lm extends QS{constructor(){super(...arguments),q(this,"internalState",null),q(this,"lifecycle",xf.NO_STATE),q(this,"context",void 0),q(this,"state",void 0),q(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}project(t){Qs(this.internalState);const r=this.internalState.viewport||this.context.viewport,i=pB(t,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,s,c]=dB(i,r.pixelProjectionMatrix);return t.length===2?[n,s]:[n,s,c]}unproject(t){return Qs(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,r){Qs(this.internalState);const i=this.internalState.viewport||this.context.viewport;return c$(t,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(t){for(const r of this.getModels())r.updateModuleSettings(t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===hi.DEFAULT||t===hi.LNGLAT||t===hi.CARTESIAN}onHover(t,r){return this.props.onHover&&this.props.onHover(t,r)||!1}onClick(t,r){return this.props.onClick&&this.props.onClick(t,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return r[0]=t+1&255,r[1]=t+1>>8&255,r[2]=t+1>>8>>8&255,r}decodePickingColor(t){Qs(t instanceof Uint8Array);const[r,i,n]=t;return r+i*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:gX(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return(t=this.getAttributeManager())===null||t===void 0?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){for(const r of this.props.extensions)t=vX(t,r.getShaders.call(this,r));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const r=this.getAttributeManager(),{dataChanged:i}=t.changeFlags;if(i&&r)if(Array.isArray(i))for(const n of i)r.invalidateAll(n);else r.invalidateAll();if(r){const{props:n}=t,s=this.internalState.hasPickingBuffer,c=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==c){this.internalState.hasPickingBuffer=c;const{pickingColors:a,instancePickingColors:p}=r.attributes,_=a||p;_&&(c&&_.constant&&(_.constant=!1,r.invalidate(_.id)),!_.value&&!c&&(_.constant=!0,_.value=[0,0,0]))}}}finalizeState(t){for(const i of this.getModels())i.delete();const r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const r of this.getModels())r.draw(t)}getPickingInfo(t){let{info:r,mode:i,sourceLayer:n}=t;const{index:s}=r;return s>=0&&Array.isArray(this.props.data)&&(r.object=this.props.data[s]),r}raiseError(t,r){var i,n;if(r&&(t=new Error("".concat(r,": ").concat(t.message),{cause:t})),!((i=(n=this.props).onError)!==null&&i!==void 0&&i.call(n,t))){var s,c;(s=this.context)===null||s===void 0||(c=s.onError)===null||c===void 0||c.call(s,t,this)}}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var t;return((t=this.internalState)===null||t===void 0?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const r=this.internalState.viewport;this.internalState.viewport=t,(!r||!qX({oldViewport:r,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const r=this.getAttributeManager();r&&(t==="all"?r.invalidateAll():r.invalidate(t))}updateAttributes(t){for(const r of this.getModels())this._setModelAttributes(r,t)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const r=this.props,i=this.getNumInstances(),n=this.getStartIndices();t.update({data:r.data,numInstances:i,startIndices:n,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});const s=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const r=t.update(),i=Object.create(this.props);for(const n in r)Object.defineProperty(i,n,{value:r[n]});return i}return this.props}calculateInstancePickingColors(t,r){let{numInstances:i}=r;if(t.constant)return;const n=Math.floor(du.length/3);if(this.internalState.usesPickingColorCache=!0,n<i){i>yP&&pi.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),du=L0.allocate(du,i,{size:3,copy:!0,maxCount:Math.max(i,yP)});const s=Math.floor(du.length/3),c=[];for(let a=n;a<s;a++)this.encodePickingColor(a,c),du[a*3+0]=c[0],du[a*3+1]=c[1],du[a*3+2]=c[2]}t.value=du.subarray(0,i*3)}_setModelAttributes(t,r){const i=this.getAttributeManager(),n=t.userData.excludeAttributes||{},s=i.getShaderAttributes(r,n);t.setAttributes(s)}disablePickingIndex(t){const r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(t);return}const{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,s=i||n,c=s&&r.attributes&&r.attributes[s.id];if(c&&c.value){const a=c.value,p=this.encodePickingColor(t);for(let _=0;_<r.length;_++){const w=s.getVertexOffset(_);a[w]===p[0]&&a[w+1]===p[1]&&a[w+2]===p[2]&&this._disablePickingIndex(_)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,n=r||i;if(!n)return;const s=n.getVertexOffset(t),c=n.getVertexOffset(t+1);n.buffer.subData({data:new Uint8Array(c-s),offset:s})}restorePickingColors(){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,i=t||r;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==du.buffer&&(i.value=du.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Qs(!this.internalState),Qs(Number.isFinite(this.props.coordinateSystem)),Eo(zX,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new NX({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(pi.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new aX(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){Eo(GX,this,this===t);const{state:r,internalState:i}=t;this!==t&&(this.internalState=i,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(Eo(jX,this,t),!t)return;const r=this.props,i=this.context,n=this.internalState,s=i.viewport,c=this._updateUniformTransition();n.propsInTransition=c,i.viewport=n.viewport||s,this.props=c;try{const a=this._getUpdateParams(),p=this.getModels();if(i.gl)this.updateState(a);else try{this.updateState(a)}catch{}for(const w of this.props.extensions)w.updateState.call(this,a,w);const _=this.getModels()[0]!==p[0];this._postUpdate(a,_)}finally{i.viewport=s,this.props=r,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){Eo(UX,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer(t){let{moduleParameters:r=null,uniforms:i={},parameters:n={}}=t;this._updateAttributeTransition();const s=this.props,c=this.context;this.props=this.internalState.propsInTransition||s;const a=this.props.opacity;i.opacity=Math.pow(a,1/2.2);try{r&&this.setModuleParameters(r);const{getPolygonOffset:p}=this.props,_=p&&p(i)||[0,0];vh(c.gl,{polygonOffset:_}),xc(c.gl,n,()=>{const w={moduleParameters:r,uniforms:i,parameters:n,context:c};for(const S of this.props.extensions)S.draw.call(this,w,S);this.draw(w)})}finally{this.props=s}}getChangeFlags(){var t;return(t=this.internalState)===null||t===void 0?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:r}=this.internalState;for(const n in t)if(t[n]){let s=!1;switch(n){case"dataChanged":const c=t[n],a=r[n];c&&Array.isArray(a)&&(r.dataChanged=Array.isArray(c)?a.concat(c):c,s=!0);default:r[n]||(r[n]=t[n],s=!0)}s&&Eo(OX,this,n,t)}const i=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=i,r.somethingChanged=i||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,r){const i=cX(t,r);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged){var n;this.internalState.uniformTransitions.add(s,r[s],t[s],(n=t.transitions)===null||n===void 0?void 0:n[s])}return this.setChangeFlags(i)}validateProps(){lX(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const r={pickingSelectedColor:t.picked?t.color:null},{highlightColor:i}=this.props;t.picked&&typeof i=="function"&&(r.pickingHighlightColor=i(t)),this.setModuleParameters(r),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new rX(t.gl,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,r){const{props:i,oldProps:n}=t;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:c,highlightedObjectIndex:a,highlightColor:p}=i;if(r||n.autoHighlight!==c||n.highlightedObjectIndex!==a||n.highlightColor!==p){const _={};c||(_.pickingSelectedColor=null),Array.isArray(p)&&(_.pickingHighlightColor=p),(r||a!==n.highlightedObjectIndex)&&(_.pickingSelectedColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setModuleParameters(_)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),n=i?i.getNeedsRedraw(t):!1;if(r=r||n,r)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}q(Lm,"defaultProps",HX);q(Lm,"layerName","Layer");const $X="compositeLayer.renderLayers";class kB extends Lm{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo(t){let{info:r}=t;const{object:i}=r;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(r.object=i.__source.object,r.index=i.__source.index),r}filterSubLayer(t){return!0}shouldRenderSubLayer(t,r){return r&&r.length}getSubLayerClass(t,r){const{_subLayerProps:i}=this.props;return i&&i[t]&&i[t].type||r}getSubLayerRow(t,r,i){return t.__source={parent:this,object:r,index:i},t}getSubLayerAccessor(t){if(typeof t=="function"){const r={index:-1,data:this.props.data,target:[]};return(i,n)=>i&&i.__source?(r.index=i.__source.index,t(i.__source.object,r)):t(i,n)}return t}getSubLayerProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var r;const{opacity:i,pickable:n,visible:s,parameters:c,getPolygonOffset:a,highlightedObjectIndex:p,autoHighlight:_,highlightColor:w,coordinateSystem:S,coordinateOrigin:C,wrapLongitude:I,positionFormat:N,modelMatrix:F,extensions:W,fetch:U,operation:z,_subLayerProps:H}=this.props,nt={id:"",updateTriggers:{},opacity:i,pickable:n,visible:s,parameters:c,getPolygonOffset:a,highlightedObjectIndex:p,autoHighlight:_,highlightColor:w,coordinateSystem:S,coordinateOrigin:C,wrapLongitude:I,positionFormat:N,modelMatrix:F,extensions:W,fetch:U,operation:z},yt=H&&t.id&&H[t.id],bt=yt&&yt.updateTriggers,vt=t.id||"sublayer";if(yt){const mt=this.props[vd],Dt=t.type?t.type._propTypes:{};for(const kt in yt){const at=Dt[kt]||mt[kt];at&&at.type==="accessor"&&(yt[kt]=this.getSubLayerAccessor(yt[kt]))}}Object.assign(nt,t,yt),nt.id="".concat(this.props.id,"-").concat(vt),nt.updateTriggers={all:(r=this.props.updateTriggers)===null||r===void 0?void 0:r.all,...t.updateTriggers,...bt};for(const mt of W){const Dt=mt.getSubLayerProps.call(this,mt);Dt&&Object.assign(nt,Dt,{updateTriggers:Object.assign(nt.updateTriggers,Dt.updateTriggers)})}return nt}_updateAutoHighlight(t){for(const r of this.getSubLayers())r.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,r){let i=this.internalState.subLayers;const n=!i||this.needsUpdate();if(n){const s=this.renderLayers();i=mv(s,Boolean),this.internalState.subLayers=i}Eo($X,this,n,i);for(const s of i)s.parent=this}}q(kB,"layerName","CompositeLayer");const x2=512,WX=Math.PI/180;function XX(e){let{map:t,gl:r,deck:i}=e;if(t.__deck)return t.__deck;const n=i==null?void 0:i.props._customRender,s=i==null?void 0:i.props.onLoad,c=YX({...i==null?void 0:i.props,_customRender:()=>{t.triggerRepaint(),n==null||n("")}});let a;return(!i||i.props.gl===r)&&(Object.assign(c,{gl:r,width:null,height:null,touchAction:"unset",viewState:t3(t)}),i!=null&&i.isInitialized?_P(i,t):c.onLoad=()=>{s==null||s(),_P(a,t)}),i?(a=i,i.setProps(c),i.userData.isExternal=!0):(a=new ZS(c),t.on("remove",()=>{ZX(t)})),a.userData.mapboxLayers=new Set,t.__deck=a,t.on("render",()=>{a.isInitialized&&rZ(a,t)}),a}function _P(e,t){const r=()=>{e.isInitialized?iZ(e,t):t.off("move",r)};t.on("move",r)}function ZX(e){var t;(t=e.__deck)===null||t===void 0||t.finalize(),e.__deck=null}function YX(e){return{...e,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...e.parameters},views:e.views||[new WS({id:"mapbox"})]}}function JX(e,t){e.userData.mapboxLayers.add(t),e3(e)}function KX(e,t){e.userData.mapboxLayers.delete(t),e3(e)}function QX(e,t){e3(e)}function tZ(e,t,r){let{currentViewport:i}=e.userData,n=!1;i||(i=RB(e,t,!0),e.userData.currentViewport=i,n=!0),e.isInitialized&&e._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:s=>{let{layer:c}=s;return r.id===c.id||c.props.operation.includes("terrain")},clearStack:n,clearCanvas:!1})}function t3(e){var t;const{lng:r,lat:i}=e.getCenter(),n={longitude:(r+540)%360-180,latitude:i,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch(),padding:e.getPadding(),repeat:e.getRenderWorldCopies()};return(t=e.getTerrain)!==null&&t!==void 0&&t.call(e)&&eZ(e,n),n}function eZ(e,t){if(e.getFreeCameraOptions){const{position:r}=e.getFreeCameraOptions();if(!r||r.z===void 0)return;const i=e.transform.height,{longitude:n,latitude:s,pitch:c}=t,a=r.x*x2,p=(1-r.y)*x2,_=r.z*x2,w=I0([n,s]),S=a-w[0],C=p-w[1],I=Math.sqrt(S*S+C*C),N=c*WX,F=1.5*i,W=N<.001?F*Math.cos(N)/_:F*Math.sin(N)/I;t.zoom=Math.log2(W);const U=F*Math.cos(N)/W,z=_-U;t.position=[0,0,z/Dy(s)]}else typeof e.transform.elevation=="number"&&(t.position=[0,0,e.transform.elevation])}function RB(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Mp({id:"mapbox",x:0,y:0,width:e.width,height:e.height,...t3(t),nearZMultiplier:r?.02:.1,nearZ:t.transform._nearZ/t.transform.height,farZ:t.transform._farZ/t.transform.height})}function rZ(e,t){const{mapboxLayers:r,isExternal:i}=e.userData;if(i){const n=Array.from(r,_=>_.id),s=mv(e.props.layers,Boolean).some(_=>_&&!n.includes(_.id));let c=e.getViewports();const a=c.findIndex(_=>_.id==="mapbox"),p=c.length>1||a<0;(s||p)&&(a>=0&&(c=c.slice(),c[a]=RB(e,t,!1)),e._drawLayers("mapbox-repaint",{viewports:c,layerFilter:_=>(!e.props.layerFilter||e.props.layerFilter(_))&&(_.viewport.id!=="mapbox"||!n.includes(_.layer.id)),clearCanvas:!1}))}e.userData.currentViewport=null}function iZ(e,t){e.setProps({viewState:t3(t)}),e.needsRedraw({clearRedrawFlags:!0})}function e3(e){if(e.userData.isExternal)return;const t=[];e.userData.mapboxLayers.forEach(r=>{const i=r.props.type,n=new i(r.props);t.push(n)}),e.setProps({layers:t})}class nZ{constructor(t){if(q(this,"id",void 0),q(this,"type",void 0),q(this,"renderingMode",void 0),q(this,"map",void 0),q(this,"deck",void 0),q(this,"props",void 0),!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}onAdd(t,r){this.map=t,this.deck=XX({map:t,gl:r,deck:this.props.deck}),JX(this.deck,this)}onRemove(){this.deck&&KX(this.deck,this)}setProps(t){Object.assign(this.props,t,{id:this.id}),this.deck&&QX(this.deck)}render(){tZ(this.deck,this.map,this)}}const sZ=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,oZ=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,FB=[0,0,0,255],DB=[0,0,1],aZ={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:e=>e.position},getNormal:{type:"accessor",value:DB},getColor:{type:"accessor",value:FB},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function lZ(e){const{header:t,attributes:r}=e;!t||!r||(e.length=t.vertexCount,r.POSITION&&(r.instancePositions=r.POSITION),r.NORMAL&&(r.instanceNormals=r.NORMAL),r.COLOR_0&&(r.instanceColors=r.COLOR_0))}class r3 extends Lm{getShaders(){return super.getShaders({vs:sZ,fs:oZ,modules:[HS,Iq,$S]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:DB},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:FB}})}updateState(t){const{changeFlags:r,props:i}=t;if(super.updateState(t),r.extensionsChanged){var n;const{gl:s}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}r.dataChanged&&lZ(i.data)}draw(t){let{uniforms:r}=t;const{pointSize:i,sizeUnits:n}=this.props;this.state.model.setUniforms(r).setUniforms({sizeUnits:cx[n],radiusPixels:i}).draw()}_getModel(t){const r=[];for(let i=0;i<3;i++){const n=i/3*Math.PI*2;r.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new vm(t,{...this.getShaders(),id:this.props.id,geometry:new r0({drawMode:4,attributes:{positions:new Float32Array(r)}}),isInstanced:!0})}}q(r3,"layerName","PointCloudLayer");q(r3,"defaultProps",aZ);const el={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new te;new te;const Sg=new te,vP=new te;class e1{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;q(this,"center",void 0),q(this,"radius",void 0),this.radius=-0,this.center=new te,this.fromCenterRadius(t,r)}fromCenterRadius(t,r){return this.center.from(t),this.radius=r,this}fromCornerPoints(t,r){return r=Sg.from(r),this.center=new te().from(t).add(r).scale(.5),this.radius=this.center.distance(r),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new e1(this.center,this.radius)}union(t){const r=this.center,i=this.radius,n=t.center,s=t.radius,c=Sg.copy(n).subtract(r),a=c.magnitude();if(i>=a+s)return this.clone();if(s>=a+i)return t.clone();const p=(i+a+s)*.5;return vP.copy(c).scale((-i+p)/a).add(r),this.center.copy(vP),this.radius=p,this}expand(t){const r=Sg.from(t).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(t){this.center.transform(t);const r=DV(Sg,t);return this.radius=Math.max(r[0],Math.max(r[1],r[2]))*this.radius,this}distanceSquaredTo(t){const r=this.distanceTo(t);return r*r}distanceTo(t){const r=Sg.from(t).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(t){const r=this.center,i=this.radius,n=t.normal.dot(r)+t.distance;return n<-i?el.OUTSIDE:n<i?el.INTERSECTING:el.INSIDE}}const cZ=new te,uZ=new te,iy=new te,ny=new te,sy=new te,hZ=new te,dZ=new te,Qu={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class r1{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];q(this,"center",void 0),q(this,"halfAxes",void 0),this.center=new te().from(t),this.halfAxes=new jn(r)}get halfSize(){const t=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new te(t).len(),new te(r).len(),new te(i).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),n=new te(t).normalize(),s=new te(r).normalize(),c=new te(i).normalize();return new C0().fromMatrix3(new jn([...n,...s,...c]))}fromCenterHalfSizeQuaternion(t,r,i){const n=new C0(i),s=new jn().fromQuaternion(n);return s[0]=s[0]*r[0],s[1]=s[1]*r[0],s[2]=s[2]*r[0],s[3]=s[3]*r[1],s[4]=s[4]*r[1],s[5]=s[5]*r[1],s[6]=s[6]*r[2],s[7]=s[7]*r[2],s[8]=s[8]*r[2],this.center=new te().from(t),this.halfAxes=s,this}clone(){return new r1(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new e1;const r=this.halfAxes,i=r.getColumn(0,iy),n=r.getColumn(1,ny),s=r.getColumn(2,sy),c=cZ.copy(i).add(n).add(s);return t.center.copy(this.center),t.radius=c.magnitude(),t}intersectPlane(t){const r=this.center,i=t.normal,n=this.halfAxes,s=i.x,c=i.y,a=i.z,p=Math.abs(s*n[Qu.COLUMN0ROW0]+c*n[Qu.COLUMN0ROW1]+a*n[Qu.COLUMN0ROW2])+Math.abs(s*n[Qu.COLUMN1ROW0]+c*n[Qu.COLUMN1ROW1]+a*n[Qu.COLUMN1ROW2])+Math.abs(s*n[Qu.COLUMN2ROW0]+c*n[Qu.COLUMN2ROW1]+a*n[Qu.COLUMN2ROW2]),_=i.dot(r)+t.distance;return _<=-p?el.OUTSIDE:_>=p?el.INSIDE:el.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const r=uZ.from(t).subtract(this.center),i=this.halfAxes,n=i.getColumn(0,iy),s=i.getColumn(1,ny),c=i.getColumn(2,sy),a=n.magnitude(),p=s.magnitude(),_=c.magnitude();n.normalize(),s.normalize(),c.normalize();let w=0,S;return S=Math.abs(r.dot(n))-a,S>0&&(w+=S*S),S=Math.abs(r.dot(s))-p,S>0&&(w+=S*S),S=Math.abs(r.dot(c))-_,S>0&&(w+=S*S),w}computePlaneDistances(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const c=this.center,a=this.halfAxes,p=a.getColumn(0,iy),_=a.getColumn(1,ny),w=a.getColumn(2,sy),S=hZ.copy(p).add(_).add(w).add(c),C=dZ.copy(S).subtract(t);let I=r.dot(C);return n=Math.min(I,n),s=Math.max(I,s),S.copy(c).add(p).add(_).subtract(w),C.copy(S).subtract(t),I=r.dot(C),n=Math.min(I,n),s=Math.max(I,s),S.copy(c).add(p).subtract(_).add(w),C.copy(S).subtract(t),I=r.dot(C),n=Math.min(I,n),s=Math.max(I,s),S.copy(c).add(p).subtract(_).subtract(w),C.copy(S).subtract(t),I=r.dot(C),n=Math.min(I,n),s=Math.max(I,s),c.copy(S).subtract(p).add(_).add(w),C.copy(S).subtract(t),I=r.dot(C),n=Math.min(I,n),s=Math.max(I,s),c.copy(S).subtract(p).add(_).subtract(w),C.copy(S).subtract(t),I=r.dot(C),n=Math.min(I,n),s=Math.max(I,s),c.copy(S).subtract(p).subtract(_).add(w),C.copy(S).subtract(t),I=r.dot(C),n=Math.min(I,n),s=Math.max(I,s),c.copy(S).subtract(p).subtract(_).subtract(w),C.copy(S).subtract(t),I=r.dot(C),n=Math.min(I,n),s=Math.max(I,s),i[0]=n,i[1]=s,i}transform(t){this.center.transformAsPoint(t);const r=this.halfAxes.getColumn(0,iy);r.transformAsPoint(t);const i=this.halfAxes.getColumn(1,ny);i.transformAsPoint(t);const n=this.halfAxes.getColumn(2,sy);return n.transformAsPoint(t),this.halfAxes=new jn([...r,...i,...n]),this}getTransform(){throw new Error("not implemented")}}const bP=new te,wP=new te;class gc{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;q(this,"normal",void 0),q(this,"distance",void 0),this.normal=new te,this.distance=-0,this.fromNormalDistance(t,r)}fromNormalDistance(t,r){return yc(Number.isFinite(r)),this.normal.from(t).normalize(),this.distance=r,this}fromPointNormal(t,r){t=bP.from(t),this.normal.from(r).normalize();const i=-this.normal.dot(t);return this.distance=i,this}fromCoefficients(t,r,i,n){return this.normal.set(t,r,i),yc(Sc(this.normal.len(),1)),this.distance=n,this}clone(){return new gc(this.normal,this.distance)}equals(t){return Sc(this.distance,t.distance)&&Sc(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const r=wP.copy(this.normal).transformAsVector(t).normalize(),i=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(i,r)}projectPointOntoPlane(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];t=bP.from(t);const i=this.getPointDistance(t),n=wP.copy(this.normal).scale(i);return t.subtract(n).to(r)}}const xP=[new te([1,0,0]),new te([0,1,0]),new te([0,0,1])],SP=new te,pZ=new te;new gc(new te(1,0,0),0);class Nl{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];q(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*xP.length;const r=t.center,i=t.radius;let n=0;for(const s of xP){let c=this.planes[n],a=this.planes[n+1];c||(c=this.planes[n]=new gc),a||(a=this.planes[n+1]=new gc);const p=SP.copy(s).scale(-i).add(r);-s.dot(p),c.fromPointNormal(p,s);const _=SP.copy(s).scale(i).add(r),w=pZ.copy(s).negate();-w.dot(_),a.fromPointNormal(_,w),n+=2}return this}computeVisibility(t){let r=el.INSIDE;for(const i of this.planes)switch(t.intersectPlane(i)){case el.OUTSIDE:return el.OUTSIDE;case el.INTERSECTING:r=el.INTERSECTING;break}return r}computeVisibilityWithPlaneMask(t,r){if(yc(Number.isFinite(r),"parentPlaneMask is required."),r===Nl.MASK_OUTSIDE||r===Nl.MASK_INSIDE)return r;let i=Nl.MASK_INSIDE;const n=this.planes;for(let s=0;s<this.planes.length;++s){const c=s<31?1<<s:0;if(s<31&&!(r&c))continue;const a=n[s],p=t.intersectPlane(a);if(p===el.OUTSIDE)return Nl.MASK_OUTSIDE;p===el.INTERSECTING&&(i|=c)}return i}}q(Nl,"MASK_OUTSIDE",4294967295);q(Nl,"MASK_INSIDE",0);q(Nl,"MASK_INDETERMINATE",2147483647);new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;const fu=new jn,fZ=new jn,mZ=new jn,oy=new jn,AP=new jn;function gZ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=P0.EPSILON20,i=10;let n=0,s=0;const c=fZ,a=mZ;c.identity(),a.copy(e);const p=r*yZ(a);for(;s<i&&_Z(a)>p;)vZ(a,oy),AP.copy(oy).transpose(),a.multiplyRight(oy),a.multiplyLeft(AP),c.multiplyRight(oy),++n>2&&(++s,n=0);return t.unitary=c.toTarget(t.unitary),t.diagonal=a.toTarget(t.diagonal),t}function yZ(e){let t=0;for(let r=0;r<9;++r){const i=e[r];t+=i*i}return Math.sqrt(t)}const Bx=[1,0,0],kx=[2,2,1];function _Z(e){let t=0;for(let r=0;r<3;++r){const i=e[fu.getElementIndex(kx[r],Bx[r])];t+=2*i*i}return Math.sqrt(t)}function vZ(e,t){const r=P0.EPSILON15;let i=0,n=1;for(let _=0;_<3;++_){const w=Math.abs(e[fu.getElementIndex(kx[_],Bx[_])]);w>i&&(n=_,i=w)}const s=Bx[n],c=kx[n];let a=1,p=0;if(Math.abs(e[fu.getElementIndex(c,s)])>r){const _=e[fu.getElementIndex(c,c)],w=e[fu.getElementIndex(s,s)],S=e[fu.getElementIndex(c,s)],C=(_-w)/2/S;let I;C<0?I=-1/(-C+Math.sqrt(1+C*C)):I=1/(C+Math.sqrt(1+C*C)),a=1/Math.sqrt(1+I*I),p=I*a}return jn.IDENTITY.to(t),t[fu.getElementIndex(s,s)]=t[fu.getElementIndex(c,c)]=a,t[fu.getElementIndex(c,s)]=p,t[fu.getElementIndex(s,c)]=-p,t}const Yh=new te,bZ=new te,wZ=new te,xZ=new te,SZ=new te,AZ=new jn,EZ={diagonal:new jn,unitary:new jn};function TZ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new r1;if(!e||e.length===0)return t.halfAxes=new jn([0,0,0,0,0,0,0,0,0]),t.center=new te,t;const r=e.length,i=new te(0,0,0);for(const Dt of e)i.add(Dt);const n=1/r;i.multiplyByScalar(n);let s=0,c=0,a=0,p=0,_=0,w=0;for(const Dt of e){const kt=Yh.copy(Dt).subtract(i);s+=kt.x*kt.x,c+=kt.x*kt.y,a+=kt.x*kt.z,p+=kt.y*kt.y,_+=kt.y*kt.z,w+=kt.z*kt.z}s*=n,c*=n,a*=n,p*=n,_*=n,w*=n;const S=AZ;S[0]=s,S[1]=c,S[2]=a,S[3]=c,S[4]=p,S[5]=_,S[6]=a,S[7]=_,S[8]=w;const{unitary:C}=gZ(S,EZ),I=t.halfAxes.copy(C);let N=I.getColumn(0,wZ),F=I.getColumn(1,xZ),W=I.getColumn(2,SZ),U=-Number.MAX_VALUE,z=-Number.MAX_VALUE,H=-Number.MAX_VALUE,nt=Number.MAX_VALUE,yt=Number.MAX_VALUE,bt=Number.MAX_VALUE;for(const Dt of e)Yh.copy(Dt),U=Math.max(Yh.dot(N),U),z=Math.max(Yh.dot(F),z),H=Math.max(Yh.dot(W),H),nt=Math.min(Yh.dot(N),nt),yt=Math.min(Yh.dot(F),yt),bt=Math.min(Yh.dot(W),bt);N=N.multiplyByScalar(.5*(nt+U)),F=F.multiplyByScalar(.5*(yt+z)),W=W.multiplyByScalar(.5*(bt+H)),t.center.copy(N).add(F).add(W);const vt=bZ.set(U-nt,z-yt,H-bt).multiplyByScalar(.5),mt=new jn([vt[0],0,0,0,vt[1],0,0,0,vt[2]]);return t.halfAxes.multiplyRight(mt),t}const S2=Math.PI/180,ay=new Float32Array(16),EP=new Float32Array(12);function TP(e,t,r){const i=t[0]*S2,n=t[1]*S2,s=t[2]*S2,c=Math.sin(s),a=Math.sin(i),p=Math.sin(n),_=Math.cos(s),w=Math.cos(i),S=Math.cos(n),C=r[0],I=r[1],N=r[2];e[0]=C*S*w,e[1]=C*p*w,e[2]=C*-a,e[3]=I*(-p*_+S*a*c),e[4]=I*(S*_+p*a*c),e[5]=I*w*c,e[6]=N*(p*c+S*a*_),e[7]=N*(-S*c+p*a*_),e[8]=N*w*_}function CP(e){return e[0]=e[0],e[1]=e[1],e[2]=e[2],e[3]=e[4],e[4]=e[5],e[5]=e[6],e[6]=e[8],e[7]=e[9],e[8]=e[10],e[9]=e[12],e[10]=e[13],e[11]=e[14],e.subarray(0,12)}const NB={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(e,t){let{startRow:r,endRow:i}=t;const{data:n,getOrientation:s,getScale:c,getTranslation:a,getTransformMatrix:p}=this.props,_=Array.isArray(p),w=_&&p.length===16,S=Array.isArray(c),C=Array.isArray(s),I=Array.isArray(a),N=w||!_&&!!p(n[0]);N?e.constant=w:e.constant=C&&S&&I;const F=e.value;if(e.constant){let W;N?(ay.set(p),W=CP(ay)):(W=EP,TP(W,s,c),W.set(a,9)),e.value=new Float32Array(W)}else{let W=r*e.size;const{iterable:U,objectInfo:z}=AB(n,r,i);for(const H of U){z.index++;let nt;if(N)ay.set(w?p:p(H,z)),nt=CP(ay);else{nt=EP;const yt=C?s:s(H,z),bt=S?c:c(H,z);TP(nt,yt,bt),nt.set(I?a:a(H,z),9)}F[W++]=nt[0],F[W++]=nt[1],F[W++]=nt[2],F[W++]=nt[3],F[W++]=nt[4],F[W++]=nt[5],F[W++]=nt[6],F[W++]=nt[7],F[W++]=nt[8],F[W++]=nt[9],F[W++]=nt[10],F[W++]=nt[11]}}}};function OB(e,t){return t===hi.CARTESIAN||t===hi.METER_OFFSETS||t===hi.DEFAULT&&!e.isGeospatial}const CZ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,PZ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function zB(e){let t=1/0,r=1/0,i=1/0,n=-1/0,s=-1/0,c=-1/0;const a=e.POSITION?e.POSITION.value:[],p=a&&a.length;for(let _=0;_<p;_+=3){const w=a[_],S=a[_+1],C=a[_+2];t=w<t?w:t,r=S<r?S:r,i=C<i?C:i,n=w>n?w:n,s=S>s?S:s,c=C>c?C:c}return[[t,r,i],[n,s,c]]}function IZ(e,t){if(!e)throw new Error("loader assertion failed.")}class Uf{constructor(t,r){q(this,"fields",void 0),q(this,"metadata",void 0),IZ(Array.isArray(t)),LZ(t),this.fields=t,this.metadata=r||new Map}compareTo(t){if(this.metadata!==t.metadata||this.fields.length!==t.fields.length)return!1;for(let r=0;r<this.fields.length;++r)if(!this.fields[r].compareTo(t.fields[r]))return!1;return!0}select(){const t=Object.create(null);for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];for(const c of i)t[c]=!0;const s=this.fields.filter(c=>t[c.name]);return new Uf(s,this.metadata)}selectAt(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const n=r.map(s=>this.fields[s]).filter(Boolean);return new Uf(n,this.metadata)}assign(t){let r,i=this.metadata;if(t instanceof Uf){const c=t;r=c.fields,i=PP(PP(new Map,this.metadata),c.metadata)}else r=t;const n=Object.create(null);for(const c of this.fields)n[c.name]=c;for(const c of r)n[c.name]=c;const s=Object.values(n);return new Uf(s,i)}}function LZ(e){const t={};for(const r of e)t[r.name]&&console.warn("Schema: duplicated field name",r.name,r),t[r.name]=!0}function PP(e,t){return new Map([...e||new Map,...t||new Map])}class O_{constructor(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;q(this,"name",void 0),q(this,"type",void 0),q(this,"nullable",void 0),q(this,"metadata",void 0),this.name=t,this.type=r,this.nullable=i,this.metadata=n}get typeId(){return this.type&&this.type.typeId}clone(){return new O_(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let Nn=function(e){return e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.Float=3]="Float",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct=13]="Struct",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Dictionary=-1]="Dictionary",e[e.Int8=-2]="Int8",e[e.Int16=-3]="Int16",e[e.Int32=-4]="Int32",e[e.Int64=-5]="Int64",e[e.Uint8=-6]="Uint8",e[e.Uint16=-7]="Uint16",e[e.Uint32=-8]="Uint32",e[e.Uint64=-9]="Uint64",e[e.Float16=-10]="Float16",e[e.Float32=-11]="Float32",e[e.Float64=-12]="Float64",e[e.DateDay=-13]="DateDay",e[e.DateMillisecond=-14]="DateMillisecond",e[e.TimestampSecond=-15]="TimestampSecond",e[e.TimestampMillisecond=-16]="TimestampMillisecond",e[e.TimestampMicrosecond=-17]="TimestampMicrosecond",e[e.TimestampNanosecond=-18]="TimestampNanosecond",e[e.TimeSecond=-19]="TimeSecond",e[e.TimeMillisecond=-20]="TimeMillisecond",e[e.TimeMicrosecond=-21]="TimeMicrosecond",e[e.TimeNanosecond=-22]="TimeNanosecond",e[e.DenseUnion=-23]="DenseUnion",e[e.SparseUnion=-24]="SparseUnion",e[e.IntervalDayTime=-25]="IntervalDayTime",e[e.IntervalYearMonth=-26]="IntervalYearMonth",e}({}),jB,UB,GB;class i3{static isNull(t){return t&&t.typeId===Nn.Null}static isInt(t){return t&&t.typeId===Nn.Int}static isFloat(t){return t&&t.typeId===Nn.Float}static isBinary(t){return t&&t.typeId===Nn.Binary}static isUtf8(t){return t&&t.typeId===Nn.Utf8}static isBool(t){return t&&t.typeId===Nn.Bool}static isDecimal(t){return t&&t.typeId===Nn.Decimal}static isDate(t){return t&&t.typeId===Nn.Date}static isTime(t){return t&&t.typeId===Nn.Time}static isTimestamp(t){return t&&t.typeId===Nn.Timestamp}static isInterval(t){return t&&t.typeId===Nn.Interval}static isList(t){return t&&t.typeId===Nn.List}static isStruct(t){return t&&t.typeId===Nn.Struct}static isUnion(t){return t&&t.typeId===Nn.Union}static isFixedSizeBinary(t){return t&&t.typeId===Nn.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===Nn.FixedSizeList}static isMap(t){return t&&t.typeId===Nn.Map}static isDictionary(t){return t&&t.typeId===Nn.Dictionary}get typeId(){return Nn.NONE}compareTo(t){return this===t}}jB=Symbol.toStringTag;class Mm extends i3{constructor(t,r){super(),q(this,"isSigned",void 0),q(this,"bitWidth",void 0),this.isSigned=t,this.bitWidth=r}get typeId(){return Nn.Int}get[jB](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class MZ extends Mm{constructor(){super(!0,8)}}class BZ extends Mm{constructor(){super(!0,16)}}class kZ extends Mm{constructor(){super(!0,32)}}class RZ extends Mm{constructor(){super(!1,8)}}class FZ extends Mm{constructor(){super(!1,16)}}class DZ extends Mm{constructor(){super(!1,32)}}const VB={HALF:16,SINGLE:32,DOUBLE:64};UB=Symbol.toStringTag;class qB extends i3{constructor(t){super(),q(this,"precision",void 0),this.precision=t}get typeId(){return Nn.Float}get[UB](){return"Float"}toString(){return"Float".concat(this.precision)}}class NZ extends qB{constructor(){super(VB.SINGLE)}}class OZ extends qB{constructor(){super(VB.DOUBLE)}}GB=Symbol.toStringTag;class zZ extends i3{constructor(t,r){super(),q(this,"listSize",void 0),q(this,"children",void 0),this.listSize=t,this.children=[r]}get typeId(){return Nn.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[GB](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function jZ(e){switch(e.constructor){case Int8Array:return new MZ;case Uint8Array:return new RZ;case Int16Array:return new BZ;case Uint16Array:return new FZ;case Int32Array:return new kZ;case Uint32Array:return new DZ;case Float32Array:return new NZ;case Float64Array:return new OZ;default:throw new Error("array type not supported")}}function UZ(e,t,r){const i=jZ(t.value),n=r||GZ(t);return new O_(e,new zZ(t.size,new O_("value",i)),!1,n)}function GZ(e){const t=new Map;return"byteOffset"in e&&t.set("byteOffset",e.byteOffset.toString(10)),"byteStride"in e&&t.set("byteStride",e.byteStride.toString(10)),"normalized"in e&&t.set("normalized",e.normalized.toString()),t}function IP(e,t){(e.COLOR_0||e.colors)&&t||(e.colors={constant:!0,value:new Float32Array([1,1,1])}),pi.assert(e.positions||e.POSITION,'no "postions" or "POSITION" attribute in mesh')}function LP(e,t){if(e.attributes)return IP(e.attributes,t),e instanceof r0?e:new r0(e);if(e.positions||e.POSITION)return IP(e,t),new r0({attributes:e});throw Error("Invalid mesh")}const VZ=[0,0,0,255],qZ={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:VZ},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class n3 extends Lm{constructor(){super(...arguments),q(this,"state",void 0)}getShaders(){const t=!ri(this.context.gl),r={};return ES(this.context.gl,nn.GLSL_DERIVATIVES)&&(r.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:CZ,fs:PZ,modules:[HS,Lq,$S],transpileToGLSL100:t,defines:r})}getBounds(){var t;if(this.props._instanced)return super.getBounds();let r=this.state.positionBounds;if(r)return r;const{mesh:i}=this.props;if(!i)return null;if(r=(t=i.header)===null||t===void 0?void 0:t.boundingBox,!r){const{attributes:n}=LP(i,this.props._useMeshColors);n.POSITION=n.POSITION||n.positions,r=zB(n)}return this.state.positionBounds=r,r}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:NB}),this.setState({emptyTexture:new ll(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:r,oldProps:i,changeFlags:n}=t;if(r.mesh!==i.mesh||n.extensionsChanged){var s;if(this.state.positionBounds=null,(s=this.state.model)===null||s===void 0||s.delete(),r.mesh){this.state.model=this.getModel(r.mesh);const c=r.mesh.attributes||r.mesh;this.setState({hasNormals:!!(c.NORMAL||c.normals)})}this.getAttributeManager().invalidateAll()}r.texture!==i.texture&&this.setTexture(r.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw(t){let{uniforms:r}=t;if(!this.state.model)return;const{viewport:i}=this.context,{sizeScale:n,coordinateSystem:s,_instanced:c}=this.props;this.state.model.setUniforms(r).setUniforms({sizeScale:n,composeModelMatrix:!c||OB(i,s),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.model)&&super.isLoaded}getModel(t){const r=new vm(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:LP(t,this.props._useMeshColors),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:n}=this.state;return r.setUniforms({sampler:i||n,hasTexture:!!i}),r}setTexture(t){const{emptyTexture:r,model:i}=this.state;i&&i.setUniforms({sampler:t||r,hasTexture:!!t})}}q(n3,"defaultProps",qZ);q(n3,"layerName","SimpleMeshLayer");class Qf{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:r}=t;this.id=r||bh(this.constructor.name),this.display=!0,this.position=new te,this.rotation=new te,this.scale=new te(1,1,1),this.matrix=new ui,this.userData={},this.props={},this._setScenegraphNodeProps(t)}delete(){}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(t){return Ze(t.length===3,"setPosition requires vector argument"),this.position=t,this}setRotation(t){return Ze(t.length===3,"setRotation requires vector argument"),this.rotation=t,this}setScale(t){return Ze(t.length===3,"setScale requires vector argument"),this.scale=t,this}setMatrix(t){!(arguments.length>1&&arguments[1]!==void 0)||arguments[1]?this.matrix.copy(t):this.matrix=t}setMatrixComponents(t){let{position:r,rotation:i,scale:n,update:s=!0}=t;return r&&this.setPosition(r),i&&this.setRotation(i),n&&this.setScale(n),s&&this.updateMatrix(),this}updateMatrix(){const t=this.position,r=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(r),this.matrix.scale(i),this}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:r,rotation:i,scale:n}=t;return r&&this.setPosition(r),i&&this.setRotation(i),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(t,r){Ze(t),r=r||this.matrix;const i=new ui(t).multiplyRight(r),n=i.invert(),s=n.transpose();return{viewMatrix:t,modelMatrix:r,objectMatrix:r,worldMatrix:i,worldInverseMatrix:n,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class i0 extends Qf{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t=Array.isArray(t)?{children:t}:t;const{children:r=[]}=t;cr.assert(r.every(i=>i instanceof Qf),"every child must an instance of ScenegraphNode"),super(t),this.children=r}add(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(const n of r)Array.isArray(n)?this.add(...n):this.children.push(n);return this}remove(t){const r=this.children,i=r.indexOf(t);return i>-1&&r.splice(i,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(t=>t.delete()),this.removeAll(),super.delete()}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((r,i)=>{let{worldMatrix:n}=i;const s=r.getBounds();if(!s)return;const[c,a]=s,p=new te(c).add(a).divide([2,2,2]);n.transformAsPoint(p,p);const _=new te(a).subtract(c).divide([2,2,2]);n.transformAsVector(_,_);for(let w=0;w<8;w++){const S=new te(w&1?-1:1,w&2?-1:1,w&4?-1:1).multiply(_).add(p);for(let C=0;C<3;C++)t[0][C]=Math.min(t[0][C],S[C]),t[1][C]=Math.max(t[1][C],S[C])}}),Number.isFinite(t[0][0])?t:null}traverse(t){let{worldMatrix:r=new ui}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new ui(r).multiplyRight(this.matrix);for(const n of this.children)n instanceof i0?n.traverse(t,{worldMatrix:i}):t(n,{worldMatrix:i})}}const HZ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$Z={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function MP(e){if(!e._animation){const t=$Z[e.componentType],r=HZ[e.type],i=r*e.count,{buffer:n,byteOffset:s}=e.bufferView.data,c=new t(n,s+(e.byteOffset||0),i);if(r===1)e._animation=Array.from(c);else{const a=[];for(let p=0;p<c.length;p+=r)a.push(Array.from(c.slice(p,p+r)));e._animation=a}}return e._animation}const WZ=new ui;function XZ(e,t){if(t.matrix.identity(),e.translation&&t.matrix.translate(e.translation),e.rotation){const r=WZ.fromQuaternion(e.rotation);t.matrix.multiplyRight(r)}e.scale&&t.matrix.scale(e.scale)}const A2=new C0;function ZZ(e,t,r,i,n){if(t==="rotation"){A2.slerp({start:r,target:i,ratio:n});for(let s=0;s<A2.length;s++)e[t][s]=A2[s]}else for(let s=0;s<r.length;s++)e[t][s]=n*i[s]+(1-n)*r[s]}function YZ(e,t,r){let{p0:i,outTangent0:n,inTangent1:s,p1:c,tDiff:a,ratio:p}=r;for(let _=0;_<e[t].length;_++){const w=n[_]*a,S=s[_]*a;e[t][_]=(2*Math.pow(p,3)-3*Math.pow(p,2)+1)*i[_]+(Math.pow(p,3)-2*Math.pow(p,2)+p)*w+(-2*Math.pow(p,3)+3*Math.pow(p,2))*c[_]+(Math.pow(p,3)-Math.pow(p,2))*S}}function JZ(e,t,r){for(let i=0;i<r.length;i++)e[t][i]=r[i]}function KZ(e,t,r,i){let{input:n,interpolation:s,output:c}=t;const a=n[n.length-1],p=e%a,_=n.findIndex(I=>I>=p),w=Math.max(0,_-1);if(!Array.isArray(r[i]))switch(i){case"translation":r[i]=[0,0,0];break;case"rotation":r[i]=[0,0,0,1];break;case"scale":r[i]=[1,1,1];break;default:cr.warn("Bad animation path ".concat(i))()}Ze(r[i].length===c[w].length);const S=n[w],C=n[_];switch(s){case"STEP":JZ(r,i,c[w]);break;case"LINEAR":if(C>S){const I=(p-S)/(C-S);ZZ(r,i,c[w],c[_],I)}break;case"CUBICSPLINE":if(C>S){const I=(p-S)/(C-S),N=C-S,F=c[3*w+1],W=c[3*w+2],U=c[3*_+0],z=c[3*_+1];YZ(r,i,{p0:F,outTangent0:W,inTangent1:U,p1:z,tDiff:N,ratio:I})}break;default:cr.warn("Interpolation ".concat(s," not supported"))();break}}class QZ{constructor(t){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,t)}animate(t){if(!this.playing)return;const r=(t/1e3-this.startTime)*this.speed;this.channels.forEach(i=>{let{sampler:n,target:s,path:c}=i;KZ(r,n,s,c),XZ(s,s._node)})}}class tY{constructor(t){this.animations=t.animations.map((r,i)=>{const n=r.name||"Animation-".concat(i),s=r.samplers.map(a=>{let{input:p,interpolation:_="LINEAR",output:w}=a;return{input:MP(t.accessors[p]),interpolation:_,output:MP(t.accessors[w])}}),c=r.channels.map(a=>{let{sampler:p,target:_}=a;return{sampler:s[p],target:t.nodes[_.node],path:_.path}});return new QZ({name:n,channels:c})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(r=>r.animate(t))}getAnimations(){return this.animations}}class eY extends Qf{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(r),this.onBeforeRender=null,this.AfterRender=null,t instanceof vm?(this.model=t,this._setModelNodeProps(r)):this.model=new vm(t,r),this.bounds=null,this.managedResources=r.managedResources||[]}setProps(t){return super.setProps(t),this._setModelNodeProps(t),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(t=>t.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(t){this.model.setProps(t)}}class HB{constructor(t,r){let{attributes:i,material:n,pbrDebug:s,imageBasedLightingEnvironment:c,lights:a,useTangents:p}=r;this.gl=t,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},ES(t,nn.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],c&&(this.uniforms.u_DiffuseEnvSampler=c.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=c.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=c.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),s&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(i.NORMAL,"HAS_NORMALS"),this.defineIfPresent(i.TANGENT&&p,"HAS_TANGENTS"),this.defineIfPresent(i.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(c,"USE_IBL"),this.defineIfPresent(a,"USE_LIGHTS"),this.defineIfPresent(s,"PBR_DEBUG"),n&&this.parseMaterial(n)}defineIfPresent(t,r){t&&(this.defines[r]=1)}parseTexture(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const n=t.texture&&t.texture.sampler&&t.texture.sampler.parameters||{},s=t.texture.source.image;let c,a={};s.compressed?(c=s,a={[this.gl.TEXTURE_MIN_FILTER]:s.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):c={data:s};const p=new ll(this.gl,{id:t.name||t.id,parameters:{...n,...a},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...c});this.uniforms[r]=p,this.defineIfPresent(i,i),this.generatedTextures.push(p)}parsePbrMetallicRoughness(t){t.baseColorTexture&&this.parseTexture(t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&this.parseTexture(t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:r=1,roughnessFactor:i=1}=t;this.uniforms.u_MetallicRoughnessValues=[r,i]}parseMaterial(t){if(this.uniforms.pbr_uUnlit=!!t.unlit,t.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(t.pbrMetallicRoughness),t.normalTexture){this.parseTexture(t.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:r=1}=t.normalTexture;this.uniforms.u_NormalScale=r}if(t.occlusionTexture){this.parseTexture(t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:r=1}=t.occlusionTexture;this.uniforms.u_OcclusionStrength=r}if(t.emissiveTexture&&(this.parseTexture(t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode==="MASK"){const{alphaCutoff:r=.5}=t;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=r}else t.alphaMode==="BLEND"&&(cr.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(t=>t.delete())}}const rY=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,iY=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function BP(e,t){return ri(e)?`#version 300 es
`.concat(t):t}function nY(e,t){const{id:r,drawMode:i,vertexCount:n,attributes:s,modelOptions:c}=t,a=new HB(e,t);cr.info(4,"createGLTFModel defines: ",a.defines)();const p=[];p.push(...a.generatedTextures),p.push(...Object.values(s).map(w=>w.buffer));const _=new eY(e,{id:r,drawMode:i,vertexCount:n,modules:[OS],parameters:a.parameters,vs:BP(e,rY),fs:BP(e,iY),managedResources:p,...c,defines:{...a.defines,...c.defines}});return _.setProps({attributes:s}),_.setUniforms(a.uniforms),_}const sY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},oY={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class aY{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.options=Object.assign({},oY,r)}instantiate(t){return this.gltf=t,(t.scenes||[]).map(r=>this.createScene(r))}createAnimator(){return Array.isArray(this.gltf.animations)?new tY(this.gltf):null}createScene(t){const r=(t.nodes||[]).map(i=>this.createNode(i));return new i0({id:t.name||t.id,children:r})}createNode(t){if(!t._node){const r=(t.children||[]).map(n=>this.createNode(n));t.mesh&&r.push(this.createMesh(t.mesh));const i=new i0({id:t.name||t.id,children:r});if(t.matrix)i.setMatrix(t.matrix);else{if(i.matrix.identity(),t.translation&&i.matrix.translate(t.translation),t.rotation){const n=new ui().fromQuaternion(t.rotation);i.matrix.multiplyRight(n)}t.scale&&i.matrix.scale(t.scale)}t._node=i}return t._node}createMesh(t){if(!t._mesh){const r=(t.primitives||[]).map((n,s)=>this.createPrimitive(n,s,t)),i=new i0({id:t.name||t.id,children:r});t._mesh=i}return t._mesh}getVertexCount(t){cr.warn("getVertexCount() not found")()}createPrimitive(t,r,i){const n=nY(this.gl,Object.assign({id:t.name||"".concat(i.name||i.id,"-primitive-").concat(r),drawMode:t.mode||4,vertexCount:t.indices?t.indices.count:this.getVertexCount(t.attributes),attributes:this.createAttributes(t.attributes,t.indices),material:t.material},this.options));return n.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],n}createAttributes(t,r){const i={};return Object.keys(t).forEach(n=>{i[n]=this.createAccessor(t[n],this.createBuffer(t[n],this.gl.ARRAY_BUFFER))}),r&&(i.indices=this.createAccessor(r,this.createBuffer(r,this.gl.ELEMENT_ARRAY_BUFFER))),cr.info(4,"glTF Attributes",{attributes:t,indices:r,generated:i})(),i}createBuffer(t,r){t.bufferView||(t.bufferView={});const{bufferView:i}=t;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[r]||(i.lumaBuffers[r]=new Wi(this.gl,{id:"from-".concat(i.id),data:i.data||t.value,target:r})),i.lumaBuffers[r]}createAccessor(t,r){return new va({buffer:r,offset:t.byteOffset||0,stride:t.bufferView.byteStride||0,type:t.componentType,size:sY[t.type]})}createSampler(t){return t}needsPOT(){return!1}}function lY(e,t,r){const i=new aY(e,r),n=i.instantiate(t),s=i.createAnimator();return{scenes:n,animator:s}}const cY="3.4.15",uY="3.4.15",$B="3.4.15",hY="https://unpkg.com/@loaders.gl/textures@".concat($B,"/dist/libs/basis_encoder.wasm"),dY="https://unpkg.com/@loaders.gl/textures@".concat($B,"/dist/libs/basis_encoder.js");let E2;async function kP(e){const t=e.modules||{};return t.basis?t.basis:(E2=E2||pY(e),await E2)}async function pY(e){let t=null,r=null;return[t,r]=await Promise.all([await wp("basis_transcoder.js","textures",e),await wp("basis_transcoder.wasm","textures",e)]),t=t||globalThis.BASIS,await fY(t,r)}function fY(e,t){const r={};return t&&(r.wasmBinary=t),new Promise(i=>{e(r).then(n=>{const{BasisFile:s,initializeBasis:c}=n;c(),i({BasisFile:s})})})}let T2;async function RP(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(T2=T2||mY(e),await T2)}async function mY(e){let t=null,r=null;return[t,r]=await Promise.all([await wp(dY,"textures",e),await wp(hY,"textures",e)]),t=t||globalThis.BASIS,await gY(t,r)}function gY(e,t){const r={};return t&&(r.wasmBinary=t),new Promise(i=>{e(r).then(n=>{const{BasisFile:s,KTX2File:c,initializeBasis:a,BasisEncoder:p}=n;a(),i({BasisFile:s,KTX2File:c,BasisEncoder:p})})})}const yf={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},yY=["","WEBKIT_","MOZ_"],FP={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let ly=null;function _Y(e){if(!ly){e=e||vY()||void 0,ly=new Set;for(const t of yY)for(const r in FP)if(e&&e.getExtension("".concat(t).concat(r))){const i=FP[r];ly.add(i)}}return ly}function vY(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var DP,NP,OP,zP,jP,UP,GP,VP;(function(e){e[e.NONE=0]="NONE",e[e.BASISLZ=1]="BASISLZ",e[e.ZSTD=2]="ZSTD",e[e.ZLIB=3]="ZLIB"})(DP||(DP={})),function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(NP||(NP={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(OP||(OP={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(zP||(zP={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(jP||(jP={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(UP||(UP={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(GP||(GP={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(VP||(VP={}));const Ya=[171,75,84,88,32,50,48,187,13,10,26,10];function bY(e){const t=new Uint8Array(e);return!(t.byteLength<Ya.length||t[0]!==Ya[0]||t[1]!==Ya[1]||t[2]!==Ya[2]||t[3]!==Ya[3]||t[4]!==Ya[4]||t[5]!==Ya[5]||t[6]!==Ya[6]||t[7]!==Ya[7]||t[8]!==Ya[8]||t[9]!==Ya[9]||t[10]!==Ya[10]||t[11]!==Ya[11])}const wY={etc1:{basisFormat:0,compressed:!0,format:yf.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:yf.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:yf.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:yf.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:yf.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:yf.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function xY(e,t){if(t.basis.containerFormat==="auto"){if(bY(e)){const i=await RP(t);return qP(i.KTX2File,e,t)}const{BasisFile:r}=await kP(t);return C2(r,e,t)}switch(t.basis.module){case"encoder":const r=await RP(t);switch(t.basis.containerFormat){case"ktx2":return qP(r.KTX2File,e,t);case"basis":default:return C2(r.BasisFile,e,t)}case"transcoder":default:const{BasisFile:i}=await kP(t);return C2(i,e,t)}}function C2(e,t,r){const i=new e(new Uint8Array(t));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const n=i.getNumImages(),s=[];for(let c=0;c<n;c++){const a=i.getNumLevels(c),p=[];for(let _=0;_<a;_++)p.push(SY(i,c,_,r));s.push(p)}return s}finally{i.close(),i.delete()}}function SY(e,t,r,i){const n=e.getImageWidth(t,r),s=e.getImageHeight(t,r),c=e.getHasAlpha(),{compressed:a,format:p,basisFormat:_}=WB(i,c),w=e.getImageTranscodedSizeInBytes(t,r,_),S=new Uint8Array(w);if(!e.transcodeImage(S,t,r,_,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:s,data:S,compressed:a,format:p,hasAlpha:c}}function qP(e,t,r){const i=new e(new Uint8Array(t));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const n=i.getLevels(),s=[];for(let c=0;c<n;c++){s.push(AY(i,c,r));break}return[s]}finally{i.close(),i.delete()}}function AY(e,t,r){const{alphaFlag:i,height:n,width:s}=e.getImageLevelInfo(t,0,0),{compressed:c,format:a,basisFormat:p}=WB(r,i),_=e.getImageTranscodedSizeInBytes(t,0,0,p),w=new Uint8Array(_);if(!e.transcodeImage(w,t,0,0,p,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:n,data:w,compressed:c,levelSize:_,hasAlpha:i,format:a}}function WB(e,t){let r=e&&e.basis&&e.basis.format;return r==="auto"&&(r=XB()),typeof r=="object"&&(r=t?r.alpha:r.noAlpha),r=r.toLowerCase(),wY[r]}function XB(){const e=_Y();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}const EY={name:"Basis",id:dh?"basis":"basis-nodejs",module:"textures",version:uY,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},TY={...EY,parse:xY};function il(e,t){if(!e)throw new Error(t||"assert failed: gltf")}function ZB(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const r=t.baseUri||t.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url ".concat(e));return r.substr(0,r.lastIndexOf("/")+1)+e}function CY(e,t,r){const i=e.bufferViews[r];il(i);const n=i.buffer,s=t[n];il(s);const c=(i.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,c,i.byteLength)}const HP=["SCALAR","VEC2","VEC3","VEC4"],PY=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],IY=new Map(PY),LY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},MY={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},BY={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function YB(e){return HP[e-1]||HP[0]}function JB(e){const t=IY.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function s3(e,t){const r=BY[e.componentType],i=LY[e.type],n=MY[e.componentType],s=e.count*i,c=e.count*i*n;return il(c>=0&&c<=t.byteLength),{ArrayType:r,length:s,byteLength:c}}function KB(e){let{images:t,bufferViews:r}=e;t=t||[],r=r||[];const i=t.map(c=>c.bufferView);r=r.filter(c=>!i.includes(c));const n=r.reduce((c,a)=>c+a.byteLength,0),s=t.reduce((c,a)=>{const{width:p,height:_}=a.image;return c+p*_},0);return n+Math.ceil(4*s*1.33)}const kY={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class Ca{constructor(t){q(this,"gltf",void 0),q(this,"sourceBuffers",void 0),q(this,"byteLength",void 0),this.gltf=t||{json:{...kY},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}getExtension(t){const r=this.getUsedExtensions().find(n=>n===t),i=this.json.extensions||{};return r?i[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find(r=>r===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,r){return(t.extensions||{})[r]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,r){if(typeof r=="object")return r;const i=this.json[t]&&this.json[t][r];if(!i)throw new Error("glTF file error: Could not find ".concat(t,"[").concat(r,"]"));return i}getTypedArrayForBufferView(t){t=this.getBufferView(t);const r=t.buffer,i=this.gltf.buffers[r];il(i);const n=(t.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,n,t.byteLength)}getTypedArrayForAccessor(t){t=this.getAccessor(t);const r=this.getBufferView(t.bufferView),i=this.getBuffer(r.buffer).data,{ArrayType:n,length:s}=s3(t,r),c=r.byteOffset+t.byteOffset;return new n(i,c,s)}getTypedArrayForImageData(t){t=this.getAccessor(t);const r=this.getBufferView(t.bufferView),i=this.getBuffer(r.buffer).data,n=r.byteOffset||0;return new Uint8Array(i,n,r.byteLength)}addApplicationData(t,r){return this.json[t]=r,this}addExtraData(t,r){return this.json.extras=this.json.extras||{},this.json.extras[t]=r,this}addObjectExtension(t,r,i){return t.extensions=t.extensions||{},t.extensions[r]=i,this.registerUsedExtension(r),this}setObjectExtension(t,r,i){const n=t.extensions||{};n[r]=i}removeObjectExtension(t,r){const i=t.extensions||{},n=i[r];return delete i[r],n}addExtension(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return il(r),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=r,this.registerUsedExtension(t),r}addRequiredExtension(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return il(r),this.addExtension(t,r),this.registerRequiredExtension(t),r}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(r=>r===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(r=>r===t)||this.json.extensionsRequired.push(t)}removeExtension(t){if(!this.getExtension(t))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const r=this.json.extensionsRemoved;r.includes(t)||r.push(t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:r}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:r}),this.json.scenes.length-1}addNode(t){const{meshIndex:r,matrix:i}=t;this.json.nodes=this.json.nodes||[];const n={mesh:r};return i&&(n.matrix=i),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(t){const{attributes:r,indices:i,material:n,mode:s=4}=t,c={primitives:[{attributes:this._addAttributes(r),mode:s}]};if(i){const a=this._addIndices(i);c.primitives[0].indices=a}return Number.isFinite(n)&&(c.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(t){const r={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(t,r){const i=vS(t),n=r||(i==null?void 0:i.mimeType),s={bufferView:this.addBufferView(t),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(t){const r=t.byteLength;il(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const i={buffer:0,byteOffset:this.byteLength,byteLength:r};return this.byteLength+=V0(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(t,r){const i={bufferView:t,type:YB(r.size),componentType:r.componentType,count:r.count,max:r.max,min:r.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const i=this.addBufferView(t);let n={min:r.min,max:r.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(t,r.size));const s={size:r.size,componentType:JB(t),count:Math.round(t.length/r.size),min:n.min,max:n.max};return this.addAccessor(i,Object.assign(s,r))}addTexture(t){const{imageIndex:r}=t,i={source:r};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,r;this.gltf.buffers=[];const i=this.byteLength,n=new ArrayBuffer(i),s=new Uint8Array(n);let c=0;for(const a of this.sourceBuffers||[])c=rz(a,s,c);(t=this.json)!==null&&t!==void 0&&(r=t.buffers)!==null&&r!==void 0&&r[0]?this.json.buffers[0].byteLength=i:this.json.buffers=[{byteLength:i}],this.gltf.binary=n,this.sourceBuffers=[n]}_removeStringFromArray(t,r){let i=!0;for(;i;){const n=t.indexOf(r);n>-1?t.splice(n,1):i=!1}}_addAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r={};for(const i in t){const n=t[i],s=this._getGltfAttributeName(i),c=this.addBinaryBuffer(n.value,n);r[s]=c}return r}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,r){const i={min:null,max:null};if(t.length<r)return i;i.min=[],i.max=[];const n=t.subarray(0,r);for(const s of n)i.min.push(s),i.max.push(s);for(let s=r;s<t.length;s+=r)for(let c=0;c<r;c++)i.min[0+c]=Math.min(i.min[0+c],t[s+c]),i.max[0+c]=Math.max(i.max[0+c],t[s+c]);return i}}const RY="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",FY="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",DY=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),NY=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),OY={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},zY={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function jY(e,t,r,i,n){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const c=await UY();qY(c,c.exports[zY[n]],e,t,r,i,c.exports[OY[s||"NONE"]])}let P2;async function UY(){return P2||(P2=GY()),P2}async function GY(){let e=RY;WebAssembly.validate(DY)&&(e=FY,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(VY(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function VY(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;++i){const n=e.charCodeAt(i);t[i]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let r=0;for(let i=0;i<e.length;++i)t[r++]=t[i]<60?NY[t[i]]:(t[i]-60)*64+t[++i];return t.buffer.slice(0,r)}function qY(e,t,r,i,n,s,c){const a=e.exports.sbrk,p=i+3&-4,_=a(p*n),w=a(s.length),S=new Uint8Array(e.exports.memory.buffer);S.set(s,w);const C=t(_,i,n,w,s.length);if(C===0&&c&&c(_,p,n),r.set(S.subarray(_,_+i*n)),a(_-a(0)),C!==0)throw new Error("Malformed buffer data: ".concat(C))}const o3="EXT_meshopt_compression",HY=o3;async function $Y(e,t){var r;const i=new Ca(e);if(!(t!=null&&(r=t.gltf)!==null&&r!==void 0&&r.decompressMeshes))return;const n=[];for(const s of e.json.bufferViews||[])n.push(WY(i,s));await Promise.all(n),i.removeExtension(o3)}async function WY(e,t){const r=e.getObjectExtension(t,o3);if(r){const{byteOffset:i=0,byteLength:n=0,byteStride:s,count:c,mode:a,filter:p="NONE",buffer:_}=r,w=e.gltf.buffers[_],S=new Uint8Array(w.arrayBuffer,w.byteOffset+i,n),C=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);return await jY(C,c,s,S,a,p),C}return null}const XY=Object.freeze(Object.defineProperty({__proto__:null,decode:$Y,name:HY},Symbol.toStringTag,{value:"Module"})),Sf="EXT_texture_webp",ZY=Sf;function YY(e,t){const r=new Ca(e);if(!Q7("image/webp")){if(r.getRequiredExtensions().includes(Sf))throw new Error("gltf: Required extension ".concat(Sf," not supported by browser"));return}const{json:i}=r;for(const n of i.textures||[]){const s=r.getObjectExtension(n,Sf);s&&(n.source=s.source),r.removeObjectExtension(n,Sf)}r.removeExtension(Sf)}const JY=Object.freeze(Object.defineProperty({__proto__:null,name:ZY,preprocess:YY},Symbol.toStringTag,{value:"Module"})),zy="KHR_texture_basisu",KY=zy;function QY(e,t){const r=new Ca(e),{json:i}=r;for(const n of i.textures||[]){const s=r.getObjectExtension(n,zy);s&&(n.source=s.source),r.removeObjectExtension(n,zy)}r.removeExtension(zy)}const tJ=Object.freeze(Object.defineProperty({__proto__:null,name:KY,preprocess:QY},Symbol.toStringTag,{value:"Module"})),eJ="3.4.15",rJ={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},iJ={name:"Draco",id:dh?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:eJ,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:rJ};function nJ(e,t,r){const i=QB(t.metadata),n=[],s=sJ(t.attributes);for(const c in e){const a=e[c],p=$P(c,a,s[c]);n.push(p)}if(r){const c=$P("indices",r);n.push(c)}return new Uf(n,i)}function sJ(e){const t={};for(const r in e){const i=e[r];t[i.name||"undefined"]=i}return t}function $P(e,t,r){const i=r?QB(r.metadata):void 0;return UZ(e,t,i)}function QB(e){const t=new Map;for(const r in e)t.set("".concat(r,".string"),JSON.stringify(e[r]));return t}const WP={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},oJ={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},aJ=4;class lJ{constructor(t){q(this,"draco",void 0),q(this,"decoder",void 0),q(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(r);const n=this.decoder.GetEncodedGeometryType(i),s=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let c;switch(n){case this.draco.TRIANGULAR_MESH:c=this.decoder.DecodeBufferToMesh(i,s);break;case this.draco.POINT_CLOUD:c=this.decoder.DecodeBufferToPointCloud(i,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!c.ok()||!s.ptr){const S="DRACO decompression failed: ".concat(c.error_msg());throw new Error(S)}const a=this._getDracoLoaderData(s,n,r),p=this._getMeshData(s,a,r),_=zB(p.attributes),w=nJ(p.attributes,a,p.indices);return{loader:"draco",loaderData:a,header:{vertexCount:s.num_points(),boundingBox:_},...p,schema:w}}finally{this.draco.destroy(i),s&&this.draco.destroy(s)}}_getDracoLoaderData(t,r,i){const n=this._getTopLevelMetadata(t),s=this._getDracoAttributes(t,i);return{geometry_type:r,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:n,attributes:s}}_getDracoAttributes(t,r){const i={};for(let n=0;n<t.num_attributes();n++){const s=this.decoder.GetAttribute(t,n),c=this._getAttributeMetadata(t,n);i[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:n,metadata:c};const a=this._getQuantizationTransform(s,r);a&&(i[s.unique_id()].quantization_transform=a);const p=this._getOctahedronTransform(s,r);p&&(i[s.unique_id()].octahedron_transform=p)}return i}_getMeshData(t,r,i){const n=this._getMeshAttributes(r,t,i);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(t,r,i){const n={};for(const s of Object.values(t.attributes)){const c=this._deduceAttributeName(s,i);s.name=c;const{value:a,size:p}=this._getAttributeValues(r,s);n[c]={value:a,size:p,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}return n}_getTriangleListIndices(t){const r=t.num_faces()*3,i=r*aJ,n=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(t,i,n),new Uint32Array(this.draco.HEAPF32.buffer,n,r).slice()}finally{this.draco._free(n)}}_getTriangleStripIndices(t){const r=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,r),hJ(r)}finally{this.draco.destroy(r)}}_getAttributeValues(t,r){const i=oJ[r.data_type],n=r.num_components,s=t.num_points()*n,c=s*i.BYTES_PER_ELEMENT,a=cJ(this.draco,i);let p;const _=this.draco._malloc(c);try{const w=this.decoder.GetAttribute(t,r.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,w,a,c,_),p=new i(this.draco.HEAPF32.buffer,_,s).slice()}finally{this.draco._free(_)}return{value:p,size:n}}_deduceAttributeName(t,r){const i=t.unique_id;for(const[c,a]of Object.entries(r.extraAttributes||{}))if(a===i)return c;const n=t.attribute_type;for(const c in WP)if(this.draco[c]===n)return WP[c];const s=r.attributeNameEntry||"name";return t.metadata[s]?t.metadata[s].string:"CUSTOM_ATTRIBUTE_".concat(i)}_getTopLevelMetadata(t){const r=this.decoder.GetMetadata(t);return this._getDracoMetadata(r)}_getAttributeMetadata(t,r){const i=this.decoder.GetAttributeMetadata(t,r);return this._getDracoMetadata(i)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const r={},i=this.metadataQuerier.NumEntries(t);for(let n=0;n<i;n++){const s=this.metadataQuerier.GetEntryName(t,n);r[s]=this._getDracoMetadataField(t,s)}return r}_getDracoMetadataField(t,r){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,r,i);const n=uJ(i);return{int:this.metadataQuerier.GetIntEntry(t,r),string:this.metadataQuerier.GetStringEntry(t,r),double:this.metadataQuerier.GetDoubleEntry(t,r),intArray:n}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(t){const{quantizedAttributes:r=[],octahedronAttributes:i=[]}=t,n=[...r,...i];for(const s of n)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(t,r){const{quantizedAttributes:i=[]}=r,n=t.attribute_type();if(i.map(s=>this.decoder[s]).includes(n)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(t))return{quantization_bits:s.quantization_bits(),range:s.range(),min_values:new Float32Array([1,2,3]).map(c=>s.min_value(c))}}finally{this.draco.destroy(s)}}return null}_getOctahedronTransform(t,r){const{octahedronAttributes:i=[]}=r,n=t.attribute_type();if(i.map(s=>this.decoder[s]).includes(n)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(t))return{quantization_bits:s.quantization_bits()}}finally{this.draco.destroy(s)}}return null}}function cJ(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}function uJ(e){const t=e.size(),r=new Int32Array(t);for(let i=0;i<t;i++)r[i]=e.GetValue(i);return r}function hJ(e){const t=e.size(),r=new Int32Array(t);for(let i=0;i<t;i++)r[i]=e.GetValue(i);return r}const dJ="1.5.5",a3="https://www.gstatic.com/draco/versioned/decoders/".concat(dJ),pJ="".concat(a3,"/draco_decoder.js"),fJ="".concat(a3,"/draco_wasm_wrapper.js"),mJ="".concat(a3,"/draco_decoder.wasm");let Ag;async function gJ(e){const t=e.modules||{};return t.draco3d?Ag=Ag||t.draco3d.createDecoderModule({}).then(r=>({draco:r})):Ag=Ag||yJ(e),await Ag}async function yJ(e){let t,r;switch(e.draco&&e.draco.decoderType){case"js":t=await wp(pJ,"draco",e);break;case"wasm":default:[t,r]=await Promise.all([await wp(fJ,"draco",e),await wp(mJ,"draco",e)])}return t=t||globalThis.DracoDecoderModule,await _J(t,r)}function _J(e,t){const r={};return t&&(r.wasmBinary=t),new Promise(i=>{e({...r,onModuleLoaded:n=>i({draco:n})})})}const tk={...iJ,parse:vJ};async function vJ(e,t){const{draco:r}=await gJ(t),i=new lJ(r);try{return i.parseSync(e,t==null?void 0:t.draco)}finally{i.destroy()}}function bJ(e){const t={};for(const r in e){const i=e[r];if(r!=="indices"){const n=ek(i);t[r]=n}}return t}function ek(e){const{buffer:t,size:r,count:i}=wJ(e);return{value:t,size:r,byteOffset:0,count:i,type:YB(r),componentType:JB(t)}}function wJ(e){let t=e,r=1,i=0;return e&&e.value&&(t=e.value,r=e.size||1),t&&(ArrayBuffer.isView(t)||(t=xJ(t,Float32Array)),i=t.length/r),{buffer:t,size:r,count:i}}function xJ(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return e?Array.isArray(e)?new t(e):r&&!(e instanceof t)?new t(e):e:null}const kp="KHR_draco_mesh_compression",SJ=kp;function AJ(e,t,r){const i=new Ca(e);for(const n of rk(i))i.getObjectExtension(n,kp)}async function EJ(e,t,r){var i;if(!(t!=null&&(i=t.gltf)!==null&&i!==void 0&&i.decompressMeshes))return;const n=new Ca(e),s=[];for(const c of rk(n))n.getObjectExtension(c,kp)&&s.push(CJ(n,c,t,r));await Promise.all(s),n.removeExtension(kp)}function TJ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new Ca(e);for(const i of r.json.meshes||[])PJ(i,t),r.addRequiredExtension(kp)}async function CJ(e,t,r,i){const n=e.getObjectExtension(t,kp);if(!n)return;const s=e.getTypedArrayForBufferView(n.bufferView),c=hS(s.buffer,s.byteOffset),{parse:a}=i,p={...r};delete p["3d-tiles"];const _=await a(c,tk,p,i),w=bJ(_.attributes);for(const[S,C]of Object.entries(w))if(S in t.attributes){const I=t.attributes[S],N=e.getAccessor(I);N!=null&&N.min&&N!==null&&N!==void 0&&N.max&&(C.min=N.min,C.max=N.max)}t.attributes=w,_.indices&&(t.indices=ek(_.indices)),IJ(t)}function PJ(e,t){var r;let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,n=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const c=n.DracoWriter.encodeSync({attributes:e}),a=s==null||(r=s.parseSync)===null||r===void 0?void 0:r.call(s,{attributes:e}),p=n._addFauxAttributes(a.attributes),_=n.addBufferView(c);return{primitives:[{attributes:p,mode:i,extensions:{[kp]:{bufferView:_,attributes:p}}}]}}function IJ(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*rk(e){for(const t of e.json.meshes||[])for(const r of t.primitives)yield r}const LJ=Object.freeze(Object.defineProperty({__proto__:null,decode:EJ,encode:TJ,name:SJ,preprocess:AJ},Symbol.toStringTag,{value:"Module"})),MJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},BJ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},l3="KHR_texture_transform",kJ=l3,cy=new te,RJ=new jn,FJ=new jn;async function DJ(e,t){if(!new Ca(e).getExtension(l3))return;const r=e.json.materials||[];for(let i=0;i<r.length;i++)NJ(i,e)}function NJ(e,t){var r,i,n;const s=[],c=(r=t.json.materials)===null||r===void 0?void 0:r[e],a=c==null||(i=c.pbrMetallicRoughness)===null||i===void 0?void 0:i.baseColorTexture;a&&Eg(t,e,a,s);const p=c==null?void 0:c.emissiveTexture;p&&Eg(t,e,p,s);const _=c==null?void 0:c.normalTexture;_&&Eg(t,e,_,s);const w=c==null?void 0:c.occlusionTexture;w&&Eg(t,e,w,s);const S=c==null||(n=c.pbrMetallicRoughness)===null||n===void 0?void 0:n.metallicRoughnessTexture;S&&Eg(t,e,S,s)}function Eg(e,t,r,i){const n=OJ(r,i);if(!n)return;const s=e.json.meshes||[];for(const c of s)for(const a of c.primitives){const p=a.material;Number.isFinite(p)&&t===p&&zJ(e,a,n)}}function OJ(e,t){var r;const i=(r=e.extensions)===null||r===void 0?void 0:r[l3],{texCoord:n=0}=e,{texCoord:s=n}=i;if(t.findIndex(c=>{let[a,p]=c;return a===n&&p===s})===-1){const c=GJ(i);return n!==s&&(e.texCoord=s),t.push([n,s]),{originalTexCoord:n,texCoord:s,matrix:c}}return null}function zJ(e,t,r){const{originalTexCoord:i,texCoord:n,matrix:s}=r,c=t.attributes["TEXCOORD_".concat(i)];if(Number.isFinite(c)){var a;const _=(a=e.json.accessors)===null||a===void 0?void 0:a[c];if(_&&_.bufferView){var p;const w=(p=e.json.bufferViews)===null||p===void 0?void 0:p[_.bufferView];if(w){const{arrayBuffer:S,byteOffset:C}=e.buffers[w.buffer],I=(C||0)+(_.byteOffset||0)+(w.byteOffset||0),{ArrayType:N,length:F}=s3(_,w),W=BJ[_.componentType],U=MJ[_.type],z=w.byteStride||W*U,H=new Float32Array(F);for(let nt=0;nt<_.count;nt++){const yt=new N(S,I+nt*z,2);cy.set(yt[0],yt[1],1),cy.transformByMatrix3(s),H.set([cy[0],cy[1]],nt*U)}i===n?jJ(_,w,e.buffers,H):UJ(n,_,t,e,H)}}}}function jJ(e,t,r,i){e.componentType=5126,r.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),t.buffer=r.length-1,t.byteLength=i.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function UJ(e,t,r,i,n){i.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});const s=i.json.bufferViews;if(!s)return;s.push({buffer:i.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});const c=i.json.accessors;c&&(c.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),r.attributes["TEXCOORD_".concat(e)]=c.length-1)}function GJ(e){const{offset:t=[0,0],rotation:r=0,scale:i=[1,1]}=e,n=new jn().set(1,0,0,0,1,0,t[0],t[1],1),s=RJ.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),c=FJ.set(i[0],0,0,0,i[1],0,0,0,1);return n.multiplyRight(s).multiplyRight(c)}const VJ=Object.freeze(Object.defineProperty({__proto__:null,decode:DJ,name:kJ},Symbol.toStringTag,{value:"Module"})),mp="KHR_lights_punctual",qJ=mp;async function HJ(e){const t=new Ca(e),{json:r}=t,i=t.getExtension(mp);i&&(t.json.lights=i.lights,t.removeExtension(mp));for(const n of r.nodes||[]){const s=t.getObjectExtension(n,mp);s&&(n.light=s.light),t.removeObjectExtension(n,mp)}}async function $J(e){const t=new Ca(e),{json:r}=t;if(r.lights){const i=t.addExtension(mp);il(!i.lights),i.lights=r.lights,delete r.lights}if(t.json.lights){for(const i of t.json.lights){const n=i.node;t.addObjectExtension(n,mp,i)}delete t.json.lights}}const WJ=Object.freeze(Object.defineProperty({__proto__:null,decode:HJ,encode:$J,name:qJ},Symbol.toStringTag,{value:"Module"})),M0="KHR_materials_unlit",XJ=M0;async function ZJ(e){const t=new Ca(e),{json:r}=t;for(const i of r.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),t.removeObjectExtension(i,M0);t.removeExtension(M0)}function YJ(e){const t=new Ca(e),{json:r}=t;if(t.materials)for(const i of r.materials||[])i.unlit&&(delete i.unlit,t.addObjectExtension(i,M0,{}),t.addExtension(M0))}const JJ=Object.freeze(Object.defineProperty({__proto__:null,decode:ZJ,encode:YJ,name:XJ},Symbol.toStringTag,{value:"Module"})),zg="KHR_techniques_webgl",KJ=zg;async function QJ(e){const t=new Ca(e),{json:r}=t,i=t.getExtension(zg);if(i){const n=eK(i,t);for(const s of r.materials||[]){const c=t.getObjectExtension(s,zg);c&&(s.technique=Object.assign({},c,n[c.technique]),s.technique.values=rK(s.technique,t)),t.removeObjectExtension(s,zg)}t.removeExtension(zg)}}async function tK(e,t){}function eK(e,t){const{programs:r=[],shaders:i=[],techniques:n=[]}=e,s=new TextDecoder;return i.forEach(c=>{if(Number.isFinite(c.bufferView))c.code=s.decode(t.getTypedArrayForBufferView(c.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(c=>{c.fragmentShader=i[c.fragmentShader],c.vertexShader=i[c.vertexShader]}),n.forEach(c=>{c.program=r[c.program]}),n}function rK(e,t){const r=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(i=>{e.uniforms[i].value&&!(i in r)&&(r[i]=e.uniforms[i].value)}),Object.keys(r).forEach(i=>{typeof r[i]=="object"&&r[i].index!==void 0&&(r[i].texture=t.getTexture(r[i].index))}),r}const iK=Object.freeze(Object.defineProperty({__proto__:null,decode:QJ,encode:tK,name:KJ},Symbol.toStringTag,{value:"Module"})),ik="EXT_feature_metadata",nK=ik;async function sK(e){const t=new Ca(e);oK(t)}function oK(e){var t;const r=e.getExtension(ik),i=r==null||(t=r.schema)===null||t===void 0?void 0:t.classes,n=r==null?void 0:r.featureTables;if(r!=null&&r.featureTextures&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),i&&n)for(const s in i){const c=i[s],a=cK(n,s);a&&aK(e,a,c)}}function aK(e,t,r){for(const n in r.properties){var i;const s=r.properties[n],c=t==null||(i=t.properties)===null||i===void 0?void 0:i[n],a=t.count;if(c){const p=lK(e,s,a,c);c.data=p}}}function lK(e,t,r,i){const n=i.bufferView;let s=e.getTypedArrayForBufferView(n);switch(t.type){case"STRING":{const c=i.stringOffsetBufferView,a=e.getTypedArrayForBufferView(c);s=uK(s,a,r);break}}return s}function cK(e,t){for(const r in e){const i=e[r];if(i.class===t)return i}return null}function uK(e,t,r){const i=[],n=new TextDecoder("utf8");let s=0;const c=4;for(let a=0;a<r;a++){const p=t[(a+1)*c]-t[a*c],_=e.subarray(s,p+s),w=n.decode(_);i.push(w),s+=p}return i}const hK=Object.freeze(Object.defineProperty({__proto__:null,decode:sK,name:nK},Symbol.toStringTag,{value:"Module"})),nk=[XY,JY,tJ,LJ,WJ,JJ,iK,VJ,hK];function dK(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;const i=nk.filter(s=>sk(s.name,t));for(const s of i){var n;(n=s.preprocess)===null||n===void 0||n.call(s,e,t,r)}}async function pK(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;const i=nk.filter(s=>sk(s.name,t));for(const s of i){var n;await((n=s.decode)===null||n===void 0?void 0:n.call(s,e,t,r))}}function sk(e,t){var r;const i=(t==null||(r=t.gltf)===null||r===void 0?void 0:r.excludeExtensions)||{};return!(e in i&&!i[e])}const I2="KHR_binary_glTF";function fK(e){const t=new Ca(e),{json:r}=t;for(const i of r.images||[]){const n=t.getObjectExtension(i,I2);n&&Object.assign(i,n),t.removeObjectExtension(i,I2)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,t.removeExtension(I2)}const XP={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},mK={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class gK{constructor(){q(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),q(this,"json",void 0)}normalize(t,r){this.json=t.json;const i=t.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(i.asset.version));return}if(!r.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),fK(t),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const r in XP)this._convertTopLevelObjectToArray(t,r)}_convertTopLevelObjectToArray(t,r){const i=t[r];if(!(!i||Array.isArray(i))){t[r]=[];for(const n in i){const s=i[n];s.id=s.id||n;const c=t[r].length;t[r].push(s),this.idToIndexMap[r][n]=c}}}_convertObjectIdsToArrayIndices(t){for(const r in XP)this._convertIdsToIndices(t,r);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const r of t.textures)this._convertTextureIds(r);for(const r of t.meshes)this._convertMeshIds(r);for(const r of t.nodes)this._convertNodeIds(r);for(const r of t.scenes)this._convertSceneIds(r)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const r of t.primitives){const{attributes:i,indices:n,material:s}=r;for(const c in i)i[c]=this._convertIdToIndex(i[c],"accessor");n&&(r.indices=this._convertIdToIndex(n,"accessor")),s&&(r.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(r=>this._convertIdToIndex(r,"node"))),t.meshes&&(t.meshes=t.meshes.map(r=>this._convertIdToIndex(r,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(r=>this._convertIdToIndex(r,"node")))}_convertIdsToIndices(t,r){t[r]||(console.warn("gltf v1: json doesn't contain attribute ".concat(r)),t[r]=[]);for(const i of t[r])for(const n in i){const s=i[n],c=this._convertIdToIndex(s,n);i[n]=c}}_convertIdToIndex(t,r){const i=mK[r];if(i in this.idToIndexMap){const n=this.idToIndexMap[i][t];if(!Number.isFinite(n))throw new Error("gltf v1: failed to resolve ".concat(r," with id ").concat(t));return n}return t}_updateObjects(t){for(const r of this.json.buffers)delete r.type}_updateMaterial(t){for(const s of t.materials){var r,i,n;s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const c=((r=s.values)===null||r===void 0?void 0:r.tex)||((i=s.values)===null||i===void 0?void 0:i.texture2d_0)||((n=s.values)===null||n===void 0?void 0:n.diffuseTex),a=t.textures.findIndex(p=>p.id===c);a!==-1&&(s.pbrMetallicRoughness.baseColorTexture={index:a})}}}function yK(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new gK().normalize(e,t)}const _K={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vK={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Bl={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},bK={magFilter:Bl.TEXTURE_MAG_FILTER,minFilter:Bl.TEXTURE_MIN_FILTER,wrapS:Bl.TEXTURE_WRAP_S,wrapT:Bl.TEXTURE_WRAP_T},wK={[Bl.TEXTURE_MAG_FILTER]:Bl.LINEAR,[Bl.TEXTURE_MIN_FILTER]:Bl.NEAREST_MIPMAP_LINEAR,[Bl.TEXTURE_WRAP_S]:Bl.REPEAT,[Bl.TEXTURE_WRAP_T]:Bl.REPEAT};function xK(e){return vK[e]}function SK(e){return _K[e]}class AK{constructor(){q(this,"baseUri",""),q(this,"json",{}),q(this,"buffers",[]),q(this,"images",[])}postProcess(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:i,buffers:n=[],images:s=[],baseUri:c=""}=t;return il(i),this.baseUri=c,this.json=i,this.buffers=n,this.images=s,this._resolveTree(this.json,r),this.json}_resolveTree(t){t.bufferViews&&(t.bufferViews=t.bufferViews.map((r,i)=>this._resolveBufferView(r,i))),t.images&&(t.images=t.images.map((r,i)=>this._resolveImage(r,i))),t.samplers&&(t.samplers=t.samplers.map((r,i)=>this._resolveSampler(r,i))),t.textures&&(t.textures=t.textures.map((r,i)=>this._resolveTexture(r,i))),t.accessors&&(t.accessors=t.accessors.map((r,i)=>this._resolveAccessor(r,i))),t.materials&&(t.materials=t.materials.map((r,i)=>this._resolveMaterial(r,i))),t.meshes&&(t.meshes=t.meshes.map((r,i)=>this._resolveMesh(r,i))),t.nodes&&(t.nodes=t.nodes.map((r,i)=>this._resolveNode(r,i))),t.skins&&(t.skins=t.skins.map((r,i)=>this._resolveSkin(r,i))),t.scenes&&(t.scenes=t.scenes.map((r,i)=>this._resolveScene(r,i))),t.scene!==void 0&&(t.scene=t.scenes[this.json.scene])}getScene(t){return this._get("scenes",t)}getNode(t){return this._get("nodes",t)}getSkin(t){return this._get("skins",t)}getMesh(t){return this._get("meshes",t)}getMaterial(t){return this._get("materials",t)}getAccessor(t){return this._get("accessors",t)}getCamera(t){return null}getTexture(t){return this._get("textures",t)}getSampler(t){return this._get("samplers",t)}getImage(t){return this._get("images",t)}getBufferView(t){return this._get("bufferViews",t)}getBuffer(t){return this._get("buffers",t)}_get(t,r){if(typeof r=="object")return r;const i=this.json[t]&&this.json[t][r];return i||console.warn("glTF file error: Could not find ".concat(t,"[").concat(r,"]")),i}_resolveScene(t,r){return t.id=t.id||"scene-".concat(r),t.nodes=(t.nodes||[]).map(i=>this.getNode(i)),t}_resolveNode(t,r){return t.id=t.id||"node-".concat(r),t.children&&(t.children=t.children.map(i=>this.getNode(i))),t.mesh!==void 0?t.mesh=this.getMesh(t.mesh):t.meshes!==void 0&&t.meshes.length&&(t.mesh=t.meshes.reduce((i,n)=>{const s=this.getMesh(n);return i.id=s.id,i.primitives=i.primitives.concat(s.primitives),i},{primitives:[]})),t.camera!==void 0&&(t.camera=this.getCamera(t.camera)),t.skin!==void 0&&(t.skin=this.getSkin(t.skin)),t}_resolveSkin(t,r){return t.id=t.id||"skin-".concat(r),t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}_resolveMesh(t,r){return t.id=t.id||"mesh-".concat(r),t.primitives&&(t.primitives=t.primitives.map(i=>{i={...i};const n=i.attributes;i.attributes={};for(const s in n)i.attributes[s]=this.getAccessor(n[s]);return i.indices!==void 0&&(i.indices=this.getAccessor(i.indices)),i.material!==void 0&&(i.material=this.getMaterial(i.material)),i})),t}_resolveMaterial(t,r){if(t.id=t.id||"material-".concat(r),t.normalTexture&&(t.normalTexture={...t.normalTexture},t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture={...t.occlustionTexture},t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture={...t.emmisiveTexture},t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.emissiveFactor||(t.emissiveFactor=t.emmisiveTexture?[1,1,1]:[0,0,0]),t.pbrMetallicRoughness){t.pbrMetallicRoughness={...t.pbrMetallicRoughness};const i=t.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return t}_resolveAccessor(t,r){if(t.id=t.id||"accessor-".concat(r),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=xK(t.componentType),t.components=SK(t.type),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){const i=t.bufferView.buffer,{ArrayType:n,byteLength:s}=s3(t,t.bufferView),c=(t.bufferView.byteOffset||0)+(t.byteOffset||0)+i.byteOffset;let a=i.arrayBuffer.slice(c,c+s);t.bufferView.byteStride&&(a=this._getValueFromInterleavedBuffer(i,c,t.bufferView.byteStride,t.bytesPerElement,t.count)),t.value=new n(a)}return t}_getValueFromInterleavedBuffer(t,r,i,n,s){const c=new Uint8Array(s*n);for(let a=0;a<s;a++){const p=r+a*i;c.set(new Uint8Array(t.arrayBuffer.slice(p,p+n)),a*n)}return c.buffer}_resolveTexture(t,r){return t.id=t.id||"texture-".concat(r),t.sampler="sampler"in t?this.getSampler(t.sampler):wK,t.source=this.getImage(t.source),t}_resolveSampler(t,r){t.id=t.id||"sampler-".concat(r),t.parameters={};for(const i in t){const n=this._enumSamplerParameter(i);n!==void 0&&(t.parameters[n]=t[i])}return t}_enumSamplerParameter(t){return bK[t]}_resolveImage(t,r){t.id=t.id||"image-".concat(r),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView));const i=this.images[r];return i&&(t.image=i),t}_resolveBufferView(t,r){const i=t.buffer,n={id:"bufferView-".concat(r),...t,buffer:this.buffers[i]},s=this.buffers[i].arrayBuffer;let c=this.buffers[i].byteOffset||0;return"byteOffset"in t&&(c+=t.byteOffset),n.data=new Uint8Array(s,c,t.byteLength),n}_resolveCamera(t,r){return t.id=t.id||"camera-".concat(r),t.perspective,t.orthographic,t}}function EK(e,t){return new AK().postProcess(e,t)}const ZP=1735152710,c3=12,z_=8,TK=1313821514,CK=5130562,PK=0,IK=1,LK=0,xm=!0;function MK(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}function BK(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=new DataView(e),{magic:n=ZP}=r,s=i.getUint32(t,!1);return s===n||s===ZP}function kK(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=new DataView(t),n=MK(i,r+0),s=i.getUint32(r+4,xm),c=i.getUint32(r+8,xm);switch(Object.assign(e,{header:{byteOffset:r,byteLength:c,hasBinChunk:!1},type:n,version:s,json:{},binChunks:[]}),r+=c3,e.version){case 1:return RK(e,i,r);case 2:return FK(e,i,r,{});default:throw new Error("Invalid GLB version ".concat(e.version,". Only supports v1 and v2."))}}function RK(e,t,r){Ki(e.header.byteLength>c3+z_);const i=t.getUint32(r+0,xm),n=t.getUint32(r+4,xm);return r+=z_,Ki(n===LK),Rx(e,t,r,i),r+=i,r+=Fx(e,t,r,e.header.byteLength),r}function FK(e,t,r,i){return Ki(e.header.byteLength>c3+z_),DK(e,t,r,i),r+e.header.byteLength}function DK(e,t,r,i){for(;r+8<=e.header.byteLength;){const n=t.getUint32(r+0,xm),s=t.getUint32(r+4,xm);switch(r+=z_,s){case TK:Rx(e,t,r,n);break;case CK:Fx(e,t,r,n);break;case PK:i.strict||Rx(e,t,r,n);break;case IK:i.strict||Fx(e,t,r,n);break}r+=V0(n,4)}return r}function Rx(e,t,r,i){const n=new Uint8Array(t.buffer,r,i),s=new TextDecoder("utf8").decode(n);return e.json=JSON.parse(s),V0(i,4)}function Fx(e,t,r,i){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:r,byteLength:i,arrayBuffer:t.buffer}),V0(i,4)}async function NK(e,t){var r,i,n,s;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0;OK(e,t,c,a),yK(e,{normalize:a==null||(r=a.gltf)===null||r===void 0?void 0:r.normalize}),dK(e,a,p);const _=[];if(a!=null&&(i=a.gltf)!==null&&i!==void 0&&i.loadBuffers&&e.json.buffers&&await zK(e,a,p),a!=null&&(n=a.gltf)!==null&&n!==void 0&&n.loadImages){const S=jK(e,a,p);_.push(S)}const w=pK(e,a,p);return _.push(w),await Promise.all(_),a!=null&&(s=a.gltf)!==null&&s!==void 0&&s.postProcess?EK(e,a):e}function OK(e,t,r,i){if(i.uri&&(e.baseUri=i.uri),t instanceof ArrayBuffer&&!BK(t,r,i)&&(t=new TextDecoder().decode(t)),typeof t=="string")e.json=QO(t);else if(t instanceof ArrayBuffer){const c={};r=kK(c,t,r,i.glb),il(c.type==="glTF","Invalid GLB magic string ".concat(c.type)),e._glb=c,e.json=c.json}else il(!1,"GLTF: must be ArrayBuffer or string");const n=e.json.buffers||[];if(e.buffers=new Array(n.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:c}=e._glb;e.buffers[0]={arrayBuffer:c[0].arrayBuffer,byteOffset:c[0].byteOffset,byteLength:c[0].byteLength}}const s=e.json.images||[];e.images=new Array(s.length).fill({})}async function zK(e,t,r){const i=e.json.buffers||[];for(let c=0;c<i.length;++c){const a=i[c];if(a.uri){var n,s;const{fetch:p}=r;il(p);const _=ZB(a.uri,t),w=await(r==null||(n=r.fetch)===null||n===void 0?void 0:n.call(r,_)),S=await(w==null||(s=w.arrayBuffer)===null||s===void 0?void 0:s.call(w));e.buffers[c]={arrayBuffer:S,byteOffset:0,byteLength:S.byteLength},delete a.uri}else e.buffers[c]===null&&(e.buffers[c]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function jK(e,t,r){const i=UK(e),n=e.json.images||[],s=[];for(const c of i)s.push(GK(e,n[c],c,t,r));return await Promise.all(s)}function UK(e){const t=new Set,r=e.json.textures||[];for(const i of r)i.source!==void 0&&t.add(i.source);return Array.from(t).sort()}async function GK(e,t,r,i,n){const{fetch:s,parse:c}=n;let a;if(t.uri&&!t.hasOwnProperty("bufferView")){const _=ZB(t.uri,i);a=await(await s(_)).arrayBuffer(),t.bufferView={data:a}}if(Number.isFinite(t.bufferView)){const _=CY(e.json,e.buffers,t.bufferView);a=hS(_.buffer,_.byteOffset,_.byteLength)}il(a,"glTF image has no data");let p=await c(a,[a6,TY],{mimeType:t.mimeType,basis:i.basis||{format:XB()}},n);p&&p[0]&&(p={compressed:!0,mipmaps:!1,width:p[0].width,height:p[0].height,data:p[0]}),e.images=e.images||[],e.images[r]=p}const B0={name:"glTF",id:"gltf",module:"gltf",version:cY,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:VK,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function VK(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;t={...B0.options,...t},t.gltf={...B0.options.gltf,...t.gltf};const{byteOffset:i=0}=t;return await NK({},e,i,t,r)}async function qK(e){const t=[];return e.scenes.forEach(r=>{r.traverse(i=>{Object.values(i.model.getUniforms()).forEach(n=>{n.loaded===!1&&t.push(n)})})}),await HK(()=>t.some(r=>!r.loaded))}async function HK(e){for(;e();)await new Promise(t=>requestAnimationFrame(t))}const $K=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,WK=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,ok=[255,255,255,255],XK={scenegraph:{type:"object",value:null,async:!0},getScene:e=>e&&e.scenes?typeof e.scene=="object"?e.scene:e.scenes[e.scene||0]:e,getAnimator:e=>e&&e.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:ok},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[B0]};class u3 extends Lm{constructor(){super(...arguments),q(this,"state",void 0)}getShaders(){const t=[HS,$S];return this.props._lighting==="pbr"&&t.push(OS),super.getShaders({vs:$K,fs:WK,modules:t})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:ok,transition:!0},instanceModelMatrix:NB})}updateState(t){super.updateState(t);const{props:r,oldProps:i}=t;r.scenegraph!==i.scenegraph?this._updateScenegraph():r._animations!==i._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,r._animations)}finalizeState(t){super.finalizeState(t),this._deleteScenegraph()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.scenegraph)&&super.isLoaded}_updateScenegraph(){const t=this.props,{gl:r}=this.context;let i=null;if(t.scenegraph instanceof Qf)i={scenes:[t.scenegraph]};else if(t.scenegraph&&!t.scenegraph.gltf){const a=t.scenegraph,p=lY(r,a,this._getModelOptions());i={gltf:a,...p},qK(p).then(()=>this.setNeedsRedraw())}else t.scenegraph&&(pi.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),i=t.scenegraph);const n={layer:this,gl:r},s=t.getScene(i,n),c=t.getAnimator(i,n);s instanceof Qf?(this._deleteScenegraph(),this._applyAllAttributes(s),this._applyAnimationsProp(s,c,t._animations),this.setState({scenegraph:s,animator:c})):s!==null&&pi.warn("invalid scenegraph:",s)()}_applyAllAttributes(t){if(this.state.attributesAvailable){const r=this.getAttributeManager().getAttributes();t.traverse(i=>{this._setModelAttributes(i.model,r)})}}_applyAnimationsProp(t,r,i){if(!t||!r||!i)return;const n=r.getAnimations();Object.keys(i).sort().forEach(s=>{const c=i[s];if(s==="*")n.forEach(a=>{Object.assign(a,c)});else if(Number.isFinite(Number(s))){const a=Number(s);a>=0&&a<n.length?Object.assign(n[a],c):pi.warn("animation ".concat(s," not found"))()}else{const a=n.find(p=>{let{name:_}=p;return _===s});a?Object.assign(a,c):pi.warn("animation ".concat(s," not found"))()}})}_deleteScenegraph(){const{scenegraph:t}=this.state;t instanceof Qf&&t.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let r=null;return t&&(typeof t=="function"?r=t({gl:this.context.gl,layer:this}):r=t),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:r,modelOptions:{isInstanced:!0,transpileToGLSL100:!ri(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(t){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(r=>{this._setModelAttributes(r.model,t)})}draw(t){let{moduleParameters:r=null,parameters:i={},context:n}=t;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(n.timeline.getTime()),this.setNeedsRedraw());const{viewport:s}=this.context,{sizeScale:c,sizeMinPixels:a,sizeMaxPixels:p,opacity:_,coordinateSystem:w}=this.props,S=this.getNumInstances();this.state.scenegraph.traverse((C,I)=>{let{worldMatrix:N}=I;C.model.setInstanceCount(S),C.updateModuleSettings(r),C.draw({parameters:i,uniforms:{sizeScale:c,opacity:_,sizeMinPixels:a,sizeMaxPixels:p,composeModelMatrix:OB(s,w),sceneModelMatrix:N,u_Camera:C.model.getUniforms().project_uCameraPosition}})})}}q(u3,"defaultProps",XK);q(u3,"layerName","ScenegraphLayer");const ZK=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,YK=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function JK(e){e.COLOR_0||e.colors||(e.colors={constant:!0,value:new Float32Array([1,1,1])})}const KK={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class h3 extends n3{getShaders(){const t=super.getShaders();return t.modules.push(OS),{...t,vs:ZK,fs:YK}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const r=this.getAttributeManager();t&&r.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:r,oldProps:i}=t;r.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(r.pbrMaterial)}draw(t){const{featureIds:r}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!r}),super.draw(t))}getModel(t){const{id:r,pbrMaterial:i}=this.props,n=this.parseMaterial(i,t);this.setState({materialParser:n});const s=this.getShaders();return JK(t.attributes),new vm(this.context.gl,{...this.getShaders(),id:r,geometry:t,defines:{...s.defines,...n==null?void 0:n.defines,HAS_UV_REGIONS:t.attributes.uvRegions},parameters:n==null?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:r}=this.state;if(r){const{mesh:i}=this.props,n=this.parseMaterial(t,i);this.setState({materialParser:n}),r.setUniforms(n.uniforms)}}parseMaterial(t,r){var i;const n=!!(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return(i=this.state.materialParser)===null||i===void 0||i.delete(),new HB(this.context.gl,{attributes:{NORMAL:r.attributes.normals,TEXCOORD_0:r.attributes.texCoords},material:{unlit:n,...t},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const r=this.props.featureIds,i=new Uint8ClampedArray(r.length*t.size),n=[];for(let s=0;s<r.length;s++)this.encodePickingColor(r[s],n),i[s*3]=n[0],i[s*3+1]=n[1],i[s*3+2]=n[2];t.value=i}finalizeState(t){var r;super.finalizeState(t),(r=this.state.materialParser)===null||r===void 0||r.delete(),this.setState({materialParser:null})}}q(h3,"layerName","MeshLayer");q(h3,"defaultProps",KK);const QK=6378137,tQ=6378137,eQ=6356752314245179e-9;function yv(e){return e}new te;function rQ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:yv;return"longitude"in e?(t[0]=r(e.longitude),t[1]=r(e.latitude),t[2]=e.height):"x"in e?(t[0]=r(e.x),t[1]=r(e.y),t[2]=e.z):(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]),t}function iQ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return rQ(e,t,xs._cartographicRadians?yv:QG)}function nQ(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:yv;return"longitude"in t?(t.longitude=r(e[0]),t.latitude=r(e[1]),t.height=e[2]):"x"in t?(t.x=r(e[0]),t.y=r(e[1]),t.z=e[2]):(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]),t}function sQ(e,t){return nQ(e,t,xs._cartographicRadians?yv:tV)}const _f=new te,oQ=new te,aQ=new te;function lQ(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:i,oneOverRadiiSquared:n,centerToleranceSquared:s}=t;_f.from(e);const c=_f.x,a=_f.y,p=_f.z,_=i.x,w=i.y,S=i.z,C=c*c*_*_,I=a*a*w*w,N=p*p*S*S,F=C+I+N,W=Math.sqrt(1/F);if(!Number.isFinite(W))return;const U=oQ;if(U.copy(e).scale(W),F<s)return U.to(r);const z=n.x,H=n.y,nt=n.z,yt=aQ;yt.set(U.x*z*2,U.y*H*2,U.z*nt*2);let bt=(1-W)*_f.len()/(.5*yt.len()),vt=0,mt,Dt,kt,at;do{bt-=vt,mt=1/(1+bt*z),Dt=1/(1+bt*H),kt=1/(1+bt*nt);const dt=mt*mt,It=Dt*Dt,xt=kt*kt,re=dt*mt,ee=It*Dt,se=xt*kt;at=C*dt+I*It+N*xt-1;const Ot=-2*(C*re*z+I*ee*H+N*se*nt);vt=at/Ot}while(Math.abs(at)>P0.EPSILON12);return _f.scale([mt,Dt,kt]).to(r)}const YP=1e-14,cQ=new te,JP={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},L2={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Tg={east:new te,north:new te,up:new te,west:new te,south:new te,down:new te},uQ=new te,hQ=new te,dQ=new te;function KP(e,t,r,i,n,s){const c=JP[t]&&JP[t][r];yc(c&&(!i||i===c));let a,p,_;const w=cQ.copy(n);if(Sc(w.x,0,YP)&&Sc(w.y,0,YP)){const S=Math.sign(w.z);a=uQ.fromArray(L2[t]),t!=="east"&&t!=="west"&&a.scale(S),p=hQ.fromArray(L2[r]),r!=="east"&&r!=="west"&&p.scale(S),_=dQ.fromArray(L2[i]),i!=="east"&&i!=="west"&&_.scale(S)}else{const{up:S,east:C,north:I}=Tg;C.set(-w.y,w.x,0).normalize(),e.geodeticSurfaceNormal(w,S),I.copy(S).cross(C);const{down:N,west:F,south:W}=Tg;N.copy(S).scale(-1),F.copy(C).scale(-1),W.copy(I).scale(-1),a=Tg[t],p=Tg[r],_=Tg[i]}return s[0]=a.x,s[1]=a.y,s[2]=a.z,s[3]=0,s[4]=p.x,s[5]=p.y,s[6]=p.z,s[7]=0,s[8]=_.x,s[9]=_.y,s[10]=_.z,s[11]=0,s[12]=w.x,s[13]=w.y,s[14]=w.z,s[15]=1,s}const uy=new te,QP=new te,pQ=new te,lc=new te,fQ=new te,hy=new te;class Tn{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;q(this,"radii",void 0),q(this,"radiiSquared",void 0),q(this,"radiiToTheFourth",void 0),q(this,"oneOverRadii",void 0),q(this,"oneOverRadiiSquared",void 0),q(this,"minimumRadius",void 0),q(this,"maximumRadius",void 0),q(this,"centerToleranceSquared",P0.EPSILON1),q(this,"squaredXOverSquaredZ",void 0),yc(t>=0),yc(r>=0),yc(i>=0),this.radii=new te(t,r,i),this.radiiSquared=new te(t*t,r*r,i*i),this.radiiToTheFourth=new te(t*t*t*t,r*r*r*r,i*i*i*i),this.oneOverRadii=new te(t===0?0:1/t,r===0?0:1/r,i===0?0:1/i),this.oneOverRadiiSquared=new te(t===0?0:1/(t*t),r===0?0:1/(r*r),i===0?0:1/(i*i)),this.minimumRadius=Math.min(t,r,i),this.maximumRadius=Math.max(t,r,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const i=QP,n=pQ,[,,s]=t;this.geodeticSurfaceNormalCartographic(t,i),n.copy(this.radiiSquared).scale(i);const c=Math.sqrt(i.dot(n));return n.scale(1/c),i.scale(s),n.add(i),n.to(r)}cartesianToCartographic(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];hy.from(t);const i=this.scaleToGeodeticSurface(hy,lc);if(!i)return;const n=this.geodeticSurfaceNormal(i,QP),s=fQ;s.copy(hy).subtract(i);const c=Math.atan2(n.y,n.x),a=Math.asin(n.z),p=Math.sign(kS(s,hy))*V6(s);return sQ([c,a,p],r)}eastNorthUpToFixedFrame(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new ui;return KP(this,"east","north","up",t,r)}localFrameToFixedFrame(t,r,i,n){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new ui;return KP(this,t,r,i,n,s)}geocentricSurfaceNormal(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return uy.from(t).normalize().to(r)}geodeticSurfaceNormalCartographic(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const i=iQ(t),n=i[0],s=i[1],c=Math.cos(s);return uy.set(c*Math.cos(n),c*Math.sin(n),Math.sin(s)).normalize(),uy.to(r)}geodeticSurfaceNormal(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return uy.from(t).scale(this.oneOverRadiiSquared).normalize().to(r)}scaleToGeodeticSurface(t,r){return lQ(t,this,r)}scaleToGeocentricSurface(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];lc.from(t);const i=lc.x,n=lc.y,s=lc.z,c=this.oneOverRadiiSquared,a=1/Math.sqrt(i*i*c.x+n*n*c.y+s*s*c.z);return lc.multiplyScalar(a).to(r)}transformPositionToScaledSpace(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return lc.from(t).scale(this.oneOverRadii).to(r)}transformPositionFromScaledSpace(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return lc.from(t).scale(this.radii).to(r)}getSurfaceNormalIntersectionWithZAxis(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];yc(Sc(this.radii.x,this.radii.y,P0.EPSILON15)),yc(this.radii.z>0),lc.from(t);const n=lc.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-r))return lc.set(0,0,n).to(i)}}q(Tn,"WGS84",new Tn(QK,tQ,eQ));class mQ{constructor(t,r,i){q(this,"item",void 0),q(this,"previous",void 0),q(this,"next",void 0),this.item=t,this.previous=r,this.next=i}}class gQ{constructor(){q(this,"head",null),q(this,"tail",null),q(this,"_length",0)}get length(){return this._length}add(t){const r=new mQ(t,this.tail,null);return this.tail?(this.tail.next=r,this.tail=r):(this.head=r,this.tail=r),++this._length,r}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,r){t!==r&&(this.remove(r),this._insert(t,r))}_insert(t,r){const i=t.next;t.next=r,this.tail===t?this.tail=r:i.previous=r,r.next=i,r.previous=t,++this._length}}class yQ{constructor(){q(this,"_list",void 0),q(this,"_sentinel",void 0),q(this,"_trimTiles",void 0),this._list=new gQ,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const r=t._cacheNode;r&&this._list.splice(this._sentinel,r)}add(t,r,i){r._cacheNode||(r._cacheNode=this._list.add(r),i&&i(t,r))}unloadTile(t,r,i){const n=r._cacheNode;n&&(this._list.remove(n),r._cacheNode=null,i&&i(t,r))}unloadTiles(t,r){const i=this._trimTiles;this._trimTiles=!1;const n=this._list,s=t.maximumMemoryUsage*1024*1024,c=this._sentinel;let a=n.head;for(;a!==c&&(t.gpuMemoryUsageInBytes>s||i);){const p=a.item;a=a.next,this.unloadTile(t,p,r)}}trim(){this._trimTiles=!0}}function _Q(e,t){Ki(e),Ki(t);const{rtcCenter:r,gltfUpAxis:i}=t,{computedTransform:n,boundingVolume:{center:s}}=e;let c=new ui(n);switch(r&&c.translate(r),i){case"Z":break;case"Y":const w=new ui().rotateX(Math.PI/2);c=c.multiplyRight(w);break;case"X":const S=new ui().rotateY(-Math.PI/2);c=c.multiplyRight(S);break}t.isQuantized&&c.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const a=new te(s);t.cartesianModelMatrix=c,t.cartesianOrigin=a;const p=Tn.WGS84.cartesianToCartographic(a,new te),_=Tn.WGS84.eastNorthUpToFixedFrame(a).invert();t.cartographicModelMatrix=_.multiplyRight(c),t.cartographicOrigin=p,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const tI=new te,M2=new te,Dx=new Nl([new gc,new gc,new gc,new gc,new gc,new gc]);function vQ(e,t){const{cameraDirection:r,cameraUp:i,height:n}=e,{metersPerUnit:s}=e.distanceScales,c=jy(e,e.center),a=Tn.WGS84.eastNorthUpToFixedFrame(c),p=e.unprojectPosition(e.cameraPosition),_=Tn.WGS84.cartographicToCartesian(p,new te),w=new te(a.transformAsVector(new te(r).scale(s))).normalize(),S=new te(a.transformAsVector(new te(i).scale(s))).normalize();wQ(e);const C=e.constructor,{longitude:I,latitude:N,width:F,bearing:W,zoom:U}=e,z=new C({longitude:I,latitude:N,height:n,width:F,bearing:W,zoom:U,pitch:0});return{camera:{position:_,direction:w,up:S},viewport:e,topDownViewport:z,height:n,cullingVolume:Dx,frameNumber:t,sseDenominator:1.15}}function bQ(e,t,r){if(r===0||e.length<=r)return[e,[]];const i=[],{longitude:n,latitude:s}=t.viewport;for(const[_,w]of e.entries()){const[S,C]=w.header.mbs,I=Math.abs(n-S),N=Math.abs(s-C),F=Math.sqrt(N*N+I*I);i.push([_,F])}const c=i.sort((_,w)=>_[1]-w[1]),a=[];for(let _=0;_<r;_++)a.push(e[c[_][0]]);const p=[];for(let _=r;_<c.length;_++)p.push(e[c[_][0]]);return[a,p]}function wQ(e){const t=e.getFrustumPlanes(),r=eI(t.near,e.cameraPosition),i=jy(e,r),n=jy(e,e.cameraPosition,M2);let s=0;Dx.planes[s++].fromPointNormal(i,tI.copy(i).subtract(n));for(const c in t){if(c==="near")continue;const a=t[c],p=eI(a,r,M2),_=jy(e,p,M2);Dx.planes[s++].fromPointNormal(_,tI.copy(i).subtract(_))}}function eI(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new te;const i=e.normal.dot(t);return r.copy(e.normal).scale(e.distance-i).add(t),r}function jy(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new te;const i=e.unprojectPosition(t);return Tn.WGS84.cartographicToCartesian(i,r)}const xQ=6378137,SQ=6378137,Nx=6356752314245179e-9,rI=new te;function AQ(e,t){if(e instanceof r1){const{halfAxes:r}=e,i=TQ(r);return Math.log2(Nx/(i+t[2]))}else if(e instanceof e1){const{radius:r}=e;return Math.log2(Nx/(r+t[2]))}else if(e.width&&e.height){const{width:r,height:i}=e,n=Math.log2(xQ/r),s=Math.log2(SQ/i);return(n+s)/2}return 1}function ak(e,t,r){const i=Tn.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],new te),n=Math.sqrt(Math.pow(i[0]-r[0],2)+Math.pow(i[1]-r[1],2)+Math.pow(i[2]-r[2],2));return Math.log2(Nx/(n+t[2]))}function EQ(e,t,r){const[i,n,s,c]=e;return ak({xmin:i,xmax:s,ymin:n,ymax:c,zmin:0,zmax:0},t,r)}function TQ(e){e.getColumn(0,rI);const t=e.getColumn(1),r=e.getColumn(2);return rI.add(t).add(r).len()}const Ja={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},ph={ADD:1,REPLACE:2},tm={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Ml={I3S:"I3S",TILES3D:"TILES3D"},_v={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},CQ={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function lk(e){return e!=null}const To=new te,Uy=new te,PQ=new te,IQ=new te;function B2(e,t,r){if(Ki(e,"3D Tile: boundingVolume must be defined"),e.box)return MQ(e.box,t,r);if(e.region){const[i,n,s,c,a,p]=e.region,_=Tn.WGS84.cartographicToCartesian([lh(i),lh(c),a],PQ),w=Tn.WGS84.cartographicToCartesian([lh(s),lh(n),p],IQ),S=new te().addVectors(_,w).multiplyScalar(.5),C=new te().subVectors(_,w).len()/2;return iI([S[0],S[1],S[2],C],new ui)}if(e.sphere)return iI(e.sphere,t,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function LQ(e,t){if(e.box)return BQ(t);if(e.region){const[r,i,n,s,c,a]=e.region;return[[lh(r),lh(i),c],[lh(n),lh(s),a]]}if(e.sphere)return kQ(t);throw new Error("Unkown boundingVolume type")}function MQ(e,t,r){const i=new te(e[0],e[1],e[2]);t.transform(i,i);let n=[];if(e.length===10){const _=e.slice(3,6),w=new C0;w.fromArray(e,6);const S=new te([1,0,0]),C=new te([0,1,0]),I=new te([0,0,1]);S.transformByQuaternion(w),S.scale(_[0]),C.transformByQuaternion(w),C.scale(_[1]),I.transformByQuaternion(w),I.scale(_[2]),n=[...S.toArray(),...C.toArray(),...I.toArray()]}else n=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];const s=t.transformAsVector(n.slice(0,3)),c=t.transformAsVector(n.slice(3,6)),a=t.transformAsVector(n.slice(6,9)),p=new jn([s[0],s[1],s[2],c[0],c[1],c[2],a[0],a[1],a[2]]);return lk(r)?(r.center=i,r.halfAxes=p,r):new r1(i,p)}function iI(e,t,r){const i=new te(e[0],e[1],e[2]);t.transform(i,i);const n=t.getScale(Uy),s=Math.max(Math.max(n[0],n[1]),n[2]),c=e[3]*s;return lk(r)?(r.center=i,r.radius=c,r):new e1(i,c)}function BQ(e){const t=ck(),{halfAxes:r}=e,i=new te(r.getColumn(0)),n=new te(r.getColumn(1)),s=new te(r.getColumn(2));for(let c=0;c<2;c++){for(let a=0;a<2;a++){for(let p=0;p<2;p++)To.copy(e.center),To.add(i),To.add(n),To.add(s),uk(t,To),s.negate();n.negate()}i.negate()}return t}function kQ(e){const t=ck(),{center:r,radius:i}=e,n=Tn.WGS84.scaleToGeodeticSurface(r,To);let s;n?s=Tn.WGS84.geodeticSurfaceNormal(n):s=new te(0,0,1);let c=new te(s[2],-s[1],0);c.len()>0?c.normalize():c=new te(0,1,0);const a=c.clone().cross(s);for(const p of[c,a,s]){Uy.copy(p).scale(i);for(let _=0;_<2;_++)To.copy(r),To.add(Uy),uk(t,To),Uy.negate()}return t}function ck(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function uk(e,t){Tn.WGS84.cartesianToCartographic(t,To),e[0][0]=Math.min(e[0][0],To[0]),e[0][1]=Math.min(e[0][1],To[1]),e[0][2]=Math.min(e[0][2],To[2]),e[1][0]=Math.max(e[1][0],To[0]),e[1][1]=Math.max(e[1][1],To[1]),e[1][2]=Math.max(e[1][2],To[2])}new te;new te;new ui;new te;new te;new te;function RQ(e,t){const r=e*t;return 1-Math.exp(-(r*r))}function FQ(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){const r=e.dynamicScreenSpaceErrorComputedDensity,i=e.dynamicScreenSpaceErrorFactor;return RQ(t,r)*i}return 0}function DQ(e,t,r){const i=e.tileset,n=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,s=r?n:e.lodMetricValue;if(s===0)return 0;const c=Math.max(e._distanceToCamera,1e-7),{height:a,sseDenominator:p}=t,{viewDistanceScale:_}=i.options;let w=s*a*(_||1)/(c*p);return w-=FQ(i,c),w}const k2=new te,nI=new te,Jh=new te,sI=new te,NQ=new te,R2=new ui,oI=new ui;function OQ(e,t){if(e.lodMetricValue===0||isNaN(e.lodMetricValue))return"DIG";const r=2*hk(e,t);return r<2?"OUT":!e.header.children||r<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}function hk(e,t){const{topDownViewport:r}=t,i=e.header.mbs[1],n=e.header.mbs[0],s=e.header.mbs[2],c=e.header.mbs[3],a=[...e.boundingVolume.center],p=r.unprojectPosition(r.cameraPosition);Tn.WGS84.cartographicToCartesian(p,k2),nI.copy(k2).subtract(a).normalize(),Tn.WGS84.eastNorthUpToFixedFrame(a,R2),oI.copy(R2).invert(),Jh.copy(k2).transform(oI);const _=Math.sqrt(Jh[0]*Jh[0]+Jh[1]*Jh[1]),w=_*_/Jh[2];sI.copy([Jh[0],Jh[1],w]);const S=sI.transform(R2).subtract(a).normalize(),C=nI.cross(S).normalize().scale(c).add(a),I=Tn.WGS84.cartesianToCartographic(C),N=r.project([n,i,s]),F=r.project(I);return NQ.copy(N).subtract(F).magnitude()}function zQ(e){return{assetGltfUpAxis:e.asset&&e.asset.gltfUpAxis||"Y"}}class aI{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;q(this,"_map",new Map),q(this,"_array",void 0),q(this,"_length",void 0),this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return Ki(t<this._array.length),this._array[t]}set(t,r){Ki(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=r,this._map.set(r,t)}delete(t){const r=this._map.get(t);r>=0&&(this._array.splice(r,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const r=this.length++;this._array[r]=t,this._map.set(t,r)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){Ki(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){Ki(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const jQ={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class vv{traversalFinished(t){return!0}constructor(t){q(this,"options",void 0),q(this,"root",null),q(this,"selectedTiles",{}),q(this,"requestedTiles",{}),q(this,"emptyTiles",{}),q(this,"lastUpdate",new Date().getTime()),q(this,"updateDebounceTime",1e3),q(this,"_traversalStack",new aI),q(this,"_emptyTraversalStack",new aI),q(this,"_frameNumber",null),this.options={...jQ,...t}}traverse(t,r,i){this.root=t,this.options={...this.options,...i},this.reset(),this.updateTile(t,r),this._frameNumber=r.frameNumber,this.executeTraversal(t,r)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,r){const i=this._traversalStack;for(t._selectionDepth=1,i.push(t);i.length>0;){const s=i.pop();let c=!1;this.canTraverse(s,r)&&(this.updateChildTiles(s,r),c=this.updateAndPushChildren(s,r,i,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const a=s.parent,p=!!(!a||a._shouldRefine),_=!c;s.hasRenderContent?s.refine===ph.ADD?(this.loadTile(s,r),this.selectTile(s,r)):s.refine===ph.REPLACE&&(this.loadTile(s,r),_&&this.selectTile(s,r)):(this.emptyTiles[s.id]=s,this.loadTile(s,r),_&&this.selectTile(s,r)),this.touchTile(s,r),s._shouldRefine=c&&p}const n=new Date().getTime();(this.traversalFinished(r)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(r))}updateChildTiles(t,r){const i=t.children;for(const n of i)this.updateTile(n,r)}updateAndPushChildren(t,r,i,n){const{loadSiblings:s,skipLevelOfDetail:c}=this.options,a=t.children;a.sort(this.compareDistanceToCamera.bind(this));const p=t.refine===ph.REPLACE&&t.hasRenderContent&&!c;let _=!1,w=!0;for(const S of a)if(S._selectionDepth=n,S.isVisibleAndInRequestVolume?(i.find(S)&&i.delete(S),i.push(S),_=!0):(p||s)&&(this.loadTile(S,r),this.touchTile(S,r)),p){let C;if(S._inRequestVolume?S.hasRenderContent?C=S.contentAvailable:C=this.executeEmptyTraversal(S,r):C=!1,w=w&&C,!w)return!1}return _||(w=!1),w}updateTile(t,r){this.updateTileVisibility(t,r)}selectTile(t,r){this.shouldSelectTile(t)&&(t._selectedFrame=r.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,r){this.shouldLoadTile(t)&&(t._requestedFrame=r.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,r){t.tileset._cache.touch(t),t._touchedFrame=r.frameNumber}canTraverse(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return t.hasChildren?t.hasTilesetContent?!t.contentExpired:!n&&!t.isVisibleAndInRequestVolume?!1:this.shouldRefine(t,r,i):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=t._screenSpaceError;return i&&(n=t.getScreenSpaceError(r,!0)),n>this.options.maximumScreenSpaceError}updateTileVisibility(t,r){const i=[];if(this.options.viewportTraversersMap)for(const n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===r.viewport.id&&i.push(n);else i.push(r.viewport.id);t.updateVisibility(r,i)}compareDistanceToCamera(t,r){return t._distanceToCamera-r._distanceToCamera}anyChildrenVisible(t,r){let i=!1;for(const n of t.children)n.updateVisibility(r),i=i||n.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(t,r){let i=!0;const n=this._emptyTraversalStack;for(n.push(t);n.length>0&&i;){const s=n.pop();if(this.updateTile(s,r),s.isVisibleAndInRequestVolume||this.loadTile(s,r),this.touchTile(s,r),!s.hasRenderContent&&this.canTraverse(s,r,!1,!0)){const c=s.children;for(const a of c)n.find(a)&&n.delete(a),n.push(a)}else!s.contentAvailable&&!s.hasEmptyContent&&(i=!1)}return i}}const lI=new te;function UQ(e){return e!=null}class Ox{constructor(t,r,i){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";q(this,"tileset",void 0),q(this,"header",void 0),q(this,"id",void 0),q(this,"url",void 0),q(this,"parent",void 0),q(this,"refine",void 0),q(this,"type",void 0),q(this,"contentUrl",void 0),q(this,"lodMetricType","geometricError"),q(this,"lodMetricValue",0),q(this,"boundingVolume",null),q(this,"content",null),q(this,"contentState",Ja.UNLOADED),q(this,"gpuMemoryUsageInBytes",0),q(this,"children",[]),q(this,"depth",0),q(this,"viewportIds",[]),q(this,"transform",new ui),q(this,"extensions",null),q(this,"implicitTiling",null),q(this,"userData",{}),q(this,"computedTransform",void 0),q(this,"hasEmptyContent",!1),q(this,"hasTilesetContent",!1),q(this,"traverser",new vv({})),q(this,"_cacheNode",null),q(this,"_frameNumber",null),q(this,"_expireDate",null),q(this,"_expiredContent",null),q(this,"_boundingBox",void 0),q(this,"_distanceToCamera",0),q(this,"_screenSpaceError",0),q(this,"_visibilityPlaneMask",void 0),q(this,"_visible",void 0),q(this,"_contentBoundingVolume",void 0),q(this,"_viewerRequestVolume",void 0),q(this,"_initialTransform",new ui),q(this,"_priority",0),q(this,"_selectedFrame",0),q(this,"_requestedFrame",0),q(this,"_selectionDepth",0),q(this,"_touchedFrame",0),q(this,"_centerZDepth",0),q(this,"_shouldRefine",!1),q(this,"_stackLength",0),q(this,"_visitedFrame",0),q(this,"_inRequestVolume",!1),q(this,"_lodJudge",null),this.header=r,this.tileset=t,this.id=n||r.id,this.url=r.url,this.parent=i,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Ja.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Ja.UNLOADED}get contentExpired(){return this.contentState===Ja.EXPIRED}get contentFailed(){return this.contentState===Ja.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=LQ(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,r){switch(this.tileset.type){case Ml.I3S:return hk(this,t);case Ml.TILES3D:return DQ(this,t,r);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:r}=t.options,i=this.refine===ph.ADD||r;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Ja.UNLOADED)return-1;const n=this.parent,s=n&&(!i||this._screenSpaceError===0||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,c=t.root?t.root._screenSpaceError:0;return Math.max(c-s,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Ja.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=Ja.UNLOADED,!1;try{const r=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,n={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await Sd(r,i,n),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Ja.READY,this._onContentLoaded(),!0}catch(r){throw this.contentState=Ja.FAILED,r}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Ja.UNLOADED,!0}updateVisibility(t,r){if(this._frameNumber===t.frameNumber)return;const i=this.parent,n=i?i._visibilityPlaneMask:Nl.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,n),this._visible=this._visibilityPlaneMask!==Nl.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=r}visibility(t,r){const{cullingVolume:i}=t,{boundingVolume:n}=this;return i.computeVisibilityWithPlaneMask(n,r)}contentVisibility(){return!0}distanceToTile(t){const r=this.boundingVolume;return Math.sqrt(Math.max(r.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth(t){let{camera:r}=t;const i=this.boundingVolume;return lI.subVectors(i.center,r.position),r.direction.dot(lI)}insideViewerRequestVolume(t){const r=this._viewerRequestVolume;return!r||r.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(UQ(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=Ja.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new ui(t.transform):new ui;const r=this.parent,i=this.tileset,n=r&&r.computedTransform?r.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new ui(n).multiplyRight(this.transform);const s=r&&r._initialTransform?r._initialTransform.clone():new ui;this._initialTransform=new ui(s).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Ja.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Nl.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||ph.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=B2(t.boundingVolume,this.computedTransform,this.boundingVolume);const r=t.content;r&&(r.boundingVolume&&(this._contentBoundingVolume=B2(r.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=B2(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new ui).clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return zQ(this.tileset.tileset)}}}class GQ extends vv{compareDistanceToCamera(t,r){return r._distanceToCamera===0&&t._distanceToCamera===0?r._centerZDepth-t._centerZDepth:r._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,r){if(super.updateTileVisibility(t,r),!t.isVisibleAndInRequestVolume)return;const i=t.children.length>0;if(t.hasTilesetContent&&i){const c=t.children[0];this.updateTileVisibility(c,r),t._visible=c._visible;return}if(this.meetsScreenSpaceErrorEarly(t,r)){t._visible=!1;return}const n=t.refine===ph.REPLACE,s=t._optimChildrenWithinParent===CQ.USE_OPTIMIZATION;if(n&&s&&i&&!this.anyChildrenVisible(t,r)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,r){const{parent:i}=t;return!i||i.hasTilesetContent||i.refine!==ph.ADD?!1:!this.shouldRefine(t,r,!0)}}class VQ{constructor(){q(this,"frameNumberMap",new Map)}register(t,r){const i=this.frameNumberMap.get(t)||new Map,n=i.get(r)||0;i.set(r,n+1),this.frameNumberMap.set(t,i)}deregister(t,r){const i=this.frameNumberMap.get(t);if(!i)return;const n=i.get(r)||1;i.set(r,n-1)}isZero(t,r){var i;return(((i=this.frameNumberMap.get(t))===null||i===void 0?void 0:i.get(r))||0)===0}}const F2={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class qQ{constructor(){q(this,"_statusMap",void 0),q(this,"pendingTilesRegister",new VQ),this._statusMap={}}add(t,r,i,n){if(!this._statusMap[r]){const{frameNumber:s,viewport:{id:c}}=n;this._statusMap[r]={request:t,callback:i,key:r,frameState:n,status:F2.REQUESTED},this.pendingTilesRegister.register(c,s),t().then(a=>{this._statusMap[r].status=F2.COMPLETED;const{frameNumber:p,viewport:{id:_}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(_,p),this._statusMap[r].callback(a,n)}).catch(a=>{this._statusMap[r].status=F2.ERROR;const{frameNumber:p,viewport:{id:_}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(_,p),i(a)})}}update(t,r){if(this._statusMap[t]){const{frameNumber:i,viewport:{id:n}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(n,i);const{frameNumber:s,viewport:{id:c}}=r;this.pendingTilesRegister.register(c,s),this._statusMap[t].frameState=r}}find(t){return this._statusMap[t]}hasPendingTiles(t,r){return!this.pendingTilesRegister.isZero(t,r)}}class HQ extends vv{constructor(t){super(t),q(this,"_tileManager",void 0),this._tileManager=new qQ}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,r){return t._lodJudge=OQ(t,r),t._lodJudge==="DIG"}updateChildTiles(t,r){const i=t.header.children||[],n=t.children,s=t.tileset;for(const c of i){const a="".concat(c.id,"-").concat(r.viewport.id),p=n&&n.find(_=>_.id===a);if(p)p&&this.updateTile(p,r);else{let _=()=>this._loadTile(c.id,s);this._tileManager.find(a)?this._tileManager.update(a,r):(s.tileset.nodePages&&(_=()=>s.tileset.nodePagesTile.formTileFromNodePages(c.id)),this._tileManager.add(_,a,w=>this._onTileLoad(w,t,a),r))}}return!1}async _loadTile(t,r){const{loader:i}=r,n=r.getTileUrl("".concat(r.url,"/nodes/").concat(t)),s={...r.loadOptions,i3s:{...r.loadOptions.i3s,isTileHeader:!0}};return await Sd(n,i,s)}_onTileLoad(t,r,i){const n=new Ox(r.tileset,t,r,i);r.children.push(n);const s=this._tileManager.find(n.id).frameState;this.updateTile(n,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(n,s)}}const $Q={description:"",ellipsoid:Tn.WGS84,modelMatrix:new ui,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},dy="Tiles In Tileset(s)",D2="Tiles In Memory",cI="Tiles In View",uI="Tiles To Render",hI="Tiles Loaded",N2="Tiles Loading",dI="Tiles Unloaded",pI="Failed Tile Loads",fI="Points/Vertices",O2="Tile Memory Use";class WQ{constructor(t,r){q(this,"options",void 0),q(this,"loadOptions",void 0),q(this,"type",void 0),q(this,"tileset",void 0),q(this,"loader",void 0),q(this,"url",void 0),q(this,"basePath",void 0),q(this,"modelMatrix",void 0),q(this,"ellipsoid",void 0),q(this,"lodMetricType",void 0),q(this,"lodMetricValue",void 0),q(this,"refine",void 0),q(this,"root",null),q(this,"roots",{}),q(this,"asset",{}),q(this,"description",""),q(this,"properties",void 0),q(this,"extras",null),q(this,"attributions",{}),q(this,"credits",{}),q(this,"stats",void 0),q(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),q(this,"cartographicCenter",null),q(this,"cartesianCenter",null),q(this,"zoom",1),q(this,"boundingVolume",null),q(this,"dynamicScreenSpaceErrorComputedDensity",0),q(this,"maximumMemoryUsage",32),q(this,"gpuMemoryUsageInBytes",0),q(this,"_frameNumber",0),q(this,"_queryParams",{}),q(this,"_extensionsUsed",[]),q(this,"_tiles",{}),q(this,"_pendingCount",0),q(this,"selectedTiles",[]),q(this,"traverseCounter",0),q(this,"geometricError",0),q(this,"lastUpdatedVieports",null),q(this,"_requestedTiles",[]),q(this,"_emptyTiles",[]),q(this,"frameStateData",{}),q(this,"_traverser",void 0),q(this,"_cache",new yQ),q(this,"_requestScheduler",void 0),q(this,"updatePromise",null),q(this,"tilesetInitializationPromise",void 0),this.options={...$Q,...r},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||dS(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new uz({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new q0({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}setOptions(t){this.options={...this.options,...t}}getTileUrl(t){return t.startsWith("data:")?t:"".concat(t).concat(t.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(r=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),r(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const r=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=r.length;const i=[];for(const n of r){const s=n.id;this._needTraverse(s)?i.push(s):this.traverseCounter--}for(const n of r){const s=n.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!i.includes(s))continue;const c=vQ(n,this._frameNumber);this._traverser.traverse(this.roots[s],c,this.options)}}_needTraverse(t){let r=t;return this.options.viewportTraversersMap&&(r=this.options.viewportTraversersMap[t]),r===t}_onTraversalEnd(t){const r=t.viewport.id;this.frameStateData[r]||(this.frameStateData[r]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[r],n=Object.values(this._traverser.selectedTiles),[s,c]=bQ(n,t,this.options.maximumTilesSelected);i.selectedTiles=s;for(const a of c)a.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const r=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(r.selectedTiles),this._requestedTiles=this._requestedTiles.concat(r._requestedTiles),this._emptyTiles=this._emptyTiles.concat(r._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,r){if(t.length!==r.length)return!0;const i=new Set(t.map(c=>c.id)),n=new Set(r.map(c=>c.id));let s=t.filter(c=>!n.has(c.id)).length>0;return s=s||r.filter(c=>!i.has(c.id)).length>0,s}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,r)=>t._unloadTile(r))}_updateStats(){let t=0,r=0;for(const i of this.selectedTiles)i.contentAvailable&&i.content&&(t++,i.content.pointCount?r+=i.content.pointCount:r+=i.content.vertexCount);this.stats.get(cI).count=this.selectedTiles.length,this.stats.get(uI).count=t,this.stats.get(fI).count=r}async _initializeTileSet(t){this.type===Ml.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===Ml.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===Ml.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const r=this.tileset.fullExtent;if(r){const{xmin:n,xmax:s,ymin:c,ymax:a,zmin:p,zmax:_}=r;this.cartographicCenter=new te(n+(s-n)/2,c+(a-c)/2,p+(_-p)/2),this.cartesianCenter=Tn.WGS84.cartographicToCartesian(this.cartographicCenter,new te),this.zoom=ak(r,this.cartographicCenter,this.cartesianCenter);return}const i=(t=this.tileset.store)===null||t===void 0?void 0:t.extent;if(i){const[n,s,c,a]=i;this.cartographicCenter=new te(n+(c-n)/2,s+(a-s)/2,0),this.cartesianCenter=Tn.WGS84.cartographicToCartesian(this.cartographicCenter,new te),this.zoom=EQ(i,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new te,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:r}=t.boundingVolume;if(!r){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new te,this.zoom=1;return}r[0]!==0||r[1]!==0||r[2]!==0?this.cartographicCenter=Tn.WGS84.cartesianToCartographic(r,new te):this.cartographicCenter=new te(0,0,-Tn.WGS84.radii[0]),this.cartesianCenter=r,this.zoom=AQ(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(dy),this.stats.get(N2),this.stats.get(D2),this.stats.get(cI),this.stats.get(uI),this.stats.get(hI),this.stats.get(dI),this.stats.get(pI),this.stats.get(fI),this.stats.get(O2,"memory")}_initializeTileHeaders(t,r){const i=new Ox(this,t.root,r);if(r&&(r.children.push(i),i.depth=r.depth+1),this.type===Ml.TILES3D){const s=[];for(s.push(i);s.length>0;){const c=s.pop();this.stats.get(dy).incrementCount();const a=c.header.children||[];for(const p of a){var n;const _=new Ox(this,p,c);if((n=_.contentUrl)!==null&&n!==void 0&&n.includes("?session=")){const w=new URL(_.contentUrl).searchParams.get("session");w&&(this._queryParams.session=w)}c.children.push(_),_.depth=c.depth+1,s.push(_)}}}return i}_initializeTraverser(){let t;switch(this.type){case Ml.TILES3D:t=GQ;break;case Ml.I3S:t=HQ;break;default:t=vv}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let r;try{this._onStartTileLoading(),r=await t.loadContent()}catch(i){this._onTileLoadError(t,i instanceof Error?i:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,r)}}_onTileLoadError(t,r){this.stats.get(pI).incrementCount();const i=r.message||r.toString(),n=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(i)),this.options.onTileError(t,i,n)}_onTileLoad(t,r){if(r){if(this.type===Ml.I3S){var i,n;const s=((i=this.tileset)===null||i===void 0||(n=i.nodePagesTile)===null||n===void 0?void 0:n.nodesInNodePages)||0;this.stats.get(dy).reset(),this.stats.get(dy).addCount(s)}t&&t.content&&_Q(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===Ml.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Ml.TILES3D){var r;const{extensionsRemoved:i=[]}=((r=t.content)===null||r===void 0?void 0:r.gltf)||{};i.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),i.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),i.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(N2).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(N2).decrementCount()}_addTileToCache(t){this._cache.add(this,t,r=>r._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(hI).incrementCount(),this.stats.get(D2).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(O2).count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(D2).decrementCount(),this.stats.get(dI).incrementCount(),this.stats.get(O2).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const r=t.pop();for(const i of r.children)t.push(i);this._destroyTile(r)}this.root=null}_destroySubtree(t){const r=t,i=[];for(i.push(r);i.length>0;){t=i.pop();for(const n of t.children)i.push(n);t!==r&&this._destroyTile(t)}r.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const r=new URLSearchParams(t.queryString),i=Object.fromEntries(r.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const dk="3.4.15",Cg={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function pk(e,t,r){Ki(e instanceof ArrayBuffer);const i=new TextDecoder("utf8"),n=new Uint8Array(e,t,r);return i.decode(n)}function XQ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const r=new DataView(e);return"".concat(String.fromCharCode(r.getUint8(t+0))).concat(String.fromCharCode(r.getUint8(t+1))).concat(String.fromCharCode(r.getUint8(t+2))).concat(String.fromCharCode(r.getUint8(t+3)))}const ZQ={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ss={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},mi={...ZQ,...ss},z2={[ss.DOUBLE]:Float64Array,[ss.FLOAT]:Float32Array,[ss.UNSIGNED_SHORT]:Uint16Array,[ss.UNSIGNED_INT]:Uint32Array,[ss.UNSIGNED_BYTE]:Uint8Array,[ss.BYTE]:Int8Array,[ss.SHORT]:Int16Array,[ss.INT]:Int32Array},YQ={DOUBLE:ss.DOUBLE,FLOAT:ss.FLOAT,UNSIGNED_SHORT:ss.UNSIGNED_SHORT,UNSIGNED_INT:ss.UNSIGNED_INT,UNSIGNED_BYTE:ss.UNSIGNED_BYTE,BYTE:ss.BYTE,SHORT:ss.SHORT,INT:ss.INT},j2="Failed to convert GL type";class xu{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const r in z2)if(z2[r]===t)return r;throw new Error(j2)}static fromName(t){const r=YQ[t];if(!r)throw new Error(j2);return r}static getArrayType(t){switch(t){case ss.UNSIGNED_SHORT_5_6_5:case ss.UNSIGNED_SHORT_4_4_4_4:case ss.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const r=z2[t];if(!r)throw new Error(j2);return r}}static getByteSize(t){return xu.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!xu.getArrayType(t)}static createTypedArray(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;n===void 0&&(n=(r.byteLength-i)/xu.getByteSize(t));const s=xu.getArrayType(t);return new s(r,i,n)}}function JQ(e,t){if(!e)throw new Error("math.gl assertion failed. ".concat(t))}function KQ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=e>>11&31,i=e>>5&63,n=e&31;return t[0]=r<<3,t[1]=i<<2,t[2]=n<<3,t}new BS;new te;new BS;new BS;function mI(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return ch(e,0,t)/t*2-1}function gI(e){return e<0?-1:1}function QQ(e,t,r,i){if(JQ(i),e<0||e>r||t<0||t>r)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(r));if(i.x=mI(e,r),i.y=mI(t,r),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const n=i.x;i.x=(1-Math.abs(i.y))*gI(n),i.y=(1-Math.abs(n))*gI(i.y)}return i.normalize()}function ttt(e,t,r){return QQ(e,t,255,r)}class d3{constructor(t,r){q(this,"json",void 0),q(this,"buffer",void 0),q(this,"featuresLength",0),q(this,"_cachedTypedArrays",{}),this.json=t,this.buffer=r}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:mi.UNSIGNED_INT,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const n=this.json[t];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(t,r,i,1,n.byteOffset):n}getPropertyArray(t,r,i){const n=this.json[t];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(r=xu.fromName(n.componentType)),this._getTypedArrayFromBinary(t,r,i,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(t,r,n)}getProperty(t,r,i,n,s){const c=this.json[t];if(!c)return c;const a=this.getPropertyArray(t,r,i);if(i===1)return a[n];for(let p=0;p<i;++p)s[p]=a[i*n+p];return s}_getTypedArrayFromBinary(t,r,i,n,s){const c=this._cachedTypedArrays;let a=c[t];return a||(a=xu.createTypedArray(r,this.buffer.buffer,this.buffer.byteOffset+s,n*i),c[t]=a),a}_getTypedArrayFromArray(t,r,i){const n=this._cachedTypedArrays;let s=n[t];return s||(s=xu.createTypedArray(r,i),n[t]=s),s}}const ett={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},rtt={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},itt={SCALAR:(e,t,r)=>{t[r]=e},VEC2:(e,t,r)=>{t[2*r+0]=e[0],t[2*r+1]=e[1]},VEC3:(e,t,r)=>{t[3*r+0]=e[0],t[3*r+1]=e[1],t[3*r+2]=e[2]},VEC4:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT2:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT3:(e,t,r)=>{t[9*r+0]=e[0],t[9*r+1]=e[1],t[9*r+2]=e[2],t[9*r+3]=e[3],t[9*r+4]=e[4],t[9*r+5]=e[5],t[9*r+6]=e[6],t[9*r+7]=e[7],t[9*r+8]=e[8],t[9*r+9]=e[9]},MAT4:(e,t,r)=>{t[16*r+0]=e[0],t[16*r+1]=e[1],t[16*r+2]=e[2],t[16*r+3]=e[3],t[16*r+4]=e[4],t[16*r+5]=e[5],t[16*r+6]=e[6],t[16*r+7]=e[7],t[16*r+8]=e[8],t[16*r+9]=e[9],t[16*r+10]=e[10],t[16*r+11]=e[11],t[16*r+12]=e[12],t[16*r+13]=e[13],t[16*r+14]=e[14],t[16*r+15]=e[15]}};function ntt(e,t,r,i){const{componentType:n}=e;Ki(e.componentType);const s=typeof n=="string"?xu.fromName(n):n,c=ett[e.type],a=rtt[e.type],p=itt[e.type];return r+=e.byteOffset,{values:xu.createTypedArray(s,t,r,c*i),type:s,size:c,unpacker:a,packer:p}}const vu=e=>e!==void 0;function stt(e,t,r){if(!t)return null;let i=e.getExtension("3DTILES_batch_table_hierarchy");const n=t.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=n,i=n),i?ott(i,r):null}function ott(e,t){let r,i,n;const s=e.instancesLength,c=e.classes;let a=e.classIds,p=e.parentCounts,_=e.parentIds,w=s;vu(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,n=getBinaryAccessor(a),a=n.createArrayBufferView(t.buffer,t.byteOffset+a.byteOffset,s));let S;if(vu(p))for(vu(p.byteOffset)&&(p.componentType=defaultValue(p.componentType,GL.UNSIGNED_SHORT),p.type=AttributeType.SCALAR,n=getBinaryAccessor(p),p=n.createArrayBufferView(t.buffer,t.byteOffset+p.byteOffset,s)),S=new Uint16Array(s),w=0,r=0;r<s;++r)S[r]=w,w+=p[r];vu(_)&&vu(_.byteOffset)&&(_.componentType=defaultValue(_.componentType,GL.UNSIGNED_SHORT),_.type=AttributeType.SCALAR,n=getBinaryAccessor(_),_=n.createArrayBufferView(t.buffer,t.byteOffset+_.byteOffset,w));const C=c.length;for(r=0;r<C;++r){const W=c[r].length,U=c[r].instances,z=getBinaryProperties(W,U,t);c[r].instances=combine(z,U)}const I=new Array(C).fill(0),N=new Uint16Array(s);for(r=0;r<s;++r)i=a[r],N[r]=I[i],++I[i];const F={classes:c,classIds:a,classIndexes:N,parentCounts:p,parentIndexes:S,parentIds:_};return ctt(F),F}function Pg(e,t,r){if(!e)return;const i=e.parentCounts;return e.parentIds?r(e,t):i>0?att(e,t,r):ltt(e,t,r)}function att(e,t,r){const i=e.classIds,n=e.parentCounts,s=e.parentIds,c=e.parentIndexes,a=i.length,p=scratchVisited;p.length=Math.max(p.length,a);const _=++marker,w=scratchStack;for(w.length=0,w.push(t);w.length>0;){if(t=w.pop(),p[t]===_)continue;p[t]=_;const S=r(e,t);if(vu(S))return S;const C=n[t],I=c[t];for(let N=0;N<C;++N){const F=s[I+N];F!==t&&w.push(F)}}return null}function ltt(e,t,r){let i=!0;for(;i;){const n=r(e,t);if(vu(n))return n;const s=e.parentIds[t];i=s!==t,t=s}throw new Error("traverseHierarchySingleParent")}function ctt(e){const t=e.classIds.length;for(let r=0;r<t;++r)fk(e,r,stack)}function fk(e,t,r){const i=e.parentCounts,n=e.parentIds,s=e.parentIndexes,c=e.classIds.length;if(!vu(n))return;assert(t<c,"Parent index ".concat(t," exceeds the total number of instances: ").concat(c)),assert(r.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),r.push(t);const a=vu(i)?i[t]:1,p=vu(i)?s[t]:t;for(let _=0;_<a;++_){const w=n[p+_];w!==t&&fk(e,w,r)}r.pop(t)}function ga(e){return e!=null}const py=(e,t)=>e,utt={HIERARCHY:!0,extensions:!0,extras:!0};class mk{constructor(t,r,i){var n;let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};q(this,"json",void 0),q(this,"binary",void 0),q(this,"featureCount",void 0),q(this,"_extensions",void 0),q(this,"_properties",void 0),q(this,"_binaryProperties",void 0),q(this,"_hierarchy",void 0),Ki(i>=0),this.json=t||{},this.binary=r,this.featureCount=i,this._extensions=((n=this.json)===null||n===void 0?void 0:n.extensions)||{},this._properties={};for(const c in this.json)utt[c]||(this._properties[c]=this.json[c]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=stt(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,r){if(this._checkBatchId(t),Ki(typeof r=="string",r),this._hierarchy){const i=Pg(this._hierarchy,t,(n,s)=>{const c=n.classIds[s];return n.classes[c].name===r});return ga(i)}return!1}isExactClass(t,r){return Ki(typeof r=="string",r),this.getExactClassName(t)===r}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const r=this._hierarchy.classIds[t];return this._hierarchy.classes[r].name}}hasProperty(t,r){return this._checkBatchId(t),Ki(typeof r=="string",r),ga(this._properties[r])||this._hasPropertyInHierarchy(t,r)}getPropertyNames(t,r){this._checkBatchId(t),r=ga(r)?r:[],r.length=0;const i=Object.keys(this._properties);return r.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(t,r),r}getProperty(t,r){if(this._checkBatchId(t),Ki(typeof r=="string",r),this._binaryProperties){const n=this._binaryProperties[r];if(ga(n))return this._getBinaryProperty(n,t)}const i=this._properties[r];if(ga(i))return py(i[t]);if(this._hierarchy){const n=this._getHierarchyProperty(t,r);if(ga(n))return n}}setProperty(t,r,i){const n=this.featureCount;if(this._checkBatchId(t),Ki(typeof r=="string",r),this._binaryProperties){const c=this._binaryProperties[r];if(c){this._setBinaryProperty(c,t,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,r,i))return;let s=this._properties[r];ga(s)||(this._properties[r]=new Array(n),s=this._properties[r]),s[t]=py(i)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,r){return t.unpack(t.typedArray,r)}_setBinaryProperty(t,r,i){t.pack(i,t.typedArray,r)}_initializeBinaryProperties(){let t=null;for(const r in this._properties){const i=this._properties[r],n=this._initializeBinaryProperty(r,i);n&&(t=t||{},t[r]=n)}return t}_initializeBinaryProperty(t,r){if("byteOffset"in r){const i=r;Ki(this.binary,"Property ".concat(t," requires a batch table binary.")),Ki(i.type,"Property ".concat(t," requires a type."));const n=ntt(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(t,r){if(!this._hierarchy)return!1;const i=Pg(this._hierarchy,t,(n,s)=>{const c=n.classIds[s],a=n.classes[c].instances;return ga(a[r])});return ga(i)}_getPropertyNamesInHierarchy(t,r){Pg(this._hierarchy,t,(i,n)=>{const s=i.classIds[n],c=i.classes[s].instances;for(const a in c)c.hasOwnProperty(a)&&r.indexOf(a)===-1&&r.push(a)})}_getHierarchyProperty(t,r){return Pg(this._hierarchy,t,(i,n)=>{const s=i.classIds[n],c=i.classes[s],a=i.classIndexes[n],p=c.instances[r];return ga(p)?ga(p.typedArray)?this._getBinaryProperty(p,a):py(p[a]):null})}_setHierarchyProperty(t,r,i,n){const s=Pg(this._hierarchy,r,(c,a)=>{const p=c.classIds[a],_=c.classes[p],w=c.classIndexes[a],S=_.instances[i];return ga(S)?(Ki(a===r,'Inherited property "'.concat(i,'" is read-only.')),ga(S.typedArray)?this._setBinaryProperty(S,w,n):S[w]=py(n),!0):!1});return ga(s)}}const U2=4;function bv(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=new DataView(t);if(e.magic=i.getUint32(r,!0),r+=U2,e.version=i.getUint32(r,!0),r+=U2,e.byteLength=i.getUint32(r,!0),r+=U2,e.version!==1)throw new Error("3D Tile Version ".concat(e.version," not supported"));return r}const vf=4,yI="b3dm tile in legacy format.";function p3(e,t,r){const i=new DataView(t);let n;e.header=e.header||{};let s=i.getUint32(r,!0);r+=vf;let c=i.getUint32(r,!0);r+=vf;let a=i.getUint32(r,!0);r+=vf;let p=i.getUint32(r,!0);return r+=vf,a>=570425344?(r-=vf*2,n=s,a=c,p=0,s=0,c=0,console.warn(yI)):p>=570425344&&(r-=vf,n=a,a=s,p=c,s=0,c=0,console.warn(yI)),e.header.featureTableJsonByteLength=s,e.header.featureTableBinaryByteLength=c,e.header.batchTableJsonByteLength=a,e.header.batchTableBinaryByteLength=p,e.header.batchLength=n,r}function f3(e,t,r,i){return r=htt(e,t,r),r=dtt(e,t,r),r}function htt(e,t,r,i){const{featureTableJsonByteLength:n,featureTableBinaryByteLength:s,batchLength:c}=e.header;if(e.featureTableJson={BATCH_LENGTH:c||0},n>0){const a=pk(t,r,n);e.featureTableJson=JSON.parse(a)}return r+=n,e.featureTableBinary=new Uint8Array(t,r,s),r+=s,r}function dtt(e,t,r,i){const{batchTableJsonByteLength:n,batchTableBinaryByteLength:s}=e.header;if(n>0){const c=pk(t,r,n);e.batchTableJson=JSON.parse(c),r+=n,s>0&&(e.batchTableBinary=new Uint8Array(t,r,s),e.batchTableBinary=new Uint8Array(e.batchTableBinary),r+=s)}return r}function gk(e,t,r){if(!t&&(!e||!e.batchIds||!r))return null;const{batchIds:i,isRGB565:n,pointCount:s}=e;if(i&&r){const c=new Uint8ClampedArray(s*3);for(let a=0;a<s;a++){const p=i[a],_=r.getProperty(p,"dimensions").map(w=>w*255);c[a*3]=_[0],c[a*3+1]=_[1],c[a*3+2]=_[2]}return{type:mi.UNSIGNED_BYTE,value:c,size:3,normalized:!0}}if(n){const c=new Uint8ClampedArray(s*3);for(let a=0;a<s;a++){const p=KQ(t[a]);c[a*3]=p[0],c[a*3+1]=p[1],c[a*3+2]=p[2]}return{type:mi.UNSIGNED_BYTE,value:c,size:3,normalized:!0}}return t&&t.length===s*3?{type:mi.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:mi.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}const _I=new te;function ptt(e,t){if(!t)return null;if(e.isOctEncoded16P){const r=new Float32Array(e.pointsLength*3);for(let i=0;i<e.pointsLength;i++)ttt(t[i*2],t[i*2+1],_I),_I.toArray(r,i*3);return{type:mi.FLOAT,size:2,value:r}}return{type:mi.FLOAT,size:2,value:t}}function ftt(e,t,r){return e.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,mtt(e,t)):{type:mi.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function mtt(e,t){const r=new te,i=new Float32Array(e.pointCount*3);for(let n=0;n<e.pointCount;n++)r.set(t[n*3],t[n*3+1],t[n*3+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(i,n*3);return i}async function gtt(e,t,r,i,n){r=bv(e,t,r),r=p3(e,t,r),r=f3(e,t,r),ytt(e);const{featureTable:s,batchTable:c}=_tt(e);return await Stt(e,s,c,i,n),vtt(e,s,i),btt(e,s,c),wtt(e,s),r}function ytt(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function _tt(e){const t=new d3(e.featureTableJson,e.featureTableBinary),r=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=r,e.featuresLength=r,e.pointsLength=r,e.pointCount=r,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",mi.FLOAT,3);const i=xtt(e,t);return{featureTable:t,batchTable:i}}function vtt(e,t,r){if(!e.attributes.positions){if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",mi.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const i=t.getPropertyArray("POSITION_QUANTIZED",mi.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",mi.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",mi.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=ftt(e,i,r)}}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function btt(e,t,r){if(!e.attributes.colors){let i=null;t.hasProperty("RGBA")?(i=t.getPropertyArray("RGBA",mi.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?i=t.getPropertyArray("RGB",mi.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(i=t.getPropertyArray("RGB565",mi.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=gk(e,i,r)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",mi.UNSIGNED_BYTE,4))}function wtt(e,t){if(!e.attributes.normals){let r=null;t.hasProperty("NORMAL")?r=t.getPropertyArray("NORMAL",mi.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(r=t.getPropertyArray("NORMAL_OCT16P",mi.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=ptt(e,r)}}function xtt(e,t){let r=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",mi.UNSIGNED_SHORT,1),e.batchIds)){const i=t.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:n,batchTableBinary:s}=e;r=new mk(n,s,i)}return r}async function Stt(e,t,r,i,n){let s,c,a;const p=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];p&&(a=p.properties);const _=t.getExtension("3DTILES_draco_point_compression");if(_){c=_.properties;const S=_.byteOffset,C=_.byteLength;if(!c||!Number.isFinite(S)||!C)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=e.featureTableBinary.slice(S,S+C),e.hasPositions=Number.isFinite(c.POSITION),e.hasColors=Number.isFinite(c.RGB)||Number.isFinite(c.RGBA),e.hasNormals=Number.isFinite(c.NORMAL),e.hasBatchIds=Number.isFinite(c.BATCH_ID),e.isTranslucent=Number.isFinite(c.RGBA)}if(!s)return!0;const w={buffer:s,properties:{...c,...a},featureTableProperties:c,batchTableProperties:a,dequantizeInShader:!1};return await Att(e,w,i,n)}async function Att(e,t,r,i){const{parse:n}=i,s={...r,draco:{...r.draco,extraAttributes:t.batchTableProperties||{}}};delete s["3d-tiles"];const c=await n(t.buffer,tk,s),a=c.attributes.POSITION&&c.attributes.POSITION.value,p=c.attributes.COLOR_0&&c.attributes.COLOR_0.value,_=c.attributes.NORMAL&&c.attributes.NORMAL.value,w=c.attributes.BATCH_ID&&c.attributes.BATCH_ID.value,S=a&&c.attributes.POSITION.value.quantization,C=_&&c.attributes.NORMAL.value.quantization;if(S){const N=c.POSITION.data.quantization,F=N.range;e.quantizedVolumeScale=new te(F,F,F),e.quantizedVolumeOffset=new te(N.minValues),e.quantizedRange=(1<<N.quantizationBits)-1,e.isQuantizedDraco=!0}C&&(e.octEncodedRange=(1<<c.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);const I={};if(t.batchTableProperties)for(const N of Object.keys(t.batchTableProperties))c.attributes[N]&&c.attributes[N].value&&(I[N.toLowerCase()]=c.attributes[N].value);e.attributes={positions:a,colors:gk(e,p,void 0),normals:_,batchIds:w,...I}}const zx={URI:0,EMBEDDED:1};function yk(e,t,r,i){e.rotateYtoZ=!0;const n=e.byteOffset+e.byteLength-r;if(n===0)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=i["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=hS(t,r,n),e.gltfByteOffset=0,e.gltfByteLength=n,r%4===0||console.warn("".concat(e.type,": embedded glb is not aligned to a 4-byte boundary.")),e.byteOffset+e.byteLength}async function _k(e,t,r,i){const n=r["3d-tiles"]||{};if(Ett(e,t),n.loadGLTF){const{parse:s,fetch:c}=i;e.gltfUrl&&(e.gltfArrayBuffer=await c(e.gltfUrl,r),e.gltfByteOffset=0),e.gltfArrayBuffer&&(e.gltf=await s(e.gltfArrayBuffer,B0,r,i),e.gpuMemoryUsageInBytes=KB(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength)}}function Ett(e,t,r){switch(t){case zx.URI:const i=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),n=new TextDecoder().decode(i);e.gltfUrl=n.replace(/[\s\0]+$/,""),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case zx.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function Ttt(e,t,r,i,n){var s;r=Ctt(e,t,r,i),await _k(e,zx.EMBEDDED,i,n);const c=e==null||(s=e.gltf)===null||s===void 0?void 0:s.extensions;return c&&c.CESIUM_RTC&&(e.rtcCenter=c.CESIUM_RTC.center),r}function Ctt(e,t,r,i,n){r=bv(e,t,r),r=p3(e,t,r),r=f3(e,t,r),r=yk(e,t,r,i);const s=new d3(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=s.getGlobalProperty("RTC_CENTER",mi.FLOAT,3),r}async function Ptt(e,t,r,i,n){return r=Itt(e,t,r,i),await _k(e,e.gltfFormat,i,n),r}function Itt(e,t,r,i,n){if(r=bv(e,t,r),e.version!==1)throw new Error("Instanced 3D Model version ".concat(e.version," is not supported"));r=p3(e,t,r);const s=new DataView(t);if(e.gltfFormat=s.getUint32(r,!0),r+=4,r=f3(e,t,r),r=yk(e,t,r,i),e.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const c=new d3(e.featureTableJson,e.featureTableBinary),a=c.getGlobalProperty("INSTANCES_LENGTH");if(c.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=c.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=c.getGlobalProperty("RTC_CENTER",mi.FLOAT,3);const p=new mk(e.batchTableJson,e.batchTableBinary,a);return Ltt(e,c,p,a),r}function Ltt(e,t,r,i){const n={instances:new Array(i),batchTable:e._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,s=new te;new te,new te,new te;const c=new jn,a=new C0,p=new te,_={},w=new ui,S=[],C=[],I=new te,N=new te;for(let F=0;F<i;F++){let W;if(t.hasProperty("POSITION"))W=t.getProperty("POSITION",mi.FLOAT,3,F,s);else if(t.hasProperty("POSITION_QUANTIZED")){W=t.getProperty("POSITION_QUANTIZED",mi.UNSIGNED_SHORT,3,F,s);const bt=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",mi.FLOAT,3,I);if(!bt)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const vt=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",mi.FLOAT,3,N);if(!vt)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const mt=65535;for(let Dt=0;Dt<3;Dt++)W[Dt]=W[Dt]/mt*vt[Dt]+bt[Dt]}if(!W)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(s.copy(W),_.translation=s,e.normalUp=t.getProperty("NORMAL_UP",mi.FLOAT,3,F,S),e.normalRight=t.getProperty("NORMAL_RIGHT",mi.FLOAT,3,F,C),e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",mi.UNSIGNED_SHORT,2,S),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",mi.UNSIGNED_SHORT,2,C),e.octNormalUp)throw e.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");e.eastNorthUp?(Tn.WGS84.eastNorthUpToFixedFrame(s,w),w.getRotationMatrix3(c)):c.identity()}a.fromMatrix3(c),_.rotation=a,p.set(1,1,1);const U=t.getProperty("SCALE",mi.FLOAT,1,F);Number.isFinite(U)&&p.multiplyByScalar(U);const z=t.getProperty("SCALE_NON_UNIFORM",mi.FLOAT,3,F,S);z&&p.scale(z),_.scale=p;let H=t.getProperty("BATCH_ID",mi.UNSIGNED_SHORT,1,F);H===void 0&&(H=F);const nt=new ui().fromQuaternion(_.rotation);w.identity(),w.translate(_.translation),w.multiplyRight(nt),w.scale(_.scale);const yt=w.clone();n[F]={modelMatrix:yt,batchId:H}}e.instances=n}async function Mtt(e,t,r,i,n,s){r=bv(e,t,r);const c=new DataView(t);for(e.tilesLength=c.getUint32(r,!0),r+=4,e.tiles=[];e.tiles.length<e.tilesLength&&e.byteLength-r>12;){const a={};e.tiles.push(a),r=await s(t,r,i,n,a)}return r}async function Btt(e,t,r,i){e.rotateYtoZ=!0,e.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y";const{parse:n}=i;e.gltf=await n(t,B0,r,i),e.gpuMemoryUsageInBytes=KB(e.gltf)}async function vk(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(n.byteOffset=t,n.type=XQ(e,t),n.type){case Cg.COMPOSITE:return await Mtt(n,e,t,r,i,vk);case Cg.BATCHED_3D_MODEL:return await Ttt(n,e,t,r,i);case Cg.GLTF:return await Btt(n,e,r,i);case Cg.INSTANCED_3D_MODEL:return await Ptt(n,e,t,r,i);case Cg.POINT_CLOUD:return await gtt(n,e,t,r,i);default:throw new Error("3DTileLoader: unknown type ".concat(n.type))}}const ktt=1952609651,Rtt=1;async function Ftt(e,t,r){if(new Uint32Array(e.slice(0,4))[0]!==ktt)throw new Error("Wrong subtree file magic number");if(new Uint32Array(e.slice(4,8))[0]!==Rtt)throw new Error("Wrong subtree file verson, must be 1");const i=vI(e.slice(8,16)),n=new Uint8Array(e,24,i),s=new TextDecoder("utf8").decode(n),c=JSON.parse(s),a=vI(e.slice(16,24));let p=new ArrayBuffer(0);return a&&(p=e.slice(24+i)),"bufferView"in c.tileAvailability&&(c.tileAvailability.explicitBitstream=await G2(c,"tileAvailability",p,r)),"bufferView"in c.contentAvailability&&(c.contentAvailability.explicitBitstream=await G2(c,"contentAvailability",p,r)),"bufferView"in c.childSubtreeAvailability&&(c.childSubtreeAvailability.explicitBitstream=await G2(c,"childSubtreeAvailability",p,r)),c}function Dtt(e,t){if(t.startsWith("http")){const n=new URL(e,t);return decodeURI(n.toString())}const r="http://".concat(t),i=new URL(e,r);return"/".concat(i.host).concat(i.pathname)}async function G2(e,t,r,i){const n=e[t].bufferView,s=e.bufferViews[n],c=e.buffers[s.buffer];if(!(i!=null&&i.url)||!i.fetch)throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(c.uri){const a=Dtt(c.uri,i==null?void 0:i.url),p=await(await i.fetch(a)).arrayBuffer();return new Uint8Array(p,s.byteOffset,s.byteLength)}return new Uint8Array(r,s.byteOffset,s.byteLength)}function vI(e){const t=new DataView(e),r=t.getUint32(0,!0),i=t.getUint32(4,!0);return r+2**32*i}const bk={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:dk,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:Ftt,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Ol=null;try{Ol=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Vi(e,t,r){this.low=e|0,this.high=t|0,this.unsigned=!!r}Vi.prototype.__isLong__;Object.defineProperty(Vi.prototype,"__isLong__",{value:!0});function Lo(e){return(e&&e.__isLong__)===!0}function bI(e){var t=Math.clz32(e&-e);return e?31-t:t}Vi.isLong=Lo;var wI={},xI={};function jp(e,t){var r,i,n;return t?(e>>>=0,(n=0<=e&&e<256)&&(i=xI[e],i)?i:(r=bi(e,0,!0),n&&(xI[e]=r),r)):(e|=0,(n=-128<=e&&e<128)&&(i=wI[e],i)?i:(r=bi(e,e<0?-1:0,!1),n&&(wI[e]=r),r))}Vi.fromInt=jp;function zl(e,t){if(isNaN(e))return t?uh:vc;if(t){if(e<0)return uh;if(e>=wk)return Ak}else{if(e<=-AI)return wa;if(e+1>=AI)return Sk}return e<0?zl(-e,t).neg():bi(e%Sm|0,e/Sm|0,t)}Vi.fromNumber=zl;function bi(e,t,r){return new Vi(e,t,r)}Vi.fromBits=bi;var j_=Math.pow;function m3(e,t,r){if(e.length===0)throw Error("empty string");if(typeof t=="number"?(r=t,t=!1):t=!!t,e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return t?uh:vc;if(r=r||10,r<2||36<r)throw RangeError("radix");var i;if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return m3(e.substring(1),t,r).neg();for(var n=zl(j_(r,8)),s=vc,c=0;c<e.length;c+=8){var a=Math.min(8,e.length-c),p=parseInt(e.substring(c,c+a),r);if(a<8){var _=zl(j_(r,a));s=s.mul(_).add(zl(p))}else s=s.mul(n),s=s.add(zl(p))}return s.unsigned=t,s}Vi.fromString=m3;function Tc(e,t){return typeof e=="number"?zl(e,t):typeof e=="string"?m3(e,t):bi(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}Vi.fromValue=Tc;var SI=65536,Ntt=1<<24,Sm=SI*SI,wk=Sm*Sm,AI=wk/2,EI=jp(Ntt),vc=jp(0);Vi.ZERO=vc;var uh=jp(0,!0);Vi.UZERO=uh;var Gf=jp(1);Vi.ONE=Gf;var xk=jp(1,!0);Vi.UONE=xk;var jx=jp(-1);Vi.NEG_ONE=jx;var Sk=bi(-1,2147483647,!1);Vi.MAX_VALUE=Sk;var Ak=bi(-1,-1,!0);Vi.MAX_UNSIGNED_VALUE=Ak;var wa=bi(0,-2147483648,!1);Vi.MIN_VALUE=wa;var Re=Vi.prototype;Re.toInt=function(){return this.unsigned?this.low>>>0:this.low};Re.toNumber=function(){return this.unsigned?(this.high>>>0)*Sm+(this.low>>>0):this.high*Sm+(this.low>>>0)};Re.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(wa)){var t=zl(e),r=this.div(t),i=r.mul(t).sub(this);return r.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var n=zl(j_(e,6),this.unsigned),s=this,c="";;){var a=s.div(n),p=s.sub(a.mul(n)).toInt()>>>0,_=p.toString(e);if(s=a,s.isZero())return _+c;for(;_.length<6;)_="0"+_;c=""+_+c}};Re.getHighBits=function(){return this.high};Re.getHighBitsUnsigned=function(){return this.high>>>0};Re.getLowBits=function(){return this.low};Re.getLowBitsUnsigned=function(){return this.low>>>0};Re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(wa)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};Re.isZero=function(){return this.high===0&&this.low===0};Re.eqz=Re.isZero;Re.isNegative=function(){return!this.unsigned&&this.high<0};Re.isPositive=function(){return this.unsigned||this.high>=0};Re.isOdd=function(){return(this.low&1)===1};Re.isEven=function(){return(this.low&1)===0};Re.equals=function(e){return Lo(e)||(e=Tc(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Re.eq=Re.equals;Re.notEquals=function(e){return!this.eq(e)};Re.neq=Re.notEquals;Re.ne=Re.notEquals;Re.lessThan=function(e){return this.comp(e)<0};Re.lt=Re.lessThan;Re.lessThanOrEqual=function(e){return this.comp(e)<=0};Re.lte=Re.lessThanOrEqual;Re.le=Re.lessThanOrEqual;Re.greaterThan=function(e){return this.comp(e)>0};Re.gt=Re.greaterThan;Re.greaterThanOrEqual=function(e){return this.comp(e)>=0};Re.gte=Re.greaterThanOrEqual;Re.ge=Re.greaterThanOrEqual;Re.compare=function(e){if(Lo(e)||(e=Tc(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Re.comp=Re.compare;Re.negate=function(){return!this.unsigned&&this.eq(wa)?wa:this.not().add(Gf)};Re.neg=Re.negate;Re.add=function(e){Lo(e)||(e=Tc(e));var t=this.high>>>16,r=this.high&65535,i=this.low>>>16,n=this.low&65535,s=e.high>>>16,c=e.high&65535,a=e.low>>>16,p=e.low&65535,_=0,w=0,S=0,C=0;return C+=n+p,S+=C>>>16,C&=65535,S+=i+a,w+=S>>>16,S&=65535,w+=r+c,_+=w>>>16,w&=65535,_+=t+s,_&=65535,bi(S<<16|C,_<<16|w,this.unsigned)};Re.subtract=function(e){return Lo(e)||(e=Tc(e)),this.add(e.neg())};Re.sub=Re.subtract;Re.multiply=function(e){if(this.isZero())return this;if(Lo(e)||(e=Tc(e)),Ol){var t=Ol.mul(this.low,this.high,e.low,e.high);return bi(t,Ol.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?uh:vc;if(this.eq(wa))return e.isOdd()?wa:vc;if(e.eq(wa))return this.isOdd()?wa:vc;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(EI)&&e.lt(EI))return zl(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,i=this.high&65535,n=this.low>>>16,s=this.low&65535,c=e.high>>>16,a=e.high&65535,p=e.low>>>16,_=e.low&65535,w=0,S=0,C=0,I=0;return I+=s*_,C+=I>>>16,I&=65535,C+=n*_,S+=C>>>16,C&=65535,C+=s*p,S+=C>>>16,C&=65535,S+=i*_,w+=S>>>16,S&=65535,S+=n*p,w+=S>>>16,S&=65535,S+=s*a,w+=S>>>16,S&=65535,w+=r*_+i*p+n*a+s*c,w&=65535,bi(C<<16|I,w<<16|S,this.unsigned)};Re.mul=Re.multiply;Re.divide=function(e){if(Lo(e)||(e=Tc(e)),e.isZero())throw Error("division by zero");if(Ol){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ol.div_u:Ol.div_s)(this.low,this.high,e.low,e.high);return bi(t,Ol.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?uh:vc;var r,i,n;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return uh;if(e.gt(this.shru(1)))return xk;n=uh}else{if(this.eq(wa)){if(e.eq(Gf)||e.eq(jx))return wa;if(e.eq(wa))return Gf;var s=this.shr(1);return r=s.div(e).shl(1),r.eq(vc)?e.isNegative()?Gf:jx:(i=this.sub(e.mul(r)),n=r.add(i.div(e)),n)}else if(e.eq(wa))return this.unsigned?uh:vc;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();n=vc}for(i=this;i.gte(e);){r=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var c=Math.ceil(Math.log(r)/Math.LN2),a=c<=48?1:j_(2,c-48),p=zl(r),_=p.mul(e);_.isNegative()||_.gt(i);)r-=a,p=zl(r,this.unsigned),_=p.mul(e);p.isZero()&&(p=Gf),n=n.add(p),i=i.sub(_)}return n};Re.div=Re.divide;Re.modulo=function(e){if(Lo(e)||(e=Tc(e)),Ol){var t=(this.unsigned?Ol.rem_u:Ol.rem_s)(this.low,this.high,e.low,e.high);return bi(t,Ol.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Re.mod=Re.modulo;Re.rem=Re.modulo;Re.not=function(){return bi(~this.low,~this.high,this.unsigned)};Re.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};Re.clz=Re.countLeadingZeros;Re.countTrailingZeros=function(){return this.low?bI(this.low):bI(this.high)+32};Re.ctz=Re.countTrailingZeros;Re.and=function(e){return Lo(e)||(e=Tc(e)),bi(this.low&e.low,this.high&e.high,this.unsigned)};Re.or=function(e){return Lo(e)||(e=Tc(e)),bi(this.low|e.low,this.high|e.high,this.unsigned)};Re.xor=function(e){return Lo(e)||(e=Tc(e)),bi(this.low^e.low,this.high^e.high,this.unsigned)};Re.shiftLeft=function(e){return Lo(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?bi(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):bi(0,this.low<<e-32,this.unsigned)};Re.shl=Re.shiftLeft;Re.shiftRight=function(e){return Lo(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?bi(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):bi(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Re.shr=Re.shiftRight;Re.shiftRightUnsigned=function(e){return Lo(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?bi(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?bi(this.high,0,this.unsigned):bi(this.high>>>e-32,0,this.unsigned)};Re.shru=Re.shiftRightUnsigned;Re.shr_u=Re.shiftRightUnsigned;Re.rotateLeft=function(e){var t;return Lo(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?bi(this.high,this.low,this.unsigned):e<32?(t=32-e,bi(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,bi(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))};Re.rotl=Re.rotateLeft;Re.rotateRight=function(e){var t;return Lo(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?bi(this.high,this.low,this.unsigned):e<32?(t=32-e,bi(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,bi(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))};Re.rotr=Re.rotateRight;Re.toSigned=function(){return this.unsigned?bi(this.low,this.high,!1):this};Re.toUnsigned=function(){return this.unsigned?this:bi(this.low,this.high,!0)};Re.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Re.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Re.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Vi.fromBytes=function(e,t,r){return r?Vi.fromBytesLE(e,t):Vi.fromBytesBE(e,t)};Vi.fromBytesLE=function(e,t){return new Vi(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Vi.fromBytesBE=function(e,t){return new Vi(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const Ott=16;function Ek(e){e==="X"&&(e="");const t=e.padEnd(Ott,"0");return Vi.fromString(t,!0,16)}function ztt(e){if(e.isZero())return"X";let t=e.countTrailingZeros();const r=t%4;t=(t-r)/4;const i=t;t*=4;const n=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-i-n.length).join("0")+n}function jtt(e,t){const r=Utt(e).shiftRightUnsigned(2);return e.add(Vi.fromNumber(2*t+1-4).multiply(r))}function Utt(e){return e.and(e.not().add(1))}const Gtt=3,Vtt=30,qtt=2*Vtt+1,TI=180/Math.PI;function Htt(e){if(e.length===0)throw new Error("Invalid Hilbert quad key ".concat(e));const t=e.split("/"),r=parseInt(t[0],10),i=t[1],n=i.length;let s=0;const c=[0,0];for(let a=n-1;a>=0;a--){s=n-a;const p=i[a];let _=0,w=0;p==="1"?w=1:p==="2"?(_=1,w=1):p==="3"&&(_=1);const S=Math.pow(2,s-1);Wtt(S,c,_,w),c[0]+=S*_,c[1]+=S*w}if(r%2===1){const a=c[0];c[0]=c[1],c[1]=a}return{face:r,ij:c,level:s}}function $tt(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<Gtt+qtt;)t="0"+t;const r=t.lastIndexOf("1"),i=t.substring(0,3),n=t.substring(3,r),s=n.length/2,c=Vi.fromString(i,!0,2).toString(10);let a="";if(s!==0)for(a=Vi.fromString(n,!0,2).toString(4);a.length<s;)a="0"+a;return"".concat(c,"/").concat(a)}function Tk(e,t,r){const i=1<<t;return[(e[0]+r[0])/i,(e[1]+r[1])/i]}function CI(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function Ck(e){return[CI(e[0]),CI(e[1])]}function Pk(e,t){let[r,i]=t;switch(e){case 0:return[1,r,i];case 1:return[-r,1,i];case 2:return[-r,-i,1];case 3:return[-1,-i,-r];case 4:return[i,-1,-r];case 5:return[i,r,-1];default:throw new Error("Invalid face")}}function Ik(e){let[t,r,i]=e;const n=Math.atan2(i,Math.sqrt(t*t+r*r));return[Math.atan2(r,t)*TI,n*TI]}function Wtt(e,t,r,i){if(i===0){r===1&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const n=t[0];t[0]=t[1],t[1]=n}}function Xtt(e){const t=Tk(e.ij,e.level,[.5,.5]),r=Ck(t),i=Pk(e.face,r);return Ik(i)}const Ztt=100;function PI(e){const{face:t,ij:r,level:i}=e,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(Ztt*Math.pow(2,-i))),c=new Float64Array(4*s*2+2);let a=0,p=0;for(let _=0;_<4;_++){const w=n[_].slice(0),S=n[_+1],C=(S[0]-w[0])/s,I=(S[1]-w[1])/s;for(let N=0;N<s;N++){w[0]+=C,w[1]+=I;const F=Tk(r,i,w),W=Ck(F),U=Pk(t,W),z=Ik(U);Math.abs(z[1])>89.999&&(z[0]=p);const H=z[0]-p;z[0]+=H>180?-360:H<-180?360:0,c[a++]=z[0],c[a++]=z[1],p=z[0]}}return c[a++]=c[0],c[a++]=c[1],c}function g3(e){const t=Ytt(e);return Htt(t)}function Ytt(e){if(e.indexOf("/")>0)return e;const t=Ek(e);return $tt(t)}function Jtt(e){const t=g3(e);return Xtt(t)}function Ktt(e){let t;if(e.face===2||e.face===5){let r=null,i=0;for(let n=0;n<4;n++){const s="".concat(e.face,"/").concat(n),c=g3(s),a=PI(c);(typeof r>"u"||r===null)&&(r=new Float64Array(4*a.length)),r.set(a,i),i+=a.length}t=II(r)}else{const r=PI(e);t=II(r)}return t}function II(e){if(e.length%2!==0)throw new Error("Invalid corners");const t=[],r=[];for(let i=0;i<e.length;i+=2)t.push(e[i]),r.push(e[i+1]);return t.sort((i,n)=>i-n),r.sort((i,n)=>i-n),{west:t[0],east:t[t.length-1],north:r[r.length-1],south:r[0]}}function Qtt(e,t){const r=(t==null?void 0:t.minimumHeight)||0,i=(t==null?void 0:t.maximumHeight)||0,n=g3(e),s=Ktt(n),c=s.west,a=s.south,p=s.east,_=s.north,w=[];return w.push(new te(c,_,r)),w.push(new te(p,_,r)),w.push(new te(p,a,r)),w.push(new te(c,a,r)),w.push(new te(c,_,i)),w.push(new te(p,_,i)),w.push(new te(p,a,i)),w.push(new te(c,a,i)),w}function Lk(e){const t=e.token,r={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},i=Qtt(t,r),n=Jtt(t),s=n[0],c=n[1],a=Tn.WGS84.cartographicToCartesian([s,c,r.maximumHeight]),p=new te(a[0],a[1],a[2]);i.push(p);const _=TZ(i);return[..._.center,..._.halfAxes]}const tet=4,eet=8,ret={QUADTREE:tet,OCTREE:eet};function iet(e,t,r){if(e!=null&&e.box){const i=Ek(e.s2VolumeInfo.token),n=jtt(i,t),s=ztt(n),c={...e.s2VolumeInfo};switch(c.token=s,r){case"OCTREE":const a=e.s2VolumeInfo,p=a.maximumHeight-a.minimumHeight,_=p/2,w=a.minimumHeight+p/2;a.minimumHeight=w-_,a.maximumHeight=w+_;break}return{box:Lk(c),s2VolumeInfo:c}}}async function Mk(e){const{options:t,parentData:r={mortonIndex:0,x:0,y:0,z:0},childIndex:i=0,globalData:n={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:s}=e;let{subtree:c,level:a=0}=e;const{subdivisionScheme:p,subtreeLevels:_,maximumLevel:w,contentUrlTemplate:S,subtreesUriTemplate:C,basePath:I}=t,N={children:[],lodMetricValue:0,contentUrl:""},F=ret[p],W=i&1,U=i>>1&1,z=i>>2&1,H=(F**a-1)/(F-1);let nt=ep(r.mortonIndex,i),yt=H+nt,bt=ep(r.x,W),vt=ep(r.y,U),mt=ep(r.z,z),Dt=!1;a+1>_&&(Dt=V2(c.childSubtreeAvailability,nt));const kt=ep(n.x,bt),at=ep(n.y,vt),dt=ep(n.z,mt),It=a+n.level;if(Dt){const ee="".concat(I,"/").concat(C),se=Ux(ee,It,kt,at,dt);c=await Sd(se,bk),n.mortonIndex=nt,n.x=bt,n.y=vt,n.z=mt,n.level=a,nt=0,yt=0,bt=0,vt=0,mt=0,a=0}if(!V2(c.tileAvailability,yt)||a>w)return N;V2(c.contentAvailability,yt)&&(N.contentUrl=Ux(S,It,kt,at,dt));const xt=a+1,re={mortonIndex:nt,x:bt,y:vt,z:mt};for(let ee=0;ee<F;ee++){const se=iet(s,ee,p),Ot=await Mk({subtree:c,options:t,parentData:re,childIndex:ee,level:xt,globalData:n,s2VolumeBox:se});if(Ot.contentUrl||Ot.children.length){const Xt=It+1,Wt=net(Ot,Xt,{childTileX:bt,childTileY:vt,childTileZ:mt},t,s);N.children.push(Wt)}}return N}function V2(e,t){return"constant"in e?!!e.constant:e.explicitBitstream?aet(t,e.explicitBitstream):!1}function net(e,t,r,i,n){const{basePath:s,refine:c,getRefine:a,lodMetricType:p,getTileType:_,rootLodMetricValue:w,rootBoundingVolume:S}=i,C=e.contentUrl&&e.contentUrl.replace("".concat(s,"/"),""),I=w/2**t,N=n!=null&&n.box?{box:n.box}:S,F=set(t,N,r);return{children:e.children,contentUrl:e.contentUrl,content:{uri:C},id:e.contentUrl,refine:a(c),type:_(e),lodMetricType:p,lodMetricValue:I,geometricError:I,transform:e.transform,boundingVolume:F}}function set(e,t,r){if(t.region){const{childTileX:i,childTileY:n,childTileZ:s}=r,[c,a,p,_,w,S]=t.region,C=2**e,I=(p-c)/C,N=(_-a)/C,F=(S-w)/C,[W,U]=[c+I*i,c+I*(i+1)],[z,H]=[a+N*n,a+N*(n+1)],[nt,yt]=[w+F*s,w+F*(s+1)];return{region:[W,z,U,H,nt,yt]}}if(t.box)return t;throw new Error("Unsupported bounding volume type ".concat(t))}function ep(e,t){return parseInt(e.toString(2)+t.toString(2),2)}function Ux(e,t,r,i,n){const s=oet({level:t,x:r,y:i,z:n});return e.replace(/{level}|{x}|{y}|{z}/gi,c=>s[c])}function oet(e){const t={};for(const r in e)t["{".concat(r,"}")]=e[r];return t}function aet(e,t){const r=Math.floor(e/8),i=e%8;return(t[r]>>i&1)===1}function y3(e){if(!e.contentUrl)return tm.EMPTY;const t=e.contentUrl.split("?")[0].split(".").pop();switch(t){case"pnts":return tm.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return tm.SCENEGRAPH;default:return t}}function _3(e){switch(e){case"REPLACE":case"replace":return ph.REPLACE;case"ADD":case"add":return ph.ADD;default:return e}}function Gx(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const r=new URL(e,"".concat(t,"/"));return decodeURI(r.toString())}else if(e.startsWith("/"))return e;return"".concat(t,"/").concat(e)}function LI(e,t){if(!e)return null;if(e.content){const r=e.content.uri||e.content.url;e.contentUrl=Gx(r,t.basePath)}return e.id=e.contentUrl,e.lodMetricType=_v.GEOMETRIC_ERROR,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform,e.type=y3(e),e.refine=_3(e.refine),e}async function cet(e,t){const r=e.basePath;let i;const n=BI(e==null?void 0:e.root);n&&e.root?i=await MI(e.root,e,n,t):i=LI(e.root,e);const s=[];for(s.push(i);s.length>0;){const c=(s.pop()||{}).children||[];for(let a of c){const p=BI(a);p?a=await MI(a,e,p,t):LI(a,{basePath:r}),s.push(a)}}return i}async function MI(e,t,r,i){var n,s;const c=t.basePath,{subdivisionScheme:a,maximumLevel:p,subtreeLevels:_,subtrees:{uri:w}}=r,S=Ux(w,0,0,0,0),C=Gx(S,c),I=await Sd(C,bk,i),N=Gx(e.content.uri,c),F=t==null||(n=t.root)===null||n===void 0?void 0:n.refine,W=e.geometricError,U=(s=e.boundingVolume.extensions)===null||s===void 0?void 0:s["3DTILES_bounding_volume_S2"];if(U){const nt={box:Lk(U),s2VolumeInfo:U};e.boundingVolume=nt}const z=e.boundingVolume,H={contentUrlTemplate:N,subtreesUriTemplate:w,subdivisionScheme:a,subtreeLevels:_,maximumLevel:p,refine:F,basePath:c,lodMetricType:_v.GEOMETRIC_ERROR,rootLodMetricValue:W,rootBoundingVolume:z,getTileType:y3,getRefine:_3};return await uet(e,I,H)}async function uet(e,t,r){if(!e)return null;e.lodMetricType=_v.GEOMETRIC_ERROR,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform;const{children:i,contentUrl:n}=await Mk({subtree:t,options:r,s2VolumeBox:e});return n&&(e.contentUrl=n,e.content={uri:n.replace("".concat(r.basePath,"/"),"")}),e.refine=_3(e.refine),e.type=y3(e),e.children=i,e.id=e.contentUrl,e}function BI(e){var t;return(e==null||(t=e.extensions)===null||t===void 0?void 0:t["3DTILES_implicit_tiling"])||(e==null?void 0:e.implicitTiling)}const v3={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:dk,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:fet,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function het(e){return dS(e.url)}async function det(e,t,r){const i={content:{featureIds:null}};return await vk(e,0,t,r,i.content),i.content}async function pet(e,t,r){var i;const n=JSON.parse(new TextDecoder().decode(e));return n.loader=t.loader||v3,n.url=r.url,n.queryString=r.queryString,n.basePath=het(n),n.root=await cet(n,t),n.type=Ml.TILES3D,n.lodMetricType=_v.GEOMETRIC_ERROR,n.lodMetricValue=((i=n.root)===null||i===void 0?void 0:i.lodMetricValue)||0,n}async function fet(e,t,r){const i=t["3d-tiles"]||{};let n;return i.isTileset==="auto"?n=r.url&&r.url.indexOf(".json")!==-1:n=i.isTileset,n?e=await pet(e,t,r):e=await det(e,t,r),e}const kI=[0],met={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:v3,onTilesetLoad:{type:"function",value:e=>{}},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:(e,t,r)=>{}},_getMeshColor:{type:"function",value:e=>[255,255,255]}};class b3 extends kB{constructor(){super(...arguments),q(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&pi.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var t,r;return!!(!((t=this.state)===null||t===void 0||(r=t.tileset3d)===null||r===void 0)&&r.isLoaded()&&super.isLoaded)}shouldUpdateState(t){let{changeFlags:r}=t;return r.somethingChanged}updateState(t){let{props:r,oldProps:i,changeFlags:n}=t;if(r.data&&r.data!==i.data&&this._loadTileset(r.data),n.viewportChanged){const{activeViewports:s}=this.state;Object.keys(s).length&&(this._updateTileset(s),this.state.lastUpdatedViewports=s,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:s}=this.state;for(const c in s)s[c].needsUpdate=!0}}activateViewport(t){const{activeViewports:r,lastUpdatedViewports:i}=this.state;this.internalState.viewport=t,r[t.id]=t;const n=i==null?void 0:i[t.id];(!n||!t.equals(n))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(t){let{info:r,sourceLayer:i}=t;const n=i&&i.props.tile;return r.picked&&(r.object=n),r.sourceTile=n,r}filterSubLayer(t){let{layer:r,viewport:i}=t;const{tile:n}=r.props,{id:s}=i;return n.selected&&n.viewportIds.includes(s)}_updateAutoHighlight(t){const r=t.sourceTile,i=this.state.layerMap[r==null?void 0:r.id];i&&i.layer&&i.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:r={}}=this.props;let i=this.props.loader||this.props.loaders;Array.isArray(i)&&(i=i[0]);const n={loadOptions:{...r}};let s=t;if(i.preload){const p=await i.preload(t,r);p.url&&(s=p.url),p.headers&&(n.loadOptions.fetch={...n.loadOptions.fetch,headers:p.headers}),Object.assign(n,p)}const c=await Sd(s,i,n.loadOptions),a=new WQ(c,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...n});this.setState({tileset3d:a,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(a)}_onTileLoad(t){const{lastUpdatedViewports:r}=this.state;this.props.onTileLoad(t),this._updateTileset(r),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:r}=this.state,{timeline:i}=this.context,n=Object.keys(t).length;!i||!n||!r||r.selectTiles(Object.values(t)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(t,r){if(!t.content)return null;switch(t.type){case tm.POINTCLOUD:return this._makePointCloudLayer(t,r);case tm.SCENEGRAPH:return this._make3DModelLayer(t);case tm.MESH:return this._makeSimpleMeshLayer(t,r);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(t.content.type))}}_makePointCloudLayer(t,r){const{attributes:i,pointCount:n,constantRGBA:s,cartographicOrigin:c,modelMatrix:a}=t.content,{positions:p,normals:_,colors:w}=i;if(!p)return null;const S=r&&r.props.data||{header:{vertexCount:n},attributes:{POSITION:p,NORMAL:_,COLOR_0:w}},{pointSize:C,getPointColor:I}=this.props,N=this.getSubLayerClass("pointcloud",r3);return new N({pointSize:C},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(t.id),tile:t,data:S,coordinateSystem:hi.METER_OFFSETS,coordinateOrigin:c,modelMatrix:a,getColor:s||I,_offset:0})}_make3DModelLayer(t){const{gltf:r,instances:i,cartographicOrigin:n,modelMatrix:s}=t.content,c=this.getSubLayerClass("scenegraph",u3);return new c({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(t.id),tile:t,data:i||kI,scenegraph:r,coordinateSystem:hi.METER_OFFSETS,coordinateOrigin:n,modelMatrix:s,getTransformMatrix:a=>a.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,r){const i=t.content,{attributes:n,indices:s,modelMatrix:c,cartographicOrigin:a,coordinateSystem:p=hi.METER_OFFSETS,material:_,featureIds:w}=i,{_getMeshColor:S}=this.props,C=r&&r.props.mesh||new r0({drawMode:4,attributes:get(n),indices:s}),I=this.getSubLayerClass("mesh",h3);return new I(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(t.id),tile:t,mesh:C,data:kI,getColor:S(t),pbrMaterial:_,modelMatrix:c,coordinateOrigin:a,coordinateSystem:p,featureIds:w,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:r}=this.state;return t?t.tiles.map(i=>{const n=r[i.id]=r[i.id]||{tile:i};let{layer:s}=n;return i.selected&&(s?n.needsUpdate&&(s=this._getSubLayer(i,s),n.needsUpdate=!1):s=this._getSubLayer(i)),n.layer=s,s}).filter(Boolean):null}}q(b3,"defaultProps",met);q(b3,"layerName","Tile3DLayer");function get(e){const t={};return t.positions={...e.positions,value:new Float32Array(e.positions.value)},e.normals&&(t.normals=e.normals),e.texCoords&&(t.texCoords=e.texCoords),e.colors&&(t.colors=e.colors),e.uvRegions&&(t.uvRegions=e.uvRegions),t}var yet=Object.defineProperty,_et=(e,t,r)=>t in e?yet(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,vi=(e,t,r)=>(_et(e,typeof t!="symbol"?t+"":t,r),r);class vet{constructor(t){vi(this,"map"),vi(this,"width"),vi(this,"height"),vi(this,"svgCanvas"),vi(this,"xLine"),vi(this,"yLine"),vi(this,"color","#535353"),this.map=t,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var t,r;this.width=(t=this.map)==null?void 0:t.getCanvas().clientWidth,this.height=(r=this.map)==null?void 0:r.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const t=this.width/2,r=this.height/2;this.yLine.setAttribute("x1",`${t}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${t}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${r}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${r}px`)}else console.error("element value is null")}createCanvas(t){if(this.width!==void 0&&this.height!==void 0){const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.style.position="relative",r.setAttribute("width",`${this.width}px`),r.setAttribute("height",`${this.height}px`);const i=this.width/2,n=this.height/2;this.yLine=r.appendChild(this.createLine(i,0,i,this.height,this.color,"2px")),this.xLine=r.appendChild(this.createLine(0,n,this.width,n,this.color,"2px")),t==null||t.appendChild(r),this.svgCanvas=r}}createLine(t,r,i,n,s,c){const a=document.createElementNS("http://www.w3.org/2000/svg","line");return a.setAttribute("x1",t),a.setAttribute("y1",r),a.setAttribute("x2",i),a.setAttribute("y2",n),a.setAttribute("stroke-dasharray","5,5"),a.setAttribute("stroke",s),a.setAttribute("stroke-width",c),a}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}}const Vx={72:72,96:96,200:200,300:300,400:400},nh={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},jg={Landscape:"landscape",Portrait:"portrait"},gp={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},Am={in:"in",mm:"mm"};class bet{constructor(t){vi(this,"map"),vi(this,"width"),vi(this,"height"),vi(this,"unit"),vi(this,"svgCanvas"),vi(this,"svgPath");var r,i,n;if(this.map=t,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const s=(r=this.map)==null?void 0:r.getCanvas().clientWidth,c=(i=this.map)==null?void 0:i.getCanvas().clientHeight,a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.style.position="absolute",a.style.top="0px",a.style.left="0px",a.setAttribute("width",`${s}px`),a.setAttribute("height",`${c}px`);const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("style","fill:#888888;stroke-width:0"),p.setAttribute("fill-opacity","0.5"),a.append(p),(n=this.map)==null||n.getCanvasContainer().appendChild(a),this.svgCanvas=a,this.svgPath=p}mapResize(){this.generateCutOut()}updateArea(t,r){this.width=t,this.height=r,this.unit=Am.mm,this.generateCutOut()}generateCutOut(){var t,r;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const i=this.toPixels(this.width),n=this.toPixels(this.height),s=(t=this.map)==null?void 0:t.getCanvas().clientWidth,c=(r=this.map)==null?void 0:r.getCanvas().clientHeight,a=s/2-i/2,p=a+i,_=c/2-n/2,w=_+n;this.svgCanvas.setAttribute("width",`${s}px`),this.svgCanvas.setAttribute("height",`${c}px`),this.svgPath.setAttribute("d",`M 0 0 L ${s} 0 L ${s} ${c} L 0 ${c} M ${a} ${_} L ${a} ${w} L ${p} ${w} L ${p} ${_}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===Am.mm&&(r/=25.4),r*t}}const Bk={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate",LanguageName:"English",LanguageCode:"en"},wet={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Gnrer",LanguageName:"Franais",LanguageCode:"fr"},xet={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi",LanguageName:"Suomalainen",LanguageCode:"fi"},Aet={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflsung",Generate:"Erstellen",LanguageName:"Deutsch",LanguageCode:"de"},Eet={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera",LanguageName:"Svenska",LanguageCode:"sv"},Tet={PageSize:"Tamao de pgina",PageOrientation:"Orientacin de pgina",Format:"Formato",DPI:"DPI",Generate:"Generar",LanguageName:"Espaola",LanguageCode:"es"},Cet={PageSize:"Mida",PageOrientation:"Orientaci",Format:"Format",DPI:"DPI",Generate:"Genera",LanguageName:"Catalan",LanguageCode:"ca"},Pet={PageSize:"Kch thc trang",PageOrientation:"Loi trang",Format:"nh dng",DPI:"Mt  im nh (DPI)",Generate:"To",LanguageName:"Ting Vit",LanguageCode:"vi"},Iet={PageSize:" ",PageOrientation:" ",Format:"",DPI:"DPI",Generate:"",LanguageName:"",LanguageCode:"uk"},Let={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:"",LanguageName:"",LanguageCode:"zhHans"},Met={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:"",LanguageName:"",LanguageCode:"zhHant"},Bet={PageSize:"",PageOrientation:"",Format:"",DPI:"DPI",Generate:"",LanguageName:"",LanguageCode:"ja"},ket={PageSize:"Tamanho da pgina",PageOrientation:"Orientao da pgina",Format:"Formato",DPI:"DPI",Generate:"Gerar",LanguageName:"Portugus",LanguageCode:"pt"},Ret=[Bk,wet,xet,Aet,Eet,Tet,Cet,Pet,Iet,Let,Met,Bet,ket],Fet=e=>Ret.find(t=>t.LanguageCode===e)??Bk;(function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(i,n,s){r.o(i,n)||Object.defineProperty(i,n,{enumerable:!0,get:s})},r.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},r.t=function(i,n){if(1&n&&(i=r(i)),8&n||4&n&&typeof i=="object"&&i&&i.__esModule)return i;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:i}),2&n&&typeof i!="string")for(var c in i)r.d(s,c,(function(a){return i[a]}).bind(null,c));return s},r.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return r.d(n,"a",n),n},r.o=function(i,n){return Object.prototype.hasOwnProperty.call(i,n)},r.p="",r(r.s=0)})([function(e,t,r){e.exports=r(1)},function(e,t){function r(n,s){for(var c=0;c<s.length;c++){var a=s[c];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}var i=function(){function n(){(function(a,p){if(!(a instanceof p))throw new TypeError("Cannot call a class as a function")})(this,n),this.options={overlayBackgroundColor:"#666666",overlayOpacity:.6,spinnerIcon:"ball-circus",spinnerColor:"#000",spinnerSize:"3x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetY:0,offsetX:0,lockScroll:!1,containerID:null,spinnerZIndex:99999,overlayZIndex:99998},this.stylesheetBaseURL="https://cdn.jsdelivr.net/npm/load-awesome@1.1.0/css/",this.spinner=null,this.spinnerStylesheetURL=null,this.numberOfEmptyDivForSpinner={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":1,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1}}var s,c;return s=n,(c=[{key:"show",value:function(a){this.setOptions(a),this.addSpinnerStylesheet(),this.generateSpinnerElement(),this.options.lockScroll&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),this.generateAndAddOverlayElement()}},{key:"hide",value:function(){this.options.lockScroll&&(document.body.style.overflow="",document.documentElement.style.overflow="");var a=document.getElementById("loading-overlay-stylesheet");a&&(a.disabled=!0,a.parentNode.removeChild(a),document.getElementById(this.options.overlayIDName).remove(),document.getElementById(this.options.spinnerIDName).remove())}},{key:"setOptions",value:function(a){if(a!==void 0)for(var p in a)this.options[p]=a[p]}},{key:"generateAndAddOverlayElement",value:function(){var a="50%";this.options.offsetX!==0&&(a="calc(50% + "+this.options.offsetX+")");var p="50%";if(this.options.offsetY!==0&&(p="calc(50% + "+this.options.offsetY+")"),this.options.containerID&&document.body.contains(document.getElementById(this.options.containerID))){var _='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: absolute; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,'; z-index: 50; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: absolute; top: ').concat(p,"; left: ").concat(a,'; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: 9999;">').concat(this.spinner,"</div>"),w=document.getElementById(this.options.containerID);return w.style.position="relative",void w.insertAdjacentHTML("beforeend",_)}var S='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: fixed; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,"; z-index: ").concat(this.options.overlayZIndex,'; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: fixed; top: ').concat(p,"; left: ").concat(a,"; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: ").concat(this.options.spinnerZIndex,';">').concat(this.spinner,"</div>");document.body.insertAdjacentHTML("beforeend",S)}},{key:"generateSpinnerElement",value:function(){var a=this,p=Object.keys(this.numberOfEmptyDivForSpinner).find(function(w){return w===a.options.spinnerIcon}),_=this.generateEmptyDivElement(this.numberOfEmptyDivForSpinner[p]);this.spinner='<div style="color: '.concat(this.options.spinnerColor,'" class="la-').concat(this.options.spinnerIcon," la-").concat(this.options.spinnerSize,'">').concat(_,"</div>")}},{key:"addSpinnerStylesheet",value:function(){this.setSpinnerStylesheetURL();var a=document.createElement("link");a.setAttribute("id","loading-overlay-stylesheet"),a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href",this.spinnerStylesheetURL),document.getElementsByTagName("head")[0].appendChild(a)}},{key:"setSpinnerStylesheetURL",value:function(){this.spinnerStylesheetURL=this.stylesheetBaseURL+this.options.spinnerIcon+".min.css"}},{key:"generateEmptyDivElement",value:function(a){for(var p="",_=1;_<=a;_++)p+="<div></div>";return p}}])&&r(s.prototype,c),n}();window.JsLoadingOverlay=new i,e.exports=JsLoadingOverlay}]);function Ui(e){"@babel/helpers - typeof";return Ui=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ui(e)}var xa=Uint8Array,Ko=Uint16Array,k0=Uint32Array,wv=new xa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),xv=new xa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),qx=new xa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),kk=function(e,t){for(var r=new Ko(31),i=0;i<31;++i)r[i]=t+=1<<e[i-1];for(var n=new k0(r[30]),i=1;i<30;++i)for(var s=r[i];s<r[i+1];++s)n[s]=s-r[i]<<5|i;return[r,n]},Rk=kk(wv,2),Fk=Rk[0],Hx=Rk[1];Fk[28]=258,Hx[258]=28;var Dk=kk(xv,0),Det=Dk[0],RI=Dk[1],$x=new Ko(32768);for(var mn=0;mn<32768;++mn){var Kh=(mn&43690)>>>1|(mn&21845)<<1;Kh=(Kh&52428)>>>2|(Kh&13107)<<2,Kh=(Kh&61680)>>>4|(Kh&3855)<<4,$x[mn]=((Kh&65280)>>>8|(Kh&255)<<8)>>>1}var Tu=function(e,t,r){for(var i=e.length,n=0,s=new Ko(t);n<i;++n)++s[e[n]-1];var c=new Ko(t);for(n=0;n<t;++n)c[n]=c[n-1]+s[n-1]<<1;var a;if(r){a=new Ko(1<<t);var p=15-t;for(n=0;n<i;++n)if(e[n])for(var _=n<<4|e[n],w=t-e[n],S=c[e[n]-1]++<<w,C=S|(1<<w)-1;S<=C;++S)a[$x[S]>>>p]=_}else for(a=new Ko(i),n=0;n<i;++n)a[n]=$x[c[e[n]-1]++]>>>15-e[n];return a},Ed=new xa(288);for(var mn=0;mn<144;++mn)Ed[mn]=8;for(var mn=144;mn<256;++mn)Ed[mn]=9;for(var mn=256;mn<280;++mn)Ed[mn]=7;for(var mn=280;mn<288;++mn)Ed[mn]=8;var R0=new xa(32);for(var mn=0;mn<32;++mn)R0[mn]=5;var Net=Tu(Ed,9,0),Oet=Tu(Ed,9,1),zet=Tu(R0,5,0),jet=Tu(R0,5,1),q2=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},cc=function(e,t,r){var i=t/8>>0;return(e[i]|e[i+1]<<8)>>>(t&7)&r},H2=function(e,t){var r=t/8>>0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>>(t&7)},w3=function(e){return(e/8>>0)+(e&7&&1)},Nk=function(e,t,r){(r==null||r>e.length)&&(r=e.length);var i=new(e instanceof Ko?Ko:e instanceof k0?k0:xa)(r-t);return i.set(e.subarray(t,r)),i},Uet=function(e,t,r){var i=e.length,n=!t||r,s=!r||r.i;r||(r={}),t||(t=new xa(i*3));var c=function(qt){var $t=t.length;if(qt>$t){var Qt=new xa(Math.max($t*2,qt));Qt.set(t),t=Qt}},a=r.f||0,p=r.p||0,_=r.b||0,w=r.l,S=r.d,C=r.m,I=r.n,N=i*8;do{if(!w){r.f=a=cc(e,p,1);var F=cc(e,p+1,3);if(p+=3,F)if(F==1)w=Oet,S=jet,C=9,I=5;else if(F==2){var W=cc(e,p,31)+257,U=cc(e,p+10,15)+4,z=W+cc(e,p+5,31)+1;p+=14;for(var H=new xa(z),nt=new xa(19),yt=0;yt<U;++yt)nt[qx[yt]]=cc(e,p+yt*3,7);p+=U*3;var bt=q2(nt),vt=(1<<bt)-1;if(!s&&p+z*(bt+7)>N)break;for(var mt=Tu(nt,bt,1),yt=0;yt<z;){var Dt=mt[cc(e,p,vt)];p+=Dt&15;var kt=Dt>>>4;if(kt<16)H[yt++]=kt;else{var at=0,dt=0;for(kt==16?(dt=3+cc(e,p,3),p+=2,at=H[yt-1]):kt==17?(dt=3+cc(e,p,7),p+=3):kt==18&&(dt=11+cc(e,p,127),p+=7);dt--;)H[yt++]=at}}var It=H.subarray(0,W),xt=H.subarray(W);C=q2(It),I=q2(xt),w=Tu(It,C,1),S=Tu(xt,I,1)}else throw"invalid block type";else{var kt=w3(p)+4,re=e[kt-4]|e[kt-3]<<8,ee=kt+re;if(ee>i){if(s)throw"unexpected EOF";break}n&&c(_+re),t.set(e.subarray(kt,ee),_),r.b=_+=re,r.p=p=ee*8;continue}if(p>N)throw"unexpected EOF"}n&&c(_+131072);for(var se=(1<<C)-1,Ot=(1<<I)-1,Xt=C+I+18;s||p+Xt<N;){var at=w[H2(e,p)&se],Wt=at>>>4;if(p+=at&15,p>N)throw"unexpected EOF";if(!at)throw"invalid length/literal";if(Wt<256)t[_++]=Wt;else if(Wt==256){w=null;break}else{var xe=Wt-254;if(Wt>264){var yt=Wt-257,it=wv[yt];xe=cc(e,p,(1<<it)-1)+Fk[yt],p+=it}var Et=S[H2(e,p)&Ot],Pt=Et>>>4;if(!Et)throw"invalid distance";p+=Et&15;var xt=Det[Pt];if(Pt>3){var it=xv[Pt];xt+=H2(e,p)&(1<<it)-1,p+=it}if(p>N)throw"unexpected EOF";n&&c(_+131072);for(var jt=_+xe;_<jt;_+=4)t[_]=t[_-xt],t[_+1]=t[_+1-xt],t[_+2]=t[_+2-xt],t[_+3]=t[_+3-xt];_=jt}}r.l=w,r.p=p,r.b=_,w&&(a=1,r.m=C,r.d=S,r.n=I)}while(!a);return _==t.length?t:Nk(t,0,_)},th=function(e,t,r){r<<=t&7;var i=t/8>>0;e[i]|=r,e[i+1]|=r>>>8},Ig=function(e,t,r){r<<=t&7;var i=t/8>>0;e[i]|=r,e[i+1]|=r>>>8,e[i+2]|=r>>>16},$2=function(e,t){for(var r=[],i=0;i<e.length;++i)e[i]&&r.push({s:i,f:e[i]});var n=r.length,s=r.slice();if(!n)return[new xa(0),0];if(n==1){var c=new xa(r[0].s+1);return c[r[0].s]=1,[c,1]}r.sort(function(yt,bt){return yt.f-bt.f}),r.push({s:-1,f:25001});var a=r[0],p=r[1],_=0,w=1,S=2;for(r[0]={s:-1,f:a.f+p.f,l:a,r:p};w!=n-1;)a=r[r[_].f<r[S].f?_++:S++],p=r[_!=w&&r[_].f<r[S].f?_++:S++],r[w++]={s:-1,f:a.f+p.f,l:a,r:p};for(var C=s[0].s,i=1;i<n;++i)s[i].s>C&&(C=s[i].s);var I=new Ko(C+1),N=Wx(r[w-1],I,0);if(N>t){var i=0,F=0,W=N-t,U=1<<W;for(s.sort(function(bt,vt){return I[vt.s]-I[bt.s]||bt.f-vt.f});i<n;++i){var z=s[i].s;if(I[z]>t)F+=U-(1<<N-I[z]),I[z]=t;else break}for(F>>>=W;F>0;){var H=s[i].s;I[H]<t?F-=1<<t-I[H]++-1:++i}for(;i>=0&&F;--i){var nt=s[i].s;I[nt]==t&&(--I[nt],++F)}N=t}return[new xa(I),N]},Wx=function(e,t,r){return e.s==-1?Math.max(Wx(e.l,t,r+1),Wx(e.r,t,r+1)):t[e.s]=r},FI=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new Ko(++t),i=0,n=e[0],s=1,c=function(p){r[i++]=p},a=1;a<=t;++a)if(e[a]==n&&a!=t)++s;else{if(!n&&s>2){for(;s>138;s-=138)c(32754);s>2&&(c(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(c(n),--s;s>6;s-=6)c(8304);s>2&&(c(s-3<<5|8208),s=0)}for(;s--;)c(n);s=1,n=e[a]}return[r.subarray(0,i),t]},Lg=function(e,t){for(var r=0,i=0;i<t.length;++i)r+=e[i]*t[i];return r},Xx=function(e,t,r){var i=r.length,n=w3(t+2);e[n]=i&255,e[n+1]=i>>>8,e[n+2]=e[n]^255,e[n+3]=e[n+1]^255;for(var s=0;s<i;++s)e[n+s+4]=r[s];return(n+4+i)*8},DI=function(e,t,r,i,n,s,c,a,p,_,w){th(t,w++,r),++n[256];for(var S=$2(n,15),C=S[0],I=S[1],N=$2(s,15),F=N[0],W=N[1],U=FI(C),z=U[0],H=U[1],nt=FI(F),yt=nt[0],bt=nt[1],vt=new Ko(19),mt=0;mt<z.length;++mt)vt[z[mt]&31]++;for(var mt=0;mt<yt.length;++mt)vt[yt[mt]&31]++;for(var Dt=$2(vt,7),kt=Dt[0],at=Dt[1],dt=19;dt>4&&!kt[qx[dt-1]];--dt);var It=_+5<<3,xt=Lg(n,Ed)+Lg(s,R0)+c,re=Lg(n,C)+Lg(s,F)+c+14+3*dt+Lg(vt,kt)+(2*vt[16]+3*vt[17]+7*vt[18]);if(It<=xt&&It<=re)return Xx(t,w,e.subarray(p,p+_));var ee,se,Ot,Xt;if(th(t,w,1+(re<xt)),w+=2,re<xt){ee=Tu(C,I,0),se=C,Ot=Tu(F,W,0),Xt=F;var Wt=Tu(kt,at,0);th(t,w,H-257),th(t,w+5,bt-1),th(t,w+10,dt-4),w+=14;for(var mt=0;mt<dt;++mt)th(t,w+3*mt,kt[qx[mt]]);w+=3*dt;for(var xe=[z,yt],it=0;it<2;++it)for(var Et=xe[it],mt=0;mt<Et.length;++mt){var Pt=Et[mt]&31;th(t,w,Wt[Pt]),w+=kt[Pt],Pt>15&&(th(t,w,Et[mt]>>>5&127),w+=Et[mt]>>>12)}}else ee=Net,se=Ed,Ot=zet,Xt=R0;for(var mt=0;mt<a;++mt)if(i[mt]>255){var Pt=i[mt]>>>18&31;Ig(t,w,ee[Pt+257]),w+=se[Pt+257],Pt>7&&(th(t,w,i[mt]>>>23&31),w+=wv[Pt]);var jt=i[mt]&31;Ig(t,w,Ot[jt]),w+=Xt[jt],jt>3&&(Ig(t,w,i[mt]>>>5&8191),w+=xv[jt])}else Ig(t,w,ee[i[mt]]),w+=se[i[mt]];return Ig(t,w,ee[256]),w+se[256]},Get=new k0([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Vet=function(e,t,r,i,n,s){var c=e.length,a=new xa(i+c+5*(1+Math.floor(c/7e3))+n),p=a.subarray(i,a.length-n),_=0;if(!t||c<8)for(var w=0;w<=c;w+=65535){var S=w+65535;S<c?_=Xx(p,_,e.subarray(w,S)):(p[w]=s,_=Xx(p,_,e.subarray(w,c)))}else{for(var C=Get[t-1],I=C>>>13,N=C&8191,F=(1<<r)-1,W=new Ko(32768),U=new Ko(F+1),z=Math.ceil(r/3),H=2*z,nt=function(or){return(e[or]^e[or+1]<<z^e[or+2]<<H)&F},yt=new k0(25e3),bt=new Ko(288),vt=new Ko(32),mt=0,Dt=0,w=0,kt=0,at=0,dt=0;w<c;++w){var It=nt(w),xt=w&32767,re=U[It];if(W[xt]=re,U[It]=xt,at<=w){var ee=c-w;if((mt>7e3||kt>24576)&&ee>423){_=DI(e,p,0,yt,bt,vt,Dt,kt,dt,w-dt,_),kt=mt=Dt=0,dt=w;for(var se=0;se<286;++se)bt[se]=0;for(var se=0;se<30;++se)vt[se]=0}var Ot=2,Xt=0,Wt=N,xe=xt-re&32767;if(ee>2&&It==nt(w-xe))for(var it=Math.min(I,ee)-1,Et=Math.min(32767,w),Pt=Math.min(258,ee);xe<=Et&&--Wt&&xt!=re;){if(e[w+Ot]==e[w+Ot-xe]){for(var jt=0;jt<Pt&&e[w+jt]==e[w+jt-xe];++jt);if(jt>Ot){if(Ot=jt,Xt=xe,jt>it)break;for(var qt=Math.min(xe,jt-2),$t=0,se=0;se<qt;++se){var Qt=w-xe+se+32768&32767,Kt=W[Qt],Ee=Qt-Kt+32768&32767;Ee>$t&&($t=Ee,re=Qt)}}}xt=re,re=W[xt],xe+=xt-re+32768&32767}if(Xt){yt[kt++]=268435456|Hx[Ot]<<18|RI[Xt];var Me=Hx[Ot]&31,De=RI[Xt]&31;Dt+=wv[Me]+xv[De],++bt[257+Me],++vt[De],at=w+Ot,++mt}else yt[kt++]=e[w],++bt[e[w]]}}_=DI(e,p,s,yt,bt,vt,Dt,kt,dt,w-dt,_)}return Nk(a,0,i+w3(_)+n)},qet=function(){var e=1,t=0;return{p:function(r){for(var i=e,n=t,s=r.length,c=0;c!=s;){for(var a=Math.min(c+5552,s);c<a;++c)i+=r[c],n+=i;i%=65521,n%=65521}e=i,t=n},d:function(){return(e>>>8<<16|(t&255)<<8|t>>>8)+((e&255)<<23)*2}}},Het=function(e,t,r,i,n){return Vet(e,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):12+t.mem,r,i,!n)},$et=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},Wet=function(e,t){var r=t.level,i=r==0?0:r<6?1:r==9?3:2;e[0]=120,e[1]=i<<6|(i?32-2*i:1)},Xet=function(e){if((e[0]&15)!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(e[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Zx(e,t){t===void 0&&(t={});var r=qet();r.p(e);var i=Het(e,t,2,4);return Wet(i,t),$et(i,i.length-4,r.d()),i}function Zet(e,t){return Uet((Xet(e),e.subarray(2,-4)),t)}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.1 Built on 2022-01-28T15:37:57.791Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Hollnder <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var Rr=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function W2(){Rr.console&&typeof Rr.console.log=="function"&&Rr.console.log.apply(Rr.console,arguments)}var Ji={log:W2,warn:function(e){Rr.console&&(typeof Rr.console.warn=="function"?Rr.console.warn.apply(Rr.console,arguments):W2.call(null,arguments))},error:function(e){Rr.console&&(typeof Rr.console.error=="function"?Rr.console.error.apply(Rr.console,arguments):W2(e))}};function X2(e,t,r){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){op(i.response,t,r)},i.onerror=function(){Ji.error("could not download file")},i.send()}function NI(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function fy(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var n0,Yx,op=Rr.saveAs||((typeof window>"u"?"undefined":Ui(window))!=="object"||window!==Rr?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(e,t,r){var i=Rr.URL||Rr.webkitURL,n=document.createElement("a");t=t||e.name||"download",n.download=t,n.rel="noopener",typeof e=="string"?(n.href=e,n.origin!==location.origin?NI(n.href)?X2(e,t,r):fy(n,n.target="_blank"):fy(n)):(n.href=i.createObjectURL(e),setTimeout(function(){i.revokeObjectURL(n.href)},4e4),setTimeout(function(){fy(n)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){if(t=t||e.name||"download",typeof e=="string")if(NI(e))X2(e,t,r);else{var i=document.createElement("a");i.href=e,i.target="_blank",setTimeout(function(){fy(i)})}else navigator.msSaveOrOpenBlob(function(n,s){return s===void 0?s={autoBom:!1}:Ui(s)!=="object"&&(Ji.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}(e,r),t)}:function(e,t,r,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),typeof e=="string")return X2(e,t,r);var n=e.type==="application/octet-stream",s=/constructor/i.test(Rr.HTMLElement)||Rr.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||n&&s)&&(typeof FileReader>"u"?"undefined":Ui(FileReader))==="object"){var a=new FileReader;a.onloadend=function(){var w=a.result;w=c?w:w.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=w:location=w,i=null},a.readAsDataURL(e)}else{var p=Rr.URL||Rr.webkitURL,_=p.createObjectURL(e);i?i.location=_:location.href=_,i=null,setTimeout(function(){p.revokeObjectURL(_)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function Ok(e){var t;e=e||"",this.ok=!1,e.charAt(0)=="#"&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}],i=0;i<r.length;i++){var n=r[i].re,s=r[i].process,c=n.exec(e);c&&(t=s(c),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var a=this.r.toString(16),p=this.g.toString(16),_=this.b.toString(16);return a.length==1&&(a="0"+a),p.length==1&&(p="0"+p),_.length==1&&(_="0"+_),"#"+a+p+_}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function Z2(e,t){var r=e[0],i=e[1],n=e[2],s=e[3];r=wo(r,i,n,s,t[0],7,-680876936),s=wo(s,r,i,n,t[1],12,-389564586),n=wo(n,s,r,i,t[2],17,606105819),i=wo(i,n,s,r,t[3],22,-1044525330),r=wo(r,i,n,s,t[4],7,-176418897),s=wo(s,r,i,n,t[5],12,1200080426),n=wo(n,s,r,i,t[6],17,-1473231341),i=wo(i,n,s,r,t[7],22,-45705983),r=wo(r,i,n,s,t[8],7,1770035416),s=wo(s,r,i,n,t[9],12,-1958414417),n=wo(n,s,r,i,t[10],17,-42063),i=wo(i,n,s,r,t[11],22,-1990404162),r=wo(r,i,n,s,t[12],7,1804603682),s=wo(s,r,i,n,t[13],12,-40341101),n=wo(n,s,r,i,t[14],17,-1502002290),r=xo(r,i=wo(i,n,s,r,t[15],22,1236535329),n,s,t[1],5,-165796510),s=xo(s,r,i,n,t[6],9,-1069501632),n=xo(n,s,r,i,t[11],14,643717713),i=xo(i,n,s,r,t[0],20,-373897302),r=xo(r,i,n,s,t[5],5,-701558691),s=xo(s,r,i,n,t[10],9,38016083),n=xo(n,s,r,i,t[15],14,-660478335),i=xo(i,n,s,r,t[4],20,-405537848),r=xo(r,i,n,s,t[9],5,568446438),s=xo(s,r,i,n,t[14],9,-1019803690),n=xo(n,s,r,i,t[3],14,-187363961),i=xo(i,n,s,r,t[8],20,1163531501),r=xo(r,i,n,s,t[13],5,-1444681467),s=xo(s,r,i,n,t[2],9,-51403784),n=xo(n,s,r,i,t[7],14,1735328473),r=So(r,i=xo(i,n,s,r,t[12],20,-1926607734),n,s,t[5],4,-378558),s=So(s,r,i,n,t[8],11,-2022574463),n=So(n,s,r,i,t[11],16,1839030562),i=So(i,n,s,r,t[14],23,-35309556),r=So(r,i,n,s,t[1],4,-1530992060),s=So(s,r,i,n,t[4],11,1272893353),n=So(n,s,r,i,t[7],16,-155497632),i=So(i,n,s,r,t[10],23,-1094730640),r=So(r,i,n,s,t[13],4,681279174),s=So(s,r,i,n,t[0],11,-358537222),n=So(n,s,r,i,t[3],16,-722521979),i=So(i,n,s,r,t[6],23,76029189),r=So(r,i,n,s,t[9],4,-640364487),s=So(s,r,i,n,t[12],11,-421815835),n=So(n,s,r,i,t[15],16,530742520),r=Ao(r,i=So(i,n,s,r,t[2],23,-995338651),n,s,t[0],6,-198630844),s=Ao(s,r,i,n,t[7],10,1126891415),n=Ao(n,s,r,i,t[14],15,-1416354905),i=Ao(i,n,s,r,t[5],21,-57434055),r=Ao(r,i,n,s,t[12],6,1700485571),s=Ao(s,r,i,n,t[3],10,-1894986606),n=Ao(n,s,r,i,t[10],15,-1051523),i=Ao(i,n,s,r,t[1],21,-2054922799),r=Ao(r,i,n,s,t[8],6,1873313359),s=Ao(s,r,i,n,t[15],10,-30611744),n=Ao(n,s,r,i,t[6],15,-1560198380),i=Ao(i,n,s,r,t[13],21,1309151649),r=Ao(r,i,n,s,t[4],6,-145523070),s=Ao(s,r,i,n,t[11],10,-1120210379),n=Ao(n,s,r,i,t[2],15,718787259),i=Ao(i,n,s,r,t[9],21,-343485551),e[0]=cd(r,e[0]),e[1]=cd(i,e[1]),e[2]=cd(n,e[2]),e[3]=cd(s,e[3])}function Sv(e,t,r,i,n,s){return t=cd(cd(t,e),cd(i,s)),cd(t<<n|t>>>32-n,r)}function wo(e,t,r,i,n,s,c){return Sv(t&r|~t&i,e,t,n,s,c)}function xo(e,t,r,i,n,s,c){return Sv(t&i|r&~i,e,t,n,s,c)}function So(e,t,r,i,n,s,c){return Sv(t^r^i,e,t,n,s,c)}function Ao(e,t,r,i,n,s,c){return Sv(r^(t|~i),e,t,n,s,c)}function zk(e){var t,r=e.length,i=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)Z2(i,Yet(e.substring(t-64,t)));e=e.substring(t-64);var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)n[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(Z2(i,n),t=0;t<16;t++)n[t]=0;return n[14]=8*r,Z2(i,n),i}function Yet(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}n0=Rr.atob.bind(Rr),Yx=Rr.btoa.bind(Rr);var OI="0123456789abcdef".split("");function Jet(e){for(var t="",r=0;r<4;r++)t+=OI[e>>8*r+4&15]+OI[e>>8*r&15];return t}function Ket(e){return String.fromCharCode((255&e)>>0,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function Jx(e){return zk(e).map(Ket).join("")}var Qet=function(e){for(var t=0;t<e.length;t++)e[t]=Jet(e[t]);return e.join("")}(zk("hello"))!="5d41402abc4b2a76b9719d911017c592";function cd(e,t){if(Qet){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}return e+t&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function Kx(e,t){var r,i,n,s;if(e!==r){for(var c=(n=e,s=1+(256/e.length>>0),new Array(s+1).join(n)),a=[],p=0;p<256;p++)a[p]=p;var _=0;for(p=0;p<256;p++){var w=a[p];_=(_+w+c.charCodeAt(p))%256,a[p]=a[_],a[_]=w}r=e,i=a}else a=i;var S=t.length,C=0,I=0,N="";for(p=0;p<S;p++)I=(I+(w=a[C=(C+1)%256]))%256,a[C]=a[I],a[I]=w,c=a[(a[C]+a[I])%256],N+=String.fromCharCode(t.charCodeAt(p)^c);return N}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var zI={print:4,modify:8,copy:16,"annot-forms":32};function Af(e,t,r,i){this.v=1,this.r=2;var n=192;e.forEach(function(a){if(zI.perm!==void 0)throw new Error("Invalid permission: "+a);n+=zI[a]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var s=(t+this.padding).substr(0,32),c=(r+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,c),this.P=-(1+(255^n)),this.encryptionKey=Jx(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(i)).substr(0,5),this.U=Kx(this.encryptionKey,this.padding)}function Ef(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",r=e.length,i=0;i<r;i++){var n=e.charCodeAt(i);n<33||n===35||n===37||n===40||n===41||n===47||n===60||n===62||n===91||n===93||n===123||n===125||n>126?t+="#"+("0"+n.toString(16)).slice(-2):t+=e[i]}return t}function jI(e){if(Ui(e)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(r,i,n){if(n=n||!1,typeof r!="string"||typeof i!="function"||typeof n!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(r)||(t[r]={});var s=Math.random().toString(35);return t[r][s]=[i,!!n],s},this.unsubscribe=function(r){for(var i in t)if(t[i][r])return delete t[i][r],Object.keys(t[i]).length===0&&delete t[i],!0;return!1},this.publish=function(r){if(t.hasOwnProperty(r)){var i=Array.prototype.slice.call(arguments,1),n=[];for(var s in t[r]){var c=t[r][s];try{c[0].apply(e,i)}catch(a){Rr.console&&Ji.error("jsPDF PubSub Error",a.message,a)}c[1]&&n.push(s)}n.length&&n.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function U_(e){if(!(this instanceof U_))return new U_(e);var t="opacity,stroke-opacity".split(",");for(var r in e)e.hasOwnProperty(r)&&t.indexOf(r)>=0&&(this[r]=e[r]);this.id="",this.objectNumber=-1}function jk(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function cp(e,t,r,i,n){if(!(this instanceof cp))return new cp(e,t,r,i,n);this.type=e==="axial"?2:3,this.coords=t,this.colors=r,jk.call(this,i,n)}function Vf(e,t,r,i,n){if(!(this instanceof Vf))return new Vf(e,t,r,i,n);this.boundingBox=e,this.xStep=t,this.yStep=r,this.stream="",this.cloneIndex=0,jk.call(this,i,n)}function kr(e){var t,r=typeof arguments[0]=="string"?arguments[0]:"p",i=arguments[1],n=arguments[2],s=arguments[3],c=[],a=1,p=16,_="S",w=null;Ui(e=e||{})==="object"&&(r=e.orientation,i=e.unit||i,n=e.format||n,s=e.compress||e.compressPdf||s,(w=e.encryption||null)!==null&&(w.userPassword=w.userPassword||"",w.ownerPassword=w.ownerPassword||"",w.userPermissions=w.userPermissions||[]),a=typeof e.userUnit=="number"?Math.abs(e.userUnit):1,e.precision!==void 0&&(t=e.precision),e.floatPrecision!==void 0&&(p=e.floatPrecision),_=e.defaultPathOperation||"S"),c=e.filters||(s===!0?["FlateEncode"]:c),i=i||"mm",r=(""+(r||"P")).toLowerCase();var S=e.putOnlyUsedFonts||!1,C={},I={internal:{},__private__:{}};I.__private__.PubSub=jI;var N="1.3",F=I.__private__.getPdfVersion=function(){return N};I.__private__.setPdfVersion=function(R){N=R};var W={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};I.__private__.getPageFormats=function(){return W};var U=I.__private__.getPageFormat=function(R){return W[R]};n=n||"a4";var z={COMPAT:"compat",ADVANCED:"advanced"},H=z.COMPAT;function nt(){this.saveGraphicsState(),st(new Ft(Fe,0,0,-Fe,0,pl()*Fe).toString()+" cm"),this.setFontSize(this.getFontSize()/Fe),_="n",H=z.ADVANCED}function yt(){this.restoreGraphicsState(),_="S",H=z.COMPAT}var bt=I.__private__.combineFontStyleAndFontWeight=function(R,rt){if(R=="bold"&&rt=="normal"||R=="bold"&&rt==400||R=="normal"&&rt=="italic"||R=="bold"&&rt=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return rt&&(R=rt==400||rt==="normal"?R==="italic"?"italic":"normal":rt!=700&&rt!=="bold"||R!=="normal"?(rt==700?"bold":rt)+""+R:"bold"),R};I.advancedAPI=function(R){var rt=H===z.COMPAT;return rt&&nt.call(this),typeof R!="function"||(R(this),rt&&yt.call(this)),this},I.compatAPI=function(R){var rt=H===z.ADVANCED;return rt&&yt.call(this),typeof R!="function"||(R(this),rt&&nt.call(this)),this},I.isAdvancedAPI=function(){return H===z.ADVANCED};var vt,mt=function(R){if(H!==z.ADVANCED)throw new Error(R+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},Dt=I.roundToPrecision=I.__private__.roundToPrecision=function(R,rt){var Ct=t||rt;if(isNaN(R)||isNaN(Ct))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return R.toFixed(Ct).replace(/0+$/,"")};vt=I.hpf=I.__private__.hpf=typeof p=="number"?function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.hpf");return Dt(R,p)}:p==="smart"?function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.hpf");return Dt(R,R>-1&&R<1?16:5)}:function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.hpf");return Dt(R,16)};var kt=I.f2=I.__private__.f2=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.f2");return Dt(R,2)},at=I.__private__.f3=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.f3");return Dt(R,3)},dt=I.scale=I.__private__.scale=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.scale");return H===z.COMPAT?R*Fe:H===z.ADVANCED?R:void 0},It=function(R){return H===z.COMPAT?pl()-R:H===z.ADVANCED?R:void 0},xt=function(R){return dt(It(R))};I.__private__.setPrecision=I.setPrecision=function(R){typeof parseInt(R,10)=="number"&&(t=parseInt(R,10))};var re,ee="00000000000000000000000000000000",se=I.__private__.getFileId=function(){return ee},Ot=I.__private__.setFileId=function(R){return ee=R!==void 0&&/^[a-fA-F0-9]{32}$/.test(R)?R.toUpperCase():ee.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),w!==null&&(ii=new Af(w.userPermissions,w.userPassword,w.ownerPassword,ee)),ee};I.setFileId=function(R){return Ot(R),this},I.getFileId=function(){return se()};var Xt=I.__private__.convertDateToPDFDate=function(R){var rt=R.getTimezoneOffset(),Ct=rt<0?"+":"-",Ut=Math.floor(Math.abs(rt/60)),Yt=Math.abs(rt%60),ce=[Ct,Pt(Ut),"'",Pt(Yt),"'"].join("");return["D:",R.getFullYear(),Pt(R.getMonth()+1),Pt(R.getDate()),Pt(R.getHours()),Pt(R.getMinutes()),Pt(R.getSeconds()),ce].join("")},Wt=I.__private__.convertPDFDateToDate=function(R){var rt=parseInt(R.substr(2,4),10),Ct=parseInt(R.substr(6,2),10)-1,Ut=parseInt(R.substr(8,2),10),Yt=parseInt(R.substr(10,2),10),ce=parseInt(R.substr(12,2),10),Le=parseInt(R.substr(14,2),10);return new Date(rt,Ct,Ut,Yt,ce,Le,0)},xe=I.__private__.setCreationDate=function(R){var rt;if(R===void 0&&(R=new Date),R instanceof Date)rt=Xt(R);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(R))throw new Error("Invalid argument passed to jsPDF.setCreationDate");rt=R}return re=rt},it=I.__private__.getCreationDate=function(R){var rt=re;return R==="jsDate"&&(rt=Wt(re)),rt};I.setCreationDate=function(R){return xe(R),this},I.getCreationDate=function(R){return it(R)};var Et,Pt=I.__private__.padd2=function(R){return("0"+parseInt(R)).slice(-2)},jt=I.__private__.padd2Hex=function(R){return("00"+(R=R.toString())).substr(R.length)},qt=0,$t=[],Qt=[],Kt=0,Ee=[],Me=[],De=!1,ze=Qt,or=function(){qt=0,Kt=0,Qt=[],$t=[],Ee=[],Br=be(),tr=be()};I.__private__.setCustomOutputDestination=function(R){De=!0,ze=R};var le=function(R){De||(ze=R)};I.__private__.resetCustomOutputDestination=function(){De=!1,ze=Qt};var st=I.__private__.out=function(R){return R=R.toString(),Kt+=R.length+1,ze.push(R),ze},mr=I.__private__.write=function(R){return st(arguments.length===1?R.toString():Array.prototype.join.call(arguments," "))},Qe=I.__private__.getArrayBuffer=function(R){for(var rt=R.length,Ct=new ArrayBuffer(rt),Ut=new Uint8Array(Ct);rt--;)Ut[rt]=R.charCodeAt(rt);return Ct},de=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];I.__private__.getStandardFonts=function(){return de};var Te=e.fontSize||16;I.__private__.setFontSize=I.setFontSize=function(R){return Te=H===z.ADVANCED?R/Fe:R,this};var Be,Ne=I.__private__.getFontSize=I.getFontSize=function(){return H===z.COMPAT?Te:Te*Fe},rr=e.R2L||!1;I.__private__.setR2L=I.setR2L=function(R){return rr=R,this},I.__private__.getR2L=I.getR2L=function(){return rr};var Er,wr=I.__private__.setZoomMode=function(R){var rt=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(R))Be=R;else if(isNaN(R)){if(rt.indexOf(R)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+R+'" is not recognized.');Be=R}else Be=parseInt(R,10)};I.__private__.getZoomMode=function(){return Be};var Fr,Ur=I.__private__.setPageMode=function(R){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(R)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+R+'" is not recognized.');Er=R};I.__private__.getPageMode=function(){return Er};var me=I.__private__.setLayoutMode=function(R){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(R)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+R+'" is not recognized.');Fr=R};I.__private__.getLayoutMode=function(){return Fr},I.__private__.setDisplayMode=I.setDisplayMode=function(R,rt,Ct){return wr(R),me(rt),Ur(Ct),this};var hr={title:"",subject:"",author:"",keywords:"",creator:""};I.__private__.getDocumentProperty=function(R){if(Object.keys(hr).indexOf(R)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return hr[R]},I.__private__.getDocumentProperties=function(){return hr},I.__private__.setDocumentProperties=I.setProperties=I.setDocumentProperties=function(R){for(var rt in hr)hr.hasOwnProperty(rt)&&R[rt]&&(hr[rt]=R[rt]);return this},I.__private__.setDocumentProperty=function(R,rt){if(Object.keys(hr).indexOf(R)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return hr[R]=rt};var xr,Fe,wi,ge,br,Ge={},Hr={},Qi=[],je={},In={},si={},on={},an=null,At=0,J=[],Q=new jI(I),ut=e.hotfixes||[],wt={},Nt={},Vt=[],Ft=function R(rt,Ct,Ut,Yt,ce,Le){if(!(this instanceof R))return new R(rt,Ct,Ut,Yt,ce,Le);isNaN(rt)&&(rt=1),isNaN(Ct)&&(Ct=0),isNaN(Ut)&&(Ut=0),isNaN(Yt)&&(Yt=1),isNaN(ce)&&(ce=0),isNaN(Le)&&(Le=0),this._matrix=[rt,Ct,Ut,Yt,ce,Le]};Object.defineProperty(Ft.prototype,"sx",{get:function(){return this._matrix[0]},set:function(R){this._matrix[0]=R}}),Object.defineProperty(Ft.prototype,"shy",{get:function(){return this._matrix[1]},set:function(R){this._matrix[1]=R}}),Object.defineProperty(Ft.prototype,"shx",{get:function(){return this._matrix[2]},set:function(R){this._matrix[2]=R}}),Object.defineProperty(Ft.prototype,"sy",{get:function(){return this._matrix[3]},set:function(R){this._matrix[3]=R}}),Object.defineProperty(Ft.prototype,"tx",{get:function(){return this._matrix[4]},set:function(R){this._matrix[4]=R}}),Object.defineProperty(Ft.prototype,"ty",{get:function(){return this._matrix[5]},set:function(R){this._matrix[5]=R}}),Object.defineProperty(Ft.prototype,"a",{get:function(){return this._matrix[0]},set:function(R){this._matrix[0]=R}}),Object.defineProperty(Ft.prototype,"b",{get:function(){return this._matrix[1]},set:function(R){this._matrix[1]=R}}),Object.defineProperty(Ft.prototype,"c",{get:function(){return this._matrix[2]},set:function(R){this._matrix[2]=R}}),Object.defineProperty(Ft.prototype,"d",{get:function(){return this._matrix[3]},set:function(R){this._matrix[3]=R}}),Object.defineProperty(Ft.prototype,"e",{get:function(){return this._matrix[4]},set:function(R){this._matrix[4]=R}}),Object.defineProperty(Ft.prototype,"f",{get:function(){return this._matrix[5]},set:function(R){this._matrix[5]=R}}),Object.defineProperty(Ft.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Ft.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Ft.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Ft.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Ft.prototype.join=function(R){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(vt).join(R)},Ft.prototype.multiply=function(R){var rt=R.sx*this.sx+R.shy*this.shx,Ct=R.sx*this.shy+R.shy*this.sy,Ut=R.shx*this.sx+R.sy*this.shx,Yt=R.shx*this.shy+R.sy*this.sy,ce=R.tx*this.sx+R.ty*this.shx+this.tx,Le=R.tx*this.shy+R.ty*this.sy+this.ty;return new Ft(rt,Ct,Ut,Yt,ce,Le)},Ft.prototype.decompose=function(){var R=this.sx,rt=this.shy,Ct=this.shx,Ut=this.sy,Yt=this.tx,ce=this.ty,Le=Math.sqrt(R*R+rt*rt),$e=(R/=Le)*Ct+(rt/=Le)*Ut;Ct-=R*$e,Ut-=rt*$e;var _r=Math.sqrt(Ct*Ct+Ut*Ut);return $e/=_r,R*(Ut/=_r)<rt*(Ct/=_r)&&(R=-R,rt=-rt,$e=-$e,Le=-Le),{scale:new Ft(Le,0,0,_r,0,0),translate:new Ft(1,0,0,1,Yt,ce),rotate:new Ft(R,rt,-rt,R,0,0),skew:new Ft(1,0,$e,1,0,0)}},Ft.prototype.toString=function(R){return this.join(" ")},Ft.prototype.inversed=function(){var R=this.sx,rt=this.shy,Ct=this.shx,Ut=this.sy,Yt=this.tx,ce=this.ty,Le=1/(R*Ut-rt*Ct),$e=Ut*Le,_r=-rt*Le,Mr=-Ct*Le,Or=R*Le;return new Ft($e,_r,Mr,Or,-$e*Yt-Mr*ce,-_r*Yt-Or*ce)},Ft.prototype.applyToPoint=function(R){var rt=R.x*this.sx+R.y*this.shx+this.tx,Ct=R.x*this.shy+R.y*this.sy+this.ty;return new ro(rt,Ct)},Ft.prototype.applyToRectangle=function(R){var rt=this.applyToPoint(R),Ct=this.applyToPoint(new ro(R.x+R.w,R.y+R.h));return new jc(rt.x,rt.y,Ct.x-rt.x,Ct.y-rt.y)},Ft.prototype.clone=function(){var R=this.sx,rt=this.shy,Ct=this.shx,Ut=this.sy,Yt=this.tx,ce=this.ty;return new Ft(R,rt,Ct,Ut,Yt,ce)},I.Matrix=Ft;var Lt=I.matrixMult=function(R,rt){return rt.multiply(R)},ne=new Ft(1,0,0,1,0,0);I.unitMatrix=I.identityMatrix=ne;var ue=function(R,rt){if(!In[R]){var Ct=(rt instanceof cp?"Sh":"P")+(Object.keys(je).length+1).toString(10);rt.id=Ct,In[R]=Ct,je[Ct]=rt,Q.publish("addPattern",rt)}};I.ShadingPattern=cp,I.TilingPattern=Vf,I.addShadingPattern=function(R,rt){return mt("addShadingPattern()"),ue(R,rt),this},I.beginTilingPattern=function(R){mt("beginTilingPattern()"),Bu(R.boundingBox[0],R.boundingBox[1],R.boundingBox[2]-R.boundingBox[0],R.boundingBox[3]-R.boundingBox[1],R.matrix)},I.endTilingPattern=function(R,rt){mt("endTilingPattern()"),rt.stream=Me[Et].join(`
`),ue(R,rt),Q.publish("endTilingPattern",rt),Vt.pop().restore()};var Zt=I.__private__.newObject=function(){var R=be();return We(R,!0),R},be=I.__private__.newObjectDeferred=function(){return qt++,$t[qt]=function(){return Kt},qt},We=function(R,rt){return rt=typeof rt=="boolean"&&rt,$t[R]=Kt,rt&&st(R+" 0 obj"),R},Ke=I.__private__.newAdditionalObject=function(){var R={objId:be(),content:""};return Ee.push(R),R},Br=be(),tr=be(),Ir=I.__private__.decodeColorString=function(R){var rt=R.split(" ");if(rt.length!==2||rt[1]!=="g"&&rt[1]!=="G")rt.length===5&&(rt[4]==="k"||rt[4]==="K")&&(rt=[(1-rt[0])*(1-rt[3]),(1-rt[1])*(1-rt[3]),(1-rt[2])*(1-rt[3]),"r"]);else{var Ct=parseFloat(rt[0]);rt=[Ct,Ct,Ct,"r"]}for(var Ut="#",Yt=0;Yt<3;Yt++)Ut+=("0"+Math.floor(255*parseFloat(rt[Yt])).toString(16)).slice(-2);return Ut},Sr=I.__private__.encodeColorString=function(R){var rt;typeof R=="string"&&(R={ch1:R});var Ct=R.ch1,Ut=R.ch2,Yt=R.ch3,ce=R.ch4,Le=R.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Ct=="string"&&Ct.charAt(0)!=="#"){var $e=new Ok(Ct);if($e.ok)Ct=$e.toHex();else if(!/^\d*\.?\d*$/.test(Ct))throw new Error('Invalid color "'+Ct+'" passed to jsPDF.encodeColorString.')}if(typeof Ct=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Ct)&&(Ct="#"+Ct[1]+Ct[1]+Ct[2]+Ct[2]+Ct[3]+Ct[3]),typeof Ct=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Ct)){var _r=parseInt(Ct.substr(1),16);Ct=_r>>16&255,Ut=_r>>8&255,Yt=255&_r}if(Ut===void 0||ce===void 0&&Ct===Ut&&Ut===Yt)if(typeof Ct=="string")rt=Ct+" "+Le[0];else switch(R.precision){case 2:rt=kt(Ct/255)+" "+Le[0];break;case 3:default:rt=at(Ct/255)+" "+Le[0]}else if(ce===void 0||Ui(ce)==="object"){if(ce&&!isNaN(ce.a)&&ce.a===0)return rt=["1.","1.","1.",Le[1]].join(" ");if(typeof Ct=="string")rt=[Ct,Ut,Yt,Le[1]].join(" ");else switch(R.precision){case 2:rt=[kt(Ct/255),kt(Ut/255),kt(Yt/255),Le[1]].join(" ");break;default:case 3:rt=[at(Ct/255),at(Ut/255),at(Yt/255),Le[1]].join(" ")}}else if(typeof Ct=="string")rt=[Ct,Ut,Yt,ce,Le[2]].join(" ");else switch(R.precision){case 2:rt=[kt(Ct),kt(Ut),kt(Yt),kt(ce),Le[2]].join(" ");break;case 3:default:rt=[at(Ct),at(Ut),at(Yt),at(ce),Le[2]].join(" ")}return rt},oi=I.__private__.getFilters=function(){return c},Wr=I.__private__.putStream=function(R){var rt=(R=R||{}).data||"",Ct=R.filters||oi(),Ut=R.alreadyAppliedFilters||[],Yt=R.addLength1||!1,ce=rt.length,Le=R.objectId,$e=function(Zn){return Zn};if(w!==null&&Le===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");w!==null&&($e=ii.encryptor(Le,0));var _r={};Ct===!0&&(Ct=["FlateEncode"]);var Mr=R.additionalKeyValues||[],Or=(_r=kr.API.processDataByFilters!==void 0?kr.API.processDataByFilters(rt,Ct):{data:rt,reverseChain:[]}).reverseChain+(Array.isArray(Ut)?Ut.join(" "):Ut.toString());if(_r.data.length!==0&&(Mr.push({key:"Length",value:_r.data.length}),Yt===!0&&Mr.push({key:"Length1",value:ce})),Or.length!=0)if(Or.split("/").length-1==1)Mr.push({key:"Filter",value:Or});else{Mr.push({key:"Filter",value:"["+Or+"]"});for(var Vr=0;Vr<Mr.length;Vr+=1)if(Mr[Vr].key==="DecodeParms"){for(var Di=[],ln=0;ln<_r.reverseChain.split("/").length-1;ln+=1)Di.push("null");Di.push(Mr[Vr].value),Mr[Vr].value="["+Di.join(" ")+"]"}}st("<<");for(var zr=0;zr<Mr.length;zr++)st("/"+Mr[zr].key+" "+Mr[zr].value);st(">>"),_r.data.length!==0&&(st("stream"),st($e(_r.data)),st("endstream"))},dr=I.__private__.putPage=function(R){var rt=R.number,Ct=R.data,Ut=R.objId,Yt=R.contentsObjId;We(Ut,!0),st("<</Type /Page"),st("/Parent "+R.rootDictionaryObjId+" 0 R"),st("/Resources "+R.resourceDictionaryObjId+" 0 R"),st("/MediaBox ["+parseFloat(vt(R.mediaBox.bottomLeftX))+" "+parseFloat(vt(R.mediaBox.bottomLeftY))+" "+vt(R.mediaBox.topRightX)+" "+vt(R.mediaBox.topRightY)+"]"),R.cropBox!==null&&st("/CropBox ["+vt(R.cropBox.bottomLeftX)+" "+vt(R.cropBox.bottomLeftY)+" "+vt(R.cropBox.topRightX)+" "+vt(R.cropBox.topRightY)+"]"),R.bleedBox!==null&&st("/BleedBox ["+vt(R.bleedBox.bottomLeftX)+" "+vt(R.bleedBox.bottomLeftY)+" "+vt(R.bleedBox.topRightX)+" "+vt(R.bleedBox.topRightY)+"]"),R.trimBox!==null&&st("/TrimBox ["+vt(R.trimBox.bottomLeftX)+" "+vt(R.trimBox.bottomLeftY)+" "+vt(R.trimBox.topRightX)+" "+vt(R.trimBox.topRightY)+"]"),R.artBox!==null&&st("/ArtBox ["+vt(R.artBox.bottomLeftX)+" "+vt(R.artBox.bottomLeftY)+" "+vt(R.artBox.topRightX)+" "+vt(R.artBox.topRightY)+"]"),typeof R.userUnit=="number"&&R.userUnit!==1&&st("/UserUnit "+R.userUnit),Q.publish("putPage",{objId:Ut,pageContext:J[rt],pageNumber:rt,page:Ct}),st("/Contents "+Yt+" 0 R"),st(">>"),st("endobj");var ce=Ct.join(`
`);return H===z.ADVANCED&&(ce+=`
Q`),We(Yt,!0),Wr({data:ce,filters:oi(),objectId:Yt}),st("endobj"),Ut},Nr=I.__private__.putPages=function(){var R,rt,Ct=[];for(R=1;R<=At;R++)J[R].objId=be(),J[R].contentsObjId=be();for(R=1;R<=At;R++)Ct.push(dr({number:R,data:Me[R],objId:J[R].objId,contentsObjId:J[R].contentsObjId,mediaBox:J[R].mediaBox,cropBox:J[R].cropBox,bleedBox:J[R].bleedBox,trimBox:J[R].trimBox,artBox:J[R].artBox,userUnit:J[R].userUnit,rootDictionaryObjId:Br,resourceDictionaryObjId:tr}));We(Br,!0),st("<</Type /Pages");var Ut="/Kids [";for(rt=0;rt<At;rt++)Ut+=Ct[rt]+" 0 R ";st(Ut+"]"),st("/Count "+At),st(">>"),st("endobj"),Q.publish("postPutPages")},ei=function(R){Q.publish("putFont",{font:R,out:st,newObject:Zt,putStream:Wr}),R.isAlreadyPutted!==!0&&(R.objectNumber=Zt(),st("<<"),st("/Type /Font"),st("/BaseFont /"+Ef(R.postScriptName)),st("/Subtype /Type1"),typeof R.encoding=="string"&&st("/Encoding /"+R.encoding),st("/FirstChar 32"),st("/LastChar 255"),st(">>"),st("endobj"))},yi=function(){for(var R in Ge)Ge.hasOwnProperty(R)&&(S===!1||S===!0&&C.hasOwnProperty(R))&&ei(Ge[R])},Pi=function(R){R.objectNumber=Zt();var rt=[];rt.push({key:"Type",value:"/XObject"}),rt.push({key:"Subtype",value:"/Form"}),rt.push({key:"BBox",value:"["+[vt(R.x),vt(R.y),vt(R.x+R.width),vt(R.y+R.height)].join(" ")+"]"}),rt.push({key:"Matrix",value:"["+R.matrix.toString()+"]"});var Ct=R.pages[1].join(`
`);Wr({data:Ct,additionalKeyValues:rt,objectId:R.objectNumber}),st("endobj")},tn=function(){for(var R in wt)wt.hasOwnProperty(R)&&Pi(wt[R])},Bo=function(R,rt){var Ct,Ut=[],Yt=1/(rt-1);for(Ct=0;Ct<1;Ct+=Yt)Ut.push(Ct);if(Ut.push(1),R[0].offset!=0){var ce={offset:0,color:R[0].color};R.unshift(ce)}if(R[R.length-1].offset!=1){var Le={offset:1,color:R[R.length-1].color};R.push(Le)}for(var $e="",_r=0,Mr=0;Mr<Ut.length;Mr++){for(Ct=Ut[Mr];Ct>R[_r+1].offset;)_r++;var Or=R[_r].offset,Vr=(Ct-Or)/(R[_r+1].offset-Or),Di=R[_r].color,ln=R[_r+1].color;$e+=jt(Math.round((1-Vr)*Di[0]+Vr*ln[0]).toString(16))+jt(Math.round((1-Vr)*Di[1]+Vr*ln[1]).toString(16))+jt(Math.round((1-Vr)*Di[2]+Vr*ln[2]).toString(16))}return $e.trim()},Jr=function(R,rt){rt||(rt=21);var Ct=Zt(),Ut=Bo(R.colors,rt),Yt=[];Yt.push({key:"FunctionType",value:"0"}),Yt.push({key:"Domain",value:"[0.0 1.0]"}),Yt.push({key:"Size",value:"["+rt+"]"}),Yt.push({key:"BitsPerSample",value:"8"}),Yt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Yt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Wr({data:Ut,additionalKeyValues:Yt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Ct}),st("endobj"),R.objectNumber=Zt(),st("<< /ShadingType "+R.type),st("/ColorSpace /DeviceRGB");var ce="/Coords ["+vt(parseFloat(R.coords[0]))+" "+vt(parseFloat(R.coords[1]))+" ";R.type===2?ce+=vt(parseFloat(R.coords[2]))+" "+vt(parseFloat(R.coords[3])):ce+=vt(parseFloat(R.coords[2]))+" "+vt(parseFloat(R.coords[3]))+" "+vt(parseFloat(R.coords[4]))+" "+vt(parseFloat(R.coords[5])),st(ce+="]"),R.matrix&&st("/Matrix ["+R.matrix.toString()+"]"),st("/Function "+Ct+" 0 R"),st("/Extend [true true]"),st(">>"),st("endobj")},Ln=function(R,rt){var Ct=be(),Ut=Zt();rt.push({resourcesOid:Ct,objectOid:Ut}),R.objectNumber=Ut;var Yt=[];Yt.push({key:"Type",value:"/Pattern"}),Yt.push({key:"PatternType",value:"1"}),Yt.push({key:"PaintType",value:"1"}),Yt.push({key:"TilingType",value:"1"}),Yt.push({key:"BBox",value:"["+R.boundingBox.map(vt).join(" ")+"]"}),Yt.push({key:"XStep",value:vt(R.xStep)}),Yt.push({key:"YStep",value:vt(R.yStep)}),Yt.push({key:"Resources",value:Ct+" 0 R"}),R.matrix&&Yt.push({key:"Matrix",value:"["+R.matrix.toString()+"]"}),Wr({data:R.stream,additionalKeyValues:Yt,objectId:R.objectNumber}),st("endobj")},ls=function(R){var rt;for(rt in je)je.hasOwnProperty(rt)&&(je[rt]instanceof cp?Jr(je[rt]):je[rt]instanceof Vf&&Ln(je[rt],R))},ki=function(R){for(var rt in R.objectNumber=Zt(),st("<<"),R)switch(rt){case"opacity":st("/ca "+kt(R[rt]));break;case"stroke-opacity":st("/CA "+kt(R[rt]))}st(">>"),st("endobj")},Ri=function(){var R;for(R in si)si.hasOwnProperty(R)&&ki(si[R])},ko=function(){for(var R in st("/XObject <<"),wt)wt.hasOwnProperty(R)&&wt[R].objectNumber>=0&&st("/"+R+" "+wt[R].objectNumber+" 0 R");Q.publish("putXobjectDict"),st(">>")},Fi=function(){ii.oid=Zt(),st("<<"),st("/Filter /Standard"),st("/V "+ii.v),st("/R "+ii.r),st("/U <"+ii.toHexString(ii.U)+">"),st("/O <"+ii.toHexString(ii.O)+">"),st("/P "+ii.P),st(">>"),st("endobj")},Ii=function(){for(var R in st("/Font <<"),Ge)Ge.hasOwnProperty(R)&&(S===!1||S===!0&&C.hasOwnProperty(R))&&st("/"+R+" "+Ge[R].objectNumber+" 0 R");st(">>")},Ro=function(){if(Object.keys(je).length>0){for(var R in st("/Shading <<"),je)je.hasOwnProperty(R)&&je[R]instanceof cp&&je[R].objectNumber>=0&&st("/"+R+" "+je[R].objectNumber+" 0 R");Q.publish("putShadingPatternDict"),st(">>")}},cs=function(R){if(Object.keys(je).length>0){for(var rt in st("/Pattern <<"),je)je.hasOwnProperty(rt)&&je[rt]instanceof I.TilingPattern&&je[rt].objectNumber>=0&&je[rt].objectNumber<R&&st("/"+rt+" "+je[rt].objectNumber+" 0 R");Q.publish("putTilingPatternDict"),st(">>")}},xi=function(){if(Object.keys(si).length>0){var R;for(R in st("/ExtGState <<"),si)si.hasOwnProperty(R)&&si[R].objectNumber>=0&&st("/"+R+" "+si[R].objectNumber+" 0 R");Q.publish("putGStateDict"),st(">>")}},Kr=function(R){We(R.resourcesOid,!0),st("<<"),st("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),Ii(),Ro(),cs(R.objectOid),xi(),ko(),st(">>"),st("endobj")},bn=function(){var R=[];yi(),Ri(),tn(),ls(R),Q.publish("putResources"),R.forEach(Kr),Kr({resourcesOid:tr,objectOid:Number.MAX_SAFE_INTEGER}),Q.publish("postPutResources")},_i=function(){Q.publish("putAdditionalObjects");for(var R=0;R<Ee.length;R++){var rt=Ee[R];We(rt.objId,!0),st(rt.content),st("endobj")}Q.publish("postPutAdditionalObjects")},Fo=function(R){Hr[R.fontName]=Hr[R.fontName]||{},Hr[R.fontName][R.fontStyle]=R.id},wn=function(R,rt,Ct,Ut,Yt){var ce={id:"F"+(Object.keys(Ge).length+1).toString(10),postScriptName:R,fontName:rt,fontStyle:Ct,encoding:Ut,isStandardFont:Yt||!1,metadata:{}};return Q.publish("addFont",{font:ce,instance:this}),Ge[ce.id]=ce,Fo(ce),ce.id},La=function(R){for(var rt=0,Ct=de.length;rt<Ct;rt++){var Ut=wn.call(this,R[rt][0],R[rt][1],R[rt][2],de[rt][3],!0);S===!1&&(C[Ut]=!0);var Yt=R[rt][0].split("-");Fo({id:Ut,fontName:Yt[0],fontStyle:Yt[1]||""})}Q.publish("addFonts",{fonts:Ge,dictionary:Hr})},Li=function(R){return R.foo=function(){try{return R.apply(this,arguments)}catch(Ut){var rt=Ut.stack||"";~rt.indexOf(" at ")&&(rt=rt.split(" at ")[1]);var Ct="Error in function "+rt.split(`
`)[0].split("<")[0]+": "+Ut.message;if(!Rr.console)throw new Error(Ct);Rr.console.error(Ct,Ut),Rr.alert&&alert(Ct)}},R.foo.bar=R,R.foo},us=function(R,rt){var Ct,Ut,Yt,ce,Le,$e,_r,Mr,Or;if(Yt=(rt=rt||{}).sourceEncoding||"Unicode",Le=rt.outputEncoding,(rt.autoencode||Le)&&Ge[xr].metadata&&Ge[xr].metadata[Yt]&&Ge[xr].metadata[Yt].encoding&&(ce=Ge[xr].metadata[Yt].encoding,!Le&&Ge[xr].encoding&&(Le=Ge[xr].encoding),!Le&&ce.codePages&&(Le=ce.codePages[0]),typeof Le=="string"&&(Le=ce[Le]),Le)){for(_r=!1,$e=[],Ct=0,Ut=R.length;Ct<Ut;Ct++)(Mr=Le[R.charCodeAt(Ct)])?$e.push(String.fromCharCode(Mr)):$e.push(R[Ct]),$e[Ct].charCodeAt(0)>>8&&(_r=!0);R=$e.join("")}for(Ct=R.length;_r===void 0&&Ct!==0;)R.charCodeAt(Ct-1)>>8&&(_r=!0),Ct--;if(!_r)return R;for($e=rt.noBOM?[]:[254,255],Ct=0,Ut=R.length;Ct<Ut;Ct++){if((Or=(Mr=R.charCodeAt(Ct))>>8)>>8)throw new Error("Character at position "+Ct+" of string '"+R+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");$e.push(Or),$e.push(Mr-(Or<<8))}return String.fromCharCode.apply(void 0,$e)},xn=I.__private__.pdfEscape=I.pdfEscape=function(R,rt){return us(R,rt).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},As=I.__private__.beginPage=function(R){Me[++At]=[],J[At]={objId:0,contentsObjId:0,userUnit:Number(a),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(R[0]),topRightY:Number(R[1])}},hl(At),le(Me[Et])},hs=function(R,rt){var Ct,Ut,Yt;switch(r=rt||r,typeof R=="string"&&(Ct=U(R.toLowerCase()),Array.isArray(Ct)&&(Ut=Ct[0],Yt=Ct[1])),Array.isArray(R)&&(Ut=R[0]*Fe,Yt=R[1]*Fe),isNaN(Ut)&&(Ut=n[0],Yt=n[1]),(Ut>14400||Yt>14400)&&(Ji.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Ut=Math.min(14400,Ut),Yt=Math.min(14400,Yt)),n=[Ut,Yt],r.substr(0,1)){case"l":Yt>Ut&&(n=[Yt,Ut]);break;case"p":Ut>Yt&&(n=[Yt,Ut])}As(n),Th($l),st(zo),Oc!==0&&st(Oc+" J"),zc!==0&&st(zc+" j"),Q.publish("addPage",{pageNumber:At})},Xr=function(R){R>0&&R<=At&&(Me.splice(R,1),J.splice(R,1),At--,Et>At&&(Et=At),this.setPage(Et))},hl=function(R){R>0&&R<=At&&(Et=R)},ql=I.__private__.getNumberOfPages=I.getNumberOfPages=function(){return Me.length-1},ot=function(R,rt,Ct){var Ut,Yt=void 0;return Ct=Ct||{},R=R!==void 0?R:Ge[xr].fontName,rt=rt!==void 0?rt:Ge[xr].fontStyle,Ut=R.toLowerCase(),Hr[Ut]!==void 0&&Hr[Ut][rt]!==void 0?Yt=Hr[Ut][rt]:Hr[R]!==void 0&&Hr[R][rt]!==void 0?Yt=Hr[R][rt]:Ct.disableWarning===!1&&Ji.warn("Unable to look up font label for font '"+R+"', '"+rt+"'. Refer to getFontList() for available fonts."),Yt||Ct.noFallback||(Yt=Hr.times[rt])==null&&(Yt=Hr.times.normal),Yt},_t=I.__private__.putInfo=function(){var R=Zt(),rt=function(Ut){return Ut};for(var Ct in w!==null&&(rt=ii.encryptor(R,0)),st("<<"),st("/Producer ("+xn(rt("jsPDF "+kr.version))+")"),hr)hr.hasOwnProperty(Ct)&&hr[Ct]&&st("/"+Ct.substr(0,1).toUpperCase()+Ct.substr(1)+" ("+xn(rt(hr[Ct]))+")");st("/CreationDate ("+xn(rt(re))+")"),st(">>"),st("endobj")},zt=I.__private__.putCatalog=function(R){var rt=(R=R||{}).rootDictionaryObjId||Br;switch(Zt(),st("<<"),st("/Type /Catalog"),st("/Pages "+rt+" 0 R"),Be||(Be="fullwidth"),Be){case"fullwidth":st("/OpenAction [3 0 R /FitH null]");break;case"fullheight":st("/OpenAction [3 0 R /FitV null]");break;case"fullpage":st("/OpenAction [3 0 R /Fit]");break;case"original":st("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Ct=""+Be;Ct.substr(Ct.length-1)==="%"&&(Be=parseInt(Be)/100),typeof Be=="number"&&st("/OpenAction [3 0 R /XYZ null null "+kt(Be)+"]")}switch(Fr||(Fr="continuous"),Fr){case"continuous":st("/PageLayout /OneColumn");break;case"single":st("/PageLayout /SinglePage");break;case"two":case"twoleft":st("/PageLayout /TwoColumnLeft");break;case"tworight":st("/PageLayout /TwoColumnRight")}Er&&st("/PageMode /"+Er),Q.publish("putCatalog"),st(">>"),st("endobj")},oe=I.__private__.putTrailer=function(){st("trailer"),st("<<"),st("/Size "+(qt+1)),st("/Root "+qt+" 0 R"),st("/Info "+(qt-1)+" 0 R"),w!==null&&st("/Encrypt "+ii.oid+" 0 R"),st("/ID [ <"+ee+"> <"+ee+"> ]"),st(">>")},Ae=I.__private__.putHeader=function(){st("%PDF-"+N),st("%")},ar=I.__private__.putXRef=function(){var R="0000000000";st("xref"),st("0 "+(qt+1)),st("0000000000 65535 f ");for(var rt=1;rt<=qt;rt++)typeof $t[rt]=="function"?st((R+$t[rt]()).slice(-10)+" 00000 n "):$t[rt]!==void 0?st((R+$t[rt]).slice(-10)+" 00000 n "):st("0000000000 00000 n ")},Lr=I.__private__.buildDocument=function(){or(),le(Qt),Q.publish("buildDocument"),Ae(),Nr(),_i(),bn(),w!==null&&Fi(),_t(),zt();var R=Kt;return ar(),oe(),st("startxref"),st(""+R),st("%%EOF"),le(Me[Et]),Qt.join(`
`)},di=I.__private__.getBlob=function(R){return new Blob([Qe(R)],{type:"application/pdf"})},Sn=I.output=I.__private__.output=Li(function(R,rt){switch(typeof(rt=rt||{})=="string"?rt={filename:rt}:rt.filename=rt.filename||"generated.pdf",R){case void 0:return Lr();case"save":I.save(rt.filename);break;case"arraybuffer":return Qe(Lr());case"blob":return di(Lr());case"bloburi":case"bloburl":if(Rr.URL!==void 0&&typeof Rr.URL.createObjectURL=="function")return Rr.URL&&Rr.URL.createObjectURL(di(Lr()))||void 0;Ji.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Ct="",Ut=Lr();try{Ct=Yx(Ut)}catch{Ct=Yx(unescape(encodeURIComponent(Ut)))}return"data:application/pdf;filename="+rt.filename+";base64,"+Ct;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Rr)==="[object Window]"){var Yt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",ce=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';rt.pdfObjectUrl&&(Yt=rt.pdfObjectUrl,ce="");var Le='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Yt+'"'+ce+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(rt)+");<\/script></body></html>",$e=Rr.open();return $e!==null&&$e.document.write(Le),$e}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Rr)==="[object Window]"){var _r='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(rt.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+rt.filename+'" width="500px" height="400px" /></body></html>',Mr=Rr.open();if(Mr!==null){Mr.document.write(_r);var Or=this;Mr.document.documentElement.querySelector("#pdfViewer").onload=function(){Mr.document.title=rt.filename,Mr.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Or.output("bloburl"))}}return Mr}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Rr)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Vr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",rt)+'"></iframe></body></html>',Di=Rr.open();if(Di!==null&&(Di.document.write(Vr),Di.document.title=rt.filename),Di||typeof safari>"u")return Di;break;case"datauri":case"dataurl":return Rr.document.location.href=this.output("datauristring",rt);default:return null}}),Mn=function(R){return Array.isArray(ut)===!0&&ut.indexOf(R)>-1};switch(i){case"pt":Fe=1;break;case"mm":Fe=72/25.4;break;case"cm":Fe=72/2.54;break;case"in":Fe=72;break;case"px":Fe=Mn("px_scaling")==1?.75:96/72;break;case"pc":case"em":Fe=12;break;case"ex":Fe=6;break;default:if(typeof i!="number")throw new Error("Invalid unit: "+i);Fe=i}var ii=null;xe(),Ot();var Hl=function(R){return w!==null?ii.encryptor(R,0):function(rt){return rt}},Un=I.__private__.getPageInfo=I.getPageInfo=function(R){if(isNaN(R)||R%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:J[R].objId,pageNumber:R,pageContext:J[R]}},pr=I.__private__.getPageInfoByObjId=function(R){if(isNaN(R)||R%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var rt in J)if(J[rt].objId===R)break;return Un(rt)},Lc=I.__private__.getCurrentPageInfo=I.getCurrentPageInfo=function(){return{objId:J[Et].objId,pageNumber:Et,pageContext:J[Et]}};I.addPage=function(){return hs.apply(this,arguments),this},I.setPage=function(){return hl.apply(this,arguments),le.call(this,Me[Et]),this},I.insertPage=function(R){return this.addPage(),this.movePage(Et,R),this},I.movePage=function(R,rt){var Ct,Ut;if(R>rt){Ct=Me[R],Ut=J[R];for(var Yt=R;Yt>rt;Yt--)Me[Yt]=Me[Yt-1],J[Yt]=J[Yt-1];Me[rt]=Ct,J[rt]=Ut,this.setPage(rt)}else if(R<rt){Ct=Me[R],Ut=J[R];for(var ce=R;ce<rt;ce++)Me[ce]=Me[ce+1],J[ce]=J[ce+1];Me[rt]=Ct,J[rt]=Ut,this.setPage(rt)}return this},I.deletePage=function(){return Xr.apply(this,arguments),this},I.__private__.text=I.text=function(R,rt,Ct,Ut,Yt){var ce,Le,$e,_r,Mr,Or,Vr,Di,ln,zr=(Ut=Ut||{}).scope||this;if(typeof R=="number"&&typeof rt=="number"&&(typeof Ct=="string"||Array.isArray(Ct))){var Zn=Ct;Ct=rt,rt=R,R=Zn}if(arguments[3]instanceof Ft?(mt("The transform parameter of text() with a Matrix value"),ln=Yt):($e=arguments[4],_r=arguments[5],Ui(Vr=arguments[3])==="object"&&Vr!==null||(typeof $e=="string"&&(_r=$e,$e=null),typeof Vr=="string"&&(_r=Vr,Vr=null),typeof Vr=="number"&&($e=Vr,Vr=null),Ut={flags:Vr,angle:$e,align:_r})),isNaN(rt)||isNaN(Ct)||R==null)throw new Error("Invalid arguments passed to jsPDF.text");if(R.length===0)return zr;var fr="",Es=!1,Zr=typeof Ut.lineHeightFactor=="number"?Ut.lineHeightFactor:Ba,Qr=zr.internal.scaleFactor;function sa(Mi){return Mi=Mi.split("	").join(Array(Ut.TabLen||9).join(" ")),xn(Mi,Vr)}function ka(Mi){for(var Si,qi=Mi.concat(),cn=[],Gs=qi.length;Gs--;)typeof(Si=qi.shift())=="string"?cn.push(Si):Array.isArray(Mi)&&(Si.length===1||Si[1]===void 0&&Si[2]===void 0)?cn.push(Si[0]):cn.push([Si[0],Si[1],Si[2]]);return cn}function Ra(Mi,Si){var qi;if(typeof Mi=="string")qi=Si(Mi)[0];else if(Array.isArray(Mi)){for(var cn,Gs,lo=Mi.concat(),un=[],ca=lo.length;ca--;)typeof(cn=lo.shift())=="string"?un.push(Si(cn)[0]):Array.isArray(cn)&&typeof cn[0]=="string"&&(Gs=Si(cn[0],cn[1],cn[2]),un.push([Gs[0],Gs[1],Gs[2]]));qi=un}return qi}var fl=!1,jo=!0;if(typeof R=="string")fl=!0;else if(Array.isArray(R)){var oa=R.concat();Le=[];for(var Gn,Yn=oa.length;Yn--;)(typeof(Gn=oa.shift())!="string"||Array.isArray(Gn)&&typeof Gn[0]!="string")&&(jo=!1);fl=jo}if(fl===!1)throw new Error('Type of text must be string or Array. "'+R+'" is not recognized.');typeof R=="string"&&(R=R.match(/[\r?\n]/)?R.split(/\r\n|\r|\n/g):[R]);var ml=Te/zr.internal.scaleFactor,gl=ml*(Zr-1);switch(Ut.baseline){case"bottom":Ct-=gl;break;case"top":Ct+=ml-gl;break;case"hanging":Ct+=ml-2*gl;break;case"middle":Ct+=ml/2-gl}if((Or=Ut.maxWidth||0)>0&&(typeof R=="string"?R=zr.splitTextToSize(R,Or):Object.prototype.toString.call(R)==="[object Array]"&&(R=R.reduce(function(Mi,Si){return Mi.concat(zr.splitTextToSize(Si,Or))},[]))),ce={text:R,x:rt,y:Ct,options:Ut,mutex:{pdfEscape:xn,activeFontKey:xr,fonts:Ge,activeFontSize:Te}},Q.publish("preProcessText",ce),R=ce.text,$e=(Ut=ce.options).angle,!(ln instanceof Ft)&&$e&&typeof $e=="number"){$e*=Math.PI/180,Ut.rotationDirection===0&&($e=-$e),H===z.ADVANCED&&($e=-$e);var io=Math.cos($e),Fa=Math.sin($e);ln=new Ft(io,Fa,-Fa,io,0,0)}else $e&&$e instanceof Ft&&(ln=$e);H!==z.ADVANCED||ln||(ln=ne),(Mr=Ut.charSpace||dl)!==void 0&&(fr+=vt(dt(Mr))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Di=Ut.horizontalScale)!==void 0&&(fr+=vt(100*Di)+` Tz
`),Ut.lang;var Bn=-1,yl=Ut.renderingMode!==void 0?Ut.renderingMode:Ut.stroke,Da=zr.internal.getCurrentPageInfo().pageContext;switch(yl){case 0:case!1:case"fill":Bn=0;break;case 1:case!0:case"stroke":Bn=1;break;case 2:case"fillThenStroke":Bn=2;break;case 3:case"invisible":Bn=3;break;case 4:case"fillAndAddForClipping":Bn=4;break;case 5:case"strokeAndAddPathForClipping":Bn=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Bn=6;break;case 7:case"addToPathForClipping":Bn=7}var Zl=Da.usedRenderingMode!==void 0?Da.usedRenderingMode:-1;Bn!==-1?fr+=Bn+` Tr
`:Zl!==-1&&(fr+=`0 Tr
`),Bn!==-1&&(Da.usedRenderingMode=Bn),_r=Ut.align||"left";var Jn,aa=Te*Zr,Ih=zr.internal.pageSize.getWidth(),Ru=Ge[xr];Mr=Ut.charSpace||dl,Or=Ut.maxWidth||0,Vr=Object.assign({autoencode:!0,noBOM:!0},Ut.flags);var jr=[];if(Object.prototype.toString.call(R)==="[object Array]"){var ps;Le=ka(R),_r!=="left"&&(Jn=Le.map(function(Mi){return zr.getStringUnitWidth(Mi,{font:Ru,charSpace:Mr,fontSize:Te,doKerning:!1})*Te/Qr}));var Uo,Na=0;if(_r==="right"){rt-=Jn[0],R=[],Yn=Le.length;for(var fs=0;fs<Yn;fs++)fs===0?(Uo=Gr(rt),ps=Oo(Ct)):(Uo=dt(Na-Jn[fs]),ps=-aa),R.push([Le[fs],Uo,ps]),Na=Jn[fs]}else if(_r==="center"){rt-=Jn[0]/2,R=[],Yn=Le.length;for(var la=0;la<Yn;la++)la===0?(Uo=Gr(rt),ps=Oo(Ct)):(Uo=dt((Na-Jn[la])/2),ps=-aa),R.push([Le[la],Uo,ps]),Na=Jn[la]}else if(_r==="left"){R=[],Yn=Le.length;for(var Oa=0;Oa<Yn;Oa++)R.push(Le[Oa])}else{if(_r!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');R=[],Yn=Le.length,Or=Or!==0?Or:Ih;for(var no=0;no<Yn;no++)ps=no===0?Oo(Ct):-aa,Uo=no===0?Gr(rt):0,no<Yn-1?jr.push(vt(dt((Or-Jn[no])/(Le[no].split(" ").length-1)))):jr.push(0),R.push([Le[no],Uo,ps])}}var Yl=typeof Ut.R2L=="boolean"?Ut.R2L:rr;Yl===!0&&(R=Ra(R,function(Mi,Si,qi){return[Mi.split("").reverse().join(""),Si,qi]})),ce={text:R,x:rt,y:Ct,options:Ut,mutex:{pdfEscape:xn,activeFontKey:xr,fonts:Ge,activeFontSize:Te}},Q.publish("postProcessText",ce),R=ce.text,Es=ce.mutex.isHex||!1;var _l=Ge[xr].encoding;_l!=="WinAnsiEncoding"&&_l!=="StandardEncoding"||(R=Ra(R,function(Mi,Si,qi){return[sa(Mi),Si,qi]})),Le=ka(R),R=[];for(var Go,Kn,Ts,so=0,vl=1,oo=Array.isArray(Le[0])?vl:so,ao="",bl=function(Mi,Si,qi){var cn="";return qi instanceof Ft?(qi=typeof Ut.angle=="number"?Lt(qi,new Ft(1,0,0,1,Mi,Si)):Lt(new Ft(1,0,0,1,Mi,Si),qi),H===z.ADVANCED&&(qi=Lt(new Ft(1,0,0,-1,0,0),qi)),cn=qi.join(" ")+` Tm
`):cn=vt(Mi)+" "+vt(Si)+` Td
`,cn},ms=0;ms<Le.length;ms++){switch(ao="",oo){case vl:Ts=(Es?"<":"(")+Le[ms][0]+(Es?">":")"),Go=parseFloat(Le[ms][1]),Kn=parseFloat(Le[ms][2]);break;case so:Ts=(Es?"<":"(")+Le[ms]+(Es?">":")"),Go=Gr(rt),Kn=Oo(Ct)}jr!==void 0&&jr[ms]!==void 0&&(ao=jr[ms]+` Tw
`),ms===0?R.push(ao+bl(Go,Kn,ln)+Ts):oo===so?R.push(ao+Ts):oo===vl&&R.push(ao+bl(Go,Kn,ln)+Ts)}R=oo===so?R.join(` Tj
T* `):R.join(` Tj
`),R+=` Tj
`;var Vo=`BT
/`;return Vo+=xr+" "+Te+` Tf
`,Vo+=vt(Te*Zr)+` TL
`,Vo+=Wl+`
`,Vo+=fr,Vo+=R,st(Vo+="ET"),C[xr]=!0,zr};var Mc=I.__private__.clip=I.clip=function(R){return st(R==="evenodd"?"W*":"W"),this};I.clipEvenOdd=function(){return Mc("evenodd")},I.__private__.discardPath=I.discardPath=function(){return st("n"),this};var js=I.__private__.isValidStyle=function(R){var rt=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(R)!==-1&&(rt=!0),rt};I.__private__.setDefaultPathOperation=I.setDefaultPathOperation=function(R){return js(R)&&(_=R),this};var Iu=I.__private__.getStyle=I.getStyle=function(R){var rt=_;switch(R){case"D":case"S":rt="S";break;case"F":rt="f";break;case"FD":case"DF":rt="B";break;case"f":case"f*":case"B":case"B*":rt=R}return rt},Ma=I.close=function(){return st("h"),this};I.stroke=function(){return st("S"),this},I.fill=function(R){return Bc("f",R),this},I.fillEvenOdd=function(R){return Bc("f*",R),this},I.fillStroke=function(R){return Bc("B",R),this},I.fillStrokeEvenOdd=function(R){return Bc("B*",R),this};var Bc=function(R,rt){Ui(rt)==="object"?Ld(rt,R):st(R)},kc=function(R){R===null||H===z.ADVANCED&&R===void 0||(R=Iu(R),st(R))};function Eh(R,rt,Ct,Ut,Yt){var ce=new Vf(rt||this.boundingBox,Ct||this.xStep,Ut||this.yStep,this.gState,Yt||this.matrix);ce.stream=this.stream;var Le=R+"$$"+this.cloneIndex+++"$$";return ue(Le,ce),ce}var Ld=function(R,rt){var Ct=In[R.key],Ut=je[Ct];if(Ut instanceof cp)st("q"),st(Md(rt)),Ut.gState&&I.setGState(Ut.gState),st(R.matrix.toString()+" cm"),st("/"+Ct+" sh"),st("Q");else if(Ut instanceof Vf){var Yt=new Ft(1,0,0,-1,0,pl());R.matrix&&(Yt=Yt.multiply(R.matrix||ne),Ct=Eh.call(Ut,R.key,R.boundingBox,R.xStep,R.yStep,Yt).id),st("q"),st("/Pattern cs"),st("/"+Ct+" scn"),Ut.gState&&I.setGState(Ut.gState),st(rt),st("Q")}},Md=function(R){switch(R){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},Rc=I.moveTo=function(R,rt){return st(vt(dt(R))+" "+vt(xt(rt))+" m"),this},Do=I.lineTo=function(R,rt){return st(vt(dt(R))+" "+vt(xt(rt))+" l"),this},ra=I.curveTo=function(R,rt,Ct,Ut,Yt,ce){return st([vt(dt(R)),vt(xt(rt)),vt(dt(Ct)),vt(xt(Ut)),vt(dt(Yt)),vt(xt(ce)),"c"].join(" ")),this};I.__private__.line=I.line=function(R,rt,Ct,Ut,Yt){if(isNaN(R)||isNaN(rt)||isNaN(Ct)||isNaN(Ut)||!js(Yt))throw new Error("Invalid arguments passed to jsPDF.line");return H===z.COMPAT?this.lines([[Ct-R,Ut-rt]],R,rt,[1,1],Yt||"S"):this.lines([[Ct-R,Ut-rt]],R,rt,[1,1]).stroke()},I.__private__.lines=I.lines=function(R,rt,Ct,Ut,Yt,ce){var Le,$e,_r,Mr,Or,Vr,Di,ln,zr,Zn,fr,Es;if(typeof R=="number"&&(Es=Ct,Ct=rt,rt=R,R=Es),Ut=Ut||[1,1],ce=ce||!1,isNaN(rt)||isNaN(Ct)||!Array.isArray(R)||!Array.isArray(Ut)||!js(Yt)||typeof ce!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Rc(rt,Ct),Le=Ut[0],$e=Ut[1],Mr=R.length,Zn=rt,fr=Ct,_r=0;_r<Mr;_r++)(Or=R[_r]).length===2?(Zn=Or[0]*Le+Zn,fr=Or[1]*$e+fr,Do(Zn,fr)):(Vr=Or[0]*Le+Zn,Di=Or[1]*$e+fr,ln=Or[2]*Le+Zn,zr=Or[3]*$e+fr,Zn=Or[4]*Le+Zn,fr=Or[5]*$e+fr,ra(Vr,Di,ln,zr,Zn,fr));return ce&&Ma(),kc(Yt),this},I.path=function(R){for(var rt=0;rt<R.length;rt++){var Ct=R[rt],Ut=Ct.c;switch(Ct.op){case"m":Rc(Ut[0],Ut[1]);break;case"l":Do(Ut[0],Ut[1]);break;case"c":ra.apply(this,Ut);break;case"h":Ma()}}return this},I.__private__.rect=I.rect=function(R,rt,Ct,Ut,Yt){if(isNaN(R)||isNaN(rt)||isNaN(Ct)||isNaN(Ut)||!js(Yt))throw new Error("Invalid arguments passed to jsPDF.rect");return H===z.COMPAT&&(Ut=-Ut),st([vt(dt(R)),vt(xt(rt)),vt(dt(Ct)),vt(dt(Ut)),"re"].join(" ")),kc(Yt),this},I.__private__.triangle=I.triangle=function(R,rt,Ct,Ut,Yt,ce,Le){if(isNaN(R)||isNaN(rt)||isNaN(Ct)||isNaN(Ut)||isNaN(Yt)||isNaN(ce)||!js(Le))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Ct-R,Ut-rt],[Yt-Ct,ce-Ut],[R-Yt,rt-ce]],R,rt,[1,1],Le,!0),this},I.__private__.roundedRect=I.roundedRect=function(R,rt,Ct,Ut,Yt,ce,Le){if(isNaN(R)||isNaN(rt)||isNaN(Ct)||isNaN(Ut)||isNaN(Yt)||isNaN(ce)||!js(Le))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var $e=4/3*(Math.SQRT2-1);return Yt=Math.min(Yt,.5*Ct),ce=Math.min(ce,.5*Ut),this.lines([[Ct-2*Yt,0],[Yt*$e,0,Yt,ce-ce*$e,Yt,ce],[0,Ut-2*ce],[0,ce*$e,-Yt*$e,ce,-Yt,ce],[2*Yt-Ct,0],[-Yt*$e,0,-Yt,-ce*$e,-Yt,-ce],[0,2*ce-Ut],[0,-ce*$e,Yt*$e,-ce,Yt,-ce]],R+Yt,rt,[1,1],Le,!0),this},I.__private__.ellipse=I.ellipse=function(R,rt,Ct,Ut,Yt){if(isNaN(R)||isNaN(rt)||isNaN(Ct)||isNaN(Ut)||!js(Yt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var ce=4/3*(Math.SQRT2-1)*Ct,Le=4/3*(Math.SQRT2-1)*Ut;return Rc(R+Ct,rt),ra(R+Ct,rt-Le,R+ce,rt-Ut,R,rt-Ut),ra(R-ce,rt-Ut,R-Ct,rt-Le,R-Ct,rt),ra(R-Ct,rt+Le,R-ce,rt+Ut,R,rt+Ut),ra(R+ce,rt+Ut,R+Ct,rt+Le,R+Ct,rt),kc(Yt),this},I.__private__.circle=I.circle=function(R,rt,Ct,Ut){if(isNaN(R)||isNaN(rt)||isNaN(Ct)||!js(Ut))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(R,rt,Ct,Ct,Ut)},I.setFont=function(R,rt,Ct){return Ct&&(rt=bt(rt,Ct)),xr=ot(R,rt,{disableWarning:!1}),this};var Fc=I.__private__.getFont=I.getFont=function(){return Ge[ot.apply(I,arguments)]};I.__private__.getFontList=I.getFontList=function(){var R,rt,Ct={};for(R in Hr)if(Hr.hasOwnProperty(R))for(rt in Ct[R]=[],Hr[R])Hr[R].hasOwnProperty(rt)&&Ct[R].push(rt);return Ct},I.addFont=function(R,rt,Ct,Ut,Yt){var ce=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&ce.indexOf(arguments[3])!==-1?Yt=arguments[3]:arguments[3]&&ce.indexOf(arguments[3])==-1&&(Ct=bt(Ct,Ut)),Yt=Yt||"Identity-H",wn.call(this,R,rt,Ct,Yt)};var Ba,$l=e.lineWidth||.200025,ds=I.__private__.getLineWidth=I.getLineWidth=function(){return $l},Th=I.__private__.setLineWidth=I.setLineWidth=function(R){return $l=R,st(vt(dt(R))+" w"),this};I.__private__.setLineDash=kr.API.setLineDash=kr.API.setLineDashPattern=function(R,rt){if(R=R||[],rt=rt||0,isNaN(rt)||!Array.isArray(R))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return R=R.map(function(Ct){return vt(dt(Ct))}).join(" "),rt=vt(dt(rt)),st("["+R+"] "+rt+" d"),this};var Dc=I.__private__.getLineHeight=I.getLineHeight=function(){return Te*Ba};I.__private__.getLineHeight=I.getLineHeight=function(){return Te*Ba};var ia=I.__private__.setLineHeightFactor=I.setLineHeightFactor=function(R){return typeof(R=R||1.15)=="number"&&(Ba=R),this},No=I.__private__.getLineHeightFactor=I.getLineHeightFactor=function(){return Ba};ia(e.lineHeight);var Gr=I.__private__.getHorizontalCoordinate=function(R){return dt(R)},Oo=I.__private__.getVerticalCoordinate=function(R){return H===z.ADVANCED?R:J[Et].mediaBox.topRightY-J[Et].mediaBox.bottomLeftY-dt(R)},Bd=I.__private__.getHorizontalCoordinateString=I.getHorizontalCoordinateString=function(R){return vt(Gr(R))},Us=I.__private__.getVerticalCoordinateString=I.getVerticalCoordinateString=function(R){return vt(Oo(R))},zo=e.strokeColor||"0 G";I.__private__.getStrokeColor=I.getDrawColor=function(){return Ir(zo)},I.__private__.setStrokeColor=I.setDrawColor=function(R,rt,Ct,Ut){return zo=Sr({ch1:R,ch2:rt,ch3:Ct,ch4:Ut,pdfColorType:"draw",precision:2}),st(zo),this};var Nc=e.fillColor||"0 g";I.__private__.getFillColor=I.getFillColor=function(){return Ir(Nc)},I.__private__.setFillColor=I.setFillColor=function(R,rt,Ct,Ut){return Nc=Sr({ch1:R,ch2:rt,ch3:Ct,ch4:Ut,pdfColorType:"fill",precision:2}),st(Nc),this};var Wl=e.textColor||"0 g",Ch=I.__private__.getTextColor=I.getTextColor=function(){return Ir(Wl)};I.__private__.setTextColor=I.setTextColor=function(R,rt,Ct,Ut){return Wl=Sr({ch1:R,ch2:rt,ch3:Ct,ch4:Ut,pdfColorType:"text",precision:3}),this};var dl=e.charSpace,Ph=I.__private__.getCharSpace=I.getCharSpace=function(){return parseFloat(dl||0)};I.__private__.setCharSpace=I.setCharSpace=function(R){if(isNaN(R))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return dl=R,this};var Oc=0;I.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},I.__private__.setLineCap=I.setLineCap=function(R){var rt=I.CapJoinStyles[R];if(rt===void 0)throw new Error("Line cap style of '"+R+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Oc=rt,st(rt+" J"),this};var zc=0;I.__private__.setLineJoin=I.setLineJoin=function(R){var rt=I.CapJoinStyles[R];if(rt===void 0)throw new Error("Line join style of '"+R+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return zc=rt,st(rt+" j"),this},I.__private__.setLineMiterLimit=I.__private__.setMiterLimit=I.setLineMiterLimit=I.setMiterLimit=function(R){if(R=R||0,isNaN(R))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return st(vt(dt(R))+" M"),this},I.GState=U_,I.setGState=function(R){(R=typeof R=="string"?si[on[R]]:Lu(null,R)).equals(an)||(st("/"+R.id+" gs"),an=R)};var Lu=function(R,rt){if(!R||!on[R]){var Ct=!1;for(var Ut in si)if(si.hasOwnProperty(Ut)&&si[Ut].equals(rt)){Ct=!0;break}if(Ct)rt=si[Ut];else{var Yt="GS"+(Object.keys(si).length+1).toString(10);si[Yt]=rt,rt.id=Yt}return R&&(on[R]=rt.id),Q.publish("addGState",rt),rt}};I.addGState=function(R,rt){return Lu(R,rt),this},I.saveGraphicsState=function(){return st("q"),Qi.push({key:xr,size:Te,color:Wl}),this},I.restoreGraphicsState=function(){st("Q");var R=Qi.pop();return xr=R.key,Te=R.size,Wl=R.color,an=null,this},I.setCurrentTransformationMatrix=function(R){return st(R.toString()+" cm"),this},I.comment=function(R){return st("#"+R),this};var ro=function(R,rt){var Ct=R||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Ct},set:function(ce){isNaN(ce)||(Ct=parseFloat(ce))}});var Ut=rt||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Ut},set:function(ce){isNaN(ce)||(Ut=parseFloat(ce))}});var Yt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Yt},set:function(ce){Yt=ce.toString()}}),this},jc=function(R,rt,Ct,Ut){ro.call(this,R,rt),this.type="rect";var Yt=Ct||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Yt},set:function(Le){isNaN(Le)||(Yt=parseFloat(Le))}});var ce=Ut||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return ce},set:function(Le){isNaN(Le)||(ce=parseFloat(Le))}}),this},Mu=function(){this.page=At,this.currentPage=Et,this.pages=Me.slice(0),this.pagesContext=J.slice(0),this.x=wi,this.y=ge,this.matrix=br,this.width=na(Et),this.height=pl(Et),this.outputDestination=ze,this.id="",this.objectNumber=-1};Mu.prototype.restore=function(){At=this.page,Et=this.currentPage,J=this.pagesContext,Me=this.pages,wi=this.x,ge=this.y,br=this.matrix,ku(Et,this.width),Gc(Et,this.height),ze=this.outputDestination};var Bu=function(R,rt,Ct,Ut,Yt){Vt.push(new Mu),At=Et=0,Me=[],wi=R,ge=rt,br=Yt,As([Ct,Ut])},Xl=function(R){if(Nt[R])Vt.pop().restore();else{var rt=new Mu,Ct="Xo"+(Object.keys(wt).length+1).toString(10);rt.id=Ct,Nt[R]=Ct,wt[Ct]=rt,Q.publish("addFormObject",rt),Vt.pop().restore()}};for(var Uc in I.beginFormObject=function(R,rt,Ct,Ut,Yt){return Bu(R,rt,Ct,Ut,Yt),this},I.endFormObject=function(R){return Xl(R),this},I.doFormObject=function(R,rt){var Ct=wt[Nt[R]];return st("q"),st(rt.toString()+" cm"),st("/"+Ct.id+" Do"),st("Q"),this},I.getFormObject=function(R){var rt=wt[Nt[R]];return{x:rt.x,y:rt.y,width:rt.width,height:rt.height,matrix:rt.matrix}},I.save=function(R,rt){return R=R||"generated.pdf",(rt=rt||{}).returnPromise=rt.returnPromise||!1,rt.returnPromise===!1?(op(di(Lr()),R),typeof op.unload=="function"&&Rr.setTimeout&&setTimeout(op.unload,911),this):new Promise(function(Ct,Ut){try{var Yt=op(di(Lr()),R);typeof op.unload=="function"&&Rr.setTimeout&&setTimeout(op.unload,911),Ct(Yt)}catch(ce){Ut(ce.message)}})},kr.API)kr.API.hasOwnProperty(Uc)&&(Uc==="events"&&kr.API.events.length?function(R,rt){var Ct,Ut,Yt;for(Yt=rt.length-1;Yt!==-1;Yt--)Ct=rt[Yt][0],Ut=rt[Yt][1],R.subscribe.apply(R,[Ct].concat(typeof Ut=="function"?[Ut]:Ut))}(Q,kr.API.events):I[Uc]=kr.API[Uc]);var na=I.getPageWidth=function(R){return(J[R=R||Et].mediaBox.topRightX-J[R].mediaBox.bottomLeftX)/Fe},ku=I.setPageWidth=function(R,rt){J[R].mediaBox.topRightX=rt*Fe+J[R].mediaBox.bottomLeftX},pl=I.getPageHeight=function(R){return(J[R=R||Et].mediaBox.topRightY-J[R].mediaBox.bottomLeftY)/Fe},Gc=I.setPageHeight=function(R,rt){J[R].mediaBox.topRightY=rt*Fe+J[R].mediaBox.bottomLeftY};return I.internal={pdfEscape:xn,getStyle:Iu,getFont:Fc,getFontSize:Ne,getCharSpace:Ph,getTextColor:Ch,getLineHeight:Dc,getLineHeightFactor:No,getLineWidth:ds,write:mr,getHorizontalCoordinate:Gr,getVerticalCoordinate:Oo,getCoordinateString:Bd,getVerticalCoordinateString:Us,collections:{},newObject:Zt,newAdditionalObject:Ke,newObjectDeferred:be,newObjectDeferredBegin:We,getFilters:oi,putStream:Wr,events:Q,scaleFactor:Fe,pageSize:{getWidth:function(){return na(Et)},setWidth:function(R){ku(Et,R)},getHeight:function(){return pl(Et)},setHeight:function(R){Gc(Et,R)}},encryptionOptions:w,encryption:ii,getEncryptor:Hl,output:Sn,getNumberOfPages:ql,pages:Me,out:st,f2:kt,f3:at,getPageInfo:Un,getPageInfoByObjId:pr,getCurrentPageInfo:Lc,getPDFVersion:F,Point:ro,Rectangle:jc,Matrix:Ft,hasHotfix:Mn},Object.defineProperty(I.internal.pageSize,"width",{get:function(){return na(Et)},set:function(R){ku(Et,R)},enumerable:!0,configurable:!0}),Object.defineProperty(I.internal.pageSize,"height",{get:function(){return pl(Et)},set:function(R){Gc(Et,R)},enumerable:!0,configurable:!0}),La.call(I,de),xr="F1",hs(n,r),Q.publish("initialized"),I}Af.prototype.lsbFirstWord=function(e){return String.fromCharCode(e>>0&255,e>>8&255,e>>16&255,e>>24&255)},Af.prototype.toHexString=function(e){return e.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Af.prototype.hexToBytes=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(String.fromCharCode(parseInt(e.substr(r,2),16)));return t.join("")},Af.prototype.processOwnerPassword=function(e,t){return Kx(Jx(t).substr(0,5),e)},Af.prototype.encryptor=function(e,t){var r=Jx(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(i){return Kx(r,i)}},U_.prototype.equals=function(e){var t,r="id,objectNumber,equals";if(!e||Ui(e)!==Ui(this))return!1;var i=0;for(t in this)if(!(r.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t)||this[t]!==e[t])return!1;i++}for(t in e)e.hasOwnProperty(t)&&r.indexOf(t)<0&&i--;return i===0},kr.API={events:[]},kr.version="2.5.1";var On=kr.API,x3=1,Up=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},bf=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},qr=function(e){return e.toFixed(2)},Qh=function(e){return e.toFixed(5)};On.__acroform__={};var Pa=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},UI=function(e){return e*x3},mu=function(e){var t=new Gk,r=ur.internal.getHeight(e)||0,i=ur.internal.getWidth(e)||0;return t.BBox=[0,0,Number(qr(i)),Number(qr(r))],t},trt=On.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|=1<<t},ert=On.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&=~(1<<t)},rrt=On.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return e&1<<t?1:0},$n=On.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return rrt(e,t-1)},Wn=On.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return trt(e,t-1)},Xn=On.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return ert(e,t-1)},irt=On.__acroform__.calculateCoordinates=function(e,t){var r=t.internal.getHorizontalCoordinate,i=t.internal.getVerticalCoordinate,n=e[0],s=e[1],c=e[2],a=e[3],p={};return p.lowerLeft_X=r(n)||0,p.lowerLeft_Y=i(s+a)||0,p.upperRight_X=r(n+c)||0,p.upperRight_Y=i(s)||0,[Number(qr(p.lowerLeft_X)),Number(qr(p.lowerLeft_Y)),Number(qr(p.upperRight_X)),Number(qr(p.upperRight_Y))]},nrt=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],r=e._V||e.DV,i=Qx(e,r),n=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+n+" "+qr(i.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(i.text),t.push("ET"),t.push("Q"),t.push("EMC");var s=mu(e);return s.scope=e.scope,s.stream=t.join(`
`),s}},Qx=function(e,t){var r=e.fontSize===0?e.maxFontSize:e.fontSize,i={text:"",fontSize:""},n=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");n=e.multiline?n.map(function(at){return at.split(`
`)}):n.map(function(at){return[at]});var s=r,c=ur.internal.getHeight(e)||0;c=c<0?-c:c;var a=ur.internal.getWidth(e)||0;a=a<0?-a:a;var p=function(at,dt,It){if(at+1<n.length){var xt=dt+" "+n[at+1][0];return my(xt,e,It).width<=a-4}return!1};s++;t:for(;s>0;){t="",s--;var _,w,S=my("3",e,s).height,C=e.multiline?c-s:(c-S)/2,I=C+=2,N=0,F=0,W=0;if(s<=0){t=`(...) Tj
`,t+="% Width of Text: "+my(t,e,s=12).width+", FieldWidth:"+a+`
`;break}for(var U="",z=0,H=0;H<n.length;H++)if(n.hasOwnProperty(H)){var nt=!1;if(n[H].length!==1&&W!==n[H].length-1){if((S+2)*(z+2)+2>c)continue t;U+=n[H][W],nt=!0,F=H,H--}else{U=(U+=n[H][W]+" ").substr(U.length-1)==" "?U.substr(0,U.length-1):U;var yt=parseInt(H),bt=p(yt,U,s),vt=H>=n.length-1;if(bt&&!vt){U+=" ",W=0;continue}if(bt||vt){if(vt)F=yt;else if(e.multiline&&(S+2)*(z+2)+2>c)continue t}else{if(!e.multiline||(S+2)*(z+2)+2>c)continue t;F=yt}}for(var mt="",Dt=N;Dt<=F;Dt++){var kt=n[Dt];if(e.multiline){if(Dt===F){mt+=kt[W]+" ",W=(W+1)%kt.length;continue}if(Dt===N){mt+=kt[kt.length-1]+" ";continue}}mt+=kt[0]+" "}switch(mt=mt.substr(mt.length-1)==" "?mt.substr(0,mt.length-1):mt,w=my(mt,e,s).width,e.textAlign){case"right":_=a-w-2;break;case"center":_=(a-w)/2;break;case"left":default:_=2}t+=qr(_)+" "+qr(I)+` Td
`,t+="("+Up(mt)+`) Tj
`,t+=-qr(_)+` 0 Td
`,I=-(s+2),w=0,N=nt?F:F+1,z++,U=""}break}return i.text=t,i.fontSize=s,i},my=function(e,t,r){var i=t.scope.internal.getFont(t.fontName,t.fontStyle),n=t.scope.getStringUnitWidth(e,{font:i,fontSize:parseFloat(r),charSpace:0})*parseFloat(r);return{height:t.scope.getStringUnitWidth("3",{font:i,fontSize:parseFloat(r),charSpace:0})*parseFloat(r)*1.5,width:n}},srt={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},ort=function(e,t){var r={type:"reference",object:e};t.internal.getPageInfo(e.page).pageContext.annotations.find(function(i){return i.type===r.type&&i.object===r.object})===void 0&&t.internal.getPageInfo(e.page).pageContext.annotations.push(r)},art=function(e,t){for(var r in e)if(e.hasOwnProperty(r)){var i=r,n=e[r];t.internal.newObjectDeferredBegin(n.objId,!0),Ui(n)==="object"&&typeof n.putStream=="function"&&n.putStream(),delete e[i]}},lrt=function(e,t){if(t.scope=e,e.internal!==void 0&&(e.internal.acroformPlugin===void 0||e.internal.acroformPlugin.isInitialized===!1)){if(Cc.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(srt)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");x3=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new Vk,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){(function(r){r.internal.events.unsubscribe(r.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete r.internal.acroformPlugin.acroFormDictionaryRoot._eventID,r.internal.acroformPlugin.printedOut=!0})(e)}),e.internal.events.subscribe("buildDocument",function(){(function(r){r.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var i=r.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in i)if(i.hasOwnProperty(n)){var s=i[n];s.objId=void 0,s.hasAnnotation&&ort(s,r)}})(e)}),e.internal.events.subscribe("putCatalog",function(){(function(r){if(r.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");r.internal.write("/AcroForm "+r.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(e)}),e.internal.events.subscribe("postPutPages",function(r){(function(i,n){var s=!i;for(var c in i||(n.internal.newObjectDeferredBegin(n.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),n.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),i=i||n.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(i.hasOwnProperty(c)){var a=i[c],p=[],_=a.Rect;if(a.Rect&&(a.Rect=irt(a.Rect,n)),n.internal.newObjectDeferredBegin(a.objId,!0),a.DA=ur.createDefaultAppearanceStream(a),Ui(a)==="object"&&typeof a.getKeyValueListForStream=="function"&&(p=a.getKeyValueListForStream()),a.Rect=_,a.hasAppearanceStream&&!a.appearanceStreamContent){var w=nrt(a);p.push({key:"AP",value:"<</N "+w+">>"}),n.internal.acroformPlugin.xForms.push(w)}if(a.appearanceStreamContent){var S="";for(var C in a.appearanceStreamContent)if(a.appearanceStreamContent.hasOwnProperty(C)){var I=a.appearanceStreamContent[C];if(S+="/"+C+" ",S+="<<",Object.keys(I).length>=1||Array.isArray(I)){for(var c in I)if(I.hasOwnProperty(c)){var N=I[c];typeof N=="function"&&(N=N.call(n,a)),S+="/"+c+" "+N+" ",n.internal.acroformPlugin.xForms.indexOf(N)>=0||n.internal.acroformPlugin.xForms.push(N)}}else typeof(N=I)=="function"&&(N=N.call(n,a)),S+="/"+c+" "+N,n.internal.acroformPlugin.xForms.indexOf(N)>=0||n.internal.acroformPlugin.xForms.push(N);S+=">>"}p.push({key:"AP",value:`<<
`+S+">>"})}n.internal.putStream({additionalKeyValues:p,objectId:a.objId}),n.internal.out("endobj")}s&&art(n.internal.acroformPlugin.xForms,n)})(r,e)}),e.internal.acroformPlugin.isInitialized=!0}},Uk=On.__acroform__.arrayToPdfArray=function(e,t,r){var i=function(c){return c};if(Array.isArray(e)){for(var n="[",s=0;s<e.length;s++)switch(s!==0&&(n+=" "),Ui(e[s])){case"boolean":case"number":case"object":n+=e[s].toString();break;case"string":e[s].substr(0,1)!=="/"?(t!==void 0&&r&&(i=r.internal.getEncryptor(t)),n+="("+Up(i(e[s].toString()))+")"):n+=e[s].toString()}return n+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Y2=function(e,t,r){var i=function(n){return n};return t!==void 0&&r&&(i=r.internal.getEncryptor(t)),(e=e||"").toString(),e="("+Up(i(e))+")"},Su=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Su.prototype.toString=function(){return this.objId+" 0 R"},Su.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},Su.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(s){return s!="content"&&s!="appearanceStreamContent"&&s!="scope"&&s!="objId"&&s.substring(0,1)!="_"});for(var r in t)if(Object.getOwnPropertyDescriptor(this,t[r]).configurable===!1){var i=t[r],n=this[i];n&&(Array.isArray(n)?e.push({key:i,value:Uk(n,this.objId,this.scope)}):n instanceof Su?(n.scope=this.scope,e.push({key:i,value:n.objId+" 0 R"})):typeof n!="function"&&e.push({key:i,value:n}))}return e};var Gk=function(){Su.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(r){e=r.trim()},get:function(){return e||null}})};Pa(Gk,Su);var Vk=function(){Su.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var r=function(i){return i};return this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),"("+Up(r(e))+")"}},set:function(r){e=r}})};Pa(Vk,Su);var Cc=function e(){Su.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(U){if(isNaN(U))throw new Error('Invalid value "'+U+'" for attribute F supplied.');t=U}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!$n(t,3)},set:function(U){U?this.F=Wn(t,3):this.F=Xn(t,3)}});var r=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return r},set:function(U){if(isNaN(U))throw new Error('Invalid value "'+U+'" for attribute Ff supplied.');r=U}});var i=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(i.length!==0)return i},set:function(U){i=U!==void 0?U:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[0])?0:i[0]},set:function(U){i[0]=U}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[1])?0:i[1]},set:function(U){i[1]=U}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[2])?0:i[2]},set:function(U){i[2]=U}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[3])?0:i[3]},set:function(U){i[3]=U}});var n="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return n},set:function(U){switch(U){case"/Btn":case"/Tx":case"/Ch":case"/Sig":n=U;break;default:throw new Error('Invalid value "'+U+'" for attribute FT supplied.')}}});var s=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!s||s.length<1){if(this instanceof G_)return;s="FieldObject"+e.FieldNum++}var U=function(z){return z};return this.scope&&(U=this.scope.internal.getEncryptor(this.objId)),"("+Up(U(s))+")"},set:function(U){s=U.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return s},set:function(U){s=U}});var c="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return c},set:function(U){c=U}});var a="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return a},set:function(U){a=U}});var p=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return p},set:function(U){p=U}});var _=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return _===void 0?50/x3:_},set:function(U){_=U}});var w="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return w},set:function(U){w=U}});var S="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!S||this instanceof G_||this instanceof Sp))return Y2(S,this.objId,this.scope)},set:function(U){U=U.toString(),S=U}});var C=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(C)return this instanceof Ds?C:Y2(C,this.objId,this.scope)},set:function(U){U=U.toString(),C=this instanceof Ds?U:U.substr(0,1)==="("?bf(U.substr(1,U.length-2)):bf(U)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ds?bf(C.substr(1,C.length-1)):C},set:function(U){U=U.toString(),C=this instanceof Ds?"/"+U:U}});var I=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(I)return I},set:function(U){this.V=U}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(I)return this instanceof Ds?I:Y2(I,this.objId,this.scope)},set:function(U){U=U.toString(),I=this instanceof Ds?U:U.substr(0,1)==="("?bf(U.substr(1,U.length-2)):bf(U)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ds?bf(I.substr(1,I.length-1)):I},set:function(U){U=U.toString(),I=this instanceof Ds?"/"+U:U}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var N,F=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return F},set:function(U){U=!!U,F=U}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(N)return N},set:function(U){N=U}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,1)},set:function(U){U?this.Ff=Wn(this.Ff,1):this.Ff=Xn(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,2)},set:function(U){U?this.Ff=Wn(this.Ff,2):this.Ff=Xn(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,3)},set:function(U){U?this.Ff=Wn(this.Ff,3):this.Ff=Xn(this.Ff,3)}});var W=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(W!==null)return W},set:function(U){if([0,1,2].indexOf(U)===-1)throw new Error('Invalid value "'+U+'" for attribute Q supplied.');W=U}}),Object.defineProperty(this,"textAlign",{get:function(){var U;switch(W){case 0:default:U="left";break;case 1:U="center";break;case 2:U="right"}return U},configurable:!0,enumerable:!0,set:function(U){switch(U){case"right":case 2:W=2;break;case"center":case 1:W=1;break;case"left":case 0:default:W=0}}})};Pa(Cc,Su);var em=function(){Cc.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){e=r}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return Uk(t,this.objId,this.scope)},set:function(r){var i,n;n=[],typeof(i=r)=="string"&&(n=function(s,c,a){a||(a=1);for(var p,_=[];p=c.exec(s);)_.push(p[a]);return _}(i,/\((.*?)\)/g)),t=n}}),this.getOptions=function(){return t},this.setOptions=function(r){t=r,this.sort&&t.sort()},this.addOption=function(r){r=(r=r||"").toString(),t.push(r),this.sort&&t.sort()},this.removeOption=function(r,i){for(i=i||!1,r=(r=r||"").toString();t.indexOf(r)!==-1&&(t.splice(t.indexOf(r),1),i!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,18)},set:function(r){r?this.Ff=Wn(this.Ff,18):this.Ff=Xn(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,19)},set:function(r){this.combo===!0&&(r?this.Ff=Wn(this.Ff,19):this.Ff=Xn(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,20)},set:function(r){r?(this.Ff=Wn(this.Ff,20),t.sort()):this.Ff=Xn(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,22)},set:function(r){r?this.Ff=Wn(this.Ff,22):this.Ff=Xn(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,23)},set:function(r){r?this.Ff=Wn(this.Ff,23):this.Ff=Xn(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,27)},set:function(r){r?this.Ff=Wn(this.Ff,27):this.Ff=Xn(this.Ff,27)}}),this.hasAppearanceStream=!1};Pa(em,Cc);var rm=function(){em.call(this),this.fontName="helvetica",this.combo=!1};Pa(rm,em);var im=function(){rm.call(this),this.combo=!0};Pa(im,rm);var Gy=function(){im.call(this),this.edit=!0};Pa(Gy,im);var Ds=function(){Cc.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,15)},set:function(r){r?this.Ff=Wn(this.Ff,15):this.Ff=Xn(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,16)},set:function(r){r?this.Ff=Wn(this.Ff,16):this.Ff=Xn(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,17)},set:function(r){r?this.Ff=Wn(this.Ff,17):this.Ff=Xn(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,26)},set:function(r){r?this.Ff=Wn(this.Ff,26):this.Ff=Xn(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(s){return s};if(this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var i,n=[];for(i in n.push("<<"),t)n.push("/"+i+" ("+Up(r(t[i]))+")");return n.push(">>"),n.join(`
`)}},set:function(r){Ui(r)==="object"&&(t=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(r){typeof r=="string"&&(t.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(r){e="/"+r}})};Pa(Ds,Cc);var Vy=function(){Ds.call(this),this.pushButton=!0};Pa(Vy,Ds);var nm=function(){Ds.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t!==void 0?t:[]}})};Pa(nm,Ds);var G_=function(){var e,t;Cc.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(n){e=n}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(n){t=n}});var r,i={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var n=function(a){return a};this.scope&&(n=this.scope.internal.getEncryptor(this.objId));var s,c=[];for(s in c.push("<<"),i)c.push("/"+s+" ("+Up(n(i[s]))+")");return c.push(">>"),c.join(`
`)},set:function(n){Ui(n)==="object"&&(i=n)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return i.CA||""},set:function(n){typeof n=="string"&&(i.CA=n)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(n){r=n}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(n){r="/"+n}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=ur.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Pa(G_,Cc),nm.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var r=this.Kids[t];r.appearanceStreamContent=e.createAppearanceStream(r.optionName),r.caption=e.getCA()}},nm.prototype.createOption=function(e){var t=new G_;return t.Parent=this,t.optionName=e,this.Kids.push(t),crt.call(this.scope,t),t};var qy=function(){Ds.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=ur.CheckBox.createAppearanceStream()};Pa(qy,Ds);var Sp=function(){Cc.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,13)},set:function(t){t?this.Ff=Wn(this.Ff,13):this.Ff=Xn(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,21)},set:function(t){t?this.Ff=Wn(this.Ff,21):this.Ff=Xn(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,23)},set:function(t){t?this.Ff=Wn(this.Ff,23):this.Ff=Xn(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,24)},set:function(t){t?this.Ff=Wn(this.Ff,24):this.Ff=Xn(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,25)},set:function(t){t?this.Ff=Wn(this.Ff,25):this.Ff=Xn(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,26)},set:function(t){t?this.Ff=Wn(this.Ff,26):this.Ff=Xn(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Pa(Sp,Cc);var Hy=function(){Sp.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!$n(this.Ff,14)},set:function(e){e?this.Ff=Wn(this.Ff,14):this.Ff=Xn(this.Ff,14)}}),this.password=!0};Pa(Hy,Sp);var ur={CheckBox:{createAppearanceStream:function(){return{N:{On:ur.CheckBox.YesNormal},D:{On:ur.CheckBox.YesPushDown,Off:ur.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=mu(e);t.scope=e.scope;var r=[],i=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color),s=Qx(e,e.caption);return r.push("0.749023 g"),r.push("0 0 "+qr(ur.internal.getWidth(e))+" "+qr(ur.internal.getHeight(e))+" re"),r.push("f"),r.push("BMC"),r.push("q"),r.push("0 0 1 rg"),r.push("/"+i+" "+qr(s.fontSize)+" Tf "+n),r.push("BT"),r.push(s.text),r.push("ET"),r.push("Q"),r.push("EMC"),t.stream=r.join(`
`),t},YesNormal:function(e){var t=mu(e);t.scope=e.scope;var r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,i=e.scope.__private__.encodeColorString(e.color),n=[],s=ur.internal.getHeight(e),c=ur.internal.getWidth(e),a=Qx(e,e.caption);return n.push("1 g"),n.push("0 0 "+qr(c)+" "+qr(s)+" re"),n.push("f"),n.push("q"),n.push("0 0 1 rg"),n.push("0 0 "+qr(c-1)+" "+qr(s-1)+" re"),n.push("W"),n.push("n"),n.push("0 g"),n.push("BT"),n.push("/"+r+" "+qr(a.fontSize)+" Tf "+i),n.push(a.text),n.push("ET"),n.push("Q"),t.stream=n.join(`
`),t},OffPushDown:function(e){var t=mu(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+qr(ur.internal.getWidth(e))+" "+qr(ur.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:ur.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=ur.RadioButton.Circle.YesNormal,t.D[e]=ur.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=mu(e);t.scope=e.scope;var r=[],i=ur.internal.getWidth(e)<=ur.internal.getHeight(e)?ur.internal.getWidth(e)/4:ur.internal.getHeight(e)/4;i=Number((.9*i).toFixed(5));var n=ur.internal.Bezier_C,s=Number((i*n).toFixed(5));return r.push("q"),r.push("1 0 0 1 "+Qh(ur.internal.getWidth(e)/2)+" "+Qh(ur.internal.getHeight(e)/2)+" cm"),r.push(i+" 0 m"),r.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),r.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),r.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),r.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=mu(e);t.scope=e.scope;var r=[],i=ur.internal.getWidth(e)<=ur.internal.getHeight(e)?ur.internal.getWidth(e)/4:ur.internal.getHeight(e)/4;i=Number((.9*i).toFixed(5));var n=Number((2*i).toFixed(5)),s=Number((n*ur.internal.Bezier_C).toFixed(5)),c=Number((i*ur.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+Qh(ur.internal.getWidth(e)/2)+" "+Qh(ur.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),r.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),r.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),r.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),r.push("f"),r.push("Q"),r.push("0 g"),r.push("q"),r.push("1 0 0 1 "+Qh(ur.internal.getWidth(e)/2)+" "+Qh(ur.internal.getHeight(e)/2)+" cm"),r.push(i+" 0 m"),r.push(i+" "+c+" "+c+" "+i+" 0 "+i+" c"),r.push("-"+c+" "+i+" -"+i+" "+c+" -"+i+" 0 c"),r.push("-"+i+" -"+c+" -"+c+" -"+i+" 0 -"+i+" c"),r.push(c+" -"+i+" "+i+" -"+c+" "+i+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},OffPushDown:function(e){var t=mu(e);t.scope=e.scope;var r=[],i=ur.internal.getWidth(e)<=ur.internal.getHeight(e)?ur.internal.getWidth(e)/4:ur.internal.getHeight(e)/4;i=Number((.9*i).toFixed(5));var n=Number((2*i).toFixed(5)),s=Number((n*ur.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+Qh(ur.internal.getWidth(e)/2)+" "+Qh(ur.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),r.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),r.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),r.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:ur.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=ur.RadioButton.Cross.YesNormal,t.D[e]=ur.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=mu(e);t.scope=e.scope;var r=[],i=ur.internal.calculateCross(e);return r.push("q"),r.push("1 1 "+qr(ur.internal.getWidth(e)-2)+" "+qr(ur.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(qr(i.x1.x)+" "+qr(i.x1.y)+" m"),r.push(qr(i.x2.x)+" "+qr(i.x2.y)+" l"),r.push(qr(i.x4.x)+" "+qr(i.x4.y)+" m"),r.push(qr(i.x3.x)+" "+qr(i.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=mu(e);t.scope=e.scope;var r=ur.internal.calculateCross(e),i=[];return i.push("0.749023 g"),i.push("0 0 "+qr(ur.internal.getWidth(e))+" "+qr(ur.internal.getHeight(e))+" re"),i.push("f"),i.push("q"),i.push("1 1 "+qr(ur.internal.getWidth(e)-2)+" "+qr(ur.internal.getHeight(e)-2)+" re"),i.push("W"),i.push("n"),i.push(qr(r.x1.x)+" "+qr(r.x1.y)+" m"),i.push(qr(r.x2.x)+" "+qr(r.x2.y)+" l"),i.push(qr(r.x4.x)+" "+qr(r.x4.y)+" m"),i.push(qr(r.x3.x)+" "+qr(r.x3.y)+" l"),i.push("s"),i.push("Q"),t.stream=i.join(`
`),t},OffPushDown:function(e){var t=mu(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+qr(ur.internal.getWidth(e))+" "+qr(ur.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+r}};ur.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=ur.internal.getWidth(e),r=ur.internal.getHeight(e),i=Math.min(t,r);return{x1:{x:(t-i)/2,y:(r-i)/2+i},x2:{x:(t-i)/2+i,y:(r-i)/2},x3:{x:(t-i)/2,y:(r-i)/2},x4:{x:(t-i)/2+i,y:(r-i)/2+i}}}},ur.internal.getWidth=function(e){var t=0;return Ui(e)==="object"&&(t=UI(e.Rect[2])),t},ur.internal.getHeight=function(e){var t=0;return Ui(e)==="object"&&(t=UI(e.Rect[3])),t};var crt=On.addField=function(e){if(lrt(this,e),!(e instanceof Cc))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};On.AcroFormChoiceField=em,On.AcroFormListBox=rm,On.AcroFormComboBox=im,On.AcroFormEditBox=Gy,On.AcroFormButton=Ds,On.AcroFormPushButton=Vy,On.AcroFormRadioButton=nm,On.AcroFormCheckBox=qy,On.AcroFormTextField=Sp,On.AcroFormPasswordField=Hy,On.AcroFormAppearance=ur,On.AcroForm={ChoiceField:em,ListBox:rm,ComboBox:im,EditBox:Gy,Button:Ds,PushButton:Vy,RadioButton:nm,CheckBox:qy,TextField:Sp,PasswordField:Hy,Appearance:ur},kr.AcroForm={ChoiceField:em,ListBox:rm,ComboBox:im,EditBox:Gy,Button:Ds,PushButton:Vy,RadioButton:nm,CheckBox:qy,TextField:Sp,PasswordField:Hy,Appearance:ur};function qk(e){return e.reduce(function(t,r,i){return t[r]=i,t},{})}(function(e){e.__addimage__={};var t="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},i=e.__addimage__.getImageFileTypeByImageData=function(at,dt){var It,xt,re,ee,se,Ot=t;if((dt=dt||t)==="RGBA"||at.data!==void 0&&at.data instanceof Uint8ClampedArray&&"height"in at&&"width"in at)return"RGBA";if(bt(at))for(se in r)for(re=r[se],It=0;It<re.length;It+=1){for(ee=!0,xt=0;xt<re[It].length;xt+=1)if(re[It][xt]!==void 0&&re[It][xt]!==at[xt]){ee=!1;break}if(ee===!0){Ot=se;break}}else for(se in r)for(re=r[se],It=0;It<re.length;It+=1){for(ee=!0,xt=0;xt<re[It].length;xt+=1)if(re[It][xt]!==void 0&&re[It][xt]!==at.charCodeAt(xt)){ee=!1;break}if(ee===!0){Ot=se;break}}return Ot===t&&dt!==t&&(Ot=dt),Ot},n=function at(dt){for(var It=this.internal.write,xt=this.internal.putStream,re=(0,this.internal.getFilters)();re.indexOf("FlateEncode")!==-1;)re.splice(re.indexOf("FlateEncode"),1);dt.objectId=this.internal.newObject();var ee=[];if(ee.push({key:"Type",value:"/XObject"}),ee.push({key:"Subtype",value:"/Image"}),ee.push({key:"Width",value:dt.width}),ee.push({key:"Height",value:dt.height}),dt.colorSpace===W.INDEXED?ee.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(dt.palette.length/3-1)+" "+("sMask"in dt&&dt.sMask!==void 0?dt.objectId+2:dt.objectId+1)+" 0 R]"}):(ee.push({key:"ColorSpace",value:"/"+dt.colorSpace}),dt.colorSpace===W.DEVICE_CMYK&&ee.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),ee.push({key:"BitsPerComponent",value:dt.bitsPerComponent}),"decodeParameters"in dt&&dt.decodeParameters!==void 0&&ee.push({key:"DecodeParms",value:"<<"+dt.decodeParameters+">>"}),"transparency"in dt&&Array.isArray(dt.transparency)){for(var se="",Ot=0,Xt=dt.transparency.length;Ot<Xt;Ot++)se+=dt.transparency[Ot]+" "+dt.transparency[Ot]+" ";ee.push({key:"Mask",value:"["+se+"]"})}dt.sMask!==void 0&&ee.push({key:"SMask",value:dt.objectId+1+" 0 R"});var Wt=dt.filter!==void 0?["/"+dt.filter]:void 0;if(xt({data:dt.data,additionalKeyValues:ee,alreadyAppliedFilters:Wt,objectId:dt.objectId}),It("endobj"),"sMask"in dt&&dt.sMask!==void 0){var xe="/Predictor "+dt.predictor+" /Colors 1 /BitsPerComponent "+dt.bitsPerComponent+" /Columns "+dt.width,it={width:dt.width,height:dt.height,colorSpace:"DeviceGray",bitsPerComponent:dt.bitsPerComponent,decodeParameters:xe,data:dt.sMask};"filter"in dt&&(it.filter=dt.filter),at.call(this,it)}if(dt.colorSpace===W.INDEXED){var Et=this.internal.newObject();xt({data:mt(new Uint8Array(dt.palette)),objectId:Et}),It("endobj")}},s=function(){var at=this.internal.collections.addImage_images;for(var dt in at)n.call(this,at[dt])},c=function(){var at,dt=this.internal.collections.addImage_images,It=this.internal.write;for(var xt in dt)It("/I"+(at=dt[xt]).index,at.objectId,"0","R")},a=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",s),this.internal.events.subscribe("putXobjectDict",c))},p=function(){var at=this.internal.collections.addImage_images;return a.call(this),at},_=function(){return Object.keys(this.internal.collections.addImage_images).length},w=function(at){return typeof e["process"+at.toUpperCase()]=="function"},S=function(at){return Ui(at)==="object"&&at.nodeType===1},C=function(at,dt){if(at.nodeName==="IMG"&&at.hasAttribute("src")){var It=""+at.getAttribute("src");if(It.indexOf("data:image/")===0)return n0(unescape(It).split("base64,").pop());var xt=e.loadFile(It,!0);if(xt!==void 0)return xt}if(at.nodeName==="CANVAS"){if(at.width===0||at.height===0)throw new Error("Given canvas must have data. Canvas width: "+at.width+", height: "+at.height);var re;switch(dt){case"PNG":re="image/png";break;case"WEBP":re="image/webp";break;case"JPEG":case"JPG":default:re="image/jpeg"}return n0(at.toDataURL(re,1).split("base64,").pop())}},I=function(at){var dt=this.internal.collections.addImage_images;if(dt){for(var It in dt)if(at===dt[It].alias)return dt[It]}},N=function(at,dt,It){return at||dt||(at=-96,dt=-96),at<0&&(at=-1*It.width*72/at/this.internal.scaleFactor),dt<0&&(dt=-1*It.height*72/dt/this.internal.scaleFactor),at===0&&(at=dt*It.width/It.height),dt===0&&(dt=at*It.height/It.width),[at,dt]},F=function(at,dt,It,xt,re,ee){var se=N.call(this,It,xt,re),Ot=this.internal.getCoordinateString,Xt=this.internal.getVerticalCoordinateString,Wt=p.call(this);if(It=se[0],xt=se[1],Wt[re.index]=re,ee){ee*=Math.PI/180;var xe=Math.cos(ee),it=Math.sin(ee),Et=function(jt){return jt.toFixed(4)},Pt=[Et(xe),Et(it),Et(-1*it),Et(xe),0,0,"cm"]}this.internal.write("q"),ee?(this.internal.write([1,"0","0",1,Ot(at),Xt(dt+xt),"cm"].join(" ")),this.internal.write(Pt.join(" ")),this.internal.write([Ot(It),"0","0",Ot(xt),"0","0","cm"].join(" "))):this.internal.write([Ot(It),"0","0",Ot(xt),Ot(at),Xt(dt+xt),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+re.index+" Do"),this.internal.write("Q")},W=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var U=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},z=e.__addimage__.sHashCode=function(at){var dt,It,xt=0;if(typeof at=="string")for(It=at.length,dt=0;dt<It;dt++)xt=(xt<<5)-xt+at.charCodeAt(dt),xt|=0;else if(bt(at))for(It=at.byteLength/2,dt=0;dt<It;dt++)xt=(xt<<5)-xt+at[dt],xt|=0;return xt},H=e.__addimage__.validateStringAsBase64=function(at){(at=at||"").toString().trim();var dt=!0;return at.length===0&&(dt=!1),at.length%4!=0&&(dt=!1),/^[A-Za-z0-9+/]+$/.test(at.substr(0,at.length-2))===!1&&(dt=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(at.substr(-2))===!1&&(dt=!1),dt},nt=e.__addimage__.extractImageFromDataUrl=function(at){var dt=(at=at||"").split("base64,"),It=null;if(dt.length===2){var xt=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(dt[0]);Array.isArray(xt)&&(It={mimeType:xt[1],charset:xt[2],data:dt[1]})}return It},yt=e.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};e.__addimage__.isArrayBuffer=function(at){return yt()&&at instanceof ArrayBuffer};var bt=e.__addimage__.isArrayBufferView=function(at){return yt()&&typeof Uint32Array<"u"&&(at instanceof Int8Array||at instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&at instanceof Uint8ClampedArray||at instanceof Int16Array||at instanceof Uint16Array||at instanceof Int32Array||at instanceof Uint32Array||at instanceof Float32Array||at instanceof Float64Array)},vt=e.__addimage__.binaryStringToUint8Array=function(at){for(var dt=at.length,It=new Uint8Array(dt),xt=0;xt<dt;xt++)It[xt]=at.charCodeAt(xt);return It},mt=e.__addimage__.arrayBufferToBinaryString=function(at){for(var dt="",It=bt(at)?at:new Uint8Array(at),xt=0;xt<It.length;xt+=8192)dt+=String.fromCharCode.apply(null,It.subarray(xt,xt+8192));return dt};e.addImage=function(){var at,dt,It,xt,re,ee,se,Ot,Xt;if(typeof arguments[1]=="number"?(dt=t,It=arguments[1],xt=arguments[2],re=arguments[3],ee=arguments[4],se=arguments[5],Ot=arguments[6],Xt=arguments[7]):(dt=arguments[1],It=arguments[2],xt=arguments[3],re=arguments[4],ee=arguments[5],se=arguments[6],Ot=arguments[7],Xt=arguments[8]),Ui(at=arguments[0])==="object"&&!S(at)&&"imageData"in at){var Wt=at;at=Wt.imageData,dt=Wt.format||dt||t,It=Wt.x||It||0,xt=Wt.y||xt||0,re=Wt.w||Wt.width||re,ee=Wt.h||Wt.height||ee,se=Wt.alias||se,Ot=Wt.compression||Ot,Xt=Wt.rotation||Wt.angle||Xt}var xe=this.internal.getFilters();if(Ot===void 0&&xe.indexOf("FlateEncode")!==-1&&(Ot="SLOW"),isNaN(It)||isNaN(xt))throw new Error("Invalid coordinates passed to jsPDF.addImage");a.call(this);var it=Dt.call(this,at,dt,se,Ot);return F.call(this,It,xt,re,ee,it,Xt),this};var Dt=function(at,dt,It,xt){var re,ee,se;if(typeof at=="string"&&i(at)===t){at=unescape(at);var Ot=kt(at,!1);(Ot!==""||(Ot=e.loadFile(at,!0))!==void 0)&&(at=Ot)}if(S(at)&&(at=C(at,dt)),dt=i(at,dt),!w(dt))throw new Error("addImage does not support files of type '"+dt+"', please ensure that a plugin for '"+dt+"' support is added.");if(((se=It)==null||se.length===0)&&(It=function(Xt){return typeof Xt=="string"||bt(Xt)?z(Xt):bt(Xt.data)?z(Xt.data):null}(at)),(re=I.call(this,It))||(yt()&&(at instanceof Uint8Array||dt==="RGBA"||(ee=at,at=vt(at))),re=this["process"+dt.toUpperCase()](at,_.call(this),It,function(Xt){return Xt&&typeof Xt=="string"&&(Xt=Xt.toUpperCase()),Xt in e.image_compression?Xt:U.NONE}(xt),ee)),!re)throw new Error("An unknown error occurred whilst processing the image.");return re},kt=e.__addimage__.convertBase64ToBinaryString=function(at,dt){var It;dt=typeof dt!="boolean"||dt;var xt,re="";if(typeof at=="string"){xt=(It=nt(at))!==null?It.data:at;try{re=n0(xt)}catch(ee){if(dt)throw H(xt)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+ee.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return re};e.getImageProperties=function(at){var dt,It,xt="";if(S(at)&&(at=C(at)),typeof at=="string"&&i(at)===t&&((xt=kt(at,!1))===""&&(xt=e.loadFile(at)||""),at=xt),It=i(at),!w(It))throw new Error("addImage does not support files of type '"+It+"', please ensure that a plugin for '"+It+"' support is added.");if(!yt()||at instanceof Uint8Array||(at=vt(at)),!(dt=this["process"+It.toUpperCase()](at)))throw new Error("An unknown error occurred whilst processing the image");return dt.fileType=It,dt}})(kr.API),function(e){var t=function(r){if(r!==void 0&&r!="")return!0};kr.API.events.push(["addPage",function(r){this.internal.getPageInfo(r.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(r){for(var i,n,s,c=this.internal.getCoordinateString,a=this.internal.getVerticalCoordinateString,p=this.internal.getPageInfoByObjId(r.objId),_=r.pageContext.annotations,w=!1,S=0;S<_.length&&!w;S++)switch((i=_[S]).type){case"link":(t(i.options.url)||t(i.options.pageNumber))&&(w=!0);break;case"reference":case"text":case"freetext":w=!0}if(w!=0){this.internal.write("/Annots [");for(var C=0;C<_.length;C++){i=_[C];var I=this.internal.pdfEscape,N=this.internal.getEncryptor(r.objId);switch(i.type){case"reference":this.internal.write(" "+i.object.objId+" 0 R ");break;case"text":var F=this.internal.newAdditionalObject(),W=this.internal.newAdditionalObject(),U=this.internal.getEncryptor(F.objId),z=i.title||"Note";s="<</Type /Annot /Subtype /Text "+(n="/Rect ["+c(i.bounds.x)+" "+a(i.bounds.y+i.bounds.h)+" "+c(i.bounds.x+i.bounds.w)+" "+a(i.bounds.y)+"] ")+"/Contents ("+I(U(i.contents))+")",s+=" /Popup "+W.objId+" 0 R",s+=" /P "+p.objId+" 0 R",s+=" /T ("+I(U(z))+") >>",F.content=s;var H=F.objId+" 0 R";s="<</Type /Annot /Subtype /Popup "+(n="/Rect ["+c(i.bounds.x+30)+" "+a(i.bounds.y+i.bounds.h)+" "+c(i.bounds.x+i.bounds.w+30)+" "+a(i.bounds.y)+"] ")+" /Parent "+H,i.open&&(s+=" /Open true"),s+=" >>",W.content=s,this.internal.write(F.objId,"0 R",W.objId,"0 R");break;case"freetext":n="/Rect ["+c(i.bounds.x)+" "+a(i.bounds.y)+" "+c(i.bounds.x+i.bounds.w)+" "+a(i.bounds.y+i.bounds.h)+"] ";var nt=i.color||"#000000";s="<</Type /Annot /Subtype /FreeText "+n+"/Contents ("+I(N(i.contents))+")",s+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+nt+")",s+=" /Border [0 0 0]",s+=" >>",this.internal.write(s);break;case"link":if(i.options.name){var yt=this.annotations._nameMap[i.options.name];i.options.pageNumber=yt.page,i.options.top=yt.y}else i.options.top||(i.options.top=0);if(n="/Rect ["+i.finalBounds.x+" "+i.finalBounds.y+" "+i.finalBounds.w+" "+i.finalBounds.h+"] ",s="",i.options.url)s="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /A <</S /URI /URI ("+I(N(i.options.url))+") >>";else if(i.options.pageNumber)switch(s="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(i.options.pageNumber).objId+" 0 R",i.options.magFactor=i.options.magFactor||"XYZ",i.options.magFactor){case"Fit":s+=" /Fit]";break;case"FitH":s+=" /FitH "+i.options.top+"]";break;case"FitV":i.options.left=i.options.left||0,s+=" /FitV "+i.options.left+"]";break;case"XYZ":default:var bt=a(i.options.top);i.options.left=i.options.left||0,i.options.zoom===void 0&&(i.options.zoom=0),s+=" /XYZ "+i.options.left+" "+bt+" "+i.options.zoom+"]"}s!=""&&(s+=" >>",this.internal.write(s))}}this.internal.write("]")}}]),e.createAnnotation=function(r){var i=this.internal.getCurrentPageInfo();switch(r.type){case"link":this.link(r.bounds.x,r.bounds.y,r.bounds.w,r.bounds.h,r);break;case"text":case"freetext":i.pageContext.annotations.push(r)}},e.link=function(r,i,n,s,c){var a=this.internal.getCurrentPageInfo(),p=this.internal.getCoordinateString,_=this.internal.getVerticalCoordinateString;a.pageContext.annotations.push({finalBounds:{x:p(r),y:_(i),w:p(r+n),h:_(i+s)},options:c,type:"link"})},e.textWithLink=function(r,i,n,s){var c,a,p=this.getTextWidth(r),_=this.internal.getLineHeight()/this.internal.scaleFactor;if(s.maxWidth!==void 0){a=s.maxWidth;var w=this.splitTextToSize(r,a).length;c=Math.ceil(_*w)}else a=p,c=_;return this.text(r,i,n,s),n+=.2*_,s.align==="center"&&(i-=p/2),s.align==="right"&&(i-=p),this.link(i,n-_,a,c,s),p},e.getTextWidth=function(r){var i=this.internal.getFontSize();return this.getStringUnitWidth(r)*i/this.internal.scaleFactor}}(kr.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},r={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},i={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},n=[1570,1571,1573,1575];e.__arabicParser__={};var s=e.__arabicParser__.isInArabicSubstitutionA=function(F){return t[F.charCodeAt(0)]!==void 0},c=e.__arabicParser__.isArabicLetter=function(F){return typeof F=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(F)},a=e.__arabicParser__.isArabicEndLetter=function(F){return c(F)&&s(F)&&t[F.charCodeAt(0)].length<=2},p=e.__arabicParser__.isArabicAlfLetter=function(F){return c(F)&&n.indexOf(F.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(F){return c(F)&&s(F)&&t[F.charCodeAt(0)].length>=1};var _=e.__arabicParser__.arabicLetterHasFinalForm=function(F){return c(F)&&s(F)&&t[F.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(F){return c(F)&&s(F)&&t[F.charCodeAt(0)].length>=3};var w=e.__arabicParser__.arabicLetterHasMedialForm=function(F){return c(F)&&s(F)&&t[F.charCodeAt(0)].length==4},S=e.__arabicParser__.resolveLigatures=function(F){var W=0,U=r,z="",H=0;for(W=0;W<F.length;W+=1)U[F.charCodeAt(W)]!==void 0?(H++,typeof(U=U[F.charCodeAt(W)])=="number"&&(z+=String.fromCharCode(U),U=r,H=0),W===F.length-1&&(U=r,z+=F.charAt(W-(H-1)),W-=H-1,H=0)):(U=r,z+=F.charAt(W-H),W-=H,H=0);return z};e.__arabicParser__.isArabicDiacritic=function(F){return F!==void 0&&i[F.charCodeAt(0)]!==void 0};var C=e.__arabicParser__.getCorrectForm=function(F,W,U){return c(F)?s(F)===!1?-1:!_(F)||!c(W)&&!c(U)||!c(U)&&a(W)||a(F)&&!c(W)||a(F)&&p(W)||a(F)&&a(W)?0:w(F)&&c(W)&&!a(W)&&c(U)&&_(U)?3:a(F)||!c(U)?1:2:-1},I=function(F){var W=0,U=0,z=0,H="",nt="",yt="",bt=(F=F||"").split("\\s+"),vt=[];for(W=0;W<bt.length;W+=1){for(vt.push(""),U=0;U<bt[W].length;U+=1)H=bt[W][U],nt=bt[W][U-1],yt=bt[W][U+1],c(H)?(z=C(H,nt,yt),vt[W]+=z!==-1?String.fromCharCode(t[H.charCodeAt(0)][z]):H):vt[W]+=H;vt[W]=S(vt[W])}return vt.join(" ")},N=e.__arabicParser__.processArabic=e.processArabic=function(){var F,W=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,U=[];if(Array.isArray(W)){var z=0;for(U=[],z=0;z<W.length;z+=1)Array.isArray(W[z])?U.push([I(W[z][0]),W[z][1],W[z][2]]):U.push([I(W[z])]);F=U}else F=I(W);return typeof arguments[0]=="string"?F:(arguments[0].text=F,arguments[0])};e.events.push(["preProcessText",N])}(kr.API),kr.API.autoPrint=function(e){var t;switch((e=e||{}).variant=e.variant||"non-conform",e.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})}return this},function(e){var t=function(){var r=void 0;Object.defineProperty(this,"pdf",{get:function(){return r},set:function(a){r=a}});var i=150;Object.defineProperty(this,"width",{get:function(){return i},set:function(a){i=isNaN(a)||Number.isInteger(a)===!1||a<0?150:a,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=i+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(a){n=isNaN(a)||Number.isInteger(a)===!1||a<0?300:a,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var s=[];Object.defineProperty(this,"childNodes",{get:function(){return s},set:function(a){s=a}});var c={};Object.defineProperty(this,"style",{get:function(){return c},set:function(a){c=a}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(r,i){var n;if((r=r||"2d")!=="2d")return null;for(n in i)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=i[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(kr.API),function(e){var t={left:0,top:0,bottom:0,right:0},r=!1,i=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),n.call(this))},n=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var p=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return p},set:function(F){p=F}});var _=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return _},set:function(F){_=F}});var w=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return w},set:function(F){w=F}});var S=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return S},set:function(F){S=F}});var C=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return C},set:function(F){C=F}});var I=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return I},set:function(F){I=F}});var N=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return N},set:function(F){N=F}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(p){return i.call(this),this.internal.__cell__.headerFunction=typeof p=="function"?p:void 0,this},e.getTextDimensions=function(p,_){i.call(this);var w=(_=_||{}).fontSize||this.getFontSize(),S=_.font||this.getFont(),C=_.scaleFactor||this.internal.scaleFactor,I=0,N=0,F=0,W=this;if(!Array.isArray(p)&&typeof p!="string"){if(typeof p!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");p=String(p)}var U=_.maxWidth;U>0?typeof p=="string"?p=this.splitTextToSize(p,U):Object.prototype.toString.call(p)==="[object Array]"&&(p=p.reduce(function(H,nt){return H.concat(W.splitTextToSize(nt,U))},[])):p=Array.isArray(p)?p:[p];for(var z=0;z<p.length;z++)I<(F=this.getStringUnitWidth(p[z],{font:S})*w)&&(I=F);return I!==0&&(N=p.length),{w:I/=C,h:Math.max((N*w*this.getLineHeightFactor()-w*(this.getLineHeightFactor()-1))/C,0)}},e.cellAddPage=function(){i.call(this),this.addPage();var p=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new s(p.left,p.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var c=e.cell=function(){var p;p=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),i.call(this);var _=this.internal.__cell__.lastCell,w=this.internal.__cell__.padding,S=this.internal.__cell__.margins||t,C=this.internal.__cell__.tableHeaderRow,I=this.internal.__cell__.printHeaders;return _.lineNumber!==void 0&&(_.lineNumber===p.lineNumber?(p.x=(_.x||0)+(_.width||0),p.y=_.y||0):_.y+_.height+p.height+S.bottom>this.getPageHeight()?(this.cellAddPage(),p.y=S.top,I&&C&&(this.printHeaderRow(p.lineNumber,!0),p.y+=C[0].height)):p.y=_.y+_.height||p.y),p.text[0]!==void 0&&(this.rect(p.x,p.y,p.width,p.height,r===!0?"FD":void 0),p.align==="right"?this.text(p.text,p.x+p.width-w,p.y+w,{align:"right",baseline:"top"}):p.align==="center"?this.text(p.text,p.x+p.width/2,p.y+w,{align:"center",baseline:"top",maxWidth:p.width-w-w}):this.text(p.text,p.x+w,p.y+w,{align:"left",baseline:"top",maxWidth:p.width-w-w})),this.internal.__cell__.lastCell=p,this};e.table=function(p,_,w,S,C){if(i.call(this),!w)throw new Error("No data for PDF table.");var I,N,F,W,U=[],z=[],H=[],nt={},yt={},bt=[],vt=[],mt=(C=C||{}).autoSize||!1,Dt=C.printHeaders!==!1,kt=C.css&&C.css["font-size"]!==void 0?16*C.css["font-size"]:C.fontSize||12,at=C.margins||Object.assign({width:this.getPageWidth()},t),dt=typeof C.padding=="number"?C.padding:3,It=C.headerBackgroundColor||"#c8c8c8",xt=C.headerTextColor||"#000";if(n.call(this),this.internal.__cell__.printHeaders=Dt,this.internal.__cell__.margins=at,this.internal.__cell__.table_font_size=kt,this.internal.__cell__.padding=dt,this.internal.__cell__.headerBackgroundColor=It,this.internal.__cell__.headerTextColor=xt,this.setFontSize(kt),S==null)z=U=Object.keys(w[0]),H=U.map(function(){return"left"});else if(Array.isArray(S)&&Ui(S[0])==="object")for(U=S.map(function(Wt){return Wt.name}),z=S.map(function(Wt){return Wt.prompt||Wt.name||""}),H=S.map(function(Wt){return Wt.align||"left"}),I=0;I<S.length;I+=1)yt[S[I].name]=S[I].width*(19.049976/25.4);else Array.isArray(S)&&typeof S[0]=="string"&&(z=U=S,H=U.map(function(){return"left"}));if(mt||Array.isArray(S)&&typeof S[0]=="string")for(I=0;I<U.length;I+=1){for(nt[W=U[I]]=w.map(function(Wt){return Wt[W]}),this.setFont(void 0,"bold"),bt.push(this.getTextDimensions(z[I],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),N=nt[W],this.setFont(void 0,"normal"),F=0;F<N.length;F+=1)bt.push(this.getTextDimensions(N[F],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);yt[W]=Math.max.apply(null,bt)+dt+dt,bt=[]}if(Dt){var re={};for(I=0;I<U.length;I+=1)re[U[I]]={},re[U[I]].text=z[I],re[U[I]].align=H[I];var ee=a.call(this,re,yt);vt=U.map(function(Wt){return new s(p,_,yt[Wt],ee,re[Wt].text,void 0,re[Wt].align)}),this.setTableHeaderRow(vt),this.printHeaderRow(1,!1)}var se=S.reduce(function(Wt,xe){return Wt[xe.name]=xe.align,Wt},{});for(I=0;I<w.length;I+=1){"rowStart"in C&&C.rowStart instanceof Function&&C.rowStart({row:I,data:w[I]},this);var Ot=a.call(this,w[I],yt);for(F=0;F<U.length;F+=1){var Xt=w[I][U[F]];"cellStart"in C&&C.cellStart instanceof Function&&C.cellStart({row:I,col:F,data:Xt},this),c.call(this,new s(p,_,yt[U[F]],Ot,Xt,I+2,se[U[F]]))}}return this.internal.__cell__.table_x=p,this.internal.__cell__.table_y=_,this};var a=function(p,_){var w=this.internal.__cell__.padding,S=this.internal.__cell__.table_font_size,C=this.internal.scaleFactor;return Object.keys(p).map(function(I){var N=p[I];return this.splitTextToSize(N.hasOwnProperty("text")?N.text:N,_[I]-w-w)},this).map(function(I){return this.getLineHeightFactor()*I.length*S/C+w+w},this).reduce(function(I,N){return Math.max(I,N)},0)};e.setTableHeaderRow=function(p){i.call(this),this.internal.__cell__.tableHeaderRow=p},e.printHeaderRow=function(p,_){if(i.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var w;if(r=!0,typeof this.internal.__cell__.headerFunction=="function"){var S=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(S[0],S[1],S[2],S[3],void 0,-1)}this.setFont(void 0,"bold");for(var C=[],I=0;I<this.internal.__cell__.tableHeaderRow.length;I+=1){w=this.internal.__cell__.tableHeaderRow[I].clone(),_&&(w.y=this.internal.__cell__.margins.top||0,C.push(w)),w.lineNumber=p;var N=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),c.call(this,w),this.setTextColor(N)}C.length>0&&this.setTableHeaderRow(C),this.setFont(void 0,"normal"),r=!1}}(kr.API);var Hk={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},$k=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],t5=qk($k),Wk=[100,200,300,400,500,600,700,800,900],urt=qk(Wk);function e5(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),r=function(s){return Hk[s=s||"normal"]?s:"normal"}(e.style),i=function(s){if(!s)return 400;if(typeof s=="number")return s>=100&&s<=900&&s%100==0?s:400;if(/^\d00$/.test(s))return parseInt(s);switch(s){case"bold":return 700;case"normal":default:return 400}}(e.weight),n=function(s){return typeof t5[s=s||"normal"]=="number"?s:"normal"}(e.stretch);return{family:t,style:r,weight:i,stretch:n,src:e.src||[],ref:e.ref||{name:t,style:[n,r,i].join(" ")}}}function GI(e,t,r,i){var n;for(n=r;n>=0&&n<t.length;n+=i)if(e[t[n]])return e[t[n]];for(n=r;n>=0&&n<t.length;n-=i)if(e[t[n]])return e[t[n]]}var hrt={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},VI={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function qI(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function drt(e,t,r){for(var i=(r=r||{}).defaultFontFamily||"times",n=Object.assign({},hrt,r.genericFontFamilies||{}),s=null,c=null,a=0;a<t.length;++a)if(n[(s=e5(t[a])).family]&&(s.family=n[s.family]),e.hasOwnProperty(s.family)){c=e[s.family];break}if(!(c=c||e[i]))throw new Error("Could not find a font-family for the rule '"+qI(s)+"' and default family '"+i+"'.");if(c=function(p,_){if(_[p])return _[p];var w=t5[p],S=w<=t5.normal?-1:1,C=GI(_,$k,w,S);if(!C)throw new Error("Could not find a matching font-stretch value for "+p);return C}(s.stretch,c),c=function(p,_){if(_[p])return _[p];for(var w=Hk[p],S=0;S<w.length;++S)if(_[w[S]])return _[w[S]];throw new Error("Could not find a matching font-style for "+p)}(s.style,c),!(c=function(p,_){if(_[p])return _[p];if(p===400&&_[500])return _[500];if(p===500&&_[400])return _[400];var w=urt[p],S=GI(_,Wk,w,p<400?-1:1);if(!S)throw new Error("Could not find a matching font-weight for value "+p);return S}(s.weight,c)))throw new Error("Failed to resolve a font for the rule '"+qI(s)+"'.");return c}function HI(e){return e.trimLeft()}function prt(e,t){for(var r=0;r<e.length;){if(e.charAt(r)===t)return[e.substring(0,r),e.substring(r+1)];r+=1}return null}function frt(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],e.substring(t[0].length)]}var gy,$I,WI,XI=["times"];(function(e){var t,r,i,n,s,c,a,p,_,w=function(it){return it=it||{},this.isStrokeTransparent=it.isStrokeTransparent||!1,this.strokeOpacity=it.strokeOpacity||1,this.strokeStyle=it.strokeStyle||"#000000",this.fillStyle=it.fillStyle||"#000000",this.isFillTransparent=it.isFillTransparent||!1,this.fillOpacity=it.fillOpacity||1,this.font=it.font||"10px sans-serif",this.textBaseline=it.textBaseline||"alphabetic",this.textAlign=it.textAlign||"left",this.lineWidth=it.lineWidth||1,this.lineJoin=it.lineJoin||"miter",this.lineCap=it.lineCap||"butt",this.path=it.path||[],this.transform=it.transform!==void 0?it.transform.clone():new p,this.globalCompositeOperation=it.globalCompositeOperation||"normal",this.globalAlpha=it.globalAlpha||1,this.clip_path=it.clip_path||[],this.currentPoint=it.currentPoint||new c,this.miterLimit=it.miterLimit||10,this.lastPoint=it.lastPoint||new c,this.lineDashOffset=it.lineDashOffset||0,this.lineDash=it.lineDash||[],this.margin=it.margin||[0,0,0,0],this.prevPageLastElemOffset=it.prevPageLastElemOffset||0,this.ignoreClearRect=typeof it.ignoreClearRect!="boolean"||it.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new S(this),t=this.internal.f2,r=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,n=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,c=this.internal.Point,a=this.internal.Rectangle,p=this.internal.Matrix,_=new w}]);var S=function(it){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Et=it;Object.defineProperty(this,"pdf",{get:function(){return Et}});var Pt=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Pt},set:function(le){Pt=!!le}});var jt=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return jt},set:function(le){jt=!!le}});var qt=0;Object.defineProperty(this,"posX",{get:function(){return qt},set:function(le){isNaN(le)||(qt=le)}});var $t=0;Object.defineProperty(this,"posY",{get:function(){return $t},set:function(le){isNaN(le)||($t=le)}}),Object.defineProperty(this,"margin",{get:function(){return _.margin},set:function(le){var st;typeof le=="number"?st=[le,le,le,le]:((st=new Array(4))[0]=le[0],st[1]=le.length>=2?le[1]:st[0],st[2]=le.length>=3?le[2]:st[0],st[3]=le.length>=4?le[3]:st[1]),_.margin=st}});var Qt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Qt},set:function(le){Qt=le}});var Kt=0;Object.defineProperty(this,"lastBreak",{get:function(){return Kt},set:function(le){Kt=le}});var Ee=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Ee},set:function(le){Ee=le}}),Object.defineProperty(this,"ctx",{get:function(){return _},set:function(le){le instanceof w&&(_=le)}}),Object.defineProperty(this,"path",{get:function(){return _.path},set:function(le){_.path=le}});var Me=[];Object.defineProperty(this,"ctxStack",{get:function(){return Me},set:function(le){Me=le}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(le){var st;st=C(le),this.ctx.fillStyle=st.style,this.ctx.isFillTransparent=st.a===0,this.ctx.fillOpacity=st.a,this.pdf.setFillColor(st.r,st.g,st.b,{a:st.a}),this.pdf.setTextColor(st.r,st.g,st.b,{a:st.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(le){var st=C(le);this.ctx.strokeStyle=st.style,this.ctx.isStrokeTransparent=st.a===0,this.ctx.strokeOpacity=st.a,st.a===0?this.pdf.setDrawColor(255,255,255):(st.a,this.pdf.setDrawColor(st.r,st.g,st.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(le){["butt","round","square"].indexOf(le)!==-1&&(this.ctx.lineCap=le,this.pdf.setLineCap(le))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(le){isNaN(le)||(this.ctx.lineWidth=le,this.pdf.setLineWidth(le))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(le){["bevel","round","miter"].indexOf(le)!==-1&&(this.ctx.lineJoin=le,this.pdf.setLineJoin(le))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(le){isNaN(le)||(this.ctx.miterLimit=le,this.pdf.setMiterLimit(le))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(le){this.ctx.textBaseline=le}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(le){["right","end","center","left","start"].indexOf(le)!==-1&&(this.ctx.textAlign=le)}});var De=null;function ze(le,st){if(De===null){var mr=function(Qe){var de=[];return Object.keys(Qe).forEach(function(Te){Qe[Te].forEach(function(Be){var Ne=null;switch(Be){case"bold":Ne={family:Te,weight:"bold"};break;case"italic":Ne={family:Te,style:"italic"};break;case"bolditalic":Ne={family:Te,weight:"bold",style:"italic"};break;case"":case"normal":Ne={family:Te}}Ne!==null&&(Ne.ref={name:Te,style:Be},de.push(Ne))})}),de}(le.getFontList());De=function(Qe){for(var de={},Te=0;Te<Qe.length;++Te){var Be=e5(Qe[Te]),Ne=Be.family,rr=Be.stretch,Er=Be.style,wr=Be.weight;de[Ne]=de[Ne]||{},de[Ne][rr]=de[Ne][rr]||{},de[Ne][rr][Er]=de[Ne][rr][Er]||{},de[Ne][rr][Er][wr]=Be}return de}(mr.concat(st))}return De}var or=null;Object.defineProperty(this,"fontFaces",{get:function(){return or},set:function(le){De=null,or=le}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(le){var st;if(this.ctx.font=le,(st=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(le))!==null){var mr=st[1],Qe=(st[2],st[3]),de=st[4],Te=(st[5],st[6]),Be=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(de)[2];de=Math.floor(Be==="px"?parseFloat(de)*this.pdf.internal.scaleFactor:Be==="em"?parseFloat(de)*this.pdf.getFontSize():parseFloat(de)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(de);var Ne=function(hr){var xr,Fe,wi=[],ge=hr.trim();if(ge==="")return XI;if(ge in VI)return[VI[ge]];for(;ge!=="";){switch(Fe=null,xr=(ge=HI(ge)).charAt(0)){case'"':case"'":Fe=prt(ge.substring(1),xr);break;default:Fe=frt(ge)}if(Fe===null||(wi.push(Fe[0]),(ge=HI(Fe[1]))!==""&&ge.charAt(0)!==","))return XI;ge=ge.replace(/^,/,"")}return wi}(Te);if(this.fontFaces){var rr=drt(ze(this.pdf,this.fontFaces),Ne.map(function(hr){return{family:hr,stretch:"normal",weight:Qe,style:mr}}));this.pdf.setFont(rr.ref.name,rr.ref.style)}else{var Er="";(Qe==="bold"||parseInt(Qe,10)>=700||mr==="bold")&&(Er="bold"),mr==="italic"&&(Er+="italic"),Er.length===0&&(Er="normal");for(var wr="",Fr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Ur=0;Ur<Ne.length;Ur++){if(this.pdf.internal.getFont(Ne[Ur],Er,{noFallback:!0,disableWarning:!0})!==void 0){wr=Ne[Ur];break}if(Er==="bolditalic"&&this.pdf.internal.getFont(Ne[Ur],"bold",{noFallback:!0,disableWarning:!0})!==void 0)wr=Ne[Ur],Er="bold";else if(this.pdf.internal.getFont(Ne[Ur],"normal",{noFallback:!0,disableWarning:!0})!==void 0){wr=Ne[Ur],Er="normal";break}}if(wr===""){for(var me=0;me<Ne.length;me++)if(Fr[Ne[me]]){wr=Fr[Ne[me]];break}}wr=wr===""?"Times":wr,this.pdf.setFont(wr,Er)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(le){this.ctx.globalCompositeOperation=le}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(le){this.ctx.globalAlpha=le}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(le){this.ctx.lineDashOffset=le,xe.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(le){this.ctx.lineDash=le,xe.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(le){this.ctx.ignoreClearRect=!!le}})};S.prototype.setLineDash=function(it){this.lineDash=it},S.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},S.prototype.fill=function(){nt.call(this,"fill",!1)},S.prototype.stroke=function(){nt.call(this,"stroke",!1)},S.prototype.beginPath=function(){this.path=[{type:"begin"}]},S.prototype.moveTo=function(it,Et){if(isNaN(it)||isNaN(Et))throw Ji.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Pt=this.ctx.transform.applyToPoint(new c(it,Et));this.path.push({type:"mt",x:Pt.x,y:Pt.y}),this.ctx.lastPoint=new c(it,Et)},S.prototype.closePath=function(){var it=new c(0,0),Et=0;for(Et=this.path.length-1;Et!==-1;Et--)if(this.path[Et].type==="begin"&&Ui(this.path[Et+1])==="object"&&typeof this.path[Et+1].x=="number"){it=new c(this.path[Et+1].x,this.path[Et+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new c(it.x,it.y)},S.prototype.lineTo=function(it,Et){if(isNaN(it)||isNaN(Et))throw Ji.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Pt=this.ctx.transform.applyToPoint(new c(it,Et));this.path.push({type:"lt",x:Pt.x,y:Pt.y}),this.ctx.lastPoint=new c(Pt.x,Pt.y)},S.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),nt.call(this,null,!0)},S.prototype.quadraticCurveTo=function(it,Et,Pt,jt){if(isNaN(Pt)||isNaN(jt)||isNaN(it)||isNaN(Et))throw Ji.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var qt=this.ctx.transform.applyToPoint(new c(Pt,jt)),$t=this.ctx.transform.applyToPoint(new c(it,Et));this.path.push({type:"qct",x1:$t.x,y1:$t.y,x:qt.x,y:qt.y}),this.ctx.lastPoint=new c(qt.x,qt.y)},S.prototype.bezierCurveTo=function(it,Et,Pt,jt,qt,$t){if(isNaN(qt)||isNaN($t)||isNaN(it)||isNaN(Et)||isNaN(Pt)||isNaN(jt))throw Ji.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Qt=this.ctx.transform.applyToPoint(new c(qt,$t)),Kt=this.ctx.transform.applyToPoint(new c(it,Et)),Ee=this.ctx.transform.applyToPoint(new c(Pt,jt));this.path.push({type:"bct",x1:Kt.x,y1:Kt.y,x2:Ee.x,y2:Ee.y,x:Qt.x,y:Qt.y}),this.ctx.lastPoint=new c(Qt.x,Qt.y)},S.prototype.arc=function(it,Et,Pt,jt,qt,$t){if(isNaN(it)||isNaN(Et)||isNaN(Pt)||isNaN(jt)||isNaN(qt))throw Ji.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if($t=!!$t,!this.ctx.transform.isIdentity){var Qt=this.ctx.transform.applyToPoint(new c(it,Et));it=Qt.x,Et=Qt.y;var Kt=this.ctx.transform.applyToPoint(new c(0,Pt)),Ee=this.ctx.transform.applyToPoint(new c(0,0));Pt=Math.sqrt(Math.pow(Kt.x-Ee.x,2)+Math.pow(Kt.y-Ee.y,2))}Math.abs(qt-jt)>=2*Math.PI&&(jt=0,qt=2*Math.PI),this.path.push({type:"arc",x:it,y:Et,radius:Pt,startAngle:jt,endAngle:qt,counterclockwise:$t})},S.prototype.arcTo=function(it,Et,Pt,jt,qt){throw new Error("arcTo not implemented.")},S.prototype.rect=function(it,Et,Pt,jt){if(isNaN(it)||isNaN(Et)||isNaN(Pt)||isNaN(jt))throw Ji.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(it,Et),this.lineTo(it+Pt,Et),this.lineTo(it+Pt,Et+jt),this.lineTo(it,Et+jt),this.lineTo(it,Et),this.lineTo(it+Pt,Et),this.lineTo(it,Et)},S.prototype.fillRect=function(it,Et,Pt,jt){if(isNaN(it)||isNaN(Et)||isNaN(Pt)||isNaN(jt))throw Ji.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!I.call(this)){var qt={};this.lineCap!=="butt"&&(qt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(qt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(it,Et,Pt,jt),this.fill(),qt.hasOwnProperty("lineCap")&&(this.lineCap=qt.lineCap),qt.hasOwnProperty("lineJoin")&&(this.lineJoin=qt.lineJoin)}},S.prototype.strokeRect=function(it,Et,Pt,jt){if(isNaN(it)||isNaN(Et)||isNaN(Pt)||isNaN(jt))throw Ji.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");N.call(this)||(this.beginPath(),this.rect(it,Et,Pt,jt),this.stroke())},S.prototype.clearRect=function(it,Et,Pt,jt){if(isNaN(it)||isNaN(Et)||isNaN(Pt)||isNaN(jt))throw Ji.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(it,Et,Pt,jt))},S.prototype.save=function(it){it=typeof it!="boolean"||it;for(var Et=this.pdf.internal.getCurrentPageInfo().pageNumber,Pt=0;Pt<this.pdf.internal.getNumberOfPages();Pt++)this.pdf.setPage(Pt+1),this.pdf.internal.out("q");if(this.pdf.setPage(Et),it){this.ctx.fontSize=this.pdf.internal.getFontSize();var jt=new w(this.ctx);this.ctxStack.push(this.ctx),this.ctx=jt}},S.prototype.restore=function(it){it=typeof it!="boolean"||it;for(var Et=this.pdf.internal.getCurrentPageInfo().pageNumber,Pt=0;Pt<this.pdf.internal.getNumberOfPages();Pt++)this.pdf.setPage(Pt+1),this.pdf.internal.out("Q");this.pdf.setPage(Et),it&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},S.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var C=function(it){var Et,Pt,jt,qt;if(it.isCanvasGradient===!0&&(it=it.getColor()),!it)return{r:0,g:0,b:0,a:0,style:it};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(it))Et=0,Pt=0,jt=0,qt=0;else{var $t=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(it);if($t!==null)Et=parseInt($t[1]),Pt=parseInt($t[2]),jt=parseInt($t[3]),qt=1;else if(($t=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(it))!==null)Et=parseInt($t[1]),Pt=parseInt($t[2]),jt=parseInt($t[3]),qt=parseFloat($t[4]);else{if(qt=1,typeof it=="string"&&it.charAt(0)!=="#"){var Qt=new Ok(it);it=Qt.ok?Qt.toHex():"#000000"}it.length===4?(Et=it.substring(1,2),Et+=Et,Pt=it.substring(2,3),Pt+=Pt,jt=it.substring(3,4),jt+=jt):(Et=it.substring(1,3),Pt=it.substring(3,5),jt=it.substring(5,7)),Et=parseInt(Et,16),Pt=parseInt(Pt,16),jt=parseInt(jt,16)}}return{r:Et,g:Pt,b:jt,a:qt,style:it}},I=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},N=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};S.prototype.fillText=function(it,Et,Pt,jt){if(isNaN(Et)||isNaN(Pt)||typeof it!="string")throw Ji.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(jt=isNaN(jt)?void 0:jt,!I.call(this)){var qt=Ot(this.ctx.transform.rotation),$t=this.ctx.transform.scaleX;dt.call(this,{text:it,x:Et,y:Pt,scale:$t,angle:qt,align:this.textAlign,maxWidth:jt})}},S.prototype.strokeText=function(it,Et,Pt,jt){if(isNaN(Et)||isNaN(Pt)||typeof it!="string")throw Ji.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!N.call(this)){jt=isNaN(jt)?void 0:jt;var qt=Ot(this.ctx.transform.rotation),$t=this.ctx.transform.scaleX;dt.call(this,{text:it,x:Et,y:Pt,scale:$t,renderingMode:"stroke",angle:qt,align:this.textAlign,maxWidth:jt})}},S.prototype.measureText=function(it){if(typeof it!="string")throw Ji.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Et=this.pdf,Pt=this.pdf.internal.scaleFactor,jt=Et.internal.getFontSize(),qt=Et.getStringUnitWidth(it)*jt/Et.internal.scaleFactor,$t=function(Qt){var Kt=(Qt=Qt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return Kt}}),this};return new $t({width:qt*=Math.round(96*Pt/72*1e4)/1e4})},S.prototype.scale=function(it,Et){if(isNaN(it)||isNaN(Et))throw Ji.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Pt=new p(it,0,0,Et,0,0);this.ctx.transform=this.ctx.transform.multiply(Pt)},S.prototype.rotate=function(it){if(isNaN(it))throw Ji.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Et=new p(Math.cos(it),Math.sin(it),-Math.sin(it),Math.cos(it),0,0);this.ctx.transform=this.ctx.transform.multiply(Et)},S.prototype.translate=function(it,Et){if(isNaN(it)||isNaN(Et))throw Ji.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Pt=new p(1,0,0,1,it,Et);this.ctx.transform=this.ctx.transform.multiply(Pt)},S.prototype.transform=function(it,Et,Pt,jt,qt,$t){if(isNaN(it)||isNaN(Et)||isNaN(Pt)||isNaN(jt)||isNaN(qt)||isNaN($t))throw Ji.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Qt=new p(it,Et,Pt,jt,qt,$t);this.ctx.transform=this.ctx.transform.multiply(Qt)},S.prototype.setTransform=function(it,Et,Pt,jt,qt,$t){it=isNaN(it)?1:it,Et=isNaN(Et)?0:Et,Pt=isNaN(Pt)?0:Pt,jt=isNaN(jt)?1:jt,qt=isNaN(qt)?0:qt,$t=isNaN($t)?0:$t,this.ctx.transform=new p(it,Et,Pt,jt,qt,$t)};var F=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};S.prototype.drawImage=function(it,Et,Pt,jt,qt,$t,Qt,Kt,Ee){var Me=this.pdf.getImageProperties(it),De=1,ze=1,or=1,le=1;jt!==void 0&&Kt!==void 0&&(or=Kt/jt,le=Ee/qt,De=Me.width/jt*Kt/jt,ze=Me.height/qt*Ee/qt),$t===void 0&&($t=Et,Qt=Pt,Et=0,Pt=0),jt!==void 0&&Kt===void 0&&(Kt=jt,Ee=qt),jt===void 0&&Kt===void 0&&(Kt=Me.width,Ee=Me.height);for(var st,mr=this.ctx.transform.decompose(),Qe=Ot(mr.rotate.shx),de=new p,Te=(de=(de=(de=de.multiply(mr.translate)).multiply(mr.skew)).multiply(mr.scale)).applyToRectangle(new a($t-Et*or,Qt-Pt*le,jt*De,qt*ze)),Be=W.call(this,Te),Ne=[],rr=0;rr<Be.length;rr+=1)Ne.indexOf(Be[rr])===-1&&Ne.push(Be[rr]);if(H(Ne),this.autoPaging)for(var Er=Ne[0],wr=Ne[Ne.length-1],Fr=Er;Fr<wr+1;Fr++){this.pdf.setPage(Fr);var Ur=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],me=Fr===1?this.posY+this.margin[0]:this.margin[0],hr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],xr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Fe=Fr===1?0:hr+(Fr-2)*xr;if(this.ctx.clip_path.length!==0){var wi=this.path;st=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=z(st,this.posX+this.margin[3],-Fe+me+this.ctx.prevPageLastElemOffset),yt.call(this,"fill",!0),this.path=wi}var ge=JSON.parse(JSON.stringify(Te));ge=z([ge],this.posX+this.margin[3],-Fe+me+this.ctx.prevPageLastElemOffset)[0];var br=(Fr>Er||Fr<wr)&&F.call(this);br&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ur,xr,null).clip().discardPath()),this.pdf.addImage(it,"JPEG",ge.x,ge.y,ge.w,ge.h,null,null,Qe),br&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(it,"JPEG",Te.x,Te.y,Te.w,Te.h,null,null,Qe)};var W=function(it,Et,Pt){var jt=[];Et=Et||this.pdf.internal.pageSize.width,Pt=Pt||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var qt=this.posY+this.ctx.prevPageLastElemOffset;switch(it.type){default:case"mt":case"lt":jt.push(Math.floor((it.y+qt)/Pt)+1);break;case"arc":jt.push(Math.floor((it.y+qt-it.radius)/Pt)+1),jt.push(Math.floor((it.y+qt+it.radius)/Pt)+1);break;case"qct":var $t=Xt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,it.x1,it.y1,it.x,it.y);jt.push(Math.floor(($t.y+qt)/Pt)+1),jt.push(Math.floor(($t.y+$t.h+qt)/Pt)+1);break;case"bct":var Qt=Wt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,it.x1,it.y1,it.x2,it.y2,it.x,it.y);jt.push(Math.floor((Qt.y+qt)/Pt)+1),jt.push(Math.floor((Qt.y+Qt.h+qt)/Pt)+1);break;case"rect":jt.push(Math.floor((it.y+qt)/Pt)+1),jt.push(Math.floor((it.y+it.h+qt)/Pt)+1)}for(var Kt=0;Kt<jt.length;Kt+=1)for(;this.pdf.internal.getNumberOfPages()<jt[Kt];)U.call(this);return jt},U=function(){var it=this.fillStyle,Et=this.strokeStyle,Pt=this.font,jt=this.lineCap,qt=this.lineWidth,$t=this.lineJoin;this.pdf.addPage(),this.fillStyle=it,this.strokeStyle=Et,this.font=Pt,this.lineCap=jt,this.lineWidth=qt,this.lineJoin=$t},z=function(it,Et,Pt){for(var jt=0;jt<it.length;jt++)switch(it[jt].type){case"bct":it[jt].x2+=Et,it[jt].y2+=Pt;case"qct":it[jt].x1+=Et,it[jt].y1+=Pt;case"mt":case"lt":case"arc":default:it[jt].x+=Et,it[jt].y+=Pt}return it},H=function(it){return it.sort(function(Et,Pt){return Et-Pt})},nt=function(it,Et){for(var Pt,jt,qt=this.fillStyle,$t=this.strokeStyle,Qt=this.lineCap,Kt=this.lineWidth,Ee=Math.abs(Kt*this.ctx.transform.scaleX),Me=this.lineJoin,De=JSON.parse(JSON.stringify(this.path)),ze=JSON.parse(JSON.stringify(this.path)),or=[],le=0;le<ze.length;le++)if(ze[le].x!==void 0)for(var st=W.call(this,ze[le]),mr=0;mr<st.length;mr+=1)or.indexOf(st[mr])===-1&&or.push(st[mr]);for(var Qe=0;Qe<or.length;Qe++)for(;this.pdf.internal.getNumberOfPages()<or[Qe];)U.call(this);if(H(or),this.autoPaging)for(var de=or[0],Te=or[or.length-1],Be=de;Be<Te+1;Be++){this.pdf.setPage(Be),this.fillStyle=qt,this.strokeStyle=$t,this.lineCap=Qt,this.lineWidth=Ee,this.lineJoin=Me;var Ne=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],rr=Be===1?this.posY+this.margin[0]:this.margin[0],Er=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],wr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Fr=Be===1?0:Er+(Be-2)*wr;if(this.ctx.clip_path.length!==0){var Ur=this.path;Pt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=z(Pt,this.posX+this.margin[3],-Fr+rr+this.ctx.prevPageLastElemOffset),yt.call(this,it,!0),this.path=Ur}if(jt=JSON.parse(JSON.stringify(De)),this.path=z(jt,this.posX+this.margin[3],-Fr+rr+this.ctx.prevPageLastElemOffset),Et===!1||Be===0){var me=(Be>de||Be<Te)&&F.call(this);me&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ne,wr,null).clip().discardPath()),yt.call(this,it,Et),me&&this.pdf.restoreGraphicsState()}this.lineWidth=Kt}else this.lineWidth=Ee,yt.call(this,it,Et),this.lineWidth=Kt;this.path=De},yt=function(it,Et){if((it!=="stroke"||Et||!N.call(this))&&(it==="stroke"||Et||!I.call(this))){for(var Pt,jt,qt=[],$t=this.path,Qt=0;Qt<$t.length;Qt++){var Kt=$t[Qt];switch(Kt.type){case"begin":qt.push({begin:!0});break;case"close":qt.push({close:!0});break;case"mt":qt.push({start:Kt,deltas:[],abs:[]});break;case"lt":var Ee=qt.length;if($t[Qt-1]&&!isNaN($t[Qt-1].x)&&(Pt=[Kt.x-$t[Qt-1].x,Kt.y-$t[Qt-1].y],Ee>0)){for(;Ee>=0;Ee--)if(qt[Ee-1].close!==!0&&qt[Ee-1].begin!==!0){qt[Ee-1].deltas.push(Pt),qt[Ee-1].abs.push(Kt);break}}break;case"bct":Pt=[Kt.x1-$t[Qt-1].x,Kt.y1-$t[Qt-1].y,Kt.x2-$t[Qt-1].x,Kt.y2-$t[Qt-1].y,Kt.x-$t[Qt-1].x,Kt.y-$t[Qt-1].y],qt[qt.length-1].deltas.push(Pt);break;case"qct":var Me=$t[Qt-1].x+2/3*(Kt.x1-$t[Qt-1].x),De=$t[Qt-1].y+2/3*(Kt.y1-$t[Qt-1].y),ze=Kt.x+2/3*(Kt.x1-Kt.x),or=Kt.y+2/3*(Kt.y1-Kt.y),le=Kt.x,st=Kt.y;Pt=[Me-$t[Qt-1].x,De-$t[Qt-1].y,ze-$t[Qt-1].x,or-$t[Qt-1].y,le-$t[Qt-1].x,st-$t[Qt-1].y],qt[qt.length-1].deltas.push(Pt);break;case"arc":qt.push({deltas:[],abs:[],arc:!0}),Array.isArray(qt[qt.length-1].abs)&&qt[qt.length-1].abs.push(Kt)}}jt=Et?null:it==="stroke"?"stroke":"fill";for(var mr=!1,Qe=0;Qe<qt.length;Qe++)if(qt[Qe].arc)for(var de=qt[Qe].abs,Te=0;Te<de.length;Te++){var Be=de[Te];Be.type==="arc"?mt.call(this,Be.x,Be.y,Be.radius,Be.startAngle,Be.endAngle,Be.counterclockwise,void 0,Et,!mr):It.call(this,Be.x,Be.y),mr=!0}else if(qt[Qe].close===!0)this.pdf.internal.out("h"),mr=!1;else if(qt[Qe].begin!==!0){var Ne=qt[Qe].start.x,rr=qt[Qe].start.y;xt.call(this,qt[Qe].deltas,Ne,rr),mr=!0}jt&&Dt.call(this,jt),Et&&kt.call(this)}},bt=function(it){var Et=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Pt=Et*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return it-Pt;case"top":return it+Et-Pt;case"hanging":return it+Et-2*Pt;case"middle":return it+Et/2-Pt;case"ideographic":return it;case"alphabetic":default:return it}},vt=function(it){return it+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};S.prototype.createLinearGradient=function(){var it=function(){};return it.colorStops=[],it.addColorStop=function(Et,Pt){this.colorStops.push([Et,Pt])},it.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},it.isCanvasGradient=!0,it},S.prototype.createPattern=function(){return this.createLinearGradient()},S.prototype.createRadialGradient=function(){return this.createLinearGradient()};var mt=function(it,Et,Pt,jt,qt,$t,Qt,Kt,Ee){for(var Me=ee.call(this,Pt,jt,qt,$t),De=0;De<Me.length;De++){var ze=Me[De];De===0&&(Ee?at.call(this,ze.x1+it,ze.y1+Et):It.call(this,ze.x1+it,ze.y1+Et)),re.call(this,it,Et,ze.x2,ze.y2,ze.x3,ze.y3,ze.x4,ze.y4)}Kt?kt.call(this):Dt.call(this,Qt)},Dt=function(it){switch(it){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},kt=function(){this.pdf.clip(),this.pdf.discardPath()},at=function(it,Et){this.pdf.internal.out(r(it)+" "+i(Et)+" m")},dt=function(it){var Et;switch(it.align){case"right":case"end":Et="right";break;case"center":Et="center";break;case"left":case"start":default:Et="left"}var Pt=this.pdf.getTextDimensions(it.text),jt=bt.call(this,it.y),qt=vt.call(this,jt)-Pt.h,$t=this.ctx.transform.applyToPoint(new c(it.x,jt)),Qt=this.ctx.transform.decompose(),Kt=new p;Kt=(Kt=(Kt=Kt.multiply(Qt.translate)).multiply(Qt.skew)).multiply(Qt.scale);for(var Ee,Me,De,ze=this.ctx.transform.applyToRectangle(new a(it.x,jt,Pt.w,Pt.h)),or=Kt.applyToRectangle(new a(it.x,qt,Pt.w,Pt.h)),le=W.call(this,or),st=[],mr=0;mr<le.length;mr+=1)st.indexOf(le[mr])===-1&&st.push(le[mr]);if(H(st),this.autoPaging)for(var Qe=st[0],de=st[st.length-1],Te=Qe;Te<de+1;Te++){this.pdf.setPage(Te);var Be=Te===1?this.posY+this.margin[0]:this.margin[0],Ne=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],rr=this.pdf.internal.pageSize.height-this.margin[2],Er=rr-this.margin[0],wr=this.pdf.internal.pageSize.width-this.margin[1],Fr=wr-this.margin[3],Ur=Te===1?0:Ne+(Te-2)*Er;if(this.ctx.clip_path.length!==0){var me=this.path;Ee=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=z(Ee,this.posX+this.margin[3],-1*Ur+Be),yt.call(this,"fill",!0),this.path=me}var hr=z([JSON.parse(JSON.stringify(or))],this.posX+this.margin[3],-Ur+Be+this.ctx.prevPageLastElemOffset)[0];it.scale>=.01&&(Me=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Me*it.scale),De=this.lineWidth,this.lineWidth=De*it.scale);var xr=this.autoPaging!=="text";if(xr||hr.y+hr.h<=rr){if(xr||hr.y>=Be&&hr.x<=wr){var Fe=xr?it.text:this.pdf.splitTextToSize(it.text,it.maxWidth||wr-hr.x)[0],wi=z([JSON.parse(JSON.stringify(ze))],this.posX+this.margin[3],-Ur+Be+this.ctx.prevPageLastElemOffset)[0],ge=xr&&(Te>Qe||Te<de)&&F.call(this);ge&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Fr,Er,null).clip().discardPath()),this.pdf.text(Fe,wi.x,wi.y,{angle:it.angle,align:Et,renderingMode:it.renderingMode}),ge&&this.pdf.restoreGraphicsState()}}else hr.y<rr&&(this.ctx.prevPageLastElemOffset+=rr-hr.y);it.scale>=.01&&(this.pdf.setFontSize(Me),this.lineWidth=De)}else it.scale>=.01&&(Me=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Me*it.scale),De=this.lineWidth,this.lineWidth=De*it.scale),this.pdf.text(it.text,$t.x+this.posX,$t.y+this.posY,{angle:it.angle,align:Et,renderingMode:it.renderingMode,maxWidth:it.maxWidth}),it.scale>=.01&&(this.pdf.setFontSize(Me),this.lineWidth=De)},It=function(it,Et,Pt,jt){Pt=Pt||0,jt=jt||0,this.pdf.internal.out(r(it+Pt)+" "+i(Et+jt)+" l")},xt=function(it,Et,Pt){return this.pdf.lines(it,Et,Pt,null,null)},re=function(it,Et,Pt,jt,qt,$t,Qt,Kt){this.pdf.internal.out([t(n(Pt+it)),t(s(jt+Et)),t(n(qt+it)),t(s($t+Et)),t(n(Qt+it)),t(s(Kt+Et)),"c"].join(" "))},ee=function(it,Et,Pt,jt){for(var qt=2*Math.PI,$t=Math.PI/2;Et>Pt;)Et-=qt;var Qt=Math.abs(Pt-Et);Qt<qt&&jt&&(Qt=qt-Qt);for(var Kt=[],Ee=jt?-1:1,Me=Et;Qt>1e-5;){var De=Me+Ee*Math.min(Qt,$t);Kt.push(se.call(this,it,Me,De)),Qt-=Math.abs(De-Me),Me=De}return Kt},se=function(it,Et,Pt){var jt=(Pt-Et)/2,qt=it*Math.cos(jt),$t=it*Math.sin(jt),Qt=qt,Kt=-$t,Ee=Qt*Qt+Kt*Kt,Me=Ee+Qt*qt+Kt*$t,De=4/3*(Math.sqrt(2*Ee*Me)-Me)/(Qt*$t-Kt*qt),ze=Qt-De*Kt,or=Kt+De*Qt,le=ze,st=-or,mr=jt+Et,Qe=Math.cos(mr),de=Math.sin(mr);return{x1:it*Math.cos(Et),y1:it*Math.sin(Et),x2:ze*Qe-or*de,y2:ze*de+or*Qe,x3:le*Qe-st*de,y3:le*de+st*Qe,x4:it*Math.cos(Pt),y4:it*Math.sin(Pt)}},Ot=function(it){return 180*it/Math.PI},Xt=function(it,Et,Pt,jt,qt,$t){var Qt=it+.5*(Pt-it),Kt=Et+.5*(jt-Et),Ee=qt+.5*(Pt-qt),Me=$t+.5*(jt-$t),De=Math.min(it,qt,Qt,Ee),ze=Math.max(it,qt,Qt,Ee),or=Math.min(Et,$t,Kt,Me),le=Math.max(Et,$t,Kt,Me);return new a(De,or,ze-De,le-or)},Wt=function(it,Et,Pt,jt,qt,$t,Qt,Kt){var Ee,Me,De,ze,or,le,st,mr,Qe,de,Te,Be,Ne,rr,Er=Pt-it,wr=jt-Et,Fr=qt-Pt,Ur=$t-jt,me=Qt-qt,hr=Kt-$t;for(Me=0;Me<41;Me++)Qe=(st=(De=it+(Ee=Me/40)*Er)+Ee*((or=Pt+Ee*Fr)-De))+Ee*(or+Ee*(qt+Ee*me-or)-st),de=(mr=(ze=Et+Ee*wr)+Ee*((le=jt+Ee*Ur)-ze))+Ee*(le+Ee*($t+Ee*hr-le)-mr),Me==0?(Te=Qe,Be=de,Ne=Qe,rr=de):(Te=Math.min(Te,Qe),Be=Math.min(Be,de),Ne=Math.max(Ne,Qe),rr=Math.max(rr,de));return new a(Math.round(Te),Math.round(Be),Math.round(Ne-Te),Math.round(rr-Be))},xe=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var it,Et,Pt=(it=this.ctx.lineDash,Et=this.ctx.lineDashOffset,JSON.stringify({lineDash:it,lineDashOffset:Et}));this.prevLineDash!==Pt&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Pt)}}})(kr.API),function(e){var t=function(s){var c,a,p,_,w,S,C,I,N,F;for(a=[],p=0,_=(s+=c="\0\0\0\0".slice(s.length%4||4)).length;_>p;p+=4)(w=(s.charCodeAt(p)<<24)+(s.charCodeAt(p+1)<<16)+(s.charCodeAt(p+2)<<8)+s.charCodeAt(p+3))!==0?(S=(w=((w=((w=((w=(w-(F=w%85))/85)-(N=w%85))/85)-(I=w%85))/85)-(C=w%85))/85)%85,a.push(S+33,C+33,I+33,N+33,F+33)):a.push(122);return function(W,U){for(var z=U;z>0;z--)W.pop()}(a,c.length),String.fromCharCode.apply(String,a)+"~>"},r=function(s){var c,a,p,_,w,S=String,C="length",I=255,N="charCodeAt",F="slice",W="replace";for(s[F](-2),s=s[F](0,-2)[W](/\s/g,"")[W]("z","!!!!!"),p=[],_=0,w=(s+=c="uuuuu"[F](s[C]%5||5))[C];w>_;_+=5)a=52200625*(s[N](_)-33)+614125*(s[N](_+1)-33)+7225*(s[N](_+2)-33)+85*(s[N](_+3)-33)+(s[N](_+4)-33),p.push(I&a>>24,I&a>>16,I&a>>8,I&a);return function(U,z){for(var H=z;H>0;H--)U.pop()}(p,c[C]),S.fromCharCode.apply(S,p)},i=function(s){var c=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((s=s.replace(/\s/g,"")).indexOf(">")!==-1&&(s=s.substr(0,s.indexOf(">"))),s.length%2&&(s+="0"),c.test(s)===!1)return"";for(var a="",p=0;p<s.length;p+=2)a+=String.fromCharCode("0x"+(s[p]+s[p+1]));return a},n=function(s){for(var c=new Uint8Array(s.length),a=s.length;a--;)c[a]=s.charCodeAt(a);return s=(c=Zx(c)).reduce(function(p,_){return p+String.fromCharCode(_)},"")};e.processDataByFilters=function(s,c){var a=0,p=s||"",_=[];for(typeof(c=c||[])=="string"&&(c=[c]),a=0;a<c.length;a+=1)switch(c[a]){case"ASCII85Decode":case"/ASCII85Decode":p=r(p),_.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":p=t(p),_.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":p=i(p),_.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":p=p.split("").map(function(w){return("0"+w.charCodeAt().toString(16)).slice(-2)}).join("")+">",_.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":p=n(p),_.push("/FlateDecode");break;default:throw new Error('The filter: "'+c[a]+'" is not implemented')}return{data:p,reverseChain:_.reverse().join(" ")}}}(kr.API),function(e){e.loadFile=function(t,r,i){return function(n,s,c){s=s!==!1,c=typeof c=="function"?c:function(){};var a=void 0;try{a=function(p,_,w){var S=new XMLHttpRequest,C=0,I=function(N){var F=N.length,W=[],U=String.fromCharCode;for(C=0;C<F;C+=1)W.push(U(255&N.charCodeAt(C)));return W.join("")};if(S.open("GET",p,!_),S.overrideMimeType("text/plain; charset=x-user-defined"),_===!1&&(S.onload=function(){S.status===200?w(I(this.responseText)):w(void 0)}),S.send(null),_&&S.status===200)return I(S.responseText)}(n,s,c)}catch{}return a}(t,r,i)},e.loadImageFile=e.loadFile}(kr.API),function(e){function t(){return(Rr.html2canvas?Promise.resolve(Rr.html2canvas):Yw(()=>import("./html2canvas.esm-CKxSAI8P-DLLJDLZD-82fcdfb0.js"),[])).catch(function(c){return Promise.reject(new Error("Could not load html2canvas: "+c))}).then(function(c){return c.default?c.default:c})}function r(){return(Rr.DOMPurify?Promise.resolve(Rr.DOMPurify):Yw(()=>import("./purify.es-CLxMp-4V-DQ4yGNUw-f943c3fb.js"),[])).catch(function(c){return Promise.reject(new Error("Could not load dompurify: "+c))}).then(function(c){return c.default?c.default:c})}var i=function(c){var a=Ui(c);return a==="undefined"?"undefined":a==="string"||c instanceof String?"string":a==="number"||c instanceof Number?"number":a==="function"||c instanceof Function?"function":c&&c.constructor===Array?"array":c&&c.nodeType===1?"element":a==="object"?"object":"unknown"},n=function(c,a){var p=document.createElement(c);for(var _ in a.className&&(p.className=a.className),a.innerHTML&&a.dompurify&&(p.innerHTML=a.dompurify.sanitize(a.innerHTML)),a.style)p.style[_]=a.style[_];return p},s=function c(a){var p=Object.assign(c.convert(Promise.resolve()),JSON.parse(JSON.stringify(c.template))),_=c.convert(Promise.resolve(),p);return _=(_=_.setProgress(1,c,1,[c])).set(a)};(s.prototype=Object.create(Promise.prototype)).constructor=s,s.convert=function(c,a){return c.__proto__=a||s.prototype,c},s.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},s.prototype.from=function(c,a){return this.then(function(){switch(a=a||function(p){switch(i(p)){case"string":return"string";case"element":return p.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(c)){case"string":return this.then(r).then(function(p){return this.set({src:n("div",{innerHTML:c,dompurify:p})})});case"element":return this.set({src:c});case"canvas":return this.set({canvas:c});case"img":return this.set({img:c});default:return this.error("Unknown source type.")}})},s.prototype.to=function(c){switch(c){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},s.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var c={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},a=function p(_,w){for(var S=_.nodeType===3?document.createTextNode(_.nodeValue):_.cloneNode(!1),C=_.firstChild;C;C=C.nextSibling)w!==!0&&C.nodeType===1&&C.nodeName==="SCRIPT"||S.appendChild(p(C,w));return _.nodeType===1&&(_.nodeName==="CANVAS"?(S.width=_.width,S.height=_.height,S.getContext("2d").drawImage(_,0,0)):_.nodeName!=="TEXTAREA"&&_.nodeName!=="SELECT"||(S.value=_.value),S.addEventListener("load",function(){S.scrollTop=_.scrollTop,S.scrollLeft=_.scrollLeft},!0)),S}(this.prop.src,this.opt.html2canvas.javascriptEnabled);a.tagName==="BODY"&&(c.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=n("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=n("div",{className:"html2pdf__container",style:c}),this.prop.container.appendChild(a),this.prop.container.firstChild.appendChild(n("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},s.prototype.toCanvas=function(){var c=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(c).then(t).then(function(a){var p=Object.assign({},this.opt.html2canvas);return delete p.onrendered,a(this.prop.container,p)}).then(function(a){(this.opt.html2canvas.onrendered||function(){})(a),this.prop.canvas=a,document.body.removeChild(this.prop.overlay)})},s.prototype.toContext2d=function(){var c=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(c).then(t).then(function(a){var p=this.opt.jsPDF,_=this.opt.fontFaces,w=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,S=Object.assign({async:!0,allowTaint:!0,scale:w,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete S.onrendered,p.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,p.context2d.posX=this.opt.x,p.context2d.posY=this.opt.y,p.context2d.margin=this.opt.margin,p.context2d.fontFaces=_,_)for(var C=0;C<_.length;++C){var I=_[C],N=I.src.find(function(F){return F.format==="truetype"});N&&p.addFont(N.url,I.ref.name,I.ref.style)}return S.windowHeight=S.windowHeight||0,S.windowHeight=S.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):S.windowHeight,p.context2d.save(!0),a(this.prop.container,S)}).then(function(a){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(a),this.prop.canvas=a,document.body.removeChild(this.prop.overlay)})},s.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var c=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=c})},s.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},s.prototype.output=function(c,a,p){return(p=p||"pdf").toLowerCase()==="img"||p.toLowerCase()==="image"?this.outputImg(c,a):this.outputPdf(c,a)},s.prototype.outputPdf=function(c,a){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(c,a)})},s.prototype.outputImg=function(c){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(c){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+c+'" is not supported.'}})},s.prototype.save=function(c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(c?{filename:c}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},s.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},s.prototype.set=function(c){if(i(c)!=="object")return this;var a=Object.keys(c||{}).map(function(p){if(p in s.template.prop)return function(){this.prop[p]=c[p]};switch(p){case"margin":return this.setMargin.bind(this,c.margin);case"jsPDF":return function(){return this.opt.jsPDF=c.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,c.pageSize);default:return function(){this.opt[p]=c[p]}}},this);return this.then(function(){return this.thenList(a)})},s.prototype.get=function(c,a){return this.then(function(){var p=c in s.template.prop?this.prop[c]:this.opt[c];return a?a(p):p})},s.prototype.setMargin=function(c){return this.then(function(){switch(i(c)){case"number":c=[c,c,c,c];case"array":if(c.length===2&&(c=[c[0],c[1],c[0],c[1]]),c.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=c}).then(this.setPageSize)},s.prototype.setPageSize=function(c){function a(p,_){return Math.floor(p*_/72*96)}return this.then(function(){(c=c||kr.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(c.inner={width:c.width-this.opt.margin[1]-this.opt.margin[3],height:c.height-this.opt.margin[0]-this.opt.margin[2]},c.inner.px={width:a(c.inner.width,c.k),height:a(c.inner.height,c.k)},c.inner.ratio=c.inner.height/c.inner.width),this.prop.pageSize=c})},s.prototype.setProgress=function(c,a,p,_){return c!=null&&(this.progress.val=c),a!=null&&(this.progress.state=a),p!=null&&(this.progress.n=p),_!=null&&(this.progress.stack=_),this.progress.ratio=this.progress.val/this.progress.state,this},s.prototype.updateProgress=function(c,a,p,_){return this.setProgress(c?this.progress.val+c:null,a||null,p?this.progress.n+p:null,_?this.progress.stack.concat(_):null)},s.prototype.then=function(c,a){var p=this;return this.thenCore(c,a,function(_,w){return p.updateProgress(null,null,1,[_]),Promise.prototype.then.call(this,function(S){return p.updateProgress(null,_),S}).then(_,w).then(function(S){return p.updateProgress(1),S})})},s.prototype.thenCore=function(c,a,p){p=p||Promise.prototype.then,c&&(c=c.bind(this)),a&&(a=a.bind(this));var _=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:s.convert(Object.assign({},this),Promise.prototype),w=p.call(_,c,a);return s.convert(w,this.__proto__)},s.prototype.thenExternal=function(c,a){return Promise.prototype.then.call(this,c,a)},s.prototype.thenList=function(c){var a=this;return c.forEach(function(p){a=a.thenCore(p)}),a},s.prototype.catch=function(c){c&&(c=c.bind(this));var a=Promise.prototype.catch.call(this,c);return s.convert(a,this)},s.prototype.catchExternal=function(c){return Promise.prototype.catch.call(this,c)},s.prototype.error=function(c){return this.then(function(){throw new Error(c)})},s.prototype.using=s.prototype.set,s.prototype.saveAs=s.prototype.save,s.prototype.export=s.prototype.output,s.prototype.run=s.prototype.then,kr.getPageSize=function(c,a,p){if(Ui(c)==="object"){var _=c;c=_.orientation,a=_.unit||a,p=_.format||p}a=a||"mm",p=p||"a4",c=(""+(c||"P")).toLowerCase();var w,S=(""+p).toLowerCase(),C={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(a){case"pt":w=1;break;case"mm":w=72/25.4;break;case"cm":w=72/2.54;break;case"in":w=72;break;case"px":w=.75;break;case"pc":case"em":w=12;break;case"ex":w=6;break;default:throw"Invalid unit: "+a}var I,N=0,F=0;if(C.hasOwnProperty(S))N=C[S][1]/w,F=C[S][0]/w;else try{N=p[1],F=p[0]}catch{throw new Error("Invalid format: "+p)}if(c==="p"||c==="portrait")c="p",F>N&&(I=F,F=N,N=I);else{if(c!=="l"&&c!=="landscape")throw"Invalid orientation: "+c;c="l",N>F&&(I=F,F=N,N=I)}return{width:F,height:N,unit:a,k:w,orientation:c}},e.html=function(c,a){(a=a||{}).callback=a.callback||function(){},a.html2canvas=a.html2canvas||{},a.html2canvas.canvas=a.html2canvas.canvas||this.canvas,a.jsPDF=a.jsPDF||this,a.fontFaces=a.fontFaces?a.fontFaces.map(e5):null;var p=new s(a);return a.worker?p:p.from(c).doCallback()}}(kr.API),kr.API.addJS=function(e){return WI=e,this.internal.events.subscribe("postPutResources",function(){gy=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(gy+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),$I=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+WI+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){gy!==void 0&&$I!==void 0&&this.internal.out("/Names <</JavaScript "+gy+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var r=this,i=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var n=r.outline.render().split(/\r\n/),s=0;s<n.length;s++){var c=n[s],a=i.exec(c);if(a!=null){var p=a[1];r.internal.newObjectDeferredBegin(p,!1)}r.internal.write(c)}if(this.outline.createNamedDestinations){var _=this.internal.pages.length,w=[];for(s=0;s<_;s++){var S=r.internal.newObject();w.push(S);var C=r.internal.getPageInfo(s+1);r.internal.write("<< /D["+C.objId+" 0 R /XYZ null null null]>> endobj")}var I=r.internal.newObject();for(r.internal.write("<< /Names [ "),s=0;s<w.length;s++)r.internal.write("(page_"+(s+1)+")"+w[s]+" 0 R");r.internal.write(" ] >>","endobj"),t=r.internal.newObject(),r.internal.write("<< /Dests "+I+" 0 R"),r.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var r=this;r.outline={createNamedDestinations:!1,root:{children:[]}},r.outline.add=function(i,n,s){var c={title:n,options:s,children:[]};return i==null&&(i=this.root),i.children.push(c),c},r.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=r,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},r.outline.genIds_r=function(i){i.id=r.internal.newObjectDeferred();for(var n=0;n<i.children.length;n++)this.genIds_r(i.children[n])},r.outline.renderRoot=function(i){this.objStart(i),this.line("/Type /Outlines"),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1]))),this.line("/Count "+this.count_r({count:0},i)),this.objEnd()},r.outline.renderItems=function(i){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,s=0;s<i.children.length;s++){var c=i.children[s];this.objStart(c),this.line("/Title "+this.makeString(c.title)),this.line("/Parent "+this.makeRef(i)),s>0&&this.line("/Prev "+this.makeRef(i.children[s-1])),s<i.children.length-1&&this.line("/Next "+this.makeRef(i.children[s+1])),c.children.length>0&&(this.line("/First "+this.makeRef(c.children[0])),this.line("/Last "+this.makeRef(c.children[c.children.length-1])));var a=this.count=this.count_r({count:0},c);if(a>0&&this.line("/Count "+a),c.options&&c.options.pageNumber){var p=r.internal.getPageInfo(c.options.pageNumber);this.line("/Dest ["+p.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var _=0;_<i.children.length;_++)this.renderItems(i.children[_])},r.outline.line=function(i){this.ctx.val+=i+`\r
`},r.outline.makeRef=function(i){return i.id+" 0 R"},r.outline.makeString=function(i){return"("+r.internal.pdfEscape(i)+")"},r.outline.objStart=function(i){this.ctx.val+=`\r
`+i.id+` 0 obj\r
<<\r
`},r.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},r.outline.count_r=function(i,n){for(var s=0;s<n.children.length;s++)i.count++,this.count_r(i,n.children[s]);return i.count}}])}(kr.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(r,i,n,s,c,a){var p,_=this.decode.DCT_DECODE,w=null;if(typeof r=="string"||this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r)){switch(r=c||r,r=this.__addimage__.isArrayBuffer(r)?new Uint8Array(r):r,(p=function(S){for(var C,I=256*S.charCodeAt(4)+S.charCodeAt(5),N=S.length,F={width:0,height:0,numcomponents:1},W=4;W<N;W+=2){if(W+=I,t.indexOf(S.charCodeAt(W+1))!==-1){C=256*S.charCodeAt(W+5)+S.charCodeAt(W+6),F={width:256*S.charCodeAt(W+7)+S.charCodeAt(W+8),height:C,numcomponents:S.charCodeAt(W+9)};break}I=256*S.charCodeAt(W+2)+S.charCodeAt(W+3)}return F}(r=this.__addimage__.isArrayBufferView(r)?this.__addimage__.arrayBufferToBinaryString(r):r)).numcomponents){case 1:a=this.color_spaces.DEVICE_GRAY;break;case 4:a=this.color_spaces.DEVICE_CMYK;break;case 3:a=this.color_spaces.DEVICE_RGB}w={data:r,width:p.width,height:p.height,colorSpace:a,bitsPerComponent:8,filter:_,index:i,alias:n}}return w}}(kr.API);var wf,yy,ZI,YI,JI,mrt=function(){var e,t,r;function i(s){var c,a,p,_,w,S,C,I,N,F,W,U,z,H;for(this.data=s,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},S=null;;){switch(c=this.readUInt32(),N=(function(){var nt,yt;for(yt=[],nt=0;nt<4;++nt)yt.push(String.fromCharCode(this.data[this.pos++]));return yt}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(c);break;case"fcTL":S&&this.animation.frames.push(S),this.pos+=4,S={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},w=this.readUInt16(),_=this.readUInt16()||100,S.delay=1e3*w/_,S.disposeOp=this.data[this.pos++],S.blendOp=this.data[this.pos++],S.data=[];break;case"IDAT":case"fdAT":for(N==="fdAT"&&(this.pos+=4,c-=4),s=(S!=null?S.data:void 0)||this.imgData,U=0;0<=c?U<c:U>c;0<=c?++U:--U)s.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(p=this.palette.length/3,this.transparency.indexed=this.read(c),this.transparency.indexed.length>p)throw new Error("More transparent colors than palette size");if((F=p-this.transparency.indexed.length)>0)for(z=0;0<=F?z<F:z>F;0<=F?++z:--z)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(c)[0];break;case 2:this.transparency.rgb=this.read(c)}break;case"tEXt":C=(W=this.read(c)).indexOf(0),I=String.fromCharCode.apply(String,W.slice(0,C)),this.text[I]=String.fromCharCode.apply(String,W.slice(C+1));break;case"IEND":return S&&this.animation.frames.push(S),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(H=this.colorType)===4||H===6,a=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*a,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=c}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}i.prototype.read=function(s){var c,a;for(a=[],c=0;0<=s?c<s:c>s;0<=s?++c:--c)a.push(this.data[this.pos++]);return a},i.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.decodePixels=function(s){var c=this.pixelBitlength/8,a=new Uint8Array(this.width*this.height*c),p=0,_=this;if(s==null&&(s=this.imgData),s.length===0)return new Uint8Array(0);function w(S,C,I,N){var F,W,U,z,H,nt,yt,bt,vt,mt,Dt,kt,at,dt,It,xt,re,ee,se,Ot,Xt,Wt=Math.ceil((_.width-S)/I),xe=Math.ceil((_.height-C)/N),it=_.width==Wt&&_.height==xe;for(dt=c*Wt,kt=it?a:new Uint8Array(dt*xe),nt=s.length,at=0,W=0;at<xe&&p<nt;){switch(s[p++]){case 0:for(z=re=0;re<dt;z=re+=1)kt[W++]=s[p++];break;case 1:for(z=ee=0;ee<dt;z=ee+=1)F=s[p++],H=z<c?0:kt[W-c],kt[W++]=(F+H)%256;break;case 2:for(z=se=0;se<dt;z=se+=1)F=s[p++],U=(z-z%c)/c,It=at&&kt[(at-1)*dt+U*c+z%c],kt[W++]=(It+F)%256;break;case 3:for(z=Ot=0;Ot<dt;z=Ot+=1)F=s[p++],U=(z-z%c)/c,H=z<c?0:kt[W-c],It=at&&kt[(at-1)*dt+U*c+z%c],kt[W++]=(F+Math.floor((H+It)/2))%256;break;case 4:for(z=Xt=0;Xt<dt;z=Xt+=1)F=s[p++],U=(z-z%c)/c,H=z<c?0:kt[W-c],at===0?It=xt=0:(It=kt[(at-1)*dt+U*c+z%c],xt=U&&kt[(at-1)*dt+(U-1)*c+z%c]),yt=H+It-xt,bt=Math.abs(yt-H),mt=Math.abs(yt-It),Dt=Math.abs(yt-xt),vt=bt<=mt&&bt<=Dt?H:mt<=Dt?It:xt,kt[W++]=(F+vt)%256;break;default:throw new Error("Invalid filter algorithm: "+s[p-1])}if(!it){var Et=((C+at*N)*_.width+S)*c,Pt=at*dt;for(z=0;z<Wt;z+=1){for(var jt=0;jt<c;jt+=1)a[Et++]=kt[Pt++];Et+=(I-1)*c}}at++}}return s=Zet(s),_.interlaceMethod==1?(w(0,0,8,8),w(4,0,8,8),w(0,4,4,8),w(2,0,4,4),w(0,2,2,4),w(1,0,2,2),w(0,1,1,2)):w(0,0,1,1),a},i.prototype.decodePalette=function(){var s,c,a,p,_,w,S,C,I;for(a=this.palette,w=this.transparency.indexed||[],_=new Uint8Array((w.length||0)+a.length),p=0,s=0,c=S=0,C=a.length;S<C;c=S+=3)_[p++]=a[c],_[p++]=a[c+1],_[p++]=a[c+2],_[p++]=(I=w[s++])!=null?I:255;return _},i.prototype.copyToImageData=function(s,c){var a,p,_,w,S,C,I,N,F,W,U;if(p=this.colors,F=null,a=this.hasAlphaChannel,this.palette.length&&(F=(U=this._decodedPalette)!=null?U:this._decodedPalette=this.decodePalette(),p=4,a=!0),N=(_=s.data||s).length,S=F||c,w=C=0,p===1)for(;w<N;)I=F?4*c[w/4]:C,W=S[I++],_[w++]=W,_[w++]=W,_[w++]=W,_[w++]=a?S[I++]:255,C=I;else for(;w<N;)I=F?4*c[w/4]:C,_[w++]=S[I++],_[w++]=S[I++],_[w++]=S[I++],_[w++]=a?S[I++]:255,C=I},i.prototype.decode=function(){var s;return s=new Uint8Array(this.width*this.height*4),this.copyToImageData(s,this.decodePixels()),s};var n=function(){if(Object.prototype.toString.call(Rr)==="[object Window]"){try{t=Rr.document.createElement("canvas"),r=t.getContext("2d")}catch{return!1}return!0}return!1};return n(),e=function(s){var c;if(n()===!0)return r.width=s.width,r.height=s.height,r.clearRect(0,0,s.width,s.height),r.putImageData(s,0,0),(c=new Image).src=t.toDataURL(),c;throw new Error("This method requires a Browser with Canvas-capability.")},i.prototype.decodeFrames=function(s){var c,a,p,_,w,S,C,I;if(this.animation){for(I=[],a=w=0,S=(C=this.animation.frames).length;w<S;a=++w)c=C[a],p=s.createImageData(c.width,c.height),_=this.decodePixels(new Uint8Array(c.data)),this.copyToImageData(p,_),c.imageData=p,I.push(c.image=e(p));return I}},i.prototype.renderFrame=function(s,c){var a,p,_;return a=(p=this.animation.frames)[c],_=p[c-1],c===0&&s.clearRect(0,0,this.width,this.height),(_!=null?_.disposeOp:void 0)===1?s.clearRect(_.xOffset,_.yOffset,_.width,_.height):(_!=null?_.disposeOp:void 0)===2&&s.putImageData(_.imageData,_.xOffset,_.yOffset),a.blendOp===0&&s.clearRect(a.xOffset,a.yOffset,a.width,a.height),s.drawImage(a.image,a.xOffset,a.yOffset)},i.prototype.animate=function(s){var c,a,p,_,w,S,C=this;return a=0,S=this.animation,_=S.numFrames,p=S.frames,w=S.numPlays,(c=function(){var I,N;if(I=a++%_,N=p[I],C.renderFrame(s,I),_>1&&a/_<w)return C.animation._timeout=setTimeout(c,N.delay)})()},i.prototype.stopAnimation=function(){var s;return clearTimeout((s=this.animation)!=null?s._timeout:void 0)},i.prototype.render=function(s){var c,a;return s._png&&s._png.stopAnimation(),s._png=this,s.width=this.width,s.height=this.height,c=s.getContext("2d"),this.animation?(this.decodeFrames(c),this.animate(c)):(a=c.createImageData(this.width,this.height),this.copyToImageData(a,this.decodePixels()),c.putImageData(a,0,0))},i}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function grt(e){var t=0;if(e[t++]!==71||e[t++]!==73||e[t++]!==70||e[t++]!==56||(e[t++]+1&253)!=56||e[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var r=e[t++]|e[t++]<<8,i=e[t++]|e[t++]<<8,n=e[t++],s=n>>7,c=1<<(7&n)+1;e[t++],e[t++];var a=null,p=null;s&&(a=t,p=c,t+=3*c);var _=!0,w=[],S=0,C=null,I=0,N=null;for(this.width=r,this.height=i;_&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(e[t]!==11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t+=14,N=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((at=e[t++])>=0))throw Error("Invalid block size");if(at===0)break;t+=at}break;case 249:if(e[t++]!==4||e[t+4]!==0)throw new Error("Invalid graphics extension block.");var F=e[t++];S=e[t++]|e[t++]<<8,C=e[t++],!(1&F)&&(C=null),I=F>>2&7,t++;break;case 254:for(;;){if(!((at=e[t++])>=0))throw Error("Invalid block size");if(at===0)break;t+=at}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var W=e[t++]|e[t++]<<8,U=e[t++]|e[t++]<<8,z=e[t++]|e[t++]<<8,H=e[t++]|e[t++]<<8,nt=e[t++],yt=nt>>6&1,bt=1<<(7&nt)+1,vt=a,mt=p,Dt=!1;nt>>7&&(Dt=!0,vt=t,mt=bt,t+=3*bt);var kt=t;for(t++;;){var at;if(!((at=e[t++])>=0))throw Error("Invalid block size");if(at===0)break;t+=at}w.push({x:W,y:U,width:z,height:H,has_local_palette:Dt,palette_offset:vt,palette_size:mt,data_offset:kt,data_length:t-kt,transparent_index:C,interlaced:!!yt,delay:S,disposal:I});break;case 59:_=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return w.length},this.loopCount=function(){return N},this.frameInfo=function(dt){if(dt<0||dt>=w.length)throw new Error("Frame index out of range.");return w[dt]},this.decodeAndBlitFrameBGRA=function(dt,It){var xt=this.frameInfo(dt),re=xt.width*xt.height,ee=new Uint8Array(re);KI(e,xt.data_offset,ee,re);var se=xt.palette_offset,Ot=xt.transparent_index;Ot===null&&(Ot=256);var Xt=xt.width,Wt=r-Xt,xe=Xt,it=4*(xt.y*r+xt.x),Et=4*((xt.y+xt.height)*r+xt.x),Pt=it,jt=4*Wt;xt.interlaced===!0&&(jt+=4*r*7);for(var qt=8,$t=0,Qt=ee.length;$t<Qt;++$t){var Kt=ee[$t];if(xe===0&&(xe=Xt,(Pt+=jt)>=Et&&(jt=4*Wt+4*r*(qt-1),Pt=it+(Xt+Wt)*(qt<<1),qt>>=1)),Kt===Ot)Pt+=4;else{var Ee=e[se+3*Kt],Me=e[se+3*Kt+1],De=e[se+3*Kt+2];It[Pt++]=De,It[Pt++]=Me,It[Pt++]=Ee,It[Pt++]=255}--xe}},this.decodeAndBlitFrameRGBA=function(dt,It){var xt=this.frameInfo(dt),re=xt.width*xt.height,ee=new Uint8Array(re);KI(e,xt.data_offset,ee,re);var se=xt.palette_offset,Ot=xt.transparent_index;Ot===null&&(Ot=256);var Xt=xt.width,Wt=r-Xt,xe=Xt,it=4*(xt.y*r+xt.x),Et=4*((xt.y+xt.height)*r+xt.x),Pt=it,jt=4*Wt;xt.interlaced===!0&&(jt+=4*r*7);for(var qt=8,$t=0,Qt=ee.length;$t<Qt;++$t){var Kt=ee[$t];if(xe===0&&(xe=Xt,(Pt+=jt)>=Et&&(jt=4*Wt+4*r*(qt-1),Pt=it+(Xt+Wt)*(qt<<1),qt>>=1)),Kt===Ot)Pt+=4;else{var Ee=e[se+3*Kt],Me=e[se+3*Kt+1],De=e[se+3*Kt+2];It[Pt++]=Ee,It[Pt++]=Me,It[Pt++]=De,It[Pt++]=255}--xe}}}function KI(e,t,r,i){for(var n=e[t++],s=1<<n,c=s+1,a=c+1,p=n+1,_=(1<<p)-1,w=0,S=0,C=0,I=e[t++],N=new Int32Array(4096),F=null;;){for(;w<16&&I!==0;)S|=e[t++]<<w,w+=8,I===1?I=e[t++]:--I;if(w<p)break;var W=S&_;if(S>>=p,w-=p,W!==s){if(W===c)break;for(var U=W<a?W:F,z=0,H=U;H>s;)H=N[H]>>8,++z;var nt=H;if(C+z+(U!==W?1:0)>i)return void Ji.log("Warning, gif stream longer than expected.");r[C++]=nt;var yt=C+=z;for(U!==W&&(r[C++]=nt),H=U;z--;)H=N[H],r[--yt]=255&H,H>>=8;F!==null&&a<4096&&(N[a++]=F<<8|nt,a>=_+1&&p<12&&(++p,_=_<<1|1)),F=W}else a=c+1,_=(1<<(p=n+1))-1,F=null}return C!==i&&Ji.log("Warning, gif stream shorter than expected."),r}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function J2(e){var t,r,i,n,s,c=Math.floor,a=new Array(64),p=new Array(64),_=new Array(64),w=new Array(64),S=new Array(65535),C=new Array(65535),I=new Array(64),N=new Array(64),F=[],W=0,U=7,z=new Array(64),H=new Array(64),nt=new Array(64),yt=new Array(256),bt=new Array(2048),vt=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],mt=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],Dt=[0,1,2,3,4,5,6,7,8,9,10,11],kt=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],at=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],dt=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],It=[0,1,2,3,4,5,6,7,8,9,10,11],xt=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],re=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ee(it,Et){for(var Pt=0,jt=0,qt=new Array,$t=1;$t<=16;$t++){for(var Qt=1;Qt<=it[$t];Qt++)qt[Et[jt]]=[],qt[Et[jt]][0]=Pt,qt[Et[jt]][1]=$t,jt++,Pt++;Pt*=2}return qt}function se(it){for(var Et=it[0],Pt=it[1]-1;Pt>=0;)Et&1<<Pt&&(W|=1<<U),Pt--,--U<0&&(W==255?(Ot(255),Ot(0)):Ot(W),U=7,W=0)}function Ot(it){F.push(it)}function Xt(it){Ot(it>>8&255),Ot(255&it)}function Wt(it,Et,Pt,jt,qt){for(var $t,Qt=qt[0],Kt=qt[240],Ee=function(de,Te){var Be,Ne,rr,Er,wr,Fr,Ur,me,hr,xr,Fe=0;for(hr=0;hr<8;++hr){Be=de[Fe],Ne=de[Fe+1],rr=de[Fe+2],Er=de[Fe+3],wr=de[Fe+4],Fr=de[Fe+5],Ur=de[Fe+6];var wi=Be+(me=de[Fe+7]),ge=Be-me,br=Ne+Ur,Ge=Ne-Ur,Hr=rr+Fr,Qi=rr-Fr,je=Er+wr,In=Er-wr,si=wi+je,on=wi-je,an=br+Hr,At=br-Hr;de[Fe]=si+an,de[Fe+4]=si-an;var J=.707106781*(At+on);de[Fe+2]=on+J,de[Fe+6]=on-J;var Q=.382683433*((si=In+Qi)-(At=Ge+ge)),ut=.5411961*si+Q,wt=1.306562965*At+Q,Nt=.707106781*(an=Qi+Ge),Vt=ge+Nt,Ft=ge-Nt;de[Fe+5]=Ft+ut,de[Fe+3]=Ft-ut,de[Fe+1]=Vt+wt,de[Fe+7]=Vt-wt,Fe+=8}for(Fe=0,hr=0;hr<8;++hr){Be=de[Fe],Ne=de[Fe+8],rr=de[Fe+16],Er=de[Fe+24],wr=de[Fe+32],Fr=de[Fe+40],Ur=de[Fe+48];var Lt=Be+(me=de[Fe+56]),ne=Be-me,ue=Ne+Ur,Zt=Ne-Ur,be=rr+Fr,We=rr-Fr,Ke=Er+wr,Br=Er-wr,tr=Lt+Ke,Ir=Lt-Ke,Sr=ue+be,oi=ue-be;de[Fe]=tr+Sr,de[Fe+32]=tr-Sr;var Wr=.707106781*(oi+Ir);de[Fe+16]=Ir+Wr,de[Fe+48]=Ir-Wr;var dr=.382683433*((tr=Br+We)-(oi=Zt+ne)),Nr=.5411961*tr+dr,ei=1.306562965*oi+dr,yi=.707106781*(Sr=We+Zt),Pi=ne+yi,tn=ne-yi;de[Fe+40]=tn+Nr,de[Fe+24]=tn-Nr,de[Fe+8]=Pi+ei,de[Fe+56]=Pi-ei,Fe++}for(hr=0;hr<64;++hr)xr=de[hr]*Te[hr],I[hr]=xr>0?xr+.5|0:xr-.5|0;return I}(it,Et),Me=0;Me<64;++Me)N[vt[Me]]=Ee[Me];var De=N[0]-Pt;Pt=N[0],De==0?se(jt[0]):(se(jt[C[$t=32767+De]]),se(S[$t]));for(var ze=63;ze>0&&N[ze]==0;)ze--;if(ze==0)return se(Qt),Pt;for(var or,le=1;le<=ze;){for(var st=le;N[le]==0&&le<=ze;)++le;var mr=le-st;if(mr>=16){or=mr>>4;for(var Qe=1;Qe<=or;++Qe)se(Kt);mr&=15}$t=32767+N[le],se(qt[(mr<<4)+C[$t]]),se(S[$t]),le++}return ze!=63&&se(Qt),Pt}function xe(it){it=Math.min(Math.max(it,1),100),s!=it&&(function(Et){for(var Pt=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],jt=0;jt<64;jt++){var qt=c((Pt[jt]*Et+50)/100);qt=Math.min(Math.max(qt,1),255),a[vt[jt]]=qt}for(var $t=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Qt=0;Qt<64;Qt++){var Kt=c(($t[Qt]*Et+50)/100);Kt=Math.min(Math.max(Kt,1),255),p[vt[Qt]]=Kt}for(var Ee=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Me=0,De=0;De<8;De++)for(var ze=0;ze<8;ze++)_[Me]=1/(a[vt[Me]]*Ee[De]*Ee[ze]*8),w[Me]=1/(p[vt[Me]]*Ee[De]*Ee[ze]*8),Me++}(it<50?Math.floor(5e3/it):Math.floor(200-2*it)),s=it)}this.encode=function(it,Et){Et&&xe(Et),F=new Array,W=0,U=7,Xt(65496),Xt(65504),Xt(16),Ot(74),Ot(70),Ot(73),Ot(70),Ot(0),Ot(1),Ot(1),Ot(0),Xt(1),Xt(1),Ot(0),Ot(0),function(){Xt(65499),Xt(132),Ot(0);for(var Ne=0;Ne<64;Ne++)Ot(a[Ne]);Ot(1);for(var rr=0;rr<64;rr++)Ot(p[rr])}(),function(Ne,rr){Xt(65472),Xt(17),Ot(8),Xt(rr),Xt(Ne),Ot(3),Ot(1),Ot(17),Ot(0),Ot(2),Ot(17),Ot(1),Ot(3),Ot(17),Ot(1)}(it.width,it.height),function(){Xt(65476),Xt(418),Ot(0);for(var Ne=0;Ne<16;Ne++)Ot(mt[Ne+1]);for(var rr=0;rr<=11;rr++)Ot(Dt[rr]);Ot(16);for(var Er=0;Er<16;Er++)Ot(kt[Er+1]);for(var wr=0;wr<=161;wr++)Ot(at[wr]);Ot(1);for(var Fr=0;Fr<16;Fr++)Ot(dt[Fr+1]);for(var Ur=0;Ur<=11;Ur++)Ot(It[Ur]);Ot(17);for(var me=0;me<16;me++)Ot(xt[me+1]);for(var hr=0;hr<=161;hr++)Ot(re[hr])}(),Xt(65498),Xt(12),Ot(3),Ot(1),Ot(0),Ot(2),Ot(17),Ot(3),Ot(17),Ot(0),Ot(63),Ot(0);var Pt=0,jt=0,qt=0;W=0,U=7,this.encode.displayName="_encode_";for(var $t,Qt,Kt,Ee,Me,De,ze,or,le,st=it.data,mr=it.width,Qe=it.height,de=4*mr,Te=0;Te<Qe;){for($t=0;$t<de;){for(Me=de*Te+$t,ze=-1,or=0,le=0;le<64;le++)De=Me+(or=le>>3)*de+(ze=4*(7&le)),Te+or>=Qe&&(De-=de*(Te+1+or-Qe)),$t+ze>=de&&(De-=$t+ze-de+4),Qt=st[De++],Kt=st[De++],Ee=st[De++],z[le]=(bt[Qt]+bt[Kt+256>>0]+bt[Ee+512>>0]>>16)-128,H[le]=(bt[Qt+768>>0]+bt[Kt+1024>>0]+bt[Ee+1280>>0]>>16)-128,nt[le]=(bt[Qt+1280>>0]+bt[Kt+1536>>0]+bt[Ee+1792>>0]>>16)-128;Pt=Wt(z,_,Pt,t,i),jt=Wt(H,w,jt,r,n),qt=Wt(nt,w,qt,r,n),$t+=32}Te+=8}if(U>=0){var Be=[];Be[1]=U+1,Be[0]=(1<<U+1)-1,se(Be)}return Xt(65497),new Uint8Array(F)},e=e||50,function(){for(var it=String.fromCharCode,Et=0;Et<256;Et++)yt[Et]=it(Et)}(),t=ee(mt,Dt),r=ee(dt,It),i=ee(kt,at),n=ee(xt,re),function(){for(var it=1,Et=2,Pt=1;Pt<=15;Pt++){for(var jt=it;jt<Et;jt++)C[32767+jt]=Pt,S[32767+jt]=[],S[32767+jt][1]=Pt,S[32767+jt][0]=jt;for(var qt=-(Et-1);qt<=-it;qt++)C[32767+qt]=Pt,S[32767+qt]=[],S[32767+qt][1]=Pt,S[32767+qt][0]=Et-1+qt;it<<=1,Et<<=1}}(),function(){for(var it=0;it<256;it++)bt[it]=19595*it,bt[it+256>>0]=38470*it,bt[it+512>>0]=7471*it+32768,bt[it+768>>0]=-11059*it,bt[it+1024>>0]=-21709*it,bt[it+1280>>0]=32768*it+8421375,bt[it+1536>>0]=-27439*it,bt[it+1792>>0]=-5329*it}(),xe(e)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function uc(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function QI(e){function t(mt){if(!mt)throw Error("assert :P")}function r(mt,Dt,kt){for(var at=0;4>at;at++)if(mt[Dt+at]!=kt.charCodeAt(at))return!0;return!1}function i(mt,Dt,kt,at,dt){for(var It=0;It<dt;It++)mt[Dt+It]=kt[at+It]}function n(mt,Dt,kt,at){for(var dt=0;dt<at;dt++)mt[Dt+dt]=kt}function s(mt){return new Int32Array(mt)}function c(mt,Dt){for(var kt=[],at=0;at<mt;at++)kt.push(new Dt);return kt}function a(mt,Dt){var kt=[];return function at(dt,It,xt){for(var re=xt[It],ee=0;ee<re&&(dt.push(xt.length>It+1?[]:new Dt),!(xt.length<It+1));ee++)at(dt[ee],It+1,xt)}(kt,0,mt),kt}var p=function(){var mt=this;function Dt(A,M){for(var g=1<<M-1>>>0;A&g;)g>>>=1;return g?(A&g-1)+g:A}function kt(A,M,g,o,h){t(!(o%g));do A[M+(o-=g)]=h;while(0<o)}function at(A,M,g,o,h){if(t(2328>=h),512>=h)var m=s(512);else if((m=s(h))==null)return 0;return function(y,v,E,P,B,D){var G,j,Z=v,Y=1<<E,X=s(16),tt=s(16);for(t(B!=0),t(P!=null),t(y!=null),t(0<E),j=0;j<B;++j){if(15<P[j])return 0;++X[P[j]]}if(X[0]==B)return 0;for(tt[1]=0,G=1;15>G;++G){if(X[G]>1<<G)return 0;tt[G+1]=tt[G]+X[G]}for(j=0;j<B;++j)G=P[j],0<P[j]&&(D[tt[G]++]=j);if(tt[15]==1)return(P=new dt).g=0,P.value=D[0],kt(y,Z,1,Y,P),Y;var ct,ht=-1,gt=Y-1,pt=0,St=1,Rt=1,Bt=1<<E;for(j=0,G=1,B=2;G<=E;++G,B<<=1){if(St+=Rt<<=1,0>(Rt-=X[G]))return 0;for(;0<X[G];--X[G])(P=new dt).g=G,P.value=D[j++],kt(y,Z+pt,B,Bt,P),pt=Dt(pt,G)}for(G=E+1,B=2;15>=G;++G,B<<=1){if(St+=Rt<<=1,0>(Rt-=X[G]))return 0;for(;0<X[G];--X[G]){if(P=new dt,(pt&gt)!=ht){for(Z+=Bt,ct=1<<(ht=G)-E;15>ht&&!(0>=(ct-=X[ht]));)++ht,ct<<=1;Y+=Bt=1<<(ct=ht-E),y[v+(ht=pt&gt)].g=ct+E,y[v+ht].value=Z-v-ht}P.g=G-E,P.value=D[j++],kt(y,Z+(pt>>E),B,Bt,P),pt=Dt(pt,G)}}return St!=2*tt[15]-1?0:Y}(A,M,g,o,h,m)}function dt(){this.value=this.g=0}function It(){this.value=this.g=0}function xt(){this.G=c(5,dt),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=c(Yn,It)}function re(A,M,g,o){t(A!=null),t(M!=null),t(2147483648>o),A.Ca=254,A.I=0,A.b=-8,A.Ka=0,A.oa=M,A.pa=g,A.Jd=M,A.Yc=g+o,A.Zc=4<=o?g+o-4+1:g,$t(A)}function ee(A,M){for(var g=0;0<M--;)g|=Kt(A,128)<<M;return g}function se(A,M){var g=ee(A,M);return Qt(A)?-g:g}function Ot(A,M,g,o){var h,m=0;for(t(A!=null),t(M!=null),t(4294967288>o),A.Sb=o,A.Ra=0,A.u=0,A.h=0,4<o&&(o=4),h=0;h<o;++h)m+=M[g+h]<<8*h;A.Ra=m,A.bb=o,A.oa=M,A.pa=g}function Xt(A){for(;8<=A.u&&A.bb<A.Sb;)A.Ra>>>=8,A.Ra+=A.oa[A.pa+A.bb]<<io-8>>>0,++A.bb,A.u-=8;Pt(A)&&(A.h=1,A.u=0)}function Wt(A,M){if(t(0<=M),!A.h&&M<=gl){var g=Et(A)&ml[M];return A.u+=M,Xt(A),g}return A.h=1,A.u=0}function xe(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function it(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Et(A){return A.Ra>>>(A.u&io-1)>>>0}function Pt(A){return t(A.bb<=A.Sb),A.h||A.bb==A.Sb&&A.u>io}function jt(A,M){A.u=M,A.h=Pt(A)}function qt(A){A.u>=Fa&&(t(A.u>=Fa),Xt(A))}function $t(A){t(A!=null&&A.oa!=null),A.pa<A.Zc?(A.I=(A.oa[A.pa++]|A.I<<8)>>>0,A.b+=8):(t(A!=null&&A.oa!=null),A.pa<A.Yc?(A.b+=8,A.I=A.oa[A.pa++]|A.I<<8):A.Ka?A.b=0:(A.I<<=8,A.b+=8,A.Ka=1))}function Qt(A){return ee(A,1)}function Kt(A,M){var g=A.Ca;0>A.b&&$t(A);var o=A.b,h=g*M>>>8,m=(A.I>>>o>h)+0;for(m?(g-=h,A.I-=h+1<<o>>>0):g=h+1,o=g,h=0;256<=o;)h+=8,o>>=8;return o=7^h+Bn[o],A.b-=o,A.Ca=(g<<o)-1,m}function Ee(A,M,g){A[M+0]=g>>24&255,A[M+1]=g>>16&255,A[M+2]=g>>8&255,A[M+3]=g>>0&255}function Me(A,M){return A[M+0]<<0|A[M+1]<<8}function De(A,M){return Me(A,M)|A[M+2]<<16}function ze(A,M){return Me(A,M)|Me(A,M+2)<<16}function or(A,M){var g=1<<M;return t(A!=null),t(0<M),A.X=s(g),A.X==null?0:(A.Mb=32-M,A.Xa=M,1)}function le(A,M){t(A!=null),t(M!=null),t(A.Xa==M.Xa),i(M.X,0,A.X,0,1<<M.Xa)}function st(){this.X=[],this.Xa=this.Mb=0}function mr(A,M,g,o){t(g!=null),t(o!=null);var h=g[0],m=o[0];return h==0&&(h=(A*m+M/2)/M),m==0&&(m=(M*h+A/2)/A),0>=h||0>=m?0:(g[0]=h,o[0]=m,1)}function Qe(A,M){return A+(1<<M)-1>>>M}function de(A,M){return((4278255360&A)+(4278255360&M)>>>0&4278255360)+((16711935&A)+(16711935&M)>>>0&16711935)>>>0}function Te(A,M){mt[M]=function(g,o,h,m,y,v,E){var P;for(P=0;P<y;++P){var B=mt[A](v[E+P-1],h,m+P);v[E+P]=de(g[o+P],B)}}}function Be(){this.ud=this.hd=this.jd=0}function Ne(A,M){return((4278124286&(A^M))>>>1)+(A&M)>>>0}function rr(A){return 0<=A&&256>A?A:0>A?0:255<A?255:void 0}function Er(A,M){return rr(A+(A-M+.5>>1))}function wr(A,M,g){return Math.abs(M-g)-Math.abs(A-g)}function Fr(A,M,g,o,h,m,y){for(o=m[y-1],g=0;g<h;++g)m[y+g]=o=de(A[M+g],o)}function Ur(A,M,g,o,h){var m;for(m=0;m<g;++m){var y=A[M+m],v=y>>8&255,E=16711935&(E=(E=16711935&y)+((v<<16)+v));o[h+m]=(4278255360&y)+E>>>0}}function me(A,M){M.jd=A>>0&255,M.hd=A>>8&255,M.ud=A>>16&255}function hr(A,M,g,o,h,m){var y;for(y=0;y<o;++y){var v=M[g+y],E=v>>>8,P=v,B=255&(B=(B=v>>>16)+((A.jd<<24>>24)*(E<<24>>24)>>>5));P=255&(P=(P=P+((A.hd<<24>>24)*(E<<24>>24)>>>5))+((A.ud<<24>>24)*(B<<24>>24)>>>5)),h[m+y]=(4278255360&v)+(B<<16)+P}}function xr(A,M,g,o,h){mt[M]=function(m,y,v,E,P,B,D,G,j){for(E=D;E<G;++E)for(D=0;D<j;++D)P[B++]=h(v[o(m[y++])])},mt[A]=function(m,y,v,E,P,B,D){var G=8>>m.b,j=m.Ea,Z=m.K[0],Y=m.w;if(8>G)for(m=(1<<m.b)-1,Y=(1<<G)-1;y<v;++y){var X,tt=0;for(X=0;X<j;++X)X&m||(tt=o(E[P++])),B[D++]=h(Z[tt&Y]),tt>>=G}else mt["VP8LMapColor"+g](E,P,Z,Y,B,D,y,v,j)}}function Fe(A,M,g,o,h){for(g=M+g;M<g;){var m=A[M++];o[h++]=m>>16&255,o[h++]=m>>8&255,o[h++]=m>>0&255}}function wi(A,M,g,o,h){for(g=M+g;M<g;){var m=A[M++];o[h++]=m>>16&255,o[h++]=m>>8&255,o[h++]=m>>0&255,o[h++]=m>>24&255}}function ge(A,M,g,o,h){for(g=M+g;M<g;){var m=(y=A[M++])>>16&240|y>>12&15,y=y>>0&240|y>>28&15;o[h++]=m,o[h++]=y}}function br(A,M,g,o,h){for(g=M+g;M<g;){var m=(y=A[M++])>>16&248|y>>13&7,y=y>>5&224|y>>3&31;o[h++]=m,o[h++]=y}}function Ge(A,M,g,o,h){for(g=M+g;M<g;){var m=A[M++];o[h++]=m>>0&255,o[h++]=m>>8&255,o[h++]=m>>16&255}}function Hr(A,M,g,o,h,m){if(m==0)for(g=M+g;M<g;)Ee(o,((m=A[M++])[0]>>24|m[1]>>8&65280|m[2]<<8&16711680|m[3]<<24)>>>0),h+=32;else i(o,h,A,M,g)}function Qi(A,M){mt[M][0]=mt[A+"0"],mt[M][1]=mt[A+"1"],mt[M][2]=mt[A+"2"],mt[M][3]=mt[A+"3"],mt[M][4]=mt[A+"4"],mt[M][5]=mt[A+"5"],mt[M][6]=mt[A+"6"],mt[M][7]=mt[A+"7"],mt[M][8]=mt[A+"8"],mt[M][9]=mt[A+"9"],mt[M][10]=mt[A+"10"],mt[M][11]=mt[A+"11"],mt[M][12]=mt[A+"12"],mt[M][13]=mt[A+"13"],mt[M][14]=mt[A+"0"],mt[M][15]=mt[A+"0"]}function je(A){return A==$c||A==tc||A==Wc||A==Nu}function In(){this.eb=[],this.size=this.A=this.fb=0}function si(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function on(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new In,this.f.kb=new si,this.sd=null}function an(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function At(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function J(A){return alert("todo:WebPSamplerProcessPlane"),A.T}function Q(A,M){var g=A.T,o=M.ba.f.RGBA,h=o.eb,m=o.fb+A.ka*o.A,y=Pr[M.ba.S],v=A.y,E=A.O,P=A.f,B=A.N,D=A.ea,G=A.W,j=M.cc,Z=M.dc,Y=M.Mc,X=M.Nc,tt=A.ka,ct=A.ka+A.T,ht=A.U,gt=ht+1>>1;for(tt==0?y(v,E,null,null,P,B,D,G,P,B,D,G,h,m,null,null,ht):(y(M.ec,M.fc,v,E,j,Z,Y,X,P,B,D,G,h,m-o.A,h,m,ht),++g);tt+2<ct;tt+=2)j=P,Z=B,Y=D,X=G,B+=A.Rc,G+=A.Rc,m+=2*o.A,y(v,(E+=2*A.fa)-A.fa,v,E,j,Z,Y,X,P,B,D,G,h,m-o.A,h,m,ht);return E+=A.fa,A.j+ct<A.o?(i(M.ec,M.fc,v,E,ht),i(M.cc,M.dc,P,B,gt),i(M.Mc,M.Nc,D,G,gt),g--):1&ct||y(v,E,null,null,P,B,D,G,P,B,D,G,h,m+o.A,null,null,ht),g}function ut(A,M,g){var o=A.F,h=[A.J];if(o!=null){var m=A.U,y=M.ba.S,v=y==Hc||y==Wc;M=M.ba.f.RGBA;var E=[0],P=A.ka;E[0]=A.T,A.Kb&&(P==0?--E[0]:(--P,h[0]-=A.width),A.j+A.ka+A.T==A.o&&(E[0]=A.o-A.j-P));var B=M.eb;P=M.fb+P*M.A,A=ca(o,h[0],A.width,m,E,B,P+(v?0:3),M.A),t(g==E),A&&je(y)&&lo(B,P,v,m,E,M.A)}return 0}function wt(A){var M=A.ma,g=M.ba.S,o=11>g,h=g==Kl||g==Ql||g==Hc||g==Du||g==12||je(g);if(M.memory=null,M.Ib=null,M.Jb=null,M.Nd=null,!jo(M.Oa,A,h?11:12))return 0;if(h&&je(g)&&Le(),A.da)alert("todo:use_scaling");else{if(o){if(M.Ib=J,A.Kb){if(g=A.U+1>>1,M.memory=s(A.U+2*g),M.memory==null)return 0;M.ec=M.memory,M.fc=0,M.cc=M.ec,M.dc=M.fc+A.U,M.Mc=M.cc,M.Nc=M.dc+g,M.Ib=Q,Le()}}else alert("todo:EmitYUV");h&&(M.Jb=ut,o&&Yt())}if(o&&!Ai){for(A=0;256>A;++A)Jc[A]=89858*(A-128)+Bh>>ju,$p[A]=-22014*(A-128)+Bh,Rh[A]=-45773*(A-128),kh[A]=113618*(A-128)+Bh>>ju;for(A=ic;A<Vd;++A)M=76283*(A-16)+Bh>>ju,Uu[A-ic]=Zr(M,255),Gu[A-ic]=Zr(M+8>>4,15);Ai=1}return 1}function Nt(A){var M=A.ma,g=A.U,o=A.T;return t(!(1&A.ka)),0>=g||0>=o?0:(g=M.Ib(A,M),M.Jb!=null&&M.Jb(A,M,g),M.Dc+=g,1)}function Vt(A){A.ma.memory=null}function Ft(A,M,g,o){return Wt(A,8)!=47?0:(M[0]=Wt(A,14)+1,g[0]=Wt(A,14)+1,o[0]=Wt(A,1),Wt(A,3)!=0?0:!A.h)}function Lt(A,M){if(4>A)return A+1;var g=A-2>>1;return(2+(1&A)<<g)+Wt(M,g)+1}function ne(A,M){return 120<M?M-120:1<=(g=((g=uo[M-1])>>4)*A+(8-(15&g)))?g:1;var g}function ue(A,M,g){var o=Et(g),h=A[M+=255&o].g-8;return 0<h&&(jt(g,g.u+8),o=Et(g),M+=A[M].value,M+=o&(1<<h)-1),jt(g,g.u+A[M].g),A[M].value}function Zt(A,M,g){return g.g+=A.g,g.value+=A.value<<M>>>0,t(8>=g.g),A.g}function be(A,M,g){var o=A.xc;return t((M=o==0?0:A.vc[A.md*(g>>o)+(M>>o)])<A.Wb),A.Ya[M]}function We(A,M,g,o){var h=A.ab,m=A.c*M,y=A.C;M=y+M;var v=g,E=o;for(o=A.Ta,g=A.Ua;0<h--;){var P=A.gc[h],B=y,D=M,G=v,j=E,Z=(E=o,v=g,P.Ea);switch(t(B<D),t(D<=P.nc),P.hc){case 2:Zl(G,j,(D-B)*Z,E,v);break;case 0:var Y=B,X=D,tt=E,ct=v,ht=(Bt=P).Ea;Y==0&&(yl(G,j,null,null,1,tt,ct),Fr(G,j+1,0,0,ht-1,tt,ct+1),j+=ht,ct+=ht,++Y);for(var gt=1<<Bt.b,pt=gt-1,St=Qe(ht,Bt.b),Rt=Bt.K,Bt=Bt.w+(Y>>Bt.b)*St;Y<X;){var ie=Rt,pe=Bt,ye=1;for(Da(G,j,tt,ct-ht,1,tt,ct);ye<ht;){var we=(ye&~pt)+gt;we>ht&&(we=ht),(0,jr[ie[pe++]>>8&15])(G,j+ +ye,tt,ct+ye-ht,we-ye,tt,ct+ye),ye=we}j+=ht,ct+=ht,++Y&pt||(Bt+=St)}D!=P.nc&&i(E,v-Z,E,v+(D-B-1)*Z,Z);break;case 1:for(Z=G,X=j,ht=(G=P.Ea)-(ct=G&~(tt=(j=1<<P.b)-1)),Y=Qe(G,P.b),gt=P.K,P=P.w+(B>>P.b)*Y;B<D;){for(pt=gt,St=P,Rt=new Be,Bt=X+ct,ie=X+G;X<Bt;)me(pt[St++],Rt),ps(Rt,Z,X,j,E,v),X+=j,v+=j;X<ie&&(me(pt[St++],Rt),ps(Rt,Z,X,ht,E,v),X+=ht,v+=ht),++B&tt||(P+=Y)}break;case 3:if(G==E&&j==v&&0<P.b){for(X=E,G=Z=v+(D-B)*Z-(ct=(D-B)*Qe(P.Ea,P.b)),j=E,tt=v,Y=[],ct=(ht=ct)-1;0<=ct;--ct)Y[ct]=j[tt+ct];for(ct=ht-1;0<=ct;--ct)X[G+ct]=Y[ct];Jn(P,B,D,E,Z,E,v)}else Jn(P,B,D,G,j,E,v)}v=o,E=g}E!=g&&i(o,g,v,E,m)}function Ke(A,M){var g=A.V,o=A.Ba+A.c*A.C,h=M-A.C;if(t(M<=A.l.o),t(16>=h),0<h){var m=A.l,y=A.Ta,v=A.Ua,E=m.width;if(We(A,h,g,o),h=v=[v],t((g=A.C)<(o=M)),t(m.v<m.va),o>m.o&&(o=m.o),g<m.j){var P=m.j-g;g=m.j,h[0]+=P*E}if(g>=o?g=0:(h[0]+=4*m.v,m.ka=g-m.j,m.U=m.va-m.v,m.T=o-g,g=1),g){if(v=v[0],11>(g=A.ca).S){var B=g.f.RGBA,D=(o=g.S,h=m.U,m=m.T,P=B.eb,B.A),G=m;for(B=B.fb+A.Ma*B.A;0<G--;){var j=y,Z=v,Y=h,X=P,tt=B;switch(o){case qc:Uo(j,Z,Y,X,tt);break;case Kl:Na(j,Z,Y,X,tt);break;case $c:Na(j,Z,Y,X,tt),lo(X,tt,0,Y,1,0);break;case Lh:Oa(j,Z,Y,X,tt);break;case Ql:Hr(j,Z,Y,X,tt,1);break;case tc:Hr(j,Z,Y,X,tt,1),lo(X,tt,0,Y,1,0);break;case Hc:Hr(j,Z,Y,X,tt,0);break;case Wc:Hr(j,Z,Y,X,tt,0),lo(X,tt,1,Y,1,0);break;case Du:fs(j,Z,Y,X,tt);break;case Nu:fs(j,Z,Y,X,tt),un(X,tt,Y,1,0);break;case wl:la(j,Z,Y,X,tt);break;default:t(0)}v+=E,B+=D}A.Ma+=m}else alert("todo:EmitRescaledRowsYUVA");t(A.Ma<=g.height)}}A.C=M,t(A.C<=A.i)}function Br(A){var M;if(0<A.ua)return 0;for(M=0;M<A.Wb;++M){var g=A.Ya[M].G,o=A.Ya[M].H;if(0<g[1][o[1]+0].g||0<g[2][o[2]+0].g||0<g[3][o[3]+0].g)return 0}return 1}function tr(A,M,g,o,h,m){if(A.Z!=0){var y=A.qd,v=A.rd;for(t(da[A.Z]!=null);M<g;++M)da[A.Z](y,v,o,h,o,h,m),y=o,v=h,h+=m;A.qd=y,A.rd=v}}function Ir(A,M){var g=A.l.ma,o=g.Z==0||g.Z==1?A.l.j:A.C;if(o=A.C<o?o:A.C,t(M<=A.l.o),M>o){var h=A.l.width,m=g.ca,y=g.tb+h*o,v=A.V,E=A.Ba+A.c*o,P=A.gc;t(A.ab==1),t(P[0].hc==3),Ih(P[0],o,M,v,E,m,y),tr(g,o,M,m,y,h)}A.C=A.Ma=M}function Sr(A,M,g,o,h,m,y){var v=A.$/o,E=A.$%o,P=A.m,B=A.s,D=g+A.$,G=D;h=g+o*h;var j=g+o*m,Z=280+B.ua,Y=A.Pb?v:16777216,X=0<B.ua?B.Wa:null,tt=B.wc,ct=D<j?be(B,E,v):null;t(A.C<m),t(j<=h);var ht=!1;t:for(;;){for(;ht||D<j;){var gt=0;if(v>=Y){var pt=D-g;t((Y=A).Pb),Y.wd=Y.m,Y.xd=pt,0<Y.s.ua&&le(Y.s.Wa,Y.s.vb),Y=v+Nd}if(E&tt||(ct=be(B,E,v)),t(ct!=null),ct.Qb&&(M[D]=ct.qb,ht=!0),!ht)if(qt(P),ct.jc){gt=P,pt=M;var St=D,Rt=ct.pd[Et(gt)&Yn-1];t(ct.jc),256>Rt.g?(jt(gt,gt.u+Rt.g),pt[St]=Rt.value,gt=0):(jt(gt,gt.u+Rt.g-256),t(256<=Rt.value),gt=Rt.value),gt==0&&(ht=!0)}else gt=ue(ct.G[0],ct.H[0],P);if(P.h)break;if(ht||256>gt){if(!ht)if(ct.nd)M[D]=(ct.qb|gt<<8)>>>0;else{if(qt(P),ht=ue(ct.G[1],ct.H[1],P),qt(P),pt=ue(ct.G[2],ct.H[2],P),St=ue(ct.G[3],ct.H[3],P),P.h)break;M[D]=(St<<24|ht<<16|gt<<8|pt)>>>0}if(ht=!1,++D,++E>=o&&(E=0,++v,y!=null&&v<=m&&!(v%16)&&y(A,v),X!=null))for(;G<D;)gt=M[G++],X.X[(506832829*gt&4294967295)>>>X.Mb]=gt}else if(280>gt){if(gt=Lt(gt-256,P),pt=ue(ct.G[4],ct.H[4],P),qt(P),pt=ne(o,pt=Lt(pt,P)),P.h)break;if(D-g<pt||h-D<gt)break t;for(St=0;St<gt;++St)M[D+St]=M[D+St-pt];for(D+=gt,E+=gt;E>=o;)E-=o,++v,y!=null&&v<=m&&!(v%16)&&y(A,v);if(t(D<=h),E&tt&&(ct=be(B,E,v)),X!=null)for(;G<D;)gt=M[G++],X.X[(506832829*gt&4294967295)>>>X.Mb]=gt}else{if(!(gt<Z))break t;for(ht=gt-280,t(X!=null);G<D;)gt=M[G++],X.X[(506832829*gt&4294967295)>>>X.Mb]=gt;gt=D,t(!(ht>>>(pt=X).Xa)),M[gt]=pt.X[ht],ht=!0}ht||t(P.h==Pt(P))}if(A.Pb&&P.h&&D<h)t(A.m.h),A.a=5,A.m=A.wd,A.$=A.xd,0<A.s.ua&&le(A.s.vb,A.s.Wa);else{if(P.h)break t;y!=null&&y(A,v>m?m:v),A.a=0,A.$=D-g}return 1}return A.a=3,0}function oi(A){t(A!=null),A.vc=null,A.yc=null,A.Ya=null;var M=A.Wa;M!=null&&(M.X=null),A.vb=null,t(A!=null)}function Wr(){var A=new Xl;return A==null?null:(A.a=0,A.xb=ec,Qi("Predictor","VP8LPredictors"),Qi("Predictor","VP8LPredictors_C"),Qi("PredictorAdd","VP8LPredictorsAdd"),Qi("PredictorAdd","VP8LPredictorsAdd_C"),Zl=Ur,ps=hr,Uo=Fe,Na=wi,fs=ge,la=br,Oa=Ge,mt.VP8LMapColor32b=aa,mt.VP8LMapColor8b=Ru,A)}function dr(A,M,g,o,h){var m=1,y=[A],v=[M],E=o.m,P=o.s,B=null,D=0;t:for(;;){if(g)for(;m&&Wt(E,1);){var G=y,j=v,Z=o,Y=1,X=Z.m,tt=Z.gc[Z.ab],ct=Wt(X,2);if(Z.Oc&1<<ct)m=0;else{switch(Z.Oc|=1<<ct,tt.hc=ct,tt.Ea=G[0],tt.nc=j[0],tt.K=[null],++Z.ab,t(4>=Z.ab),ct){case 0:case 1:tt.b=Wt(X,3)+2,Y=dr(Qe(tt.Ea,tt.b),Qe(tt.nc,tt.b),0,Z,tt.K),tt.K=tt.K[0];break;case 3:var ht,gt=Wt(X,8)+1,pt=16<gt?0:4<gt?1:2<gt?2:3;if(G[0]=Qe(tt.Ea,pt),tt.b=pt,ht=Y=dr(gt,1,0,Z,tt.K)){var St,Rt=gt,Bt=tt,ie=1<<(8>>Bt.b),pe=s(ie);if(pe==null)ht=0;else{var ye=Bt.K[0],we=Bt.w;for(pe[0]=Bt.K[0][0],St=1;St<1*Rt;++St)pe[St]=de(ye[we+St],pe[St-1]);for(;St<4*ie;++St)pe[St]=0;Bt.K[0]=null,Bt.K[0]=pe,ht=1}}Y=ht;break;case 2:break;default:t(0)}m=Y}}if(y=y[0],v=v[0],m&&Wt(E,1)&&!(m=1<=(D=Wt(E,4))&&11>=D)){o.a=3;break t}var ve;if(ve=m)e:{var _e,Se,Ye,Pe=o,Ie=y,ir=v,Ar=D,vr=g,Tr=Pe.m,Dr=Pe.s,ai=[null],Ni=1,ti=0,Yi=ua[Ar];r:for(;;){if(vr&&Wt(Tr,1)){var li=Wt(Tr,3)+2,Hi=Qe(Ie,li),hn=Qe(ir,li),gs=Hi*hn;if(!dr(Hi,hn,0,Pe,ai))break r;for(ai=ai[0],Dr.xc=li,_e=0;_e<gs;++_e){var $s=ai[_e]>>8&65535;ai[_e]=$s,$s>=Ni&&(Ni=$s+1)}}if(Tr.h)break r;for(Se=0;5>Se;++Se){var Oi=Ou[Se];!Se&&0<Ar&&(Oi+=1<<Ar),ti<Oi&&(ti=Oi)}var Sl=c(Ni*Yi,dt),Ws=Ni,qu=c(Ws,xt);if(qu==null)var Kc=null;else t(65536>=Ws),Kc=qu;var Qn=s(ti);if(Kc==null||Qn==null||Sl==null){Pe.a=1;break r}var ys=Sl;for(_e=Ye=0;_e<Ni;++_e){var Rn=Kc[_e],ts=Rn.G,en=Rn.H,Vn=0,es=1,$r=0;for(Se=0;5>Se;++Se){Oi=Ou[Se],ts[Se]=ys,en[Se]=Ye,!Se&&0<Ar&&(Oi+=1<<Ar);n:{var pa,Al=Oi,ja=Pe,Qc=Qn,Nm=ys,Wp=Ye,fa=0,Ua=ja.m,Fh=Wt(Ua,1);if(n(Qc,0,0,Al),Fh){var Hu=Wt(Ua,1)+1,Dh=Wt(Ua,1),$u=Wt(Ua,Dh==0?1:8);Qc[$u]=1,Hu==2&&(Qc[$u=Wt(Ua,8)]=1);var Ga=1}else{var tu=s(19),qd=Wt(Ua,4)+4;if(19<qd){ja.a=3;var Hd=0;break n}for(pa=0;pa<qd;++pa)tu[Gp[pa]]=Wt(Ua,3);var Xp=void 0,$d=void 0,Zp=ja,Wd=tu,nc=Al,El=Qc,$o=0,Xs=Zp.m,Om=8,eu=c(128,dt);i:for(;at(eu,0,7,Wd,19);){if(Wt(Xs,1)){var Mv=2+2*Wt(Xs,3);if((Xp=2+Wt(Xs,Mv))>nc)break i}else Xp=nc;for($d=0;$d<nc&&Xp--;){qt(Xs);var zm=eu[0+(127&Et(Xs))];jt(Xs,Xs.u+zm.g);var zi=zm.value;if(16>zi)El[$d++]=zi,zi!=0&&(Om=zi);else{var jm=zi==16,Um=zi-16,Wu=Dd[Um],ru=Wt(Xs,Fd[Um])+Wu;if($d+ru>nc)break i;for(var Yp=jm?Om:0;0<ru--;)El[$d++]=Yp}}$o=1;break i}$o||(Zp.a=3),Ga=$o}(Ga=Ga&&!Ua.h)&&(fa=at(Nm,Wp,8,Qc,Al)),Ga&&fa!=0?Hd=fa:(ja.a=3,Hd=0)}if(Hd==0)break r;if(es&&Xc[Se]==1&&(es=ys[Ye].g==0),Vn+=ys[Ye].g,Ye+=Hd,3>=Se){var Xu,Jp=Qn[0];for(Xu=1;Xu<Oi;++Xu)Qn[Xu]>Jp&&(Jp=Qn[Xu]);$r+=Jp}}if(Rn.nd=es,Rn.Qb=0,es&&(Rn.qb=(ts[3][en[3]+0].value<<24|ts[1][en[1]+0].value<<16|ts[2][en[2]+0].value)>>>0,Vn==0&&256>ts[0][en[0]+0].value&&(Rn.Qb=1,Rn.qb+=ts[0][en[0]+0].value<<8)),Rn.jc=!Rn.Qb&&6>$r,Rn.jc){var Kp,Tl=Rn;for(Kp=0;Kp<Yn;++Kp){var iu=Kp,Cl=Tl.pd[iu],Qp=Tl.G[0][Tl.H[0]+iu];256<=Qp.value?(Cl.g=Qp.g+256,Cl.value=Qp.value):(Cl.g=0,Cl.value=0,iu>>=Zt(Qp,8,Cl),iu>>=Zt(Tl.G[1][Tl.H[1]+iu],16,Cl),iu>>=Zt(Tl.G[2][Tl.H[2]+iu],0,Cl),Zt(Tl.G[3][Tl.H[3]+iu],24,Cl))}}}Dr.vc=ai,Dr.Wb=Ni,Dr.Ya=Kc,Dr.yc=Sl,ve=1;break e}ve=0}if(!(m=ve)){o.a=3;break t}if(0<D){if(P.ua=1<<D,!or(P.Wa,D)){o.a=1,m=0;break t}}else P.ua=0;var Xd=o,Gm=y,s1=v,nu=Xd.s,Vm=nu.xc;if(Xd.c=Gm,Xd.i=s1,nu.md=Qe(Gm,Vm),nu.wc=Vm==0?-1:(1<<Vm)-1,g){o.xb=Yc;break t}if((B=s(y*v))==null){o.a=1,m=0;break t}m=(m=Sr(o,B,0,y,v,v,null))&&!E.h;break t}return m?(h!=null?h[0]=B:(t(B==null),t(g)),o.$=0,g||oi(P)):oi(P),m}function Nr(A,M){var g=A.c*A.i,o=g+M+16*M;return t(A.c<=M),A.V=s(o),A.V==null?(A.Ta=null,A.Ua=0,A.a=1,0):(A.Ta=A.V,A.Ua=A.Ba+g+M,1)}function ei(A,M){var g=A.C,o=M-g,h=A.V,m=A.Ba+A.c*g;for(t(M<=A.l.o);0<o;){var y=16<o?16:o,v=A.l.ma,E=A.l.width,P=E*y,B=v.ca,D=v.tb+E*g,G=A.Ta,j=A.Ua;We(A,y,h,m),kd(G,j,B,D,P),tr(v,g,g+y,B,D,E),o-=y,h+=y*A.c,g+=y}t(g==M),A.C=A.Ma=M}function yi(){this.ub=this.yd=this.td=this.Rb=0}function Pi(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function tn(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function Bo(){this.Yb=function(){var A=[];return function M(g,o,h){for(var m=h[o],y=0;y<m&&(g.push(h.length>o+1?[]:0),!(h.length<o+1));y++)M(g[y],o+1,h)}(A,0,[3,11]),A}()}function Jr(){this.jb=s(3),this.Wc=a([4,8],Bo),this.Xc=a([4,17],Bo)}function Ln(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function ls(){this.ld=this.La=this.dd=this.tc=0}function ki(){this.Na=this.la=0}function Ri(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function ko(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Fi(){this.uc=this.M=this.Nb=0,this.wa=Array(new ls),this.Y=0,this.ya=Array(new ko),this.aa=0,this.l=new cs}function Ii(){this.y=s(16),this.f=s(8),this.ea=s(8)}function Ro(){this.cb=this.a=0,this.sc="",this.m=new xe,this.Od=new yi,this.Kc=new Pi,this.ed=new Ln,this.Qa=new tn,this.Ic=this.$c=this.Aa=0,this.D=new Fi,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=c(8,xe),this.ia=0,this.pb=c(4,Ri),this.Pa=new Jr,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Ii),this.Hd=0,this.rb=Array(new ki),this.sb=0,this.wa=Array(new ls),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new ko),this.L=this.aa=0,this.gd=a([4,2],ls),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function cs(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function xi(){var A=new Ro;return A!=null&&(A.a=0,A.sc="OK",A.cb=0,A.Xb=0,zu||(zu=Fo)),A}function Kr(A,M,g){return A.a==0&&(A.a=M,A.sc=g,A.cb=0),0}function bn(A,M,g){return 3<=g&&A[M+0]==157&&A[M+1]==1&&A[M+2]==42}function _i(A,M){if(A==null)return 0;if(A.a=0,A.sc="OK",M==null)return Kr(A,2,"null VP8Io passed to VP8GetHeaders()");var g=M.data,o=M.w,h=M.ha;if(4>h)return Kr(A,7,"Truncated header.");var m=g[o+0]|g[o+1]<<8|g[o+2]<<16,y=A.Od;if(y.Rb=!(1&m),y.td=m>>1&7,y.yd=m>>4&1,y.ub=m>>5,3<y.td)return Kr(A,3,"Incorrect keyframe parameters.");if(!y.yd)return Kr(A,4,"Frame not displayable.");o+=3,h-=3;var v=A.Kc;if(y.Rb){if(7>h)return Kr(A,7,"cannot parse picture header");if(!bn(g,o,h))return Kr(A,3,"Bad code word");v.c=16383&(g[o+4]<<8|g[o+3]),v.Td=g[o+4]>>6,v.i=16383&(g[o+6]<<8|g[o+5]),v.Ud=g[o+6]>>6,o+=7,h-=7,A.za=v.c+15>>4,A.Ub=v.i+15>>4,M.width=v.c,M.height=v.i,M.Da=0,M.j=0,M.v=0,M.va=M.width,M.o=M.height,M.da=0,M.ib=M.width,M.hb=M.height,M.U=M.width,M.T=M.height,n((m=A.Pa).jb,0,255,m.jb.length),t((m=A.Qa)!=null),m.Cb=0,m.Bb=0,m.Fb=1,n(m.Zb,0,0,m.Zb.length),n(m.Lb,0,0,m.Lb)}if(y.ub>h)return Kr(A,7,"bad partition length");re(m=A.m,g,o,y.ub),o+=y.ub,h-=y.ub,y.Rb&&(v.Ld=Qt(m),v.Kd=Qt(m)),v=A.Qa;var E,P=A.Pa;if(t(m!=null),t(v!=null),v.Cb=Qt(m),v.Cb){if(v.Bb=Qt(m),Qt(m)){for(v.Fb=Qt(m),E=0;4>E;++E)v.Zb[E]=Qt(m)?se(m,7):0;for(E=0;4>E;++E)v.Lb[E]=Qt(m)?se(m,6):0}if(v.Bb)for(E=0;3>E;++E)P.jb[E]=Qt(m)?ee(m,8):255}else v.Bb=0;if(m.Ka)return Kr(A,3,"cannot parse segment header");if((v=A.ed).zd=Qt(m),v.Tb=ee(m,6),v.wb=ee(m,3),v.Pc=Qt(m),v.Pc&&Qt(m)){for(P=0;4>P;++P)Qt(m)&&(v.vd[P]=se(m,6));for(P=0;4>P;++P)Qt(m)&&(v.od[P]=se(m,6))}if(A.L=v.Tb==0?0:v.zd?1:2,m.Ka)return Kr(A,3,"cannot parse filter header");var B=h;if(h=E=o,o=E+B,v=B,A.Xb=(1<<ee(A.m,2))-1,B<3*(P=A.Xb))g=7;else{for(E+=3*P,v-=3*P,B=0;B<P;++B){var D=g[h+0]|g[h+1]<<8|g[h+2]<<16;D>v&&(D=v),re(A.Jc[+B],g,E,D),E+=D,v-=D,h+=3}re(A.Jc[+P],g,E,v),g=E<o?0:5}if(g!=0)return Kr(A,g,"cannot parse partitions");for(g=ee(E=A.m,7),h=Qt(E)?se(E,4):0,o=Qt(E)?se(E,4):0,v=Qt(E)?se(E,4):0,P=Qt(E)?se(E,4):0,E=Qt(E)?se(E,4):0,B=A.Qa,D=0;4>D;++D){if(B.Cb){var G=B.Zb[D];B.Fb||(G+=g)}else{if(0<D){A.pb[D]=A.pb[0];continue}G=g}var j=A.pb[D];j.Sc[0]=Vs[Zr(G+h,127)],j.Sc[1]=za[Zr(G+0,127)],j.Eb[0]=2*Vs[Zr(G+o,127)],j.Eb[1]=101581*za[Zr(G+v,127)]>>16,8>j.Eb[1]&&(j.Eb[1]=8),j.Qc[0]=Vs[Zr(G+P,117)],j.Qc[1]=za[Zr(G+E,127)],j.lc=G+E}if(!y.Rb)return Kr(A,4,"Not a key frame.");for(Qt(m),y=A.Pa,g=0;4>g;++g){for(h=0;8>h;++h)for(o=0;3>o;++o)for(v=0;11>v;++v)P=Kt(m,ho[g][h][o][v])?ee(m,8):zd[g][h][o][v],y.Wc[g][h].Yb[o][v]=P;for(h=0;17>h;++h)y.Xc[g][h]=y.Wc[g][qe[h]]}return A.kc=Qt(m),A.kc&&(A.Bd=ee(m,8)),A.cb=1}function Fo(A,M,g,o,h,m,y){var v=M[h].Yb[g];for(g=0;16>h;++h){if(!Kt(A,v[g+0]))return h;for(;!Kt(A,v[g+1]);)if(v=M[++h].Yb[0],g=0,h==16)return 16;var E=M[h+1].Yb;if(Kt(A,v[g+2])){var P=A,B=0;if(Kt(P,(G=v)[(D=g)+3]))if(Kt(P,G[D+6])){for(v=0,D=2*(B=Kt(P,G[D+8]))+(G=Kt(P,G[D+9+B])),B=0,G=Fm[D];G[v];++v)B+=B+Kt(P,G[v]);B+=3+(8<<D)}else Kt(P,G[D+7])?(B=7+2*Kt(P,165),B+=Kt(P,145)):B=5+Kt(P,159);else B=Kt(P,G[D+4])?3+Kt(P,G[D+5]):2;v=E[2]}else B=1,v=E[1];E=y+Vp[h],0>(P=A).b&&$t(P);var D,G=P.b,j=(D=P.Ca>>1)-(P.I>>G)>>31;--P.b,P.Ca+=j,P.Ca|=1,P.I-=(D+1&j)<<G,m[E]=((B^j)-j)*o[(0<h)+0]}return 16}function wn(A){var M=A.rb[A.sb-1];M.la=0,M.Na=0,n(A.zc,0,0,A.zc.length),A.ja=0}function La(A,M){if(A==null)return 0;if(M==null)return Kr(A,2,"NULL VP8Io parameter in VP8Decode().");if(!A.cb&&!_i(A,M))return 0;if(t(A.cb),M.ac==null||M.ac(M)){M.ob&&(A.L=0);var g=xl[A.L];if(A.L==2?(A.yb=0,A.zb=0):(A.yb=M.v-g>>4,A.zb=M.j-g>>4,0>A.yb&&(A.yb=0),0>A.zb&&(A.zb=0)),A.Va=M.o+15+g>>4,A.Hb=M.va+15+g>>4,A.Hb>A.za&&(A.Hb=A.za),A.Va>A.Ub&&(A.Va=A.Ub),0<A.L){var o=A.ed;for(g=0;4>g;++g){var h;if(A.Qa.Cb){var m=A.Qa.Lb[g];A.Qa.Fb||(m+=o.Tb)}else m=o.Tb;for(h=0;1>=h;++h){var y=A.gd[g][h],v=m;if(o.Pc&&(v+=o.vd[0],h&&(v+=o.od[0])),0<(v=0>v?0:63<v?63:v)){var E=v;0<o.wb&&(E=4<o.wb?E>>2:E>>1)>9-o.wb&&(E=9-o.wb),1>E&&(E=1),y.dd=E,y.tc=2*v+E,y.ld=40<=v?2:15<=v?1:0}else y.tc=0;y.La=h}}}g=0}else Kr(A,6,"Frame setup failed"),g=A.a;if(g=g==0){if(g){A.$c=0,0<A.Aa||(A.Ic=gr);t:{g=A.Ic,o=4*(E=A.za);var P=32*E,B=E+1,D=0<A.L?E*(0<A.Aa?2:1):0,G=(A.Aa==2?2:1)*E;if((y=o+832+(h=3*(16*g+xl[A.L])/2*P)+(m=A.Fa!=null&&0<A.Fa.length?A.Kc.c*A.Kc.i:0))!=y)g=0;else{if(y>A.Vb){if(A.Vb=0,A.Ec=s(y),A.Fc=0,A.Ec==null){g=Kr(A,1,"no memory during frame initialization.");break t}A.Vb=y}y=A.Ec,v=A.Fc,A.Ac=y,A.Bc=v,v+=o,A.Gd=c(P,Ii),A.Hd=0,A.rb=c(B+1,ki),A.sb=1,A.wa=D?c(D,ls):null,A.Y=0,A.D.Nb=0,A.D.wa=A.wa,A.D.Y=A.Y,0<A.Aa&&(A.D.Y+=E),t(!0),A.oc=y,A.pc=v,v+=832,A.ya=c(G,ko),A.aa=0,A.D.ya=A.ya,A.D.aa=A.aa,A.Aa==2&&(A.D.aa+=E),A.R=16*E,A.B=8*E,E=(P=xl[A.L])*A.R,P=P/2*A.B,A.sa=y,A.ta=v+E,A.qa=A.sa,A.ra=A.ta+16*g*A.R+P,A.Ha=A.qa,A.Ia=A.ra+8*g*A.B+P,A.$c=0,v+=h,A.mb=m?y:null,A.nb=m?v:null,t(v+m<=A.Fc+A.Vb),wn(A),n(A.Ac,A.Bc,0,o),g=1}}if(g){if(M.ka=0,M.y=A.sa,M.O=A.ta,M.f=A.qa,M.N=A.ra,M.ea=A.Ha,M.Vd=A.Ia,M.fa=A.R,M.Rc=A.B,M.F=null,M.J=0,!Vc){for(g=-255;255>=g;++g)Rd[255+g]=0>g?-g:g;for(g=-1020;1020>=g;++g)Zi[1020+g]=-128>g?-128:127<g?127:g;for(g=-112;112>=g;++g)co[112+g]=-16>g?-16:15<g?15:g;for(g=-255;510>=g;++g)Cs[255+g]=0>g?0:255<g?255:g;Vc=1}no=_t,Yl=Xr,Go=hl,Kn=ql,Ts=ot,_l=hs,so=Nc,vl=Wl,oo=Ph,ao=Oc,bl=Ch,ms=dl,Vo=zc,Mi=Lu,Si=No,qi=Gr,cn=Oo,Gs=Bd,qs[0]=js,qs[1]=oe,qs[2]=Lc,qs[3]=Mc,qs[4]=Iu,qs[5]=Bc,qs[6]=Ma,qs[7]=kc,qs[8]=Ld,qs[9]=Eh,qo[0]=Mn,qo[1]=ar,qo[2]=Lr,qo[3]=di,qo[4]=ii,qo[5]=Hl,qo[6]=Un,ha[0]=ra,ha[1]=Ae,ha[2]=Md,ha[3]=Rc,ha[4]=Ba,ha[5]=Fc,ha[6]=$l,g=1}else g=0}g&&(g=function(j,Z){for(j.M=0;j.M<j.Va;++j.M){var Y,X=j.Jc[j.M&j.Xb],tt=j.m,ct=j;for(Y=0;Y<ct.za;++Y){var ht=tt,gt=ct,pt=gt.Ac,St=gt.Bc+4*Y,Rt=gt.zc,Bt=gt.ya[gt.aa+Y];if(gt.Qa.Bb?Bt.$b=Kt(ht,gt.Pa.jb[0])?2+Kt(ht,gt.Pa.jb[2]):Kt(ht,gt.Pa.jb[1]):Bt.$b=0,gt.kc&&(Bt.Ad=Kt(ht,gt.Bd)),Bt.Za=!Kt(ht,145)+0,Bt.Za){var ie=Bt.Ob,pe=0;for(gt=0;4>gt;++gt){var ye,we=Rt[0+gt];for(ye=0;4>ye;++ye){we=Zc[pt[St+ye]][we];for(var ve=Od[Kt(ht,we[0])];0<ve;)ve=Od[2*ve+Kt(ht,we[ve])];we=-ve,pt[St+ye]=we}i(ie,pe,pt,St,4),pe+=4,Rt[0+gt]=we}}else we=Kt(ht,156)?Kt(ht,128)?1:3:Kt(ht,163)?2:0,Bt.Ob[0]=we,n(pt,St,we,4),n(Rt,0,we,4);Bt.Dd=Kt(ht,142)?Kt(ht,114)?Kt(ht,183)?1:3:2:0}if(ct.m.Ka)return Kr(j,7,"Premature end-of-partition0 encountered.");for(;j.ja<j.za;++j.ja){if(ct=X,ht=(tt=j).rb[tt.sb-1],pt=tt.rb[tt.sb+tt.ja],Y=tt.ya[tt.aa+tt.ja],St=tt.kc?Y.Ad:0)ht.la=pt.la=0,Y.Za||(ht.Na=pt.Na=0),Y.Hc=0,Y.Gc=0,Y.ia=0;else{var _e,Se;if(ht=pt,pt=ct,St=tt.Pa.Xc,Rt=tt.ya[tt.aa+tt.ja],Bt=tt.pb[Rt.$b],gt=Rt.ad,ie=0,pe=tt.rb[tt.sb-1],we=ye=0,n(gt,ie,0,384),Rt.Za)var Ye=0,Pe=St[3];else{ve=s(16);var Ie=ht.Na+pe.Na;if(Ie=zu(pt,St[1],Ie,Bt.Eb,0,ve,0),ht.Na=pe.Na=(0<Ie)+0,1<Ie)no(ve,0,gt,ie);else{var ir=ve[0]+3>>3;for(ve=0;256>ve;ve+=16)gt[ie+ve]=ir}Ye=1,Pe=St[0]}var Ar=15&ht.la,vr=15&pe.la;for(ve=0;4>ve;++ve){var Tr=1&vr;for(ir=Se=0;4>ir;++ir)Ar=Ar>>1|(Tr=(Ie=zu(pt,Pe,Ie=Tr+(1&Ar),Bt.Sc,Ye,gt,ie))>Ye)<<7,Se=Se<<2|(3<Ie?3:1<Ie?2:gt[ie+0]!=0),ie+=16;Ar>>=4,vr=vr>>1|Tr<<7,ye=(ye<<8|Se)>>>0}for(Pe=Ar,Ye=vr>>4,_e=0;4>_e;_e+=2){for(Se=0,Ar=ht.la>>4+_e,vr=pe.la>>4+_e,ve=0;2>ve;++ve){for(Tr=1&vr,ir=0;2>ir;++ir)Ie=Tr+(1&Ar),Ar=Ar>>1|(Tr=0<(Ie=zu(pt,St[2],Ie,Bt.Qc,0,gt,ie)))<<3,Se=Se<<2|(3<Ie?3:1<Ie?2:gt[ie+0]!=0),ie+=16;Ar>>=2,vr=vr>>1|Tr<<5}we|=Se<<4*_e,Pe|=Ar<<4<<_e,Ye|=(240&vr)<<_e}ht.la=Pe,pe.la=Ye,Rt.Hc=ye,Rt.Gc=we,Rt.ia=43690&we?0:Bt.ia,St=!(ye|we)}if(0<tt.L&&(tt.wa[tt.Y+tt.ja]=tt.gd[Y.$b][Y.Za],tt.wa[tt.Y+tt.ja].La|=!St),ct.Ka)return Kr(j,7,"Premature end-of-file encountered.")}if(wn(j),tt=Z,ct=1,Y=(X=j).D,ht=0<X.L&&X.M>=X.zb&&X.M<=X.Va,X.Aa==0)t:{if(Y.M=X.M,Y.uc=ht,Ra(X,Y),ct=1,Y=(Se=X.D).Nb,ht=(we=xl[X.L])*X.R,pt=we/2*X.B,ve=16*Y*X.R,ir=8*Y*X.B,St=X.sa,Rt=X.ta-ht+ve,Bt=X.qa,gt=X.ra-pt+ir,ie=X.Ha,pe=X.Ia-pt+ir,vr=(Ar=Se.M)==0,ye=Ar>=X.Va-1,X.Aa==2&&Ra(X,Se),Se.uc)for(Tr=(Ie=X).D.M,t(Ie.D.uc),Se=Ie.yb;Se<Ie.Hb;++Se){Ye=Se,Pe=Tr;var Dr=(ai=(Oi=Ie).D).Nb;_e=Oi.R;var ai=ai.wa[ai.Y+Ye],Ni=Oi.sa,ti=Oi.ta+16*Dr*_e+16*Ye,Yi=ai.dd,li=ai.tc;if(li!=0)if(t(3<=li),Oi.L==1)0<Ye&&qi(Ni,ti,_e,li+4),ai.La&&Gs(Ni,ti,_e,li),0<Pe&&Si(Ni,ti,_e,li+4),ai.La&&cn(Ni,ti,_e,li);else{var Hi=Oi.B,hn=Oi.qa,gs=Oi.ra+8*Dr*Hi+8*Ye,$s=Oi.Ha,Oi=Oi.Ia+8*Dr*Hi+8*Ye;Dr=ai.ld,0<Ye&&(vl(Ni,ti,_e,li+4,Yi,Dr),ao(hn,gs,$s,Oi,Hi,li+4,Yi,Dr)),ai.La&&(ms(Ni,ti,_e,li,Yi,Dr),Mi(hn,gs,$s,Oi,Hi,li,Yi,Dr)),0<Pe&&(so(Ni,ti,_e,li+4,Yi,Dr),oo(hn,gs,$s,Oi,Hi,li+4,Yi,Dr)),ai.La&&(bl(Ni,ti,_e,li,Yi,Dr),Vo(hn,gs,$s,Oi,Hi,li,Yi,Dr))}}if(X.ia&&alert("todo:DitherRow"),tt.put!=null){if(Se=16*Ar,Ar=16*(Ar+1),vr?(tt.y=X.sa,tt.O=X.ta+ve,tt.f=X.qa,tt.N=X.ra+ir,tt.ea=X.Ha,tt.W=X.Ia+ir):(Se-=we,tt.y=St,tt.O=Rt,tt.f=Bt,tt.N=gt,tt.ea=ie,tt.W=pe),ye||(Ar-=we),Ar>tt.o&&(Ar=tt.o),tt.F=null,tt.J=null,X.Fa!=null&&0<X.Fa.length&&Se<Ar&&(tt.J=Gc(X,tt,Se,Ar-Se),tt.F=X.mb,tt.F==null&&tt.F.length==0)){ct=Kr(X,3,"Could not decode alpha data.");break t}Se<tt.j&&(we=tt.j-Se,Se=tt.j,t(!(1&we)),tt.O+=X.R*we,tt.N+=X.B*(we>>1),tt.W+=X.B*(we>>1),tt.F!=null&&(tt.J+=tt.width*we)),Se<Ar&&(tt.O+=tt.v,tt.N+=tt.v>>1,tt.W+=tt.v>>1,tt.F!=null&&(tt.J+=tt.v),tt.ka=Se-tt.j,tt.U=tt.va-tt.v,tt.T=Ar-Se,ct=tt.put(tt))}Y+1!=X.Ic||ye||(i(X.sa,X.ta-ht,St,Rt+16*X.R,ht),i(X.qa,X.ra-pt,Bt,gt+8*X.B,pt),i(X.Ha,X.Ia-pt,ie,pe+8*X.B,pt))}if(!ct)return Kr(j,6,"Output aborted.")}return 1}(A,M)),M.bc!=null&&M.bc(M),g&=1}return g?(A.cb=0,g):0}function Li(A,M,g,o,h){h=A[M+g+32*o]+(h>>3),A[M+g+32*o]=-256&h?0>h?0:255:h}function us(A,M,g,o,h,m){Li(A,M,0,g,o+h),Li(A,M,1,g,o+m),Li(A,M,2,g,o-m),Li(A,M,3,g,o-h)}function xn(A){return(20091*A>>16)+A}function As(A,M,g,o){var h,m=0,y=s(16);for(h=0;4>h;++h){var v=A[M+0]+A[M+8],E=A[M+0]-A[M+8],P=(35468*A[M+4]>>16)-xn(A[M+12]),B=xn(A[M+4])+(35468*A[M+12]>>16);y[m+0]=v+B,y[m+1]=E+P,y[m+2]=E-P,y[m+3]=v-B,m+=4,M++}for(h=m=0;4>h;++h)v=(A=y[m+0]+4)+y[m+8],E=A-y[m+8],P=(35468*y[m+4]>>16)-xn(y[m+12]),Li(g,o,0,0,v+(B=xn(y[m+4])+(35468*y[m+12]>>16))),Li(g,o,1,0,E+P),Li(g,o,2,0,E-P),Li(g,o,3,0,v-B),m++,o+=32}function hs(A,M,g,o){var h=A[M+0]+4,m=35468*A[M+4]>>16,y=xn(A[M+4]),v=35468*A[M+1]>>16;us(g,o,0,h+y,A=xn(A[M+1]),v),us(g,o,1,h+m,A,v),us(g,o,2,h-m,A,v),us(g,o,3,h-y,A,v)}function Xr(A,M,g,o,h){As(A,M,g,o),h&&As(A,M+16,g,o+4)}function hl(A,M,g,o){Yl(A,M+0,g,o,1),Yl(A,M+32,g,o+128,1)}function ql(A,M,g,o){var h;for(A=A[M+0]+4,h=0;4>h;++h)for(M=0;4>M;++M)Li(g,o,M,h,A)}function ot(A,M,g,o){A[M+0]&&Kn(A,M+0,g,o),A[M+16]&&Kn(A,M+16,g,o+4),A[M+32]&&Kn(A,M+32,g,o+128),A[M+48]&&Kn(A,M+48,g,o+128+4)}function _t(A,M,g,o){var h,m=s(16);for(h=0;4>h;++h){var y=A[M+0+h]+A[M+12+h],v=A[M+4+h]+A[M+8+h],E=A[M+4+h]-A[M+8+h],P=A[M+0+h]-A[M+12+h];m[0+h]=y+v,m[8+h]=y-v,m[4+h]=P+E,m[12+h]=P-E}for(h=0;4>h;++h)y=(A=m[0+4*h]+3)+m[3+4*h],v=m[1+4*h]+m[2+4*h],E=m[1+4*h]-m[2+4*h],P=A-m[3+4*h],g[o+0]=y+v>>3,g[o+16]=P+E>>3,g[o+32]=y-v>>3,g[o+48]=P-E>>3,o+=64}function zt(A,M,g){var o,h=M-32,m=kn,y=255-A[h-1];for(o=0;o<g;++o){var v,E=m,P=y+A[M-1];for(v=0;v<g;++v)A[M+v]=E[P+A[h+v]];M+=32}}function oe(A,M){zt(A,M,4)}function Ae(A,M){zt(A,M,8)}function ar(A,M){zt(A,M,16)}function Lr(A,M){var g;for(g=0;16>g;++g)i(A,M+32*g,A,M-32,16)}function di(A,M){var g;for(g=16;0<g;--g)n(A,M,A[M-1],16),M+=32}function Sn(A,M,g){var o;for(o=0;16>o;++o)n(M,g+32*o,A,16)}function Mn(A,M){var g,o=16;for(g=0;16>g;++g)o+=A[M-1+32*g]+A[M+g-32];Sn(o>>5,A,M)}function ii(A,M){var g,o=8;for(g=0;16>g;++g)o+=A[M-1+32*g];Sn(o>>4,A,M)}function Hl(A,M){var g,o=8;for(g=0;16>g;++g)o+=A[M+g-32];Sn(o>>4,A,M)}function Un(A,M){Sn(128,A,M)}function pr(A,M,g){return A+2*M+g+2>>2}function Lc(A,M){var g,o=M-32;for(o=new Uint8Array([pr(A[o-1],A[o+0],A[o+1]),pr(A[o+0],A[o+1],A[o+2]),pr(A[o+1],A[o+2],A[o+3]),pr(A[o+2],A[o+3],A[o+4])]),g=0;4>g;++g)i(A,M+32*g,o,0,o.length)}function Mc(A,M){var g=A[M-1],o=A[M-1+32],h=A[M-1+64],m=A[M-1+96];Ee(A,M+0,16843009*pr(A[M-1-32],g,o)),Ee(A,M+32,16843009*pr(g,o,h)),Ee(A,M+64,16843009*pr(o,h,m)),Ee(A,M+96,16843009*pr(h,m,m))}function js(A,M){var g,o=4;for(g=0;4>g;++g)o+=A[M+g-32]+A[M-1+32*g];for(o>>=3,g=0;4>g;++g)n(A,M+32*g,o,4)}function Iu(A,M){var g=A[M-1+0],o=A[M-1+32],h=A[M-1+64],m=A[M-1-32],y=A[M+0-32],v=A[M+1-32],E=A[M+2-32],P=A[M+3-32];A[M+0+96]=pr(o,h,A[M-1+96]),A[M+1+96]=A[M+0+64]=pr(g,o,h),A[M+2+96]=A[M+1+64]=A[M+0+32]=pr(m,g,o),A[M+3+96]=A[M+2+64]=A[M+1+32]=A[M+0+0]=pr(y,m,g),A[M+3+64]=A[M+2+32]=A[M+1+0]=pr(v,y,m),A[M+3+32]=A[M+2+0]=pr(E,v,y),A[M+3+0]=pr(P,E,v)}function Ma(A,M){var g=A[M+1-32],o=A[M+2-32],h=A[M+3-32],m=A[M+4-32],y=A[M+5-32],v=A[M+6-32],E=A[M+7-32];A[M+0+0]=pr(A[M+0-32],g,o),A[M+1+0]=A[M+0+32]=pr(g,o,h),A[M+2+0]=A[M+1+32]=A[M+0+64]=pr(o,h,m),A[M+3+0]=A[M+2+32]=A[M+1+64]=A[M+0+96]=pr(h,m,y),A[M+3+32]=A[M+2+64]=A[M+1+96]=pr(m,y,v),A[M+3+64]=A[M+2+96]=pr(y,v,E),A[M+3+96]=pr(v,E,E)}function Bc(A,M){var g=A[M-1+0],o=A[M-1+32],h=A[M-1+64],m=A[M-1-32],y=A[M+0-32],v=A[M+1-32],E=A[M+2-32],P=A[M+3-32];A[M+0+0]=A[M+1+64]=m+y+1>>1,A[M+1+0]=A[M+2+64]=y+v+1>>1,A[M+2+0]=A[M+3+64]=v+E+1>>1,A[M+3+0]=E+P+1>>1,A[M+0+96]=pr(h,o,g),A[M+0+64]=pr(o,g,m),A[M+0+32]=A[M+1+96]=pr(g,m,y),A[M+1+32]=A[M+2+96]=pr(m,y,v),A[M+2+32]=A[M+3+96]=pr(y,v,E),A[M+3+32]=pr(v,E,P)}function kc(A,M){var g=A[M+0-32],o=A[M+1-32],h=A[M+2-32],m=A[M+3-32],y=A[M+4-32],v=A[M+5-32],E=A[M+6-32],P=A[M+7-32];A[M+0+0]=g+o+1>>1,A[M+1+0]=A[M+0+64]=o+h+1>>1,A[M+2+0]=A[M+1+64]=h+m+1>>1,A[M+3+0]=A[M+2+64]=m+y+1>>1,A[M+0+32]=pr(g,o,h),A[M+1+32]=A[M+0+96]=pr(o,h,m),A[M+2+32]=A[M+1+96]=pr(h,m,y),A[M+3+32]=A[M+2+96]=pr(m,y,v),A[M+3+64]=pr(y,v,E),A[M+3+96]=pr(v,E,P)}function Eh(A,M){var g=A[M-1+0],o=A[M-1+32],h=A[M-1+64],m=A[M-1+96];A[M+0+0]=g+o+1>>1,A[M+2+0]=A[M+0+32]=o+h+1>>1,A[M+2+32]=A[M+0+64]=h+m+1>>1,A[M+1+0]=pr(g,o,h),A[M+3+0]=A[M+1+32]=pr(o,h,m),A[M+3+32]=A[M+1+64]=pr(h,m,m),A[M+3+64]=A[M+2+64]=A[M+0+96]=A[M+1+96]=A[M+2+96]=A[M+3+96]=m}function Ld(A,M){var g=A[M-1+0],o=A[M-1+32],h=A[M-1+64],m=A[M-1+96],y=A[M-1-32],v=A[M+0-32],E=A[M+1-32],P=A[M+2-32];A[M+0+0]=A[M+2+32]=g+y+1>>1,A[M+0+32]=A[M+2+64]=o+g+1>>1,A[M+0+64]=A[M+2+96]=h+o+1>>1,A[M+0+96]=m+h+1>>1,A[M+3+0]=pr(v,E,P),A[M+2+0]=pr(y,v,E),A[M+1+0]=A[M+3+32]=pr(g,y,v),A[M+1+32]=A[M+3+64]=pr(o,g,y),A[M+1+64]=A[M+3+96]=pr(h,o,g),A[M+1+96]=pr(m,h,o)}function Md(A,M){var g;for(g=0;8>g;++g)i(A,M+32*g,A,M-32,8)}function Rc(A,M){var g;for(g=0;8>g;++g)n(A,M,A[M-1],8),M+=32}function Do(A,M,g){var o;for(o=0;8>o;++o)n(M,g+32*o,A,8)}function ra(A,M){var g,o=8;for(g=0;8>g;++g)o+=A[M+g-32]+A[M-1+32*g];Do(o>>4,A,M)}function Fc(A,M){var g,o=4;for(g=0;8>g;++g)o+=A[M+g-32];Do(o>>3,A,M)}function Ba(A,M){var g,o=4;for(g=0;8>g;++g)o+=A[M-1+32*g];Do(o>>3,A,M)}function $l(A,M){Do(128,A,M)}function ds(A,M,g){var o=A[M-g],h=A[M+0],m=3*(h-o)+Fu[1020+A[M-2*g]-A[M+g]],y=Jl[112+(m+4>>3)];A[M-g]=kn[255+o+Jl[112+(m+3>>3)]],A[M+0]=kn[255+h-y]}function Th(A,M,g,o){var h=A[M+0],m=A[M+g];return yn[255+A[M-2*g]-A[M-g]]>o||yn[255+m-h]>o}function Dc(A,M,g,o){return 4*yn[255+A[M-g]-A[M+0]]+yn[255+A[M-2*g]-A[M+g]]<=o}function ia(A,M,g,o,h){var m=A[M-3*g],y=A[M-2*g],v=A[M-g],E=A[M+0],P=A[M+g],B=A[M+2*g],D=A[M+3*g];return 4*yn[255+v-E]+yn[255+y-P]>o?0:yn[255+A[M-4*g]-m]<=h&&yn[255+m-y]<=h&&yn[255+y-v]<=h&&yn[255+D-B]<=h&&yn[255+B-P]<=h&&yn[255+P-E]<=h}function No(A,M,g,o){var h=2*o+1;for(o=0;16>o;++o)Dc(A,M+o,g,h)&&ds(A,M+o,g)}function Gr(A,M,g,o){var h=2*o+1;for(o=0;16>o;++o)Dc(A,M+o*g,1,h)&&ds(A,M+o*g,1)}function Oo(A,M,g,o){var h;for(h=3;0<h;--h)No(A,M+=4*g,g,o)}function Bd(A,M,g,o){var h;for(h=3;0<h;--h)Gr(A,M+=4,g,o)}function Us(A,M,g,o,h,m,y,v){for(m=2*m+1;0<h--;){if(ia(A,M,g,m,y))if(Th(A,M,g,v))ds(A,M,g);else{var E=A,P=M,B=g,D=E[P-2*B],G=E[P-B],j=E[P+0],Z=E[P+B],Y=E[P+2*B],X=27*(ct=Fu[1020+3*(j-G)+Fu[1020+D-Z]])+63>>7,tt=18*ct+63>>7,ct=9*ct+63>>7;E[P-3*B]=kn[255+E[P-3*B]+ct],E[P-2*B]=kn[255+D+tt],E[P-B]=kn[255+G+X],E[P+0]=kn[255+j-X],E[P+B]=kn[255+Z-tt],E[P+2*B]=kn[255+Y-ct]}M+=o}}function zo(A,M,g,o,h,m,y,v){for(m=2*m+1;0<h--;){if(ia(A,M,g,m,y))if(Th(A,M,g,v))ds(A,M,g);else{var E=A,P=M,B=g,D=E[P-B],G=E[P+0],j=E[P+B],Z=Jl[112+((Y=3*(G-D))+4>>3)],Y=Jl[112+(Y+3>>3)],X=Z+1>>1;E[P-2*B]=kn[255+E[P-2*B]+X],E[P-B]=kn[255+D+Y],E[P+0]=kn[255+G-Z],E[P+B]=kn[255+j-X]}M+=o}}function Nc(A,M,g,o,h,m){Us(A,M,g,1,16,o,h,m)}function Wl(A,M,g,o,h,m){Us(A,M,1,g,16,o,h,m)}function Ch(A,M,g,o,h,m){var y;for(y=3;0<y;--y)zo(A,M+=4*g,g,1,16,o,h,m)}function dl(A,M,g,o,h,m){var y;for(y=3;0<y;--y)zo(A,M+=4,1,g,16,o,h,m)}function Ph(A,M,g,o,h,m,y,v){Us(A,M,h,1,8,m,y,v),Us(g,o,h,1,8,m,y,v)}function Oc(A,M,g,o,h,m,y,v){Us(A,M,1,h,8,m,y,v),Us(g,o,1,h,8,m,y,v)}function zc(A,M,g,o,h,m,y,v){zo(A,M+4*h,h,1,8,m,y,v),zo(g,o+4*h,h,1,8,m,y,v)}function Lu(A,M,g,o,h,m,y,v){zo(A,M+4,1,h,8,m,y,v),zo(g,o+4,1,h,8,m,y,v)}function ro(){this.ba=new on,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new At,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function jc(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Mu(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Bu(){this.ua=0,this.Wa=new st,this.vb=new st,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new xt,this.yc=new dt}function Xl(){this.xb=this.a=0,this.l=new cs,this.ca=new on,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new it,this.Pb=0,this.wd=new it,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Bu,this.ab=0,this.gc=c(4,Mu),this.Oc=0}function Uc(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new cs,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function na(A,M,g,o,h,m,y){for(A=A==null?0:A[M+0],M=0;M<y;++M)h[m+M]=A+g[o+M]&255,A=h[m+M]}function ku(A,M,g,o,h,m,y){var v;if(A==null)na(null,null,g,o,h,m,y);else for(v=0;v<y;++v)h[m+v]=A[M+v]+g[o+v]&255}function pl(A,M,g,o,h,m,y){if(A==null)na(null,null,g,o,h,m,y);else{var v,E=A[M+0],P=E,B=E;for(v=0;v<y;++v)P=B+(E=A[M+v])-P,B=g[o+v]+(-256&P?0>P?0:255:P)&255,P=E,h[m+v]=B}}function Gc(A,M,g,o){var h=M.width,m=M.o;if(t(A!=null&&M!=null),0>g||0>=o||g+o>m)return null;if(!A.Cc){if(A.ga==null){var y;if(A.ga=new Uc,(y=A.ga==null)||(y=M.width*M.o,t(A.Gb.length==0),A.Gb=s(y),A.Uc=0,A.Gb==null?y=0:(A.mb=A.Gb,A.nb=A.Uc,A.rc=null,y=1),y=!y),!y){y=A.ga;var v=A.Fa,E=A.P,P=A.qc,B=A.mb,D=A.nb,G=E+1,j=P-1,Z=y.l;if(t(v!=null&&B!=null&&M!=null),da[0]=null,da[1]=na,da[2]=ku,da[3]=pl,y.ca=B,y.tb=D,y.c=M.width,y.i=M.height,t(0<y.c&&0<y.i),1>=P)M=0;else if(y.$a=v[E+0]>>0&3,y.Z=v[E+0]>>2&3,y.Lc=v[E+0]>>4&3,E=v[E+0]>>6&3,0>y.$a||1<y.$a||4<=y.Z||1<y.Lc||E)M=0;else if(Z.put=Nt,Z.ac=wt,Z.bc=Vt,Z.ma=y,Z.width=M.width,Z.height=M.height,Z.Da=M.Da,Z.v=M.v,Z.va=M.va,Z.j=M.j,Z.o=M.o,y.$a)t:{t(y.$a==1),M=Wr();e:for(;;){if(M==null){M=0;break t}if(t(y!=null),y.mc=M,M.c=y.c,M.i=y.i,M.l=y.l,M.l.ma=y,M.l.width=y.c,M.l.height=y.i,M.a=0,Ot(M.m,v,G,j),!dr(y.c,y.i,1,M,null)||(M.ab==1&&M.gc[0].hc==3&&Br(M.s)?(y.ic=1,v=M.c*M.i,M.Ta=null,M.Ua=0,M.V=s(v),M.Ba=0,M.V==null?(M.a=1,M=0):M=1):(y.ic=0,M=Nr(M,y.c)),!M))break e;M=1;break t}y.mc=null,M=0}else M=j>=y.c*y.i;y=!M}if(y)return null;A.ga.Lc!=1?A.Ga=0:o=m-g}t(A.ga!=null),t(g+o<=m);t:{if(M=(v=A.ga).c,m=v.l.o,v.$a==0){if(G=A.rc,j=A.Vc,Z=A.Fa,E=A.P+1+g*M,P=A.mb,B=A.nb+g*M,t(E<=A.P+A.qc),v.Z!=0)for(t(da[v.Z]!=null),y=0;y<o;++y)da[v.Z](G,j,Z,E,P,B,M),G=P,j=B,B+=M,E+=M;else for(y=0;y<o;++y)i(P,B,Z,E,M),G=P,j=B,B+=M,E+=M;A.rc=G,A.Vc=j}else{if(t(v.mc!=null),M=g+o,t((y=v.mc)!=null),t(M<=y.i),y.C>=M)M=1;else if(v.ic||Yt(),v.ic){v=y.V,G=y.Ba,j=y.c;var Y=y.i,X=(Z=1,E=y.$/j,P=y.$%j,B=y.m,D=y.s,y.$),tt=j*Y,ct=j*M,ht=D.wc,gt=X<ct?be(D,P,E):null;t(X<=tt),t(M<=Y),t(Br(D));e:for(;;){for(;!B.h&&X<ct;){if(P&ht||(gt=be(D,P,E)),t(gt!=null),qt(B),256>(Y=ue(gt.G[0],gt.H[0],B)))v[G+X]=Y,++X,++P>=j&&(P=0,++E<=M&&!(E%16)&&Ir(y,E));else{if(!(280>Y)){Z=0;break e}Y=Lt(Y-256,B);var pt,St=ue(gt.G[4],gt.H[4],B);if(qt(B),!(X>=(St=ne(j,St=Lt(St,B)))&&tt-X>=Y)){Z=0;break e}for(pt=0;pt<Y;++pt)v[G+X+pt]=v[G+X+pt-St];for(X+=Y,P+=Y;P>=j;)P-=j,++E<=M&&!(E%16)&&Ir(y,E);X<ct&&P&ht&&(gt=be(D,P,E))}t(B.h==Pt(B))}Ir(y,E>M?M:E);break e}!Z||B.h&&X<tt?(Z=0,y.a=B.h?5:3):y.$=X,M=Z}else M=Sr(y,y.V,y.Ba,y.c,y.i,M,ei);if(!M){o=0;break t}}g+o>=m&&(A.Cc=1),o=1}if(!o)return null;if(A.Cc&&((o=A.ga)!=null&&(o.mc=null),A.ga=null,0<A.Ga))return alert("todo:WebPDequantizeLevels"),null}return A.nb+g*h}function R(A,M,g,o,h,m){for(;0<h--;){var y,v=A,E=M+(g?1:0),P=A,B=M+(g?0:3);for(y=0;y<o;++y){var D=P[B+4*y];D!=255&&(D*=32897,v[E+4*y+0]=v[E+4*y+0]*D>>23,v[E+4*y+1]=v[E+4*y+1]*D>>23,v[E+4*y+2]=v[E+4*y+2]*D>>23)}M+=m}}function rt(A,M,g,o,h){for(;0<o--;){var m;for(m=0;m<g;++m){var y=A[M+2*m+0],v=15&(P=A[M+2*m+1]),E=4369*v,P=(240&P|P>>4)*E>>16;A[M+2*m+0]=(240&y|y>>4)*E>>16&240|(15&y|y<<4)*E>>16>>4&15,A[M+2*m+1]=240&P|v}M+=h}}function Ct(A,M,g,o,h,m,y,v){var E,P,B=255;for(P=0;P<h;++P){for(E=0;E<o;++E){var D=A[M+E];m[y+4*E]=D,B&=D}M+=g,y+=v}return B!=255}function Ut(A,M,g,o,h){var m;for(m=0;m<h;++m)g[o+m]=A[M+m]>>8}function Yt(){lo=R,un=rt,ca=Ct,kd=Ut}function ce(A,M,g){mt[A]=function(o,h,m,y,v,E,P,B,D,G,j,Z,Y,X,tt,ct,ht){var gt,pt=ht-1>>1,St=v[E+0]|P[B+0]<<16,Rt=D[G+0]|j[Z+0]<<16;t(o!=null);var Bt=3*St+Rt+131074>>2;for(M(o[h+0],255&Bt,Bt>>16,Y,X),m!=null&&(Bt=3*Rt+St+131074>>2,M(m[y+0],255&Bt,Bt>>16,tt,ct)),gt=1;gt<=pt;++gt){var ie=v[E+gt]|P[B+gt]<<16,pe=D[G+gt]|j[Z+gt]<<16,ye=St+ie+Rt+pe+524296,we=ye+2*(ie+Rt)>>3;Bt=we+St>>1,St=(ye=ye+2*(St+pe)>>3)+ie>>1,M(o[h+2*gt-1],255&Bt,Bt>>16,Y,X+(2*gt-1)*g),M(o[h+2*gt-0],255&St,St>>16,Y,X+(2*gt-0)*g),m!=null&&(Bt=ye+Rt>>1,St=we+pe>>1,M(m[y+2*gt-1],255&Bt,Bt>>16,tt,ct+(2*gt-1)*g),M(m[y+2*gt+0],255&St,St>>16,tt,ct+(2*gt+0)*g)),St=ie,Rt=pe}1&ht||(Bt=3*St+Rt+131074>>2,M(o[h+ht-1],255&Bt,Bt>>16,Y,X+(ht-1)*g),m!=null&&(Bt=3*Rt+St+131074>>2,M(m[y+ht-1],255&Bt,Bt>>16,tt,ct+(ht-1)*g)))}}function Le(){Pr[qc]=jd,Pr[Kl]=Mh,Pr[Lh]=Dm,Pr[Ql]=qp,Pr[Hc]=rc,Pr[Du]=Ud,Pr[wl]=Gd,Pr[$c]=Mh,Pr[tc]=qp,Pr[Wc]=rc,Pr[Nu]=Ud}function $e(A){return A&~Hs?0>A?0:255:A>>Hp}function _r(A,M){return $e((19077*A>>8)+(26149*M>>8)-14234)}function Mr(A,M,g){return $e((19077*A>>8)-(6419*M>>8)-(13320*g>>8)+8708)}function Or(A,M){return $e((19077*A>>8)+(33050*M>>8)-17685)}function Vr(A,M,g,o,h){o[h+0]=_r(A,g),o[h+1]=Mr(A,M,g),o[h+2]=Or(A,M)}function Di(A,M,g,o,h){o[h+0]=Or(A,M),o[h+1]=Mr(A,M,g),o[h+2]=_r(A,g)}function ln(A,M,g,o,h){var m=Mr(A,M,g);M=m<<3&224|Or(A,M)>>3,o[h+0]=248&_r(A,g)|m>>5,o[h+1]=M}function zr(A,M,g,o,h){var m=240&Or(A,M)|15;o[h+0]=240&_r(A,g)|Mr(A,M,g)>>4,o[h+1]=m}function Zn(A,M,g,o,h){o[h+0]=255,Vr(A,M,g,o,h+1)}function fr(A,M,g,o,h){Di(A,M,g,o,h),o[h+3]=255}function Es(A,M,g,o,h){Vr(A,M,g,o,h),o[h+3]=255}function Zr(A,M){return 0>A?0:A>M?M:A}function Qr(A,M,g){mt[A]=function(o,h,m,y,v,E,P,B,D){for(var G=B+(-2&D)*g;B!=G;)M(o[h+0],m[y+0],v[E+0],P,B),M(o[h+1],m[y+0],v[E+0],P,B+g),h+=2,++y,++E,B+=2*g;1&D&&M(o[h+0],m[y+0],v[E+0],P,B)}}function sa(A,M,g){return g==0?A==0?M==0?6:5:M==0?4:0:g}function ka(A,M,g,o,h){switch(A>>>30){case 3:Yl(M,g,o,h,0);break;case 2:_l(M,g,o,h);break;case 1:Kn(M,g,o,h)}}function Ra(A,M){var g,o,h=M.M,m=M.Nb,y=A.oc,v=A.pc+40,E=A.oc,P=A.pc+584,B=A.oc,D=A.pc+600;for(g=0;16>g;++g)y[v+32*g-1]=129;for(g=0;8>g;++g)E[P+32*g-1]=129,B[D+32*g-1]=129;for(0<h?y[v-1-32]=E[P-1-32]=B[D-1-32]=129:(n(y,v-32-1,127,21),n(E,P-32-1,127,9),n(B,D-32-1,127,9)),o=0;o<A.za;++o){var G=M.ya[M.aa+o];if(0<o){for(g=-1;16>g;++g)i(y,v+32*g-4,y,v+32*g+12,4);for(g=-1;8>g;++g)i(E,P+32*g-4,E,P+32*g+4,4),i(B,D+32*g-4,B,D+32*g+4,4)}var j=A.Gd,Z=A.Hd+o,Y=G.ad,X=G.Hc;if(0<h&&(i(y,v-32,j[Z].y,0,16),i(E,P-32,j[Z].f,0,8),i(B,D-32,j[Z].ea,0,8)),G.Za){var tt=y,ct=v-32+16;for(0<h&&(o>=A.za-1?n(tt,ct,j[Z].y[15],4):i(tt,ct,j[Z+1].y,0,4)),g=0;4>g;g++)tt[ct+128+g]=tt[ct+256+g]=tt[ct+384+g]=tt[ct+0+g];for(g=0;16>g;++g,X<<=2)tt=y,ct=v+Ho[g],qs[G.Ob[g]](tt,ct),ka(X,Y,16*+g,tt,ct)}else if(tt=sa(o,h,G.Ob[0]),qo[tt](y,v),X!=0)for(g=0;16>g;++g,X<<=2)ka(X,Y,16*+g,y,v+Ho[g]);for(g=G.Gc,tt=sa(o,h,G.Dd),ha[tt](E,P),ha[tt](B,D),X=Y,tt=E,ct=P,255&(G=g>>0)&&(170&G?Go(X,256,tt,ct):Ts(X,256,tt,ct)),G=B,X=D,255&(g>>=8)&&(170&g?Go(Y,320,G,X):Ts(Y,320,G,X)),h<A.Ub-1&&(i(j[Z].y,0,y,v+480,16),i(j[Z].f,0,E,P+224,8),i(j[Z].ea,0,B,D+224,8)),g=8*m*A.B,j=A.sa,Z=A.ta+16*o+16*m*A.R,Y=A.qa,G=A.ra+8*o+g,X=A.Ha,tt=A.Ia+8*o+g,g=0;16>g;++g)i(j,Z+g*A.R,y,v+32*g,16);for(g=0;8>g;++g)i(Y,G+g*A.B,E,P+32*g,8),i(X,tt+g*A.B,B,D+32*g,8)}}function fl(A,M,g,o,h,m,y,v,E){var P=[0],B=[0],D=0,G=E!=null?E.kd:0,j=E??new jc;if(A==null||12>g)return 7;j.data=A,j.w=M,j.ha=g,M=[M],g=[g],j.gb=[j.gb];t:{var Z=M,Y=g,X=j.gb;if(t(A!=null),t(Y!=null),t(X!=null),X[0]=0,12<=Y[0]&&!r(A,Z[0],"RIFF")){if(r(A,Z[0]+8,"WEBP")){X=3;break t}var tt=ze(A,Z[0]+4);if(12>tt||4294967286<tt){X=3;break t}if(G&&tt>Y[0]-8){X=7;break t}X[0]=tt,Z[0]+=12,Y[0]-=12}X=0}if(X!=0)return X;for(tt=0<j.gb[0],g=g[0];;){t:{var ct=A;Y=M,X=g;var ht=P,gt=B,pt=Z=[0];if((Bt=D=[D])[0]=0,8>X[0])X=7;else{if(!r(ct,Y[0],"VP8X")){if(ze(ct,Y[0]+4)!=10){X=3;break t}if(18>X[0]){X=7;break t}var St=ze(ct,Y[0]+8),Rt=1+De(ct,Y[0]+12);if(2147483648<=Rt*(ct=1+De(ct,Y[0]+15))){X=3;break t}pt!=null&&(pt[0]=St),ht!=null&&(ht[0]=Rt),gt!=null&&(gt[0]=ct),Y[0]+=18,X[0]-=18,Bt[0]=1}X=0}}if(D=D[0],Z=Z[0],X!=0)return X;if(Y=!!(2&Z),!tt&&D)return 3;if(m!=null&&(m[0]=!!(16&Z)),y!=null&&(y[0]=Y),v!=null&&(v[0]=0),y=P[0],Z=B[0],D&&Y&&E==null){X=0;break}if(4>g){X=7;break}if(tt&&D||!tt&&!D&&!r(A,M[0],"ALPH")){g=[g],j.na=[j.na],j.P=[j.P],j.Sa=[j.Sa];t:{St=A,X=M,tt=g;var Bt=j.gb;ht=j.na,gt=j.P,pt=j.Sa,Rt=22,t(St!=null),t(tt!=null),ct=X[0];var ie=tt[0];for(t(ht!=null),t(pt!=null),ht[0]=null,gt[0]=null,pt[0]=0;;){if(X[0]=ct,tt[0]=ie,8>ie){X=7;break t}var pe=ze(St,ct+4);if(4294967286<pe){X=3;break t}var ye=8+pe+1&-2;if(Rt+=ye,0<Bt&&Rt>Bt){X=3;break t}if(!r(St,ct,"VP8 ")||!r(St,ct,"VP8L")){X=0;break t}if(ie[0]<ye){X=7;break t}r(St,ct,"ALPH")||(ht[0]=St,gt[0]=ct+8,pt[0]=pe),ct+=ye,ie-=ye}}if(g=g[0],j.na=j.na[0],j.P=j.P[0],j.Sa=j.Sa[0],X!=0)break}g=[g],j.Ja=[j.Ja],j.xa=[j.xa];t:if(Bt=A,X=M,tt=g,ht=j.gb[0],gt=j.Ja,pt=j.xa,St=X[0],ct=!r(Bt,St,"VP8 "),Rt=!r(Bt,St,"VP8L"),t(Bt!=null),t(tt!=null),t(gt!=null),t(pt!=null),8>tt[0])X=7;else{if(ct||Rt){if(Bt=ze(Bt,St+4),12<=ht&&Bt>ht-12){X=3;break t}if(G&&Bt>tt[0]-8){X=7;break t}gt[0]=Bt,X[0]+=8,tt[0]-=8,pt[0]=Rt}else pt[0]=5<=tt[0]&&Bt[St+0]==47&&!(Bt[St+4]>>5),gt[0]=tt[0];X=0}if(g=g[0],j.Ja=j.Ja[0],j.xa=j.xa[0],M=M[0],X!=0)break;if(4294967286<j.Ja)return 3;if(v==null||Y||(v[0]=j.xa?2:1),y=[y],Z=[Z],j.xa){if(5>g){X=7;break}v=y,G=Z,Y=m,A==null||5>g?A=0:5<=g&&A[M+0]==47&&!(A[M+4]>>5)?(tt=[0],Bt=[0],ht=[0],Ot(gt=new it,A,M,g),Ft(gt,tt,Bt,ht)?(v!=null&&(v[0]=tt[0]),G!=null&&(G[0]=Bt[0]),Y!=null&&(Y[0]=ht[0]),A=1):A=0):A=0}else{if(10>g){X=7;break}v=Z,A==null||10>g||!bn(A,M+3,g-3)?A=0:(G=A[M+0]|A[M+1]<<8|A[M+2]<<16,Y=16383&(A[M+7]<<8|A[M+6]),A=16383&(A[M+9]<<8|A[M+8]),1&G||3<(G>>1&7)||!(G>>4&1)||G>>5>=j.Ja||!Y||!A?A=0:(y&&(y[0]=Y),v&&(v[0]=A),A=1))}if(!A||(y=y[0],Z=Z[0],D&&(P[0]!=y||B[0]!=Z)))return 3;E!=null&&(E[0]=j,E.offset=M-E.w,t(4294967286>M-E.w),t(E.offset==E.ha-g));break}return X==0||X==7&&D&&E==null?(m!=null&&(m[0]|=j.na!=null&&0<j.na.length),o!=null&&(o[0]=y),h!=null&&(h[0]=Z),0):X}function jo(A,M,g){var o=M.width,h=M.height,m=0,y=0,v=o,E=h;if(M.Da=A!=null&&0<A.Da,M.Da&&(v=A.cd,E=A.bd,m=A.v,y=A.j,11>g||(m&=-2,y&=-2),0>m||0>y||0>=v||0>=E||m+v>o||y+E>h))return 0;if(M.v=m,M.j=y,M.va=m+v,M.o=y+E,M.U=v,M.T=E,M.da=A!=null&&0<A.da,M.da){if(!mr(v,E,g=[A.ib],m=[A.hb]))return 0;M.ib=g[0],M.hb=m[0]}return M.ob=A!=null&&A.ob,M.Kb=A==null||!A.Sd,M.da&&(M.ob=M.ib<3*o/4&&M.hb<3*h/4,M.Kb=0),1}function oa(A){if(A==null)return 2;if(11>A.S){var M=A.f.RGBA;M.fb+=(A.height-1)*M.A,M.A=-M.A}else M=A.f.kb,A=A.height,M.O+=(A-1)*M.fa,M.fa=-M.fa,M.N+=(A-1>>1)*M.Ab,M.Ab=-M.Ab,M.W+=(A-1>>1)*M.Db,M.Db=-M.Db,M.F!=null&&(M.J+=(A-1)*M.lb,M.lb=-M.lb);return 0}function Gn(A,M,g,o){if(o==null||0>=A||0>=M)return 2;if(g!=null){if(g.Da){var h=g.cd,m=g.bd,y=-2&g.v,v=-2&g.j;if(0>y||0>v||0>=h||0>=m||y+h>A||v+m>M)return 2;A=h,M=m}if(g.da){if(!mr(A,M,h=[g.ib],m=[g.hb]))return 2;A=h[0],M=m[0]}}o.width=A,o.height=M;t:{var E=o.width,P=o.height;if(A=o.S,0>=E||0>=P||!(A>=qc&&13>A))A=2;else{if(0>=o.Rd&&o.sd==null){y=m=h=M=0;var B=(v=E*Vu[A])*P;if(11>A||(m=(P+1)/2*(M=(E+1)/2),A==12&&(y=(h=E)*P)),(P=s(B+2*m+y))==null){A=1;break t}o.sd=P,11>A?((E=o.f.RGBA).eb=P,E.fb=0,E.A=v,E.size=B):((E=o.f.kb).y=P,E.O=0,E.fa=v,E.Fd=B,E.f=P,E.N=0+B,E.Ab=M,E.Cd=m,E.ea=P,E.W=0+B+m,E.Db=M,E.Ed=m,A==12&&(E.F=P,E.J=0+B+2*m),E.Tc=y,E.lb=h)}if(M=1,h=o.S,m=o.width,y=o.height,h>=qc&&13>h)if(11>h)A=o.f.RGBA,M&=(v=Math.abs(A.A))*(y-1)+m<=A.size,M&=v>=m*Vu[h],M&=A.eb!=null;else{A=o.f.kb,v=(m+1)/2,B=(y+1)/2,E=Math.abs(A.fa),P=Math.abs(A.Ab);var D=Math.abs(A.Db),G=Math.abs(A.lb),j=G*(y-1)+m;M&=E*(y-1)+m<=A.Fd,M&=P*(B-1)+v<=A.Cd,M=(M&=D*(B-1)+v<=A.Ed)&E>=m&P>=v&D>=v,M&=A.y!=null,M&=A.f!=null,M&=A.ea!=null,h==12&&(M&=G>=m,M&=j<=A.Tc,M&=A.F!=null)}else M=0;A=M?0:2}}return A!=0||g!=null&&g.fd&&(A=oa(o)),A}var Yn=64,ml=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],gl=24,io=32,Fa=8,Bn=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Te("Predictor0","PredictorAdd0"),mt.Predictor0=function(){return 4278190080},mt.Predictor1=function(A){return A},mt.Predictor2=function(A,M,g){return M[g+0]},mt.Predictor3=function(A,M,g){return M[g+1]},mt.Predictor4=function(A,M,g){return M[g-1]},mt.Predictor5=function(A,M,g){return Ne(Ne(A,M[g+1]),M[g+0])},mt.Predictor6=function(A,M,g){return Ne(A,M[g-1])},mt.Predictor7=function(A,M,g){return Ne(A,M[g+0])},mt.Predictor8=function(A,M,g){return Ne(M[g-1],M[g+0])},mt.Predictor9=function(A,M,g){return Ne(M[g+0],M[g+1])},mt.Predictor10=function(A,M,g){return Ne(Ne(A,M[g-1]),Ne(M[g+0],M[g+1]))},mt.Predictor11=function(A,M,g){var o=M[g+0];return 0>=wr(o>>24&255,A>>24&255,(M=M[g-1])>>24&255)+wr(o>>16&255,A>>16&255,M>>16&255)+wr(o>>8&255,A>>8&255,M>>8&255)+wr(255&o,255&A,255&M)?o:A},mt.Predictor12=function(A,M,g){var o=M[g+0];return(rr((A>>24&255)+(o>>24&255)-((M=M[g-1])>>24&255))<<24|rr((A>>16&255)+(o>>16&255)-(M>>16&255))<<16|rr((A>>8&255)+(o>>8&255)-(M>>8&255))<<8|rr((255&A)+(255&o)-(255&M)))>>>0},mt.Predictor13=function(A,M,g){var o=M[g-1];return(Er((A=Ne(A,M[g+0]))>>24&255,o>>24&255)<<24|Er(A>>16&255,o>>16&255)<<16|Er(A>>8&255,o>>8&255)<<8|Er(A>>0&255,o>>0&255))>>>0};var yl=mt.PredictorAdd0;mt.PredictorAdd1=Fr,Te("Predictor2","PredictorAdd2"),Te("Predictor3","PredictorAdd3"),Te("Predictor4","PredictorAdd4"),Te("Predictor5","PredictorAdd5"),Te("Predictor6","PredictorAdd6"),Te("Predictor7","PredictorAdd7"),Te("Predictor8","PredictorAdd8"),Te("Predictor9","PredictorAdd9"),Te("Predictor10","PredictorAdd10"),Te("Predictor11","PredictorAdd11"),Te("Predictor12","PredictorAdd12"),Te("Predictor13","PredictorAdd13");var Da=mt.PredictorAdd2;xr("ColorIndexInverseTransform","MapARGB","32b",function(A){return A>>8&255},function(A){return A}),xr("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(A){return A},function(A){return A>>8&255});var Zl,Jn=mt.ColorIndexInverseTransform,aa=mt.MapARGB,Ih=mt.VP8LColorIndexInverseTransformAlpha,Ru=mt.MapAlpha,jr=mt.VP8LPredictorsAdd=[];jr.length=16,(mt.VP8LPredictors=[]).length=16,(mt.VP8LPredictorsAdd_C=[]).length=16,(mt.VP8LPredictors_C=[]).length=16;var ps,Uo,Na,fs,la,Oa,no,Yl,_l,Go,Kn,Ts,so,vl,oo,ao,bl,ms,Vo,Mi,Si,qi,cn,Gs,lo,un,ca,kd,Rd=s(511),Zi=s(2041),co=s(225),Cs=s(767),Vc=0,Fu=Zi,Jl=co,kn=Cs,yn=Rd,qc=0,Kl=1,Lh=2,Ql=3,Hc=4,Du=5,wl=6,$c=7,tc=8,Wc=9,Nu=10,Fd=[2,3,7],Dd=[3,3,11],Ou=[280,256,256,256,40],Xc=[0,1,1,1,0],Gp=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],uo=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],ua=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Nd=8,Vs=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],za=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],zu=null,Fm=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Vp=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Od=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],zd=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Zc=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],ho=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],qe=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],qo=[],qs=[],ha=[],Yc=1,ec=2,da=[],Pr=[];ce("UpsampleRgbLinePair",Vr,3),ce("UpsampleBgrLinePair",Di,3),ce("UpsampleRgbaLinePair",Es,4),ce("UpsampleBgraLinePair",fr,4),ce("UpsampleArgbLinePair",Zn,4),ce("UpsampleRgba4444LinePair",zr,2),ce("UpsampleRgb565LinePair",ln,2);var jd=mt.UpsampleRgbLinePair,Dm=mt.UpsampleBgrLinePair,Mh=mt.UpsampleRgbaLinePair,qp=mt.UpsampleBgraLinePair,rc=mt.UpsampleArgbLinePair,Ud=mt.UpsampleRgba4444LinePair,Gd=mt.UpsampleRgb565LinePair,ju=16,Bh=1<<ju-1,ic=-227,Vd=482,Hp=6,Hs=(256<<Hp)-1,Ai=0,Jc=s(256),kh=s(256),Rh=s(256),$p=s(256),Uu=s(Vd-ic),Gu=s(Vd-ic);Qr("YuvToRgbRow",Vr,3),Qr("YuvToBgrRow",Di,3),Qr("YuvToRgbaRow",Es,4),Qr("YuvToBgraRow",fr,4),Qr("YuvToArgbRow",Zn,4),Qr("YuvToRgba4444Row",zr,2),Qr("YuvToRgb565Row",ln,2);var Ho=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],xl=[0,2,8],Je=[8,7,6,4,4,2,2,2,1,1,1,1],gr=1;this.WebPDecodeRGBA=function(A,M,g,o,h){var m=Kl,y=new ro,v=new on;y.ba=v,v.S=m,v.width=[v.width],v.height=[v.height];var E=v.width,P=v.height,B=new an;if(B==null||A==null)var D=2;else t(B!=null),D=fl(A,M,g,B.width,B.height,B.Pd,B.Qd,B.format,null);if(D!=0?E=0:(E!=null&&(E[0]=B.width[0]),P!=null&&(P[0]=B.height[0]),E=1),E){v.width=v.width[0],v.height=v.height[0],o!=null&&(o[0]=v.width),h!=null&&(h[0]=v.height);t:{if(o=new cs,(h=new jc).data=A,h.w=M,h.ha=g,h.kd=1,M=[0],t(h!=null),((A=fl(h.data,h.w,h.ha,null,null,null,M,null,h))==0||A==7)&&M[0]&&(A=4),(M=A)==0){if(t(y!=null),o.data=h.data,o.w=h.w+h.offset,o.ha=h.ha-h.offset,o.put=Nt,o.ac=wt,o.bc=Vt,o.ma=y,h.xa){if((A=Wr())==null){y=1;break t}if(function(G,j){var Z=[0],Y=[0],X=[0];e:for(;;){if(G==null)return 0;if(j==null)return G.a=2,0;if(G.l=j,G.a=0,Ot(G.m,j.data,j.w,j.ha),!Ft(G.m,Z,Y,X)){G.a=3;break e}if(G.xb=ec,j.width=Z[0],j.height=Y[0],!dr(Z[0],Y[0],1,G,null))break e;return 1}return t(G.a!=0),0}(A,o)){if(o=(M=Gn(o.width,o.height,y.Oa,y.ba))==0){e:{o=A;r:for(;;){if(o==null){o=0;break e}if(t(o.s.yc!=null),t(o.s.Ya!=null),t(0<o.s.Wb),t((g=o.l)!=null),t((h=g.ma)!=null),o.xb!=0){if(o.ca=h.ba,o.tb=h.tb,t(o.ca!=null),!jo(h.Oa,g,Ql)){o.a=2;break r}if(!Nr(o,g.width)||g.da)break r;if((g.da||je(o.ca.S))&&Yt(),11>o.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),o.ca.f.kb.F!=null&&Yt()),o.Pb&&0<o.s.ua&&o.s.vb.X==null&&!or(o.s.vb,o.s.Wa.Xa)){o.a=1;break r}o.xb=0}if(!Sr(o,o.V,o.Ba,o.c,o.i,g.o,Ke))break r;h.Dc=o.Ma,o=1;break e}t(o.a!=0),o=0}o=!o}o&&(M=A.a)}else M=A.a}else{if((A=new xi)==null){y=1;break t}if(A.Fa=h.na,A.P=h.P,A.qc=h.Sa,_i(A,o)){if((M=Gn(o.width,o.height,y.Oa,y.ba))==0){if(A.Aa=0,g=y.Oa,t((h=A)!=null),g!=null){if(0<(E=0>(E=g.Md)?0:100<E?255:255*E/100)){for(P=B=0;4>P;++P)12>(D=h.pb[P]).lc&&(D.ia=E*Je[0>D.lc?0:D.lc]>>3),B|=D.ia;B&&(alert("todo:VP8InitRandom"),h.ia=1)}h.Ga=g.Id,100<h.Ga?h.Ga=100:0>h.Ga&&(h.Ga=0)}La(A,o)||(M=A.a)}}else M=A.a}M==0&&y.Oa!=null&&y.Oa.fd&&(M=oa(y.ba))}y=M}m=y!=0?null:11>m?v.f.RGBA.eb:v.f.kb.y}else m=null;return m};var Vu=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function _(mt,Dt){for(var kt="",at=0;at<4;at++)kt+=String.fromCharCode(mt[Dt++]);return kt}function w(mt,Dt){return(mt[Dt+0]<<0|mt[Dt+1]<<8|mt[Dt+2]<<16)>>>0}function S(mt,Dt){return(mt[Dt+0]<<0|mt[Dt+1]<<8|mt[Dt+2]<<16|mt[Dt+3]<<24)>>>0}new p;var C=[0],I=[0],N=[],F=new p,W=e,U=function(mt,Dt){var kt={},at=0,dt=!1,It=0,xt=0;if(kt.frames=[],!function(Et,Pt,jt,qt){for(var $t=0;$t<qt;$t++)if(Et[Pt+$t]!=jt.charCodeAt($t))return!0;return!1}(mt,Dt,"RIFF",4)){var re,ee;for(S(mt,Dt+=4),Dt+=8;Dt<mt.length;){var se=_(mt,Dt),Ot=S(mt,Dt+=4);Dt+=4;var Xt=Ot+(1&Ot);switch(se){case"VP8 ":case"VP8L":kt.frames[at]===void 0&&(kt.frames[at]={}),(it=kt.frames[at]).src_off=dt?xt:Dt-8,it.src_size=It+Ot+8,at++,dt&&(dt=!1,It=0,xt=0);break;case"VP8X":(it=kt.header={}).feature_flags=mt[Dt];var Wt=Dt+4;it.canvas_width=1+w(mt,Wt),Wt+=3,it.canvas_height=1+w(mt,Wt),Wt+=3;break;case"ALPH":dt=!0,It=Xt+8,xt=Dt-8;break;case"ANIM":(it=kt.header).bgcolor=S(mt,Dt),Wt=Dt+4,it.loop_count=(re=mt)[(ee=Wt)+0]<<0|re[ee+1]<<8,Wt+=2;break;case"ANMF":var xe,it;(it=kt.frames[at]={}).offset_x=2*w(mt,Dt),Dt+=3,it.offset_y=2*w(mt,Dt),Dt+=3,it.width=1+w(mt,Dt),Dt+=3,it.height=1+w(mt,Dt),Dt+=3,it.duration=w(mt,Dt),Dt+=3,xe=mt[Dt++],it.dispose=1&xe,it.blend=xe>>1&1}se!="ANMF"&&(Dt+=Xt)}return kt}}(W,0);U.response=W,U.rgbaoutput=!0,U.dataurl=!1;var z=U.header?U.header:null,H=U.frames?U.frames:null;if(z){z.loop_counter=z.loop_count,C=[z.canvas_height],I=[z.canvas_width];for(var nt=0;nt<H.length&&H[nt].blend!=0;nt++);}var yt=H[0],bt=F.WebPDecodeRGBA(W,yt.src_off,yt.src_size,I,C);yt.rgba=bt,yt.imgwidth=I[0],yt.imgheight=C[0];for(var vt=0;vt<I[0]*C[0]*4;vt++)N[vt]=bt[vt];return this.width=I,this.height=C,this.data=N,this}(function(e){var t=function(){return typeof Zx=="function"},r=function(C,I,N,F){var W=4,U=c;switch(F){case e.image_compression.FAST:W=1,U=s;break;case e.image_compression.MEDIUM:W=6,U=a;break;case e.image_compression.SLOW:W=9,U=p}C=i(C,I,N,U);var z=Zx(C,{level:W});return e.__addimage__.arrayBufferToBinaryString(z)},i=function(C,I,N,F){for(var W,U,z,H=C.length/I,nt=new Uint8Array(C.length+H),yt=w(),bt=0;bt<H;bt+=1){if(z=bt*I,W=C.subarray(z,z+I),F)nt.set(F(W,N,U),z+bt);else{for(var vt,mt=yt.length,Dt=[];vt<mt;vt+=1)Dt[vt]=yt[vt](W,N,U);var kt=S(Dt.concat());nt.set(Dt[kt],z+bt)}U=W}return nt},n=function(C){var I=Array.apply([],C);return I.unshift(0),I},s=function(C,I){var N,F=[],W=C.length;F[0]=1;for(var U=0;U<W;U+=1)N=C[U-I]||0,F[U+1]=C[U]-N+256&255;return F},c=function(C,I,N){var F,W=[],U=C.length;W[0]=2;for(var z=0;z<U;z+=1)F=N&&N[z]||0,W[z+1]=C[z]-F+256&255;return W},a=function(C,I,N){var F,W,U=[],z=C.length;U[0]=3;for(var H=0;H<z;H+=1)F=C[H-I]||0,W=N&&N[H]||0,U[H+1]=C[H]+256-(F+W>>>1)&255;return U},p=function(C,I,N){var F,W,U,z,H=[],nt=C.length;H[0]=4;for(var yt=0;yt<nt;yt+=1)F=C[yt-I]||0,W=N&&N[yt]||0,U=N&&N[yt-I]||0,z=_(F,W,U),H[yt+1]=C[yt]-z+256&255;return H},_=function(C,I,N){if(C===I&&I===N)return C;var F=Math.abs(I-N),W=Math.abs(C-N),U=Math.abs(C+I-N-N);return F<=W&&F<=U?C:W<=U?I:N},w=function(){return[n,s,c,a,p]},S=function(C){var I=C.map(function(N){return N.reduce(function(F,W){return F+Math.abs(W)},0)});return I.indexOf(Math.min.apply(null,I))};e.processPNG=function(C,I,N,F){var W,U,z,H,nt,yt,bt,vt,mt,Dt,kt,at,dt,It,xt,re=this.decode.FLATE_DECODE,ee="";if(this.__addimage__.isArrayBuffer(C)&&(C=new Uint8Array(C)),this.__addimage__.isArrayBufferView(C)){if(C=(z=new mrt(C)).imgData,U=z.bits,W=z.colorSpace,nt=z.colors,[4,6].indexOf(z.colorType)!==-1){if(z.bits===8){mt=(vt=z.pixelBitlength==32?new Uint32Array(z.decodePixels().buffer):z.pixelBitlength==16?new Uint16Array(z.decodePixels().buffer):new Uint8Array(z.decodePixels().buffer)).length,kt=new Uint8Array(mt*z.colors),Dt=new Uint8Array(mt);var se,Ot=z.pixelBitlength-z.bits;for(It=0,xt=0;It<mt;It++){for(dt=vt[It],se=0;se<Ot;)kt[xt++]=dt>>>se&255,se+=z.bits;Dt[It]=dt>>>se&255}}if(z.bits===16){mt=(vt=new Uint32Array(z.decodePixels().buffer)).length,kt=new Uint8Array(mt*(32/z.pixelBitlength)*z.colors),Dt=new Uint8Array(mt*(32/z.pixelBitlength)),at=z.colors>1,It=0,xt=0;for(var Xt=0;It<mt;)dt=vt[It++],kt[xt++]=dt>>>0&255,at&&(kt[xt++]=dt>>>16&255,dt=vt[It++],kt[xt++]=dt>>>0&255),Dt[Xt++]=dt>>>16&255;U=8}F!==e.image_compression.NONE&&t()?(C=r(kt,z.width*z.colors,z.colors,F),bt=r(Dt,z.width,1,F)):(C=kt,bt=Dt,re=void 0)}if(z.colorType===3&&(W=this.color_spaces.INDEXED,yt=z.palette,z.transparency.indexed)){var Wt=z.transparency.indexed,xe=0;for(It=0,mt=Wt.length;It<mt;++It)xe+=Wt[It];if((xe/=255)===mt-1&&Wt.indexOf(0)!==-1)H=[Wt.indexOf(0)];else if(xe!==mt){for(vt=z.decodePixels(),Dt=new Uint8Array(vt.length),It=0,mt=vt.length;It<mt;It++)Dt[It]=Wt[vt[It]];bt=r(Dt,z.width,1)}}var it=function(Et){var Pt;switch(Et){case e.image_compression.FAST:Pt=11;break;case e.image_compression.MEDIUM:Pt=13;break;case e.image_compression.SLOW:Pt=14;break;default:Pt=12}return Pt}(F);return re===this.decode.FLATE_DECODE&&(ee="/Predictor "+it+" "),ee+="/Colors "+nt+" /BitsPerComponent "+U+" /Columns "+z.width,(this.__addimage__.isArrayBuffer(C)||this.__addimage__.isArrayBufferView(C))&&(C=this.__addimage__.arrayBufferToBinaryString(C)),(bt&&this.__addimage__.isArrayBuffer(bt)||this.__addimage__.isArrayBufferView(bt))&&(bt=this.__addimage__.arrayBufferToBinaryString(bt)),{alias:N,data:C,index:I,filter:re,decodeParameters:ee,transparency:H,palette:yt,sMask:bt,predictor:it,width:z.width,height:z.height,bitsPerComponent:U,colorSpace:W}}}})(kr.API),function(e){e.processGIF89A=function(t,r,i,n){var s=new grt(t),c=s.width,a=s.height,p=[];s.decodeAndBlitFrameRGBA(0,p);var _={data:p,width:c,height:a},w=new J2(100).encode(_,100);return e.processJPEG.call(this,w,r,i,n)},e.processGIF87A=e.processGIF89A}(kr.API),uc.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:n,green:i,blue:r,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},uc.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(r){Ji.log("bit decode error:"+r)}},uc.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),r=t%4;for(e=this.height-1;e>=0;e--){for(var i=this.bottom_up?e:this.height-1-e,n=0;n<t;n++)for(var s=this.datav.getUint8(this.pos++,!0),c=i*this.width*4+8*n*4,a=0;a<8&&8*n+a<this.width;a++){var p=this.palette[s>>7-a&1];this.data[c+4*a]=p.blue,this.data[c+4*a+1]=p.green,this.data[c+4*a+2]=p.red,this.data[c+4*a+3]=255}r!==0&&(this.pos+=4-r)}},uc.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,r=this.height-1;r>=0;r--){for(var i=this.bottom_up?r:this.height-1-r,n=0;n<e;n++){var s=this.datav.getUint8(this.pos++,!0),c=i*this.width*4+2*n*4,a=s>>4,p=15&s,_=this.palette[a];if(this.data[c]=_.blue,this.data[c+1]=_.green,this.data[c+2]=_.red,this.data[c+3]=255,2*n+1>=this.width)break;_=this.palette[p],this.data[c+4]=_.blue,this.data[c+4+1]=_.green,this.data[c+4+2]=_.red,this.data[c+4+3]=255}t!==0&&(this.pos+=4-t)}},uc.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,i=0;i<this.width;i++){var n=this.datav.getUint8(this.pos++,!0),s=r*this.width*4+4*i;if(n<this.palette.length){var c=this.palette[n];this.data[s]=c.red,this.data[s+1]=c.green,this.data[s+2]=c.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}e!==0&&(this.pos+=4-e)}},uc.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var i=this.bottom_up?r:this.height-1-r,n=0;n<this.width;n++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var c=(s&t)/t*255|0,a=(s>>5&t)/t*255|0,p=(s>>10&t)/t*255|0,_=s>>15?255:0,w=i*this.width*4+4*n;this.data[w]=p,this.data[w+1]=a,this.data[w+2]=c,this.data[w+3]=_}this.pos+=e}},uc.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),r=parseInt("111111",2),i=this.height-1;i>=0;i--){for(var n=this.bottom_up?i:this.height-1-i,s=0;s<this.width;s++){var c=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(c&t)/t*255|0,p=(c>>5&r)/r*255|0,_=(c>>11)/t*255|0,w=n*this.width*4+4*s;this.data[w]=_,this.data[w+1]=p,this.data[w+2]=a,this.data[w+3]=255}this.pos+=e}},uc.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var i=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),c=t*this.width*4+4*r;this.data[c]=s,this.data[c+1]=n,this.data[c+2]=i,this.data[c+3]=255}this.pos+=this.width%4}},uc.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var i=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),a=t*this.width*4+4*r;this.data[a]=s,this.data[a+1]=n,this.data[a+2]=i,this.data[a+3]=c}},uc.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,r,i,n){var s=new uc(t,!1),c=s.width,a=s.height,p={data:s.getData(),width:c,height:a},_=new J2(100).encode(p,100);return e.processJPEG.call(this,_,r,i,n)}}(kr.API),QI.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,r,i,n){var s=new QI(t),c=s.width,a=s.height,p={data:s.getData(),width:c,height:a},_=new J2(100).encode(p,100);return e.processJPEG.call(this,_,r,i,n)}}(kr.API),kr.API.processRGBA=function(e,t,r){for(var i=e.data,n=i.length,s=new Uint8Array(n/4*3),c=new Uint8Array(n/4),a=0,p=0,_=0;_<n;_+=4){var w=i[_],S=i[_+1],C=i[_+2],I=i[_+3];s[a++]=w,s[a++]=S,s[a++]=C,c[p++]=I}var N=this.__addimage__.arrayBufferToBinaryString(s);return{alpha:this.__addimage__.arrayBufferToBinaryString(c),data:N,index:t,alias:r,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},kr.API.setLanguage=function(e){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]!==void 0&&(this.internal.languageSettings.languageCode=e,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},wf=kr.API,yy=wf.getCharWidthsArray=function(e,t){var r,i,n=(t=t||{}).font||this.internal.getFont(),s=t.fontSize||this.internal.getFontSize(),c=t.charSpace||this.internal.getCharSpace(),a=t.widths?t.widths:n.metadata.Unicode.widths,p=a.fof?a.fof:1,_=t.kerning?t.kerning:n.metadata.Unicode.kerning,w=_.fof?_.fof:1,S=t.doKerning!==!1,C=0,I=e.length,N=0,F=a[0]||p,W=[];for(r=0;r<I;r++)i=e.charCodeAt(r),typeof n.metadata.widthOfString=="function"?W.push((n.metadata.widthOfGlyph(n.metadata.characterToGlyph(i))+c*(1e3/s)||0)/1e3):(C=S&&Ui(_[i])==="object"&&!isNaN(parseInt(_[i][N],10))?_[i][N]/w:0,W.push((a[i]||F)/p+C)),N=i;return W},ZI=wf.getStringUnitWidth=function(e,t){var r=(t=t||{}).fontSize||this.internal.getFontSize(),i=t.font||this.internal.getFont(),n=t.charSpace||this.internal.getCharSpace();return wf.processArabic&&(e=wf.processArabic(e)),typeof i.metadata.widthOfString=="function"?i.metadata.widthOfString(e,r,n)/r:yy.apply(this,arguments).reduce(function(s,c){return s+c},0)},YI=function(e,t,r,i){for(var n=[],s=0,c=e.length,a=0;s!==c&&a+t[s]<r;)a+=t[s],s++;n.push(e.slice(0,s));var p=s;for(a=0;s!==c;)a+t[s]>i&&(n.push(e.slice(p,s)),a=0,p=s),a+=t[s],s++;return p!==s&&n.push(e.slice(p,s)),n},JI=function(e,t,r){r||(r={});var i,n,s,c,a,p,_,w=[],S=[w],C=r.textIndent||0,I=0,N=0,F=e.split(" "),W=yy.apply(this,[" ",r])[0];if(p=r.lineIndent===-1?F[0].length+2:r.lineIndent||0){var U=Array(p).join(" "),z=[];F.map(function(nt){(nt=nt.split(/\s*\n/)).length>1?z=z.concat(nt.map(function(yt,bt){return(bt&&yt.length?`
`:"")+yt})):z.push(nt[0])}),F=z,p=ZI.apply(this,[U,r])}for(s=0,c=F.length;s<c;s++){var H=0;if(i=F[s],p&&i[0]==`
`&&(i=i.substr(1),H=1),C+I+(N=(n=yy.apply(this,[i,r])).reduce(function(nt,yt){return nt+yt},0))>t||H){if(N>t){for(a=YI.apply(this,[i,n,t-(C+I),t]),w.push(a.shift()),w=[a.pop()];a.length;)S.push([a.shift()]);N=n.slice(i.length-(w[0]?w[0].length:0)).reduce(function(nt,yt){return nt+yt},0)}else w=[i];S.push(w),C=N+p,I=W}else w.push(i),C+=I+N,I=W}return _=p?function(nt,yt){return(yt?U:"")+nt.join(" ")}:function(nt){return nt.join(" ")},S.map(_)},wf.splitTextToSize=function(e,t,r){var i,n=(r=r||{}).fontSize||this.internal.getFontSize(),s=(function(w){if(w.widths&&w.kerning)return{widths:w.widths,kerning:w.kerning};var S=this.internal.getFont(w.fontName,w.fontStyle);return S.metadata.Unicode?{widths:S.metadata.Unicode.widths||{0:1},kerning:S.metadata.Unicode.kerning||{}}:{font:S.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,r);i=Array.isArray(e)?e:String(e).split(/\r?\n/);var c=1*this.internal.scaleFactor*t/n;s.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/n:0,s.lineIndent=r.lineIndent;var a,p,_=[];for(a=0,p=i.length;a<p;a++)_=_.concat(JI.apply(this,[i[a],c,s]));return _},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",r={},i={},n=0;n<t.length;n++)r[t[n]]="0123456789abcdef"[n],i["0123456789abcdef"[n]]=t[n];var s=function(S){return"0x"+parseInt(S,10).toString(16)},c=e.__fontmetrics__.compress=function(S){var C,I,N,F,W=["{"];for(var U in S){if(C=S[U],isNaN(parseInt(U,10))?I="'"+U+"'":(U=parseInt(U,10),I=(I=s(U).slice(2)).slice(0,-1)+i[I.slice(-1)]),typeof C=="number")C<0?(N=s(C).slice(3),F="-"):(N=s(C).slice(2),F=""),N=F+N.slice(0,-1)+i[N.slice(-1)];else{if(Ui(C)!=="object")throw new Error("Don't know what to do with value type "+Ui(C)+".");N=c(C)}W.push(I+N)}return W.push("}"),W.join("")},a=e.__fontmetrics__.uncompress=function(S){if(typeof S!="string")throw new Error("Invalid argument passed to uncompress.");for(var C,I,N,F,W={},U=1,z=W,H=[],nt="",yt="",bt=S.length-1,vt=1;vt<bt;vt+=1)(F=S[vt])=="'"?C?(N=C.join(""),C=void 0):C=[]:C?C.push(F):F=="{"?(H.push([z,N]),z={},N=void 0):F=="}"?((I=H.pop())[0][I[1]]=z,N=void 0,z=I[0]):F=="-"?U=-1:N===void 0?r.hasOwnProperty(F)?(nt+=r[F],N=parseInt(nt,16)*U,U=1,nt=""):nt+=F:r.hasOwnProperty(F)?(yt+=r[F],z[N]=parseInt(yt,16)*U,U=1,N=void 0,yt=""):yt+=F;return W},p={codePages:["WinAnsiEncoding"],WinAnsiEncoding:a("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},_={Unicode:{Courier:p,"Courier-Bold":p,"Courier-BoldOblique":p,"Courier-Oblique":p,Helvetica:p,"Helvetica-Bold":p,"Helvetica-BoldOblique":p,"Helvetica-Oblique":p,"Times-Roman":p,"Times-Bold":p,"Times-BoldItalic":p,"Times-Italic":p}},w={Unicode:{"Courier-Oblique":a("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":a("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":a("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:a("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":a("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":a("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:a("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:a("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":a("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:a("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":a("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":a("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":a("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":a("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(S){var C=S.font,I=w.Unicode[C.postScriptName];I&&(C.metadata.Unicode={},C.metadata.Unicode.widths=I.widths,C.metadata.Unicode.kerning=I.kerning);var N=_.Unicode[C.postScriptName];N&&(C.metadata.Unicode.encoding=N,C.encoding=N.codePages[0])}])}(kr.API),function(e){var t=function(r){for(var i=r.length,n=new Uint8Array(i),s=0;s<i;s++)n[s]=r.charCodeAt(s);return n};e.API.events.push(["addFont",function(r){var i=void 0,n=r.font,s=r.instance;if(!n.isStandardFont){if(s===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");if(typeof(i=s.existsFileInVFS(n.postScriptName)===!1?s.loadFile(n.postScriptName):s.getFileFromVFS(n.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");(function(c,a){a=/^\x00\x01\x00\x00/.test(a)?t(a):t(n0(a)),c.metadata=e.API.TTFFont.open(a),c.metadata.Unicode=c.metadata.Unicode||{encoding:{},kerning:{},widths:[]},c.metadata.glyIdsUsed=[0]})(n,i)}}])}(kr),function(e){function t(){return(Rr.canvg?Promise.resolve(Rr.canvg):Yw(()=>import("./index.es-BWyxJuJN-HCk0JDTR-12d88939.js"),[])).catch(function(r){return Promise.reject(new Error("Could not load canvg: "+r))}).then(function(r){return r.default?r.default:r})}kr.API.addSvgAsImage=function(r,i,n,s,c,a,p,_){if(isNaN(i)||isNaN(n))throw Ji.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(s)||isNaN(c))throw Ji.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var w=document.createElement("canvas");w.width=s,w.height=c;var S=w.getContext("2d");S.fillStyle="#fff",S.fillRect(0,0,w.width,w.height);var C={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},I=this;return t().then(function(N){return N.fromString(S,r,C)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(N){return N.render(C)}).then(function(){I.addImage(w.toDataURL("image/jpeg",1),i,n,s,c,p,_)})}}(),kr.API.putTotalPages=function(e){var t,r=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),r=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),r=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var i=1;i<=this.internal.getNumberOfPages();i++)for(var n=0;n<this.internal.pages[i].length;n++)this.internal.pages[i][n]=this.internal.pages[i][n].replace(t,r);return this},kr.API.viewerPreferences=function(e,t){var r;e=e||{},t=t||!1;var i,n,s,c={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},a=Object.keys(c),p=[],_=0,w=0,S=0;function C(N,F){var W,U=!1;for(W=0;W<N.length;W+=1)N[W]===F&&(U=!0);return U}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(c)),this.internal.viewerpreferences.isSubscribed=!1),r=this.internal.viewerpreferences.configuration,e==="reset"||t===!0){var I=a.length;for(S=0;S<I;S+=1)r[a[S]].value=r[a[S]].defaultValue,r[a[S]].explicitSet=!1}if(Ui(e)==="object"){for(n in e)if(s=e[n],C(a,n)&&s!==void 0){if(r[n].type==="boolean"&&typeof s=="boolean")r[n].value=s;else if(r[n].type==="name"&&C(r[n].valueSet,s))r[n].value=s;else if(r[n].type==="integer"&&Number.isInteger(s))r[n].value=s;else if(r[n].type==="array"){for(_=0;_<s.length;_+=1)if(i=!0,s[_].length===1&&typeof s[_][0]=="number")p.push(String(s[_]-1));else if(s[_].length>1){for(w=0;w<s[_].length;w+=1)typeof s[_][w]!="number"&&(i=!1);i===!0&&p.push([s[_][0]-1,s[_][1]-1].join(" "))}r[n].value="["+p.join(" ")+"]"}else r[n].value=r[n].defaultValue;r[n].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var N,F=[];for(N in r)r[N].explicitSet===!0&&(r[N].type==="name"?F.push("/"+N+" /"+r[N].value):F.push("/"+N+" "+r[N].value));F.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+F.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=r,this},function(e){var t=function(){var i='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',n=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),s=unescape(encodeURIComponent(i)),c=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),a=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),p=unescape(encodeURIComponent("</x:xmpmeta>")),_=s.length+c.length+a.length+n.length+p.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+_+" >>"),this.internal.write("stream"),this.internal.write(n+s+c+a+p),this.internal.write("endstream"),this.internal.write("endobj")},r=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(i,n){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:i,namespaceuri:n||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",r),this.internal.events.subscribe("postPutResources",t)),this}}(kr.API),function(e){var t=e.API,r=t.pdfEscape16=function(s,c){for(var a,p=c.metadata.Unicode.widths,_=["","0","00","000","0000"],w=[""],S=0,C=s.length;S<C;++S){if(a=c.metadata.characterToGlyph(s.charCodeAt(S)),c.metadata.glyIdsUsed.push(a),c.metadata.toUnicode[a]=s.charCodeAt(S),p.indexOf(a)==-1&&(p.push(a),p.push([parseInt(c.metadata.widthOfGlyph(a),10)])),a=="0")return w.join("");a=a.toString(16),w.push(_[4-a.length],a)}return w.join("")},i=function(s){var c,a,p,_,w,S,C;for(w=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,p=[],S=0,C=(a=Object.keys(s).sort(function(I,N){return I-N})).length;S<C;S++)c=a[S],p.length>=100&&(w+=`
`+p.length+` beginbfchar
`+p.join(`
`)+`
endbfchar`,p=[]),s[c]!==void 0&&s[c]!==null&&typeof s[c].toString=="function"&&(_=("0000"+s[c].toString(16)).slice(-4),c=("0000"+(+c).toString(16)).slice(-4),p.push("<"+c+"><"+_+">"));return p.length&&(w+=`
`+p.length+` beginbfchar
`+p.join(`
`)+`
endbfchar
`),w+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(s){(function(c){var a=c.font,p=c.out,_=c.newObject,w=c.putStream;if(a.metadata instanceof e.API.TTFFont&&a.encoding==="Identity-H"){for(var S=a.metadata.Unicode.widths,C=a.metadata.subset.encode(a.metadata.glyIdsUsed,1),I="",N=0;N<C.length;N++)I+=String.fromCharCode(C[N]);var F=_();w({data:I,addLength1:!0,objectId:F}),p("endobj");var W=_();w({data:i(a.metadata.toUnicode),addLength1:!0,objectId:W}),p("endobj");var U=_();p("<<"),p("/Type /FontDescriptor"),p("/FontName /"+Ef(a.fontName)),p("/FontFile2 "+F+" 0 R"),p("/FontBBox "+e.API.PDFObject.convert(a.metadata.bbox)),p("/Flags "+a.metadata.flags),p("/StemV "+a.metadata.stemV),p("/ItalicAngle "+a.metadata.italicAngle),p("/Ascent "+a.metadata.ascender),p("/Descent "+a.metadata.decender),p("/CapHeight "+a.metadata.capHeight),p(">>"),p("endobj");var z=_();p("<<"),p("/Type /Font"),p("/BaseFont /"+Ef(a.fontName)),p("/FontDescriptor "+U+" 0 R"),p("/W "+e.API.PDFObject.convert(S)),p("/CIDToGIDMap /Identity"),p("/DW 1000"),p("/Subtype /CIDFontType2"),p("/CIDSystemInfo"),p("<<"),p("/Supplement 0"),p("/Registry (Adobe)"),p("/Ordering ("+a.encoding+")"),p(">>"),p(">>"),p("endobj"),a.objectNumber=_(),p("<<"),p("/Type /Font"),p("/Subtype /Type0"),p("/ToUnicode "+W+" 0 R"),p("/BaseFont /"+Ef(a.fontName)),p("/Encoding /"+a.encoding),p("/DescendantFonts ["+z+" 0 R]"),p(">>"),p("endobj"),a.isAlreadyPutted=!0}})(s)}]),t.events.push(["putFont",function(s){(function(c){var a=c.font,p=c.out,_=c.newObject,w=c.putStream;if(a.metadata instanceof e.API.TTFFont&&a.encoding==="WinAnsiEncoding"){for(var S=a.metadata.rawData,C="",I=0;I<S.length;I++)C+=String.fromCharCode(S[I]);var N=_();w({data:C,addLength1:!0,objectId:N}),p("endobj");var F=_();w({data:i(a.metadata.toUnicode),addLength1:!0,objectId:F}),p("endobj");var W=_();p("<<"),p("/Descent "+a.metadata.decender),p("/CapHeight "+a.metadata.capHeight),p("/StemV "+a.metadata.stemV),p("/Type /FontDescriptor"),p("/FontFile2 "+N+" 0 R"),p("/Flags 96"),p("/FontBBox "+e.API.PDFObject.convert(a.metadata.bbox)),p("/FontName /"+Ef(a.fontName)),p("/ItalicAngle "+a.metadata.italicAngle),p("/Ascent "+a.metadata.ascender),p(">>"),p("endobj"),a.objectNumber=_();for(var U=0;U<a.metadata.hmtx.widths.length;U++)a.metadata.hmtx.widths[U]=parseInt(a.metadata.hmtx.widths[U]*(1e3/a.metadata.head.unitsPerEm));p("<</Subtype/TrueType/Type/Font/ToUnicode "+F+" 0 R/BaseFont/"+Ef(a.fontName)+"/FontDescriptor "+W+" 0 R/Encoding/"+a.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(a.metadata.hmtx.widths)+">>"),p("endobj"),a.isAlreadyPutted=!0}})(s)}]);var n=function(s){var c,a=s.text||"",p=s.x,_=s.y,w=s.options||{},S=s.mutex||{},C=S.pdfEscape,I=S.activeFontKey,N=S.fonts,F=I,W="",U=0,z="",H=N[F].encoding;if(N[F].encoding!=="Identity-H")return{text:a,x:p,y:_,options:w,mutex:S};for(z=a,F=I,Array.isArray(a)&&(z=a[0]),U=0;U<z.length;U+=1)N[F].metadata.hasOwnProperty("cmap")&&(c=N[F].metadata.cmap.unicode.codeMap[z[U].charCodeAt(0)]),c||z[U].charCodeAt(0)<256&&N[F].metadata.hasOwnProperty("Unicode")?W+=z[U]:W+="";var nt="";return parseInt(F.slice(1))<14||H==="WinAnsiEncoding"?nt=C(W,F).split("").map(function(yt){return yt.charCodeAt(0).toString(16)}).join(""):H==="Identity-H"&&(nt=r(W,N[F])),S.isHex=!0,{text:nt,x:p,y:_,options:w,mutex:S}};t.events.push(["postProcessText",function(s){var c=s.text||"",a=[],p={text:c,x:s.x,y:s.y,options:s.options,mutex:s.mutex};if(Array.isArray(c)){var _=0;for(_=0;_<c.length;_+=1)Array.isArray(c[_])&&c[_].length===3?a.push([n(Object.assign({},p,{text:c[_][0]})).text,c[_][1],c[_][2]]):a.push(n(Object.assign({},p,{text:c[_]})).text);s.text=a}else s.text=n(Object.assign({},p,{text:c})).text}])}(kr),function(e){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0},e.addFileToVFS=function(r,i){return t.call(this),this.internal.vFS[r]=i,this},e.getFileFromVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0?this.internal.vFS[r]:null}}(kr.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(i){var n,s,c,a,p,_,w,S=t,C=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],I=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],N={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},F={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},W=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],U=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),z=!1,H=0;this.__bidiEngine__={};var nt=function(at){var dt=at.charCodeAt(),It=dt>>8,xt=F[It];return xt!==void 0?S[256*xt+(255&dt)]:It===252||It===253?"AL":U.test(It)?"L":It===8?"R":"N"},yt=function(at){for(var dt,It=0;It<at.length;It++){if((dt=nt(at.charAt(It)))==="L")return!1;if(dt==="R")return!0}return!1},bt=function(at,dt,It,xt){var re,ee,se,Ot,Xt=dt[xt];switch(Xt){case"L":case"R":z=!1;break;case"N":case"AN":break;case"EN":z&&(Xt="AN");break;case"AL":z=!0,Xt="R";break;case"WS":Xt="N";break;case"CS":xt<1||xt+1>=dt.length||(re=It[xt-1])!=="EN"&&re!=="AN"||(ee=dt[xt+1])!=="EN"&&ee!=="AN"?Xt="N":z&&(ee="AN"),Xt=ee===re?ee:"N";break;case"ES":Xt=(re=xt>0?It[xt-1]:"B")==="EN"&&xt+1<dt.length&&dt[xt+1]==="EN"?"EN":"N";break;case"ET":if(xt>0&&It[xt-1]==="EN"){Xt="EN";break}if(z){Xt="N";break}for(se=xt+1,Ot=dt.length;se<Ot&&dt[se]==="ET";)se++;Xt=se<Ot&&dt[se]==="EN"?"EN":"N";break;case"NSM":if(c&&!a){for(Ot=dt.length,se=xt+1;se<Ot&&dt[se]==="NSM";)se++;if(se<Ot){var Wt=at[xt],xe=Wt>=1425&&Wt<=2303||Wt===64286;if(re=dt[se],xe&&(re==="R"||re==="AL")){Xt="R";break}}}Xt=xt<1||(re=dt[xt-1])==="B"?"N":It[xt-1];break;case"B":z=!1,n=!0,Xt=H;break;case"S":s=!0,Xt="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":z=!1;break;case"BN":Xt="N"}return Xt},vt=function(at,dt,It){var xt=at.split("");return It&&mt(xt,It,{hiLevel:H}),xt.reverse(),dt&&dt.reverse(),xt.join("")},mt=function(at,dt,It){var xt,re,ee,se,Ot,Xt=-1,Wt=at.length,xe=0,it=[],Et=H?I:C,Pt=[];for(z=!1,n=!1,s=!1,re=0;re<Wt;re++)Pt[re]=nt(at[re]);for(ee=0;ee<Wt;ee++){if(Ot=xe,it[ee]=bt(at,Pt,it,ee),xt=240&(xe=Et[Ot][N[it[ee]]]),xe&=15,dt[ee]=se=Et[xe][5],xt>0)if(xt===16){for(re=Xt;re<ee;re++)dt[re]=1;Xt=-1}else Xt=-1;if(Et[xe][6])Xt===-1&&(Xt=ee);else if(Xt>-1){for(re=Xt;re<ee;re++)dt[re]=se;Xt=-1}Pt[ee]==="B"&&(dt[ee]=0),It.hiLevel|=se}s&&function(jt,qt,$t){for(var Qt=0;Qt<$t;Qt++)if(jt[Qt]==="S"){qt[Qt]=H;for(var Kt=Qt-1;Kt>=0&&jt[Kt]==="WS";Kt--)qt[Kt]=H}}(Pt,dt,Wt)},Dt=function(at,dt,It,xt,re){if(!(re.hiLevel<at)){if(at===1&&H===1&&!n)return dt.reverse(),void(It&&It.reverse());for(var ee,se,Ot,Xt,Wt=dt.length,xe=0;xe<Wt;){if(xt[xe]>=at){for(Ot=xe+1;Ot<Wt&&xt[Ot]>=at;)Ot++;for(Xt=xe,se=Ot-1;Xt<se;Xt++,se--)ee=dt[Xt],dt[Xt]=dt[se],dt[se]=ee,It&&(ee=It[Xt],It[Xt]=It[se],It[se]=ee);xe=Ot}xe++}}},kt=function(at,dt,It){var xt=at.split(""),re={hiLevel:H};return It||(It=[]),mt(xt,It,re),function(ee,se,Ot){if(Ot.hiLevel!==0&&w)for(var Xt,Wt=0;Wt<ee.length;Wt++)se[Wt]===1&&(Xt=W.indexOf(ee[Wt]))>=0&&(ee[Wt]=W[Xt+1])}(xt,It,re),Dt(2,xt,dt,It,re),Dt(1,xt,dt,It,re),xt.join("")};return this.__bidiEngine__.doBidiReorder=function(at,dt,It){if(function(re,ee){if(ee)for(var se=0;se<re.length;se++)ee[se]=se;a===void 0&&(a=yt(re)),_===void 0&&(_=yt(re))}(at,dt),c||!p||_)if(c&&p&&a^_)H=a?1:0,at=vt(at,dt,It);else if(!c&&p&&_)H=a?1:0,at=kt(at,dt,It),at=vt(at,dt);else if(!c||a||p||_){if(c&&!p&&a^_)at=vt(at,dt),a?(H=0,at=kt(at,dt,It)):(H=1,at=kt(at,dt,It),at=vt(at,dt));else if(c&&a&&!p&&_)H=1,at=kt(at,dt,It),at=vt(at,dt);else if(!c&&!p&&a^_){var xt=w;a?(H=1,at=kt(at,dt,It),H=0,w=!1,at=kt(at,dt,It),w=xt):(H=0,at=kt(at,dt,It),at=vt(at,dt),H=1,w=!1,at=kt(at,dt,It),w=xt,at=vt(at,dt))}}else H=0,at=kt(at,dt,It);else H=a?1:0,at=kt(at,dt,It);return at},this.__bidiEngine__.setOptions=function(at){at&&(c=at.isInputVisual,p=at.isOutputVisual,a=at.isInputRtl,_=at.isOutputRtl,w=at.isSymmetricSwapping)},this.__bidiEngine__.setOptions(i),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],r=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(i){var n=i.text,s=(i.x,i.y,i.options||{}),c=(i.mutex,s.lang,[]);if(s.isInputVisual=typeof s.isInputVisual!="boolean"||s.isInputVisual,r.setOptions(s),Object.prototype.toString.call(n)==="[object Array]"){var a=0;for(c=[],a=0;a<n.length;a+=1)Object.prototype.toString.call(n[a])==="[object Array]"?c.push([r.doBidiReorder(n[a][0]),n[a][1],n[a][2]]):c.push([r.doBidiReorder(n[a])]);i.text=c}else i.text=r.doBidiReorder(n);r.setOptions({isInputVisual:!0})}])}(kr),kr.API.TTFFont=function(){function e(t){var r;if(this.rawData=t,r=this.contents=new Td(t),this.contents.pos=4,r.readString(4)==="ttcf")throw new Error("TTCF not supported.");r.pos=0,this.parse(),this.subset=new Mrt(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new yrt(this.contents),this.head=new vrt(this),this.name=new Art(this),this.cmap=new Xk(this),this.toUnicode={},this.hhea=new brt(this),this.maxp=new Ert(this),this.hmtx=new Trt(this),this.post=new xrt(this),this.os2=new wrt(this),this.loca=new Lrt(this),this.glyf=new Crt(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var t,r,i,n,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var c,a,p,_;for(_=[],c=0,a=(p=this.bbox).length;c<a;c++)t=p[c],_.push(Math.round(t*this.scaleFactor));return _}).call(this),this.stemV=0,this.post.exists?(i=255&(n=this.post.italic_angle),32768&(r=n>>16)&&(r=-(1+(65535^r))),this.italicAngle=+(r+"."+i)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(s=this.familyClass)===1||s===2||s===3||s===4||s===5||s===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(t){var r;return((r=this.cmap.unicode)!=null?r.codeMap[t]:void 0)||0},e.prototype.widthOfGlyph=function(t){var r;return r=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*r},e.prototype.widthOfString=function(t,r,i){var n,s,c,a;for(c=0,s=0,a=(t=""+t).length;0<=a?s<a:s>a;s=0<=a?++s:--s)n=t.charCodeAt(s),c+=this.widthOfGlyph(this.characterToGlyph(n))+i*(1e3/r)||0;return c*(r/1e3)},e.prototype.lineHeight=function(t,r){var i;return r==null&&(r=!1),i=r?this.lineGap:0,(this.ascender+i-this.decender)/1e3*t},e}();var Pc,Td=function(){function e(t){this.data=t??[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(t){return this.data[this.pos++]=t},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},e.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},e.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},e.prototype.readString=function(t){var r,i;for(i=[],r=0;0<=t?r<t:r>t;r=0<=t?++r:--r)i[r]=String.fromCharCode(this.readByte());return i.join("")},e.prototype.writeString=function(t){var r,i,n;for(n=[],r=0,i=t.length;0<=i?r<i:r>i;r=0<=i?++r:--r)n.push(this.writeByte(t.charCodeAt(r)));return n},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(t){return this.writeInt16(t)},e.prototype.readLongLong=function(){var t,r,i,n,s,c,a,p;return t=this.readByte(),r=this.readByte(),i=this.readByte(),n=this.readByte(),s=this.readByte(),c=this.readByte(),a=this.readByte(),p=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^r)+1099511627776*(255^i)+4294967296*(255^n)+16777216*(255^s)+65536*(255^c)+256*(255^a)+(255^p)+1):72057594037927940*t+281474976710656*r+1099511627776*i+4294967296*n+16777216*s+65536*c+256*a+p},e.prototype.writeLongLong=function(t){var r,i;return r=Math.floor(t/4294967296),i=4294967295&t,this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r),this.writeByte(i>>24&255),this.writeByte(i>>16&255),this.writeByte(i>>8&255),this.writeByte(255&i)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(t){return this.writeInt32(t)},e.prototype.read=function(t){var r,i;for(r=[],i=0;0<=t?i<t:i>t;i=0<=t?++i:--i)r.push(this.readByte());return r},e.prototype.write=function(t){var r,i,n,s;for(s=[],i=0,n=t.length;i<n;i++)r=t[i],s.push(this.writeByte(r));return s},e}(),yrt=function(){var e;function t(r){var i,n,s;for(this.scalarType=r.readInt(),this.tableCount=r.readShort(),this.searchRange=r.readShort(),this.entrySelector=r.readShort(),this.rangeShift=r.readShort(),this.tables={},n=0,s=this.tableCount;0<=s?n<s:n>s;n=0<=s?++n:--n)i={tag:r.readString(4),checksum:r.readInt(),offset:r.readInt(),length:r.readInt()},this.tables[i.tag]=i}return t.prototype.encode=function(r){var i,n,s,c,a,p,_,w,S,C,I,N,F;for(F in I=Object.keys(r).length,p=Math.log(2),S=16*Math.floor(Math.log(I)/p),c=Math.floor(S/p),w=16*I-S,(n=new Td).writeInt(this.scalarType),n.writeShort(I),n.writeShort(S),n.writeShort(c),n.writeShort(w),s=16*I,_=n.pos+s,a=null,N=[],r)for(C=r[F],n.writeString(F),n.writeInt(e(C)),n.writeInt(_),n.writeInt(C.length),N=N.concat(C),F==="head"&&(a=_),_+=C.length;_%4;)N.push(0),_++;return n.write(N),i=2981146554-e(n.data),n.pos=a+8,n.writeUInt32(i),n.data},e=function(r){var i,n,s,c;for(r=Zk.call(r);r.length%4;)r.push(0);for(s=new Td(r),n=0,i=0,c=r.length;i<c;i=i+=4)n+=s.readUInt32();return 4294967295&n},t}(),_rt={}.hasOwnProperty,Pu=function(e,t){for(var r in t)_rt.call(t,r)&&(e[r]=t[r]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};Pc=function(){function e(t){var r;this.file=t,r=this.file.directory.tables[this.tag],this.exists=!!r,r&&(this.offset=r.offset,this.length=r.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var vrt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Pu(t,Pc),t.prototype.tag="head",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.revision=r.readInt(),this.checkSumAdjustment=r.readInt(),this.magicNumber=r.readInt(),this.flags=r.readShort(),this.unitsPerEm=r.readShort(),this.created=r.readLongLong(),this.modified=r.readLongLong(),this.xMin=r.readShort(),this.yMin=r.readShort(),this.xMax=r.readShort(),this.yMax=r.readShort(),this.macStyle=r.readShort(),this.lowestRecPPEM=r.readShort(),this.fontDirectionHint=r.readShort(),this.indexToLocFormat=r.readShort(),this.glyphDataFormat=r.readShort()},t.prototype.encode=function(r){var i;return(i=new Td).writeInt(this.version),i.writeInt(this.revision),i.writeInt(this.checkSumAdjustment),i.writeInt(this.magicNumber),i.writeShort(this.flags),i.writeShort(this.unitsPerEm),i.writeLongLong(this.created),i.writeLongLong(this.modified),i.writeShort(this.xMin),i.writeShort(this.yMin),i.writeShort(this.xMax),i.writeShort(this.yMax),i.writeShort(this.macStyle),i.writeShort(this.lowestRecPPEM),i.writeShort(this.fontDirectionHint),i.writeShort(r),i.writeShort(this.glyphDataFormat),i.data},t}(),tL=function(){function e(t,r){var i,n,s,c,a,p,_,w,S,C,I,N,F,W,U,z,H;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=r+t.readInt(),S=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(p=0;p<256;++p)this.codeMap[p]=t.readByte();break;case 4:for(I=t.readUInt16(),C=I/2,t.pos+=6,s=function(){var nt,yt;for(yt=[],p=nt=0;0<=C?nt<C:nt>C;p=0<=C?++nt:--nt)yt.push(t.readUInt16());return yt}(),t.pos+=2,F=function(){var nt,yt;for(yt=[],p=nt=0;0<=C?nt<C:nt>C;p=0<=C?++nt:--nt)yt.push(t.readUInt16());return yt}(),_=function(){var nt,yt;for(yt=[],p=nt=0;0<=C?nt<C:nt>C;p=0<=C?++nt:--nt)yt.push(t.readUInt16());return yt}(),w=function(){var nt,yt;for(yt=[],p=nt=0;0<=C?nt<C:nt>C;p=0<=C?++nt:--nt)yt.push(t.readUInt16());return yt}(),n=(this.length-t.pos+this.offset)/2,a=function(){var nt,yt;for(yt=[],p=nt=0;0<=n?nt<n:nt>n;p=0<=n?++nt:--nt)yt.push(t.readUInt16());return yt}(),p=U=0,H=s.length;U<H;p=++U)for(W=s[p],i=z=N=F[p];N<=W?z<=W:z>=W;i=N<=W?++z:--z)w[p]===0?c=i+_[p]:(c=a[w[p]/2+(i-N)-(C-p)]||0)!==0&&(c+=_[p]),this.codeMap[i]=65535&c}t.pos=S}return e.encode=function(t,r){var i,n,s,c,a,p,_,w,S,C,I,N,F,W,U,z,H,nt,yt,bt,vt,mt,Dt,kt,at,dt,It,xt,re,ee,se,Ot,Xt,Wt,xe,it,Et,Pt,jt,qt,$t,Qt,Kt,Ee,Me,De;switch(xt=new Td,c=Object.keys(t).sort(function(ze,or){return ze-or}),r){case"macroman":for(F=0,W=function(){var ze=[];for(N=0;N<256;++N)ze.push(0);return ze}(),z={0:0},s={},re=0,Xt=c.length;re<Xt;re++)z[Kt=t[n=c[re]]]==null&&(z[Kt]=++F),s[n]={old:t[n],new:z[t[n]]},W[n]=z[t[n]];return xt.writeUInt16(1),xt.writeUInt16(0),xt.writeUInt32(12),xt.writeUInt16(0),xt.writeUInt16(262),xt.writeUInt16(0),xt.write(W),{charMap:s,subtable:xt.data,maxGlyphID:F+1};case"unicode":for(dt=[],S=[],H=0,z={},i={},U=_=null,ee=0,Wt=c.length;ee<Wt;ee++)z[yt=t[n=c[ee]]]==null&&(z[yt]=++H),i[n]={old:yt,new:z[yt]},a=z[yt]-n,U!=null&&a===_||(U&&S.push(U),dt.push(n),_=a),U=n;for(U&&S.push(U),S.push(65535),dt.push(65535),kt=2*(Dt=dt.length),mt=2*Math.pow(Math.log(Dt)/Math.LN2,2),C=Math.log(mt/2)/Math.LN2,vt=2*Dt-mt,p=[],bt=[],I=[],N=se=0,xe=dt.length;se<xe;N=++se){if(at=dt[N],w=S[N],at===65535){p.push(0),bt.push(0);break}if(at-(It=i[at].new)>=32768)for(p.push(0),bt.push(2*(I.length+Dt-N)),n=Ot=at;at<=w?Ot<=w:Ot>=w;n=at<=w?++Ot:--Ot)I.push(i[n].new);else p.push(It-at),bt.push(0)}for(xt.writeUInt16(3),xt.writeUInt16(1),xt.writeUInt32(12),xt.writeUInt16(4),xt.writeUInt16(16+8*Dt+2*I.length),xt.writeUInt16(0),xt.writeUInt16(kt),xt.writeUInt16(mt),xt.writeUInt16(C),xt.writeUInt16(vt),$t=0,it=S.length;$t<it;$t++)n=S[$t],xt.writeUInt16(n);for(xt.writeUInt16(0),Qt=0,Et=dt.length;Qt<Et;Qt++)n=dt[Qt],xt.writeUInt16(n);for(Ee=0,Pt=p.length;Ee<Pt;Ee++)a=p[Ee],xt.writeUInt16(a);for(Me=0,jt=bt.length;Me<jt;Me++)nt=bt[Me],xt.writeUInt16(nt);for(De=0,qt=I.length;De<qt;De++)F=I[De],xt.writeUInt16(F);return{charMap:i,subtable:xt.data,maxGlyphID:H+1}}},e}(),Xk=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Pu(t,Pc),t.prototype.tag="cmap",t.prototype.parse=function(r){var i,n,s;for(r.pos=this.offset,this.version=r.readUInt16(),s=r.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=s?n<s:n>s;n=0<=s?++n:--n)i=new tL(r,this.offset),this.tables.push(i),i.isUnicode&&this.unicode==null&&(this.unicode=i);return!0},t.encode=function(r,i){var n,s;return i==null&&(i="macroman"),n=tL.encode(r,i),(s=new Td).writeUInt16(0),s.writeUInt16(1),n.table=s.data.concat(n.subtable),n},t}(),brt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Pu(t,Pc),t.prototype.tag="hhea",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.ascender=r.readShort(),this.decender=r.readShort(),this.lineGap=r.readShort(),this.advanceWidthMax=r.readShort(),this.minLeftSideBearing=r.readShort(),this.minRightSideBearing=r.readShort(),this.xMaxExtent=r.readShort(),this.caretSlopeRise=r.readShort(),this.caretSlopeRun=r.readShort(),this.caretOffset=r.readShort(),r.pos+=8,this.metricDataFormat=r.readShort(),this.numberOfMetrics=r.readUInt16()},t}(),wrt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Pu(t,Pc),t.prototype.tag="OS/2",t.prototype.parse=function(r){if(r.pos=this.offset,this.version=r.readUInt16(),this.averageCharWidth=r.readShort(),this.weightClass=r.readUInt16(),this.widthClass=r.readUInt16(),this.type=r.readShort(),this.ySubscriptXSize=r.readShort(),this.ySubscriptYSize=r.readShort(),this.ySubscriptXOffset=r.readShort(),this.ySubscriptYOffset=r.readShort(),this.ySuperscriptXSize=r.readShort(),this.ySuperscriptYSize=r.readShort(),this.ySuperscriptXOffset=r.readShort(),this.ySuperscriptYOffset=r.readShort(),this.yStrikeoutSize=r.readShort(),this.yStrikeoutPosition=r.readShort(),this.familyClass=r.readShort(),this.panose=function(){var i,n;for(n=[],i=0;i<10;++i)n.push(r.readByte());return n}(),this.charRange=function(){var i,n;for(n=[],i=0;i<4;++i)n.push(r.readInt());return n}(),this.vendorID=r.readString(4),this.selection=r.readShort(),this.firstCharIndex=r.readShort(),this.lastCharIndex=r.readShort(),this.version>0&&(this.ascent=r.readShort(),this.descent=r.readShort(),this.lineGap=r.readShort(),this.winAscent=r.readShort(),this.winDescent=r.readShort(),this.codePageRange=function(){var i,n;for(n=[],i=0;i<2;i=++i)n.push(r.readInt());return n}(),this.version>1))return this.xHeight=r.readShort(),this.capHeight=r.readShort(),this.defaultChar=r.readShort(),this.breakChar=r.readShort(),this.maxContext=r.readShort()},t}(),xrt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Pu(t,Pc),t.prototype.tag="post",t.prototype.parse=function(r){var i,n,s;switch(r.pos=this.offset,this.format=r.readInt(),this.italicAngle=r.readInt(),this.underlinePosition=r.readShort(),this.underlineThickness=r.readShort(),this.isFixedPitch=r.readInt(),this.minMemType42=r.readInt(),this.maxMemType42=r.readInt(),this.minMemType1=r.readInt(),this.maxMemType1=r.readInt(),this.format){case 65536:break;case 131072:var c;for(n=r.readUInt16(),this.glyphNameIndex=[],c=0;0<=n?c<n:c>n;c=0<=n?++c:--c)this.glyphNameIndex.push(r.readUInt16());for(this.names=[],s=[];r.pos<this.offset+this.length;)i=r.readByte(),s.push(this.names.push(r.readString(i)));return s;case 151552:return n=r.readUInt16(),this.offsets=r.read(n);case 196608:break;case 262144:return this.map=(function(){var a,p,_;for(_=[],c=a=0,p=this.file.maxp.numGlyphs;0<=p?a<p:a>p;c=0<=p?++a:--a)_.push(r.readUInt32());return _}).call(this)}},t}(),Srt=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},Art=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Pu(t,Pc),t.prototype.tag="name",t.prototype.parse=function(r){var i,n,s,c,a,p,_,w,S,C,I;for(r.pos=this.offset,r.readShort(),i=r.readShort(),p=r.readShort(),n=[],c=0;0<=i?c<i:c>i;c=0<=i?++c:--c)n.push({platformID:r.readShort(),encodingID:r.readShort(),languageID:r.readShort(),nameID:r.readShort(),length:r.readShort(),offset:this.offset+p+r.readShort()});for(_={},c=S=0,C=n.length;S<C;c=++S)s=n[c],r.pos=s.offset,w=r.readString(s.length),a=new Srt(w,s),_[I=s.nameID]==null&&(_[I]=[]),_[s.nameID].push(a);this.strings=_,this.copyright=_[0],this.fontFamily=_[1],this.fontSubfamily=_[2],this.uniqueSubfamily=_[3],this.fontName=_[4],this.version=_[5];try{this.postscriptName=_[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=_[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=_[7],this.manufacturer=_[8],this.designer=_[9],this.description=_[10],this.vendorUrl=_[11],this.designerUrl=_[12],this.license=_[13],this.licenseUrl=_[14],this.preferredFamily=_[15],this.preferredSubfamily=_[17],this.compatibleFull=_[18],this.sampleText=_[19]},t}(),Ert=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Pu(t,Pc),t.prototype.tag="maxp",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.numGlyphs=r.readUInt16(),this.maxPoints=r.readUInt16(),this.maxContours=r.readUInt16(),this.maxCompositePoints=r.readUInt16(),this.maxComponentContours=r.readUInt16(),this.maxZones=r.readUInt16(),this.maxTwilightPoints=r.readUInt16(),this.maxStorage=r.readUInt16(),this.maxFunctionDefs=r.readUInt16(),this.maxInstructionDefs=r.readUInt16(),this.maxStackElements=r.readUInt16(),this.maxSizeOfInstructions=r.readUInt16(),this.maxComponentElements=r.readUInt16(),this.maxComponentDepth=r.readUInt16()},t}(),Trt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Pu(t,Pc),t.prototype.tag="hmtx",t.prototype.parse=function(r){var i,n,s,c,a,p,_;for(r.pos=this.offset,this.metrics=[],i=0,p=this.file.hhea.numberOfMetrics;0<=p?i<p:i>p;i=0<=p?++i:--i)this.metrics.push({advance:r.readUInt16(),lsb:r.readInt16()});for(s=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var w,S;for(S=[],i=w=0;0<=s?w<s:w>s;i=0<=s?++w:--w)S.push(r.readInt16());return S}(),this.widths=(function(){var w,S,C,I;for(I=[],w=0,S=(C=this.metrics).length;w<S;w++)c=C[w],I.push(c.advance);return I}).call(this),n=this.widths[this.widths.length-1],_=[],i=a=0;0<=s?a<s:a>s;i=0<=s?++a:--a)_.push(this.widths.push(n));return _},t.prototype.forGlyph=function(r){return r in this.metrics?this.metrics[r]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[r-this.metrics.length]}},t}(),Zk=[].slice,Crt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Pu(t,Pc),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(r){var i,n,s,c,a,p,_,w,S,C;return r in this.cache?this.cache[r]:(c=this.file.loca,i=this.file.contents,n=c.indexOf(r),(s=c.lengthOf(r))===0?this.cache[r]=null:(i.pos=this.offset+n,a=(p=new Td(i.read(s))).readShort(),w=p.readShort(),C=p.readShort(),_=p.readShort(),S=p.readShort(),this.cache[r]=a===-1?new Irt(p,w,C,_,S):new Prt(p,a,w,C,_,S),this.cache[r]))},t.prototype.encode=function(r,i,n){var s,c,a,p,_;for(a=[],c=[],p=0,_=i.length;p<_;p++)s=r[i[p]],c.push(a.length),s&&(a=a.concat(s.encode(n)));return c.push(a.length),{table:a,offsets:c}},t}(),Prt=function(){function e(t,r,i,n,s,c){this.raw=t,this.numberOfContours=r,this.xMin=i,this.yMin=n,this.xMax=s,this.yMax=c,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),Irt=function(){function e(t,r,i,n,s){var c,a;for(this.raw=t,this.xMin=r,this.yMin=i,this.xMax=n,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],c=this.raw;a=c.readShort(),this.glyphOffsets.push(c.pos),this.glyphIDs.push(c.readUInt16()),32&a;)c.pos+=1&a?4:2,128&a?c.pos+=8:64&a?c.pos+=4:8&a&&(c.pos+=2)}return e.prototype.encode=function(){var t,r,i;for(r=new Td(Zk.call(this.raw.data)),t=0,i=this.glyphIDs.length;t<i;++t)r.pos=this.glyphOffsets[t];return r.data},e}(),Lrt=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Pu(t,Pc),t.prototype.tag="loca",t.prototype.parse=function(r){var i,n;return r.pos=this.offset,i=this.file.head.indexToLocFormat,this.offsets=i===0?(function(){var s,c;for(c=[],n=0,s=this.length;n<s;n+=2)c.push(2*r.readUInt16());return c}).call(this):(function(){var s,c;for(c=[],n=0,s=this.length;n<s;n+=4)c.push(r.readUInt32());return c}).call(this)},t.prototype.indexOf=function(r){return this.offsets[r]},t.prototype.lengthOf=function(r){return this.offsets[r+1]-this.offsets[r]},t.prototype.encode=function(r,i){for(var n=new Uint32Array(this.offsets.length),s=0,c=0,a=0;a<n.length;++a)if(n[a]=s,c<i.length&&i[c]==a){++c,n[a]=s;var p=this.offsets[a],_=this.offsets[a+1]-p;_>0&&(s+=_)}for(var w=new Array(4*n.length),S=0;S<n.length;++S)w[4*S+3]=255&n[S],w[4*S+2]=(65280&n[S])>>8,w[4*S+1]=(16711680&n[S])>>16,w[4*S]=(4278190080&n[S])>>24;return w},t}(),Mrt=function(){function e(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var t,r,i,n,s;for(r in n=this.font.cmap.tables[0].codeMap,t={},s=this.subset)i=s[r],t[r]=n[i];return t},e.prototype.glyphsFor=function(t){var r,i,n,s,c,a,p;for(n={},c=0,a=t.length;c<a;c++)n[s=t[c]]=this.font.glyf.glyphFor(s);for(s in r=[],n)(i=n[s])!=null&&i.compound&&r.push.apply(r,i.glyphIDs);if(r.length>0)for(s in p=this.glyphsFor(r))i=p[s],n[s]=i;return n},e.prototype.encode=function(t,r){var i,n,s,c,a,p,_,w,S,C,I,N,F,W,U;for(n in i=Xk.encode(this.generateCmap(),"unicode"),c=this.glyphsFor(t),I={0:0},U=i.charMap)I[(p=U[n]).old]=p.new;for(N in C=i.maxGlyphID,c)N in I||(I[N]=C++);return w=function(z){var H,nt;for(H in nt={},z)nt[z[H]]=H;return nt}(I),S=Object.keys(w).sort(function(z,H){return z-H}),F=function(){var z,H,nt;for(nt=[],z=0,H=S.length;z<H;z++)a=S[z],nt.push(w[a]);return nt}(),s=this.font.glyf.encode(c,F,I),_=this.font.loca.encode(s.offsets,F),W={cmap:this.font.cmap.raw(),glyf:s.table,loca:_,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(r)},this.font.os2.exists&&(W["OS/2"]=this.font.os2.raw()),this.font.directory.encode(W)},e}();kr.API.PDFObject=function(){var e;function t(){}return e=function(r,i){return(Array(i+1).join("0")+r).slice(-i)},t.convert=function(r){var i,n,s,c;if(Array.isArray(r))return"["+function(){var a,p,_;for(_=[],a=0,p=r.length;a<p;a++)i=r[a],_.push(t.convert(i));return _}().join(" ")+"]";if(typeof r=="string")return"/"+r;if(r!=null&&r.isString)return"("+r+")";if(r instanceof Date)return"(D:"+e(r.getUTCFullYear(),4)+e(r.getUTCMonth(),2)+e(r.getUTCDate(),2)+e(r.getUTCHours(),2)+e(r.getUTCMinutes(),2)+e(r.getUTCSeconds(),2)+"Z)";if({}.toString.call(r)==="[object Object]"){for(n in s=["<<"],r)c=r[n],s.push("/"+n+" "+t.convert(c));return s.push(">>"),s.join(`
`)}return""+r},t}();const S3={"circle-radius":8,"circle-color":"red","circle-stroke-width":1,"circle-stroke-color":"black"},A3={textSize:16,textHaloColor:"#FFFFFF",textHaloWidth:.8,textColor:"#000000",fallbackTextFont:["Open Sans Regular"]};class Brt{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gp.A4,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:nh.PNG,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Am.mm,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:"maplibregl-marker",p=arguments.length>7&&arguments[7]!==void 0?arguments[7]:S3,_=arguments.length>8&&arguments[8]!==void 0?arguments[8]:"maplibregl-ctrl-attrib-inner",w=arguments.length>9&&arguments[9]!==void 0?arguments[9]:A3;vi(this,"map"),vi(this,"width"),vi(this,"height"),vi(this,"dpi"),vi(this,"format"),vi(this,"unit"),vi(this,"fileName"),vi(this,"markerClassName"),vi(this,"markerCirclePaint"),vi(this,"attributionClassName"),vi(this,"attributionStyle"),this.map=t,this.width=r[0],this.height=r[1],this.dpi=i,this.format=n,this.unit=s,this.fileName=c,this.markerClassName=a,this.markerCirclePaint=p,this.attributionClassName=_,this.attributionStyle=w}renderMapPost(t){return t}getMarkers(){return this.map.getCanvasContainer().getElementsByClassName(this.markerClassName)}renderMarkers(t){const r=this.getMarkers();for(let i=0;i<r.length;i++){const n=r.item(i);if(!n)continue;const s=n.getAttribute("style");if(!s)continue;const c=/translate\(([^,]+)px,\s*([^,]+)px\)/,a=s.match(c);if(!a)continue;const p=parseInt(a[1]),_=parseInt(a[2]),w=this.map.unproject([p,_]),S=`point${i}`;t.addSource(S,{type:"geojson",data:{type:"Point",coordinates:[w.lng,w.lat]}}),t.addLayer({id:S,source:S,type:"circle",paint:this.markerCirclePaint})}return t}generate(){const t=this;JsLoadingOverlay.show({overlayBackgroundColor:"#5D5959",overlayOpacity:"0.6",spinnerIcon:"ball-spin",spinnerColor:"#2400FD",spinnerSize:"2x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetX:0,offsetY:0,containerID:null,lockScroll:!1,overlayZIndex:9998,spinnerZIndex:9999});const r=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return t.dpi/96}});const i=document.createElement("div");i.className="hidden-map",document.body.appendChild(i);const n=document.createElement("div");n.style.width=this.toPixels(this.width),n.style.height=this.toPixels(this.height),i.appendChild(n);const s=this.map.getStyle();if(s&&s.sources){const a=s.sources;Object.keys(a).forEach(p=>{const _=a[p];Object.keys(_).forEach(w=>{_[w]||delete _[w]})})}let c=this.getRenderedMap(n,s);c.once("idle",()=>{this.addAttributions(c)?c.once("idle",()=>{c=this.renderMapPost(c),this.getMarkers().length===0?this.exportImage(c,i,r):(c=this.renderMarkers(c),c.once("idle",()=>{this.exportImage(c,i,r)}))}):(c=this.renderMapPost(c),this.getMarkers().length===0?this.exportImage(c,i,r):(c=this.renderMarkers(c),c.once("idle",()=>{this.exportImage(c,i,r)})))})}stripHtml(t){const r=document.createElement("div");return r.innerHTML=t,r.textContent||r.innerText||""}addAttributions(t){if(!this.map.getStyle().glyphs)return!1;const r=t.getContainer(),i=parseInt(r.style.width.replace("px",""))-5,n=parseInt(r.style.height.replace("px",""))-5,s=[i,n],c=t.unproject(s),a=r.getElementsByClassName(this.attributionClassName),p=[];if((a==null?void 0:a.length)>0){const I=a.item(0);if(I)for(let N=0;N<I.children.length;N++){const F=I.children.item(N);F&&p.push(this.stripHtml(F.outerHTML))}}else{const I=this.map.getStyle().sources;Object.keys(I).forEach(N=>{const F=I[N];if("attribution"in F){const W=F.attribution;p.push(this.stripHtml(W))}})}if(p.length===0)return!1;const _=p.join(" | "),w="attribution";t.addSource(w,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[c.lng,c.lat]},properties:{attribution:_}}});const S=this.map.getStyle().layers.filter(I=>I.type==="symbol"&&I.layout&&"text-font"in I.layout),C=S.length>0&&S[0].layout?S[0].layout["text-font"]:this.attributionStyle.fallbackTextFont;return t.addLayer({id:w,source:w,type:"symbol",layout:{"text-field":["get","attribution"],"text-font":C,"text-max-width":parseInt(`${i/this.attributionStyle.textSize}`),"text-anchor":"bottom-right","text-justify":"right","text-size":this.attributionStyle.textSize},paint:{"text-halo-color":this.attributionStyle.textHaloColor,"text-halo-width":this.attributionStyle.textHaloWidth,"text-color":this.attributionStyle.textColor}}),!0}exportImage(t,r,i){var n;const s=t.getCanvas(),c=`${this.fileName}.${this.format}`;switch(this.format){case nh.PNG:this.toPNG(s,c);break;case nh.JPEG:this.toJPEG(s,c);break;case nh.PDF:this.toPDF(t,c);break;case nh.SVG:this.toSVG(s,c);break;default:console.error(`Invalid file format: ${this.format}`);break}t.remove(),(n=r.parentNode)==null||n.removeChild(r),Object.defineProperty(window,"devicePixelRatio",{get(){return i}}),r.remove(),JsLoadingOverlay.hide()}toPNG(t,r){const i=document.createElement("a");i.href=t.toDataURL(),i.download=r,i.click(),i.remove()}toJPEG(t,r){const i=t.toDataURL("image/jpeg",.85),n=document.createElement("a");n.href=i,n.download=r,n.click(),n.remove()}toPDF(t,r){const i=t.getCanvas(),n=new kr({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});n.addImage(i.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:s,lat:c}=t.getCenter();n.setProperties({title:t.getStyle().name,subject:`center: [${s}, ${c}], zoom: ${t.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),n.save(r)}toSVG(t,r){const i=t.toDataURL("image/png"),n=Number(this.toPixels(this.width,this.dpi).replace("px","")),s=Number(this.toPixels(this.height,this.dpi).replace("px","")),c=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${n}" 
      height="${s}" 
      viewBox="0 0 ${n} ${s}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${i}" width="${n}" height="${s}"></image>
    </svg>`,a=document.createElement("a");a.href=`data:application/xml,${encodeURIComponent(c)}`,a.download=r,a.click(),a.remove()}toPixels(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===Am.mm&&(r/=25.4),`${r*t}px`}}class krt extends Brt{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gp.A4,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:nh.PNG,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Am.mm,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:S3,p=arguments.length>7&&arguments[7]!==void 0?arguments[7]:A3;super(t,r,i,n,s,c,"maplibregl-marker",a,"maplibregl-ctrl-attrib-inner",p)}getRenderedMap(t,r){const i=new DM.Map({container:t,style:r,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,transformRequest:this.map._requestManager._transformRequestFn});this.map.getTerrain()&&(i.setMaxPitch(85),i.setPitch(this.map.getPitch()));const n=(this.map.style.imageManager||{}).images||[];return Object.keys(n).forEach(s=>{i.addImage(s,n[s].data)}),i}renderMapPost(t){const r=this.map.getTerrain();return r&&t.setTerrain({source:r.source,exaggeration:r.exaggeration}),t}}class Rrt{constructor(t){vi(this,"controlContainer"),vi(this,"exportContainer"),vi(this,"crosshair"),vi(this,"printableArea"),vi(this,"map"),vi(this,"exportButton"),vi(this,"options",{PageSize:gp.A4,PageOrientation:jg.Landscape,Format:nh.PDF,DPI:Vx[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(gp),Filename:"map",markerCirclePaint:S3,attributionStyle:A3}),vi(this,"MAPLIB_CSS_PREFIX","maplibregl"),t&&(this.options=Object.assign(this.options,t)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){const t=this.options.Local??"en";return Fet(t)}onAdd(t){var r;this.map=t,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl`),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-group`),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-list`),this.exportButton=document.createElement("button"),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-icon`),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-control`),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const i=document.createElement("TABLE");i.className="print-table";const n={};(r=this.options.AllowedSizes)==null||r.forEach(w=>{gp[w]&&(n[w]=gp[w])});const s=this.createSelection(n,this.getTranslation().PageSize,"page-size",this.options.PageSize,(w,S)=>JSON.stringify(w[S]));i.appendChild(s);const c=this.createSelection(jg,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(w,S)=>w[S]);i.appendChild(c);const a=this.createSelection(nh,this.getTranslation().Format,"format-type",this.options.Format,(w,S)=>w[S]);i.appendChild(a);const p=this.createSelection(Vx,this.getTranslation().DPI,"dpi-type",this.options.DPI,(w,S)=>w[S]);i.appendChild(p),this.exportContainer.appendChild(i);const _=document.createElement("button");return _.type="button",_.textContent=this.getTranslation().Generate,_.classList.add("generate-button"),_.addEventListener("click",()=>{const w=document.getElementById("mapbox-gl-export-page-size"),S=document.getElementById("mapbox-gl-export-page-orientation"),C=document.getElementById("mapbox-gl-export-format-type"),I=document.getElementById("mapbox-gl-export-dpi-type"),N=S.value;let F=JSON.parse(w.value);N===jg.Portrait&&(F=F.reverse()),this.generateMap(t,F,Number(I.value),C.value,Am.mm,this.options.Filename)}),this.exportContainer.appendChild(_),this.controlContainer}generateMap(t,r,i,n,s,c){new krt(t,r,i,n,s,c,this.options.markerCirclePaint,this.options.attributionStyle).generate()}createSelection(t,r,i,n,s){const c=document.createElement("label");c.textContent=r;const a=document.createElement("select");a.setAttribute("id",`mapbox-gl-export-${i}`),a.style.width="100%",Object.keys(t).forEach(S=>{const C=document.createElement("option");C.setAttribute("value",s(t,S)),C.appendChild(document.createTextNode(S)),C.setAttribute("name",i),n===t[S]&&(C.selected=!0),a.appendChild(C)}),a.addEventListener("change",()=>{this.updatePrintableArea()});const p=document.createElement("TR"),_=document.createElement("TD"),w=document.createElement("TD");return _.appendChild(c),w.appendChild(a),p.appendChild(_),p.appendChild(w),p}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0),this.map=void 0)}onDocumentClick(t){this.controlContainer&&!this.controlContainer.contains(t.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(t){this.options.Crosshair===!0&&(t===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new vet(this.map),this.crosshair.create()))}togglePrintableArea(t){this.options.PrintableArea===!0&&(t===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new bet(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const t=document.getElementById("mapbox-gl-export-page-size"),r=document.getElementById("mapbox-gl-export-page-orientation").value;let i=JSON.parse(t.value);r===jg.Portrait&&(i=i.reverse()),this.printableArea.updateArea(i[0],i[1])}}var Yk=Drt,Frt=Object.prototype.hasOwnProperty;function Drt(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var i in r)Frt.call(r,i)&&(e[i]=r[i])}return e}var Jk={exports:{}};(function(e,t){(function(){var r={};e.exports=r,r.simpleFilter=function(i,n){return n.filter(function(s){return r.test(i,s)})},r.test=function(i,n){return r.match(i,n)!==null},r.match=function(i,n,s){s=s||{};var c=0,a=[],p=n.length,_=0,w=0,S=s.pre||"",C=s.post||"",I=s.caseSensitive&&n||n.toLowerCase(),N;i=s.caseSensitive&&i||i.toLowerCase();for(var F=0;F<p;F++)N=n[F],I[F]===i[c]?(N=S+N+C,c+=1,w+=1+w):w=0,_+=w,a[a.length]=N;return c===i.length?(_=I===i?1/0:_,{rendered:a.join(""),score:_}):null},r.filter=function(i,n,s){return!n||n.length===0?[]:typeof i!="string"?n:(s=s||{},n.reduce(function(c,a,p,_){var w=a;s.extract&&(w=s.extract(a));var S=r.match(i,w,s);return S!=null&&(c[c.length]={string:S.rendered,score:S.score,index:p,original:a}),c},[]).sort(function(c,a){var p=a.score-c.score;return p||c.index-a.index}))}})()})(Jk);var Nrt=Jk.exports,Ia=function(e){return this.component=e,this.items=[],this.active=e.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};Ia.prototype.show=function(){this.element.style.display="block"};Ia.prototype.hide=function(){this.element.style.display="none"};Ia.prototype.add=function(e){this.items.push(e)};Ia.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0};Ia.prototype.isEmpty=function(){return!this.items.length};Ia.prototype.isVisible=function(){return this.element.style.display==="block"};Ia.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()};Ia.prototype.drawItem=function(e,t){var r=document.createElement("li"),i=document.createElement("a");t&&(r.className+=" active"),i.innerHTML=e.string,r.appendChild(i),this.element.appendChild(r),r.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),r.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,e)}).bind(this))};Ia.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()};Ia.prototype.move=function(e){this.active=e,this.draw()};Ia.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)};Ia.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)};Ia.prototype.drawError=function(e){var t=document.createElement("li");t.innerHTML=e,this.element.appendChild(t),this.show()};var Ort=Ia,zrt=Yk,jrt=Nrt,Urt=Ort,Mo=function(e,t,r){return r=r||{},this.options=zrt({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},r),this.el=e,this.data=t||[],this.list=new Urt(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(i){this.handleKeyUp(i.keyCode,i)}).bind(this),!1),this.el.addEventListener("keydown",(function(i){this.handleKeyDown(i)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(i){this.handlePaste(i)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Mo.prototype.handleKeyUp=function(e,t){if(!(e===40||e===38||e===27||e===9)){if(e===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),t.stopPropagation());return}this.handleInputChange(this.el.value)}};Mo.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Mo.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Mo.prototype.handlePaste=function(e){if(e.clipboardData)this.handleInputChange(e.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(e.target.value)},100)}};Mo.prototype.handleInputChange=function(e){if(this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(t){for(var r=0;r<t.length&&(this.list.add(t[r]),r!==this.options.limit-1);r++);this.list.draw()}).bind(this))};Mo.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Mo.prototype.update=function(e){this.data=e,this.handleKeyUp()};Mo.prototype.clear=function(){this.data=[],this.list.clear()};Mo.prototype.normalize=function(e){return e=e.toLowerCase(),e};Mo.prototype.match=function(e,t){return e.indexOf(t)>-1};Mo.prototype.value=function(e){if(this.selected=e,this.el.value=this.getItemValue(e||{place_name:this.query}),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")};Mo.prototype.getCandidates=function(e){var t={pre:"<strong>",post:"</strong>",extract:(function(i){return this.getItemValue(i)}).bind(this)},r;this.options.filter?(r=jrt.filter(this.query,this.data,t),r=r.map((function(i){return{original:i.original,string:this.render(i.original,i.string)}}).bind(this))):r=this.data.map((function(i){var n=this.render(i);return{original:i,string:n}}).bind(this)),e(r)};Mo.prototype.getItemValue=function(e){return e};Mo.prototype.render=function(e,t){if(t)return t;for(var r=e.original?this.getItemValue(e.original):this.getItemValue(e),i=this.normalize(r),n=i.lastIndexOf(this.query);n>-1;){var s=n+this.query.length;r=r.slice(0,n)+"<strong>"+r.slice(n,s)+"</strong>"+r.slice(s),n=i.slice(0,n).lastIndexOf(this.query)}return r};Mo.prototype.renderError=function(e){this.list.drawError(e)};var Grt=Mo,Kk=Grt,Vrt=Kk;typeof window<"u"&&(window.Suggestions=Kk);var qrt="Expected a function",eL=NaN,Hrt="[object Symbol]",$rt=/^\s+|\s+$/g,Wrt=/^[-+]0x[0-9a-f]+$/i,Xrt=/^0b[01]+$/i,Zrt=/^0o[0-7]+$/i,Yrt=parseInt,Jrt=typeof Of=="object"&&Of&&Of.Object===Object&&Of,Krt=typeof self=="object"&&self&&self.Object===Object&&self,Qrt=Jrt||Krt||Function("return this")(),tit=Object.prototype,eit=tit.toString,rit=Math.max,iit=Math.min,K2=function(){return Qrt.Date.now()};function nit(e,t,r){var i,n,s,c,a,p,_=0,w=!1,S=!1,C=!0;if(typeof e!="function")throw new TypeError(qrt);t=rL(t)||0,r5(r)&&(w=!!r.leading,S="maxWait"in r,s=S?rit(rL(r.maxWait)||0,t):s,C="trailing"in r?!!r.trailing:C);function I(bt){var vt=i,mt=n;return i=n=void 0,_=bt,c=e.apply(mt,vt),c}function N(bt){return _=bt,a=setTimeout(U,t),w?I(bt):c}function F(bt){var vt=bt-p,mt=bt-_,Dt=t-vt;return S?iit(Dt,s-mt):Dt}function W(bt){var vt=bt-p,mt=bt-_;return p===void 0||vt>=t||vt<0||S&&mt>=s}function U(){var bt=K2();if(W(bt))return z(bt);a=setTimeout(U,F(bt))}function z(bt){return a=void 0,C&&i?I(bt):(i=n=void 0,c)}function H(){a!==void 0&&clearTimeout(a),_=0,i=p=n=a=void 0}function nt(){return a===void 0?c:z(K2())}function yt(){var bt=K2(),vt=W(bt);if(i=arguments,n=this,p=bt,vt){if(a===void 0)return N(p);if(S)return a=setTimeout(U,t),I(p)}return a===void 0&&(a=setTimeout(U,t)),c}return yt.cancel=H,yt.flush=nt,yt}function r5(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function sit(e){return!!e&&typeof e=="object"}function oit(e){return typeof e=="symbol"||sit(e)&&eit.call(e)==Hrt}function rL(e){if(typeof e=="number")return e;if(oit(e))return eL;if(r5(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=r5(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace($rt,"");var r=Xrt.test(e);return r||Zrt.test(e)?Yrt(e.slice(2),r?2:8):Wrt.test(e)?eL:+e}var ait=nit,E3={exports:{}},sm=typeof Reflect=="object"?Reflect:null,iL=sm&&typeof sm.apply=="function"?sm.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},$y;sm&&typeof sm.ownKeys=="function"?$y=sm.ownKeys:Object.getOwnPropertySymbols?$y=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:$y=function(e){return Object.getOwnPropertyNames(e)};function lit(e){console&&console.warn&&console.warn(e)}var Qk=Number.isNaN||function(e){return e!==e};function Xi(){Xi.init.call(this)}E3.exports=Xi;E3.exports.once=dit;Xi.EventEmitter=Xi;Xi.prototype._events=void 0;Xi.prototype._eventsCount=0;Xi.prototype._maxListeners=void 0;var nL=10;function Av(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(Xi,"defaultMaxListeners",{enumerable:!0,get:function(){return nL},set:function(e){if(typeof e!="number"||e<0||Qk(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");nL=e}});Xi.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Xi.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Qk(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function tR(e){return e._maxListeners===void 0?Xi.defaultMaxListeners:e._maxListeners}Xi.prototype.getMaxListeners=function(){return tR(this)};Xi.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i=e==="error",n=this._events;if(n!==void 0)i=i&&n.error===void 0;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var c=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw c.context=s,c}var a=n[e];if(a===void 0)return!1;if(typeof a=="function")iL(a,this,t);else for(var p=a.length,_=sR(a,p),r=0;r<p;++r)iL(_[r],this,t);return!0};function eR(e,t,r,i){var n,s,c;if(Av(r),s=e._events,s===void 0?(s=e._events=Object.create(null),e._eventsCount=0):(s.newListener!==void 0&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),c=s[t]),c===void 0)c=s[t]=r,++e._eventsCount;else if(typeof c=="function"?c=s[t]=i?[r,c]:[c,r]:i?c.unshift(r):c.push(r),n=tR(e),n>0&&c.length>n&&!c.warned){c.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=c.length,lit(a)}return e}Xi.prototype.addListener=function(e,t){return eR(this,e,t,!1)};Xi.prototype.on=Xi.prototype.addListener;Xi.prototype.prependListener=function(e,t){return eR(this,e,t,!0)};function cit(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function rR(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=cit.bind(i);return n.listener=r,i.wrapFn=n,n}Xi.prototype.once=function(e,t){return Av(t),this.on(e,rR(this,e,t)),this};Xi.prototype.prependOnceListener=function(e,t){return Av(t),this.prependListener(e,rR(this,e,t)),this};Xi.prototype.removeListener=function(e,t){var r,i,n,s,c;if(Av(t),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){c=r[s].listener,n=s;break}if(n<0)return this;n===0?r.shift():uit(r,n),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,c||t)}return this};Xi.prototype.off=Xi.prototype.removeListener;Xi.prototype.removeAllListeners=function(e){var t,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var n=Object.keys(r),s;for(i=0;i<n.length;++i)s=n[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function iR(e,t,r){var i=e._events;if(i===void 0)return[];var n=i[t];return n===void 0?[]:typeof n=="function"?r?[n.listener||n]:[n]:r?hit(n):sR(n,n.length)}Xi.prototype.listeners=function(e){return iR(this,e,!0)};Xi.prototype.rawListeners=function(e){return iR(this,e,!1)};Xi.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):nR.call(e,t)};Xi.prototype.listenerCount=nR;function nR(e){var t=this._events;if(t!==void 0){var r=t[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Xi.prototype.eventNames=function(){return this._eventsCount>0?$y(this._events):[]};function sR(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}function uit(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function hit(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function dit(e,t){return new Promise(function(r,i){function n(c){e.removeListener(t,s),i(c)}function s(){typeof e.removeListener=="function"&&e.removeListener("error",n),r([].slice.call(arguments))}oR(e,t,s,{once:!0}),t!=="error"&&pit(e,n,{once:!0})})}function pit(e,t,r){typeof e.on=="function"&&oR(e,"error",t,r)}function oR(e,t,r,i){if(typeof e.on=="function")i.once?e.once(t,r):e.on(t,r);else if(typeof e.addEventListener=="function")e.addEventListener(t,function n(s){i.once&&e.removeEventListener(t,n),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var aR=E3.exports,fit={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},mit={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},git={placeholder:mit},lR={exports:{}};(function(e){(function(t,r,i){e.exports?e.exports=i():t[r]=i()})(Of,"subtag",function(){var t="",r=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function i(p){return p.match(r)||[]}function n(p){return i(p).filter(function(_,w){return _&&w})}function s(p){return p=i(p),{language:p[1]||t,extlang:p[2]||t,script:p[3]||t,region:p[4]||t}}function c(p,_,w){Object.defineProperty(p,_,{value:w,enumerable:!0})}function a(p,_,w){function S(C){return i(C)[p]||t}c(S,"pattern",_),c(s,w,S)}return a(1,/^[a-zA-Z]{2,3}$/,"language"),a(2,/^[a-zA-Z]{3}$/,"extlang"),a(3,/^[a-zA-Z]{4}$/,"script"),a(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),c(s,"split",n),s})})(lR);var yit=lR.exports,_it=Vrt,vit=ait,Ka=Yk,bit=aR.EventEmitter,sL=fit,wit=git,xit=yit;function cR(e,t){this._eventEmitter=new bit,this.options=Ka({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geocoderApi=e}cR.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(e){return e.text!==void 0?e.text:e.place_name},render:function(e){if(e.geometry){var t=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--result maplibregl-ctrl-geocoder--result"><svg class="mapboxgl-ctrl-geocoder--result-icon maplibre-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="mapboxgl-ctrl-geocoder--result-title maplibregl-ctrl-geocoder--result-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--result-address maplibregl-ctrl-geocoder--result-address">'+t.splice(1,t.length).join(",")+"</div></div></div>"}else{var r=e.text,i=r.toLowerCase().indexOf(this.query.toLowerCase()),n=this.query.length,s=r.substring(0,i),c=r.substring(i,i+n),a=r.substring(i+n);return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibregl-ctrl-geocoder--suggestion"><svg class="mapboxgl-ctrl-geocoder--suggestion-icon maplibre-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="mapboxgl-ctrl-geocoder--suggestion-info maplibregl-ctrl-geocoder--suggestion-info"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibregl-ctrl-geocoder--suggestion-title">'+s+'<span class="mapboxgl-ctrl-geocoder--suggestion-match maplibregl-ctrl-geocoder--suggestion-match">'+c+"</span>"+a+"</div></div></div>"}},popupRender:function(e){var t=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibre-ctrl-geocoder--suggestion popup-suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibre-ctrl-geocoder--suggestion-title popup-suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address maplibre-ctrl-geocoder--suggestion-address popup-suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},addTo:function(e){function t(i,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var s=i.onAdd();n.appendChild(s)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)t(this,e);else if(typeof e=="string"){var r=document.querySelectorAll(e);if(r.length===0)throw new Error("Element ",e,"not found.");if(r.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,r[0])}else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";var r=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",vit(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);var i=document.createElement("div");i.classList.add("mapboxgl-ctrl-geocoder--pin-right","maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button maplibregl-ctrl-geocoder--button";var n=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(n),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),i.appendChild(this._clearEl),i.appendChild(this._loadingEl),t.appendChild(r),t.appendChild(this._inputEl),t.appendChild(i),this._typeahead=new _it(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),t},createIcon:function(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");if(r.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e+" maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+e),r.setAttribute("viewBox","0 0 18 18"),r.setAttribute("xml:space","preserve"),r.setAttribute("width",18),r.setAttribute("height",18),"innerHTML"in r)r.innerHTML=t;else{var i=document.createElement("div");i.innerHTML="<svg>"+t.valueOf().toString()+"</svg>";var n=i.firstChild,s=n.firstChild;r.appendChild(s)}return r},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(e){var t=(e.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(t)},_onKeyDown:function(e){var t=27,r=9;if(e.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var i=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target,n=i?i.value:"";if(!n)return this.fresh=!0,e.keyCode!==r&&this.clear(e),this._clearEl.style.display="none";if(!(e.metaKey||[r,t,37,39,38,40].indexOf(e.keyCode)!==-1)){if(e.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(i.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(i.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}i.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(i.value)}},_showButton:function(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;if(e&&!e.geometry)e.placeId?this._geocode(e.placeId,!0,!0):this._geocode(e.text,!0);else if(e&&JSON.stringify(e)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var t;if(this._removeResultMarkers(),e.properties&&sL[e.properties.short_code])t=Ka({},this.options.flyTo),this._map&&this._map.fitBounds(sL[e.properties.short_code].bbox,t);else if(e.bbox){var r=e.bbox;t=Ka({},this.options.flyTo),this._map&&this._map.fitBounds([[r[0],r[1]],[r[2],r[3]]],t)}else{var i={zoom:this.options.zoom};t=Ka({},i,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t)}}this.options.marker&&this._maplibregl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:e})}},_getConfigForRequest:function(){var e=["bbox","limit","proximity","countries","types","language","reverseMode"],t=this,r=e.reduce(function(i,n){return t.options[n]&&(["countries","types","language"].indexOf(n)>-1?i[n]=t.options[n].split(/[\s,]+/):i[n]=t.options[n],n==="proximity"&&t.options[n]&&typeof t.options[n].longitude=="number"&&typeof t.options[n].latitude=="number"&&(i[n]=[t.options[n].longitude,t.options[n].latitude])),i},{});return r},_geocode:function(e,t,r){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:e}),this.inputString=e;var i=null,n=this._getConfigForRequest(),s;if(this.options.localGeocoderOnly)s=Promise.resolve();else if(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(e)){var c=e.split(/[\s(,)?]+/).map(function(_){return parseFloat(_,10)}).reverse();n.types&&n.types[0],n=Ka(n,{query:c,limit:1}),"proximity"in n&&delete n.proximity,s=this.geocoderApi.reverseGeocode(n)}else n=Ka(n,{query:e}),this.geocoderApi.getSuggestions?t?this.geocoderApi.searchByPlaceId&&r?s=this.geocoderApi.searchByPlaceId(n):s=this.geocoderApi.forwardGeocode(n):s=this.geocoderApi.getSuggestions(n):s=this.geocoderApi.forwardGeocode(n);var a=[];this.options.localGeocoder&&(a=this.options.localGeocoder(e),a||(a=[]));var p=[];return s.catch((function(_){i=_}).bind(this)).then((function(_){this._loadingEl.style.display="none";var w={};return _?w=_:w={type:"FeatureCollection",features:[]},w.config=n,this.fresh&&(this.fresh=!1),w.features=w.features?a.concat(w.features):a,this.options.externalGeocoder?(p=this.options.externalGeocoder(e,w.features,n)||[],p.then(function(S){return w.features=w.features?S.concat(w.features):S,w},function(){return w})):w}).bind(this)).then((function(_){if(i)throw i;this.options.filter&&_.features.length&&(_.features=_.features.filter(this.options.filter));var w=[];_.suggestions?w=_.suggestions:_.place?w=[_.place]:w=_.features,w.length?(this._clearEl.style.display="block",this._typeahead.update(w),(!this.options.showResultsWhileTyping||t)&&this.options.showResultMarkers&&(_.features.length>0||_.place)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",_)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",_))}).bind(this)).catch((function(_){this._loadingEl.style.display="none",a.length&&this.options.localGeocoder||p.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(a)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:a}),this._eventEmitter.emit("error",{error:_})}).bind(this)),s},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){var t=this;e.relatedTarget&&t._clear(e)},_onQueryResult:function(e){var t=e;if(t.features.length){var r=t.features[0];this._typeahead.selected=r,this._inputEl.value=r.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){var e="<div class='mapbox-gl-geocoder--error maplibre-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(e)},_renderNoResults:function(){var e="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>";this._renderMessage(e)},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],t=xit.language(e),r=wit.placeholder[t];if(r)return r}return"Search"},_fitBoundsForMarkers:function(){if(!(this._typeahead.data.length<1)){var e=this._typeahead.data.filter(function(n){return typeof n!="string"}).slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){var t={padding:100},r=Ka({},t,this.options.flyTo),i=new this._maplibregl.LngLatBounds;e.forEach(function(n){i.extend(n.geometry.coordinates)}),this._map.fitBounds(i.toArray(),r)}return e.length>0&&this._maplibregl&&this._handleResultMarkers(e),this}},setInput:function(e){return this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(e),this},setProximity:function(e){return this.options.proximity=e,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setGeocoderApi:function(e){return this.geocoderApi=e,this},getGeocoderApi:function(){return this.geocoderApi},_handleMarker:function(e){if(this._map){this._removeMarker();var t={color:"#4668F2"},r=Ka({},t,this.options.marker);this.mapMarker=new this._maplibregl.Marker(r);var i;if(this.options.popup){var n={},s=Ka({},n,this.options.popup);i=new this._maplibregl.Popup(s).setHTML(this.options.popupRender(e))}return e.center?(this.mapMarker.setLngLat(e.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(i)):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(i)),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},_handleResultMarkers:function(e){if(this._map){this._removeResultMarkers();var t={color:"#4668F2"},r=Ka({},t,this.options.showResultMarkers);return e.forEach((function(i){if(this.options.showResultMarkers&&this.options.showResultMarkers.element){var n=this.options.showResultMarkers.element.cloneNode(!0);r=Ka(r,{element:n})}var s=new this._maplibregl.Marker(Ka({},r,{element:n})),c;if(this.options.popup){var a={},p=Ka({},a,this.options.popup);c=new this._maplibregl.Popup(p).setHTML(this.options.popupRender(i))}i.center?(s.setLngLat(i.center).addTo(this._map),this.options.popup&&s.setPopup(c)):i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(s.setLngLat(i.geometry.coordinates).addTo(this._map),this.options.popup&&s.setPopup(c)),this.resultMarkers.push(s)}).bind(this)),this}},_removeResultMarkers:function(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(e){e.remove()}),this.resultMarkers=[])},on:function(e,t){return this._eventEmitter.on(e,t),this},off:function(e,t){return this._eventEmitter.removeListener(e,t),this}};var Sit=cR;const Ait=av(Sit),Eit={limitsUrl:"https://tilemaps.icgc.cat/vt/limits-tilejsonV3.json",geocoder:{peliasUrl1:"https://eines.icgc.cat/geocodificador/autocompletar?text=",peliasUrl2:"&layers=topo1%2Ctopo2%2Caddress&size=5"},mapOptions:{container:"map",center:{0:1.537786,1:41.837539},zoom:7.5,bearing:0,pitch:0,hash:!1,style:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json.json",maxZoom:18,maxPitch:85},logoIcgcOptions:{logoUrlColor:"https://eines.icgc.cat/recursos/logos/icgc_logo_color.png",logoUrlWhite:"https://eines.icgc.cat/recursos/logos/icgc_logo_blanc.svg",logoLink:"https://www.icgc.cat",logoTitle:"Institut Cartogrfic i Geolgic de Catalunya",logoWidth:100,logoOpacity:.6},logoGencatOptions:{logoUrlColor:"https://eines.icgc.cat/recursos/logos/gencat_logo_color.png",logoUrlWhite:"https://eines.icgc.cat/recursos/logos/gencat_logo_blanc.png",logoLink:"https://web.gencat.cat/",logoTitle:"Generalitat de Catalunya",logoWidth:100,logoOpacity:.6},map3dOptions:{spaceErrorFactor:2,exaggeration:1,zfactor:48,minZoomRange:15.5,maxZoomRange:22,urlTilesetCities:"https://geoserveis.icgc.cat/servei/catalunya/ciutats/3dtiles/v1/tilesetV1.0.json",layerIdOrder:"place-isolated",sourceLayerFilterId:"place",minZoomFilter:14,layerId3d:"edificisMapboxLayer",terrainSource:"ICGC5M",style3dName:"orto3d",imageIcon:"https://eines.icgc.cat/recursos//images/stick.png"},baseStyles:[{key:"TOPO",url:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_topografic.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},{key:"ORTO",url:"https://geoserveis.icgc.cat/styles/icgc_orto_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_estandard.png"},{key:"ORTO3D",url:"https://eines.icgc.cat/recursos//styles/icgc_orto_3d.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_estandard.png"},{key:"ORTOHYBRID",url:"https://geoserveis.icgc.cat/styles/icgc_orto_hibrida.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ADMIN",url:"https://geoserveis.icgc.cat/styles/icgc_limits_administratius_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},{key:"DARK",url:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_fosc.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},{key:"LIGHT",url:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},{key:"GEOLOGY",url:"https://geoserveis.icgc.cat/styles/icgc_geologic_informacio.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"},{key:"RASTER",substyles:{TOPO:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_topo.jpg"},ADMIN:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_administratiu.jpg"},LIGHT:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic-gris/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_topo_gris.jpg"},STANDARD:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/estandard/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_estandard_0.jpg"},Simplified:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_simplificat.jpg"},ORTO:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto.jpg"},ORTOGREY:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-gris/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto_gris.jpg"},ORTOHYBRID:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-hibrida/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto_hibida.jpg"}}}],urlTerrainICGC:[{name:"ICGC5M",url:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},{name:"WORLD30M",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",encoding:"terrarium"}],ortoLayersICGC:[{name:"ortofotoColorProvisional",key:"ortofoto_color_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},{name:"ortofotoColor2023",key:"ortofoto_color_2023",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2023"},{name:"ortofotoColor2022",key:"ortofoto_color_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},{name:"ortofotoColor2021",key:"ortofoto_color_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},{name:"ortofotoColor2020",key:"ortofoto_color_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},{name:"ortofotoColor2019",key:"ortofoto_color_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},{name:"ortofotoColor2018",key:"ortofoto_color_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},{name:"ortofotoColor2017",key:"ortofoto_color_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},{name:"ortofotoColor2016",key:"ortofoto_color_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},{name:"ortofotoColor2015",key:"ortofoto_color_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},{name:"ortofotoColor2014",key:"ortofoto_color_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},{name:"ortofotoColor2013",key:"ortofoto_color_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},{name:"ortofotoColor2012",key:"ortofoto_color_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},{name:"ortofotoColor2011",key:"ortofoto_color_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},{name:"ortofotoColor2010",key:"ortofoto_color_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},{name:"ortofotoColor2009",key:"ortofoto_color_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},{name:"ortofotoColor2008",key:"ortofoto_color_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},{name:"ortofotoColor20062007",key:"ortofoto_color_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},{name:"ortofotoColor20042005",key:"ortofoto_color_2004-2005",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},{name:"ortofotoColor20002003",key:"ortofoto_color_2000-2003",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},{name:"ortofotoBlancINegre1998",key:"ortofoto_blanc_i_negre_1998",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},{name:"ortofotoBlancINegre19941997",key:"ortofoto_blanc_i_negre_1994-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},{name:"ortofotoColor1993",key:"ortofoto_color_1993",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},{name:"ortofotoBlancINegre19831992",key:"ortofoto_blanc_i_negre_1983-1992",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},{name:"ortofotoBlancINegre19701977",key:"ortofoto_blanc_i_negre_1970-1977",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},{name:"ortofotoBlancINegre1956",key:"ortofoto_blanc_i_negre_1956",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},{name:"ortofotoBlancINegre1945",key:"ortofoto_blanc_i_negre_1945",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},{name:"ortofotoColorSerieAnual",key:"ortofoto_color_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},{name:"ortofotoInfraroigProvisional",key:"ortofoto_infraroig_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},{name:"ortofotoInfraroig2023",key:"ortofoto_infraroig_2023",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2023"},{name:"ortofotoInfraroig2022",key:"ortofoto_infraroig_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},{name:"ortofotoInfraroig2021",key:"ortofoto_infraroig_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},{name:"ortofotoInfraroig2020",key:"ortofoto_infraroig_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},{name:"ortofotoInfraroig2019",key:"ortofoto_infraroig_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},{name:"ortofotoInfraroig2018",key:"ortofoto_infraroig_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},{name:"ortofotoInfraroig2017",key:"ortofoto_infraroig_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},{name:"ortofotoInfraroig2016",key:"ortofoto_infraroig_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},{name:"ortofotoInfraroig2015",key:"ortofoto_infraroig_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},{name:"ortofotoInfraroig2014",key:"ortofoto_infraroig_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},{name:"ortofotoInfraroig2013",key:"ortofoto_infraroig_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},{name:"ortofotoInfraroig2012",key:"ortofoto_infraroig_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},{name:"ortofotoInfraroig2011",key:"ortofoto_infraroig_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},{name:"ortofotoInfraroig2010",key:"ortofoto_infraroig_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},{name:"ortofotoInfraroig2009",key:"ortofoto_infraroig_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},{name:"ortofotoInfraroig2008",key:"ortofoto_infraroig_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},{name:"ortofotoInfraroig20062007",key:"ortofoto_infraroig_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},{name:"ortofotoInfraroig19961997",key:"ortofoto_infraroig_1996-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},{name:"ortofotoInfraroigSerieAnual",key:"ortofoto_infraroig_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}],vectorLayersICGC:[{name:"agrupacionsCensals2015",key:"agrupacions_censals_2015"},{name:"agrupacionsCensals2016",key:"agrupacions_censals_2016"},{name:"agrupacionsCensals2017",key:"agrupacions_censals_2017"},{name:"agrupacionsCensals2018",key:"agrupacions_censals_2018"},{name:"agrupacionsCensals2019",key:"agrupacions_censals_2019"},{name:"agrupacionsCensals2020",key:"agrupacions_censals_2020"},{name:"agrupacionsCensals2021",key:"agrupacions_censals_2021"},{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text"},{name:"areesBasiquesPolicials2019",key:"arees_basiques_policials_2019"},{name:"areesBasiquesPolicials2020",key:"arees_basiques_policials_2020"},{name:"areesBasiquesPolicials2022",key:"arees_basiques_policials_2022"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent"},{name:"catalunyaVigent",key:"catalunya_vigent"},{name:"catalunyaVigentText",key:"catalunya_vigent_text"},{name:"comarques2022",key:"comarques_2022"},{name:"comarquesVigent",key:"comarques_vigent"},{name:"comarquesVigentText",key:"comarques_vigent_text"},{name:"districtesCensals2015",key:"districtes_censals_2015"},{name:"districtesCensals2016",key:"districtes_censals_2016"},{name:"districtesCensals2017",key:"districtes_censals_2017"},{name:"districtesCensals2018",key:"districtes_censals_2018"},{name:"districtesCensals2019",key:"districtes_censals_2019"},{name:"districtesCensals2020",key:"districtes_censals_2020"},{name:"districtesCensals2021",key:"districtes_censals_2021"},{name:"districtesCensals2022",key:"districtes_censals_2022"},{name:"districtesCensals2023",key:"districtes_censals_2023"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text"},{name:"municipis2022",key:"municipis_2022"},{name:"municipis2022Text",key:"municipis_2022_text"},{name:"municipisVigent",key:"municipis_vigent"},{name:"municipisVigentText",key:"municipis_vigent_text"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text"},{name:"plaTerritorial2015",key:"pla_territorial_2015"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text"},{name:"provinciesVigent",key:"provincies_vigent"},{name:"provinciesVigentText",key:"provincies_vigent_text"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text"},{name:"seccionsCensals2015",key:"seccions_censals_2015"},{name:"seccionsCensals2016",key:"seccions_censals_2016"},{name:"seccionsCensals2017",key:"seccions_censals_2017"},{name:"seccionsCensals2018",key:"seccions_censals_2018"},{name:"seccionsCensals2019",key:"seccions_censals_2019"},{name:"seccionsCensals2020",key:"seccions_censals_2020"},{name:"seccionsCensals2021",key:"seccions_censals_2021"},{name:"seccionsCensals2022",key:"seccions_censals_2022"},{name:"seccionsCensals2023",key:"seccions_censals_2023"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent"},{name:"vegueriesVigent",key:"vegueries_vigent"},{name:"vegueriesVigentText",key:"vegueries_vigent_text"}],vectorLayers:[{key:"cobertes2018",url:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json",legend:"https://eines.icgc.cat/recursos//images/llegendaCobertesSol2018.jpg"}],wmsLayers:[{key:"espaisInteresGeologic",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"gravimetriaBouguer500000",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"cobertesSol2018",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"administratiu",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},{key:"simplificat",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},{key:"cims",layer:"",url:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},{key:"cobertesSol",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}],fgbLayers:[{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},{name:"catalunyaVigent",key:"catalunya_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},{name:"catalunyaVigentText",key:"catalunya_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},{name:"comarquesVigent",key:"comarques_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},{name:"comarquesVigentText",key:"comarques_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},{name:"municipisVigent",key:"municipis_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},{name:"municipisVigentText",key:"municipis_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},{name:"provinciesVigent",key:"provincies_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},{name:"provinciesVigentText",key:"provincies_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},{name:"vegueriesVigent",key:"vegueries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},{name:"vegueriesVigentText",key:"vegueries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}]},Tit={TOPO:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_topografic.json",ORTO:"https://geoserveis.icgc.cat/styles/icgc_orto_estandard.json",ORTO3D:"https://eines.icgc.cat/recursos//styles/icgc_orto_3d.json",ORTOHYBRID:"https://geoserveis.icgc.cat/styles/icgc_orto_hibrida.json",ADMIN:"https://geoserveis.icgc.cat/styles/icgc_limits_administratius_gris.json",DARK:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/styles/icgc_geologic_informacio.json",RASTER:{TOPO:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic/MON3857NW/{z}/{x}/{y}.png",ADMIN:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",LIGHT:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic-gris/MON3857NW/{z}/{x}/{y}.png",STANDARD:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/estandard/MON3857NW/{z}/{x}/{y}.png",SIMPLIFIED:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",ORTO:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto/MON3857NW/{z}/{x}/{y}.png",ORTOGREY:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-gris/MON3857NW/{z}/{x}/{y}.png",ORTOHYBRID:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-hibrida/MON3857NW/{z}/{x}/{y}.png"}},Cit={ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},Pit={Orto:{ortofotoColorProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional",ortofotoColor2023:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2023",ortofotoColor2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022",ortofotoColor2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021",ortofotoColor2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020",ortofotoColor2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019",ortofotoColor2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018",ortofotoColor2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017",ortofotoColor2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016",ortofotoColor2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015",ortofotoColor2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014",ortofotoColor2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013",ortofotoColor2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012",ortofotoColor2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011",ortofotoColor2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010",ortofotoColor2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009",ortofotoColor2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008",ortofotoColor20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007",ortofotoColor20042005:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005",ortofotoColor20002003:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003",ortofotoBlancINegre1998:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998",ortofotoBlancINegre19941997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997",ortofotoColor1993:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993",ortofotoBlancINegre19831992:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992",ortofotoBlancINegre19701977:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977",ortofotoBlancINegre1956:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956",ortofotoBlancINegre1945:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945",ortofotoColorSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual",ortofotoInfraroigProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional",ortofotoInfraroig2023:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2023",ortofotoInfraroig2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022",ortofotoInfraroig2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021",ortofotoInfraroig2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020",ortofotoInfraroig2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019",ortofotoInfraroig2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018",ortofotoInfraroig2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017",ortofotoInfraroig2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016",ortofotoInfraroig2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015",ortofotoInfraroig2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014",ortofotoInfraroig2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013",ortofotoInfraroig2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012",ortofotoInfraroig2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011",ortofotoInfraroig2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010",ortofotoInfraroig2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009",ortofotoInfraroig2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008",ortofotoInfraroig20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007",ortofotoInfraroig19961997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997",ortofotoInfraroigSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},VectorAdmin:{agrupacionsCensals2015:"agrupacions_censals_2015",agrupacionsCensals2016:"agrupacions_censals_2016",agrupacionsCensals2017:"agrupacions_censals_2017",agrupacionsCensals2018:"agrupacions_censals_2018",agrupacionsCensals2019:"agrupacions_censals_2019",agrupacionsCensals2020:"agrupacions_censals_2020",agrupacionsCensals2021:"agrupacions_censals_2021",agrupacionsCensalsVigent:"agrupacions_censals_vigent",agrupacionsCensalsVigentText:"agrupacions_censals_vigent_text",areesBasiquesPolicials2019:"arees_basiques_policials_2019",areesBasiquesPolicials2020:"arees_basiques_policials_2020",areesBasiquesPolicials2022:"arees_basiques_policials_2022",areesBasiquesPolicialsVigent:"arees_basiques_policials_vigent",areesBasiquesPolicialsVigentText:"arees_basiques_policials_vigent_text",areesBasiquesSalutVigent:"arees_basiques_salut_vigent",areesBasiquesServeisSocialsVigent:"arees_basiques_serveis_socials_vigent",areesBasiquesServeisSocialsVigentText:"arees_basiques_serveis_socials_vigent_text",areesGestioAssistencialVigent:"arees_gestio_assistencial_vigent",areesHidrogeologiquesAquifersVigent:"arees_hidrogeologiques_aquifers_vigent",catalunyaVigent:"catalunya_vigent",catalunyaVigentText:"catalunya_vigent_text",comarques2022:"comarques_2022",comarquesVigent:"comarques_vigent",comarquesVigentText:"comarques_vigent_text",districtesCensals2015:"districtes_censals_2015",districtesCensals2016:"districtes_censals_2016",districtesCensals2017:"districtes_censals_2017",districtesCensals2018:"districtes_censals_2018",districtesCensals2019:"districtes_censals_2019",districtesCensals2020:"districtes_censals_2020",districtesCensals2021:"districtes_censals_2021",districtesCensals2022:"districtes_censals_2022",districtesCensals2023:"districtes_censals_2023",districtesCensalsVigent:"districtes_censals_vigent",districtesCensalsVigentText:"districtes_censals_vigent_text",incendisForestalsVigent:"incendis_forestals_vigent",incendisForestalsVigentText:"incendis_forestals_vigent_text",municipis2022:"municipis_2022",municipis2022Text:"municipis_2022_text",municipisVigent:"municipis_vigent",municipisVigentText:"municipis_vigent_text",partitsJudicialsVigent:"partits_judicials_vigent",partitsJudicialsVigentText:"partits_judicials_vigent_text",plaTerritorial2015:"pla_territorial_2015",plaTerritorialVigent:"pla_territorial_vigent",plaTerritorialVigentText:"pla_territorial_vigent_text",provinciesVigent:"provincies_vigent",provinciesVigentText:"provincies_vigent_text",regionsPolicialsVigent:"regions_policials_vigent",regionsPolicialsVigentText:"regions_policials_vigent_text",regionsSanitariesVigent:"regions_sanitaries_vigent",regionsSanitariesVigentText:"regions_sanitaries_vigent_text",seccionsCensals2015:"seccions_censals_2015",seccionsCensals2016:"seccions_censals_2016",seccionsCensals2017:"seccions_censals_2017",seccionsCensals2018:"seccions_censals_2018",seccionsCensals2019:"seccions_censals_2019",seccionsCensals2020:"seccions_censals_2020",seccionsCensals2021:"seccions_censals_2021",seccionsCensals2022:"seccions_censals_2022",seccionsCensals2023:"seccions_censals_2023",seccionsCensalsVigent:"seccions_censals_vigent",seccionsCensalsVigentText:"seccions_censals_vigent_text",sectorsSanitarisVigent:"sectors_sanitaris_vigent",vegueriesVigent:"vegueries_vigent",vegueriesVigentText:"vegueries_vigent_text"},FGBAdmin:{agrupacionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb",agrupacionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb",areesBasiquesPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb",areesBasiquesPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb",areesBasiquesSalutVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb",areesBasiquesServeisSocialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb",areesBasiquesServeisSocialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb",areesGestioAssistencialVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb",areesHidrogeologiquesAquifersVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb",catalunyaVigent:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb",catalunyaVigentText:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb",comarquesVigent:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb",comarquesVigentText:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb",districtesCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb",districtesCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb",incendisForestalsVigent:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb",incendisForestalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb",municipisVigent:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb",municipisVigentText:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb",partitsJudicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb",partitsJudicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb",plaTerritorialVigent:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb",plaTerritorialVigentText:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb",provinciesVigent:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb",provinciesVigentText:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb",regionsPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb",regionsPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb",regionsSanitariesVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb",regionsSanitariesVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb",seccionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb",seccionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb",sectorsSanitarisVigent:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb",vegueriesVigent:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb",vegueriesVigentText:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},Vector:{cobertes2018:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"},WMS:{espaisInteresGeologic:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",gravimetriaBouguer500000:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",cobertesSol2018:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",administratiu:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",simplificat:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",cims:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455",cobertesSol:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}},yp={defaultOptions:Eit,Styles:Tit,Terrains:Cit,Layers:Pit};class Iit{constructor(t){this.options=t||{}}onAdd(t){let r=yp.defaultOptions;return this._map=t,this._img1=document.createElement("img"),this._img1.className="maplibregl-ctrl",this._img1.src=this.options.color?r.logoIcgcOptions.logoUrlColor:r.logoIcgcOptions.logoUrlWhite,this._img1.width=r.logoIcgcOptions.logoWidth,this._img1.title=r.logoIcgcOptions.logoTitle,this._img1.style.opacity=r.logoIcgcOptions.logoOpacity,this.link1=document.createElement("a"),this.link1.href=r.logoIcgcOptions.logoLink,this.link1.target="_blank",this.link1.appendChild(this._img1),this._container1=document.createElement("div"),this._container1.className="maplibregl-ctrl",this._container1.style.width=`${r.logoIcgcOptions.logoWidth}px`,this._container1.appendChild(this.link1),this._img2=document.createElement("img"),this._img2.className="maplibregl-ctrl",this._img2.src=this.options.color?r.logoGencatOptions.logoUrlColor:r.logoGencatOptions.logoUrlWhite,this._img2.width=r.logoGencatOptions.logoWidth,this._img2.title=r.logoGencatOptions.logoTitle,this._img2.style.opacity=r.logoGencatOptions.logoOpacity,this.link2=document.createElement("a"),this.link2.href=r.logoGencatOptions.logoLink,this.link2.target="_blank",this.link2.appendChild(this._img2),this._container2=document.createElement("div"),this._container2.className="maplibregl-ctrl",this._container2.style.width=`${r.logoGencatOptions.logoWidth}px`,this._container2.appendChild(this.link2),this._mainContainer=document.createElement("div"),this._mainContainer.className="divLogos",this._mainContainer.style="display: flex",this._mainContainer.appendChild(this._container1),this._mainContainer.appendChild(this._container2),this._mainContainer}}class Lit{constructor(t){this.options=t||{}}onAdd(t){this._map=t,this._img1=document.createElement("img"),this._img1.src=this.options.url,this._img1.width=150,this._img1.title=300,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.legendContainer=document.createElement("div"),this.legendContainer.classList.add("maplibregl-legend-list"),this.legendButton=document.createElement("button"),this.legendButton.classList.add("maplibregl-ctrl-icon"),this.legendButton.classList.add("maplibregl-legend-switcher"),this.legendButton.addEventListener("click",()=>{this.legendButton.style.display="none",this.legendContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.legendButton),this.controlContainer.appendChild(this.legendContainer),this.closeButton=document.createElement("button"),this.closeButton.textContent="x",this.closeButton.classList.add("maplibregl-legend-close-button"),this.closeButton.addEventListener("click",()=>{this.legendButton.style.display="block",this.legendContainer.style.display="none"}),this.legendContainer.appendChild(this.closeButton);const r=document.createElement("label");return r.classList.add("maplibregl-legend-title-label"),r.textContent=this.options.idLayer||"Llegenda",this.legendContainer.appendChild(r),this.legendContainer.appendChild(document.createElement("br")),this.legendContainer.appendChild(this._img1),this.controlContainer}}var Bm=uR.prototype,i5="WGS 84";function uR(e){e!==void 0&&(i5=e),this.setEllipsoid(i5)}Bm.convertLatLngToUtm=function(e,t,r){var i;if(this.status)return"No ecclipsoid data associated with unknown datum: "+i5;if(!Number.isInteger(r))return"Precision is not integer number.";e=parseFloat(e),t=parseFloat(t);var n=t,s=this.toRadians(e),c=this.toRadians(n);n>=8&&n<=13&&e>54.5&&e<58||e>=56&&e<64&&n>=3&&n<12?i=32:(i=(n+180)/6+1,e>=72&&e<84&&(n>=0&&n<9?i=31:n>=9&&n<21?i=33:n>=21&&n<33?i=35:n>=33&&n<42&&(i=37))),i=parseInt(i);var a=(i-1)*6-180+3,p=this.toRadians(a),_=this.getUtmLetterDesignator(e),w=this.eccSquared/(1-this.eccSquared),S=this.a/Math.sqrt(1-this.eccSquared*Math.sin(s)*Math.sin(s)),C=Math.tan(s)*Math.tan(s),I=w*Math.cos(s)*Math.cos(s),N=Math.cos(s)*(c-p),F=this.a*((1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)*s-(3*this.eccSquared/8+3*this.eccSquared*this.eccSquared/32+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(2*s)+(15*this.eccSquared*this.eccSquared/256+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(4*s)-35*this.eccSquared*this.eccSquared*this.eccSquared/3072*Math.sin(6*s)),W=parseFloat(.9996*S*(N+(1-C+I)*N*N*N/6+(5-18*C+C*C+72*I-58*w)*N*N*N*N*N/120)+5e5),U=parseFloat(.9996*(F+S*Math.tan(s)*(N*N/2+(5-C+9*I+4*I*I)*N*N*N*N/24+(61-58*C+C*C+600*I-330*w)*N*N*N*N*N*N/720)));return e<0&&(U+=1e7),U=oL(U,r),W=oL(W,r),{Easting:W,Northing:U,ZoneNumber:parseInt(i),ZoneLetter:_}};Bm.convertUtmToLatLng=function(e,t,r,i){var n=(1-Math.sqrt(1-this.eccSquared))/(1+Math.sqrt(1-this.eccSquared)),s=e-5e5,c=t,a=r,p=i;if(e===void 0)return"Please pass the UTMEasting!";if(t===void 0)return"Please pass the UTMNorthing!";if(r===void 0)return"Please pass the UTMZoneNumber!";if(i===void 0)return"Please pass the UTMZoneLetter!";["N","P","Q","R","S","T","U","V","W","X","Y","Z"].indexOf(p)!==-1||(c-=1e7);var _=(a-1)*6-180+3,w=this.eccSquared/(1-this.eccSquared),S=c/.9996,C=S/(this.a*(1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)),I=C+(3*n/2-27*n*n*n/32)*Math.sin(2*C)+(21*n*n/16-55*n*n*n*n/32)*Math.sin(4*C)+151*n*n*n/96*Math.sin(6*C);this.toDegrees(I);var N=this.a/Math.sqrt(1-this.eccSquared*Math.sin(I)*Math.sin(I)),F=Math.tan(I)*Math.tan(I),W=w*Math.cos(I)*Math.cos(I),U=this.a*(1-this.eccSquared)/Math.pow(1-this.eccSquared*Math.sin(I)*Math.sin(I),1.5),z=s/(N*.9996),H=I-N*Math.tan(I)/U*(z*z/2-(5+3*F+10*W-4*W*W-9*w)*z*z*z*z/24+(61+90*F+298*W+45*F*F-252*w-3*W*W)*z*z*z*z*z*z/720);H=this.toDegrees(H);var nt=(z-(1+2*F+W)*z*z*z/6+(5-2*W+28*F-3*W*W+8*w+24*F*F)*z*z*z*z*z/120)/Math.cos(I);return nt=_+this.toDegrees(nt),{lat:H,lng:nt}};Bm.getUtmLetterDesignator=function(e){return e=parseFloat(e),84>=e&&e>=72?"X":72>e&&e>=64?"W":64>e&&e>=56?"V":56>e&&e>=48?"U":48>e&&e>=40?"T":40>e&&e>=32?"S":32>e&&e>=24?"R":24>e&&e>=16?"Q":16>e&&e>=8?"P":8>e&&e>=0?"N":0>e&&e>=-8?"M":-8>e&&e>=-16?"L":-16>e&&e>=-24?"K":-24>e&&e>=-32?"J":-32>e&&e>=-40?"H":-40>e&&e>=-48?"G":-48>e&&e>=-56?"F":-56>e&&e>=-64?"E":-64>e&&e>=-72?"D":-72>e&&e>=-80?"C":"Z"};Bm.setEllipsoid=function(e){switch(e){case"Airy":this.a=6377563,this.eccSquared=.00667054;break;case"Australian National":this.a=6378160,this.eccSquared=.006694542;break;case"Bessel 1841":this.a=6377397,this.eccSquared=.006674372;break;case"Bessel 1841 Nambia":this.a=6377484,this.eccSquared=.006674372;break;case"Clarke 1866":this.a=6378206,this.eccSquared=.006768658;break;case"Clarke 1880":this.a=6378249,this.eccSquared=.006803511;break;case"Everest":this.a=6377276,this.eccSquared=.006637847;break;case"Fischer 1960 Mercury":this.a=6378166,this.eccSquared=.006693422;break;case"Fischer 1968":this.a=6378150,this.eccSquared=.006693422;break;case"GRS 1967":this.a=6378160,this.eccSquared=.006694605;break;case"GRS 1980":this.a=6378137,this.eccSquared=.00669438;break;case"Helmert 1906":this.a=6378200,this.eccSquared=.006693422;break;case"Hough":this.a=6378270,this.eccSquared=.00672267;break;case"International":this.a=6378388,this.eccSquared=.00672267;break;case"Krassovsky":this.a=6378245,this.eccSquared=.006693422;break;case"Modified Airy":this.a=6377340,this.eccSquared=.00667054;break;case"Modified Everest":this.a=6377304,this.eccSquared=.006637847;break;case"Modified Fischer 1960":this.a=6378155,this.eccSquared=.006693422;break;case"South American 1969":this.a=6378160,this.eccSquared=.006694542;break;case"WGS 60":this.a=6378165,this.eccSquared=.006693422;break;case"WGS 66":this.a=6378145,this.eccSquared=.006694542;break;case"WGS 72":this.a=6378135,this.eccSquared=.006694318;break;case"ED50":this.a=6378388,this.eccSquared=.00672267;break;case"WGS 84":case"EUREF89":case"ETRS89":this.a=6378137,this.eccSquared=.00669438;break;default:this.status=!0}};Bm.toDegrees=function(e){return e/Math.PI*180};Bm.toRadians=function(e){return e*Math.PI/180};function oL(e,t){var r=Math.pow(10,t);return Math.round(e*r)/r}var Mit=uR;const Bit=av(Mit);class kit{constructor(t){this.options=t||{},this.options.utm=this.options.hasOwnProperty("utm")?this.options.utm:!0,this.options.lonlat=this.options.hasOwnProperty("lonlat")?this.options.lonlat:!0}onAdd(t){const r=new Bit;return this._map=t,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl coordControl",this._container.style.width=`${this.options.width||"225px"}`,this._map.on("mousemove",i=>{const n=i.lngLat.lat,s=i.lngLat.lng;let c="",a="";const p=r.convertLatLngToUtm(n,s,2),_=n>0?"N":"S";this.options.utm&&(c=`ETRS89 UTM ${p.ZoneNumber}${_} X:<b> ${p.Easting}</b> Y:<b> ${p.Northing}</b> <br>`),this.options.lonlat&&(a=`WGS 84 Lon:<b> ${s.toFixed(5)}</b>  Lat:<b> ${n.toFixed(5)}</b>`);const w=`${c}${a}`;this._container.innerHTML=w}),this._container}_lookUTM31(t,r){var i=0,n=0,s=6,c=84;return t>=i&&t<=s&&r>=n&&r<=c}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function hR(e,t){return function(){return e.apply(t,arguments)}}const{toString:Rit}=Object.prototype,{getPrototypeOf:T3}=Object,Ev=(e=>t=>{const r=Rit.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Ic=e=>(e=e.toLowerCase(),t=>Ev(t)===e),Tv=e=>t=>typeof t===e,{isArray:km}=Array,F0=Tv("undefined");function Fit(e){return e!==null&&!F0(e)&&e.constructor!==null&&!F0(e.constructor)&&ol(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const dR=Ic("ArrayBuffer");function Dit(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&dR(e.buffer),t}const Nit=Tv("string"),ol=Tv("function"),pR=Tv("number"),Cv=e=>e!==null&&typeof e=="object",Oit=e=>e===!0||e===!1,Wy=e=>{if(Ev(e)!=="object")return!1;const t=T3(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},zit=Ic("Date"),jit=Ic("File"),Uit=Ic("Blob"),Git=Ic("FileList"),Vit=e=>Cv(e)&&ol(e.pipe),qit=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ol(e.append)&&((t=Ev(e))==="formdata"||t==="object"&&ol(e.toString)&&e.toString()==="[object FormData]"))},Hit=Ic("URLSearchParams"),[$it,Wit,Xit,Zit]=["ReadableStream","Request","Response","Headers"].map(Ic),Yit=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function i1(e,t){let{allOwnKeys:r=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e===null||typeof e>"u")return;let i,n;if(typeof e!="object"&&(e=[e]),km(e))for(i=0,n=e.length;i<n;i++)t.call(null,e[i],i,e);else{const s=r?Object.getOwnPropertyNames(e):Object.keys(e),c=s.length;let a;for(i=0;i<c;i++)a=s[i],t.call(null,e[a],a,e)}}function fR(e,t){t=t.toLowerCase();const r=Object.keys(e);let i=r.length,n;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}const _p=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,mR=e=>!F0(e)&&e!==_p;function n5(){const{caseless:e}=mR(this)&&this||{},t={},r=(i,n)=>{const s=e&&fR(t,n)||n;Wy(t[s])&&Wy(i)?t[s]=n5(t[s],i):Wy(i)?t[s]=n5({},i):km(i)?t[s]=i.slice():t[s]=i};for(let i=0,n=arguments.length;i<n;i++)arguments[i]&&i1(arguments[i],r);return t}const Jit=function(e,t,r){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return i1(t,(n,s)=>{r&&ol(n)?e[s]=hR(n,r):e[s]=n},{allOwnKeys:i}),e},Kit=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),Qit=(e,t,r,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},tnt=(e,t,r,i)=>{let n,s,c;const a={};if(t=t||{},e==null)return t;do{for(n=Object.getOwnPropertyNames(e),s=n.length;s-- >0;)c=n[s],(!i||i(c,e,t))&&!a[c]&&(t[c]=e[c],a[c]=!0);e=r!==!1&&T3(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},ent=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const i=e.indexOf(t,r);return i!==-1&&i===r},rnt=e=>{if(!e)return null;if(km(e))return e;let t=e.length;if(!pR(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},int=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&T3(Uint8Array)),nnt=(e,t)=>{const r=(e&&e[Symbol.iterator]).call(e);let i;for(;(i=r.next())&&!i.done;){const n=i.value;t.call(e,n[0],n[1])}},snt=(e,t)=>{let r;const i=[];for(;(r=e.exec(t))!==null;)i.push(r);return i},ont=Ic("HTMLFormElement"),ant=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,i){return r.toUpperCase()+i}),aL=(e=>{let{hasOwnProperty:t}=e;return(r,i)=>t.call(r,i)})(Object.prototype),lnt=Ic("RegExp"),gR=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),i={};i1(r,(n,s)=>{let c;(c=t(n,s,e))!==!1&&(i[s]=c||n)}),Object.defineProperties(e,i)},cnt=e=>{gR(e,(t,r)=>{if(ol(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const i=e[r];if(ol(i)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},unt=(e,t)=>{const r={},i=n=>{n.forEach(s=>{r[s]=!0})};return km(e)?i(e):i(String(e).split(t)),r},hnt=()=>{},dnt=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,Q2="abcdefghijklmnopqrstuvwxyz",lL="0123456789",yR={DIGIT:lL,ALPHA:Q2,ALPHA_DIGIT:Q2+Q2.toUpperCase()+lL},pnt=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:yR.ALPHA_DIGIT,r="";const{length:i}=t;for(;e--;)r+=t[Math.random()*i|0];return r};function fnt(e){return!!(e&&ol(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])}const mnt=e=>{const t=new Array(10),r=(i,n)=>{if(Cv(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[n]=i;const s=km(i)?[]:{};return i1(i,(c,a)=>{const p=r(c,n+1);!F0(p)&&(s[a]=p)}),t[n]=void 0,s}}return i};return r(e,0)},gnt=Ic("AsyncFunction"),ynt=e=>e&&(Cv(e)||ol(e))&&ol(e.then)&&ol(e.catch),_R=((e,t)=>e?setImmediate:t?((r,i)=>(_p.addEventListener("message",n=>{let{source:s,data:c}=n;s===_p&&c===r&&i.length&&i.shift()()},!1),n=>{i.push(n),_p.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",ol(_p.postMessage)),_nt=typeof queueMicrotask<"u"?queueMicrotask.bind(_p):typeof process<"u"&&process.nextTick||_R,he={isArray:km,isArrayBuffer:dR,isBuffer:Fit,isFormData:qit,isArrayBufferView:Dit,isString:Nit,isNumber:pR,isBoolean:Oit,isObject:Cv,isPlainObject:Wy,isReadableStream:$it,isRequest:Wit,isResponse:Xit,isHeaders:Zit,isUndefined:F0,isDate:zit,isFile:jit,isBlob:Uit,isRegExp:lnt,isFunction:ol,isStream:Vit,isURLSearchParams:Hit,isTypedArray:int,isFileList:Git,forEach:i1,merge:n5,extend:Jit,trim:Yit,stripBOM:Kit,inherits:Qit,toFlatObject:tnt,kindOf:Ev,kindOfTest:Ic,endsWith:ent,toArray:rnt,forEachEntry:nnt,matchAll:snt,isHTMLForm:ont,hasOwnProperty:aL,hasOwnProp:aL,reduceDescriptors:gR,freezeMethods:cnt,toObjectSet:unt,toCamelCase:ant,noop:hnt,toFiniteNumber:dnt,findKey:fR,global:_p,isContextDefined:mR,ALPHABET:yR,generateString:pnt,isSpecCompliantForm:fnt,toJSONObject:mnt,isAsyncFn:gnt,isThenable:ynt,setImmediate:_R,asap:_nt};function Yr(e,t,r,i,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),i&&(this.request=i),n&&(this.response=n,this.status=n.status?n.status:null)}he.inherits(Yr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:he.toJSONObject(this.config),code:this.code,status:this.status}}});const vR=Yr.prototype,bR={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{bR[e]={value:e}});Object.defineProperties(Yr,bR);Object.defineProperty(vR,"isAxiosError",{value:!0});Yr.from=(e,t,r,i,n,s)=>{const c=Object.create(vR);return he.toFlatObject(e,c,function(a){return a!==Error.prototype},a=>a!=="isAxiosError"),Yr.call(c,e.message,t,r,i,n),c.cause=e,c.name=e.name,s&&Object.assign(c,s),c};const vnt=null;function s5(e){return he.isPlainObject(e)||he.isArray(e)}function wR(e){return he.endsWith(e,"[]")?e.slice(0,-2):e}function cL(e,t,r){return e?e.concat(t).map(function(i,n){return i=wR(i),!r&&n?"["+i+"]":i}).join(r?".":""):t}function bnt(e){return he.isArray(e)&&!e.some(s5)}const wnt=he.toFlatObject(he,{},null,function(e){return/^is[A-Z]/.test(e)});function Pv(e,t,r){if(!he.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=he.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(I,N){return!he.isUndefined(N[I])});const i=r.metaTokens,n=r.visitor||_,s=r.dots,c=r.indexes,a=(r.Blob||typeof Blob<"u"&&Blob)&&he.isSpecCompliantForm(t);if(!he.isFunction(n))throw new TypeError("visitor must be a function");function p(I){if(I===null)return"";if(he.isDate(I))return I.toISOString();if(!a&&he.isBlob(I))throw new Yr("Blob is not supported. Use a Buffer instead.");return he.isArrayBuffer(I)||he.isTypedArray(I)?a&&typeof Blob=="function"?new Blob([I]):Buffer.from(I):I}function _(I,N,F){let W=I;if(I&&!F&&typeof I=="object"){if(he.endsWith(N,"{}"))N=i?N:N.slice(0,-2),I=JSON.stringify(I);else if(he.isArray(I)&&bnt(I)||(he.isFileList(I)||he.endsWith(N,"[]"))&&(W=he.toArray(I)))return N=wR(N),W.forEach(function(U,z){!(he.isUndefined(U)||U===null)&&t.append(c===!0?cL([N],z,s):c===null?N:N+"[]",p(U))}),!1}return s5(I)?!0:(t.append(cL(F,N,s),p(I)),!1)}const w=[],S=Object.assign(wnt,{defaultVisitor:_,convertValue:p,isVisitable:s5});function C(I,N){if(!he.isUndefined(I)){if(w.indexOf(I)!==-1)throw Error("Circular reference detected in "+N.join("."));w.push(I),he.forEach(I,function(F,W){(!(he.isUndefined(F)||F===null)&&n.call(t,F,he.isString(W)?W.trim():W,N,S))===!0&&C(F,N?N.concat(W):[W])}),w.pop()}}if(!he.isObject(e))throw new TypeError("data must be an object");return C(e),t}function uL(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function C3(e,t){this._pairs=[],e&&Pv(e,this,t)}const xR=C3.prototype;xR.append=function(e,t){this._pairs.push([e,t])};xR.toString=function(e){const t=e?function(r){return e.call(this,r,uL)}:uL;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};function xnt(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function SR(e,t,r){if(!t)return e;const i=r&&r.encode||xnt;he.isFunction(r)&&(r={serialize:r});const n=r&&r.serialize;let s;if(n?s=n(t,r):s=he.isURLSearchParams(t)?t.toString():new C3(t,r).toString(i),s){const c=e.indexOf("#");c!==-1&&(e=e.slice(0,c)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}class hL{constructor(){this.handlers=[]}use(t,r,i){return this.handlers.push({fulfilled:t,rejected:r,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){he.forEach(this.handlers,function(r){r!==null&&t(r)})}}const AR={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Snt=typeof URLSearchParams<"u"?URLSearchParams:C3,Ant=typeof FormData<"u"?FormData:null,Ent=typeof Blob<"u"?Blob:null,Tnt={isBrowser:!0,classes:{URLSearchParams:Snt,FormData:Ant,Blob:Ent},protocols:["http","https","file","blob","url","data"]},P3=typeof window<"u"&&typeof document<"u",o5=typeof navigator=="object"&&navigator||void 0,Cnt=P3&&(!o5||["ReactNative","NativeScript","NS"].indexOf(o5.product)<0),Pnt=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Int=P3&&window.location.href||"http://localhost",Lnt=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:P3,hasStandardBrowserEnv:Cnt,hasStandardBrowserWebWorkerEnv:Pnt,navigator:o5,origin:Int},Symbol.toStringTag,{value:"Module"})),Po={...Lnt,...Tnt};function Mnt(e,t){return Pv(e,new Po.classes.URLSearchParams,Object.assign({visitor:function(r,i,n,s){return Po.isNode&&he.isBuffer(r)?(this.append(i,r.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},t))}function Bnt(e){return he.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function knt(e){const t={},r=Object.keys(e);let i;const n=r.length;let s;for(i=0;i<n;i++)s=r[i],t[s]=e[s];return t}function ER(e){function t(r,i,n,s){let c=r[s++];if(c==="__proto__")return!0;const a=Number.isFinite(+c),p=s>=r.length;return c=!c&&he.isArray(n)?n.length:c,p?(he.hasOwnProp(n,c)?n[c]=[n[c],i]:n[c]=i,!a):((!n[c]||!he.isObject(n[c]))&&(n[c]=[]),t(r,i,n[c],s)&&he.isArray(n[c])&&(n[c]=knt(n[c])),!a)}if(he.isFormData(e)&&he.isFunction(e.entries)){const r={};return he.forEachEntry(e,(i,n)=>{t(Bnt(i),n,r,0)}),r}return null}function Rnt(e,t,r){if(he.isString(e))try{return(t||JSON.parse)(e),he.trim(e)}catch(i){if(i.name!=="SyntaxError")throw i}return(0,JSON.stringify)(e)}const n1={transitional:AR,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",i=r.indexOf("application/json")>-1,n=he.isObject(e);if(n&&he.isHTMLForm(e)&&(e=new FormData(e)),he.isFormData(e))return i?JSON.stringify(ER(e)):e;if(he.isArrayBuffer(e)||he.isBuffer(e)||he.isStream(e)||he.isFile(e)||he.isBlob(e)||he.isReadableStream(e))return e;if(he.isArrayBufferView(e))return e.buffer;if(he.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(n){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Mnt(e,this.formSerializer).toString();if((s=he.isFileList(e))||r.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Pv(s?{"files[]":e}:e,c&&new c,this.formSerializer)}}return n||i?(t.setContentType("application/json",!1),Rnt(e)):e}],transformResponse:[function(e){const t=this.transitional||n1.transitional,r=t&&t.forcedJSONParsing,i=this.responseType==="json";if(he.isResponse(e)||he.isReadableStream(e))return e;if(e&&he.isString(e)&&(r&&!this.responseType||i)){const n=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(s){if(n)throw s.name==="SyntaxError"?Yr.from(s,Yr.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Po.classes.FormData,Blob:Po.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};he.forEach(["delete","get","head","post","put","patch"],e=>{n1.headers[e]={}});const Fnt=he.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Dnt=e=>{const t={};let r,i,n;return e&&e.split(`
`).forEach(function(s){n=s.indexOf(":"),r=s.substring(0,n).trim().toLowerCase(),i=s.substring(n+1).trim(),!(!r||t[r]&&Fnt[r])&&(r==="set-cookie"?t[r]?t[r].push(i):t[r]=[i]:t[r]=t[r]?t[r]+", "+i:i)}),t},dL=Symbol("internals");function Mg(e){return e&&String(e).trim().toLowerCase()}function Xy(e){return e===!1||e==null?e:he.isArray(e)?e.map(Xy):String(e)}function Nnt(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=r.exec(e);)t[i[1]]=i[2];return t}const Ont=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function tw(e,t,r,i,n){if(he.isFunction(i))return i.call(this,t,r);if(n&&(t=r),!!he.isString(t)){if(he.isString(i))return t.indexOf(i)!==-1;if(he.isRegExp(i))return i.test(t)}}function znt(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,i)=>r.toUpperCase()+i)}function jnt(e,t){const r=he.toCamelCase(" "+t);["get","set","has"].forEach(i=>{Object.defineProperty(e,i+r,{value:function(n,s,c){return this[i].call(this,t,n,s,c)},configurable:!0})})}class Ta{constructor(t){t&&this.set(t)}set(t,r,i){const n=this;function s(a,p,_){const w=Mg(p);if(!w)throw new Error("header name must be a non-empty string");const S=he.findKey(n,w);(!S||n[S]===void 0||_===!0||_===void 0&&n[S]!==!1)&&(n[S||p]=Xy(a))}const c=(a,p)=>he.forEach(a,(_,w)=>s(_,w,p));if(he.isPlainObject(t)||t instanceof this.constructor)c(t,r);else if(he.isString(t)&&(t=t.trim())&&!Ont(t))c(Dnt(t),r);else if(he.isHeaders(t))for(const[a,p]of t.entries())s(p,a,i);else t!=null&&s(r,t,i);return this}get(t,r){if(t=Mg(t),t){const i=he.findKey(this,t);if(i){const n=this[i];if(!r)return n;if(r===!0)return Nnt(n);if(he.isFunction(r))return r.call(this,n,i);if(he.isRegExp(r))return r.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=Mg(t),t){const i=he.findKey(this,t);return!!(i&&this[i]!==void 0&&(!r||tw(this,this[i],i,r)))}return!1}delete(t,r){const i=this;let n=!1;function s(c){if(c=Mg(c),c){const a=he.findKey(i,c);a&&(!r||tw(i,i[a],a,r))&&(delete i[a],n=!0)}}return he.isArray(t)?t.forEach(s):s(t),n}clear(t){const r=Object.keys(this);let i=r.length,n=!1;for(;i--;){const s=r[i];(!t||tw(this,this[s],s,t,!0))&&(delete this[s],n=!0)}return n}normalize(t){const r=this,i={};return he.forEach(this,(n,s)=>{const c=he.findKey(i,s);if(c){r[c]=Xy(n),delete r[s];return}const a=t?znt(s):String(s).trim();a!==s&&delete r[s],r[a]=Xy(n),i[a]=!0}),this}concat(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return this.constructor.concat(this,...r)}toJSON(t){const r=Object.create(null);return he.forEach(this,(i,n)=>{i!=null&&i!==!1&&(r[n]=t&&he.isArray(i)?i.join(", "):i)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[r,i]=t;return r+": "+i}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const r=new this(t);for(var i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];return n.forEach(c=>r.set(c)),r}static accessor(t){const r=(this[dL]=this[dL]={accessors:{}}).accessors,i=this.prototype;function n(s){const c=Mg(s);r[c]||(jnt(i,s),r[c]=!0)}return he.isArray(t)?t.forEach(n):n(t),this}}Ta.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);he.reduceDescriptors(Ta.prototype,(e,t)=>{let{value:r}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(n){this[i]=n}}});he.freezeMethods(Ta);function ew(e,t){const r=this||n1,i=t||r,n=Ta.from(i.headers);let s=i.data;return he.forEach(e,function(c){s=c.call(r,s,n.normalize(),t?t.status:void 0)}),n.normalize(),s}function TR(e){return!!(e&&e.__CANCEL__)}function Rm(e,t,r){Yr.call(this,e??"canceled",Yr.ERR_CANCELED,t,r),this.name="CanceledError"}he.inherits(Rm,Yr,{__CANCEL__:!0});function CR(e,t,r){const i=r.config.validateStatus;!r.status||!i||i(r.status)?e(r):t(new Yr("Request failed with status code "+r.status,[Yr.ERR_BAD_REQUEST,Yr.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function Unt(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function Gnt(e,t){e=e||10;const r=new Array(e),i=new Array(e);let n=0,s=0,c;return t=t!==void 0?t:1e3,function(a){const p=Date.now(),_=i[s];c||(c=p),r[n]=a,i[n]=p;let w=s,S=0;for(;w!==n;)S+=r[w++],w=w%e;if(n=(n+1)%e,n===s&&(s=(s+1)%e),p-c<t)return;const C=_&&p-_;return C?Math.round(S*1e3/C):void 0}}function Vnt(e,t){let r=0,i=1e3/t,n,s;const c=function(a){r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),n=null,s&&(clearTimeout(s),s=null),e.apply(null,a)};return[function(){const a=Date.now(),p=a-r;for(var _=arguments.length,w=new Array(_),S=0;S<_;S++)w[S]=arguments[S];p>=i?c(w,a):(n=w,s||(s=setTimeout(()=>{s=null,c(n)},i-p)))},()=>n&&c(n)]}const V_=function(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const n=Gnt(50,250);return Vnt(s=>{const c=s.loaded,a=s.lengthComputable?s.total:void 0,p=c-i,_=n(p),w=c<=a;i=c;const S={loaded:c,total:a,progress:a?c/a:void 0,bytes:p,rate:_||void 0,estimated:_&&a&&w?(a-c)/_:void 0,event:s,lengthComputable:a!=null,[t?"download":"upload"]:!0};e(S)},r)},pL=(e,t)=>{const r=e!=null;return[i=>t[0]({lengthComputable:r,total:e,loaded:i}),t[1]]},fL=e=>function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return he.asap(()=>e(...r))},qnt=Po.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,Po.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(Po.origin),Po.navigator&&/(msie|trident)/i.test(Po.navigator.userAgent)):()=>!0,Hnt=Po.hasStandardBrowserEnv?{write(e,t,r,i,n,s){const c=[e+"="+encodeURIComponent(t)];he.isNumber(r)&&c.push("expires="+new Date(r).toGMTString()),he.isString(i)&&c.push("path="+i),he.isString(n)&&c.push("domain="+n),s===!0&&c.push("secure"),document.cookie=c.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function $nt(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Wnt(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function PR(e,t){return e&&!$nt(t)?Wnt(e,t):t}const mL=e=>e instanceof Ta?{...e}:e;function Rp(e,t){t=t||{};const r={};function i(_,w,S,C){return he.isPlainObject(_)&&he.isPlainObject(w)?he.merge.call({caseless:C},_,w):he.isPlainObject(w)?he.merge({},w):he.isArray(w)?w.slice():w}function n(_,w,S,C){if(he.isUndefined(w)){if(!he.isUndefined(_))return i(void 0,_,S,C)}else return i(_,w,S,C)}function s(_,w){if(!he.isUndefined(w))return i(void 0,w)}function c(_,w){if(he.isUndefined(w)){if(!he.isUndefined(_))return i(void 0,_)}else return i(void 0,w)}function a(_,w,S){if(S in t)return i(_,w);if(S in e)return i(void 0,_)}const p={url:s,method:s,data:s,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:a,headers:(_,w,S)=>n(mL(_),mL(w),S,!0)};return he.forEach(Object.keys(Object.assign({},e,t)),function(_){const w=p[_]||n,S=w(e[_],t[_],_);he.isUndefined(S)&&w!==a||(r[_]=S)}),r}const IR=e=>{const t=Rp({},e);let{data:r,withXSRFToken:i,xsrfHeaderName:n,xsrfCookieName:s,headers:c,auth:a}=t;t.headers=c=Ta.from(c),t.url=SR(PR(t.baseURL,t.url),e.params,e.paramsSerializer),a&&c.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let p;if(he.isFormData(r)){if(Po.hasStandardBrowserEnv||Po.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((p=c.getContentType())!==!1){const[_,...w]=p?p.split(";").map(S=>S.trim()).filter(Boolean):[];c.setContentType([_||"multipart/form-data",...w].join("; "))}}if(Po.hasStandardBrowserEnv&&(i&&he.isFunction(i)&&(i=i(t)),i||i!==!1&&qnt(t.url))){const _=n&&s&&Hnt.read(s);_&&c.set(n,_)}return t},Xnt=typeof XMLHttpRequest<"u",Znt=Xnt&&function(e){return new Promise(function(t,r){const i=IR(e);let n=i.data;const s=Ta.from(i.headers).normalize();let{responseType:c,onUploadProgress:a,onDownloadProgress:p}=i,_,w,S,C,I;function N(){C&&C(),I&&I(),i.cancelToken&&i.cancelToken.unsubscribe(_),i.signal&&i.signal.removeEventListener("abort",_)}let F=new XMLHttpRequest;F.open(i.method.toUpperCase(),i.url,!0),F.timeout=i.timeout;function W(){if(!F)return;const z=Ta.from("getAllResponseHeaders"in F&&F.getAllResponseHeaders()),H={data:!c||c==="text"||c==="json"?F.responseText:F.response,status:F.status,statusText:F.statusText,headers:z,config:e,request:F};CR(function(nt){t(nt),N()},function(nt){r(nt),N()},H),F=null}"onloadend"in F?F.onloadend=W:F.onreadystatechange=function(){!F||F.readyState!==4||F.status===0&&!(F.responseURL&&F.responseURL.indexOf("file:")===0)||setTimeout(W)},F.onabort=function(){F&&(r(new Yr("Request aborted",Yr.ECONNABORTED,e,F)),F=null)},F.onerror=function(){r(new Yr("Network Error",Yr.ERR_NETWORK,e,F)),F=null},F.ontimeout=function(){let z=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const H=i.transitional||AR;i.timeoutErrorMessage&&(z=i.timeoutErrorMessage),r(new Yr(z,H.clarifyTimeoutError?Yr.ETIMEDOUT:Yr.ECONNABORTED,e,F)),F=null},n===void 0&&s.setContentType(null),"setRequestHeader"in F&&he.forEach(s.toJSON(),function(z,H){F.setRequestHeader(H,z)}),he.isUndefined(i.withCredentials)||(F.withCredentials=!!i.withCredentials),c&&c!=="json"&&(F.responseType=i.responseType),p&&([S,I]=V_(p,!0),F.addEventListener("progress",S)),a&&F.upload&&([w,C]=V_(a),F.upload.addEventListener("progress",w),F.upload.addEventListener("loadend",C)),(i.cancelToken||i.signal)&&(_=z=>{F&&(r(!z||z.type?new Rm(null,e,F):z),F.abort(),F=null)},i.cancelToken&&i.cancelToken.subscribe(_),i.signal&&(i.signal.aborted?_():i.signal.addEventListener("abort",_)));const U=Unt(i.url);if(U&&Po.protocols.indexOf(U)===-1){r(new Yr("Unsupported protocol "+U+":",Yr.ERR_BAD_REQUEST,e));return}F.send(n||null)})},Ynt=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let i=new AbortController,n;const s=function(_){if(!n){n=!0,a();const w=_ instanceof Error?_:this.reason;i.abort(w instanceof Yr?w:new Rm(w instanceof Error?w.message:w))}};let c=t&&setTimeout(()=>{c=null,s(new Yr(`timeout ${t} of ms exceeded`,Yr.ETIMEDOUT))},t);const a=()=>{e&&(c&&clearTimeout(c),c=null,e.forEach(_=>{_.unsubscribe?_.unsubscribe(s):_.removeEventListener("abort",s)}),e=null)};e.forEach(_=>_.addEventListener("abort",s));const{signal:p}=i;return p.unsubscribe=()=>he.asap(a),p}},Jnt=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let i=0,n;for(;i<r;)n=i+t,yield e.slice(i,n),i=n},Knt=async function*(e,t){for await(const r of Qnt(e))yield*Jnt(r,t)},Qnt=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:i}=await t.read();if(r)break;yield i}}finally{await t.cancel()}},gL=(e,t,r,i)=>{const n=Knt(e,t);let s=0,c,a=p=>{c||(c=!0,i&&i(p))};return new ReadableStream({async pull(p){try{const{done:_,value:w}=await n.next();if(_){a(),p.close();return}let S=w.byteLength;if(r){let C=s+=S;r(C)}p.enqueue(new Uint8Array(w))}catch(_){throw a(_),_}},cancel(p){return a(p),n.return()}},{highWaterMark:2})},Iv=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",LR=Iv&&typeof ReadableStream=="function",tst=Iv&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),MR=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return!!e(...r)}catch{return!1}},est=LR&&MR(()=>{let e=!1;const t=new Request(Po.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),yL=64*1024,a5=LR&&MR(()=>he.isReadableStream(new Response("").body)),q_={stream:a5&&(e=>e.body)};Iv&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!q_[t]&&(q_[t]=he.isFunction(e[t])?r=>r[t]():(r,i)=>{throw new Yr(`Response type '${t}' is not supported`,Yr.ERR_NOT_SUPPORT,i)})})})(new Response);const rst=async e=>{if(e==null)return 0;if(he.isBlob(e))return e.size;if(he.isSpecCompliantForm(e))return(await new Request(Po.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(he.isArrayBufferView(e)||he.isArrayBuffer(e))return e.byteLength;if(he.isURLSearchParams(e)&&(e=e+""),he.isString(e))return(await tst(e)).byteLength},ist=async(e,t)=>he.toFiniteNumber(e.getContentLength())??rst(t),nst=Iv&&(async e=>{let{url:t,method:r,data:i,signal:n,cancelToken:s,timeout:c,onDownloadProgress:a,onUploadProgress:p,responseType:_,headers:w,withCredentials:S="same-origin",fetchOptions:C}=IR(e);_=_?(_+"").toLowerCase():"text";let I=Ynt([n,s&&s.toAbortSignal()],c),N;const F=I&&I.unsubscribe&&(()=>{I.unsubscribe()});let W;try{if(p&&est&&r!=="get"&&r!=="head"&&(W=await ist(w,i))!==0){let yt=new Request(t,{method:"POST",body:i,duplex:"half"}),bt;if(he.isFormData(i)&&(bt=yt.headers.get("content-type"))&&w.setContentType(bt),yt.body){const[vt,mt]=pL(W,V_(fL(p)));i=gL(yt.body,yL,vt,mt)}}he.isString(S)||(S=S?"include":"omit");const U="credentials"in Request.prototype;N=new Request(t,{...C,signal:I,method:r.toUpperCase(),headers:w.normalize().toJSON(),body:i,duplex:"half",credentials:U?S:void 0});let z=await fetch(N);const H=a5&&(_==="stream"||_==="response");if(a5&&(a||H&&F)){const yt={};["status","statusText","headers"].forEach(Dt=>{yt[Dt]=z[Dt]});const bt=he.toFiniteNumber(z.headers.get("content-length")),[vt,mt]=a&&pL(bt,V_(fL(a),!0))||[];z=new Response(gL(z.body,yL,vt,()=>{mt&&mt(),F&&F()}),yt)}_=_||"text";let nt=await q_[he.findKey(q_,_)||"text"](z,e);return!H&&F&&F(),await new Promise((yt,bt)=>{CR(yt,bt,{data:nt,headers:Ta.from(z.headers),status:z.status,statusText:z.statusText,config:e,request:N})})}catch(U){throw F&&F(),U&&U.name==="TypeError"&&/fetch/i.test(U.message)?Object.assign(new Yr("Network Error",Yr.ERR_NETWORK,e,N),{cause:U.cause||U}):Yr.from(U,U&&U.code,e,N)}}),l5={http:vnt,xhr:Znt,fetch:nst};he.forEach(l5,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const _L=e=>`- ${e}`,sst=e=>he.isFunction(e)||e===null||e===!1,BR={getAdapter:e=>{e=he.isArray(e)?e:[e];const{length:t}=e;let r,i;const n={};for(let s=0;s<t;s++){r=e[s];let c;if(i=r,!sst(r)&&(i=l5[(c=String(r)).toLowerCase()],i===void 0))throw new Yr(`Unknown adapter '${c}'`);if(i)break;n[c||"#"+s]=i}if(!i){const s=Object.entries(n).map(a=>{let[p,_]=a;return`adapter ${p} `+(_===!1?"is not supported by the environment":"is not available in the build")});let c=t?s.length>1?`since :
`+s.map(_L).join(`
`):" "+_L(s[0]):"as no adapter specified";throw new Yr("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return i},adapters:l5};function rw(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Rm(null,e)}function vL(e){return rw(e),e.headers=Ta.from(e.headers),e.data=ew.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),BR.getAdapter(e.adapter||n1.adapter)(e).then(function(t){return rw(e),t.data=ew.call(e,e.transformResponse,t),t.headers=Ta.from(t.headers),t},function(t){return TR(t)||(rw(e),t&&t.response&&(t.response.data=ew.call(e,e.transformResponse,t.response),t.response.headers=Ta.from(t.response.headers))),Promise.reject(t)})}const kR="1.7.9",Lv={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Lv[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const bL={};Lv.transitional=function(e,t,r){function i(n,s){return"[Axios v"+kR+"] Transitional option '"+n+"'"+s+(r?". "+r:"")}return(n,s,c)=>{if(e===!1)throw new Yr(i(s," has been removed"+(t?" in "+t:"")),Yr.ERR_DEPRECATED);return t&&!bL[s]&&(bL[s]=!0,console.warn(i(s," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(n,s,c):!0}};Lv.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function ost(e,t,r){if(typeof e!="object")throw new Yr("options must be an object",Yr.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let n=i.length;for(;n-- >0;){const s=i[n],c=t[s];if(c){const a=e[s],p=a===void 0||c(a,s,e);if(p!==!0)throw new Yr("option "+s+" must be "+p,Yr.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Yr("Unknown option "+s,Yr.ERR_BAD_OPTION)}}const Zy={assertOptions:ost,validators:Lv},pu=Zy.validators;class Ap{constructor(t){this.defaults=t,this.interceptors={request:new hL,response:new hL}}async request(t,r){try{return await this._request(t,r)}catch(i){if(i instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const s=n.stack?n.stack.replace(/^.+\n/,""):"";try{i.stack?s&&!String(i.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+s):i.stack=s}catch{}}throw i}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=Rp(this.defaults,r);const{transitional:i,paramsSerializer:n,headers:s}=r;i!==void 0&&Zy.assertOptions(i,{silentJSONParsing:pu.transitional(pu.boolean),forcedJSONParsing:pu.transitional(pu.boolean),clarifyTimeoutError:pu.transitional(pu.boolean)},!1),n!=null&&(he.isFunction(n)?r.paramsSerializer={serialize:n}:Zy.assertOptions(n,{encode:pu.function,serialize:pu.function},!0)),Zy.assertOptions(r,{baseUrl:pu.spelling("baseURL"),withXsrfToken:pu.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let c=s&&he.merge(s.common,s[r.method]);s&&he.forEach(["delete","get","head","post","put","patch","common"],N=>{delete s[N]}),r.headers=Ta.concat(c,s);const a=[];let p=!0;this.interceptors.request.forEach(function(N){typeof N.runWhen=="function"&&N.runWhen(r)===!1||(p=p&&N.synchronous,a.unshift(N.fulfilled,N.rejected))});const _=[];this.interceptors.response.forEach(function(N){_.push(N.fulfilled,N.rejected)});let w,S=0,C;if(!p){const N=[vL.bind(this),void 0];for(N.unshift.apply(N,a),N.push.apply(N,_),C=N.length,w=Promise.resolve(r);S<C;)w=w.then(N[S++],N[S++]);return w}C=a.length;let I=r;for(S=0;S<C;){const N=a[S++],F=a[S++];try{I=N(I)}catch(W){F.call(this,W);break}}try{w=vL.call(this,I)}catch(N){return Promise.reject(N)}for(S=0,C=_.length;S<C;)w=w.then(_[S++],_[S++]);return w}getUri(t){t=Rp(this.defaults,t);const r=PR(t.baseURL,t.url);return SR(r,t.params,t.paramsSerializer)}}he.forEach(["delete","get","head","options"],function(e){Ap.prototype[e]=function(t,r){return this.request(Rp(r||{},{method:e,url:t,data:(r||{}).data}))}});he.forEach(["post","put","patch"],function(e){function t(r){return function(i,n,s){return this.request(Rp(s||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:n}))}}Ap.prototype[e]=t(),Ap.prototype[e+"Form"]=t(!0)});class I3{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(n){r=n});const i=this;this.promise.then(n=>{if(!i._listeners)return;let s=i._listeners.length;for(;s-- >0;)i._listeners[s](n);i._listeners=null}),this.promise.then=n=>{let s;const c=new Promise(a=>{i.subscribe(a),s=a}).then(n);return c.cancel=function(){i.unsubscribe(s)},c},t(function(n,s,c){i.reason||(i.reason=new Rm(n,s,c),r(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=i=>{t.abort(i)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new I3(function(r){t=r}),cancel:t}}}function ast(e){return function(t){return e.apply(null,t)}}function lst(e){return he.isObject(e)&&e.isAxiosError===!0}const c5={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(c5).forEach(e=>{let[t,r]=e;c5[r]=t});function RR(e){const t=new Ap(e),r=hR(Ap.prototype.request,t);return he.extend(r,Ap.prototype,t,{allOwnKeys:!0}),he.extend(r,t,null,{allOwnKeys:!0}),r.create=function(i){return RR(Rp(e,i))},r}const as=RR(n1);as.Axios=Ap;as.CanceledError=Rm;as.CancelToken=I3;as.isCancel=TR;as.VERSION=kR;as.toFormData=Pv;as.AxiosError=Yr;as.Cancel=as.CanceledError;as.all=function(e){return Promise.all(e)};as.spread=ast;as.isAxiosError=lst;as.mergeConfig=Rp;as.AxiosHeaders=Ta;as.formToJSON=e=>ER(he.isHTMLForm(e)?new FormData(e):e);as.getAdapter=BR.getAdapter;as.HttpStatusCode=c5;as.default=as;const cst="https://eines.icgc.cat/recursos/mapicgc-gl-js/mapicgc-config.json",ust=5e3;class FR{static async getConfigICGC(){try{const t=await as.get(cst,{timeout:ust});return t.data?t.data:(console.log("Resposta sense dades:",t),yp)}catch(t){return t.response?(console.error("Error de resposta:",t.response.data),console.error("Codi d'estat:",t.response.status)):t.request?console.error("No s'ha rebut resposta del servidor:",t.request):console.error("Error:",t.message),yp}}}const hst={"fill-opacity":["interpolate",["exponential",.5],["zoom"],13.5,1,18,.4],"fill-outline-color":"rgba(0,0, 0, 0)","fill-color":["interpolate",["cubic-bezier",.5,1,1,1],["get","nivell_2"],0,"#ffffff",111,"#ffff00",112,"#ccff33",113,"#af5b15",114,"#808000",115,"#cdcd00",116,"#ffffcc",221,"#33cc33",222,"#66ff33",223,"#689018",224,"#967d5f",225,"#19e61e",226,"#b4ff9b",227,"#aaa500",228,"#c3c3a0",229,"#00ff9b",230,"#ff9632",231,"#282828",232,"#79797a",233,"#f5df78",234,"#3296ff",341,"#ff007d",342,"#ff53cd",343,"#ffa4e2",344,"#ffc8e2",345,"#ffb4b4",346,"#0f3700",347,"#730055",348,"#6200c4",349,"#4a9595",350,"#ff00f0",351,"#adaaca",352,"#ffe6e6",353,"#67629a",354,"#4a466e",355,"#2f2d46",461,"#6f6fff",462,"#0000dc",463,"#000064",464,"#185f94",465,"#12466d",466,"#000080"]},dst={cobertesSol:hst},pst="lines",_y="labels";let rp,Bg,Dn,fi,fst=class{constructor(e){FR.getConfigICGC().then(t=>{rp={...t.Styles},Dn={...t.Layers},Bg={...t.Terrains},fi={...t.defaultOptions},this.initTheMap(e)}).catch(t=>{console.info("Configuracio per defecte",t),rp={...yp.Styles},Dn={...yp.Layers},Bg={...yp.Terrains},fi={...yp.defaultOptions},this.initTheMap(e)})}initTheMap(e){if(!e)e=fi.mapOptions;else for(const r in fi.mapOptions){let i=[fi.mapOptions.center[0],fi.mapOptions.center[1]];fi.mapOptions.center=i,e.hasOwnProperty(r)||(e[r]=fi.mapOptions[r])}e.maxPitch=85,e.maplibreLogo=!1,e.attributionControl=!1;const t=e.style.includes("https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/");t?(this.map=new Bs.Map({container:e.container,center:e.center,zoom:e.zoom,pitch:e.pitch||0,hash:e.hash||!1,style:{version:8,sources:{},layers:[]}}),this.map.on("load",()=>{this.map.addSource("raster-source",{type:"raster",tiles:[e.style],tileSize:256}),this.map.addLayer({id:"raster-layer",type:"raster",source:"raster-source"})})):this.map=new Bs.Map(e),this.map.on("load",()=>{if(!t){const r=this.map.getStyle().name,i=e.style;this.map.addControl(new Iit({color:i.indexOf("orto")===-1,defaultOptions:fi}),"bottom-left"),this._dealOrto3dStyle(r)}})}addGeocoderICGC(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"top-right";try{e={collapsed:!0,marker:!0,zoom:16,popup:!0,showResultMarkers:!0,maplibregl:Bs,showResultsWhileTyping:!0,minLength:2,...e};const r={forwardGeocode:async n=>{const s=[];try{const c=fi.geocoder.peliasUrl1+encodeURIComponent(n.query)+fi.geocoder.peliasUrl2,a=await(await fetch(c)).json();for(const p of a.features){const _=p.geometry.coordinates,w={type:"Feature",geometry:{type:"Point",coordinates:_},place_name:p.properties.etiqueta,properties:p.properties,text:p.properties.etiqueta,place_type:["place"],center:_};s.push(w)}}catch(c){console.error(`Failed to forwardGeocode with error: ${c}`)}return{features:s}}};this.map.addControl(new Ait(r,e),t);let i=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");i[0].attributes[2].nodeValue="Cerca...",i[0].addEventListener("input",function(n){n.target.value.length>3})}catch(r){console.error(`Error adding ICGC geocoder: ${r.message}`)}}async loadImage(e){try{return this.map.loadImage(e)}catch(t){console.error(`Error getting loadImage: ${t.message}`)}}getConfigStyles(){try{let e=[];for(const t of rp)e.push(t.name);return e}catch(e){console.error(`Error retrieving base styles: ${e.message}`)}}getConfigWMSLayers(){try{let e=[];for(const t in Dn.WMS)Dn.WMS.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving WMS layers: ${e.message}`)}}getConfigOrtoLayers(){try{let e=[];for(const t in Dn.Orto)Dn.Orto.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving orto image layers: ${e.message}`)}}getConfigVectorLayers(){try{let e=[];for(const t in Dn.Vector)Dn.Vector.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vector layers: ${e.message}`)}}getConfigVectorAdminLayers(){try{let e=[];for(const t in Dn.VectorAdmin)Dn.VectorAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vectorAdmin layers: ${e.message}`)}}getConfigFGBAdminLayers(){try{let e=[];for(const t in Dn.FGBAdmin)Dn.FGBAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving FGBAdmin layers: ${e.message}`)}}async fetchData(e,t,r){try{(!r||r===void 0)&&(r={type:"line",layout:{visibility:"visible"},paint:{"line-color":"grey","line-width":2},layerPosition:"top"});let i=r.layerPosition;if(e.includes(".fgb"))this.addFGBLayerICGC(e,t,r);else{const n=await(await fetch(e)).json();let s=t,c=this._dealOrderLayer(i),a=n.features[0].geometry.type;a.includes("ine")&&(r!==void 0?this.map.addLayer({id:s,type:"line",source:{type:"geojson",data:n},layout:r.layout||{},paint:r.paint||{}},c):this.map.addLayer({id:s,type:"line",source:{type:"geojson",data:n},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},c)),a.includes("olygon")&&(r!==void 0?this.map.addLayer({id:s,type:"fill",source:{type:"geojson",data:n},layout:r.layout,paint:r.paint},c):this.map.addLayer({id:s,type:"fill",source:{type:"geojson",data:n},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},c)),a.includes("oint")&&(r!==void 0?this.map.addLayer({id:s,type:"circle",source:{type:"geojson",data:n},layout:r.layout,paint:r.paint},c):this.map.addLayer({id:s,type:"circle",source:{type:"geojson",data:n},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},c))}}catch(i){console.error(`Error fetching data: ${i.message}`)}}async fetchDataAndMenu(e,t,r,i){try{let n;i!==null?n=i.layerPosition:n=_y;let s,c=document.getElementById("map");if(document.getElementById("menu-group")?s=document.getElementById("menu-group"):(s=document.createElement("nav"),s.id="menu-group",s.classList.add="filter-group",c.appendChild(s)),s!==null){let a="visible",p=this._dealOrderLayer(n),_;if(e.includes(".fgb")){let S=this._getKeyByUrlFGB(e);S===null&&(S="userFGB");const C=await fetch(e),I={type:"FeatureCollection",features:[]};for await(const F of xT(C.body))I.features.push(F);_=I;let N=t;if(this.map.addSource(N,{type:"geojson",data:I}),e.includes("text"))i!==void 0?this.map.addLayer({id:t,type:"symbol",source:N,layout:i.layout,paint:i.paint},p):this.map.addLayer({id:t,type:"symbol",source:N,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:a,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},p);else{let F=t+"Text";this.map.addLayer({id:F,type:"symbol",source:N,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:a,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},p)}}else _=await(await fetch(e)).json();if(r!=="all"){const S=document.createElement("div");S.id="titleDivMenu",S.textContent=t,s.appendChild(S);const C=document.createElement("div");C.id="titleDivMenuSub",C.textContent=` ${r}`,s.appendChild(C)}let w;if(i.type?w=i.type:w=_.features[0].geometry.type,r==="all")w.includes("ine")&&(i!==void 0?this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:_},layout:i.layout,paint:i.paint},p):this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:_},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},p)),w.includes("olygon")&&(i!==void 0?this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:_},layout:i.layout,paint:i.paint},p):this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:_},layout:{visibility:"visible"},paint:{"fill-color":"#0000FF","fill-opacity":0}},p)),w.includes("oint")&&(i!==void 0?this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:_},layout:i.layout,paint:i.paint},p):this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:_},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},p)),w.includes("ymbol")&&(i!==void 0?this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:_},layout:i.layout,paint:i.paint},p):this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:_},layout:{visibility:"visible"},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},p)),this.addMenuItem(t);else{let S=r;const C={};_.features.forEach(I=>{const N=I.properties[S],F=N+"-userFieldFilter-"+t;N!==null&&(C[F]||(w.includes("ine")&&(i!==void 0?this.map.addLayer({id:F,type:"line",source:{type:"geojson",data:_},layout:i.layout,paint:i.paint,filter:["==",`${S}`,N]},p):this.map.addLayer({id:F,type:"line",source:{type:"geojson",data:_},layout:{visibility:"visible"},filter:["==",`${S}`,N],paint:{"line-color":"black","line-width":2,"line-opacity":1}},p)),w.includes("olygon")&&(i!==void 0?this.map.addLayer({id:F,type:"fill",source:{type:"geojson",data:_},filter:["==",`${S}`,N],layout:i.layout,paint:i.paint},p):this.map.addLayer({id:F,type:"fill",source:{type:"geojson",data:_},layout:{visibility:"visible"},filter:["==",`${S}`,N],paint:{"fill-color":"blue","fill-opacity":.6}},p)),w.includes("oint")&&(i!==void 0?this.map.addLayer({id:F,type:"circle",source:{type:"geojson",data:_},filter:["==",`${S}`,N],layout:i.layout,paint:i.paint},p):this.map.addLayer({id:F,type:"circle",source:{type:"geojson",data:_},layout:{visibility:"visible"},filter:["==",`${S}`,N],paint:{"circle-color":"red","circle-opacity":.85}},p)),C[F]=!0,this.addMenuItem(F)))})}}}catch(n){console.error(`Error fetching data: ${n.message}`)}}on(e,t){setTimeout(()=>{try{return this.map.on(e,t)}catch(r){console.error(`Error adding event ON listener: ${r.message}`)}},100)}setStyle(e,t){try{t!==void 0?this.map.setStyle(e,t):this.map.setStyle(e),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var r=window.document.querySelector(".maplibregl-compact-show");r.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(r){console.error(`Error setting style: ${r.message}`)}}addControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(e,t)}catch(r){console.error(`Error adding control: ${r.message}`)}}setSky(e){try{e===void 0&&(this.map.style.stylesheet.id.includes("orto")?e={"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("mapa_estandard_general")?e={"sky-color":"#a5f0f0","sky-horizon-blend":.3,"horizon-color":"#e1e3e3","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("icgc_mapa_vissir")?e={"sky-color":"#a5f0f0","sky-horizon-blend":.3,"horizon-color":"#e1e3e3","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("fosc")?e={"sky-color":"#232423","sky-horizon-blend":.3,"horizon-color":"#969996","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#383838"}:e={"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"}),this.map.setSky(e)}catch(t){console.error(`Error setting sky properties: ${t.message}`)}}addMouseCoordControl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"bottom-left";try{this.map.addControl(new kit(e),t)}catch(r){console.error(`Error adding mouse coordinate control: ${r.message}`)}}addGeolocateControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new Bs.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),t):this.map.addControl(new Bs.GeolocateControl(e),t)}catch(r){console.error(`Error adding geolocate control: ${r.message}`)}}addFullscreenControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new Bs.FullscreenControl({container:HTMLElement}),t):this.map.addControl(new Bs.FullscreenControl(e),t)}catch(r){console.error(`Error adding fullscreen control: ${r.message}`)}}addLayer(e,t){try{this.map.addLayer(e,t)}catch(r){console.error(`Error adding layer: ${r.message}`)}}addImage(e,t,r){try{this.map.addImage(e,t,r)}catch(i){console.error(`Error adding image: ${i.message}`)}return this}addSource(e,t){try{this.map.addSource(e,t)}catch(r){console.error(`Error adding source: ${r.message}`)}return this}addSprite(e,t,r){try{this.map.addSprite(e,t,r)}catch(i){console.error(`Error adding sprite: ${i.message}`)}return this}areTilesLoaded(){return this.map.areTilesLoaded()}cameraForBounds(e,t){return this.map.cameraForBounds(e,t)}easeTo(e,t){return this.map.easeTo(e,t),this}fitBounds(e,t,r){return this.map.fitBounds(e,t,r),this}fitScreenCoordinates(e,t,r,i,n){return this.map.fitScreenCoordinates(e,t,r,i,n),this}flyTo(e,t){return this.map.flyTo(e,t),this}getBearing(){return this.map.getBearing()}getBounds(){return this.map.getBounds()}getCameraTargetElevation(){return this.map.getCameraTargetElevation()}getCanvas(){return this.map.getCanvas()}getCanvasContainer(){return this.map.getCanvasContainer()}getCenter(){return this.map.getCenter()}getContainer(){return this.map.getContainer()}getFeatureState(e){return this.map.getFeatureState(e)}getFilter(e){return this.map.getFilter(e)}getGlyphs(){return this.map.getGlyphs()}getImage(e){return this.map.getImage(e)}getLayer(e){return this.map.getLayer(e)}getLayersOrder(){return this.map.getLayersOrder()}getLayoutProperty(e,t){return this.map.getLayoutProperty(e,t)}getLight(){return this.map.getLight()}getMaxBounds(){return this.map.getMaxBounds()}getMaxPitch(){return this.map.getMaxPitch()}getMaxZoom(){return this.map.getMaxZoom()}getMinPitch(){return this.map.getMinPitch()}getMinZoom(){return this.map.getMinZoom()}getPadding(){return this.map.getPadding()}getPaintProperty(e,t){return this.map.getPaintProperty(e,t)}getPitch(){return this.map.getPitch()}getPixelRatio(){return this.map.getPixelRatio()}getRenderWorldCopies(){return this.map.getRenderWorldCopies()}getSource(e){return this.map.getSource(e)}getSprite(){return this.map.getSprite()}getStyle(){return this.map.getStyle()}getTerrain(){return this.map.getTerrain()}getZoom(){return this.map.getZoom()}hasControl(e){return this.map.hasControl(e)}hasImage(e){return this.map.hasImage(e)}isMoving(){return this.map.isMoving()}isRotating(){return this.map.isRotating()}isSourceLoaded(e){return this.map.isSourceLoaded(e)}isStyleLoaded(){return this.map.isStyleLoaded()}isZooming(){return this.map.isZooming()}jumpTo(e,t){return this.map.jumpTo(e,t)}listImages(){return this.map.listImages()}listens(e){return this.map.listens(e)}loadImage(e){return this.map.loadImage(e)}loaded(){return this.map.loaded()}LngLatBounds(e,t){return new Bs.LngLatBounds(e,t)}addProtocol(e,t){return this.map.addProtocol(e,t)}moveLayer(e,t){return this.map.moveLayer(e,t)}panBy(e,t,r){return this.map.panBy(e,t,r)}panTo(e,t,r){return this.map.panTo(e,t,r)}project(e){return this.map.project(e)}queryRenderedFeatures(e,t){return this.map.queryRenderedFeatures(e,t)}querySourceFeatures(e,t){return this.map.querySourceFeatures(e,t)}queryTerrainElevation(e){return this.map.queryTerrainElevation(e)}redraw(){return this.map.redraw()}remove(){return this.map.remove()}removeControl(e){return this.map.removeControl(e)}removeFeatureState(e,t){return this.map.removeFeatureState(e,t)}removeImage(e){return this.map.removeImage(e)}removeLayer(e){try{this.map.removeLayer(e)}catch(t){console.error(`Error removing layer: ${t.message}`)}}removeSource(e){try{this.map.removeSource(e)}catch(t){console.error(`Error removing source: ${t.message}`)}}removeSprite(e){return this.map.removeSprite(e)}resetNorth(e,t){return this.map.resetNorth(e,t)}resetNorthPitch(e,t){return this.map.resetNorthPitch(e,t)}resize(e){return this.map.resize(e)}rotateTo(e,t,r){return this.map.rotateTo(e,t,r)}setBearing(e,t){return this.map.setBearing(e,t)}setCenter(e,t){return this.map.setCenter(e,t)}setEventedParent(e,t){return this.map.setEventedParent(e,t)}setFeatureState(e,t){return this.map.setFeatureState(e,t)}setFilter(e,t,r){return this.map.setFilter(e,t,r)}setGlyphs(e,t){return this.map.setGlyphs(e,t)}setLayerZoomRange(e,t,r){return this.map.setLayerZoomRange(e,t,r)}setLayoutProperty(e,t,r,i){return this.map.setLayoutProperty(e,t,r,i)}setLight(e,t){return this.map.setLight(e,t)}setMaxBounds(e){return this.map.setMaxBounds(e)}setMaxPitch(e){return this.map.setMaxPitch(e)}setMaxZoom(e){return this.map.setMaxZoom(e)}setMinPitch(e){return this.map.setMinPitch(e)}setMinZoom(e){return this.map.setMinZoom(e)}setPadding(e,t){return this.map.setPadding(e,t)}setPaintProperty(e,t,r,i){return this.map.setPaintProperty(e,t,r,i)}setPitch(e,t){return this.map.setPitch(e,t)}setPixelRatio(e){return this.map.setPixelRatio(e)}setRenderWorldCopies(e){return this.map.setRenderWorldCopies(e)}setSprite(e,t){return this.map.setSprite(e,t)}setTerrain(e){return this.map.setTerrain(e)}setTransformRequest(e){return this.map.setTransformRequest(e)}setZoom(e,t){return this.map.setZoom(e,t)}snapToNorth(e,t){return this.map.snapToNorth(e,t)}stop(){return this.map.stop()}triggerRepaint(){return this.map.triggerRepaint()}unproject(e){return this.map.unproject(e)}updateImage(e,t){return this.map.updateImage(e,t)}zoomIn(e,t){return this.map.zoomIn(e,t)}zoomOut(e,t){return this.map.zoomOut(e,t)}zoomTo(e,t,r){return this.map.zoomTo(e,t,r)}addLayerGeoJSON(e,t){try{let r=this._dealOrderLayer(t);this.map.addSource(`${e.id}`,{type:"geojson",data:e.data}),this.map.addLayer({id:`${e.id}-layerIcgcMap`,type:e.type,source:`${e.id}`,layout:e.layout,paint:e.paint},r)}catch(r){console.error(`Error adding GeoJSON layer: ${r.message}`)}}addLayerWMS(e,t,r){try{let i=this._dealOrderLayer(r.layerPosition);r?(this.map.addSource(`${t}`,{type:"raster",tiles:[e],tileSize:256},i),this.map.addLayer({id:t,type:"raster",source:t,layout:r.layout,paint:r.paint},i)):(this.map.addSource(`${t}`,{type:"raster",tiles:[e],tileSize:256},i),this.map.addLayer({id:t,type:"raster",source:t,paint:{}},i))}catch(i){console.error(`Error adding WMS layer: ${i.message}`)}}addLogo(e){try{let t=document.getElementById("map"),r;r=document.createElement("div"),r.id="logos",t.appendChild(r);const i=document.createElement("img");i.src=e.url,i.style.height=e.height;const n=document.getElementById("logos"),s=document.createElement("a");s.id=e.id,s.href=e.href,s.target="_blank",s.style.position="relative",s.style.bottom="1px",s.appendChild(i),n.appendChild(s)}catch(t){console.error(`Error adding logo: ${t.message}`)}}addBasemapsICGC(e){try{const t=s=>{this.map.setStyle(s)};let r=document.getElementById("map"),i;i=document.createElement("div"),i.id="basemap-group",i.classList.add="filter-group",r.appendChild(i);const n=document.getElementById("basemap-group");for(const s of e)for(const c of Object.keys(fi.baseStyles)){const a=fi.baseStyles[c];if(s===a.url){const p=document.createElement("div");p.className="basemap-item",p.title=a.key,p.style.backgroundImage=`url('${a.image}')`,n.appendChild(p),p.addEventListener("click",()=>t(a.url))}}}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addBasemaps(e){try{const t=s=>{map.setStyle(s.url)};let r=document.getElementById("map"),i;i=document.createElement("div"),i.id="basemap-group",i.classList.add="basemap-group",r.appendChild(i);const n=document.getElementById("basemap-group");e.forEach(s=>{const c=document.createElement("div");c.className="basemap-item",c.title=s.label,c.style.backgroundImage=`url('${s.image}')`,n.appendChild(c),c.addEventListener("click",()=>t(s))})}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addFeatureQuery(e,t,r){try{let i;this.map.on("mouseenter",e,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",e,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",n=>{let s=this.map.queryRenderedFeatures(n.point);if(s&&s[0].source.includes(e)){let c=[n.lngLat.lng,n.lngLat.lat];if(t!==void 0&&t.length>0&&t!=="all"){if(t!==null){let a="";t.forEach(p=>{let _=s[0].properties[p];a=a+`<h4>${_}</h4>`}),i=a,this.addPopup(c,i,r)}}else{let a="";for(const p in s[0].properties)a+="<b>"+p+"</b>:"+s[0].properties[p]+"<br>";i=a,this.addPopup(c,i,r)}}})}catch(i){console.error(`Error adding feature query: ${i.message}`)}}addScaleControl(e,t){try{var r=new Bs.ScaleControl(e);this.map.addControl(r,t)}catch(i){console.error(`Error adding scale: ${i.message}`)}}addExportControl(e,t){try{typeof e=="string"&&(t=e,e=void 0),e===void 0&&(e={PageSize:gp.A4,PageOrientation:jg.Landscape,Format:nh.PNG,DPI:Vx[300],Crosshair:!0,PrintableArea:!0,Local:"ca"},t="top-right"),this.map.addControl(new Rrt(e),t)}catch(r){console.error(`Error adding export control: ${r.message}`)}}addMarker(e){try{let t,r;return e.text===void 0?t=new Bs.Marker(e.options).setLngLat(e.coord).addTo(this.map):(r=new Bs.Popup({offset:e.textOffset}).setHTML(e.text),t=new Bs.Marker(e.options).setLngLat(e.coord).setPopup(r).addTo(this.map)),t}catch(t){return console.error(`Error adding marker: ${t.message}`),null}}addPopup(e,t,r){try{return r.image===void 0?new Bs.Popup().setLngLat(e).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${r.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
 ${t}
          </div>
          <div class="popupBottomDown">
          </div>
          </div>
        </div>
      `).addTo(this.map):new Bs.Popup().setLngLat(e).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${r.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
          ${t}
          </div>
          <div class="popupBottomDown">
             <img style="  padding: 8px;  width: 50%;" src=${r.image} />
          </div>
          </div>
        </div>
      `).addTo(this.map)}catch(i){return console.error(`Error adding popup: ${i.message}`),null}}addFullScreen(e){try{e===void 0&&(e="top-right"),this.map.addControl(new Bs.FullscreenControl,e)}catch(t){console.error(`Error adding fullscreen control: ${t.message}`)}}addMenuItem(e){try{let t;if(e.includes("-userFieldFilter-")?t=e.split("-userFieldFilter-")[0]:t=e,e.length>0){const r=document.getElementById("menu-group"),i=document.createElement("input");i.type="checkbox",i.id=e,i.checked=!0,r.appendChild(i);const n=document.createElement("label");n.setAttribute("for",e),n.textContent=t,r.appendChild(n),i.addEventListener("change",s=>{this.map.setLayoutProperty(e,"visibility",s.target.checked?"visible":"none")})}}catch(t){console.error(`Error adding menu item: ${t.message}`)}}addLayerTree(e){try{let t=e.features,r=document.getElementById("map"),i=document.createElement("nav");i.id="filter-group",r.appendChild(i);const n=document.getElementById("filter-group");this.map.addSource(`${e.id}`,{type:e.type,data:t}),t.features.forEach(s=>{const c=s.properties.icon,a=`poi-${c}`;if(!this.map.getLayer(a)){this.map.addLayer({id:a,type:"circle",source:`${e.id}`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",c]},this._firstSymbolLayer());const p=document.createElement("input");p.type="checkbox",p.id=a,p.checked=!0,n.appendChild(p);const _=document.createElement("label");_.setAttribute("for",a),_.textContent=c,n.appendChild(_),p.addEventListener("change",w=>{this.map.setLayoutProperty(a,"visibility",w.target.checked?"visible":"none")})}})}catch(t){console.error(`Error adding layer tree: ${t.message}`)}}createNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new Bs.NavigationControl(e),t)}catch(r){return console.error(`Error creating navigation control: ${r.message}`),null}}addNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new Bs.NavigationControl(e),t)}catch(r){console.error(`Error adding navigation control: ${r.message}`)}}addAttributionControl(e,t){try{this.map.addControl(new Bs.AttributionControl(e),t)}catch(r){console.error(`Error adding attribution control: ${r.message}`)}}addImageLayerICGC(e,t,r){try{let i=null,n,s;r?(s=r,n=r.layerPosition):s={type:"raster",layout:{visibility:"visible"},paint:{"raster-opacity":1},layerPosition:_y},i=this._findImageType(e,Dn.Orto,Dn.VectorAdmin,Dn.WMS,Dn.Vector),i||console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",e,"font-weight: bold; font-style: italic;");let c={id:t,tiles:e};this.addLayerWMS(e,t,s)}catch(i){console.error(`Error adding ICGC image layer: ${i.message}`)}}async addVectorLayerICGC(e,t,r){try{let{type:i="line",layerPosition:n=_y,layoutOptions:s={visibility:"visible"},paintOption:c}=r||{},a=this._dealOrderLayer(n);if(!e){console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",e,"font-weight: bold; font-style: italic;");return}if(e.includes("https")){let p=this._getKeyByUrlVector(e);this.map.addSource(p,{type:"vector",url:e});let _={id:p,type:"fill",source:p,"source-layer":"cobertes",maxzoom:18,layout:r.layout,paint:dst.cobertesSol};if(p==="cobertes2018"&&this.map.addLayer(_,a),s.visibility==="visible"){let w=this._getLegendByName(p);this.addLegend(w,p)}}else{let p=t;this.map.addSource(p,{type:"vector",url:fi.limitsUrl});let _={id:t,type:i,source:p,"source-layer":e,layout:r.layout,paint:r.paint||{}};i==="fill"||i==="polygon"?_.paint=c||{"fill-color":"#0000FF","fill-opacity":0}:i==="line"&&(_.paint=c||{"line-color":"#4832a8","line-opacity":1,"line-width":1}),this.map.addLayer(_,a)}}catch(i){console.error(`Error adding ICGC vector layer: ${i.message}`)}}async addFGBLayerICGC(e,t,r){try{r||(r.layout={visibility:!0},r.paint={"line-color":"#4832a8","line-opacity":1,"line-width":1},r.type="lines",r.layerPosition="labels");let i=this._dealOrderLayer(r.layerPosition);const n=await fetch(e),s={type:"FeatureCollection",features:[]};for await(const a of xT(n.body))s.features.push(a);let c=t;this.map.addSource(c,{type:"geojson",data:s}),e.includes("text")?this.map.addLayer({id:t,type:"symbol",source:c,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:r.layout.visibility,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},i):this.map.addLayer({id:t,type:r.type,source:c,layout:r.layout,paint:r.paint},i)}catch(i){console.error(`Error adding ICGC FGB layer: ${i.message}`)}}addTerrainICGC(e,t){try{let r;for(const n in Bg)if(Bg.hasOwnProperty(n)){const s=Bg[n];s===e&&(r=s)}let i=r;this.getSource("terrainICGC")!==void 0&&(this.getStyle().layers.forEach(n=>{n.source==="terrainICGC"&&this.removeLayer(n.id)}),this.removeSource("terrainICGC")),this.getSource("terrainICGC")===void 0&&(e.includes("terrarium")?this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:512,maxzoom:16})),this.map.setTerrain({source:"terrainICGC",exaggeration:1.5}),t==null||this.map.addControl(new CO({pitch:90,bearing:null,minpitchzoom:null}),t)}catch(r){console.error(`Error adding 3D terrain: ${r.message}`)}}addLegend(e,t){try{this.map.addControl(new Lit({url:e,idLayer:t}))}catch(r){console.error(`Error adding legend: ${r.message}`)}}_findImageType(e,t,r,i,n){const s=[t,r,i,n];for(const c of s)for(const[a,p]of Object.entries(c))if(p===e)return a;return null}_getKeyByUrlFGB(e){for(const t in Dn.FGBAdmin)if(Dn.FGBAdmin.hasOwnProperty(t)&&Dn.FGBAdmin[t]===e)return t;return null}_getLegendByName(e){for(const t in fi.vectorLayers){const r=fi.vectorLayers[t];if(r.key===e)return r.legend}return null}_getKeyByUrlVector(e){for(const t in Dn.Vector)if(Dn.Vector.hasOwnProperty(t)&&Dn.Vector[t]===e)return t;return null}async _raiseText3DStyle(){try{const e=await this.map.loadImage(fi.map3dOptions.imageIcon);this.map.addImage("stick",e.data),this.map.getStyle().layers.forEach(t=>{if(t["source-layer"]===fi.map3dOptions.sourceLayerFilterId&&t.minzoom>=fi.map3dOptions.minZoomFilter&&e){const r=t.id;this.map.setLayoutProperty(r,"icon-image","stick"),this.map.setLayoutProperty(r,"text-offset",[0,-9]),this.map.setLayoutProperty(r,"symbol-placement","point"),this.map.setLayoutProperty(r,"symbol-avoid-edges",!1),this.map.setLayoutProperty(r,"text-allow-overlap",!0),this.map.setLayoutProperty(r,"text-ignore-placement",!1),this.map.setLayoutProperty(r,"text-pitch-alignment","auto"),this.map.setLayoutProperty(r,"text-rotation-alignment","auto"),this.map.setLayoutProperty(r,"text-justify","center"),this.map.setLayoutProperty(r,"text-anchor","bottom"),this.map.setLayoutProperty(r,"icon-anchor","bottom"),this.map.setPaintProperty(r,"text-color","#ffffff"),this.map.setPaintProperty(r,"text-halo-color","#000000"),this.map.setPaintProperty(r,"text-halo-width",2)}})}catch(e){return console.error(`Error dealing orto 3D: ${e.message}`),null}}_dealStyleMaps(e){try{if(e&&e.indexOf("icgc.cat")!=-1){for(const t in rp)if(rp.hasOwnProperty(t)){const r=rp[t];if(t===e)return r}return rp[0]}else return e}catch(t){return console.error(`Error dealing with map styles: ${t.message}`),null}}_dealOrto3dStyle(e){try{if(e=="orto3d"){this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const t=new iB({intensity:4}),r=new qS({ambientLight:t});this.map.setTerrain({source:fi.map3dOptions.terrainSource,exaggeration:fi.map3dOptions.exaggeration});const i=this._createCitiesMapboxLayer();this.map.getLayer(fi.map3dOptions.layerId3d)||(this.map.addLayer(i,fi.map3dOptions.layerIdOrder),this.map.setLayerZoomRange(fi.map3dOptions.layerId3d,fi.map3dOptions.minZoomRange,fi.map3dOptions.maxZoomRange),i.deck.setProps({effects:[r]}),this._raiseText3DStyle()),this.map.setSky({"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"})}else this.map.getLayer(fi.map3dOptions.layerId3d)&&(this.map.removeLayer(fi.map3dOptions.layerId3d),this.map.setTerrain(null))}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_dealOrderLayer(e){return e===_y?this._firstSymbolLayer():e===pst?this._firstLineLayer():""}_firstSymbolLayer(){try{const e=this.map.getStyle().layers;let t;for(let r=0;r<e.length;r++)if(e[r].type==="symbol"&&e[r].id.indexOf("contour")===-1&&e[r].id.indexOf("water")===-1){t=e[r].id;break}return t}catch(e){console.error(`Error getting first symbol layer: ${e.message}`)}}_firstLineLayer(){try{const e=this.map.getStyle().layers;let t;for(let r=0;r<e.length;r++)if(e[r].type==="line"){t=e[r].id;break}return t}catch(e){console.error(`Error getting first symbol layer: ${e.message}`)}}_createCitiesMapboxLayer(){try{return new nZ({id:fi.map3dOptions.layerId3d,type:b3,data:fi.map3dOptions.urlTilesetCities,loader:v3,loadOptions:{tileset:{viewDistanceScale:1,updateTransforms:!0,maximumScreenSpaceError:fi.map3dOptions.spaceErrorFactor}},onTilesetLoad:e=>{e.options.maximumScreenSpaceError=fi.map3dOptions.spaceErrorFactor},onTileLoad:e=>{e.content.cartographicOrigin.z-=fi.map3dOptions.zfactor},operation:"terrain+draw"})}catch(e){return console.error(`Error adding MapboxLayer: ${e.message}`),null}}};var mst={exports:{}};function gst(e,t){var r=e.getCenter(),i=e.getZoom(),n=e.getBearing(),s=e.getPitch();t.forEach(function(c){c.jumpTo({center:r,zoom:i,bearing:n,pitch:s})})}function yst(){var e,t=arguments.length;if(t===1)e=arguments[0];else{e=[];for(var r=0;r<t;r++)e.push(arguments[r])}var i=[];e.forEach(function(a,p){i[p]=c.bind(null,a,e.filter(function(_,w){return w!==p}))});function n(){e.forEach(function(a,p){a.on("move",i[p])})}function s(){e.forEach(function(a,p){a.off("move",i[p])})}function c(a,p){s(),gst(a,p),n()}return n(),function(){s(),i=[],e=[]}}var _st=yst;(function(e){var t=_st,r=aR.EventEmitter;function i(n,s,c,a){if(this.options=a||{},this._mapA=n,this._mapB=s,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new r,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof c=="string"&&document.body.querySelectorAll){var p=document.body.querySelectorAll(c)[0];if(!p)throw new Error("Cannot find element with specified container selector.");p.appendChild(this._controlContainer)}else if(c instanceof Element&&c.appendChild)c.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=s.getContainer().getBoundingClientRect();var _=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(_),this._clearSync=t(n,s),this._onResize=(function(){this._bounds=s.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),s.on("resize",this._onResize),this.options&&this.options.mousemove&&(n.getContainer().addEventListener("mousemove",this._onMove),s.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}i.prototype={_setPointerEvents:function(n){this._controlContainer.style.pointerEvents=n,this._swiper.style.pointerEvents=n},_onDown:function(n){n.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(n){n=Math.min(n,this._horizontal?this._bounds.height:this._bounds.width);var s=this._horizontal?"translate(0, "+n+"px)":"translate("+n+"px, 0)";this._controlContainer.style.transform=s,this._controlContainer.style.WebkitTransform=s;var c=this._horizontal?"rect(0, 999em, "+n+"px, 0)":"rect(0, "+n+"px, "+this._bounds.height+"px, 0)",a=this._horizontal?"rect("+n+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+n+"px)";this._mapA.getContainer().style.clip=c,this._mapB.getContainer().style.clip=a,this.currentPosition=n},_onMove:function(n){this.options&&this.options.mousemove&&this._setPointerEvents(n.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(n)):this._setPosition(this._getX(n))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(n){n=n.touches?n.touches[0]:n;var s=n.clientX-this._bounds.left;return s<0&&(s=0),s>this._bounds.width&&(s=this._bounds.width),s},_getY:function(n){n=n.touches?n.touches[0]:n;var s=n.clientY-this._bounds.top;return s<0&&(s=0),s>this._bounds.height&&(s=this._bounds.height),s},setSlider:function(n){this._setPosition(n)},on:function(n,s){return this._ev.on(n,s),this},fire:function(n,s){return this._ev.emit(n,s),this},off:function(n,s){return this._ev.removeListener(n,s),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var n=this._mapA.getContainer();n&&(n.style.clip=null,n.removeEventListener("mousemove",this._onMove));var s=this._mapB.getContainer();s&&(s.style.clip=null,s.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=i:e.exports=i})(mst);function vst(){const e=up.useRef(null),t=up.useRef(null),[r]=up.useState(10);return up.useEffect(()=>{if(t.current)return;async function i(){const n=await FR.getConfigICGC();t.current=new fst({container:e.current,hash:!0,pitch:0,style:n.Styles.TOPO,center:[1.808,41.618],zoom:r})}i()},[1.808,41.618,r]),om.jsx("div",{className:"map-container",children:om.jsx("div",{ref:e,className:"map"})})}function bst(){return om.jsx("div",{className:"App",children:om.jsx(vst,{})})}iw.createRoot(document.getElementById("root")).render(om.jsx(zD.StrictMode,{children:om.jsx(bst,{})}));export{Ui as z};
